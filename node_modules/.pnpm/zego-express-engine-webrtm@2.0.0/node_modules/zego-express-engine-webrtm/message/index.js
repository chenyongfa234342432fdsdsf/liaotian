!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var s,i=t();for(s in i)("object"==typeof exports?exports:e)[s]=i[s]}}("undefined"!=typeof self?self:this,(function(){return t={0:function(e,t,s){var i=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function s(e,t,s){this.low=0|e,this.high=0|t,this.unsigned=!!s}function i(e){return!0===(e&&e.__isLong__)}function r(e){var t=Math.clz32(e&-e);return e?31-t:t}Object.defineProperty(s.prototype,"__isLong__",{value:!0}),s.isLong=i;var n={},o={};function a(e,t){var s,i,r;return t?(r=0<=(e>>>=0)&&e<256)&&(i=o[e])?i:(s=h(e,0,!0),r&&(o[e]=s),s):(r=-128<=(e|=0)&&e<128)&&(i=n[e])?i:(s=h(e,e<0?-1:0,!1),r&&(n[e]=s),s)}function g(e,t){if(isNaN(e))return t?p:y;if(t){if(e<0)return p;if(c<=e)return T}else{if(e<=-f)return w;if(f<=e+1)return I}return e<0?g(-e,t).neg():h(e%l|0,e/l|0,t)}function h(e,t,i){return new s(e,t,i)}s.fromInt=a,s.fromNumber=g,s.fromBits=h;var m=Math.pow;function u(e,t,s){if(0===e.length)throw Error("empty string");if(t="number"==typeof t?(s=t,!1):!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?p:y;if((s=s||10)<2||36<s)throw RangeError("radix");var i;if(0<(i=e.indexOf("-")))throw Error("interior hyphen");if(0===i)return u(e.substring(1),t,s).neg();for(var r=g(m(s,8)),n=y,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),h=parseInt(e.substring(o,o+a),s);n=(a<8?(a=g(m(s,a)),n.mul(a)):n=n.mul(r)).add(g(h))}return n.unsigned=t,n}function d(e,t){return"number"==typeof e?g(e,t):"string"==typeof e?u(e,t):h(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}s.fromString=u,s.fromValue=d;var l=4294967296,c=l*l,f=c/2,_=a(1<<24),y=a(0),p=(s.ZERO=y,a(0,!0)),b=(s.UZERO=p,a(1)),v=(s.ONE=b,a(1,!0)),M=(s.UONE=v,a(-1)),I=(s.NEG_ONE=M,h(-1,2147483647,!1)),T=(s.MAX_VALUE=I,h(-1,-1,!0)),w=(s.MAX_UNSIGNED_VALUE=T,h(0,-2147483648,!1)),R=(s.MIN_VALUE=w,s.prototype);return R.toInt=function(){return this.unsigned?this.low>>>0:this.low},R.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},R.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";var t,s;if(this.isNegative())return this.eq(w)?(s=g(e),s=(t=this.div(s)).mul(s).sub(this),t.toString(e)+s.toInt().toString(e)):"-"+this.neg().toString(e);for(var i=g(m(e,6),this.unsigned),r=this,n="";;){var o=r.div(i),a=(r.sub(o.mul(i)).toInt()>>>0).toString(e);if((r=o).isZero())return a+n;for(;a.length<6;)a="0"+a;n=""+a+n}},R.getHighBits=function(){return this.high},R.getHighBitsUnsigned=function(){return this.high>>>0},R.getLowBits=function(){return this.low},R.getLowBitsUnsigned=function(){return this.low>>>0},R.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},R.isZero=function(){return 0===this.high&&0===this.low},R.eqz=R.isZero,R.isNegative=function(){return!this.unsigned&&this.high<0},R.isPositive=function(){return this.unsigned||0<=this.high},R.isOdd=function(){return 1==(1&this.low)},R.isEven=function(){return 0==(1&this.low)},R.equals=function(e){return i(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},R.eq=R.equals,R.notEquals=function(e){return!this.eq(e)},R.neq=R.notEquals,R.ne=R.notEquals,R.lessThan=function(e){return this.comp(e)<0},R.lt=R.lessThan,R.lessThanOrEqual=function(e){return this.comp(e)<=0},R.lte=R.lessThanOrEqual,R.le=R.lessThanOrEqual,R.greaterThan=function(e){return 0<this.comp(e)},R.gt=R.greaterThan,R.greaterThanOrEqual=function(e){return 0<=this.comp(e)},R.gte=R.greaterThanOrEqual,R.ge=R.greaterThanOrEqual,R.compare=function(e){var t,s;return i(e)||(e=d(e)),this.eq(e)?0:(t=this.isNegative(),s=e.isNegative(),t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1)},R.comp=R.compare,R.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(b)},R.neg=R.negate,R.add=function(e){i(e)||(e=d(e));var t=this.high>>>16,s=65535&this.high,r=this.low>>>16,n=65535&this.low,o=e.high>>>16,a=65535&e.high,g=e.low>>>16,m=0,u=0,l=0,c=0;return u+=(l=l+((c+=n+(65535&e.low))>>>16)+(r+g))>>>16,h((l&=65535)<<16|(c&=65535),((m+=(u+=s+a)>>>16)+(t+o)&65535)<<16|(u&=65535),this.unsigned)},R.subtract=function(e){return i(e)||(e=d(e)),this.add(e.neg())},R.sub=R.subtract,R.multiply=function(e){var s,r,n,o,a,m,u,l,c,f,b;return this.isZero()?this:(i(e)||(e=d(e)),t?h(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):e.isZero()?this.unsigned?p:y:this.eq(w)?e.isOdd()?w:y:e.eq(w)?this.isOdd()?w:y:this.isNegative()?e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg():e.isNegative()?this.mul(e.neg()).neg():this.lt(_)&&e.lt(_)?g(this.toNumber()*e.toNumber(),this.unsigned):(s=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,a=e.high>>>16,m=65535&e.high,u=e.low>>>16,b=(b=f=c=l=0)+((c=c+((f+=o*(e=65535&e.low))>>>16)+n*e)>>>16)+((c=(65535&c)+o*u)>>>16),h((c&=65535)<<16|(f&=65535),(l=(l=(l+=(b+=r*e)>>>16)+((b=(65535&b)+n*u)>>>16)+((b=(65535&b)+o*m)>>>16))+(s*e+r*u+n*m+o*a)&65535)<<16|(b&=65535),this.unsigned)))},R.mul=R.multiply,R.divide=function(e){if((e=i(e)?e:d(e)).isZero())throw Error("division by zero");var s,r,n;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?h((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?p:y;if(this.unsigned){if((e=e.unsigned?e:e.toUnsigned()).gt(this))return p;if(e.gt(this.shru(1)))return v;r=p}else{if(this.eq(w))return e.eq(b)||e.eq(M)?w:e.eq(w)?b:(n=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:M:(s=this.sub(e.mul(n)),n.add(s.div(e)));if(e.eq(w))return this.unsigned?p:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=y}for(s=this;s.gte(e);){n=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),a=o<=48?1:m(2,o-48),u=g(n),l=u.mul(e);l.isNegative()||l.gt(s);)l=(u=g(n-=a,this.unsigned)).mul(e);u.isZero()&&(u=b),r=r.add(u),s=s.sub(l)}return r},R.div=R.divide,R.modulo=function(e){return i(e)||(e=d(e)),t?h((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},R.mod=R.modulo,R.rem=R.modulo,R.not=function(){return h(~this.low,~this.high,this.unsigned)},R.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},R.clz=R.countLeadingZeros,R.countTrailingZeros=function(){return this.low?r(this.low):r(this.high)+32},R.ctz=R.countTrailingZeros,R.and=function(e){return i(e)||(e=d(e)),h(this.low&e.low,this.high&e.high,this.unsigned)},R.or=function(e){return i(e)||(e=d(e)),h(this.low|e.low,this.high|e.high,this.unsigned)},R.xor=function(e){return i(e)||(e=d(e)),h(this.low^e.low,this.high^e.high,this.unsigned)},R.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?h(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):h(0,this.low<<e-32,this.unsigned)},R.shl=R.shiftLeft,R.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?h(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):h(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},R.shr=R.shiftRight,R.shiftRightUnsigned=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?h(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):h(32===e?this.high:this.high>>>e-32,0,this.unsigned)},R.shru=R.shiftRightUnsigned,R.shr_u=R.shiftRightUnsigned,R.rotateLeft=function(e){var t;return i(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?h(this.high,this.low,this.unsigned):e<32?h(this.low<<e|this.high>>>(t=32-e),this.high<<e|this.low>>>t,this.unsigned):h(this.high<<(e-=32)|this.low>>>(t=32-e),this.low<<e|this.high>>>t,this.unsigned)},R.rotl=R.rotateLeft,R.rotateRight=function(e){var t;return i(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?h(this.high,this.low,this.unsigned):e<32?h(this.high<<(t=32-e)|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned):h(this.low<<(t=32-(e-=32))|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)},R.rotr=R.rotateRight,R.toSigned=function(){return this.unsigned?h(this.low,this.high,!1):this},R.toUnsigned=function(){return this.unsigned?this:h(this.low,this.high,!0)},R.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},R.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},R.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},s.fromBytes=function(e,t,i){return i?s.fromBytesLE(e,t):s.fromBytesBE(e,t)},s.fromBytesLE=function(e,t){return new s(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},s.fromBytesBE=function(e,t){return new s(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},e.default=s,"default"in e?e.default:e}({});void 0!==(t=function(){return i}.apply(t,[]))&&(e.exports=t)},20:function(e,t,s){"use strict";function i(e){return e}function r(e){return e}function n(e){return e}s.r(t);var o,a="zm.scc",g="zm.sbcm",h="zm.srlm",m="zm.sbrm",u="zm.msg.sdr",d="zm.msg.rlr",l="zm.msg.rps",c="zm.msg.srm",f="zm.msg.scm",_="zm.msg.sbm",y="zm.msg.bps",p="zm.msg.slm",b="zm.sv.ps",v={code:1100001,msg:"input parm error."},M={code:1100002,msg:"network timeout."},I={code:1000002,msg:"not login"},T={code:1009001,msg:"message content is empty"},w={code:1009010,msg:"failed to send message"},R={code:1002014,msg:"room not exist"},N={code:1002099,msg:"room inner error"},q={code:1109001,msg:"frequency limited."},O={INPUT_PARAM:v,IM_CONTENT_NULL:T,IM_CONTENT_TOO_LONG:G={code:1009002,msg:"message content is too long"},ROOM_NOT_EXIST:R},C="/liveroom/send_custom_command",L=r,E={INPUT_PARAM:v,IM_CONTENT_NULL:T,IM_CONTENT_TOO_LONG:G,ROOM_NOT_EXIST:R},P="/liveroom/send_room_message",S=n,B=n,A={INPUT_PARAM:v,IM_CONTENT_NULL:T,IM_CONTENT_TOO_LONG:G,ROOM_NOT_EXIST:R},D=r,x=r,U=v,H={code:1102022,msg:"trans send frequently"},j=R,k=i,z=i,Z=r,W=n,G=((T=o=o||{})[T.I=0]="I",T[T.H=10]="H",T[T.M=100]="M",T[T.L=1e3]="L",s(0)),X=s.n(G),J=(Object.defineProperty(V.prototype,"isUseNetAgent",{get:function(){return this.stateCenter.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"serviceHandler",{get:function(){return this.isUseNetAgent?this.liveRoomHandler:this.service},enumerable:!1,configurable:!0}),V.prototype.loginRsp=function(e){var t,s=this;if(null!=e.body.ret_timestamp&&"string"==typeof e.body.ret_timestamp&&(t=parseFloat(e.body.ret_timestamp),this.serverTimeOffset=0==t?0:e.body.ret_timestamp-(new Date).getTime()),e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.datiTimeWindow=e.body.dati_time_window),e.body.trans_seqs)for(var i=0;i<e.body.trans_seqs.length;i++){var r=e.body.trans_seqs[i].trans_channel,n=e.body.trans_seqs[i].trans_seq_list||e.body.trans_seqs[i].trans_seq_array;0<(n=(n=n.filter((function(e){var t=e.trans_type;e=e.trans_seq;return!s.transSeqMap[t]||s.transSeqMap[t].seq<e}))).map((function(e){return{trans_type:e.trans_type,trans_local_seq:e.trans_seq}}))).length&&this.fetchReliableMessage(r,n)}},V.prototype.sendReliableMessage=function(e,t,s,i){var r,n=this;this.logger.info(u+" call"),this.room.isLogin()?this.isReliable?(this.logger.error(u+" send too often"),i(H)):(this.transSeqMap[e]||(this.transSeqMap[e]={seq:0}),r={trans_type:e,trans_data:t,trans_local_seq:this.transSeqMap[e].seq,trans_channel:"clt"},this.isReliable=!0,this.serviceHandler.sendReliableMessage(r,(function(i){n.transSeqMap[e].seq=i.body.trans_seq,n.logger.info(u+" trans "+e+" seq "+i.body.trans_seq),n.isReliable=!1,n.roomExtraInfo[e]={key:e,value:t,updateUser:{userID:n.room.userID,userName:n.room.userName},updateTime:Date.now()},s({seq:i.header.seq,errorCode:0})}),(function(e){var t=N;e.body&&e.body.err_code?(t=n.rtm.getServerError(e.body.err_code),n.logger.error(c+"  "+t.msg)):t=e,n.isReliable=!1,i(t)}),this.room)):(this.logger.error(u+" state error"),i&&i(I))},V.prototype.fetchReliableMessage=function(e,t){function s(e){i.handleFetchTransRsp(e,r)}var i=this,r=(e={trans_channel:e,fetch_array:t},this.stateCenter.reporter.createSpan(o.H,{key:"/sdk/login",par:this.room.roomID},{key:""},"/liveroom/get_room_extrainfo"));r.setAttributes({fetch_array:k(t)}),this.serviceHandler.fetchReliableMessage(e,s,s,this.room),this.logger.info("zm.msg.frm call success")},V.prototype.handleFetchTransRsp=function(e,t){if(e.body&&0!=e.body.err_code)this.logger.error(d+" trans send error "+e.body.err_code),this.stateCenter.tracer.setError(t,{code:e.body.err_code});else if(e.header&&e.body){var s=e.body.trans_list||e.body.trans_fetch_results,i=[],r=[];if(Array.isArray(s)&&0<s.length){for(var n=0;n<s.length;n++){var o,a,g=s[n];1000001109===g.err_code?this.logger.warn(d+" fetch trans unknown type "+g.err_code):(o=g.trans_type,a=g.trans_seq,r.push({trans_type:o,trans_seq:a}),1000001110===g.err_code?(this.logger.warn(d+" fetch trans seq is wrong "+g.err_code),this.transSeqMap[o]={seq:a}):!this.transSeqMap[o]||this.transSeqMap[o].seq<a?(this.transSeqMap[o]={seq:a},i.push(g)):this.logger.warn(d+" fetch trans seq wrong"))}this.roomExtraInfo={},0<i.length&&this.onRecvReliableMessage(i)}t.setAttributes({result_array:z(r)}),t.end()}else this.logger.error(d+" trans send error "+e),this.stateCenter.tracer.setError(t,M)},V.prototype.handlePushTransMsg=function(e){var t,s=e.body.trans_type,i=e.body.trans_seq;!this.transSeqMap[s]||this.transSeqMap[s].seq<i?(this.transSeqMap[s]={seq:i},this.onRecvReliableMessage([e.body],(null==(t=null==e?void 0:e.body)?void 0:t.trans_idname)===this.stateCenter.idName||(null==(t=null==e?void 0:e.body)?void 0:t.id_name)===this.stateCenter.idName)):this.logger.warn(l+" trans seq wrong"),this.logger.info(l+" trans "+s+" seq "+i)},V.prototype.sendRoomMsg=function(e,t,s,i,r,n){var o=this;if(!this.room.isLogin())return this.logger.error(c+" state error"),n(I),!1;var a=Date.parse(new Date+"");return 0<this.sendRoomMsgTime&&this.sendRoomMsgTime+this.sendRoomMsgInterval>a?(this.logger.info(c+" freq error"),n&&n(q,0,e,i),!1):(this.sendRoomMsgTime=a,a=this.serviceHandler.sendRoomMsg({msg_category:e,msg_type:1,msg_priority:1,msg_content:i},(function(e){r({seq:e.header.seq,errorCode:0,messageID:e.body.msg_id})}),(function(e){var t,s,i=N;e.header&&e.body?(s=(t=[o.rtm.getServerError(e.body.err_code),e.body.msg_id])[1],o.logger.error(c+"  "+(i=t[0]).msg),n({seq:e.header.seq,errorCode:(i=i==M?w:i).code,messageID:s})):(e.code&&e.msg&&(i=e),n({seq:0,errorCode:i.code,messageID:0}))}),this.room),this.stateCenter.reporter.spanSetAttributes({key:P,par:null==(e=this.room)?void 0:e.roomID},{send_seq:S(a)}),this.logger.info(c+"  call success"),!0)},V.prototype.handlePushRoomMsg=function(e){var t,s=[];this.isUseNetAgent?(t=e.body.msg_list,e.body.msg_list.forEach((function(e){e={fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time.toNumber(),messageID:e.msg_id.toNumber()},s.push(e)})),e.body.server_msg_id=e.body.server_msg_id.toNumber(),e.body.ret_msg_id=e.body.ret_msg_id.toNumber()):(t=e.body.chat_data,e.body.chat_data.forEach((function(e){e={fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id},s.push(e)}))),this.stateCenter.actionListener("IMRecvBroadcastMessage",this.room.roomID,s),this.stateCenter.actionListener("_recvRoomMsg",t,e.body.server_msg_id,e.body.ret_msg_id)},V.prototype.sendCustomCommand=function(e,t,s,i){var r,n=this;return this.room.isLogin()?(t={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||"",room_id:this.room.roomID},this.stateCenter.reporter.spanSetAttributes({key:C,par:null==(r=this.room)?void 0:r.roomID},{request_id:L(t.request_id)}),r={dest_id_name:e,custom_msg:JSON.stringify(t)},this.serviceHandler.sendCustomCommand(r,(function(e){s({seq:e.header.seq,errorCode:0})}),(function(e){var t,s=n.rtm.getServerError(e.body.err_code);n.logger.error(f+" "+s.msg),t=2===(null==(t=e.body)?void 0:t.err_code)||1000000002===(null==(t=e.body)?void 0:t.err_code)?v:s==M?w:s,i({seq:e.header.seq,errorCode:t.code,code:t.code})}),this.room),this.logger.info(f+" call success"),!0):(this.logger.error(f+" state error"),i(I),!1)},V.prototype.handlePushCustomMsg=function(e){e=[(e=JSON.parse(e.body.custommsg)).from_userid,e.from_username,e.room_id,e.custom_content],this.stateCenter.actionListener("IMRecvCustomCommand",e[2],{userID:e[0],userName:e[1]},e[3])},V.prototype.sendBigRoomMessage=function(e,t,s,i,r,n){var o,a,g,h,m=this;this.room.isLogin()?(o=this.bigimTimeWindow,a=this.serverTimeOffset,g=(new Date).getTime()+a,h=this.rtm.getSeq().toString(),this.bigImCallbackMap[h]={success:r,error:n},0==o?this.sendBigRoomMessageInternal([{msg_category:e,msg_type:1,msg_content:i,bigmsg_client_id:h}],(function(e){m.handleBigImMsgRsp(e)}),(function(e){n&&n(e)})):(r=Math.floor(g/o),this.bigImLastTimeIndex<r&&0==this.bigIMmessageList.length?(this.bigImLastTimeIndex=r,this.sendBigRoomMessageInternal([{msg_category:e,msg_type:1,msg_content:i,bigmsg_client_id:h}],(function(e){m.handleBigImMsgRsp(e)}),(function(e){n&&n(e)}))):(this.bigIMmessageList.push({msg_category:e,msg_type:1,msg_content:i,bigmsg_client_id:h}),1==this.bigIMmessageList.length&&this.setBigImTimer(a,o)))):(this.logger.error(_+" state error"),n&&n(I))},V.prototype.sendBigRoomMessageInternal=function(e,t,s){this.serviceHandler.sendBigRoomMessage({msgs:e},(function(e){t(e)}),(function(e){var t=N;e.header&&e.body||(e.code&&e.msg&&(t=e),s(t)),s(t)}),this.room),this.logger.info(_+" sendBigRoomMessage called")},V.prototype.handleBigImMsgRsp=function(e){this.bigimTimeWindow=e.body.bigim_time_window;for(var t=e.body.msg_list||e.body.msgs,s=0;s<t.length;s++){var i,r=t[s].msg_client_id||t[s].bigmsg_client_id,n=t[s].msg_id||t[s].bigmsg_id;this.bigImCallbackMap[r]&&(null!=(i=this.bigImCallbackMap[r].success)&&i({seq:e.header.seq,errorCode:0,messageID:n}),delete this.bigImCallbackMap[r])}},V.prototype.setBigImTimer=function(e,t){var s=this;e=t-((new Date).getTime()+e)%t,t=this.rtm.generateRandumNumber(t)+e;this.bigImTimer=setTimeout((function(){s.onBigImTimer()}),t)},V.prototype.onBigImTimer=function(){for(var e=this,t=(new Date).getTime()+this.serverTimeOffset,s=(this.bigImLastTimeIndex=Math.floor(t/this.bigimTimeWindow),[]),i=[],r=0;r<this.bigIMmessageList.length&&!(20<=r);r++){var n=this.bigIMmessageList[r];s.push({msg_category:n.msg_category,msg_type:n.msg_type,msg_content:n.msg_content,bigmsg_client_id:n.bigmsg_client_id}),i.push(n.bigmsg_client_id)}20<this.bigIMmessageList.length?this.bigIMmessageList.splice(0,20):this.bigIMmessageList=[],this.sendBigRoomMessageInternal(s,(function(t){e.handleBigImMsgRsp(t)}),(function(t,s){for(var r=0;r<i.length;r++){var n=i[r],o=e.bigImCallbackMap[n];o&&(null!=o.error&&o.error(t,s),delete e.bigImCallbackMap[n])}})),this.bigImTimer&&clearTimeout(this.bigImTimer),this.bigImTimer=null,0<this.bigIMmessageList.length&&this.setBigImTimer(this.serverTimeOffset,this.bigimTimeWindow)},V.prototype.handlePushMergeMsg=function(e){for(var t=e.body.message_list||e.body.messages,s=0;s<t.length;s++)14001===t[s].sub_cmd&&this.handlePushBigRooMsg(t[s].msg_body)},V.prototype.handlePushBigRooMsg=function(e){var t;if("string"==typeof e)try{t=JSON.parse(e)}catch(e){return void this.logger.warn(y+"parse json error")}else t=e;if(t){e=t.room_id||this.room.roomID;for(var s=[],i=t.msg_list||t.msg_data,r=0;r<i.length;r++){var n=i[r];n.id_name==this.stateCenter.idName?this.logger.info(y+" self message"):s.push({idName:n.id_name,nickName:n.nick_name,messageId:n.msg_id||n.bigmsg_id,category:n.msg_category,type:n.msg_type,content:n.msg_content,time:n.send_time||X.a.isLong(n.msg_timestamp)&&n.msg_timestamp.toNumber()})}0==s.length?this.logger.info(y+" no other pushData except self"):this.onRecvBigRoomMessage(s,e),this.logger.info(y+"call success")}else this.logger.warn(y+" cann't find message body")},V.prototype.onRecvBigRoomMessage=function(e,t){var s=[];e.forEach((function(e){e={fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId},s.push(e)})),this.stateCenter.actionListener("IMRecvBarrageMessage",t,s),this.stateCenter.actionListener("_recvBigRoomMessage",e,t)},V.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this.relayTimer&&(clearTimeout(this.relayTimer),this.relayTimer=null),this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer&&(clearTimeout(this.bigImTimer),this.bigImTimer=null),this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0},V.prototype.sendRelayMessage=function(e,t,s,i){var r=this.datiTimeWindow,n=this.serverTimeOffset;0<r?(this.realyMessageList.push({type:e,data:t,success:s,error:i}),1==this.realyMessageList.length&&this.setRelayTimer(n,r)):this.sendRelayMessageInternal(e,t,s,i)},V.prototype.sendRelayMessageInternal=function(e,t,s,i){var r=this;this.logger.info(p+" call"),e={relay_type:e,relay_data:t},t=this.room;this.serviceHandler.sendRelayMessage(e,(function(e){s&&s(e.header.seq,e.body.relay_result)}),(function(e){var t=N;e.header&&e.body?i&&i(r.rtm.getServerError(e.body.err_code),e.header.seq):(e.code&&e.msg&&(t=e),i&&i(t,0))}),t)},V.prototype.setRelayTimer=function(e,t){var s=this;e=(new Date).getTime()+e,e=this.rtm.generateRandumNumber(2*t-e%t);this.logger.info(p+" setTimer "+e),this.relayTimer=setTimeout((function(){s.onRelayTimer()}),e)},V.prototype.onRelayTimer=function(){var e;0==this.realyMessageList.length?this.logger.info(p+"  no relay data"):(e=this.realyMessageList[0],this.sendRelayMessageInternal(e.type,e.data,e.success,e.error),this.relayTimer&&clearTimeout(this.relayTimer),this.relayTimer=null,this.realyMessageList.splice(0,1),0<this.realyMessageList.length&&this.setRelayTimer(this.serverTimeOffset,this.datiTimeWindow))},V);function V(e,t,s,i,r,n,o){var a=this;this.logger=e,this.stateCenter=t,this.dataReport=s,this.service=i,this.liveRoomHandler=r,this.rtm=n,this.room=o,this.sendRoomMsgTime=0,this.sendRoomMsgInterval=500,this.bigImCallbackMap={},this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImTimer=null,this.relayTimer=null,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.isReliable=!1,this.transSeqMap={},this.roomExtraInfo={},this.onRecvReliableMessage=function(e,t){void 0===t&&(t=!1);var s=e.map((function(e){var t={key:e.trans_type,value:e.trans_data,updateUser:{userID:e.id_name||e.trans_idname,userName:e.nick_name||e.trans_nickname},updateTime:X.a.isLong(e.trans_send_time)?e.trans_send_time.toNumber():e.trans_send_time};return a.roomExtraInfo[e.trans_type]=t}));t?a.logger.warn(l+" id name same"):(0<s.length&&a.stateCenter.actionListener("roomExtraInfoUpdate",a.room.roomID,Object.values(a.roomExtraInfo)),e.forEach((function(e){a.stateCenter.actionListener("recvReliableMessage",e.trans_type,e.trans_seq,e.trans_data)})))},this.realyMessageList=[]}function F(e,t,s,i){var r=this;return void 0===s&&(s=1),void 0===i&&(i=1),new Promise((function(n,o){var a,h=r.getMsgSpan(P,e,!0),m=(o=r.stateCenter.proxyRes(h,(function(e){h.setAttributes({msg_id:B(e.messageID)}),n(e)}),o)).interResolve;o=o.interReject;"string"!=typeof e||""==e?(r.logger.error(g+" roomid must be string and not empty"),o(A.INPUT_PARAM," param roomID error")):void 0===t||""==t?(r.logger.error(g+" message is empty"),o(A.IM_CONTENT_NULL)):"string"!=typeof t?(r.logger.error(g+" message must be string"),o(A.INPUT_PARAM," param message error")):1024<t.length?(r.logger.error(g+" message too long"),o(A.IM_CONTENT_TOO_LONG)):(a=r.getRoomModules(e),h.setAttributes({send_seq:S(),msg_content:t}),a?a.messageHandler.sendRoomMsg(s,i,e,t,(function(e){e.messageID&&h.setAttributes({msg_id:e.messageID}),m(e)}),o):o(A.ROOM_NOT_EXIST))}))}function K(e,t,s){var i=this;return new Promise((function(r,n){var o,g,h=i.getMsgSpan(C,e,!0);n=(r=i.stateCenter.proxyRes(h,r,n)).interResolve,r=r.interReject;"string"!=typeof e||""==e?(i.logger.error(a+" roomid must be string and not empty"),r(v," param roomID error")):s instanceof Array&&!s.find((function(e){return"string"!=typeof e}))?"string"!=typeof t&&"object"!=typeof t?(i.logger.error(a+" custom content must be a non empty string or object"),r(E.INPUT_PARAM," param command error")):"string"==typeof t&&1024<t.length?(i.logger.error(a+" command too long"),r(E.IM_CONTENT_TOO_LONG)):(o=i.getRoomModules(e),g="string"==typeof t?t:JSON.stringify(t),h.setAttributes({msg_content:g}),o?o.messageHandler.sendCustomCommand(s,t,n,r):r(E.ROOM_NOT_EXIST)):(i.logger.error(a+" dstMembers must be string array"),r(E.INPUT_PARAM," param toUserList error"))}))}function Q(e,t,s,i){var r=this;return void 0===s&&(s=1),void 0===i&&(i=1),new Promise((function(n,o){var a=r.getMsgSpan("/liveroom/send_big_room_message",e);o=(n=r.stateCenter.proxyRes(a,n,o)).interResolve,n=n.interReject;"string"!=typeof e||""==e?(r.logger.error(m+" roomid must be string and not empty"),n(O.INPUT_PARAM," param roomID error")):void 0===t||""==t?(r.logger.error(m+" message is empty"),n(O.IM_CONTENT_NULL)):"string"!=typeof t?(r.logger.error(m+" message must be string"),n(O.INPUT_PARAM," param message error")):1024<t.length?(r.logger.error(m+" message too long"),n(O.IM_CONTENT_TOO_LONG)):(a.setAttributes({msg_content:t}),(a=r.getRoomModules(e))?a.messageHandler.sendBigRoomMessage(s,i,e,t,o,n):n(O.ROOM_NOT_EXIST))}))}function Y(e,t,s){var i=this;return new Promise((function(r,n){var o=i.getMsgSpan("/liveroom/set_room_extrainfo",e),a=(r=i.stateCenter.proxyRes(o,r,(function(e){i.stateCenter.useNetAgent&&1015===e.errorCode&&(e.errorCode=1002017),n(e)}))).interResolve;r=r.interReject;"string"!=typeof e||""==e?(i.logger.error(g+" roomid must be string and not empty"),r(A.INPUT_PARAM," param roomID error")):t&&"string"==typeof t?128<t.length?(i.logger.error(h+" type is too long"),r({errorCode:U.code})):s&&"string"==typeof s?4096<s.length?(i.logger.error(h+" type is too long"),r({errorCode:U.code})):(o.setAttributes({key:D(t),value:x(s)}),(o=i.getRoomModules(e))?o.messageHandler.sendReliableMessage(t,s,a,r):r(j)):(i.logger.error(h+" data must be string"),r({errorCode:U.code})):(i.logger.error(h+" type must be string"),r({errorCode:U.code}))}))}var $={_sendBroadcastMessage:F,sendBroadcastMessage:function(e,t){var s=this;return new Promise((function(i,r){F.call(s,e,t).then((function(e){i({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){r(e)}))}))},_sendCustomCommand:K,sendCustomCommand:function(e,t,s){var i=this;return new Promise((function(r,n){K.call(i,e,t,s).then((function(e){r({errorCode:e.errorCode,extendedData:e.extendedData})})).catch((function(e){n(e)}))}))},_sendBarrageMessage:Q,sendBarrageMessage:function(e,t){var s=this;return new Promise((function(i,r){Q.call(s,e,t).then((function(e){i({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){r(e)}))}))},_setRoomExtraInfo:Y,setRoomExtraInfo:function(e,t,s){return Y.call(this,e,t,s)},sendRelayMessage:function(e,t,s,i,r){(r=this.getRoomModules(r)||this.stateCenter.roomModulesList[0])?r.messageHandler.sendRelayMessage(e,t,s,i):i&&i(R,0)}},ee={handlePushRoomMsg:function(e){var t=(e=this.handlePushMsg(e))[0];e=e[1];t.messageHandler.handlePushRoomMsg(e)},handlePushCustomMsg:function(e){var t=(e=this.handlePushMsg(e))[0];e=e[1];t.messageHandler.handlePushCustomMsg(e)},handlePushMergeMsg:function(e){var t=null==(t=null==e?void 0:e.header)?void 0:t.room_id;(t=this.rtm.getRoomModules(t))?t.messageHandler.handlePushMergeMsg(e):this.logger.error(b+" room no found ignore "+JSON.stringify(e))},handlePushTransMsg:function(e){var t,s=(i=this.handlePushMsg(e))[0],i=i[1],r=null==(r=null==e?void 0:e.header)?void 0:r.room_id;(r=this.rtm.getMsgSpan("/liveroom/recv_room_extrainfo",r)).setAttributes({trans_type:Z(null==(t=null==e?void 0:e.body)?void 0:t.trans_type),trans_seq:W(null==(t=null==e?void 0:e.body)?void 0:t.trans_seq)}),r.end(),s.messageHandler.handlePushTransMsg(i)},handleBigImMsgRsp:function(e){var t=null==(t=null==e?void 0:e.header)?void 0:t.room_id;(t=this.rtm.getRoomModules(t))?t.messageHandler.handleBigImMsgRsp(e):this.logger.error(b+" room no found ignore "+JSON.stringify(e))},handlePushMsg:function(e){var t=null==(t=null==e?void 0:e.header)?void 0:t.room_id;if(t=this.rtm.getRoomModules(t))return[t,e];this.logger.error(b+" room no found ignore "+JSON.stringify(e))}},te={initMessageHandler:function(){this.messageHandler=new J(this.logger,this.stateCenter,this.dataReport,this.service,this.liveRoomHandler,this.rtm,this)}};t.default={type:"message",install:function(e,t,s,i){for(var r in $)Object.defineProperty(e.prototype,r,{value:$[r],writable:!1});for(var r in ee)Object.defineProperty(s.prototype,r,{value:ee[r],writable:!1}),Object.defineProperty(i.prototype,r,{value:ee[r],writable:!1});for(var r in te)Object.defineProperty(t.prototype,r,{value:te[r],writable:!1})}}}},s={},e.m=t,e.c=s,e.d=function(t,s,i){e.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:i})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,s){if(1&s&&(t=e(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var r in t)e.d(i,r,function(e){return t[e]}.bind(null,r));return i},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=20);function e(i){var r;return(s[i]||(r=s[i]={i:i,l:!1,exports:{}},t[i].call(r.exports,r,r.exports,e),r.l=!0,r)).exports}var t,s}));