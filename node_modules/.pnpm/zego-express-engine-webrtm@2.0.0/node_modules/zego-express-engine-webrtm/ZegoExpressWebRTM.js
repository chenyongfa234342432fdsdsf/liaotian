!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("protobufjs/minimal"),require("localforage"));else if("function"==typeof define&&define.amd)define(["protobufjs/minimal","localforage"],t);else{var n,r="object"==typeof exports?t(require("protobufjs/minimal"),require("localforage")):t(e["protobufjs/minimal"],e.localforage);for(n in r)("object"==typeof exports?exports:e)[n]=r[n]}}("undefined"!=typeof self?self:this,(function(e,t){return r=[function(e,t,n){var r=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var o={},s={};function a(e,t){var n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=s[e])?r:(n=c(e,0,!0),i&&(s[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=o[e])?r:(n=c(e,e<0?-1:0,!1),i&&(o[e]=n),n)}function u(e,t){if(isNaN(e))return t?v:m;if(t){if(e<0)return v;if(p<=e)return T}else{if(e<=-g)return C;if(g<=e+1)return b}return e<0?u(-e,t).neg():c(e%f|0,e/f|0,t)}function c(e,t,r){return new n(e,t,r)}n.fromInt=a,n.fromNumber=u,n.fromBits=c;var l=Math.pow;function h(e,t,n){if(0===e.length)throw Error("empty string");if(t="number"==typeof t?(n=t,!1):!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:m;if((n=n||10)<2||36<n)throw RangeError("radix");var r;if(0<(r=e.indexOf("-")))throw Error("interior hyphen");if(0===r)return h(e.substring(1),t,n).neg();for(var i=u(l(n,8)),o=m,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+a),n);o=(a<8?(a=u(l(n,a)),o.mul(a)):o=o.mul(i)).add(u(c))}return o.unsigned=t,o}function d(e,t){return"number"==typeof e?u(e,t):"string"==typeof e?h(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=h,n.fromValue=d;var f=4294967296,p=f*f,g=p/2,_=a(1<<24),m=a(0),v=(n.ZERO=m,a(0,!0)),y=(n.UZERO=v,a(1)),S=(n.ONE=y,a(1,!0)),E=(n.UONE=S,a(-1)),b=(n.NEG_ONE=E,c(-1,2147483647,!1)),T=(n.MAX_VALUE=b,c(-1,-1,!0)),C=(n.MAX_UNSIGNED_VALUE=T,c(0,-2147483648,!1)),w=(n.MIN_VALUE=C,n.prototype);return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},w.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";var t,n;if(this.isNegative())return this.eq(C)?(n=u(e),n=(t=this.div(n)).mul(n).sub(this),t.toString(e)+n.toInt().toString(e)):"-"+this.neg().toString(e);for(var r=u(l(e,6),this.unsigned),i=this,o="";;){var s=i.div(r),a=(i.sub(s.mul(r)).toInt()>>>0).toString(e);if((i=s).isZero())return a+o;for(;a.length<6;)a="0"+a;o=""+a+o}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(C)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},w.isZero=function(){return 0===this.high&&0===this.low},w.eqz=w.isZero,w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||0<=this.high},w.isOdd=function(){return 1==(1&this.low)},w.isEven=function(){return 0==(1&this.low)},w.equals=function(e){return r(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},w.eq=w.equals,w.notEquals=function(e){return!this.eq(e)},w.neq=w.notEquals,w.ne=w.notEquals,w.lessThan=function(e){return this.comp(e)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(e){return this.comp(e)<=0},w.lte=w.lessThanOrEqual,w.le=w.lessThanOrEqual,w.greaterThan=function(e){return 0<this.comp(e)},w.gt=w.greaterThan,w.greaterThanOrEqual=function(e){return 0<=this.comp(e)},w.gte=w.greaterThanOrEqual,w.ge=w.greaterThanOrEqual,w.compare=function(e){var t,n;return r(e)||(e=d(e)),this.eq(e)?0:(t=this.isNegative(),n=e.isNegative(),t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1)},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(C)?C:this.not().add(y)},w.neg=w.negate,w.add=function(e){r(e)||(e=d(e));var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,a=65535&e.high,u=e.low>>>16,l=0,h=0,f=0,p=0;return h+=(f=f+((p+=o+(65535&e.low))>>>16)+(i+u))>>>16,c((f&=65535)<<16|(p&=65535),((l+=(h+=n+a)>>>16)+(t+s)&65535)<<16|(h&=65535),this.unsigned)},w.subtract=function(e){return r(e)||(e=d(e)),this.add(e.neg())},w.sub=w.subtract,w.multiply=function(e){var n,i,o,s,a,l,h,f,p,g,y;return this.isZero()?this:(r(e)||(e=d(e)),t?c(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):e.isZero()?this.unsigned?v:m:this.eq(C)?e.isOdd()?C:m:e.eq(C)?this.isOdd()?C:m:this.isNegative()?e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg():e.isNegative()?this.mul(e.neg()).neg():this.lt(_)&&e.lt(_)?u(this.toNumber()*e.toNumber(),this.unsigned):(n=this.high>>>16,i=65535&this.high,o=this.low>>>16,s=65535&this.low,a=e.high>>>16,l=65535&e.high,h=e.low>>>16,y=(y=g=p=f=0)+((p=p+((g+=s*(e=65535&e.low))>>>16)+o*e)>>>16)+((p=(65535&p)+s*h)>>>16),c((p&=65535)<<16|(g&=65535),(f=(f=(f+=(y+=i*e)>>>16)+((y=(65535&y)+o*h)>>>16)+((y=(65535&y)+s*l)>>>16))+(n*e+i*h+o*l+s*a)&65535)<<16|(y&=65535),this.unsigned)))},w.mul=w.multiply,w.divide=function(e){if((e=r(e)?e:d(e)).isZero())throw Error("division by zero");var n,i,o;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:m;if(this.unsigned){if((e=e.unsigned?e:e.toUnsigned()).gt(this))return v;if(e.gt(this.shru(1)))return S;i=v}else{if(this.eq(C))return e.eq(y)||e.eq(E)?C:e.eq(C)?y:(o=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?y:E:(n=this.sub(e.mul(o)),o.add(n.div(e)));if(e.eq(C))return this.unsigned?v:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=m}for(n=this;n.gte(e);){o=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(o)/Math.LN2),a=s<=48?1:l(2,s-48),h=u(o),f=h.mul(e);f.isNegative()||f.gt(n);)f=(h=u(o-=a,this.unsigned)).mul(e);h.isZero()&&(h=y),i=i.add(h),n=n.sub(f)}return i},w.div=w.divide,w.modulo=function(e){return r(e)||(e=d(e)),t?c((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},w.mod=w.modulo,w.rem=w.modulo,w.not=function(){return c(~this.low,~this.high,this.unsigned)},w.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},w.clz=w.countLeadingZeros,w.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},w.ctz=w.countTrailingZeros,w.and=function(e){return r(e)||(e=d(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},w.or=function(e){return r(e)||(e=d(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},w.xor=function(e){return r(e)||(e=d(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},w.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):c(32===e?this.high:this.high>>>e-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.shr_u=w.shiftRightUnsigned,w.rotateLeft=function(e){var t;return r(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?c(this.high,this.low,this.unsigned):e<32?c(this.low<<e|this.high>>>(t=32-e),this.high<<e|this.low>>>t,this.unsigned):c(this.high<<(e-=32)|this.low>>>(t=32-e),this.low<<e|this.high>>>t,this.unsigned)},w.rotl=w.rotateLeft,w.rotateRight=function(e){var t;return r(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?c(this.high,this.low,this.unsigned):e<32?c(this.high<<(t=32-e)|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned):c(this.low<<(t=32-(e-=32))|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)},w.rotr=w.rotateRight,w.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},w.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},w.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},e.default=n,"default"in e?e.default:e}({});void 0!==(t=function(){return r}.apply(t,[]))&&(e.exports=t)},function(e,t,n){(function(t){var r;e.exports=(r=function(e){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),!(r=!(r=!(r="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:r)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:r)&&void 0!==t&&t.crypto?t.crypto:r))try{r=n(14)}catch(s){}var i=Object.create||function(e){return o.prototype=e,e=new o,o.prototype=null,e};function o(){}var s={},a=s.lib={},u=a.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new c.init(t,e)}}),l=s.enc={},h=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},d=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},f=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},p=a.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,o=r.sigBytes,s=this.blockSize,a=o/(4*s),u=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s;t=e.min(4*u,o);if(u){for(var l=0;l<u;l+=s)this._doProcessBlock(i,l);n=i.splice(0,u),r.sigBytes-=t}return new c.init(n,t)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(a.Hasher=p.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new g.HMAC.init(e,n).finalize(t)}}}),s.algo={});return s}(Math),r)}).call(this,n(13))},function(t,n){t.exports=e},function(e,t,n){function r(e){var t;return(o[e]||(t=o[e]={i:e,l:!1,exports:{}},i[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}var i,o;e.exports=(i=[function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){var n,r;e=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return(n=setTimeout)(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}var a,u=[],c=!1,l=-1;function h(){c&&a&&(c=!1,a.length?u=a.concat(u):l=-1,u.length)&&d()}function d(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(a=u,u=[];++l<t;)a&&a[l].run();l=-1,t=u.length}a=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return(r=clearTimeout)(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||c||s(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=p,e.addListener=p,e.once=p,e.off=p,e.removeListener=p,e.removeAllListeners=p,e.emit=p,e.prependListener=p,e.prependOnceListener=p,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t,n){(function(t,n,r,i){e.exports=function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o])throw(a=new Error("Cannot find module '"+o+"'")).code="MODULE_NOT_FOUND",a;var a=n[o]={exports:{}};t[o][0].call(a.exports,(function(e){return i(t[o][1][e]||e)}),a,a.exports,e,t,n,r)}return n[o].exports}for(var o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";var r=e("./utils"),i=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,i,s,a,u,c=[],l=0,h=e.length,d="string"!==r.getTypeOf(e);l<e.length;)u=h-l,i=d?(t=e[l++],n=l<h?e[l++]:0,l<h?e[l++]:0):(t=e.charCodeAt(l++),n=l<h?e.charCodeAt(l++):0,l<h?e.charCodeAt(l++):0),s=(3&t)<<4|n>>4,a=1<u?(15&n)<<2|i>>6:64,u=2<u?63&i:64,c.push(o.charAt(t>>2)+o.charAt(s)+o.charAt(a)+o.charAt(u));return c.join("")},n.decode=function(e){var t,n,r,s,a,u=0,c=0;if("data:"===e.substr(0,5))throw new Error("Invalid base64 input, it looks like a data url.");var l,h=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(e.charAt(e.length-1)===o.charAt(64)&&h--,e.charAt(e.length-2)===o.charAt(64)&&h--,h%1!=0)throw new Error("Invalid base64 input, bad content length.");for(l=new(i.uint8array?Uint8Array:Array)(0|h);u<e.length;)t=o.indexOf(e.charAt(u++))<<2|(s=o.indexOf(e.charAt(u++)))>>4,n=(15&s)<<4|(s=o.indexOf(e.charAt(u++)))>>2,r=(3&s)<<6|(a=o.indexOf(e.charAt(u++))),l[c++]=t,64!==s&&(l[c++]=n),64!==a&&(l[c++]=r);return l}},{"./support":30,"./utils":32}],2:[function(e,t,n){"use strict";var r=e("./external"),i=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),s=e("./stream/DataLengthProbe");function a(e,t,n,r,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=r,this.compressedContent=i}a.prototype={getContentWorker:function(){var e=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,n){return e.pipe(new o).pipe(new s("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new s("compressedSize")).withStreamInfo("compression",t)},t.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){"use strict";var r=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,n){"use strict";var r=e("./utils"),i=function(){for(var e=[],t=0;t<256;t++){for(var n=t,r=0;r<8;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}();t.exports=function(e,t){return void 0!==e&&e.length?("string"!==r.getTypeOf(e)?function(e,t,n){var r=i,o=0+n;e^=-1;for(var s=0;s<o;s++)e=e>>>8^r[255&(e^t[s])];return-1^e}:function(e,t,n){var r=i,o=0+n;e^=-1;for(var s=0;s<o;s++)e=e>>>8^r[255&(e^t.charCodeAt(s))];return-1^e})(0|t,e,e.length):0}},{"./utils":32}],5:[function(e,t,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t,n){"use strict";e="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:e}},{lie:37}],7:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako"),o=e("./utils"),s=e("./stream/GenericWorker"),a=r?"uint8array":"array";function u(e,t){s.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}n.magic="\b\0",o.inherits(u,s),u.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(a,e.data),!1)},u.prototype.flush=function(){s.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},n.compressWorker=function(e){return new u("Deflate",e)},n.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,n){"use strict";function r(e,t){for(var n="",r=0;r<t;r++)n+=String.fromCharCode(255&e),e>>>=8;return n}function i(e,t,n,i,s,l){var h=e.file,d=e.compression,f=l!==a.utf8encode,p=o.transformTo("string",l(h.name)),g=o.transformTo("string",a.utf8encode(h.name)),_=h.comment,m=(l=o.transformTo("string",l(_)),o.transformTo("string",a.utf8encode(_))),v=g.length!==h.name.length,y=(_=m.length!==_.length,""),S=h.dir,E=h.date,b={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(b.crc32=e.crc32,b.compressedSize=e.compressedSize,b.uncompressedSize=e.uncompressedSize),n=0,t&&(n|=8),f||!v&&!_||(n|=2048),e=0,t=0,S&&(e|=16),"UNIX"===s?(t=798,e|=(65535&((f=h.unixPermissions)?f:S?16893:33204))<<16):(t=20,e|=63&(h.dosPermissions||0)),s=E.getUTCHours(),s=(s=((s<<=6)|E.getUTCMinutes())<<5)|E.getUTCSeconds()/2,f=E.getUTCFullYear()-1980,f=(f=((f<<=4)|E.getUTCMonth()+1)<<5)|E.getUTCDate(),v&&(S=r(1,1)+r(u(p),4)+g,y+="up"+r(S.length,2)+S),_&&(h=r(1,1)+r(u(l),4)+m,y+="uc"+r(h.length,2)+h),E="",E=(E=(E=(E=(E=(E=(E=(E=(E=(E+="\n\0")+r(n,2))+d.magic)+r(s,2))+r(f,2))+r(b.crc32,4))+r(b.compressedSize,4))+r(b.uncompressedSize,4))+r(p.length,2))+r(y.length,2);return{fileRecord:c.LOCAL_FILE_HEADER+E+p+y,dirRecord:c.CENTRAL_FILE_HEADER+r(t,2)+E+r(l.length,2)+"\0\0\0\0"+r(e,4)+r(i,4)+p+y+l}}var o=e("../utils"),s=e("../stream/GenericWorker"),a=e("../utf8"),u=e("../crc32"),c=e("../signature");function l(e,t,n,r){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(l,s),l.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,s.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-r-1))/n:100}}))},l.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;t?(e=i(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:e.fileRecord,meta:{percent:0}})):this.accumulate=!0},l.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=i(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:(t=e,c.DATA_DESCRIPTOR+r(t.crc32,4)+r(t.compressedSize,4)+r(t.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},l.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e;n=function(e,t,n,i,s){return s=o.transformTo("string",s(i)),c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(e,2)+r(e,2)+r(t,4)+r(n,4)+r(s.length,2)+s}(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},l.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},l.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},l.prototype.error=function(e){var t=this._sources;if(!s.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},l.prototype.lock=function(){s.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=l},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){"use strict";var r=e("../compressions"),i=e("./ZipFileWorker");n.generateWorker=function(e,t,n){var o=new i(t.streamFiles,n,t.platform,t.encodeFileName),s=0;try{e.forEach((function(e,n){s++;var i=function(e,t){if(t=r[e=e||t])return t;throw new Error(e+" is not a valid compression method !")}(n.options.compression,t.compression),a=n.options.compressionOptions||t.compressionOptions||{},u=n.dir,c=n.date;n._compressWorker(i,a).withStreamInfo("file",{name:e,dir:u,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(o)})),o.entriesCount=s}catch(e){o.error(e)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,n){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e,t=new r;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(e,t){return(new r).loadAsync(e,t)},r.external=e("./external"),t.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,n){"use strict";var r=e("./utils"),i=e("./external"),o=e("./utf8"),s=e("./zipEntries"),a=e("./stream/Crc32Probe"),u=e("./nodejsUtils");t.exports=function(e,t){var n=this;return t=r.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var n=new s(t);return n.load(e),n})).then((function(e){var n=[i.Promise.resolve(e)],r=e.files;if(t.checkCRC32)for(var o=0;o<r.length;o++)n.push(function(e){return new i.Promise((function(t,n){var r=e.decompressed.getContentWorker().pipe(new a);r.on("error",(function(e){n(e)})).on("end",(function(){r.streamInfo.crc32!==e.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}(r[o]));return i.Promise.all(n)})).then((function(e){for(var i=(e=e.shift()).files,o=0;o<i.length;o++){var s=i[o],a=s.fileNameStr,u=r.resolve(s.fileNameStr);n.file(u,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders}),s.dir||(n.file(u).unsafeOriginalName=a)}return e.zipComment.length&&(n.comment=e.zipComment),n}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,n){"use strict";var r=e("../utils"),i=e("../stream/GenericWorker");function o(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}r.inherits(o,i),o.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},o.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,n){"use strict";var r=e("readable-stream").Readable;function i(e,t,n){r.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),n&&n(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}e("../utils").inherits(i,r),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,n,r){"use strict";n.exports={isNode:void 0!==t,newBufferFrom:function(e,n){if(t.from&&t.from!==Uint8Array.from)return t.from(e,n);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new t(e,n)},allocBuffer:function(e){return t.alloc?t.alloc(e):((e=new t(e)).fill(0),e)},isBuffer:function(e){return t.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,n){"use strict";function r(e,t,n){var r=s.getTypeOf(t),o=s.extend(n||{},c);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(e=g(e)),o.createFolders&&(u=function(e){var t=(e="/"===e.slice(-1)?e.substring(0,e.length-1):e).lastIndexOf("/");return 0<t?e.substring(0,t):""}(e))&&i.call(this,u,!0);var u="string"===r&&!1===o.binary&&!1===o.base64;n&&void 0!==n.binary||(o.binary=!u),(t instanceof l&&0===t.uncompressedSize||o.dir||!t||0===t.length)&&(o.base64=!1,o.binary=!0,t="",o.compression="STORE"),r=t instanceof l||t instanceof a?t:f.isNode&&f.isStream(t)?new p(e,t):s.prepareContent(e,t,o.binary,o.optimizedBinaryString,o.base64),n=new h(e,r,o);this.files[e]=n}function i(e,t){return t=void 0!==t?t:c.createFolders,e=g(e),this.files[e]||r.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]}var o=e("./utf8"),s=e("./utils"),a=e("./stream/GenericWorker"),u=e("./stream/StreamHelper"),c=e("./defaults"),l=e("./compressedObject"),h=e("./zipObject"),d=e("./generate"),f=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),g=function(e){return"/"!==e.slice(-1)&&(e+="/"),e};function _(e){return"[object RegExp]"===Object.prototype.toString.call(e)}t.exports={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,r;for(t in this.files)r=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,r)},filter:function(e){var t=[];return this.forEach((function(n,r){e(n,r)&&t.push(r)})),t},file:function(e,t,n){var i;return 1!==arguments.length?(e=this.root+e,r.call(this,e,t,n),this):_(e)?(i=e,this.filter((function(e,t){return!t.dir&&i.test(e)}))):(t=this.files[this.root+e])&&!t.dir?t:null},folder:function(e){var t,n;return e?_(e)?this.filter((function(t,n){return n.dir&&e.test(t)})):(t=this.root+e,t=i.call(this,t),(n=this.clone()).root=t.name,n):this},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter((function(t,n){return n.name.slice(0,e.length)===e})),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t={};try{if((t=s.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=t.type.toLowerCase(),t.compression=t.compression.toUpperCase(),"binarystring"===t.type&&(t.type="string"),!t.type)throw new Error("No output type specified.");s.checkSupport(t.type),"darwin"!==t.platform&&"freebsd"!==t.platform&&"linux"!==t.platform&&"sunos"!==t.platform||(t.platform="UNIX"),"win32"===t.platform&&(t.platform="DOS");var n=t.comment||this.comment||"",r=d.generateWorker(this,t,n)}catch(e){(r=new a("error")).error(e)}return new u(r,t.type||"string",t.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,n){"use strict";t.exports=e("stream")},{stream:void 0}],17:[function(e,t,n){"use strict";var r=e("./DataReader");function i(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(i,r),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),o=this.length-4;0<=o;--o)if(this.data[o]===t&&this.data[o+1]===n&&this.data[o+2]===r&&this.data[o+3]===i)return o-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=(e=e.charCodeAt(3),this.readData(4));return t===i[0]&&n===i[1]&&r===i[2]&&e===i[3]},i.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?[]:(t=this.data.slice(this.zero+this.index,this.zero+this.index+e),this.index+=e,t)},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,n){"use strict";var r=e("../utils");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,n){"use strict";var r=e("./Uint8ArrayReader");function i(e){r.call(this,e)}e("../utils").inherits(i,r),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,n){"use strict";var r=e("./DataReader");function i(e){r.call(this,e)}e("../utils").inherits(i,r),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,n){"use strict";var r=e("./ArrayReader");function i(e){r.call(this,e)}e("../utils").inherits(i,r),i.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?new Uint8Array(0):(t=this.data.subarray(this.zero+this.index,this.zero+this.index+e),this.index+=e,t)},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,n){"use strict";var r=e("../utils"),i=e("../support"),o=e("./ArrayReader"),s=e("./StringReader"),a=e("./NodeBufferReader"),u=e("./Uint8ArrayReader");t.exports=function(e){var t=r.getTypeOf(e);return r.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new a(e):i.uint8array?new u(r.transformTo("uint8array",e)):new o(r.transformTo("array",e)):new s(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,n){"use strict";var r=e("./GenericWorker"),i=e("../utils");function o(e){r.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(o,r),o.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,n){"use strict";var r=e("./GenericWorker"),i=e("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,r),o.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,n){"use strict";var r=e("../utils"),i=e("./GenericWorker");function o(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}r.inherits(o,i),o.prototype.processChunk=function(e){var t;e&&(t=this.streamInfo[this.propName]||0,this.streamInfo[this.propName]=t+e.data.length),i.prototype.processChunk.call(this,e)},t.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,n){"use strict";var r=e("../utils"),i=e("./GenericWorker");function o(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}r.inherits(o,i),o.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished)||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,n){"use strict";function r(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){var e;return!(!this.isPaused||this.isFinished||(e=this.isPaused=!1,this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),e))},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=r},{}],29:[function(e,n,r){"use strict";var i=e("../utils"),o=e("./ConvertWorker"),s=e("./GenericWorker"),a=e("../base64"),u=e("../support"),c=e("../external"),l=null;if(u.nodestream)try{l=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function h(e,t,n){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=t,this._mimeType=n,i.checkSupport(r),this._worker=e.pipe(new o(r)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}h.prototype={accumulate:function(e){return n=this,r=e,new c.Promise((function(e,o){var s=[],u=n._internalType,c=n._outputType,l=n._mimeType;n.on("data",(function(e,t){s.push(e),r&&r(t)})).on("error",(function(e){s=[],o(e)})).on("end",(function(){try{var n=function(e,t,n){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),n);case"base64":return a.encode(t);default:return i.transformTo(e,t)}}(c,function(e,n){for(var r=0,i=null,o=0,s=0;s<n.length;s++)o+=n[s].length;switch(e){case"string":return n.join("");case"array":return Array.prototype.concat.apply([],n);case"uint8array":for(i=new Uint8Array(o),s=0;s<n.length;s++)i.set(n[s],r),r+=n[s].length;return i;case"nodebuffer":return t.concat(n);default:throw new Error("concat : unsupported type '"+e+"'")}}(u,s),l);e(n)}catch(n){o(n)}s=[]})).resume()}));var n,r},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,(function(e){t.call(n,e.data,e.meta)})):this._worker.on(e,(function(){i.delay(t,arguments,n)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},e)}},n.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer=void 0!==t,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(i),r.blob=0===o.getBlob("application/zip").size}catch(e){r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch(e){r.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){"use strict";for(var r=e("./utils"),i=e("./support"),o=e("./nodejsUtils"),s=e("./stream/GenericWorker"),a=new Array(256),u=0;u<256;u++)a[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function c(){s.call(this,"utf-8 decode"),this.leftOver=null}function l(){s.call(this,"utf-8 encode")}a[254]=a[254]=1,n.utf8encode=function(e){if(i.nodebuffer)return o.newBufferFrom(e,"utf-8");for(var t,n,r,s,a=e,u=a.length,c=0,l=0;l<u;l++)55296==(64512&(n=a.charCodeAt(l)))&&l+1<u&&56320==(64512&(r=a.charCodeAt(l+1)))&&(n=65536+(n-55296<<10)+(r-56320),l++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new(i.uint8array?Uint8Array:Array)(c),l=s=0;s<c;l++)55296==(64512&(n=a.charCodeAt(l)))&&l+1<u&&56320==(64512&(r=a.charCodeAt(l+1)))&&(n=65536+(n-55296<<10)+(r-56320),l++),n<128?t[s++]=n:(n<2048?t[s++]=192|n>>>6:(n<65536?t[s++]=224|n>>>12:(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63),t[s++]=128|n>>>6&63),t[s++]=128|63&n);return t},n.utf8decode=function(e){if(i.nodebuffer)return r.transformTo("nodebuffer",e).toString("utf-8");for(var t,n,o,s=e=r.transformTo(i.uint8array?"uint8array":"array",e),u=s.length,c=new Array(2*u),l=t=0;l<u;)if((n=s[l++])<128)c[t++]=n;else if(4<(o=a[n]))c[t++]=65533,l+=o-1;else{for(n&=2===o?31:3===o?15:7;1<o&&l<u;)n=n<<6|63&s[l++],o--;1<o?c[t++]=65533:n<65536?c[t++]=n:(n-=65536,c[t++]=55296|n>>10&1023,c[t++]=56320|1023&n)}return c.length!==t&&(c.subarray?c=c.subarray(0,t):c.length=t),r.applyFromCharCode(c)},r.inherits(c,s),c.prototype.processChunk=function(e){var t=r.transformTo(i.uint8array?"uint8array":"array",e.data),o=(this.leftOver&&this.leftOver.length&&(i.uint8array?(o=t,(t=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),t.set(o,this.leftOver.length)):t=this.leftOver.concat(t),this.leftOver=null),function(e,t){for(var n=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=n&&128==(192&e[n]);)n--;return!(n<0||0===n)&&n+a[e[n]]>t?n:t}(t)),s=t;o!==t.length&&(i.uint8array?(s=t.subarray(0,o),this.leftOver=t.subarray(o,t.length)):(s=t.slice(0,o),this.leftOver=t.slice(o,t.length))),this.push({data:n.utf8decode(s),meta:e.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=c,r.inherits(l,s),l.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=l},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,r){"use strict";var i=e("./support"),o=e("./base64"),s=e("./nodejsUtils"),a=e("./external");function u(e){return e}function c(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}e("setimmediate"),r.newBlob=function(e,t){r.checkSupport("blob");try{return new Blob([e],{type:t})}catch(r){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(e),n.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(e,t,n){var r=[],i=0,o=e.length;if(o<=n)return String.fromCharCode.apply(null,e);for(;i<o;)r.push("array"===t||"nodebuffer"===t?String.fromCharCode.apply(null,e.slice(i,Math.min(i+n,o))):String.fromCharCode.apply(null,e.subarray(i,Math.min(i+n,o)))),i+=n;return r.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(e){return!1}}()}};function h(e){var t=65536,n=r.getTypeOf(e),i=!0;if("uint8array"===n?i=l.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=l.applyCanBeUsed.nodebuffer),i)for(;1<t;)try{return l.stringifyByChunk(e,n,t)}catch(e){t=Math.floor(t/2)}return l.stringifyByChar(e)}function d(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}r.applyFromCharCode=h;var f={};f.string={string:u,array:function(e){return c(e,new Array(e.length))},arraybuffer:function(e){return f.string.uint8array(e).buffer},uint8array:function(e){return c(e,new Uint8Array(e.length))},nodebuffer:function(e){return c(e,s.allocBuffer(e.length))}},f.array={string:h,array:u,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(e)}},f.arraybuffer={string:function(e){return h(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:u,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(new Uint8Array(e))}},f.uint8array={string:h,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:u,nodebuffer:function(e){return s.newBufferFrom(e)}},f.nodebuffer={string:h,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return f.nodebuffer.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:u},r.transformTo=function(e,t){if(t=t||"",!e)return t;r.checkSupport(e);var n=r.getTypeOf(t);return f[n][e](t)},r.resolve=function(e){for(var t=e.split("/"),n=[],r=0;r<t.length;r++){var i=t[r];"."===i||""===i&&0!==r&&r!==t.length-1||(".."===i?n.pop():n.push(i))}return n.join("/")},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":i.nodebuffer&&s.isBuffer(e)?"nodebuffer":i.uint8array&&e instanceof Uint8Array?"uint8array":i.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){if(!i[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){for(var t,n="",r=0;r<(e||"").length;r++)n+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return n},r.delay=function(e,t,r){n((function(){e.apply(r||null,t||[])}))},r.inherits=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},r.extend=function(){for(var e,t={},n=0;n<arguments.length;n++)for(e in arguments[n])Object.prototype.hasOwnProperty.call(arguments[n],e)&&void 0===t[e]&&(t[e]=arguments[n][e]);return t},r.prepareContent=function(e,t,n,s,u){return a.Promise.resolve(t).then((function(e){return i.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise((function(t,n){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=function(e){n(e.target.error)},r.readAsArrayBuffer(e)})):e})).then((function(t){var l=r.getTypeOf(t);return l?("arraybuffer"===l?t=r.transformTo("uint8array",t):"string"===l&&(u?t=o.decode(t):n&&!0!==s&&(t=c(l=t,new(i.uint8array?Uint8Array:Array)(l.length)))),t):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,n){"use strict";var r=e("./reader/readerFor"),i=e("./utils"),o=e("./signature"),s=e("./zipEntry"),a=e("./support");function u(e){this.files=[],this.loadOptions=e}u.prototype={checkSignature:function(e){var t;if(!this.reader.readAndCheckSignature(e))throw this.reader.index-=4,t=this.reader.readString(4),new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e),e=this.reader.readString(4)===t;return this.reader.setIndex(n),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array";t=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(t)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(e=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}if(e=this.centralDirOffset+this.centralDirSize,0<(e=t-(e=this.zip64?e+20+(12+this.zip64EndOfCentralSize):e)))this.isSignature(t,o.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,n){"use strict";var r=e("./reader/readerFor"),i=e("./utils"),o=e("./compressedObject"),s=e("./crc32"),a=e("./utf8"),u=e("./compressions"),c=e("./support");function l(e,t){this.options=e,this.loadOptions=t}l.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t;if(e.skip(22),this.fileNameLength=e.readInt(2),t=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(t),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in u)if(Object.prototype.hasOwnProperty.call(u,t)&&u[t].magic===e)return u[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){var e;this.extraFields[1]&&(e=r(this.extraFields[1].value),this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS)&&(this.diskNumberStart=e.readInt(4))},readExtraFields:function(e){var t,n,r,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),n=e.readInt(2),r=e.readData(n),this.extraFields[t]={id:t,length:n,value:r};e.setIndex(i)},handleUTF8:function(){var e,t=c.uint8array?"uint8array":"array";this.useUTF8()?(this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment)):(null!==(e=this.findExtraFieldUnicodePath())?this.fileNameStr=e:(e=i.transformTo(t,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(e)),null!==(e=this.findExtraFieldUnicodeComment())?this.fileCommentStr=e:(e=i.transformTo(t,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(e)))},findExtraFieldUnicodePath:function(){var e,t=this.extraFields[28789];return t&&1===(e=r(t.value)).readInt(1)&&s(this.fileName)===e.readInt(4)?a.utf8decode(e.readData(t.length-5)):null},findExtraFieldUnicodeComment:function(){var e,t=this.extraFields[25461];return t&&1===(e=r(t.value)).readInt(1)&&s(this.fileComment)===e.readInt(4)?a.utf8decode(e.readData(t.length-5)):null}},t.exports=l},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,n){"use strict";function r(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}}var i=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),s=e("./utf8"),a=e("./compressedObject"),u=e("./stream/GenericWorker");r.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var r="string"===(n=e.toLowerCase())||"text"===n,o=("binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker(),!this._dataBinary);o&&!r&&(t=t.pipe(new s.Utf8EncodeWorker)),!o&&r&&(t=t.pipe(new s.Utf8DecodeWorker))}catch(e){(t=new u("error")).error(e)}return new i(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){var n;return this._data instanceof a&&this._data.compression.magic===e.magic?this._data.getCompressedWorker():(n=this._decompressWorker(),this._dataBinary||(n=n.pipe(new s.Utf8EncodeWorker)),a.createWorkerFrom(n,e,t))},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<c.length;h++)r.prototype[c[h]]=l;t.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){(function(e){"use strict";var n,r,i,o,s=e.MutationObserver||e.WebKitMutationObserver,a=s?(r=0,s=new s(c),i=e.document.createTextNode(""),s.observe(i,{characterData:!0}),function(){i.data=r=++r%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){c(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(c,0)}:((o=new e.MessageChannel).port1.onmessage=c,function(){o.port2.postMessage(0)}),u=[];function c(){var e,t;n=!0;for(var r=u.length;r;){for(t=u,u=[],e=-1;++e<r;)t[e]();r=u.length}n=!1}t.exports=function(e){1!==u.push(e)||n||a()}}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,n){"use strict";var r=e("immediate");function i(){}var o={},s=["REJECTED"],a=["FULFILLED"],u=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(r){return o.reject(e,r)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function i(t){n||(n=!0,o.resolve(e,t))}var s=p((function(){t(i,r)}));"error"===s.status&&r(s.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=c).prototype.finally=function(e){var t;return"function"!=typeof e?this:(t=this.constructor,this.then((function(n){return t.resolve(e()).then((function(){return n}))}),(function(n){return t.resolve(e()).then((function(){throw n}))})))},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){var n;return"function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s?this:(n=new this.constructor(i),this.state!==u?h(n,this.state===a?e:t,this.outcome):this.queue.push(new l(n,e,t)),n)},l.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){o.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(d,t);if("error"===n.status)return o.reject(e,n.value);if(n=n.value)f(e,n);else{e.state=a,e.outcome=t;for(var r=-1,i=e.queue.length;++r<i;)e.queue[r].callFulfilled(t)}return e},o.reject=function(e,t){e.state=s,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:o.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return o.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var s=new Array(n),a=0,u=-1,c=new this(i);++u<n;)!function(e,i){t.resolve(e).then((function(e){s[i]=e,++a!==n||r||(r=!0,o.resolve(c,s))}),(function(e){r||(r=!0,o.reject(c,e))}))}(e[u],u);return c},c.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,n=!1;if(!t)return this.resolve([]);for(var r,s=-1,a=new this(i);++s<t;)r=e[s],this.resolve(r).then((function(e){n||(n=!0,o.resolve(a,e))}),(function(e){n||(n=!0,o.reject(a,e))}));return a}},{immediate:36}],38:[function(e,t,n){"use strict";var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,n){"use strict";var r=e("./zlib/deflate"),i=e("./utils/common"),o=e("./utils/strings"),s=e("./zlib/messages"),a=e("./zlib/zstream"),u=Object.prototype.toString;function c(e){if(!(this instanceof c))return new c(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=((e=this.options).raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0,r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy));if(0!==t)throw new Error(s[t]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){if(e="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(t=r.deflateSetDictionary(this.strm,e)))throw new Error(s[t]);this._dict_set=!0}}function l(e,t){if((t=new c(t)).push(e,!0),t.err)throw t.msg||s[t.err];return t.result}c.prototype.push=function(e,t){var n,s,a=this.strm,c=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=o.string2buf(e):"[object ArrayBuffer]"===u.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new i.Buf8(c),a.next_out=0,a.avail_out=c),1!==(n=r.deflate(a,s))&&0!==n)return this.onEnd(n),!(this.ended=!0)}while(0!==a.avail_out&&(0!==a.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(a.output,a.next_out))):this.onData(i.shrinkBuf(a.output,a.next_out))),(0<a.avail_in||0===a.avail_out)&&1!==n);return 4===s?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==s||(this.onEnd(0),!(a.avail_out=0))},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=c,n.deflate=l,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,l(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,l(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,n){"use strict";var r=e("./zlib/inflate"),i=e("./utils/common"),o=e("./utils/strings"),s=e("./zlib/constants"),a=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),l=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;if((e=(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits)&&(t.windowBits=-15),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0,r.inflateInit2(this.strm,t.windowBits)))!==s.Z_OK)throw new Error(a[e]);this.header=new c,r.inflateGetHeader(this.strm,this.header)}function d(e,t){if((t=new h(t)).push(e,!0),t.err)throw t.msg||a[t.err];return t.result}h.prototype.push=function(e,t){var n,a,u,c,h,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,g=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof e?d.input=o.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&p&&(h="string"==typeof p?o.string2buf(p):"[object ArrayBuffer]"===l.call(p)?new Uint8Array(p):p,n=r.inflateSetDictionary(this.strm,h)),n===s.Z_BUF_ERROR&&!0===g&&(n=s.Z_OK,g=!1),n!==s.Z_STREAM_END&&n!==s.Z_OK)return this.onEnd(n),!(this.ended=!0)}while(!d.next_out||0!==d.avail_out&&n!==s.Z_STREAM_END&&(0!==d.avail_in||a!==s.Z_FINISH&&a!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(h=o.utf8border(d.output,d.next_out),u=d.next_out-h,c=o.buf2string(d.output,h),d.next_out=u,d.avail_out=f-u,u&&i.arraySet(d.output,d.output,h,u,0),this.onData(c)):this.onData(i.shrinkBuf(d.output,d.next_out))),0===d.avail_in&&0===d.avail_out&&(g=!0),(0<d.avail_in||0===d.avail_out)&&n!==s.Z_STREAM_END);return(a=n===s.Z_STREAM_END?s.Z_FINISH:a)===s.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===s.Z_OK):a!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),!(d.avail_out=0))},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=h,n.inflate=d,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},n.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,i=(n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)},{arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){for(var t,n,r,i,o=t=0,s=e.length;o<s;o++)t+=e[o].length;for(i=new Uint8Array(t),o=n=0,s=e.length;o<s;o++)r=e[o],i.set(r,n),n+=r.length;return i}}),o={arraySet:function(e,t,n,r,i){for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(r)},{}],42:[function(e,t,n){"use strict";var r=e("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new r.Buf8(256),a=0;a<256;a++)s[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function u(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",s=0;s<t;s++)n+=String.fromCharCode(e[s]);return n}s[254]=s[254]=1,n.string2buf=function(e){for(var t,n,i,o,s=e.length,a=0,u=0;u<s;u++)55296==(64512&(n=e.charCodeAt(u)))&&u+1<s&&56320==(64512&(i=e.charCodeAt(u+1)))&&(n=65536+(n-55296<<10)+(i-56320),u++),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(a),u=o=0;o<a;u++)55296==(64512&(n=e.charCodeAt(u)))&&u+1<s&&56320==(64512&(i=e.charCodeAt(u+1)))&&(n=65536+(n-55296<<10)+(i-56320),u++),n<128?t[o++]=n:(n<2048?t[o++]=192|n>>>6:(n<65536?t[o++]=224|n>>>12:(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63),t[o++]=128|n>>>6&63),t[o++]=128|63&n);return t},n.buf2binstring=function(e){return u(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){for(var n,r,i,o=t||e.length,a=new Array(2*o),c=n=0;c<o;)if((r=e[c++])<128)a[n++]=r;else if(4<(i=s[r]))a[n++]=65533,c+=i-1;else{for(r&=2===i?31:3===i?15:7;1<i&&c<o;)r=r<<6|63&e[c++],i--;1<i?a[n++]=65533:r<65536?a[n++]=r:(r-=65536,a[n++]=55296|r>>10&1023,a[n++]=56320|1023&r)}return u(a,n)},n.utf8border=function(e,t){for(var n=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=n&&128==(192&e[n]);)n--;return!(n<0||0===n)&&n+s[e[n]]>t?n:t}},{"./common":41}],43:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,s=0;0!==n;){for(n-=s=2e3<n?2e3:n;o=o+(i=i+t[r++]|0)|0,--s;);i%=65521,o%=65521}return i|o<<16|0}},{}],44:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,n){"use strict";var r=function(){for(var e=[],t=0;t<256;t++){for(var n=t,r=0;r<8;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}();t.exports=function(e,t,n,i){var o=r,s=i+n;e^=-1;for(var a=i;a<s;a++)e=e>>>8^o[255&(e^t[a])];return-1^e}},{}],46:[function(e,t,n){"use strict";var r,i=e("../utils/common"),o=e("./trees"),s=e("./adler32"),a=e("./crc32"),u=e("./messages"),c=-2,l=258,h=262,d=113;function f(e,t){return e.msg=u[t],t}function p(e){return(e<<1)-(4<e?9:0)}function g(e){for(var t=e.length;0<=--t;)e[t]=0}function _(e){var t=e.state,n=t.pending;0!==(n=n>e.avail_out?e.avail_out:n)&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending)&&(t.pending_out=0)}function m(e,t){o._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_(e.strm)}function v(e,t){e.pending_buf[e.pending++]=t}function y(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function S(e,t){var n,r,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match,u=e.strstart>e.w_size-h?e.strstart-(e.w_size-h):0,c=e.window,d=e.w_mask,f=e.prev,p=e.strstart+l,g=c[o+s-1],_=c[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(c[(n=t)+s]===_&&c[n+s-1]===g&&c[n]===c[o]&&c[++n]===c[o+1]){for(o+=2,n++;c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<p;);if(r=l-(p-o),o=p-l,s<r){if(e.match_start=t,a<=(s=r))break;g=c[o+s-1],_=c[o+s]}}}while((t=f[t&d])>u&&0!=--i);return s<=e.lookahead?s:e.lookahead}function E(e){var t,n,r,o,u,c,l,d,f,p=e.w_size;do{if(d=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-h)){for(i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;r=e.head[--t],e.head[t]=p<=r?r-p:0,--n;);for(t=n=p;r=e.prev[--t],e.prev[t]=p<=r?r-p:0,--n;);d+=p}if(0===e.strm.avail_in)break;if(u=e.strm,c=e.window,l=e.strstart+e.lookahead,f=void 0,n=0===(f=d<(f=u.avail_in)?d:f)?0:(u.avail_in-=f,i.arraySet(c,u.input,u.next_in,f,l),1===u.state.wrap?u.adler=s(u.adler,c,f,l):2===u.state.wrap&&(u.adler=a(u.adler,c,f,l)),u.next_in+=f,u.total_in+=f,f),e.lookahead+=n,3<=e.lookahead+e.insert)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+3-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<h&&0!==e.strm.avail_in)}function b(e,t){for(var n,r;;){if(e.lookahead<h){if(E(e),e.lookahead<h&&0===t)return 1;if(0===e.lookahead)break}if(n=0,3<=e.lookahead&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-h&&(e.match_length=S(e,n)),3<=e.match_length)if(r=o._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&3<=e.lookahead){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(m(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(m(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(m(e,!1),0===e.strm.avail_out)?1:2}function T(e,t){for(var n,r,i;;){if(e.lookahead<h){if(E(e),e.lookahead<h&&0===t)return 1;if(0===e.lookahead)break}if(n=0,3<=e.lookahead&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-h&&(e.match_length=S(e,n),e.match_length<=5)&&(1===e.strategy||3===e.match_length&&4096<e.strstart-e.match_start)&&(e.match_length=2),3<=e.prev_length&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-3,r=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(m(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=o._tr_tally(e,0,e.window[e.strstart-1]))&&m(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(m(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(m(e,!1),0===e.strm.avail_out)?1:2}function C(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function w(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),g(this.dyn_ltree),g(this.dyn_dtree),g(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),g(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),g(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function R(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:d,e.adler=2===t.wrap?0:1,t.last_flush=0,o._tr_init(t),0):f(e,c)}function I(e){var t=R(e);return 0===t&&((e=e.state).window_size=2*e.w_size,g(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),t}function k(e,t,n,r,o,s){if(!e)return c;var a=1;if(-1===t&&(t=6),r<0?(a=0,r=-r):15<r&&(a=2,r-=16),o<1||9<o||8!==n||r<8||15<r||t<0||9<t||s<0||4<s)return f(e,c);8===r&&(r=9);var u=new w;return(e.state=u).strm=e,u.wrap=a,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=+u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=s,u.method=n,I(e)}r=[new C(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(E(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,m(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-h&&(m(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(m(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(m(e,!1),e.strm.avail_out),1)})),new C(4,4,8,4,b),new C(4,5,16,8,b),new C(4,6,32,32,b),new C(4,4,16,16,T),new C(8,16,32,32,T),new C(8,16,128,128,T),new C(8,32,128,256,T),new C(32,128,258,1024,T),new C(32,258,258,4096,T)],n.deflateInit=function(e,t){return k(e,t,8,15,8,0)},n.deflateInit2=k,n.deflateReset=I,n.deflateResetKeep=R,n.deflateSetHeader=function(e,t){return e&&e.state&&2===e.state.wrap?(e.state.gzhead=t,0):c},n.deflate=function(e,t){var n,i,s,u;if(!e||!e.state||5<t||t<0)return e?f(e,c):c;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return f(e,0===e.avail_out?-5:c);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status&&(2===i.wrap?(e.adler=0,v(i,31),v(i,139),v(i,8),i.gzhead?(v(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),v(i,255&i.gzhead.time),v(i,i.gzhead.time>>8&255),v(i,i.gzhead.time>>16&255),v(i,i.gzhead.time>>24&255),v(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),v(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(v(i,255&i.gzhead.extra.length),v(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=a(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(v(i,0),v(i,0),v(i,0),v(i,0),v(i,0),v(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),v(i,3),i.status=d)):(h=8+(i.w_bits-8<<4)<<8,h|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(h|=32),h+=31-h%31,i.status=d,y(i,h),0!==i.strstart&&(y(i,e.adler>>>16),y(i,65535&e.adler)),e.adler=1)),69===i.status)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),_(e),s=i.pending,i.pending!==i.pending_buf_size));)v(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),_(e),s=i.pending,i.pending===i.pending_buf_size)){u=1;break}}while(u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,v(i,u),0!==u);i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),0===u&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),_(e),s=i.pending,i.pending===i.pending_buf_size)){u=1;break}}while(u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,v(i,u),0!==u);i.gzhead.hcrc&&i.pending>s&&(e.adler=a(e.adler,i.pending_buf,i.pending-s,s)),0===u&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&_(e),i.pending+2<=i.pending_buf_size&&(v(i,255&e.adler),v(i,e.adler>>8&255),e.adler=0,i.status=d)):i.status=d),0!==i.pending){if(_(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&p(t)<=p(n)&&4!==t)return f(e,-5);if(666===i.status&&0!==e.avail_in)return f(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var h=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(E(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(m(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(m(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(m(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,s,a=e.window;;){if(e.lookahead<=l){if(E(e),e.lookahead<=l&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,3<=e.lookahead&&0<e.strstart&&(r=a[i=e.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){for(s=e.strstart+l;r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<s;);e.match_length=l-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(3<=e.match_length?(n=o._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(m(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(m(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(m(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==h&&4!==h||(i.status=666),1===h||3===h)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===h&&(1===t?o._tr_align(i):5!==t&&(o._tr_stored_block(i,0,0,!1),3===t)&&(g(i.head),0===i.lookahead)&&(i.strstart=0,i.block_start=0,i.insert=0),_(e),0===e.avail_out))return i.last_flush=-1,0}return 4===t&&(i.wrap<=0||(2===i.wrap?(v(i,255&e.adler),v(i,e.adler>>8&255),v(i,e.adler>>16&255),v(i,e.adler>>24&255),v(i,255&e.total_in),v(i,e.total_in>>8&255),v(i,e.total_in>>16&255),v(i,e.total_in>>24&255)):(y(i,e.adler>>>16),y(i,65535&e.adler)),_(e),0<i.wrap&&(i.wrap=-i.wrap),0===i.pending))?1:0},n.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&t!==d&&666!==t?f(e,c):(e.state=null,t===d?f(e,-3):0):c},n.deflateSetDictionary=function(e,t){var n,r,o,a,u,l,h,d=t.length;if(!e||!e.state)return c;if(2===(a=(n=e.state).wrap)||1===a&&42!==n.status||n.lookahead)return c;for(1===a&&(e.adler=s(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===a&&(g(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,t,d-n.w_size,n.w_size,0),t=h,d=n.w_size),h=e.avail_in,u=e.next_in,l=e.input,e.avail_in=d,e.next_in=0,e.input=t,E(n);3<=n.lookahead;){for(r=n.strstart,o=n.lookahead-2;n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++,--o;);n.strstart=r,n.lookahead=2,E(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=u,e.input=l,e.avail_in=h,n.wrap=a,0},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,n){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,n){"use strict";t.exports=function(e,t){var n,r,i,o,s,a,u=e.state,c=e.next_in,l=e.input,h=c+(e.avail_in-5),d=e.next_out,f=e.output,p=d-(t-e.avail_out),g=d+(e.avail_out-257),_=u.dmax,m=u.wsize,v=u.whave,y=u.wnext,S=u.window,E=u.hold,b=u.bits,T=u.lencode,C=u.distcode,w=(1<<u.lenbits)-1,R=(1<<u.distbits)-1;e:do{for(b<15&&(E+=l[c++]<<b,b+=8,E+=l[c++]<<b,b+=8),n=T[E&w];;){if(E>>>=r=n>>>24,b-=r,0==(r=n>>>16&255))f[d++]=65535&n;else{if(!(16&r)){if(0==(64&r)){n=T[(65535&n)+(E&(1<<r)-1)];continue}if(32&r){u.mode=12;break e}e.msg="invalid literal/length code",u.mode=30;break e}for(i=65535&n,(r&=15)&&(b<r&&(E+=l[c++]<<b,b+=8),i+=E&(1<<r)-1,E>>>=r,b-=r),b<15&&(E+=l[c++]<<b,b+=8,E+=l[c++]<<b,b+=8),n=C[E&R];;){if(E>>>=r=n>>>24,b-=r,!(16&(r=n>>>16&255))){if(0==(64&r)){n=C[(65535&n)+(E&(1<<r)-1)];continue}e.msg="invalid distance code",u.mode=30;break e}if(o=65535&n,b<(r&=15)&&(E+=l[c++]<<b,(b+=8)<r)&&(E+=l[c++]<<b,b+=8),_<(o+=E&(1<<r)-1)){e.msg="invalid distance too far back",u.mode=30;break e}if(E>>>=r,b-=r,(r=d-p)<o){if(v<(r=o-r)&&u.sane){e.msg="invalid distance too far back",u.mode=30;break e}if(a=S,(s=0)===y){if(s+=m-r,r<i){for(i-=r;f[d++]=S[s++],--r;);s=d-o,a=f}}else if(y<r){if(s+=m+y-r,(r-=y)<i){for(i-=r;f[d++]=S[s++],--r;);if(s=0,y<i){for(i-=r=y;f[d++]=S[s++],--r;);s=d-o,a=f}}}else if(s+=y-r,r<i){for(i-=r;f[d++]=S[s++],--r;);s=d-o,a=f}for(;2<i;)f[d++]=a[s++],f[d++]=a[s++],f[d++]=a[s++],i-=3;i&&(f[d++]=a[s++],1<i)&&(f[d++]=a[s++])}else{for(s=d-o;f[d++]=f[s++],f[d++]=f[s++],f[d++]=f[s++],2<(i-=3););i&&(f[d++]=f[s++],1<i)&&(f[d++]=f[s++])}break}}break}}while(c<h&&d<g);c-=i=b>>3,E&=(1<<(b-=i<<3))-1,e.next_in=c,e.next_out=d,e.avail_in=c<h?h-c+5:5-(c-h),e.avail_out=d<g?g-d+257:257-(d-g),u.hold=E,u.bits=b}},{}],49:[function(e,t,n){"use strict";var r=e("../utils/common"),i=e("./adler32"),o=e("./crc32"),s=e("./inffast"),a=e("./inftrees"),u=-2;function c(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function h(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):u}function d(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,h(e)):u}function f(e,t){var n,r;return!e||!e.state||(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t))?u:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,d(e))}function p(e,t){var n;return e?(n=new l,(e.state=n).window=null,0!==(n=f(e,t))&&(e.state=null),n):u}var g,_,m=!0;function v(e,t,n,i){var o;return null===(e=e.state).window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new r.Buf8(e.wsize)),i>=e.wsize?(r.arraySet(e.window,t,n-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(i<(o=e.wsize-e.wnext)&&(o=i),r.arraySet(e.window,t,n-i,o,e.wnext),(i-=o)?(r.arraySet(e.window,t,n-i,i,0),e.wnext=i,e.whave=e.wsize):(e.wnext+=o,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=o))),0}n.inflateReset=d,n.inflateReset2=f,n.inflateResetKeep=h,n.inflateInit=function(e){return p(e,15)},n.inflateInit2=p,n.inflate=function(e,t){var n,l,h,d,f,p,y,S,E,b,T,C,w,R,I,k,O,N,A,L,P,M,D,x,U=0,B=new r.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return u;12===(n=e.state).mode&&(n.mode=13),f=e.next_out,h=e.output,y=e.avail_out,d=e.next_in,l=e.input,p=e.avail_in,S=n.hold,E=n.bits,b=p,T=y,M=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap)n.mode=13;else{for(;E<16;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}if(2&n.wrap&&35615===S)B[n.check=0]=255&S,B[1]=S>>>8&255,n.check=o(n.check,B,2,0),E=S=0,n.mode=2;else if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&S)<<8)+(S>>8))%31)e.msg="incorrect header check",n.mode=30;else if(8!=(15&S))e.msg="unknown compression method",n.mode=30;else{if(E-=4,P=8+(15&(S>>>=4)),0===n.wbits)n.wbits=P;else if(P>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<P,e.adler=n.check=1,n.mode=512&S?10:12,E=S=0}}break;case 2:for(;E<16;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}if(n.flags=S,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=S>>8&1),512&n.flags&&(B[0]=255&S,B[1]=S>>>8&255,n.check=o(n.check,B,2,0)),E=S=0,n.mode=3;case 3:for(;E<32;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}n.head&&(n.head.time=S),512&n.flags&&(B[0]=255&S,B[1]=S>>>8&255,B[2]=S>>>16&255,B[3]=S>>>24&255,n.check=o(n.check,B,4,0)),E=S=0,n.mode=4;case 4:for(;E<16;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}n.head&&(n.head.xflags=255&S,n.head.os=S>>8),512&n.flags&&(B[0]=255&S,B[1]=S>>>8&255,n.check=o(n.check,B,2,0)),E=S=0,n.mode=5;case 5:if(1024&n.flags){for(;E<16;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}n.length=S,n.head&&(n.head.extra_len=S),512&n.flags&&(B[0]=255&S,B[1]=S>>>8&255,n.check=o(n.check,B,2,0)),E=S=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((C=p<(C=n.length)?p:C)&&(n.head&&(P=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,l,d,C,P)),512&n.flags&&(n.check=o(n.check,l,C,d)),p-=C,d+=C,n.length-=C),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===p)break e;for(C=0;P=l[d+C++],n.head&&P&&n.length<65536&&(n.head.name+=String.fromCharCode(P)),P&&C<p;);if(512&n.flags&&(n.check=o(n.check,l,C,d)),p-=C,d+=C,P)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===p)break e;for(C=0;P=l[d+C++],n.head&&P&&n.length<65536&&(n.head.comment+=String.fromCharCode(P)),P&&C<p;);if(512&n.flags&&(n.check=o(n.check,l,C,d)),p-=C,d+=C,P)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;E<16;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}if(S!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}E=S=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;E<32;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}e.adler=n.check=c(S),E=S=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=f,e.avail_out=y,e.next_in=d,e.avail_in=p,n.hold=S,n.bits=E,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last)S>>>=7&E,E-=7&E,n.mode=27;else{for(;E<3;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}switch(n.last=1&S,--E,3&(S>>>=1)){case 0:n.mode=14;break;case 1:z=G=void 0;var z,G=n;if(m){for(g=new r.Buf32(512),_=new r.Buf32(32),z=0;z<144;)G.lens[z++]=8;for(;z<256;)G.lens[z++]=9;for(;z<280;)G.lens[z++]=7;for(;z<288;)G.lens[z++]=8;for(a(1,G.lens,0,288,g,0,G.work,{bits:9}),z=0;z<32;)G.lens[z++]=5;a(2,G.lens,0,32,_,0,G.work,{bits:5}),m=!1}if(G.lencode=g,G.lenbits=9,G.distcode=_,G.distbits=5,n.mode=20,6!==t)break;S>>>=2,E-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}S>>>=2,E-=2}break;case 14:for(S>>>=7&E,E-=7&E;E<32;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}if((65535&S)!=(S>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&S,E=S=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(C=n.length){if(0===(C=y<(C=p<C?p:C)?y:C))break e;r.arraySet(h,l,d,C,f),p-=C,d+=C,y-=C,f+=C,n.length-=C}else n.mode=12;break;case 17:for(;E<14;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}if(n.nlen=257+(31&S),S>>>=5,E-=5,n.ndist=1+(31&S),S>>>=5,E-=5,n.ncode=4+(15&S),S>>>=4,E-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;E<3;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}n.lens[H[n.have++]]=7&S,S>>>=3,E-=3}for(;n.have<19;)n.lens[H[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,D={bits:n.lenbits},M=a(0,n.lens,0,19,n.lencode,0,n.work,D),n.lenbits=D.bits,M){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;k=(U=n.lencode[S&(1<<n.lenbits)-1])>>>16&255,O=65535&U,!((I=U>>>24)<=E);){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}if(O<16)S>>>=I,E-=I,n.lens[n.have++]=O;else{if(16===O){for(x=I+2;E<x;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}if(S>>>=I,E-=I,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}P=n.lens[n.have-1],C=3+(3&S),S>>>=2,E-=2}else if(17===O){for(x=I+3;E<x;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}P=0,C=3+(7&(S>>>=I)),S>>>=3,E=E-I-3}else{for(x=I+7;E<x;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}P=0,C=11+(127&(S>>>=I)),S>>>=7,E=E-I-7}if(n.have+C>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;C--;)n.lens[n.have++]=P}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,D={bits:n.lenbits},M=a(1,n.lens,0,n.nlen,n.lencode,0,n.work,D),n.lenbits=D.bits,M){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,D={bits:n.distbits},M=a(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,D),n.distbits=D.bits,M){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=p&&258<=y){e.next_out=f,e.avail_out=y,e.next_in=d,e.avail_in=p,n.hold=S,n.bits=E,s(e,T),f=e.next_out,h=e.output,y=e.avail_out,d=e.next_in,l=e.input,p=e.avail_in,S=n.hold,E=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;k=(U=n.lencode[S&(1<<n.lenbits)-1])>>>16&255,O=65535&U,!((I=U>>>24)<=E);){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}if(k&&0==(240&k)){for(N=I,A=k,L=O;k=(U=n.lencode[L+((S&(1<<N+A)-1)>>N)])>>>16&255,O=65535&U,!(N+(I=U>>>24)<=E);){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}S>>>=N,E-=N,n.back+=N}if(S>>>=I,E-=I,n.back+=I,n.length=O,0===k){n.mode=26;break}if(32&k){n.back=-1,n.mode=12;break}if(64&k){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&k,n.mode=22;case 22:if(n.extra){for(x=n.extra;E<x;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}n.length+=S&(1<<n.extra)-1,S>>>=n.extra,E-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;k=(U=n.distcode[S&(1<<n.distbits)-1])>>>16&255,O=65535&U,!((I=U>>>24)<=E);){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}if(0==(240&k)){for(N=I,A=k,L=O;k=(U=n.distcode[L+((S&(1<<N+A)-1)>>N)])>>>16&255,O=65535&U,!(N+(I=U>>>24)<=E);){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}S>>>=N,E-=N,n.back+=N}if(S>>>=I,E-=I,n.back+=I,64&k){e.msg="invalid distance code",n.mode=30;break}n.offset=O,n.extra=15&k,n.mode=24;case 24:if(n.extra){for(x=n.extra;E<x;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}n.offset+=S&(1<<n.extra)-1,S>>>=n.extra,E-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===y)break e;if(n.offset>(C=T-y)){if((C=n.offset-C)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}w=C>n.wnext?(C-=n.wnext,n.wsize-C):n.wnext-C,C>n.length&&(C=n.length),R=n.window}else R=h,w=f-n.offset,C=n.length;for(y-=C=y<C?y:C,n.length-=C;h[f++]=R[w++],--C;);0===n.length&&(n.mode=21);break;case 26:if(0===y)break e;h[f++]=n.length,y--,n.mode=21;break;case 27:if(n.wrap){for(;E<32;){if(0===p)break e;p--,S|=l[d++]<<E,E+=8}if(T-=y,e.total_out+=T,n.total+=T,T&&(e.adler=n.check=(n.flags?o:i)(n.check,h,T,f-T)),T=y,(n.flags?S:c(S))!==n.check){e.msg="incorrect data check",n.mode=30;break}E=S=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;E<32;){if(0===p)break e;p--,S+=l[d++]<<E,E+=8}if(S!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}E=S=0}n.mode=29;case 29:M=1;break e;case 30:M=-3;break e;case 31:return-4;default:return u}return e.next_out=f,e.avail_out=y,e.next_in=d,e.avail_in=p,n.hold=S,n.bits=E,(n.wsize||T!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,T-e.avail_out)?(n.mode=31,-4):(b-=e.avail_in,T-=e.avail_out,e.total_in+=b,e.total_out+=T,n.total+=T,n.wrap&&T&&(e.adler=n.check=(n.flags?o:i)(n.check,h,T,e.next_out-T)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),M=(0==b&&0===T||4===t)&&0===M?-5:M)},n.inflateEnd=function(e){var t;return e&&e.state?((t=e.state).window&&(t.window=null),e.state=null,0):u},n.inflateGetHeader=function(e,t){return e&&e.state&&0!=(2&(e=e.state).wrap)?((e.head=t).done=!1,0):u},n.inflateSetDictionary=function(e,t){var n,r=t.length;return!e||!e.state||0!==(n=e.state).wrap&&11!==n.mode?u:11===n.mode&&i(1,t,r,0)!==n.check?-3:v(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0)},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,n){"use strict";var r=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,u,c,l,h,d){var f,p,g,_,m,v,y,S,E,b=d.bits,T=0,C=0,w=0,R=0,I=0,k=0,O=0,N=0,A=0,L=0,P=null,M=0,D=new r.Buf16(16),x=new r.Buf16(16),U=null,B=0;for(T=0;T<=15;T++)D[T]=0;for(C=0;C<u;C++)D[t[n+C]]++;for(I=b,R=15;1<=R&&0===D[R];R--);if(R<I&&(I=R),0===R)c[l++]=20971520,c[l++]=20971520,d.bits=1;else{for(w=1;w<R&&0===D[w];w++);for(I<w&&(I=w),T=N=1;T<=15;T++)if((N=(N<<1)-D[T])<0)return-1;if(0<N&&(0===e||1!==R))return-1;for(x[1]=0,T=1;T<15;T++)x[T+1]=x[T]+D[T];for(C=0;C<u;C++)0!==t[n+C]&&(h[x[t[n+C]]++]=C);if(v=0===e?(P=U=h,19):1===e?(P=i,M-=257,U=o,B-=257,256):(P=s,U=a,-1),T=w,m=l,O=C=L=0,g=-1,_=(A=1<<(k=I))-1,1===e&&852<A||2===e&&592<A)return 1;for(;;){for(E=h[C]<v?(S=0,h[C]):h[C]>v?(S=U[B+h[C]],P[M+h[C]]):(S=96,0),f=1<<(y=T-O),w=p=1<<k;c[m+(L>>O)+(p-=f)]=y<<24|S<<16|E|0,0!==p;);for(f=1<<T-1;L&f;)f>>=1;if(L=0!==f?(L&f-1)+f:0,C++,0==--D[T]){if(T===R)break;T=t[n+h[C]]}if(I<T&&(L&_)!==g){for(m+=w,N=1<<(k=T-(O=0===O?I:O));k+O<R&&!((N-=D[k+O])<=0);)k++,N<<=1;if(A+=1<<k,1===e&&852<A||2===e&&592<A)return 1;c[g=L&_]=I<<24|k<<16|m-l|0}}0!==L&&(c[m+L]=T-O<<24|64<<16|0),d.bits=I}return 0}},{"../utils/common":41}],51:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,n){"use strict";var r=e("../utils/common");function i(e){for(var t=e.length;0<=--t;)e[t]=0}var o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],s=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=new Array(576),l=(i(c),new Array(60)),h=(i(l),new Array(512)),d=(i(h),new Array(256)),f=(i(d),new Array(29));i(f);var p,g,_,m=new Array(30);function v(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function y(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function S(e){return e<256?h[e]:h[256+(e>>>7)]}function E(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function b(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,E(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function T(e,t,n){b(e,n[2*t],n[2*t+1])}function C(e,t){for(var n=0;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1}function w(e,t,n){for(var r,i=new Array(16),o=0,s=1;s<=15;s++)i[s]=o=o+n[s-1]<<1;for(r=0;r<=t;r++){var a=e[2*r+1];0!==a&&(e[2*r]=C(i[a]++,a))}}function R(e){for(var t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function I(e){8<e.bi_valid?E(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function k(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]}function O(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&k(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!k(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function N(e,t,n){var r,i,a,u,c=0;if(0!==e.last_lit)for(;r=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],i=e.pending_buf[e.l_buf+c],c++,0==r?T(e,i,t):(T(e,(a=d[i])+256+1,t),0!==(u=o[a])&&b(e,i-=f[a],u),T(e,a=S(--r),n),0!==(u=s[a])&&b(e,r-=m[a],u)),c<e.last_lit;);T(e,256,t)}function A(e,t){var n,r,i,o=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<u;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=s[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;1<=n;n--)O(e,o,n);for(i=u;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],O(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,O(e,o,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1];for(var l,h,d,f,p,g=e,_=t.dyn_tree,m=t.max_code,v=t.stat_desc.static_tree,y=t.stat_desc.has_stree,S=t.stat_desc.extra_bits,E=t.stat_desc.extra_base,b=t.stat_desc.max_length,T=0,C=0;C<=15;C++)g.bl_count[C]=0;for(_[2*g.heap[g.heap_max]+1]=0,l=g.heap_max+1;l<573;l++)b<(C=_[2*_[2*(h=g.heap[l])+1]+1]+1)&&(C=b,T++),_[2*h+1]=C,m<h||(g.bl_count[C]++,f=0,E<=h&&(f=S[h-E]),p=_[2*h],g.opt_len+=p*(C+f),y&&(g.static_len+=p*(v[2*h+1]+f)));if(0!==T){do{for(C=b-1;0===g.bl_count[C];)C--}while(g.bl_count[C]--,g.bl_count[C+1]+=2,g.bl_count[b]--,0<(T-=2));for(C=b;0!==C;C--)for(h=g.bl_count[C];0!==h;)m<(d=g.heap[--l])||(_[2*d+1]!==C&&(g.opt_len+=(C-_[2*d+1])*_[2*d],_[2*d+1]=C),h--)}w(o,c,e.bl_count)}function L(e,t,n){var r,i,o=-1,s=t[1],a=0,u=7,c=4;for(0===s&&(u=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++a<u&&i===s||(a<c?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=i,c=(a=0)===s?(u=138,3):i===s?(u=6,3):(u=7,4))}function P(e,t,n){var r,i,o=-1,s=t[1],a=0,u=7,c=4;for(0===s&&(u=138,c=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++a<u&&i===s)){if(a<c)for(;T(e,i,e.bl_tree),0!=--a;);else 0!==i?(i!==o&&(T(e,i,e.bl_tree),a--),T(e,16,e.bl_tree),b(e,a-3,2)):a<=10?(T(e,17,e.bl_tree),b(e,a-3,3)):(T(e,18,e.bl_tree),b(e,a-11,7));o=i,c=(a=0)===s?(u=138,3):i===s?(u=6,3):(u=7,4)}}i(m);var M=!1;function D(e,t,n,i){b(e,0+(i?1:0),3),i=t,t=n,I(n=e),E(n,t),E(n,~t),r.arraySet(n.pending_buf,n.window,i,t,n.pending),n.pending+=t}n._tr_init=function(e){if(!M){for(var t,n,r,i,u=new Array(16),S=r=0;S<28;S++)for(f[S]=r,t=0;t<1<<o[S];t++)d[r++]=S;for(d[r-1]=S,S=i=0;S<16;S++)for(m[S]=i,t=0;t<1<<s[S];t++)h[i++]=S;for(i>>=7;S<30;S++)for(m[S]=i<<7,t=0;t<1<<s[S]-7;t++)h[256+i++]=S;for(n=0;n<=15;n++)u[n]=0;for(t=0;t<=143;)c[2*t+1]=8,t++,u[8]++;for(;t<=255;)c[2*t+1]=9,t++,u[9]++;for(;t<=279;)c[2*t+1]=7,t++,u[7]++;for(;t<=287;)c[2*t+1]=8,t++,u[8]++;for(w(c,287,u),t=0;t<30;t++)l[2*t+1]=5,l[2*t]=C(t,5);p=new v(c,o,257,286,15),g=new v(l,s,0,30,15),_=new v(new Array(0),a,0,19,7),M=!0}e.l_desc=new y(e.dyn_ltree,p),e.d_desc=new y(e.dyn_dtree,g),e.bl_desc=new y(e.bl_tree,_),e.bi_buf=0,e.bi_valid=0,R(e)},n._tr_stored_block=D,n._tr_flush_block=function(e,t,n,r){var i,o,s,a=0;if(0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){for(var t=4093624447,n=0;n<=31;n++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*n])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(n=32;n<256;n++)if(0!==e.dyn_ltree[2*n])return 1;return 0}(e)),A(e,e.l_desc),A(e,e.d_desc),a=function(e){var t;for(L(e,e.dyn_ltree,e.l_desc.max_code),L(e,e.dyn_dtree,e.d_desc.max_code),A(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*u[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t)D(e,t,n,r);else if(4===e.strategy||o===i)b(e,2+(r?1:0),3),N(e,c,l);else{b(e,4+(r?1:0),3);var h=e,d=(t=e.l_desc.max_code+1,n=e.d_desc.max_code+1,a+1);for(b(h,t-257,5),b(h,n-1,5),b(h,d-4,4),s=0;s<d;s++)b(h,h.bl_tree[2*u[s]+1],3);P(h,h.dyn_ltree,t-1),P(h,h.dyn_dtree,n-1),N(e,e.dyn_ltree,e.dyn_dtree)}R(e),r&&I(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(d[n]+256+1)]++,e.dyn_dtree[2*S(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){b(e,2,3),T(e,256,c),16===e.bi_valid?(E(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},{"../utils/common":41}],53:[function(e,t,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){(function(e){!function(e){"use strict";var t,n,r,o,s,a,u,c,l;function h(e){delete s[e]}function d(e){if(a)setTimeout(d,0,e);else{var t=s[e];if(t){a=!0;try{var n=t.callback,r=t.args;switch(r.length){case 0:n();break;case 1:n(r[0]);break;case 2:n(r[0],r[1]);break;case 3:n(r[0],r[1],r[2]);break;default:n.apply(void 0,r)}}finally{h(e),a=!1}}}}function f(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(r)&&d(+t.data.slice(r.length))}e.setImmediate||(o=1,a=!(s={}),u=e.document,c=(c=Object.getPrototypeOf&&Object.getPrototypeOf(e))&&c.setTimeout?c:e,l="[object process]"==={}.toString.call(e.process)?function(e){i.nextTick((function(){d(e)}))}:function(){var t,n;if(e.postMessage&&!e.importScripts)return t=!0,n=e.onmessage,e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}()?(r="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",f,!1):e.attachEvent("onmessage",f),function(t){e.postMessage(r+t,"*")}):e.MessageChannel?((n=new MessageChannel).port1.onmessage=function(e){d(e.data)},function(e){n.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(t=u.documentElement,function(e){var n=u.createElement("script");n.onreadystatechange=function(){d(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}):function(e){setTimeout(d,0,e)},c.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];return s[o]={callback:e,args:t},l(o),o++},c.clearImmediate=h)}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)}).call(this,n(4).Buffer,n(8).setImmediate,n(0),n(1))},,function(e,t,n){"use strict";(function(e){var r=n(5),i=n(6),o=n(7);function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(e=null===e?new u(t):e).length=t,e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"!=typeof e)return c(this,e,t,n);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer){var i=e,s=t,c=n;if(s.byteLength,c<0||s.byteLength<c)throw new RangeError("'offset' is out of bounds");if(s.byteLength<c+(r||0))throw new RangeError("'length' is out of bounds");return s=void 0===c&&void 0===r?new Uint8Array(s):void 0===r?new Uint8Array(s,c):new Uint8Array(s,c,r),u.TYPED_ARRAY_SUPPORT?(i=s).__proto__=u.prototype:i=d(i,s),i}if("string"==typeof t){if(c=e,r=t,s=n,u.isEncoding(s="string"==typeof s&&""!==s?s:"utf8"))return(r=(c=a(c,i=0|p(r,s))).write(r,s))!==i?c.slice(0,r):c;throw new TypeError('"encoding" must be a valid string encoding')}var l;n=e,r=t;if(u.isBuffer(r))return 0!==(n=a(n,l=0|f(r.length))).length&&r.copy(n,0,0,l),n;if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||(l=r.length)!=l?a(n,0):d(n,r);if("Buffer"===r.type&&o(r.data))return d(n,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=a(e,t<0?0:0|f(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|f(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;var n=(e="string"!=typeof e?""+e:e).length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return O(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return N(e).length;default:if(r)return O(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var i,o=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((n=void 0===n||n>this.length?this.length:n)<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var s=t,a=n,u=this.length;(!a||a<0||u<a)&&(a=u);for(var c="",l=s=!s||s<0?0:s;l<a;++l)c+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(this[l]);return c;case"utf8":case"utf-8":return S(this,t,n);case"ascii":u=t;var h=n,d="";h=Math.min(this.length,h);for(var f=u;f<h;++f)d+=String.fromCharCode(127&this[f]);return d;case"latin1":case"binary":s=t;var p=n,g="";p=Math.min(this.length,p);for(var _=s;_<p;++_)g+=String.fromCharCode(this[_]);return g;case"base64":return m=this,i=n,0===(v=t)&&i===m.length?r.fromByteArray(m):r.fromByteArray(m.slice(v,i));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var m=t,v=n,y=this.slice(m,v),E="",b=0;b<y.length;b+=2)E+=String.fromCharCode(y[b]+256*y[b+1]);return E;default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function _(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,(n=(n=isNaN(n)?i?0:e.length-1:n)<0?e.length+n:n)>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var o=1,s=e.length,a=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s/=o=2,a/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i)for(var c=-1,l=n;l<s;l++)if(u(e,l)===u(t,-1===c?0:l-c)){if(l-(c=-1===c?l:c)+1===a)return c*o}else-1!==c&&(l-=l-c),c=-1;else for(l=n=s<n+a?s-a:n;0<=l;l--){for(var h=!0,d=0;d<a;d++)if(u(e,l+d)!==u(t,d)){h=!1;break}if(h)return l}return-1}function y(e,t,n,r){return A(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,u,c=e[i],l=null,h=239<c?4:223<c?3:191<c?2:1;if(i+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&127<(u=(31&c)<<6|63&o)&&(l=u);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&2047<(u=(15&c)<<12|(63&o)<<6|63&s)&&(u<55296||57343<u)&&(l=u);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&65535<(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)&&u<1114112&&(l=u)}null===l?(l=65533,h=1):65535<l&&(r.push((l-=65536)>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}var d=r,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function E(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function b(e,t,n,r,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function T(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function C(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function w(e,t,n,r){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function R(e,t,n,r,o){return o||w(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function I(e,t,n,r,o){return o||w(e,0,n,8),i.write(e,t,n,r,52,8),n+8}t.Buffer=u,t.SlowBuffer=function(e){return u.alloc(+(e=+e!=e?0:e))},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol)&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0}),u.alloc=function(e,t,n){return l(e),e<=0||void 0===t?a(null,e):"string"==typeof n?a(null,e).fill(t,n):a(null,e).fill(t)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);if(void 0===t)for(i=t=0;i<e.length;++i)t+=e[i].length;for(var n=u.allocUnsafe(t),r=0,i=0;i<e.length;++i){var s=e[i];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,r),r+=s.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)_(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0==e?"":0===arguments.length?S(this,0,e):g.apply(this,arguments)},u.prototype.equals=function(e){if(u.isBuffer(e))return this===e||0===u.compare(this,e);throw new TypeError("Argument must be a Buffer")},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n)&&(e+=" ... "),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),(t=void 0===t?0:t)<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(i<=r&&n<=t)return 0;if(i<=r)return-1;if(n<=t)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(r,i),l=e.slice(t,n),h=0;h<a;++h)if(c[h]!==l[h]){o=c[h],s=l[h];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||i<n)&&(n=i),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r=r||"utf8";for(var o,s,a,u,c=!1;;)switch(r){case"hex":var l=e,h=t,d=n,f=(h=Number(h)||0,this.length-h);if((!d||(d=Number(d))>f)&&(d=f),(f=l.length)%2!=0)throw new TypeError("Invalid hex string");f/2<d&&(d=f/2);for(var p=0;p<d;++p){var g=parseInt(l.substr(2*p,2),16);if(isNaN(g))return p;this[h+p]=g}return p;case"utf8":case"utf-8":return f=t,u=n,A(O(e,(a=this).length-f),a,f,u);case"ascii":case"latin1":case"binary":return y(this,e,t,n);case"base64":return a=this,u=t,s=n,A(N(e),a,u,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s=t,o=n,A(function(e,t){for(var n,r,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i.push(n%256),i.push(r);return i}(e,this.length-s),this,s,o);default:if(c)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),c=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},u.prototype.slice=function(e,t){var n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=u.prototype;else for(var r=t-e,i=new u(r,void 0),o=0;o<r;++o)i[o]=this[o+e];return i},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||E(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||E(e,t,this.length);for(var r=this[e+--t],i=1;0<t&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||E(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||E(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||E(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||E(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||E(e,t,this.length);for(var r=t,i=1,o=this[e+--r];0<r&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){return t||E(e,2,this.length),32768&(t=this[e]|this[e+1]<<8)?4294901760|t:t},u.prototype.readInt16BE=function(e,t){return t||E(e,2,this.length),32768&(t=this[e+1]|this[e]<<8)?4294901760|t:t},u.prototype.readInt32LE=function(e,t){return t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||E(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||E(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||E(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||E(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||b(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||b(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;0<=--i&&(o*=256);)this[t+i]=e/o&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):T(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):T(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):C(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):C(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){e=+e,t|=0,r||b(this,e,t,n,(r=Math.pow(2,8*n-1))-1,-r);var i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){e=+e,t|=0,r||b(this,e,t,n,(r=Math.pow(2,8*n-1))-1,-r);var i=n-1,o=1,s=0;for(this[t+i]=255&e;0<=--i&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&(e=e<0?255+e+1:e),t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):T(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):T(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):C(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):C(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return R(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return R(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return I(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return I(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n=n||0,r||0===r||(r=this.length),t>=e.length&&(t=e.length),(r=0<r&&r<n?n:r)===n)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length);var i,o=(r=e.length-t<r-n?e.length-t+n:r)-n;if(this===e&&n<t&&t<r)for(i=o-1;0<=i;--i)e[i+t]=this[i+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){var i;if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length&&(i=e.charCodeAt(0))<256&&(e=i),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(!(n<=t))if(t>>>=0,n=void 0===n?this.length:n>>>0,"number"==typeof(e=e||0))for(a=t;a<n;++a)this[a]=e;else for(var o=u.isBuffer(e)?e:O(new u(e,r).toString()),s=o.length,a=0;a<n-t;++a)this[a+t]=o[a%s];return this};var k=/[^+\/0-9A-Za-z-_]/g;function O(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if(55295<(n=e.charCodeAt(s))&&n<57344){if(!i){if(56319<n){-1<(t-=3)&&o.push(239,191,189);continue}if(s+1===r){-1<(t-=3)&&o.push(239,191,189);continue}i=n;continue}if(n<56320){-1<(t-=3)&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&-1<(t-=3)&&o.push(239,191,189);if(i=null,n<128){if(--t<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function N(e){return r.toByteArray(function(e){if((e=((t=e).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(k,"")).length<2)return"";for(var t;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(0))},function(e,t,n){"use strict";t.byteLength=function(e){return 3*((e=u(e))[0]+(e=e[1]))/4-e},t.toByteArray=function(e){for(var t,n=(r=u(e))[0],r=r[1],s=new o(3*(n+r)/4-r),a=0,c=0<r?n-4:n,l=0;l<c;l+=4)t=i[e.charCodeAt(l)]<<18|i[e.charCodeAt(l+1)]<<12|i[e.charCodeAt(l+2)]<<6|i[e.charCodeAt(l+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=255&t;return 2===r&&(t=i[e.charCodeAt(l)]<<2|i[e.charCodeAt(l+1)]>>4,s[a++]=255&t),1===r&&(t=i[e.charCodeAt(l)]<<10|i[e.charCodeAt(l+1)]<<4|i[e.charCodeAt(l+2)]>>2,s[a++]=t>>8&255,s[a++]=255&t),s},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(function(e,t,n){for(var i,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}(e,s,a<s+16383?a:s+16383));return 1==i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2==i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0;a<64;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return[e=-1===(e=e.indexOf("="))?t:e,e===t?0:4-e%4]}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,l=-7,h=n?i-1:0,d=n?-1:1;i=e[t+h];for(h+=d,o=i&(1<<-l)-1,i>>=-l,l+=a;0<l;o=256*o+e[t+h],h+=d,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;0<l;s=256*s+e[t+h],h+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(i?-1:1);s+=Math.pow(2,r),o-=c}return(i?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,u=8*o-i-1,c=(1<<u)-1,l=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1;o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-s))<1&&(s--,r*=2),2<=(t+=1<=s+l?h/r:h*Math.pow(2,1-l))*r&&(s++,r/=2),c<=s+l?(a=0,s=c):1<=s+l?(a=(t*r-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));8<=i;e[n+d]=255&a,d+=f,a/=256,i-=8);for(s=s<<i|a,u+=i;0<u;e[n+d]=255&s,d+=f,s/=256,u-=8);e[n+d-f]|=128*o}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(9),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t,n){(function(e,t){!function(e){"use strict";var n,r,i,o,s,a,u,c,l,h;function d(e){delete a[e]}function f(e){if(u)setTimeout(f,0,e);else{var t=a[e];if(t){u=!0;try{var n=t.callback,r=t.args;switch(r.length){case 0:n();break;case 1:n(r[0]);break;case 2:n(r[0],r[1]);break;case 3:n(r[0],r[1],r[2]);break;default:n.apply(void 0,r)}}finally{d(e),u=!1}}}}e.setImmediate||(s=1,u=!(a={}),c=e.document,l=(l=Object.getPrototypeOf&&Object.getPrototypeOf(e))&&l.setTimeout?l:e,h="[object process]"==={}.toString.call(e.process)?function(e){t.nextTick((function(){f(e)}))}:function(){var t,n;if(e.postMessage&&!e.importScripts)return t=!0,n=e.onmessage,e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}()?(i="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(i)&&f(+t.data.slice(i.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),function(t){e.postMessage(i+t,"*")}):e.MessageChannel?((r=new MessageChannel).port1.onmessage=function(e){f(e.data)},function(e){r.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(n=c.documentElement,function(e){var t=c.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):function(e){setTimeout(f,0,e)},l.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];return a[s]={callback:e,args:t},h(s),s++},l.clearImmediate=d)}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0),n(1))},function(e,t,n){"use strict";n.r(t),n.d(t,"ZegoLogger",(function(){return Pe})),n.d(t,"ZegoDataReport",(function(){return f})),n.d(t,"createZegoWebSocket",(function(){return h})),n.d(t,"LoggerStateCenter",(function(){return s})),a.getInstance=function(){return a.instance||(a.instance=new a).init(),a.instance},a.prototype.init=function(){},Object.defineProperty(a.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"ENV",{get:function(){return this._ENV},set:function(e){this._ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!1,configurable:!0}),a.instance=new a;var r,i,o,s=a;function a(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}(t=r=r||{})[t.BROWSER=0]="BROWSER",t[t.WEIXINMINI=1]="WEIXINMINI",(i=i||{})[i.DEFAULT=0]="DEFAULT",(t=o=o||{})[t.DISABLE=0]="DISABLE",t[t.WEBSOCKET=1]="WEBSOCKET",t[t.HTTPS=2]="HTTPS";var u={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},c=(l.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){"function"==typeof e.onmessage&&e.onmessage(t)})))})),this._websocket.onError((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onerror&&e.onerror(t)})))},l.prototype.onopen=function(e){},l.prototype.onerror=function(e){},l.prototype.onclose=function(e){},l.prototype.onmessage=function(e){},l.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},l.prototype.close=function(){this._websocket&&this._websocket.close()},l);function l(e,t){this.url=e,this.readyState=3,this.init()}function h(e,t){return new(t%2===r.BROWSER?WebSocket:c)(e)}var d=function(){return(d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},f=(p.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:"success",event:t,events:[]}},p.prototype.addMsgExt=function(e,t){this.dataStatistics[e]?this.dataStatistics[e].msg_ext=t:console.warn("".concat(e," not exist"))},p.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]?Object.assign(this.dataStatistics[e],t):console.warn("".concat(e," not exist"))},p.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},p.prototype.eventEnd=function(e,t,n){if(this.dataStatistics[e]){var r=this.dataStatistics[e].events;if(r&&0!==r.length){for(var i=r.length-1;0<=i;i--)if(r[i].event==t&&0==r[i].time_consumed){r[i].time_consumed=Date.now()-r[i].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},p.prototype.eventEndWithMsg=function(e,t,n){if(this.dataStatistics[e]){var r=this.dataStatistics[e].events;if(r){for(var i=r.length-1;0<=i;i--)if(r[i].event==t&&0==r[i].time_consumed){r[i].time_consumed=Date.now()-r[i].event_time,null==r[i].msg_ext&&(r[i].msg_ext={}),r[i].msg_ext=d({},n);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},p.prototype.eventEndWithMsgInfo=function(e,t,n){if(this.dataStatistics[e]){var r=this.dataStatistics[e].events;if(r){for(var i=r.length-1;0<=i;i--)if(r[i].event==t&&0==r[i].time_consumed){r[i].time_consumed=Date.now()-r[i].event_time,Object.assign(r[i],n);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},p.prototype.addEventInfo=function(e,t,n,r){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(null!=i){for(var o=i.length-1;0<=o;o--)if(i[o].event==t&&null!=i[o].time_consumed){null==i[o].msg_ext?i[o].msg_ext={}:i[o].msg_ext&&(i[o].msg_ext[n]=r);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},p.prototype.addEventMsg=function(e,t,n,r){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(null!=i){for(var o=i.length-1;0<=o;o--)if(i[o].event==t){i[o][n]=r;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},p.prototype.addEvent=function(e,t,n){this.dataStatistics[e]?this.dataStatistics[e].events&&(n?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),msg_ext:n}):this.dataStatistics[e].events.push({event:t,event_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},p.prototype.uploadReport=function(e,t,n,r){var i=this.dataStatistics[e];null!=i&&(t&&(i.event=t),i.time_consumed=Date.now()-i.event_time,n&&this.addMsgInfo(e,{error:n.code,message:n.message||n.msg+" "+(r||"")}),this.logger.report(i),delete this.dataStatistics[e])},p);function p(e){this.dataStatistics={},this.logger=e}var g,_=["00","01","02","03","04","05","06","07","08","09"];function m(){var e=new Date;return[e.getFullYear()+"/",(_[e.getMonth()+1]||e.getMonth()+1)+"/",(_[e.getDate()]||e.getDate())+" ",(_[e.getHours()]||e.getHours())+":",(_[e.getMinutes()]||e.getMinutes())+":",_[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}function v(e){this.cache=e}(t=g=g||{}).WEBSOCKET_STATE_CHANGE="zl.net.wsc",t.OPEN_WS="zl.net.opws",Object.defineProperty(Ce.prototype,"url",{get:function(){return this.configState.url},set:function(e){this.configState.url=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ce.prototype,"strategy",{get:function(){return this.senderBuilder.strategy},enumerable:!1,configurable:!0}),Ce.prototype.setStrategy=function(e){this.senderBuilder.setStrategy(e),this.sender=this.senderBuilder.build()},Ce.prototype.addRemoteWsLog=function(e){if(this.configState.env!=r.BROWSER)throw new Error("cannot use net strategy on  mini program");var t;this.closed()&&(t=this.url,this.url="",this.openWebSocketLogServer(t)),this.cache.push(e),this.connected()&&this.sender&&this.sender.active()},Ce.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},Ce.prototype.updateSender=function(){this.websocket instanceof WebSocket&&this.configState.useStrategy&&(this.senderBuilder.setWs(this.websocket),this.senderBuilder.setCache(this.cache),this.sender=this.senderBuilder.build())},Ce.prototype.updateWebSocketState=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.websocketState,i="";switch(e){case"onconnecting":"never_opened"===this.websocketState?this.websocketState="first_connecting":this.websocketState="reconnecting";break;case"onopen":this.websocketState="connected";break;case"onclosed":this.websocketState="closed";var o=t[0];o&&(i+=" close code=".concat(o.code));break;case"onerror":this.websocketState="error"}e=g.WEBSOCKET_STATE_CHANGE+" log ws state change: ".concat(r," -> ").concat(this.websocketState),i&&(e+=i),this.innerLogger.info(e)},Ce.prototype.openWebSocketLogServer=function(e){var t=this;this.url!=e&&((this.url&&""!==this.url||"never_opened"===this.websocketState)&&this.innerLogger.info(g.OPEN_WS+" log url change to: ".concat(e)),this.url=e)&&(this.stopWebSocketServer(),this.websocket=h(e,this.configState.env),this.updateSender(),this.updateWebSocketState("onconnecting"),this.websocket.onopen=function(){var e;t.configState.useStrategy&&null!=(e=t.sender)&&e.active(),t.updateWebSocketState("onopen")},this.websocket.onclose=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];console.warn("onclose   websocket error:",e),t.updateWebSocketState.apply(t,function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}(["onclosed"],e,!1))},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];console.warn("open log websocket error:",e),t.updateWebSocketState("onerror")})},Ce.prototype.closed=function(){return null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState},Ce.prototype.connected=function(){return null!==this.websocket&&1==this.websocket.readyState},Ce.prototype.connecting=function(){return null!==this.websocket&&0==this.websocket.readyState},Ce.prototype.wsSend=function(e){this.websocket&&this.websocket.send(e)},Ce.prototype.destroy=function(){this.websocket=null};var y,S=Ce,E=(Te.prototype.active=function(){var e=this;this.ws&&1===this.ws.readyState&&0!==this.cache.size()&&this.strategy.canSendLog()&&(this.strategy.getLog().forEach((function(t){e.ws.send(t)})),this.strategy.onSendLog())},Te),b=(y=function(e,t){return(y=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},function(e){function t(t){return e.call(this,t)||this}var n=t,r=e;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=n}return y(n,r),n.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i),t.prototype.getLog=function(){return this.cache.clear()},t.prototype.canSendLog=function(){return 0<this.cache.size()},t.prototype.onSendLog=function(){},t}(v));ne=function(e,t){return(ne=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ne(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(be,te=v),be.prototype.canSendLog=function(){return!this.locked&&0<this.cache.size()},be.prototype.getLog=function(){for(var e=[],t=0;t<this.maxPacketLen-4e3;){var n=this.cache.getOneLogPacket();if(!n||n.length<=0)break;t+=n.length||0,e.push(n)}return e},be.prototype.onSendLog=function(){var e=this;this.locked=!0,setTimeout((function(){e.locked=!1,e.onCanSendActive&&e.onCanSendActive()}),this.maxDelay)},ee=function(e,t){return(ee=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ee(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(Ee,J=t=be);var T=Ee,C=(Q=function(e,t){return(Q=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},function(){return null!==X&&X.apply(this,arguments)||this});if("function"!=typeof(A=X=t)&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function w(){this.constructor=C}Q(C,A),C.prototype=null===A?Object.create(A):(w.prototype=A.prototype,new w),$=function(e,t){return($=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var R=function(){return null!==K&&K.apply(this,arguments)||this};if("function"!=typeof(A=K=t)&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function I(){this.constructor=R}function k(){this.url="",this.env=r.BROWSER,this.useStrategy=!0,this.token="",this.deviceid=N.id()}$(R,A),R.prototype=null===A?Object.create(A):(I.prototype=A.prototype,new I),Z=function(e,t){return(Z=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Z(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}((function(){return null!==W&&W.apply(this,arguments)||this}),W=t),Object.defineProperty(Se.prototype,"strategy",{get:function(){return this._strategy},enumerable:!1,configurable:!0}),Se.prototype.setWs=function(e){this.ws=e},Se.prototype.setCache=function(e){this.cache=e},Se.prototype.setStrategy=function(e){e&&(this._strategy=e)},Se.prototype.build=function(){if(this.ws&&this.cache)return this._strategy!==i.DEFAULT?new E(this.ws,this.cache,new b(this.cache)):new E(this.ws,this.cache,new T(this.cache));throw new Error("cannot build log sender")};var O=Se,N=(ye.isEnvSupport=function(){return!(!window||!window.localStorage)},ye.bin2hex=function(e){for(var t,n="",r=0,i=(e+="").length;r<i;r++)n+=(t=e.charCodeAt(r).toString(16)).length<2?"0"+t:t;return n},ye.getCanvasFingerprint=function(e){var t=document.createElement("canvas"),n=((n=t.getContext("2d")).textBaseline="top",n.font="14px 'Arial'",n.fillStyle="#f60",n.fillRect(125,1,62,20),n.fillStyle="#069",n.fillText(e,2,15),n.fillStyle="rgba(102, 204, 0, 0.7)",n.fillText(e,4,17),t.toDataURL().replace("data:image/png;base64,",""));e=atob(n);return this.bin2hex(e.slice(-16,-12))},ye.generateUUID=function(){var e,t,n;return(t=localStorage.getItem(this.storageKey))||(e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(36)})),n=this.getCanvasFingerprint("hello, zego")+t.slice(8),localStorage.setItem(this.storageKey,n),t)},ye.id=function(){var e;return ye.isEnvSupport()?((e=localStorage.getItem(this.storageKey))||(e=ye.generateUUID(),localStorage.setItem(this.storageKey,e)),e):""},ye.storageKey="z_deviceID",ye),A=(Object.defineProperty(ve.prototype,"buffer",{get:function(){return this.queue},set:function(e){this.queue=e},enumerable:!1,configurable:!0}),ve.prototype.push=function(e){if(!e)throw new Error("item null!");e&&this.queue.push(e)},ve.prototype.pop=function(){return this.queue.shift()},ve.prototype.front=function(){return this.queue[0]},ve);function L(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function P(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var c=[a,u];if(n)throw new TypeError("Generator is already executing.");for(;o=s&&c[s=0]?0:o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,(c=i?[2&c[0],i.value]:c)[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=0<(i=o.trys).length&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3]))o.label=c[1];else if(6===c[0]&&o.label<i[1])o.label=i[1],i=c;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(c)}}c=t.call(e,o)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}Y=function(e,t){return(Y=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};var M=function(){return(M=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},D=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(me,V=A),me.prototype.size=function(){return this.queue.length},me.prototype.getOneLogPacket=function(){for(var e="";0<this.queue.length;){if(4e3<(e+this.queue[0]).length)return e;var t=JSON.parse(this.queue[0]);t=M(M({},t),{userid:t.userid||this.configState.roomid,roomid:t.roomid||this.configState.roomid,userName:t.userName||this.configState.userName}),e=e+JSON.stringify(t)+"\n";this.queue.shift()}return""===e?void 0:e},me.prototype.clear=function(){for(var e=[];0<this.queue.length;){var t=this.getOneLogPacket();if(!t)break;e.push(t)}return e},me),x=(_e.prototype.save=function(e){return this.dbSaver.save(this.tableName,{log:e})},_e.prototype.queryList=function(e){return this.dbSaver.queryByCursor(this.tableName,e)},_e.prototype.delete=function(e){return this.dbSaver.deleteItems(this.tableName,e)},_e.prototype.storedBytesSize=function(){var e=this;return new Promise((function(t,n){return r=e,o=function(){var e,r;return function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var c=[a,u];if(n)throw new TypeError("Generator is already executing.");for(;o=s&&c[s=0]?0:o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,(c=i?[2&c[0],i.value]:c)[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=0<(i=o.trys).length&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3]))o.label=c[1];else if(6===c[0]&&o.label<i[1])o.label=i[1],i=c;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(c)}}c=t.call(e,o)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,(function(i){return e=this.dbSaver.openCursor(this.tableName),r=0,e.onsuccess=function(e){var n;(e=null==(e=e.target)?void 0:e.result)?(n=e.value,r+=n.log.length,e.continue()):t(r)},e.onerror=function(e){n(e)},[2]}))},new(i=(i=void 0)||Promise)((function(e,t){function n(e){try{a(o.next(e))}catch(e){t(e)}}function s(e){try{a(o.throw(e))}catch(e){t(e)}}function a(t){var r;t.done?e(t.value):((r=t.value)instanceof i?r:new i((function(e){e(r)}))).then(n,s)}a((o=o.apply(r,[])).next())}));var r,i,o}))},_e.prototype.lines=function(){return this.dbSaver.lines(this.tableName)},_e.prototype.deleteByCount=function(e){return this.dbSaver.deleteByCount(this.tableName,e)},_e.prototype.deleteAll=function(){return this.dbSaver.deleteAll(this.tableName)},_e),U=(ge.prototype.openDB=function(e){return L(this,void 0,void 0,(function(){var t,n,r=this;return P(this,(function(i){switch(i.label){case 0:return t=window.indexedDB.open(e.database,e.version),n=this,[4,new Promise((function(n){t.onupgradeneeded=function(t){var n=t.target&&t.target.result;e.tableList.forEach((function(e){var t;n.objectStoreNames.contains(e.tableName)||(t=n.createObjectStore(e.tableName,{keyPath:"id",autoIncrement:!0}),e.tableItems.forEach((function(e){e.index&&t.createIndex(e.itemName,e.itemName,{unique:e.unique})})))}))},t.onsuccess=function(e){e=e.target&&e.target.result,r.db=e,n(t)}}))];case 1:return n.dbRequest=i.sent(),[2]}}))}))},ge.prototype.checkConn=function(){if(!this.dbRequest&&!this.db)throw new Error("indexDB not open")},ge.prototype.save=function(e,t){var n=this;return new Promise((function(r,i){return L(n,void 0,void 0,(function(){var n,o;return P(this,(function(s){return this.checkConn(),n=this.db.transaction([e],"readwrite").objectStore(e),(o=n.add(t)).onsuccess=function(e){r(o.result)},o.onerror=function(e){i("save item fail")},[2]}))}))}))},ge.prototype.update=function(e,t){var n=this;return new Promise((function(e,t){n.checkConn(),e()}))},ge.prototype.queryById=function(e,t){var n=this;return new Promise((function(r,i){return L(n,void 0,void 0,(function(){var n,o;return P(this,(function(s){return this.checkConn(),n=this.db.transaction([e]).objectStore(e),(o=n.get(t)).onsuccess=function(e){o.result?r(o.result):r(null)},o.onerror=function(e){i()},[2]}))}))}))},ge.prototype.queryByCursor=function(e,t){var n=this;return new Promise((function(r,i){return L(n,void 0,void 0,(function(){var n,o;return P(this,(function(s){return this.checkConn(),o=this.db.transaction([e]).objectStore(e),n=[],(o=o.openCursor()).onsuccess=function(e){(e=null==(e=e.target)?void 0:e.result)&&(!t||n.length<t)?(n.push(e.value),e.continue()):r(n)},o.onerror=function(e){i()},[2]}))}))}))},ge.prototype.lines=function(e){var t=this;return new Promise((function(n,r){return L(t,void 0,void 0,(function(){var t,i;return P(this,(function(o){return this.checkConn(),t=(t=this.db.transaction([e]).objectStore(e)).openCursor(),i=0,t.onsuccess=function(e){(e=null==(e=e.target)?void 0:e.result)?(i++,e.continue()):n(i)},t.onerror=function(e){r()},[2]}))}))}))},ge.prototype.openCursor=function(e){return this.checkConn(),this.db.transaction([e]).objectStore(e).openCursor()},ge.prototype.deleteById=function(e,t){var n=this;return new Promise((function(r,i){return L(n,void 0,void 0,(function(){var n;return P(this,(function(o){return this.checkConn(),(n=(n=this.db.transaction([e],"readwrite").objectStore(e)).delete(t)).onsuccess=function(e){r()},n.onerror=function(e){i()},[2]}))}))}))},ge.prototype.deleteByCount=function(e,t){var n=this;return new Promise((function(r,i){return L(n,void 0,void 0,(function(){var n,i;return P(this,(function(o){switch(o.label){case 0:this.checkConn(),n=8192,o.label=1;case 1:return 0<t?[4,this.queryByCursor(e,Math.min(t,n))]:[3,4];case 2:return 0===(i=o.sent()).length?[3,4]:(t-=n,[4,this.deleteItems(e,i)]);case 3:return o.sent(),[3,1];case 4:return r(),[2]}}))}))}))},ge.prototype.deleteAll=function(e){var t=this;return new Promise((function(n,r){return L(t,void 0,void 0,(function(){var t;return P(this,(function(i){return this.checkConn(),(t=(t=this.db.transaction([e],"readwrite").objectStore(e)).clear()).onsuccess=function(e){n()},t.onerror=function(e){r()},[2]}))}))}))},ge.prototype.deleteItems=function(e,t){var n=this;return new Promise((function(r){return L(n,void 0,void 0,(function(){var n;return P(this,(function(i){switch(i.label){case 0:return this.checkConn(),n=this.db.transaction([e],"readwrite").objectStore(e),[4,Promise.all(t.map((function(e){return new Promise((function(t,r){var i=n.delete(e.id);i.onsuccess=function(e){t()},i.onerror=function(e){r()}}))})))];case 1:return i.sent(),r(),[2]}}))}))}))},ge),B={version:1,database:"zego_logger_db",tableList:[{tableName:"zego_log",tableItems:[{itemName:"log",index:!1,unique:!1}]}]};function H(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function z(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var c=[a,u];if(n)throw new TypeError("Generator is already executing.");for(;o=s&&c[s=0]?0:o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,(c=i?[2&c[0],i.value]:c)[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=0<(i=o.trys).length&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3]))o.label=c[1];else if(6===c[0]&&o.label<i[1])o.label=i[1],i=c;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(c)}}c=t.call(e,o)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function G(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function F(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var c=[a,u];if(n)throw new TypeError("Generator is already executing.");for(;o=s&&c[s=0]?0:o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,(c=i?[2&c[0],i.value]:c)[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=0<(i=o.trys).length&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3]))o.label=c[1];else if(6===c[0]&&o.label<i[1])o.label=i[1],i=c;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(c)}}c=t.call(e,o)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}j=function(e,t){return(j=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}j(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(pe,q=A);var q,j,V,Y,W,Z,K,$,X,Q,J,ee,te,ne,re=pe,ie=function(){return(ie=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},oe=(fe.prototype.pushTask=function(e,t,n,r,i){e={task:e},t&&(e=ie(ie({},e),{args:t})),n&&(e=ie(ie({},e),{successCallback:n})),r&&(e=ie(ie({},e),{errorCallback:r})),i&&(e=ie(ie({},e),{completeCallback:i})),this.queue.push(e)},fe.prototype.runTaskQueueItem=function(e){return H(this,void 0,void 0,(function(){var t,n;return z(this,(function(r){switch(r.label){case 0:t=null,r.label=1;case 1:return r.trys.push([1,4,5,6]),e&&e.args?t=e.task.apply(e,e.args):e&&(t=e.task()),t instanceof Promise?[4,t]:[3,3];case 2:t=r.sent(),r.label=3;case 3:return e.successCallback&&e.successCallback(t),[3,6];case 4:if(n=r.sent(),e.errorCallback)return e.errorCallback(n),[3,6];throw n;case 5:return e.completeCallback&&e.completeCallback(),[7];case 6:return[2]}}))}))},fe.prototype.runATask=function(){return H(this,void 0,void 0,(function(){var e;return z(this,(function(t){switch(t.label){case 0:return this.queue.length<=0?[2]:(e=this.queue.shift())?[4,this.runTaskQueueItem(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},fe.prototype.runAllTask=function(){return H(this,void 0,void 0,(function(){var e;return z(this,(function(t){switch(t.label){case 0:return 0<this.queue.length?(e=this.queue.shift())?[4,this.runTaskQueueItem(e)]:[3,2]:[3,3];case 1:t.sent(),t.label=2;case 2:return[3,0];case 3:return[2]}}))}))},fe.prototype.size=function(){return this.queue.length},fe),se=(t=n(2),n.n(t)),ae=(de.prototype.writeLine=function(e){e&&""!==e&&this.cacheLines.push(e)},de.prototype.saveAs=function(e,t){var n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.click()},de.prototype.createZip=function(){return e=this,n=function(){var e,t;return function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var c=[a,u];if(n)throw new TypeError("Generator is already executing.");for(;o=s&&c[s=0]?0:o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,(c=i?[2&c[0],i.value]:c)[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=0<(i=o.trys).length&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3]))o.label=c[1];else if(6===c[0]&&o.label<i[1])o.label=i[1],i=c;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(c)}}c=t.call(e,o)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,(function(n){switch(n.label){case 0:e=new se.a,t="",0<this.cacheLines.length&&(t=this.cacheLines.join("\n"),this.cacheLines=[]),t=new Blob([t],{type:"text/plain;charset=utf-8"}),e.file("log.txt",t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.generateAsync({type:"blob"})];case 2:return[2,n.sent()];case 3:throw t=n.sent(),console.error("create zip file failed",t),t;case 4:return[2]}}))},new(t=(t=void 0)||Promise)((function(r,i){function o(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var n;e.done?r(e.value):((n=e.value)instanceof t?n:new t((function(e){e(n)}))).then(o,s)}a((n=n.apply(e,[])).next())}));var e,t,n},de),ue=(he.prototype.isUploadFieldReady=function(){return!!(this.configState.appid&&this.configState.userid&&""!==this.configState.userid&&this.configState.token&&""!==this.configState.token&&this.configState.deviceid&&""!==this.configState.deviceid)},he.prototype.setUploadUrl=function(e){this.uploadUrl=e},he.prototype.upload=function(e){return G(this,void 0,void 0,(function(){var t=this;return F(this,(function(n){if(this.isUploadFieldReady())return[2,new Promise((function(n,r){return G(t,void 0,void 0,(function(){var t,i=this;return F(this,(function(o){switch(o.label){case 0:return t=function(){return G(i,void 0,void 0,(function(){var t,n,i=this;return F(this,(function(o){switch(o.label){case 0:this.updateLocked=!0,(t=new FormData).append("logs",e),t.append("hello",this.configState.appid.toString()),t.append("appid",this.configState.appid.toString()),t.append("uin",this.configState.userid.toString()),t.append("timestamp",(new Date).getTime().toString()),t.append("token",this.configState.token),t.append("deviceid",this.configState.deviceid),o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,ce.post(this.uploadUrl,t)];case 2:if(0!==(n=o.sent()).code)throw new Error("upload logs failed, error=".concat(JSON.stringify(n)));return[3,5];case 3:return n=o.sent(),r(n),[3,5];case 4:return setTimeout((function(){return G(i,void 0,void 0,(function(){return F(this,(function(e){switch(e.label){case 0:return this.updateLocked=!1,[4,this.taskQueue.runATask()];case 1:return e.sent(),[2]}}))}))}),100),[7];case 5:return[2]}}))}))},this.updateLocked?(this.taskQueue.pushTask(t,[],(function(){n()}),(function(e){r(e)})),[3,3]):[3,1];case 1:return[4,t()];case 2:o.sent(),n(),o.label=3;case 3:return[2]}}))}))}))];throw new Error("cannot upload logs, please login room before you upload logs.")}))}))},he),ce=(le.post=function(e,t){return new Promise((function(n,r){try{var i=new XMLHttpRequest;i.open("POST",e,!0),i.responseType="json",i.send(t),i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status?n(i.response):r("request fail. status="+i.status))}}catch(n){r(n)}}))},le);function le(){}function he(e){this.configState=e,this.defaultDomain="detaillog-global.zego.im",this.uploadUrl="https://".concat(this.defaultDomain,"/log/userupload"),this.taskQueue=new oe,this.updateLocked=!1}function de(){this.cacheLines=[]}function fe(){this.queue=[]}function pe(){return null!==q&&q.apply(this,arguments)||this}function ge(){}function _e(e){this.dbSaver=e,this.tableName="zego_log"}function me(e){var t=V.call(this)||this;return t.configState=e,t}function ve(){this.queue=[]}function ye(){}function Se(){this._strategy=i.DEFAULT}function Ee(e){return(e=J.call(this,e)||this).maxDelay=10,e.maxPacketLen=20480,e}function be(){var e=null!==te&&te.apply(this,arguments)||this;return e.maxDelay=10,e.maxPacketLen=20480,e.locked=!1,e}function Te(e,t,n){this.ws=e,this.cache=t,this.strategy=n,this.strategy.onCanSendActive=this.active.bind(this)}function Ce(e,t,n){this.cache=e,this.configState=t,this.innerLogger=n,this.websocket=null,this.websocketState="never_opened",this.senderBuilder=new O,this.sender=null}function we(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function Re(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var c=[a,u];if(n)throw new TypeError("Generator is already executing.");for(;o=s&&c[s=0]?0:o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,(c=i?[2&c[0],i.value]:c)[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=0<(i=o.trys).length&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3]))o.label=c[1];else if(6===c[0]&&o.label<i[1])o.label=i[1],i=c;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(c)}}c=t.call(e,o)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function Ie(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function ke(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var c=[a,u];if(n)throw new TypeError("Generator is already executing.");for(;o=s&&c[s=0]?0:o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,(c=i?[2&c[0],i.value]:c)[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=0<(i=o.trys).length&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3]))o.label=c[1];else if(6===c[0]&&o.label<i[1])o.label=i[1],i=c;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(c)}}c=t.call(e,o)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var Oe=function(){return(Oe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ne=(xe.prototype.build=function(e){var t=Oe(Oe({},JSON.parse(e)),{sdkid:this.sdkid});if(++this.buildedCount%100==0)return(e=JSON.stringify(t)).substring(1,e.length-1);for(n in t)this.excludedKeys.includes(n)||(t[n]===this.logCtx[n]?delete t[n]:this.logCtx[n]=t[n]);var n,r=[];for(n in t)this.excludedKeys.includes(n)?r.push(t[n]):r.push("".concat(n,":").concat(t[n]));return r.join(",")},xe.prototype.buildFullMessageLog=function(e){return e=JSON.parse(e),e=Oe(Oe(Oe({},this.logCtx),e),{sdkid:this.sdkid}),JSON.stringify(e)},xe),Ae=(Object.defineProperty(De.prototype,"dbOpened",{get:function(){return this._dbOpened},enumerable:!1,configurable:!0}),Object.defineProperty(De.prototype,"dbTryOpened",{get:function(){return this._dbTryOpen},enumerable:!1,configurable:!0}),De.prototype.makeStorageSpace=function(){return we(this,void 0,void 0,(function(){var e;return Re(this,(function(t){switch(t.label){case 0:return[4,this.logModel.lines()];case 1:return 153600<(e=t.sent())?[4,this.logModel.deleteByCount(e/2)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},De.prototype.makeStorageSpaceUpload=function(){return we(this,void 0,void 0,(function(){var e,t=this;return Re(this,(function(n){return this.zipLogEnabled?(e=function(){return we(t,void 0,void 0,(function(){return Re(this,(function(e){switch(e.label){case 0:return[4,this.logModel.lines()];case 1:return 3072<e.sent()?[4,this.startASdkUploadTask()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},[2,new Promise((function(n,r){return we(t,void 0,void 0,(function(){var t;return Re(this,(function(i){switch(i.label){case 0:return this.dbOpened?[3,1]:(this.dbTaskQueue.pushTask(e,[],(function(){n()}),(function(e){r(e)})),[3,5]);case 1:return i.trys.push([1,3,,4]),[4,e()];case 2:return i.sent(),[3,4];case 3:return t=i.sent(),r(t),[2];case 4:n(),i.label=5;case 5:return[2]}}))}))}))]):[2]}))}))},De.prototype.openDB=function(){return we(this,void 0,void 0,(function(){return Re(this,(function(e){switch(e.label){case 0:return this._dbTryOpen?[2]:(this._dbTryOpen=!0,[4,this.dbSaver.openDB(B)]);case 1:return e.sent(),this._dbOpened=!0,[4,this.makeStorageSpace()];case 2:return e.sent(),[4,this.dbTaskQueue.runAllTask()];case 3:return e.sent(),[4,this.uploadTaskQueue.runATask()];case 4:return e.sent(),this.activeSaving(),[2]}}))}))},De.prototype.shouldOpenDB=function(){return this.zipLogEnabled&&De.isEnvSupport()&&!this._dbOpened&&!this._dbTryOpen},De.prototype.enable=function(){this.zipLogEnabled||(this.zipLogEnabled=!0,this.shouldOpenDB()&&this.openDB())},De.prototype.saveLog=function(e){this.shouldOpenDB()&&this.openDB(),this.cache.push(this.zipLogBuilder.build(e)),this.activeSaving()},De.prototype.removeLogList=function(e){return we(this,void 0,void 0,(function(){return Re(this,(function(t){switch(t.label){case 0:return 0===e.length?[2]:[4,this.logModel.delete(e)];case 1:return t.sent(),[2]}}))}))},De.prototype.empty=function(){return we(this,void 0,void 0,(function(){return Re(this,(function(e){switch(e.label){case 0:return[4,this.logModel.queryList(1)];case 1:return[2,0===e.sent().length]}}))}))},De.prototype.activeSaving=function(){var e,t=this;this.zipLogEnabled&&this.dbOpened&&!this.activating&&(this.activating=!0,(e=function(){var n=t.cache.front();n?t.logModel.save(n).then((function(){t.cache.pop(),e()})).catch((function(e){t.activating=!1,console.error(e)})):t.activating=!1})())},De.isEnvSupport=function(){return!(!window||!("indexedDB"in window))},De.prototype.uploadTask=function(){return we(this,void 0,void 0,(function(){var e,t,n;return Re(this,(function(r){switch(r.label){case 0:return[4,this.logModel.lines()];case 1:e=r.sent(),t=function(){var t,r,i;return Re(this,(function(o){switch(o.label){case 0:return[4,n.logModel.queryList(Math.min(3145728,e))];case 1:return t=o.sent(),e-=3145728,t.length<=0?[2,"break"]:(r=new ae,t.forEach((function(e){r.writeLine(e.log)})),[4,r.createZip()]);case 2:return i=o.sent(),[4,n.zipLogUploader.upload(i)];case 3:return o.sent(),[4,n.logModel.delete(t)];case 4:return o.sent(),[2]}}))},n=this,r.label=2;case 2:return 0<e?[5,t()]:[3,4];case 3:return"break"===r.sent()?[3,4]:[3,2];case 4:return[2]}}))}))},De.prototype.startASdkUploadTask=function(){var e=this;return new Promise((function(t,n){return we(e,void 0,void 0,(function(){var e,r=this;return Re(this,(function(i){return e=function(){return we(r,void 0,void 0,(function(){return Re(this,(function(e){switch(e.label){case 0:return[4,this.uploadTask()];case 1:return e.sent(),[2]}}))}))},this.uploadTaskQueue.pushTask(e,[],(function(){t()}),(function(e){n(e)}),(function(){0<r.uploadTaskQueue.size()&&r.uploadTaskQueue.runATask()})),this.dbOpened&&1===this.uploadTaskQueue.size()&&this.uploadTaskQueue.runATask(),[2]}))}))}))},De.prototype.startAUserUploadTask=function(){var e=this;return new Promise((function(t,n){return we(e,void 0,void 0,(function(){var e,r=this;return Re(this,(function(i){return this.userLastUploadSuccess=!1,this.userUploading=!0,e=function(){return we(r,void 0,void 0,(function(){return Re(this,(function(e){switch(e.label){case 0:return this.userUploading=!0,[4,this.uploadTask()];case 1:return e.sent(),[2]}}))}))},this.uploadTaskQueue.pushTask(e,[],(function(){r.userLastUploadSuccess=!0,r.userUploading=!1,t()}),(function(e){r.userUploading=!1,n(e)}),(function(){0<r.uploadTaskQueue.size()&&r.uploadTaskQueue.runATask()})),this.dbOpened&&1===this.uploadTaskQueue.size()&&this.uploadTaskQueue.runATask(),[2]}))}))}))},De.prototype.setUploadUrl=function(e){this.zipLogUploader.setUploadUrl(e)},De.prototype.startUpload=function(){return we(this,void 0,void 0,(function(){return Re(this,(function(e){switch(e.label){case 0:if(!this.zipLogEnabled)throw new Error("zip logs upload is not enabled.");if(0!==this.userLastUploadTime&&performance.now()-this.userLastUploadTime<6e4&&this.userLastUploadSuccess||this.userUploading)throw new Error("Logs upload failed. Do not report frequently.");return this.userLastUploadTime=performance.now(),[4,this.startAUserUploadTask()];case 1:return e.sent(),[2]}}))}))},De.prototype.destroy=function(){},De),Le=function(){return(Le=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Pe=(Object.defineProperty(Me.prototype,"url",{get:function(){return this.configState.url||""},set:function(e){this.configState.url=e},enumerable:!1,configurable:!0}),Object.defineProperty(Me.prototype,"logType",{get:function(){return this.configState.logType||o.DISABLE},set:function(e){this.configState.logType=e},enumerable:!1,configurable:!0}),Object.defineProperty(Me.prototype,"env",{get:function(){return this.configState.env},set:function(e){this.configState.env=e},enumerable:!1,configurable:!0}),Object.defineProperty(Me.prototype,"appid",{get:function(){return this.configState.appid},set:function(e){this.configState.appid=e},enumerable:!1,configurable:!0}),Object.defineProperty(Me.prototype,"roomid",{get:function(){return this.configState.roomid},set:function(e){this.configState.roomid=e},enumerable:!1,configurable:!0}),Object.defineProperty(Me.prototype,"sessionid",{get:function(){return this.configState.sessionid},set:function(e){this.configState.sessionid=e},enumerable:!1,configurable:!0}),Object.defineProperty(Me.prototype,"userid",{get:function(){return this.configState.userid},set:function(e){this.configState.userid=e},enumerable:!1,configurable:!0}),Object.defineProperty(Me.prototype,"userName",{get:function(){return this.configState.userName},set:function(e){this.configState.userName=e},enumerable:!1,configurable:!0}),Object.defineProperty(Me.prototype,"version",{get:function(){return this.configState.userName},set:function(e){this.configState.version=e},enumerable:!1,configurable:!0}),Me.prototype.setLogLevel=function(e){return void 0!==(e=u[e])&&(this.logLevel=e,!0)},Me.prototype.setRemoteLogLevel=function(e){return void 0!==(e=u[e])&&(this.logRemoteLevel=e,!0)},Me.prototype.setSessionInfo=function(e,t,n,r,i,o){this.appid=e,this.roomid=t,this.sessionid=n,this.userid=r,this.userName=i,this.version=o},Me.prototype.setTokenInfo=function(e,t){this.configState.token=e,t&&(this.configState.userid=t)},Me.prototype.setZipLogConfig=function(e,t){1===e&&this.zipLogContext?this.zipLogContext.enable():0==e&&t&&this.zipLogContext&&(this.zipLogContext.destroy(),this.zipLogContext=null)},Me.prototype.setZipLogUploadUrl=function(e){this.zipLogContext&&this.zipLogContext.setUploadUrl(e)},Me.prototype.makeZipLogSpaceUpload=function(){return Ie(this,void 0,void 0,(function(){return ke(this,(function(e){switch(e.label){case 0:return this.zipLogContext?[4,this.zipLogContext.makeStorageSpaceUpload()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},Me.prototype.uploadStorageLog=function(){return Ie(this,void 0,void 0,(function(){return ke(this,(function(e){switch(e.label){case 0:return this.zipLogContext?[4,this.zipLogContext.startUpload()]:[3,2];case 1:return e.sent(),[3,3];case 2:throw new Error("cannot use zip log module");case 3:return[2]}}))}))},Me.prototype.report=function(e){e=this.logReportParamList(u.REPORT,e),this.logLevel!==u.DISABLE&&this.logLevel<=u.REPORT&&console.debug(e),this.RemoteLog(u.REPORT,e,!0)},Me.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.logParamList(u.DEBUG,e.join(""));this.logLevel!==u.DISABLE&&this.logLevel<=u.DEBUG&&console.debug(n),this.log(u.DEBUG,n)},Me.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.logParamList(u.INFO,e.join(""));this.logLevel!==u.DISABLE&&this.logLevel<=u.INFO&&console.info(n),this.log(u.INFO,n)},Me.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.logParamList(u.WARN,e.join(""));this.logLevel!==u.DISABLE&&this.logLevel<=u.WARN&&console.warn(n),this.log(u.WARN,n)},Me.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.logParamList(u.ERROR,e.join(""));this.logLevel!==u.DISABLE&&this.logLevel<=u.ERROR&&(console.error(n),this.env%2===r.BROWSER&&window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):(this.env,r.WEIXINMINI)),this.log(u.ERROR,n)},Me.prototype.log=function(e,t){this.logRemoteLevel!==u.DISABLE&&this.logRemoteLevel<=e&&(this.RemoteLog(e,t),this.zipLogContext)&&this.zipLogContext.saveLog(t)},Me.prototype.setLogServer=function(e){if(this.isDestroy)return!1;try{return e.startsWith("wss:")?(this.logType=o.WEBSOCKET,this.netContext.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=o.HTTPS,this.openHttpsLogServer(e)):this.logType=o.DISABLE,!0}catch(e){return this.error(JSON.stringify(e)),!1}},Me.prototype.stopLogServer=function(){this.logType==o.WEBSOCKET?this.stopWebSocketServer():this.logType==o.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=o.DISABLE},Me.prototype.stopWebSocketServer=function(){this.netContext.stopWebSocketServer()},Me.prototype.openHttpsLogServer=function(e){var t=this;(this.url=e)&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){t.SendHttpsLog()}),this.logUploadInterval)))},Me.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},Me.prototype.RemoteLog=function(e,t,n){return void 0===n&&(n=!1),Ie(this,void 0,void 0,(function(){return ke(this,(function(r){if(""!=this.url&&!this.isDestroy)if(this.logType==o.WEBSOCKET)this.RemoteWebSocketLog(e,t);else if(this.logType==o.HTTPS)this.RemoteHttpsLog(e,t,n);else if(this.logLevel!==u.DISABLE&&this.logLevel<=e)for(this.logCache.push(t);this.logCache.size()>this.logCacheMax;)this.logCache.pop();return[2]}))}))},Me.prototype.clearLogCache=function(){var e=this;this.netContext.connected()&&this.logCache.clear().forEach((function(t){e.netContext.wsSend(t)}))},Me.prototype.clearCache=function(){0!==this.logCache.size()&&this.clearLogCache()},Me.prototype.saveLog=function(e){this.logCache.size()<this.logCacheMax&&this.logCache.push(e)},Me.prototype.websocketSendLog=function(e){this.netContext.connected()?this.netContext.wsSend(e):this.saveLog(e)},Me.prototype.RemoteWebSocketLog=function(e,t){return Ie(this,void 0,void 0,(function(){var e;return ke(this,(function(n){return"string"==typeof t&&4e3<t.length?console.info("log over maximum, ignore"):this.configState.useStrategy&&this.env==r.BROWSER?this.netContext.addRemoteWsLog(t):this.netContext.closed()?(e=this.url,this.url="",this.setLogServer(e),this.saveLog(t)):this.netContext.connecting()?this.saveLog(t):this.netContext.connected()&&(this.clearCache(),this.websocketSendLog(t)),[2]}))}))},Me.prototype.RemoteHttpsLog=function(e,t,n){this.logCache.push(t),(this.logCache.size()>=this.logCacheMax||!0===n)&&this.SendHttpsLog()},Me.prototype.logParamList=function(e,t){var n={time:n=m(),level:e,action:(t=[t.substr(0,t.indexOf(" "))||t,t.substr(t.indexOf(" ")+1,4500)||t])[0],content:t[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(n)},Me.prototype.logReportParamList=function(e,t){var n=m(),i=this.env%2===r.BROWSER?"rtc":"ali";return t=Le(Le({},t),{time:n,level:e,console:i,appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+t.event_time+"_"+t.seq}),JSON.stringify(t)},Me.prototype.SendHttpsLog=function(){0!=this.logCache.size()&&(this.env%2===r.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},Me.prototype.SendHttpsLogWeb=function(){var e=this,t=this.logCache.buffer.join("\n"),n=this.logCache.buffer,r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState){if(200==r.status){if(0==r.responseText.length)return;try{var t=JSON.parse(r.responseText).interval;"number"==typeof t&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))}catch(t){e.logCache.buffer=n.concat(e.logCache.buffer),console.log("send result failed "+t)}}else e.logCache.buffer=n.concat(e.logCache.buffer),console.log("send failed "+r.status);n=null}},r.open("POST",this.url,!0),0==this.env?r.send(t):1==this.env&&(r.setRequestHeader("content-type","application/json"),r.send(JSON.stringify({user_id:this.userid,log:t}))),this.logCache.buffer=[]},Me.prototype.SendHttpsLogWeChatMini=function(){},Me.prototype.destroy=function(){this.stopLogServer(),this.logUploadTimer&&clearTimeout(this.logUploadTimer),s.instance=void 0,this.netContext.destroy(),this.zipLogContext&&this.zipLogContext.destroy(),this.url=""},Me.logVersion="1.4.0",Me);function Me(e){var t=this;this.logLevel=u.INFO,this.logRemoteLevel=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.existUserID=!1,this.isDestroy=!1,this.logCacheMax=8192,this.innerLogger={debug:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.debug.apply(t,e)},info:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.info.apply(t,e)},warn:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.warn.apply(t,e)},error:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.error.apply(t,e)}},this.stateCenter=s.getInstance(),this.configState=new k,this.configState.env=e,this.logCache=new D(this.configState),this.netContext=new S(this.logCache,this.configState,this.innerLogger),this.env==r.BROWSER&&Ae.isEnvSupport()&&(this.zipLogContext=new Ae(this.configState))}function De(e){this.configState=e,this.dbSaver=new U,this.logModel=new x(this.dbSaver),this._dbOpened=!1,this._dbTryOpen=!1,this.cache=new re,this.activating=!1,this.dbTaskQueue=new oe,this.uploadTaskQueue=new oe,this.zipLogEnabled=!1,this.userLastUploadTime=0,this.userLastUploadSuccess=!1,this.userUploading=!1,this.zipLogUploader=new ue(this.configState),this.zipLogBuilder=new Ne(this.configState)}function xe(e){this.configState=e,this.logCtx={},this.excludedKeys=["time","action","content","sdkid"],this.buildedCount=0,this.sdkid=crypto.getRandomValues(new Uint8Array(5)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():62<t?"-":"_")),"")}}],o={},r.m=i,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10))},function(e,t,n){e.exports=function(e){for(var t=Math,n=e,r=n.lib,i=r.WordArray,o=r.Hasher,s=n.algo,a=[],u=0;u<64;u++)a[u]=4294967296*t.abs(t.sin(u+1))|0;var c=s.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,s=e[t+0],u=e[t+1],c=e[t+2],p=e[t+3],g=e[t+4],_=e[t+5],m=e[t+6],v=e[t+7],y=e[t+8],S=e[t+9],E=e[t+10],b=e[t+11],T=e[t+12],C=e[t+13],w=e[t+14],R=e[t+15],I=o[0],k=o[1],O=o[2],N=o[3];I=l(I,k,O,N,s,7,a[0]),N=l(N,I,k,O,u,12,a[1]),O=l(O,N,I,k,c,17,a[2]),k=l(k,O,N,I,p,22,a[3]),I=l(I,k,O,N,g,7,a[4]),N=l(N,I,k,O,_,12,a[5]),O=l(O,N,I,k,m,17,a[6]),k=l(k,O,N,I,v,22,a[7]),I=l(I,k,O,N,y,7,a[8]),N=l(N,I,k,O,S,12,a[9]),O=l(O,N,I,k,E,17,a[10]),k=l(k,O,N,I,b,22,a[11]),I=l(I,k,O,N,T,7,a[12]),N=l(N,I,k,O,C,12,a[13]),O=l(O,N,I,k,w,17,a[14]),I=h(I,k=l(k,O,N,I,R,22,a[15]),O,N,u,5,a[16]),N=h(N,I,k,O,m,9,a[17]),O=h(O,N,I,k,b,14,a[18]),k=h(k,O,N,I,s,20,a[19]),I=h(I,k,O,N,_,5,a[20]),N=h(N,I,k,O,E,9,a[21]),O=h(O,N,I,k,R,14,a[22]),k=h(k,O,N,I,g,20,a[23]),I=h(I,k,O,N,S,5,a[24]),N=h(N,I,k,O,w,9,a[25]),O=h(O,N,I,k,p,14,a[26]),k=h(k,O,N,I,y,20,a[27]),I=h(I,k,O,N,C,5,a[28]),N=h(N,I,k,O,c,9,a[29]),O=h(O,N,I,k,v,14,a[30]),I=d(I,k=h(k,O,N,I,T,20,a[31]),O,N,_,4,a[32]),N=d(N,I,k,O,y,11,a[33]),O=d(O,N,I,k,b,16,a[34]),k=d(k,O,N,I,w,23,a[35]),I=d(I,k,O,N,u,4,a[36]),N=d(N,I,k,O,g,11,a[37]),O=d(O,N,I,k,v,16,a[38]),k=d(k,O,N,I,E,23,a[39]),I=d(I,k,O,N,C,4,a[40]),N=d(N,I,k,O,s,11,a[41]),O=d(O,N,I,k,p,16,a[42]),k=d(k,O,N,I,m,23,a[43]),I=d(I,k,O,N,S,4,a[44]),N=d(N,I,k,O,T,11,a[45]),O=d(O,N,I,k,R,16,a[46]),I=f(I,k=d(k,O,N,I,c,23,a[47]),O,N,s,6,a[48]),N=f(N,I,k,O,v,10,a[49]),O=f(O,N,I,k,w,15,a[50]),k=f(k,O,N,I,_,21,a[51]),I=f(I,k,O,N,T,6,a[52]),N=f(N,I,k,O,p,10,a[53]),O=f(O,N,I,k,E,15,a[54]),k=f(k,O,N,I,u,21,a[55]),I=f(I,k,O,N,y,6,a[56]),N=f(N,I,k,O,R,10,a[57]),O=f(O,N,I,k,m,15,a[58]),k=f(k,O,N,I,C,21,a[59]),I=f(I,k,O,N,g,6,a[60]),N=f(N,I,k,O,b,10,a[61]),O=f(O,N,I,k,c,15,a[62]),k=f(k,O,N,I,S,21,a[63]),o[0]=o[0]+I|0,o[1]=o[1]+k|0,o[2]=o[2]+O|0,o[3]=o[3]+N|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;n[i>>>5]|=128<<24-i%32;var o=t.floor(r/4294967296),s=r;n[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,u=a.words,c=0;c<4;c++){var l=u[c];u[c]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,n,r,i,o,s){var a=e+(t&n|~t&r)+i+s;return(a<<o|a>>>32-o)+t}function h(e,t,n,r,i,o,s){var a=e+(t&r|n&~r)+i+s;return(a<<o|a>>>32-o)+t}function d(e,t,n,r,i,o,s){var a=e+(t^n^r)+i+s;return(a<<o|a>>>32-o)+t}function f(e,t,n,r,i,o,s){var a=e+(n^(t|~r))+i+s;return(a<<o|a>>>32-o)+t}return n.MD5=o._createHelper(c),n.HmacMD5=o._createHmacHelper(c),e.MD5}(n(1))},function(e,t,n){e.exports=function(e){for(var t=e,n=t.lib.BlockCipher,r=t.algo,i=[],o=[],s=[],a=[],u=[],c=[],l=[],h=[],d=[],f=[],p=[],g=0;g<256;g++)p[g]=g<128?g<<1:g<<1^283;var _=0,m=0;for(g=0;g<256;g++){var v=m^m<<1^m<<2^m<<3^m<<4;v=v>>>8^255&v^99,i[_]=v,o[v]=_;var y=p[_],S=p[y],E=p[S],b=257*p[v]^16843008*v;s[_]=b<<24|b>>>8,a[_]=b<<16|b>>>16,u[_]=b<<8|b>>>24,c[_]=b;b=16843009*E^65537*S^257*y^16843008*_;l[v]=b<<24|b>>>8,h[v]=b<<16|b>>>16,d[v]=b<<8|b>>>24,f[v]=b,_?(_=y^p[p[p[E^y]]],m^=p[p[m]]):_=m=1}var T=[0,1,2,4,8,16,32,64,128,27,54],C=r.AES=n.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,r=4*((this._nRounds=n+6)+1),o=this._keySchedule=[],s=0;s<r;s++)s<n?o[s]=t[s]:(c=o[s-1],s%n?n>6&&s%n==4&&(c=i[c>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c]):(c=i[(c=c<<8|c>>>24)>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c],c^=T[s/n|0]<<24),o[s]=o[s-n]^c);for(var a=this._invKeySchedule=[],u=0;u<r;u++){s=r-u;if(u%4)var c=o[s];else c=o[s-4];a[u]=u<4||s<=4?c:l[i[c>>>24]]^h[i[c>>>16&255]]^d[i[c>>>8&255]]^f[i[255&c]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,a,u,c,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,h,d,f,o);n=e[t+1];e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,o,s,a){for(var u=this._nRounds,c=e[t]^n[0],l=e[t+1]^n[1],h=e[t+2]^n[2],d=e[t+3]^n[3],f=4,p=1;p<u;p++){var g=r[c>>>24]^i[l>>>16&255]^o[h>>>8&255]^s[255&d]^n[f++],_=r[l>>>24]^i[h>>>16&255]^o[d>>>8&255]^s[255&c]^n[f++],m=r[h>>>24]^i[d>>>16&255]^o[c>>>8&255]^s[255&l]^n[f++],v=r[d>>>24]^i[c>>>16&255]^o[l>>>8&255]^s[255&h]^n[f++];c=g,l=_,h=m,d=v}g=(a[c>>>24]<<24|a[l>>>16&255]<<16|a[h>>>8&255]<<8|a[255&d])^n[f++],_=(a[l>>>24]<<24|a[h>>>16&255]<<16|a[d>>>8&255]<<8|a[255&c])^n[f++],m=(a[h>>>24]<<24|a[d>>>16&255]<<16|a[c>>>8&255]<<8|a[255&l])^n[f++],v=(a[d>>>24]<<24|a[c>>>16&255]<<16|a[l>>>8&255]<<8|a[255&h])^n[f++];e[t]=g,e[t+1]=_,e[t+2]=m,e[t+3]=v},keySize:8});return t.AES=n._createHelper(C),e.AES}(n(1),(n(15),n(4),n(9),n(18)))},function(e,t,n){e.exports=n(1).enc.Utf8},function(e,t,n){function r(e){var t;return(c[e]||(t=c[e]={i:e,l:!1,exports:{}},u[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}var i,o,s,a,u,c;e.exports=(i=n(8),o=n(4),s=n(5),a=n(6),u=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedList=t.ListNode=t.ENUM_CONNECT_STATE=t.ENUM_NETWORK_STATE=t.SOCKET_DISCONNECT=t.errorList=t.Queue=t.getSeq=t.E_CLIENT_TYPE=t.ENUM_LOG_LEVEL=t.ENUM_REMOTE_TYPE=t.ZEGO_BROWSER_TYPE=t.ZEGO_ENV=t.PROTO_VERSION=void 0,t.PROTO_VERSION="1.0.2",(i=t.ZEGO_ENV||(t.ZEGO_ENV={}))[i.BROWSER=0]="BROWSER",i[i.WEIXINMINI=1]="WEIXINMINI",(i=t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={}))[i.IE=0]="IE",i[i.FIREFOX=1]="FIREFOX",i[i.CHROME=2]="CHROME",i[i.SAFARI=3]="SAFARI",i[i.OPERA=4]="OPERA",i[i.WEIXIN=5]="WEIXIN",i[i.WEIXINMINI=6]="WEIXINMINI",i[i.UNKOWN=7]="UNKOWN",(i=t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={}))[i.DISABLE=0]="DISABLE",i[i.WEBSOCKET=1]="WEBSOCKET",i[i.HTTPS=2]="HTTPS",t.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},(i=t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))[i.ClientType_None=0]="ClientType_None",i[i.ClientType_H5=1]="ClientType_H5",i[i.ClientType_SmallPragram=2]="ClientType_SmallPragram",i[i.ClientType_Webrtc=3]="ClientType_Webrtc",t.getSeq=(r=1,function(){return r++}),o.prototype.isEmpty=function(){return 0==this.items.length},o.prototype.enqueue=function(e){this.items.push(e)},o.prototype.dequeue=function(){return this.isEmpty()?"Underflow":this.items.shift()},o.prototype.front=function(){return this.isEmpty()?"No elements in Queue":this.items[0]},o.prototype.size=function(){return this.items.length},o.prototype.clear=function(){this.items=[]},o.prototype.all=function(){return this.items};var r,i=o;function o(){this.items=[],this.items=[]}t.Queue=i,t.errorList={TIMEOUT:{code:100001,msg:"network timeout"},DATAEXIST:{code:100002,msg:"data exist"},BROKEN:{code:100003,msg:"network broken"}},t.SOCKET_DISCONNECT=-1,(i=t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={}))[i.offline=0]="offline",i[i.online=1]="online",(i=t.ENUM_CONNECT_STATE||(t.ENUM_CONNECT_STATE={}))[i.disconnected=0]="disconnected",i[i.connecting=1]="connecting",i[i.connected=2]="connected",Object.defineProperty(a.prototype,"id",{get:function(){return this._id||null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),a.prototype.hasNext=function(){return this.next&&this.next.id},a.prototype.hasPrev=function(){return this.prev&&this.prev.id};var s=a;function a(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}function u(){this.start=new s,this.end=new s,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}t.ListNode=s,u.prototype.insertBefore=function(e,t){return(t=new s(this._idCounter,t)).next=e,t.prev=e.prev,e.prev&&(e.prev.next=t),e.prev=t,++this._idCounter,++this._numNodes,t},u.prototype.addLast=function(e){return this.insertBefore(this.end,e)},u.prototype.add=function(e){return this.addLast(e)},u.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},u.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},u.prototype.size=function(){return this._numNodes},u.prototype.getFromFirst=function(e){var t=0,n=this.start.next;if(0<=e)for(;t<e&&null!==n;)n=n.next,++t;else n=null;if(null===n)throw"Index out of bounds.";return n},u.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},u.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},u.prototype.removeFirst=function(){return 0<this._numNodes&&this.start.next?this.remove(this.start.next):null},u.prototype.removeLast=function(){return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):null},u.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},u.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},u.prototype.find=function(e){for(var t=this.start,n=!1,r=null;t.hasNext()&&!n;)e(t=t.next)&&(r=t,n=!0);return r},u.prototype.map=function(e){for(var t=this.start,n=[];t.hasNext();)e(t=t.next)&&n.push(t);return n},u.prototype.push=function(e){return this.addLast(e)},u.prototype.unshift=function(e){0<this._numNodes?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},u.prototype.pop=function(){return this.removeLast()},u.prototype.shift=function(){return this.removeFirst()},t.LinkedList=u},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.ContextAPI=t.suppressInstrumentation=t.ROOT_CONTEXT=t.BaseContext=t.setSpan=t.getSpanContext=t.getSpan=t.createContextKey=void 0,n(16));function s(e){return Symbol.for(e)}var a=(t.createContextKey=s)("OpenTelemetry Context Key SUPPRESS_INSTRUMENTATION"),u=s("OpenTelemetry Context Key SPAN");function c(e){return e.getValue(u)||void 0}function l(e){this.name=e,this.contextManager=new o.StackContextManager}t.getSpan=c,t.getSpanContext=function(e){return null==(e=c(e))?void 0:e.context()},t.setSpan=function(e,t){return e.setValue(u,t)},t.BaseContext=n=function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var i=new e(n._currentContext);return i._currentContext.set(t,r),i},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},t.ROOT_CONTEXT=new n,t.suppressInstrumentation=function(e){return e.setValue(a,!0)},l.getInstance=function(e){return void 0===e&&(e="context"),this._instance||(this._instance=new l(e)),this._instance},l.prototype.active=function(){return this.contextManager.active()},l.prototype.with=function(e,t,n){for(var r,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return(r=this._getContextManager()).with.apply(r,i([e,t,n],o))},l.prototype._getContextManager=function(){return this.contextManager},t.ContextAPI=l},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.INVALID_SPAN_CONTEXT=t.INVALID_TRACEID=t.INVALID_SPANID=t.TraceFlags=t.SpanKind=t.SpanStatusCode=void 0,(r=t.SpanStatusCode||(t.SpanStatusCode={}))[r.UNSET=0]="UNSET",r[r.OK=1]="OK",r[r.ERROR=2]="ERROR",(r=t.SpanKind||(t.SpanKind={}))[r.INTERNAL=0]="INTERNAL",r[r.SERVER=1]="SERVER",r[r.CLIENT=2]="CLIENT",r[r.PRODUCER=3]="PRODUCER",r[r.CONSUMER=4]="CONSUMER",(i=r=t.TraceFlags||(t.TraceFlags={}))[i.NONE=0]="NONE",i[i.SAMPLED=1]="SAMPLED",t.INVALID_SPANID="0000000000000000",t.INVALID_TRACEID="00000000000000000000000000000000",t.INVALID_SPAN_CONTEXT={traceId:t.INVALID_TRACEID,spanId:t.INVALID_SPANID,traceFlags:r.NONE}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=t.ZegoLog=void 0,i.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join("");console.log(n)},i.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join("");console.debug(n)},i.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join("");console.info(n)},i.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join("");console.warn(n)},i.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join("");console.error(n)};var r=i;function i(){}r=new(t.ZegoLog=r),t.log=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FAIL_TIME=t.FAIL_MAX_COUNT=t.FAIL_COUNT=t.STORE_SIZE=t.CACHE_SIZE=t.BUCKET_CONFIG=t.DEFAULT_CONFIG=void 0,t.DEFAULT_CONFIG={importantLevel:0,reportSize:3e3,reportNum:10,bps:16e3,netTimeout:10},t.BUCKET_CONFIG={bucketSize:1e4,tokensPerInterval:1600},t.CACHE_SIZE={totalAvailCache:102400,cacheMaxSize:2e4,cacheDelPer:.2},t.STORE_SIZE={totalDBSize:2048e3,storeDelPer:.2},t.FAIL_COUNT=5,t.FAIL_MAX_COUNT=10,t.FAIL_TIME=30},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.uuid=t.calculateMemSize=t.analyzeKey=t.getCurrentTime=t.getCurrentEnv=t.getBrowser=void 0,n(0)),o=r(n(31)),s=(t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),n=-1!=e.indexOf("Firefox"),r=null!=window.opr,o=e.indexOf("Chrome")&&window.chrome,s=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");e=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0];return t?i.ZEGO_BROWSER_TYPE.IE:n?i.ZEGO_BROWSER_TYPE.FIREFOX:r?i.ZEGO_BROWSER_TYPE.OPERA:o?i.ZEGO_BROWSER_TYPE.CHROME:s?i.ZEGO_BROWSER_TYPE.SAFARI:e?i.ZEGO_BROWSER_TYPE.WEIXIN:i.ZEGO_BROWSER_TYPE.UNKOWN},t.getCurrentEnv=function(){var e=window.navigator.userAgent;return new Promise((function(t){-1==e.indexOf("MicroMessage")?t(i.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv((function(e){e.miniprogram}))}))},["00","01","02","03","04","05","06","07","08","09"]);t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(s[e.getMonth()+1]||e.getMonth()+1)+"/",(s[e.getDate()]||e.getDate())+" ",(s[e.getHours()]||e.getHours())+":",(s[e.getMinutes()]||e.getMinutes())+":",s[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")},t.analyzeKey=function(e){return e=e.split("_"),{level:Number(e[0]),timestamp:e[1],seq:e[2]}},t.calculateMemSize=function(e){return o.default(e)},t.uuid=function(e,t){var n,r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(t=t||i.length,e)for(n=0;n<e;n++)o[n]=i[0|Math.random()*t];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;n<36;n++)o[n]||(r=0|16*Math.random(),o[n]=i[19==n?3&r|8:r]);return o.join("")}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s};function o(e){var t,n,i;if(null!=e&&Array.isArray(e))try{for(var o=r(e),s=o.next();!s.done;s=o.next()){var a=s.value;if(null!=a)if(i){if(typeof a!==i)return!1}else i=typeof a}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeAttributes=t.isAttributeValue=void 0,t.isAttributeValue=o,t.sanitizeAttributes=function(e){var t,n,s={};if(null!=e&&"object"==typeof e)try{for(var a=r(Object.entries(e)),u=a.next();!u.done;u=a.next()){var c=i(u.value,2),l=c[0],h=c[1];o(h)&&(Array.isArray(h)?s[l]=h.slice():s[l]=h)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdGenerator=void 0;var r=Array(32);function i(e){return function(){for(var t=0;t<2*e;t++)r[t]=Math.floor(16*Math.random())+48,58<=r[t]&&(r[t]+=39);return String.fromCharCode.apply(null,r.slice(0,2*e))}}t.IdGenerator=function(){this.generateTraceId=i(16),this.generateSpanId=i(8),this.generateEventId=i(4)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Resource=t.SDK_INFO=t.SemanticResourceAttributes=void 0,t.SemanticResourceAttributes={PROCESS_RUNTIME_NAME:"process.runtime.name",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version"},t.SDK_INFO=((r={})[t.SemanticResourceAttributes.TELEMETRY_SDK_NAME]="opentelemetry",r[t.SemanticResourceAttributes.PROCESS_RUNTIME_NAME]="browser",r[t.SemanticResourceAttributes.TELEMETRY_SDK_LANGUAGE]="webjs",r[t.SemanticResourceAttributes.TELEMETRY_SDK_VERSION]=t.VERSION,r),i.empty=function(){return i.EMPTY},i.createTelemetrySDKResource=function(){var e;return new i(((e={})[t.SemanticResourceAttributes.TELEMETRY_SDK_LANGUAGE]=t.SDK_INFO[t.SemanticResourceAttributes.TELEMETRY_SDK_LANGUAGE],e[t.SemanticResourceAttributes.TELEMETRY_SDK_NAME]=t.SDK_INFO[t.SemanticResourceAttributes.TELEMETRY_SDK_NAME],e[t.SemanticResourceAttributes.TELEMETRY_SDK_VERSION]=t.SDK_INFO[t.SemanticResourceAttributes.TELEMETRY_SDK_VERSION],e))},i.prototype.merge=function(e){return e&&Object.keys(e.attributes).length?new i(Object.assign({},this.attributes,e.attributes)):this},i.EMPTY=new i({});var r=i;function i(e){this.attributes=e}t.Resource=r},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.Span=void 0,n(6)),s=n(1),a=n(2),u=n(7),c=n(17);function l(e,t,n,r,i,o,s,c){void 0===c&&(c=[]),this.attributes={},this.links=[],this.events=[],this.status={code:a.SpanStatusCode.UNSET},this.endTime=0,this._ended=!1,this._duration=0,this.exported=!0,this.contextAPI=e.context,this.reporter=e.reporter,this.spanProcessor=e.spanProcessor,this.parentTracer=e,this.name=n,this.level=r,this.spanContext=i,this.parentSpanId=s,this.kind=o,this.links=c,this.startTime=Date.now(),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._traceParams=e.getActiveTraceParams(),this._idGenerator=new u.IdGenerator}l.prototype.context=function(){return this.spanContext},l.prototype.setAttribute=function(e,t){return null==t||0===e.length||!o.isAttributeValue(t)||Object.keys(this.attributes).length>=this._traceParams.numberOfAttributesPerSpan&&!Object.prototype.hasOwnProperty.call(this.attributes,e)||(this.attributes[e]=t),this},l.prototype.appendAttribute=function(e,t){return null==t||0===e.length||!o.isAttributeValue(t)||Object.keys(this.attributes).length>=this._traceParams.numberOfAttributesPerSpan&&!Object.prototype.hasOwnProperty.call(this.attributes,e)||(this.attributes[e]&&Array.isArray(this.attributes[e])?this.attributes[e].push(t):this.attributes[e]=[t]),this},l.prototype.setAttributes=function(e){var t,n;try{for(var o=r(Object.entries(e)),s=o.next();!s.done;s=o.next()){var a=i(s.value,2),u=a[0],c=a[1];this.setAttribute(u,c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return this},l.prototype.addEvent=function(e,t,n){this.events.length>=this._traceParams.numberOfEventsPerSpan&&this.events.shift();var r=this._idGenerator.generateEventId();return c.isTimeInput(t)&&(void 0===n&&(n=t),t=void 0),void 0===n&&(n=c.hrTime()),this.events.push({name:e,attributes:t,time:c.timeInputToHrTime(n),event_id:r}),this},l.prototype.setStatus=function(e){return this.status=e,this},l.prototype.updateName=function(e){return this.name=e,this},l.prototype.end=function(e){var t,n=this;this._isSpanEnded()||(this._ended=!0,this.resource=this.parentTracer.resource,this.spanProcessor.spanBeforeEnd&&this.spanProcessor.spanBeforeEnd(this),t=c.getCurrentTime(),this.setAttribute("e_time_s",t),this.endTime=Date.now(),this._duration=this.endTime-this.startTime,this.contextAPI.with(s.suppressInstrumentation(this.contextAPI.active()),(function(){var t=n.toReporterSpan(n);n.spanProcessor.spanEnd&&n.spanProcessor.spanEnd(t,n.level),t.droped||!1===e||(delete t.droped,n.reporter.report(JSON.stringify(t),n.level))})))},l.prototype.spanReport=function(){var e=this.toReporterSpan(this);this.reporter.report(JSON.stringify(e),this.level)},l.prototype.isRecording=function(){return!1===this._ended},Object.defineProperty(l.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),l.prototype._isSpanEnded=function(){return this._ended,this._ended},l.prototype.toReporterSpan=function(e){var t=[],n=(e.events.forEach((function(e){var n={};Object.keys(e).forEach((function(t){"name"===t&&(n[t]=e[t]),"time"===t&&(n.timestamp=c.hrTimeToMilliseconds(e[t])),"attributes"===t&&(n.tags=e[t])})),t.push(n)})),[]);return e.links.forEach((function(e){n.push({span_id:e.context.spanId,trace_id:e.context.traceId})})),{trace_id:e.spanContext.traceId,parent_span_id:e.parentSpanId,name:e.name,span_id:e.spanContext.spanId,kind:e.kind,start_time:e.startTime,end_time:e.endTime,duration:e.duration,logs:t,tags:e.attributes,links:n}},t.Span=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSpan=void 0;var r=n(3),i=n(9);function o(e,t){this.spanId=e,this.span=t}o.prototype.setAttribute=function(e,t){var n=this;return this.span?this.span.setAttribute(e,t):this._activeSpan().then((function(){n.span&&n.span.setAttribute(e,t)})),this},o.prototype.setAttributes=function(e){var t=this;return this.span?this.span.setAttributes(e):this._activeSpan().then((function(){t.span&&t.span.setAttributes(e)})),this},o.prototype.appendAttribute=function(e,t){var n=this;return this.span?this.span.appendAttribute(e,t):this._activeSpan().then((function(){n.span&&n.span.appendAttribute(e,t)})),this},o.prototype.addEvent=function(e,t,n){var r=this;return this.span?this.span.addEvent(e,t,n):this._activeSpan().then((function(){r.span&&r.span.addEvent(e,t,n)})),this},o.prototype.setStatus=function(e){var t=this;return this.span?this.span.setStatus(e):this._activeSpan().then((function(){t.span&&t.span.setStatus(e)})),this},o.prototype.updateName=function(e){var t=this;return this.span?this.span.updateName(e):this._activeSpan().then((function(){t.span&&t.span.updateName(e)})),this},o.prototype.end=function(e){var t=this;void 0===e&&(e=!0),this.span?this.span.end(e):this._activeSpan(!0).then((function(){t.span&&t.span.end(e),t._spanEnd()}))},o.prototype.setSpanActive=function(e){this.activeCallback=e},o.prototype.setSpanEnd=function(e){this.endCallback=e},o.prototype.spanReport=function(){var e;null!=(e=this.span)&&e.spanReport()},o.prototype._spanEnd=function(){this._isSpanNoop()||(this.removeStoreItem(this.spanId),this.endCallback&&this.endCallback(this.spanInfo))},o.prototype._isSpanNoop=function(){return"noop"===this.spanId},o.prototype._activeSpan=function(e){var t=this;return void 0===e&&(e=!1),new Promise((function(n,r){t.store.getItem(t.spanId).then((function(r){var s=new i.Span(o.tracer,o.tracer.context.active(),r.name,r.level,r.spanContext,r.kind,r.parentSpanId,r.links);s.setStatus(r.status),s.setAttributes(r.attributes),t.span=s,t.activeCallback&&t.activeCallback(t.spanId,e),n()})).catch((function(e){r(e)}))}))},o.prototype.removeStoreItem=function(e){var t=this;this.store.getItem(e).then((function(n){n&&t.store.removeItem(e).then((function(){r.log.log("remove suc")})).catch((function(e){r.log.warn("remove fail")}))}))},t.ZegoSpan=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoStore=t.ZegoWechatMiniStore=t.ZEGO_ENV=void 0;var r,i,o=n(12),s=((i=r=t.ZEGO_ENV||(t.ZEGO_ENV={}))[i.BROWSER=0]="BROWSER",i[i.WEIXINMINI=1]="WEIXINMINI",n(3)),a=(u.prototype.getItem=function(e){var t=this;return new Promise((function(n,r){try{n(wx.getStorageSync(t.keyPrefix+e))}catch(n){r(n)}}))},u.prototype.setItem=function(e,t){var n=this;return new Promise((function(r,i){try{wx.setStorageSync(n.keyPrefix+e,t),r()}catch(r){i(r)}}))},u.prototype.removeItem=function(e){var t=this;return new Promise((function(n,r){try{n(wx.removeStorageSync(t.keyPrefix+e))}catch(n){r(n)}}))},u.prototype.clear=function(){return new Promise((function(e,t){try{wx.clearStorageSync(),e()}catch(e){t(e)}}))},u.prototype.keys=function(){var e=this;return new Promise((function(t,n){try{var r=wx.getStorageInfoSync().keys,i=(s.log.warn("keys",r),[]);r.forEach((function(t){0==t.indexOf(e.keyPrefix)&&i.push(t.replace(e.keyPrefix,""))})),s.log.warn("keyArr",JSON.stringify(i)),i.sort(),t(i)}catch(t){n(t)}}))},u);function u(e){this.storeName=e,this.keyPrefix=e+"/",this.storeName}t.ZegoWechatMiniStore=a,t.createZegoStore=function(e,t,n){return t===r.BROWSER?o.createInstance({name:e+":"+(n||"store")}):new a(e)}},function(e,t){e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicCode=t.ZegoTracer=t.ZegoSpan=void 0;var r=n(14),i=(Object.defineProperty(t,"ZegoTracer",{enumerable:!0,get:function(){return r.ZegoTracer}}),n(46)),o=(Object.defineProperty(t,"DynamicCode",{enumerable:!0,get:function(){return i.DynamicCode}}),n(10));Object.defineProperty(t,"ZegoSpan",{enumerable:!0,get:function(){return o.ZegoSpan}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoTracer=void 0;var r=n(15),i=n(21),o=n(10),s=n(22),a=n(3),u=n(1),c=n(8),l=n(23),h=n(39),d=n(11),f=n(44),p=n(45);function g(){this._maxTracingSpanSize=s.DEFAULT_MAX_SPAN_SIZE,this.level=0,this.log=new f.ZegoLog,this.stateCenter=new p.StateCenter(this.log)}g.prototype.init=function(e){this.options=e,this.name=e.product,this.reporter=new l.ZegoDataReport(this.name,this.stateCenter),this.reporter.init({appID:e.appID,env:e.env||0,importantLevel:e.importantLevel,levels:e.levels,deviceID:e.deviceID,bps:e.bps,serverUrl:e.serverUrl}),this.tracer=new r.Tracer({name:this.name,version:e.version},{resource:new c.Resource(e.resources)},this.reporter,{spanStart:e.spanStart,spanBeforeEnd:e.spanBeforeEnd,spanEnd:e.spanEnd}),this.reporter.setProcessData(this.tracer.resource.attributes),this.initRoot(this.options),this.dyStore=d.createZegoStore(e.product+"_"+e.appID+"_dy",e.env||0)},g.prototype.initRoot=function(e){this.rootSpan=this.tracer.startSpan("root",0);var t=u.setSpan(this.tracer.context.active(),this.rootSpan);this.tracer.context._getContextManager()._currentContext=t,this.rootSpan.end()},g.prototype.createSpan=function(e,t,n){var r,c;return e<=this.level?(r=n&&n.parent?u.setSpan(this.tracer.context.active(),n.parent.span):u.setSpan(this.tracer.context.active(),this.rootSpan),c=[],n&&n.linkSpans&&(n.linkSpans.forEach((function(e){c.push({context:e.span.context()})})),delete n.linkSpans),t=this.tracer.startSpan(t,e,Object.assign({},n,{links:c}),r),e=new o.ZegoSpan(t.spanContext.spanId,t),o.ZegoSpan.tracer=this.tracer,e):(a.log.warn("createSpan level not fix"),new o.ZegoSpan(s.NOOP_SPAN_ID,new i.NoopSpan))},g.prototype.setLogger=function(e){this.stateCenter.logger=e},g.prototype.setTimeOffset=function(e){this.reporter.setTimeOffset(e)},g.prototype.setWaitNtpTimeout=function(e){this.reporter.setWaitNtpTimeout(e)},g.prototype.setLogLevel=function(e){return this.stateCenter._log.setLogLevel(e)},g.prototype.startReport=function(e){return this.reporter.startReport(e)},g.prototype.setConfig=function(e){this.reporter.setConfig(e)},g.prototype.loadJs=function(e,t,n,r,i,o){return h.loadJS(e,this.dyStore,t,n,r,i,o)},g.prototype.flush=function(e){this.reporter.flush(e)},g.prototype.setUnloadState=function(e){this.reporter.setUnloadState(e)},g.prototype.shutdown=function(){this.reporter.saveDataBeforeUnload()},g.prototype.destroy=function(){this.reporter.uninit()},g.prototype.setSampleConfig=function(e){this.level=e.level||this.level},g.prototype.setResource=function(e){this.tracer.setResource(e),this.reporter.setProcessData(this.tracer.resource.attributes)},g.prototype.setNetStateCheck=function(){this.reporter.setNetStateCheck()},t.ZegoTracer=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tracer=void 0;var r=n(6),i=n(1),o=n(2),s=n(7),a=n(8),u=n(9),c=n(18),l=n(19);function h(e,t,n,r){var o=l.mergeConfig(t);this._traceParams=o.traceParams,this._idGenerator=new s.IdGenerator,this.resource=null!=(o=t.resource)?o:a.Resource.createTelemetrySDKResource(),this.instrumentationLibrary=e,t=Math.random().toString(36).slice(-6),this.context=new i.ContextAPI(t),this.reporter=n,this.spanProcessor=r||{}}h.prototype.startSpan=function(e,t,n,s){var a,l,h,d=function(e,t){if(!e.root)return i.getSpanContext(t)}(n=void 0===n?{}:n,s=void 0===s?this.context.active():s),f=this._idGenerator.generateSpanId(),p=(d&&c.isSpanContextValid(d)?(a=d.traceId,l=d.traceState,h=d.spanId):a=this._idGenerator.generateTraceId(),d=null!=(d=n.kind)?d:o.SpanKind.INTERNAL,null!=(p=n.links)?p:[]),g=(n=r.sanitizeAttributes(n.attributes),o.TraceFlags.NONE);return(s=new u.Span(this,s,e,t,{traceId:a,spanId:f,traceFlags:g,traceState:l},d,h,p)).setAttributes(n),this.spanProcessor.spanStart&&this.spanProcessor.spanStart(s),s},h.prototype.setResource=function(e){this.resource=this.resource.merge(new a.Resource(e))},h.prototype.getActiveTraceParams=function(){return this._traceParams},t.Tracer=h},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.StackContextManager=void 0,n(1));function s(){this._enabled=!1,this._currentContext=o.ROOT_CONTEXT}s.prototype._bindFunction=function(e,t){function n(){for(var n=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return r.with(t,(function(){return e.apply(n,i)}))}void 0===t&&(t=o.ROOT_CONTEXT);var r=this;return Object.defineProperty(n,"length",{enumerable:!1,configurable:!0,writable:!1,value:e.length}),n},s.prototype.active=function(){return this._currentContext},s.prototype.bind=function(e,t){return void 0===(t=void 0===t?o.ROOT_CONTEXT:t)&&(t=this.active()),"function"==typeof e?this._bindFunction(e,t):e},s.prototype.disable=function(){return this._currentContext=o.ROOT_CONTEXT,this._enabled=!1,this},s.prototype.enable=function(){return this._enabled||(this._enabled=!0,this._currentContext=o.ROOT_CONTEXT),this},s.prototype.with=function(e,t,n){for(var r=[],s=3;s<arguments.length;s++)r[s-3]=arguments[s];var a=this._currentContext;this._currentContext=e||o.ROOT_CONTEXT;try{return t.call.apply(t,i([n],r))}finally{this._currentContext=a}},t.StackContextManager=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTime=t.isTimeInput=t.hrTimeToMilliseconds=t.hrTimeDuration=t.timeInputToHrTime=t.isTimeInputHrTime=t.hrTime=void 0;var r=Math.pow(10,9),i=["00","01","02","03","04","05","06","07","08","09"];function o(e){e/=1e3;var t=Math.trunc(e);return[t,Number((e-t).toFixed(9))*r]}function s(){var e,t=performance.timeOrigin;return"number"!=typeof t?(e=performance).timing&&e.timing.fetchStart:t}function a(e){var t=o(s()),n=(e=o("number"==typeof e?e:performance.now()),t[0]+e[0]);t=t[1]+e[1];return r<t&&(t-=r,n+=1),[n,t]}function u(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}t.hrTime=a,t.isTimeInputHrTime=u,t.timeInputToHrTime=function(e){if(u(e))return e;if("number"==typeof e)return(e<s()?a:o)(e);if(e instanceof Date)return o(e.getTime());throw TypeError("Invalid input type")},t.hrTimeDuration=function(e,t){var n=t[0]-e[0];return(t=t[1]-e[1])<0&&(--n,t+=r),[n,t]},t.hrTimeToMilliseconds=function(e){return Math.round(1e3*e[0]+e[1]/1e6)},t.isTimeInput=function(e){return u(e)||"number"==typeof e||e instanceof Date},t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(i[e.getMonth()+1]||e.getMonth()+1)+"/",(i[e.getDate()]||e.getDate())+" ",(i[e.getHours()]||e.getHours())+":",(i[e.getMinutes()]||e.getMinutes())+":",i[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSpanContextValid=t.isValidSpanId=t.isValidTraceId=t.INVALID_SPAN_CONTEXT=t.INVALID_TRACEID=t.INVALID_SPANID=void 0,n=n(2);var r=/^([0-9a-f]{32})$/i,i=/^[0-9a-f]{16}$/i;function o(e){return r.test(e)&&e!==t.INVALID_TRACEID}function s(e){return i.test(e)&&e!==t.INVALID_SPANID}t.INVALID_SPANID="0000000000000000",t.INVALID_TRACEID="00000000000000000000000000000000",t.INVALID_SPAN_CONTEXT={traceId:t.INVALID_TRACEID,spanId:t.INVALID_SPANID,traceFlags:n.TraceFlags.NONE},t.isValidTraceId=o,t.isValidSpanId=s,t.isSpanContextValid=function(e){return o(e.traceId)&&s(e.spanId)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeConfig=void 0;var r=n(20);t.mergeConfig=function(e){var t=Object.assign({},r.DEFAULT_CONFIG,e);return t.traceParams=Object.assign({},r.DEFAULT_CONFIG.traceParams,e.traceParams||{}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CONFIG=void 0,t.DEFAULT_CONFIG={traceParams:{numberOfAttributesPerSpan:128,numberOfLinksPerSpan:128,numberOfEventsPerSpan:128}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoopSpan=void 0;var r=n(2);function i(e){void 0===e&&(e=r.INVALID_SPAN_CONTEXT),this._spanContext=e}i.prototype.context=function(){return this._spanContext},i.prototype.setAttribute=function(e,t){return this},i.prototype.appendAttribute=function(e,t){return this},i.prototype.setAttributes=function(e){return this},i.prototype.addEvent=function(e,t,n){return this},i.prototype.setStatus=function(e){return this},i.prototype.updateName=function(e){return this},i.prototype.end=function(e){},i.prototype.isRecording=function(){return!1},i.prototype.spanReport=function(){},i.prototype.recordException=function(e,t){},t.NoopSpan=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOOP_SPAN_ID=t.SCHEDULED_DELAY_MILLIS=t.DEFAULT_MAX_SPAN_SIZE=t.readSpanKeys=void 0,t.readSpanKeys=["name","level","kind","spanContext","parentSpanId","startTime","endTime","status","attributes","links","events","duration","ended","resource","instrumentationLibrary"],t.DEFAULT_MAX_SPAN_SIZE=1e3,t.SCHEDULED_DELAY_MILLIS=3e3,t.NOOP_SPAN_ID="noop"},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,(u=i?[2&u[0],i.value]:u)[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3]))o.label=u[1];else if(6===u[0]&&o.label<i[1])o.label=i[1],i=u;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(u)}}u=t.call(e,o)}catch(a){u=[6,a],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},c=(Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoDataReport=void 0,n(0)),l=n(24),h=n(30),d=n(38),f=n(5),p=n(4);function g(e,t){this.stateCenter=t,this.QUEUE_MAX=100,this.cacheMaxSize=p.CACHE_SIZE.cacheMaxSize,this.cacheDelPer=p.CACHE_SIZE.cacheDelPer,this.state="normal",this.forceDataTotalLen=0,this.reportPackagesSize=0,this.staticConfig={totalAvailCache:p.CACHE_SIZE.totalAvailCache,totalDBSize:p.STORE_SIZE.totalDBSize,bps:1600},this.dataInDb=[],this.listenerList={progressUpdate:[],forceResult:[],postFail:[],dataDroped:[]},this.tempBuffer=[],this.traceType={MEM_I_API:0,MEM_O_DONE:0,MEM_O_DUMP:0,MEM_I_LOAD:0,DB_O_DROP:0,DB_O_DONE:0,DB_I_BACKUP:0},this.isPaused=!1,this.pro="json",this.isLoadReportData=!1,this.dropCount=0,this.timeInterval=!1,this.isWaitNtpTimeout=!1,this.waitNtpTimeout=2e3,this.postDataState="",this.product=e,this.reportMap=new Map}g.prototype.init=function(e){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return this.config=r(r({},p.DEFAULT_CONFIG),e),this.config.env%2!=1&&this.bindWindowListener(),this.zegoService=new l.ZegoService(this.config.env||c.ZEGO_ENV.BROWSER,this.config.bps||p.DEFAULT_CONFIG.bps,this.product,this.pro,this.stateCenter),this.zegoService.setLogUrlParams({product:this.product,signature:this.config.token||"",appid:this.config.appID,id_name:this.config.userID||"",deviceid:this.config.deviceID||""}),this.config.serverUrl&&this.zegoService.setLogServer(this.config.serverUrl),this.zegoService.setPostSucCallback(this.product,this.postSucHandler.bind(this)),this.zegoService.setPostFailCallback(this.product,(function(e){return i(t,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.stateCenter.logger.warn("zt.zd.i fail"),this.postDataState="fail",this.dropCount++,this.storePackagesDataToDB(e),[4,this.storePendingDataToDB(1)];case 1:return t.sent(),this._actionListener("postFail"),[2]}}))}))})),this.initPendingQueue(),this.storeHandler=new h.ZegoStoreHandler(this.product+"_"+this.config.appID+"_datareporter",f.uuid(6),this.config,this.traceType,this.staticConfig,this.stateCenter),this.storeHandler.setDropCallBack((function(e){t.traceType.DB_O_DROP+=f.calculateMemSize(e),t._actionListener("dataDroped",e)})),[4,this.storeHandler.loadPendingData()];case 1:return n.sent(),this.storeHandler.init().then((function(){t.loadReportData()})).catch((function(e){console.warn(e)})),this.startReportTimer(),this.setWaitNtpTimer(),this.checkCacheDataTimer(),[2]}}))}))},g.prototype.uninit=function(){this.isWaitNtpTimeout=!1,this.ntpTimer&&(clearTimeout(this.ntpTimer),this.ntpTimer=null),this.zegoService.destroy()},g.prototype.setConfig=function(e){"object"==typeof e&&"number"==typeof e.bps&&(this.config.bps=e.bps,this.zegoService.setBps(this.config.bps)),"object"==typeof e&&"number"==typeof e.totalDBSize&&(this.staticConfig.totalDBSize=e.totalDBSize),"object"==typeof e&&"string"==typeof e.serverUrl&&""!==e.serverUrl&&(this.config.serverUrl=e.serverUrl,this.zegoService.setLogServer(this.config.serverUrl))},g.prototype.pause=function(){this.isPaused=!0},g.prototype.resume=function(){this.isPaused=!1;var e=(t=this.pendingQueue.getPendingDataInfo()).pendingDataSize,t=t.size;this.checkPendingQueue(e,t)},g.prototype.startReport=function(e){var t=e.get("userID"),n=e.get("token");return!(!t||"string"!=typeof t||!n||"string"!=typeof n||(this.startCommonField=e,this.config.userID=t,this.config.token=n,this.zegoService.setLogUrlParams({product:this.product,signature:this.config.token,appid:this.config.appID,id_name:this.config.userID||"",deviceid:this.config.deviceID||""}),this.isWithNtp()&&this.bufferDump(),(t=e.get("serverUrl"))&&(this.config.serverUrl=t,this.zegoService.setLogServer(this.config.serverUrl)),this.isConfigOK(this.config)&&(e=(n=this.pendingQueue.getPendingDataInfo()).pendingDataSize,t=n.size,this.checkPendingQueue(e,t)),0))},g.prototype.setTimeOffset=function(e){var t=this;this.clientTimeOffset=e,this.tempBuffer.forEach((function(e){(e=e.data).tags.time_offset||(e.tags.time_offset=t.clientTimeOffset)})),this.config.userID&&this.bufferDump()},g.prototype.setProcessData=function(e){this.stateCenter.processData=e},g.prototype.on=function(e,t){return this._bindListener(e,t)},g.prototype.off=function(e,t){return this._deleteListener(e,t)},g.prototype.report=function(e,t){var n;if(15e3<e.length)return!1;try{n=JSON.parse(e)}catch(e){return!1}return this.stateCenter._log.debug(e+" "+t),(null!=n&&n.id_name||null!=(e=null==n?void 0:n.tags)&&e.id_name||this.config.userID)&&this.isWithNtp()?(null!=n&&n.id_name||null!=(e=null==n?void 0:n.tags)&&e.id_name?this.clientTimeOffset&&(n.tags.time_offset=this.clientTimeOffset):(this.clientTimeOffset&&(n.tags.time_offset=this.clientTimeOffset),n.tags.id_name=this.config.userID),this.dumpData(JSON.stringify(n),t)):this.tempBuffer.push({data:n,level:t}),!0},g.prototype.setUnloadState=function(e){this.unloadLevel=e,this.state="unload"},g.prototype.dumpData=function(e,t){var n=this,r=f.calculateMemSize(e),i=(this.traceType.MEM_I_API+=r,c.getSeq()),o=(new Date).getTime(),s={seq:i,content:e,level:t,timestamp:o};"unload"===this.state?void 0!==this.unloadLevel&&t<=this.unloadLevel?(this.storeHandler.saveDataToStorage(s),this.pendingQueue.enqueue(s,t)):this.stateCenter._log.debug("level is low"):t<=this.config.importantLevel?(s.key=t+"_"+o+"_"+i,this.dataInDb.push(s.key),this.storeHandler.storeData(s).then((function(e){n.pendingQueue.enqueue(s,t),n.traceType.DB_I_BACKUP+=r})).catch((function(e){var r=n.dataInDb.findIndex((function(e){return e===s.key}));-1<r&&n.dataInDb.splice(r,1),n.pendingQueue.enqueue(s,t)}))):this.pendingQueue.enqueue(s,t),"force"===this.state&&(o=f.calculateMemSize(e),this.forceDataTotalLen+=o)},g.prototype.isWithNtp=function(){return this.isWaitNtpTimeout||void 0!==this.clientTimeOffset},g.prototype.bufferDump=function(){var e,t=this.tempBuffer.shift();t&&(e=t.data,t=t.level,e.tags.id_name=this.config.userID,this.dumpData(JSON.stringify(e),t),this.bufferDump())},g.prototype.isConfigOK=function(e){return""!==e.userID&&""!==e.token&&""!==e.server},g.prototype.testSize=function(e){},g.prototype.flush=function(e){var t;"force"!==this.state&&(this.state="force",t=16e6,"object"==typeof e&&"number"==typeof e.bps&&(t=e.bps),this.zegoService.setBps(t),this.forceDataTotalLen=this.storeHandler.storeSize+this.pendingQueue.pendingDataSize+this.reportPackagesSize,t=(e=this.pendingQueue.getPendingDataInfo()).pendingDataSize,e=e.size,0<t?this.checkPendingQueue(t,e):this.loadReportData())},g.prototype.setWaitNtpTimeout=function(e){this.waitNtpTimeout=e},g.prototype.setWaitNtpTimer=function(){var e=this;this.ntpTimer=setTimeout((function(){e.isWaitNtpTimeout=!0,e.config.userID&&e.bufferDump()}),this.waitNtpTimeout)},g.prototype.startReportTimer=function(){var e=this,t=(this.stateCenter._log.debug("startReportTimer "+new Date),this.timeInterval=!0,(n=this.pendingQueue.getPendingDataInfo()).pendingDataSize),n=n.size;this.checkPendingQueue(t,n),this.reportTimer=window.setTimeout((function(){e.startReportTimer()}),3e4)},g.prototype.checkCacheDataTimer=function(){return i(this,void 0,void 0,(function(){var e,t,n=this;return o(this,(function(r){switch(r.label){case 0:return t=this.pendingQueue.getPendingDataInfo(),e=t.pendingDataSize,t=t.size,e>this.config.reportSize||t>this.config.reportNum?[4,this.checkPendingQueue(e,t)]:[3,2];case 1:return r.sent(),[3,3];case 2:this.loadReportData(),r.label=3;case 3:return this.checkDataTimer=window.setTimeout((function(){n.checkCacheDataTimer()}),15e3),[2]}}))}))},g.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i);navigator.userAgent.indexOf("Firefox"),window.addEventListener(t?"pagehide":"beforeunload",(function(){window.event&&(window.event.cancelBubble=!0),e.saveDataBeforeUnload()}))},g.prototype.saveDataBeforeUnload=function(){(e=this.pendingQueue.readStoreData(1)).totalLen;var e=e.storeArr,t=(this.storeHandler.resetCommonStore(),[]);t.push.apply(t,a(e)),e=this.zegoService.readReportQueueData(),t.push.apply(t,a(e)),0<t.length&&this.storeHandler.storePendingData(t)},g.prototype.setNetStateCheck=function(){"fail"===this.postDataState&&this.zegoService.handleNetConnect()},g.prototype.postSucHandler=function(e,t,n){return i(this,void 0,void 0,(function(){var n,r,i,s,a,u=this;return o(this,(function(o){switch(o.label){case 0:for(this.stateCenter._log.debug("post suc"),this.postDataState="suc",e.forEach((function(e){u.traceType.MEM_O_DONE+=f.calculateMemSize(e.content)})),n=function(t){var n=e[t];r.storeHandler.removeDataItem(n).then((function(e){n.key&&u.reportMap.delete(n.key)})).catch((function(e){}))},r=this,i=0;i<e.length;i++)n(i);return this.reportPackagesSize-=t,a=this.pendingQueue.getPendingDataInfo(),s=a.pendingDataSize,a=a.size,s>this.config.reportSize||a>this.config.reportNum?[4,this.checkPendingQueue(s,a)]:[3,2];case 1:return o.sent(),[3,3];case 2:this.loadReportData(),o.label=3;case 3:return"force"===this.state&&0==this.reportPackagesSize&&(s=this.reportPackagesSize+this.pendingQueue.pendingDataSize+this.storeHandler.storeSize,a=1-Number((s/this.forceDataTotalLen).toFixed(2)),this.listenerList.progressUpdate&&this._actionListener("progressUpdate",a),0<this.storeHandler.storeSize)&&this.loadReportData((function(e){0===e&&(u.state="normal",u.zegoService.setBps(u.config.bps||p.DEFAULT_CONFIG.bps),u.listenerList.forceSuccessCallback)&&u._actionListener("forceResult","SUCCESS")})),[2]}}))}))},g.prototype.checkPendingQueue=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return e>this.config.reportSize||t>this.config.reportNum||["force","unload"].includes(this.state)||this.timeInterval?(this.timeInterval=!1,!this.isPaused&&this.config.userID&&this.config.token&&this.config.serverUrl?[3,3]:(this.stateCenter._log.debug("isPaused "+this.isPaused+" "+this.userID+" "+this.config.token+" "+this.config.serverUrl),e>=this.cacheMaxSize||this.staticConfig.totalAvailCache<=0?[4,this.storePendingDataToDB(this.cacheDelPer)]:[3,2])):[3,7];case 1:o.sent(),o.label=2;case 2:return[2];case 3:return this.zegoService.reportAllowed()?[3,6]:(this.zegoService.resumeReport(),e>=this.cacheMaxSize||this.staticConfig.totalAvailCache<=0?[4,this.storePendingDataToDB(this.cacheDelPer)]:[3,5]);case 4:o.sent(),o.label=5;case 5:return[2];case 6:if(i=this.pendingQueue.readReportData(this.config.reportSize),n=i.totalLen,i=i.reportDataArr,n<=0)return[2];for(i=this.setCommonField(i),r=i.packageArr,i=i.packageLen,this.zegoService.report(r,i,this.product,"unload"===this.state),s=0;s<r.length;s++)a=r[s],this.reportMap.set(a.key,a);this.reportPackagesSize+=i,this.pendingQueue.refresh(n),o.label=7;case 7:return[2]}}))}))},g.prototype.initPendingQueue=function(){var e=this;this.pendingQueue=new d.PendingQueue(this.config.levels,this.product,this.staticConfig,this.stateCenter),this.pendingQueue.setListener({enCallback:function(t,n,r){return i(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.checkPendingQueue(r,n)];case 1:return e.sent(),[2]}}))}))}})},g.prototype.loadDBDataToMem=function(){var e=this;this.storeHandler.readStoreDataItem().then((function(t){var n=f.calculateMemSize(t.content);e.traceType.MEM_I_LOAD+=n,e.pendingQueue.enqueue(t,t.level)})).catch((function(e){}))},g.prototype.storePendingDataToDB=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s,a,c,l,h;return o(this,(function(d){switch(d.label){case 0:n=this.pendingQueue.readStoreData(e),t=n.totalLen,n=n.storeArr,r=function(e){var n,r;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,i.storeDataItem(e,t)];case 1:return o.sent(),n=e.level+"_"+e.timestamp+"_"+e.seq,-1<(r=i.dataInDb.findIndex((function(e){return e===n})))&&i.dataInDb.splice(r,1),[3,3];case 2:return o.sent(),[3,3];case 3:return[2]}}))},i=this,d.label=1;case 1:d.trys.push([1,6,7,8]),s=u(n),a=s.next(),d.label=2;case 2:return a.done?[3,5]:(c=a.value,[5,r(c)]);case 3:d.sent(),d.label=4;case 4:return a=s.next(),[3,2];case 5:return[3,8];case 6:return c=d.sent(),l={error:c},[3,8];case 7:try{a&&!a.done&&(h=s.return)&&h.call(s)}finally{if(l)throw l.error}return[7];case 8:return[2]}}))}))},g.prototype.storePackagesDataToDB=function(e){var t=this;e.length&&e.forEach((function(e){t.storeHandler.storeData(e).then((function(n){var r=f.calculateMemSize(e.content);t.traceType.MEM_O_DUMP+=r})).catch((function(e){}))}))},g.prototype.storeDataItem=function(e,t){var n=this;return new Promise((function(t,r){return i(n,void 0,void 0,(function(){var n;return o(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.storeHandler.storeData(e)];case 1:return i.sent(),n=f.calculateMemSize(e.content),this.traceType.MEM_O_DUMP+=n,t(),[3,3];case 2:return n=i.sent(),r(n),[3,3];case 3:return[2]}}))}))}))},g.prototype.loadReportData=function(e){var t=this;this.storeHandler.storeSize<=0||this.isLoadReportData||(this.isLoadReportData=!0,this.storeHandler.loadDBData(this.config.reportSize,5,Math.floor(this.cacheMaxSize/3),(function(e){return-1<t.dataInDb.indexOf(e)})).then((function(n){t.isLoadReportData=!1,n.datas.forEach((function(e){var n;t.reportMap.has(e.key)||t.pendingQueue.findInQueue(e)||(n=f.calculateMemSize(e.content),t.traceType.MEM_I_LOAD+=n,t.pendingQueue.enqueue(e,e.level),t.dataInDb.push(e.key))})),e&&e(n.len)})).catch((function(e){t.isLoadReportData=!1})))},g.prototype.setCommonField=function(e){var t=this,n=0;return e.forEach((function(e){var r,i,o=JSON.parse(e.content);if(t.startCommonField)try{for(var a=u(t.startCommonField),c=a.next();!c.done;c=a.next()){var l=s(c.value,2),h=l[0],d=l[1];"userID"!==h&&"token"!==h&&"serverUrl"!==h&&(o[h]=d)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}n+=f.calculateMemSize(o),e.content=JSON.stringify(o)})),{packageArr:e,packageLen:n}},g.prototype._bindListener=function(e,t){return!!this.listenerList[e]&&"function"==typeof t&&(-1==this.listenerList[e].indexOf(t)&&this.listenerList[e].push(t),!0)},g.prototype._deleteListener=function(e,t){var n;return!!this.listenerList[e]&&(n=this.listenerList[e],t?n.splice(n.indexOf(t),1):this.listenerList[e]=[],!0)},g.prototype._actionListener=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.listenerList[e]&&this.listenerList[e].forEach((function(e){try{e.apply(void 0,a(t))}catch(e){}}))},t.ZegoDataReport=g},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoService=void 0,n(0)),s=n(25),a=n(29),u=n(4);function c(e,t,n,r,i){var a,u,c,l=this;this.env=e,this.product=n,this.pro=r,this.stateCenter=i,this.isDestroy=!1,this.websocket=null,this.packageLen=0,this.packagesDataSize=0,this.PACKAGE_MAX_LEN=5,this.msgID=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCacheSend=[],this.logCacheMax=100,this.reportDataCheckInterval=1e3,this.postSucCallbackList={},this.postFailCallbackList={},this.failCount=0,this.failStartTime=0,this.netWorkFail=!1,this.networkState=o.ENUM_NETWORK_STATE.online,this.state=o.ENUM_CONNECT_STATE.disconnected,this.wsFrequentShutdownCounter=(u=a=0,c=function(){u=a=0},{onOpen:function(){a=performance.now()},onClose:function(){0<a&&(performance.now()-a<100?(u++,l.stateCenter.logger.info("zt.rzs.wfsc frequently shutdown.")):c())},isOutOfMaxTimes:function(){return 10<=u}}),this.bindWindowListener(),this.networkState=o.ENUM_NETWORK_STATE.online,this.service=new s.LogService(e,n,r,i),this.setBps(t),this.reportQueue=new o.Queue}c.prototype.destroy=function(){var e;null!=(e=this.websocket)&&e.close(),this.service.closeSocket(),this.logUploadTimer&&clearTimeout(this.logUploadTimer),this.reportQueue.clear(),this.isDestroy=!0},c.prototype.bindWindowListener=function(){var e=this;window.addEventListener("offline",(function(){e.networkState=o.ENUM_NETWORK_STATE.offline})),window.addEventListener("online",(function(t){e.handleNetConnect()}))},c.prototype.handleNetConnect=function(){this.networkState=o.ENUM_NETWORK_STATE.online;var e=this.url;this.url="",this.setLogServer(e),this.netWorkFail=!1},c.prototype.setLogServer=function(e){try{return e.startsWith("wss:")||e.startsWith("ws:")?(this.logType=o.ENUM_REMOTE_TYPE.WEBSOCKET,this.openWebSocketLogServer(e)):e.startsWith("https:")||e.startsWith("http:")?(this.logType=o.ENUM_REMOTE_TYPE.HTTPS,this.openHttpsLogServer(e)):this.logType=o.ENUM_REMOTE_TYPE.DISABLE,!0}catch(e){return!1}},c.prototype.setLogUrlParams=function(e){this.logParams=e},c.prototype.openWebSocketLogServer=function(e){var t=this;this.url!=e&&(this.url=e)&&(this.stopWebSocketServer(),this.logParams.id_name)&&(this.wsFrequentShutdownCounter.isOutOfMaxTimes()?(this.stateCenter.logger.warn("zt.rzs.owsls frequently shutdown too many times. cannot create socket anymore."),this.state=o.ENUM_CONNECT_STATE.disconnected):(this.state=o.ENUM_CONNECT_STATE.connecting,e=e+"?product="+this.logParams.product+"&appid="+this.logParams.appid+"&token="+encodeURIComponent(this.logParams.signature)+"&deviceid="+this.logParams.deviceid+"&id_name="+this.logParams.id_name,this.service.createSocket(e),this.service.openHandler((function(){t.service.onPush(),t.service.startCheck(),t.stateCenter.logger.info("zt.rzs.owsls socket open"),t.openHandler(),t.wsFrequentShutdownCounter.onOpen()})),this.service.closeHandler((function(e){t.stateCenter.logger.warn("zt.rzs.owsls socket close "+JSON.stringify(e.code||e)),t.state=o.ENUM_CONNECT_STATE.disconnected,t.service.closeSocket(),t.wsFrequentShutdownCounter.onClose()})),this.service.errorHandler((function(e){t.stateCenter.logger.warn("zt.rzs.owsls socket error "+JSON.stringify(e.code||e)),t.state=o.ENUM_CONNECT_STATE.disconnected,t.service.closeSocket()}))))},c.prototype.stopWebSocketServer=function(){this.service.closeSocket()},c.prototype.openHttpsLogServer=function(e){(this.url=e)&&this.stopHttpsServer()},c.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},c.prototype.SendHttpsLog=function(e,t,n,r){this.env===o.ZEGO_ENV.BROWSER?this.SendHttpsLogWeb(e,t,n,r):this.SendHttpsLogWeChatMini(e,t,n,r)},c.prototype.SendHttpsLogWeb=function(e,t,n,r){var i=this,o=(e=JSON.stringify({body:{data:e}}),new XMLHttpRequest);o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status){if(0!=o.responseText.length)try{var e=JSON.parse(o.responseText).interval;"number"==typeof e&&i.logUploadInterval!==e&&i.openHttpsLogServer(i.url),n&&n()}catch(e){r&&r()}}else r&&r()},o.open("POST",this.url,!0),o.send(e)},c.prototype.SendHttpsLogWeChatMini=function(e,t,n,r){var i=this;e={appid:this.logParams.appid+"",timestamp:(new Date).getTime()+"",token:this.logParams.signature,id_name:this.logParams.id_name,product:this.logParams.product,message_id:++this.msgID,req_sdk:1,s:JSON.stringify({speed_detail:e})},wx.request({url:this.url,data:JSON.stringify(e),method:"POST",success:function(e){0!=e.data.length&&("number"==typeof(e=e&&e.data&&e.data.interval)&&i.logUploadInterval!==e&&i.openHttpsLogServer(i.url),n)&&n()},fail:function(e){r&&r()}})},c.prototype.openHandler=function(){this.state=o.ENUM_CONNECT_STATE.connected,this.startReport()},c.prototype.setPostSucCallback=function(e,t){this.postSucCallbackList[e]=t},c.prototype.setPostFailCallback=function(e,t){this.postFailCallbackList[e]=t},c.prototype.reportAllowed=function(){return this.packageLen<this.PACKAGE_MAX_LEN},c.prototype.report=function(e,t,n,r){this.packageLen++,this.packagesDataSize+=t,this.reportQueue.enqueue({reportDatas:e,dataLen:t,product:n}),this.netWorkFail=!1,this.failCount=0,this.failStartTime=0,this.startReport(r)},c.prototype.setBps=function(e){this.tokenBucket=new a.TokenBucket(u.BUCKET_CONFIG.bucketSize,e/8,"sec")},c.prototype.startReport=function(e){var t,n,r,i,s=this;this.isDestroy||(this.logType===o.ENUM_REMOTE_TYPE.WEBSOCKET&&this.state===o.ENUM_CONNECT_STATE.disconnected?(t=this.url,this.url="",this.setLogServer(t)):0<this.reportQueue.size()&&(t=this.reportQueue.dequeue(),n=t.reportDatas,r=t.dataLen,i=t.product,new Date,e?this.sendReport(n,r,i):this.tokenBucket.removeTokens(r,(function(){s.sendReport(n,r,i)}))))},c.prototype.failTooMuch=function(){if(this.failCount<=0)return!1;1==this.failCount&&(this.failStartTime=Date.now());var e=(Date.now()-this.failStartTime)/1e3;return this.failCount>=u.FAIL_COUNT&&e>u.FAIL_TIME||this.failCount>=u.FAIL_MAX_COUNT},c.prototype.sendReport=function(e,t,n){var r=this;this.reportData(e,t,n,(function(){r.failCount=0,r.failStartTime=0,r.packageLen--,r.packagesDataSize-=t,r.postSucCallbackList[n]&&r.postSucCallbackList[n](e,t,n)}),(function(i){var o;r.reportQueue.enqueue({reportDatas:e,dataLen:t,product:n}),r.failCount++,r.failTooMuch()?(r.netWorkFail=!0,o=r.decodeReportQueue(),Object.keys(r.postFailCallbackList).forEach((function(e){r.postFailCallbackList[n](o[e])}))):r.startReport()}))},c.prototype.resumeReport=function(){!0===this.netWorkFail&&this.networkState===o.ENUM_NETWORK_STATE.online&&(this.netWorkFail=!1,this.startReport())},c.prototype.reportData=function(e,t,n,r,i){var s=this,a=[];e.forEach((function(e){a.push(JSON.parse(e.content))})),this.logType==o.ENUM_REMOTE_TYPE.WEBSOCKET?this.networkState===o.ENUM_NETWORK_STATE.offline?i&&i(o.errorList.BROKEN):this.service.sendMessage("report",a,r,(function(e){var t;s.state===o.ENUM_CONNECT_STATE.disconnected&&e===o.SOCKET_DISCONNECT&&(t=s.url,s.url="",s.setLogServer(t)),i&&i(e)})):this.logType==o.ENUM_REMOTE_TYPE.HTTPS&&this.SendHttpsLog(a,t,r,(function(){i&&i()}))},c.prototype.unsigned2signed=function(e){var t=parseInt(e,10);if(256<t)return t%256;for(var n=[];0<t;)t%2!=0?n.push(1):n.push(0),t=Number(t/2);for(n.reverse();n.length<8;)n.unshift(0);var r="";if(1==(n=n.join("")).substr(0,1)){for(var i=1;i<n.length;i++)1==n.substr(i,1)?r+=0:r+=1;return"-"+(parseInt(r,2)+1)}for(i=0;i<n.length;i++)r+=n.substr(i,1);return parseInt(r,2)},c.prototype.decodeReportQueue=function(){for(var e={},t=this.reportQueue.size(),n=0;n<t;n++){var r,o=(r=this.reportQueue.dequeue()).reportDatas,s=r.dataLen;e[r=r.product]||(e[r]=[]),e[r]=i(e[r],o),this.reportQueue.enqueue({reportDatas:o,dataLen:s,product:r})}return e},c.prototype.readReportQueueData=function(){for(var e=[],t=this.reportQueue.size(),n=0;n<t;n++){var r=this.reportQueue.dequeue(),o=r.reportDatas;r.dataLen,r.product,e.push.apply(e,i(o))}return e},t.ZegoService=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogService=void 0;var r=n(26),i=n(4),o=n(0);function s(e,t,n,i){this.env=e,this.product=t,this.pro=n,this.stateCenter=i,this.service=new r.ZegoSocketService(this.env,this.product,this.pro,this.stateCenter),this.cmdSeq=0,this.responseRouters={}}s.prototype.handleSendCommandMsgRsp=function(e){var t,n,r=this,i=this.service.sendCommandMap[e.messageId||(null==(i=null==e?void 0:e.data)?void 0:i.message_id)];null!=i&&(n=i._data,delete this.service.sendCommandMap[e.messageId||(null==(t=null==e?void 0:e.data)?void 0:t.message_id)],this.service.sendCommandList.remove(i),0===e.code?setTimeout((function(){n&&null!=n.success&&n.success(e,r.cmdSeq)}),0):setTimeout((function(){n&&null!=n.error&&n.error(e,r.cmdSeq)}),0))},s.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){e.handleSendCommandMsgRsp(t)}},s.prototype.closeHandler=function(e){this.service.closeHandler(e)},s.prototype.openHandler=function(e){this.service.openHandler(e)},s.prototype.errorHandler=function(e){this.service.errorHandler(e)},s.prototype.getHeader=function(e){return{Protocol:"req",cmd:e,appid:123,seq:++this.cmdSeq,session_id:""}},s.prototype.startCheck=function(){this.service.startCheck()},s.prototype.stopCheck=function(){this.service.stopCheck()},s.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},s.prototype.createSocket=function(e){this.service.createSocket(e),this.responseRouters={}},s.prototype.closeSocket=function(){this.service.closeSocket()},s.prototype.sendMessage=function(e,t,n,r,s,a){return this.service.isDisConnect()?(r&&r(o.SOCKET_DISCONNECT),0):(s=s||this.getHeader(e),this.service.sendMessage(s,t,n,r,{timeOut:1e3*i.DEFAULT_CONFIG.netTimeout}))},s.prototype.on=function(e,t){this.responseRouters[e]=t},t.LogService=s},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSocketService=void 0,n(27)),o=n(0),s=n(28);function a(e,t,n,r){this.product=t,this.pro=n,this.stateCenter=r,this.socket=null,this.sendCommandList=new o.LinkedList,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=3e4,this.sendDataCheckInterval=2e3,this.ENV=e}a.prototype.createSocket=function(e){this.socket=i.createZegoWebSocket(e,this.ENV),this.socket.binaryType="arraybuffer"},a.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},a.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},a.prototype.sendMessage=function(e,t,n,i,o){void 0===n&&(n=null),void 0===i&&(i=null),void 0===o&&(o={timeOut:6e3});var a=r(r({},this.stateCenter.processData),{time_upload:Date.now()});a={data:t={message_id:e.seq,product:this.product,s:JSON.stringify({speed_detail:t,process:a})},seq:e.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:o.timeOut,success:n,error:i};return o=this.sendCommandList.push(a),this.sendCommandMap[a.seq]=o,this.socket&&"pb"!==this.pro&&(this.stateCenter._log.debug("upload data",JSON.stringify(t)),n=s.deflate(JSON.stringify(t),{to:"string"}),this.socket.send(n)),e.seq},a.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data&&t._data.error&&setTimeout((function(){t&&t._data&&t._data.error&&t._data.error(o.errorList.TIMEOUT,t._data.data.message_id,t._data.data.s)}),0),t=e.getFirst()},a.prototype.checkMessageListTimeout=function(e,t){for(var n=e.getFirst(),r=Date.parse(new Date+""),i=0;!(null==n||n._data&&n._data.sendTime+n._data.timeOut>r||(n._data&&delete t[n._data.data.message_id],e.remove(n),n._data&&null==n._data.error||n._data&&n._data.sendTime+this.sendDataDropTimeout<r||n&&n._data&&n._data.error&&n._data.error(o.errorList.TIMEOUT,n._data.data.message_id,n._data.data.s),++i>=this.sendDataCheckOnceCount));)n=e.getFirst()},a.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},a.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},a.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(n){t.responseHandler(),e(n)})},a.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){t="string"==typeof t.data?JSON.parse(t.data):JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t.data))),e.onMessage(t)})},a.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},a.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},a.prototype.onMessage=function(e){},t.ZegoSocketService=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.ZegoWeiXinMiniWebSocket=void 0;var r=n(0),i=(o.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){"function"==typeof e.onmessage&&e.onmessage(t)})))})),this._websocket.onError((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onerror&&e.onerror(t)})))},o.prototype.onopen=function(e){},o.prototype.onerror=function(e){},o.prototype.onclose=function(e){},o.prototype.onmessage=function(e){},o.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},o.prototype.close=function(){this._websocket&&this._websocket.close()},o);function o(e,t){this.url=e,this.readyState=3,this._websocket=wx.connectSocket({url:e}),this.init()}t.ZegoWeiXinMiniWebSocket=i,t.createZegoWebSocket=function(e,t){return new(t===r.ZEGO_ENV.BROWSER?WebSocket:i)(e)}},function(e,t,n){!function(e){"use strict";function t(e){for(var t=e.length;0<=--t;)e[t]=0}var n=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),r=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=new Array(576),a=(t(s),new Array(60)),u=(t(a),new Array(512)),c=(t(u),new Array(256)),l=(t(c),new Array(29));t(l);var h,d,f,p=new Array(30);function g(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function _(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function m(e){for(var t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0}function v(e){8<e.bi_valid?D(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function y(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]}function S(e,t,i){var o,s,a,u,h=0;if(0!==e.sym_next)for(;o=255&e.pending_buf[e.sym_buf+h++],o+=(255&e.pending_buf[e.sym_buf+h++])<<8,s=e.pending_buf[e.sym_buf+h++],0==o?U(e,s,t):(a=c[s],U(e,a+256+1,t),0!==(u=n[a])&&(s-=l[a],x(e,s,u)),a=M(--o),U(e,a,i),0!==(u=r[a])&&(o-=p[a],x(e,o,u))),h<e.sym_next;);U(e,256,t)}function E(e,t){var n,r,i,o=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<u;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,a&&(e.static_len-=s[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;1<=n;n--)z(e,o,n);for(i=u;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],z(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,z(e,o,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1];for(var l,h,d,f,p,g=e,_=t.dyn_tree,m=t.max_code,v=t.stat_desc.static_tree,y=t.stat_desc.has_stree,S=t.stat_desc.extra_bits,E=t.stat_desc.extra_base,b=t.stat_desc.max_length,T=0,C=0;C<=15;C++)g.bl_count[C]=0;for(_[2*g.heap[g.heap_max]+1]=0,l=g.heap_max+1;l<573;l++)(C=_[2*_[2*(h=g.heap[l])+1]+1]+1)>b&&(C=b,T++),_[2*h+1]=C,m<h||(g.bl_count[C]++,f=0,E<=h&&(f=S[h-E]),p=_[2*h],g.opt_len+=p*(C+f),y&&(g.static_len+=p*(v[2*h+1]+f)));if(0!==T){do{for(C=b-1;0===g.bl_count[C];)C--}while(g.bl_count[C]--,g.bl_count[C+1]+=2,g.bl_count[b]--,0<(T-=2));for(C=b;0!==C;C--)for(h=g.bl_count[C];0!==h;)(d=g.heap[--l])>m||(_[2*d+1]!==C&&(g.opt_len+=(C-_[2*d+1])*_[2*d],_[2*d+1]=C),h--)}H(o,c,e.bl_count)}function b(e,t,n){var r,i,o=-1,s=t[1],a=0,u=7,c=4;for(0===s&&(u=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++a<u&&i===s||(a<c?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=i,c=(a=0)===s?(u=138,3):i===s?(u=6,3):(u=7,4))}function T(e,t,n){var r,i,o=-1,s=t[1],a=0,u=7,c=4;for(0===s&&(u=138,c=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++a<u&&i===s)){if(a<c)for(;U(e,i,e.bl_tree),0!=--a;);else 0!==i?(i!==o&&(U(e,i,e.bl_tree),a--),U(e,16,e.bl_tree),x(e,a-3,2)):a<=10?(U(e,17,e.bl_tree),x(e,a-3,3)):(U(e,18,e.bl_tree),x(e,a-11,7));o=i,c=(a=0)===s?(u=138,3):i===s?(u=6,3):(u=7,4)}}function C(e,t,n,r){x(e,0+(r?1:0),3),v(e),D(e,n),D(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n}function w(e,t){return e.msg=Y[t],t}function R(e){return 2*e-(4<e?9:0)}function I(e,t){K(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Te(e.strm)}function k(e,t){e.pending_buf[e.pending++]=t}function O(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function N(e,t){var n,r,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match,u=e.strstart>e.w_size-_e?e.strstart-(e.w_size-_e):0,c=e.window,l=e.w_mask,h=e.prev,d=e.strstart+ge,f=c[o+s-1],p=c[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(c[(n=t)+s]===p&&c[n+s-1]===f&&c[n]===c[o]&&c[++n]===c[o+1]){for(o+=2,n++;c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<d;);if(r=ge-(d-o),o=d-ge,s<r){if(e.match_start=t,a<=(s=r))break;f=c[o+s-1],p=c[o+s]}}}while((t=h[t&l])>u&&0!=--i);return s<=e.lookahead?s:e.lookahead}function A(e,t){for(var n,r,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,a=e.strm.avail_in;n=65535,i=e.bi_valid+42>>3,!(e.strm.avail_out<i||(n=(i=e.strm.avail_out-i)<(n=n>(r=e.strstart-e.block_start)+e.strm.avail_in?r+e.strm.avail_in:n)?i:n)<o&&(0===n&&t!==te||t===Q||n!==r+e.strm.avail_in)||(s=t===te&&n===r+e.strm.avail_in?1:0,Z(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Te(e.strm),r&&(n<r&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Ce(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n),0!==s)););return(a-=e.strm.avail_in)&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart)&&(e.insert=e.strstart),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==Q&&t!==te&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart)&&(e.insert=e.strstart),(i=i>e.strm.avail_in?e.strm.avail_in:i)&&(Ce(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,o=(i=65535<e.pending_buf_size-i?65535:e.pending_buf_size-i)>e.w_size?e.w_size:i,((r=e.strstart-e.block_start)>=o||(r||t===te)&&t!==Q&&0===e.strm.avail_in&&r<=i)&&(n=i<r?i:r,s=t===te&&0===e.strm.avail_in&&n===r?1:0,Z(e,e.block_start,n,s),e.block_start+=n,Te(e.strm)),s?3:1)}function L(e,t){for(var n,r;;){if(e.lookahead<_e){if(we(e),e.lookahead<_e&&t===Q)return 1;if(0===e.lookahead)break}if(n=0,3<=e.lookahead&&(e.ins_h=be(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-_e&&(e.match_length=N(e,n)),3<=e.match_length)if(r=$(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&3<=e.lookahead){for(e.match_length--;e.strstart++,e.ins_h=be(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=be(e,e.ins_h,e.window[e.strstart+1]);else r=$(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(I(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===te?(I(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(I(e,!1),0===e.strm.avail_out)?1:2}function P(e,t){for(var n,r,i;;){if(e.lookahead<_e){if(we(e),e.lookahead<_e&&t===Q)return 1;if(0===e.lookahead)break}if(n=0,3<=e.lookahead&&(e.ins_h=be(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-_e&&(e.match_length=N(e,n),e.match_length<=5)&&(e.strategy===ce||3===e.match_length&&4096<e.strstart-e.match_start)&&(e.match_length=2),3<=e.prev_length&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-3,r=$(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=be(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(I(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=$(e,0,e.window[e.strstart-1]))&&I(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=$(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===te?(I(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(I(e,!1),0===e.strm.avail_out)?1:2}t(p);var M=function(e){return e<256?u[e]:u[256+(e>>>7)]},D=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},x=function(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,D(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},U=function(e,t,n){x(e,n[2*t],n[2*t+1])},B=function(e,t){for(var n=0;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1},H=function(e,t,n){for(var r,i=new Array(16),o=0,s=1;s<=15;s++)o=o+n[s-1]<<1,i[s]=o;for(r=0;r<=t;r++){var a=e[2*r+1];0!==a&&(e[2*r]=B(i[a]++,a))}},z=function(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&y(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!y(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},G=!1,F=C,q=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,s=0;0!==n;){for(n-=s=2e3<n?2e3:n;o=o+(i=i+t[r++]|0)|0,--s;);i%=65521,o%=65521}return i|o<<16|0},j=new Uint32Array(function(){for(var e=[],t=0;t<256;t++){for(var n=t,r=0;r<8;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}()),V=function(e,t,n,r){var i=j,o=r+n;e^=-1;for(var s=r;s<o;s++)e=e>>>8^i[255&(e^t[s])];return-1^e},Y={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},W={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Z=F,K=function(e,t,n,r){var i,u,c,l=0;if(0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){for(var t=4093624447,n=0;n<=31;n++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*n])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(n=32;n<256;n++)if(0!==e.dyn_ltree[2*n])return 1;return 0}(e)),E(e,e.l_desc),E(e,e.d_desc),l=function(e){var t;for(b(e,e.dyn_ltree,e.l_desc.max_code),b(e,e.dyn_dtree,e.d_desc.max_code),E(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*o[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(u=e.static_len+3+7>>>3)<=i&&(i=u)):i=u=n+5,n+4<=i&&-1!==t)C(e,t,n,r);else if(4===e.strategy||u===i)x(e,2+(r?1:0),3),S(e,s,a);else{x(e,4+(r?1:0),3);var h=e,d=(t=e.l_desc.max_code+1,n=e.d_desc.max_code+1,l+1);for(x(h,t-257,5),x(h,n-1,5),x(h,d-4,4),c=0;c<d;c++)x(h,h.bl_tree[2*o[c]+1],3);T(h,h.dyn_ltree,t-1),T(h,h.dyn_dtree,n-1),S(e,e.dyn_ltree,e.dyn_dtree)}m(e),r&&v(e)},$=function(e,t,n){return e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(c[n]+256+1)]++,e.dyn_dtree[2*M(t)]++),e.sym_next===e.sym_end},X=function(e){x(e,2,3),U(e,256,s),16===e.bi_valid?(D(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)},Q=W.Z_NO_FLUSH,J=W.Z_PARTIAL_FLUSH,ee=W.Z_FULL_FLUSH,te=W.Z_FINISH,ne=W.Z_BLOCK,re=W.Z_OK,ie=W.Z_STREAM_END,oe=W.Z_STREAM_ERROR,se=W.Z_DATA_ERROR,ae=W.Z_BUF_ERROR,ue=W.Z_DEFAULT_COMPRESSION,ce=W.Z_FILTERED,le=W.Z_HUFFMAN_ONLY,he=W.Z_RLE,de=W.Z_FIXED,fe=W.Z_UNKNOWN,pe=W.Z_DEFLATED,ge=258,_e=262,me=42,ve=113,ye=666,Se=function(e){for(var t=e.length;0<=--t;)e[t]=0},Ee=function(e){for(var t,n,r=e.w_size,i=t=e.hash_size;n=e.head[--i],e.head[i]=r<=n?n-r:0,--t;);for(i=t=r;n=e.prev[--i],e.prev[i]=r<=n?n-r:0,--t;);},be=function(e,t,n){return(t<<e.hash_shift^n)&e.hash_mask},Te=function(e){var t=e.state,n=t.pending;0!==(n=n>e.avail_out?e.avail_out:n)&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending)&&(t.pending_out=0)},Ce=function(e,t,n,r){var i=e.avail_in;return 0===(i=r<i?r:i)?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=q(e.adler,t,i,n):2===e.state.wrap&&(e.adler=V(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},we=function(e){var t,n,r=e.w_size;do{if(t=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-_e)&&(e.window.set(e.window.subarray(r,r+r-t),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),Ee(e),t+=r),0===e.strm.avail_in)break;if(t=Ce(e.strm,e.window,e.strstart+e.lookahead,t),e.lookahead+=t,3<=e.lookahead+e.insert)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=be(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=be(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<_e&&0!==e.strm.avail_in)};function Re(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}var Ie=[new Re(0,0,0,0,A),new Re(4,4,8,4,L),new Re(4,5,16,8,L),new Re(4,6,32,32,L),new Re(4,4,16,16,P),new Re(8,16,32,32,P),new Re(8,16,128,128,P),new Re(8,32,128,256,P),new Re(32,128,258,1024,P),new Re(32,258,258,4096,P)];function ke(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=pe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Se(this.dyn_ltree),Se(this.dyn_dtree),Se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Se(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Oe=function(e){var t;return!e||!(t=e.state)||t.strm!==e||t.status!==me&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==ve&&t.status!==ye?1:0},Ne=function(e){if(Oe(e))return w(e,oe);e.total_in=e.total_out=0,e.data_type=fe;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?me:ve,e.adler=2===t.wrap?0:1,t.last_flush=-2,function(e){if(!G){for(var t,o,v,y=new Array(16),S=0,E=0;E<28;E++)for(l[E]=S,t=0;t<1<<n[E];t++)c[S++]=E;for(c[S-1]=E,E=v=0;E<16;E++)for(p[E]=v,t=0;t<1<<r[E];t++)u[v++]=E;for(v>>=7;E<30;E++)for(p[E]=v<<7,t=0;t<1<<r[E]-7;t++)u[256+v++]=E;for(o=0;o<=15;o++)y[o]=0;for(t=0;t<=143;)s[2*t+1]=8,t++,y[8]++;for(;t<=255;)s[2*t+1]=9,t++,y[9]++;for(;t<=279;)s[2*t+1]=7,t++,y[7]++;for(;t<=287;)s[2*t+1]=8,t++,y[8]++;for(H(s,287,y),t=0;t<30;t++)a[2*t+1]=5,a[2*t]=B(t,5);h=new g(s,n,257,286,15),d=new g(a,r,0,30,15),f=new g(new Array(0),i,0,19,7),G=!0}e.l_desc=new _(e.dyn_ltree,h),e.d_desc=new _(e.dyn_dtree,d),e.bl_desc=new _(e.bl_tree,f),e.bi_buf=0,e.bi_valid=0,m(e)}(t),re},Ae=function(e,t,n,r,i,o){if(!e)return oe;var s=1;if(t===ue&&(t=6),r<0?(s=0,r=-r):15<r&&(s=2,r-=16),i<1||9<i||n!==pe||r<8||15<r||t<0||9<t||o<0||de<o||8===r&&1!==s)return w(e,oe);8===r&&(r=9);var a=new ke;return(e.state=a).strm=e,a.status=me,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=o,a.method=n,(r=Ne(s=e))===re&&((s=s.state).window_size=2*s.w_size,Se(s.head),s.max_lazy_match=Ie[s.level].max_lazy,s.good_match=Ie[s.level].good_length,s.nice_match=Ie[s.level].nice_length,s.max_chain_length=Ie[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),r};function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){}for(var Pe=new Uint8Array(256),Me=0;Me<256;Me++)Pe[Me]=252<=Me?6:248<=Me?5:240<=Me?4:224<=Me?3:192<=Me?2:1;function De(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);for(var t,n,r,i,o=e.length,s=0,a=0;a<o;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=i=0;i<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),n<128?t[i++]=n:(n<2048?t[i++]=192|n>>>6:(n<65536?t[i++]=224|n>>>12:(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63),t[i++]=128|n>>>6&63),t[i++]=128|63&n);return t}function xe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}Pe[254]=Pe[254]=1;var Ue=Object.prototype.toString,Be=W.Z_NO_FLUSH,He=W.Z_SYNC_FLUSH,ze=W.Z_FULL_FLUSH,Ge=W.Z_FINISH,Fe=W.Z_OK,qe=W.Z_STREAM_END,je=W.Z_DEFAULT_COMPRESSION,Ve=W.Z_DEFAULT_STRATEGY,Ye=W.Z_DEFLATED;function We(e){this.options=function(e){for(var t,n,r=Array.prototype.slice.call(arguments,1);r.length;){var i=r.shift();if(i){if("object"!==Le(i))throw new TypeError(i+"must be non-object");for(var o in i)t=i,n=o,Object.prototype.hasOwnProperty.call(t,n)&&(e[o]=i[o])}}return e}({level:je,method:Ye,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ve},e||{});var t,n=((e=this.options).raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xe,this.strm.avail_out=0,Ae(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy));if(n!==Fe)throw new Error(Y[n]);if(e.header&&(r=this.strm,t=e.header,Oe(r)||2!==r.state.wrap||(r.state.gzhead=t)),e.dictionary){var r="string"==typeof e.dictionary?De(e.dictionary):"[object ArrayBuffer]"===Ue.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary;if((n=function(e,t){var n=t.length;if(Oe(e))return oe;var r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==me||r.lookahead)return oe;1===i&&(e.adler=q(e.adler,t,n,0)),r.wrap=0,n>=r.w_size&&(0===i&&(Se(r.head),r.strstart=0,r.block_start=0,r.insert=0),(o=new Uint8Array(r.w_size)).set(t.subarray(n-r.w_size,n),0),t=o,n=r.w_size);var o=e.avail_in,s=e.next_in,a=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,we(r);3<=r.lookahead;){for(var u=r.strstart,c=r.lookahead-2;r.ins_h=be(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++,--c;);r.strstart=u,r.lookahead=2,we(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=a,e.avail_in=o,r.wrap=i,re}(this.strm,r))!==Fe)throw new Error(Y[n]);this._dict_set=!0}}function Ze(e,t){if((t=new We(t)).push(e,!0),t.err)throw t.msg||Y[t.err];return t.result}function Ke(e,t){return(t=t||{}).raw=!0,Ze(e,t)}function $e(e,t){return(t=t||{}).gzip=!0,Ze(e,t)}We.prototype.push=function(e,t){var n,r,i,o,s=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Ge:Be,"string"==typeof e?s.input=De(e):"[object ArrayBuffer]"===Ue.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(r===He||r===ze)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if((n=function(e,t){if(Oe(e)||ne<t||t<0)return e?w(e,oe):oe;var n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===ye&&t!==te)return w(e,0===e.avail_out?ae:oe);var r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(Te(e),0===e.avail_out)return n.last_flush=-1,re}else if(0===e.avail_in&&R(t)<=R(r)&&t!==te)return w(e,ae);if(n.status===ye&&0!==e.avail_in)return w(e,ae);if(n.status===me&&0===n.wrap&&(n.status=ve),n.status===me&&(r=pe+(n.w_bits-8<<4)<<8,r|=(n.strategy>=le||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(r|=32),O(n,r+=31-r%31),0!==n.strstart&&(O(n,e.adler>>>16),O(n,65535&e.adler)),e.adler=1,n.status=ve,Te(e),0!==n.pending))return n.last_flush=-1,re;if(57===n.status)if(e.adler=0,k(n,31),k(n,139),k(n,8),n.gzhead)k(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),k(n,255&n.gzhead.time),k(n,n.gzhead.time>>8&255),k(n,n.gzhead.time>>16&255),k(n,n.gzhead.time>>24&255),k(n,9===n.level?2:n.strategy>=le||n.level<2?4:0),k(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(k(n,255&n.gzhead.extra.length),k(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=V(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(k(n,0),k(n,0),k(n,0),k(n,0),k(n,0),k(n,9===n.level?2:n.strategy>=le||n.level<2?4:0),k(n,3),n.status=ve,Te(e),0!==n.pending)return n.last_flush=-1,re;if(69===n.status){if(n.gzhead.extra){for(var i=n.pending,o=(65535&n.gzhead.extra.length)-n.gzindex;n.pending+o>n.pending_buf_size;){var s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=V(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=s,Te(e),0!==n.pending)return n.last_flush=-1,re;i=0,o-=s}r=new Uint8Array(n.gzhead.extra),n.pending_buf.set(r.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending+=o,n.gzhead.hcrc&&n.pending>i&&(e.adler=V(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){var a,u=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>u&&(e.adler=V(e.adler,n.pending_buf,n.pending-u,u)),Te(e),0!==n.pending)return n.last_flush=-1,re;u=0}}while(a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,k(n,a),0!=a);n.gzhead.hcrc&&n.pending>u&&(e.adler=V(e.adler,n.pending_buf,n.pending-u,u)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){var c,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=V(e.adler,n.pending_buf,n.pending-l,l)),Te(e),0!==n.pending)return n.last_flush=-1,re;l=0}}while(c=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,k(n,c),0!=c);n.gzhead.hcrc&&n.pending>l&&(e.adler=V(e.adler,n.pending_buf,n.pending-l,l))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Te(e),0!==n.pending))return n.last_flush=-1,re;k(n,255&e.adler),k(n,e.adler>>8&255),e.adler=0}if(n.status=ve,Te(e),0!==n.pending)return n.last_flush=-1,re}if(0!==e.avail_in||0!==n.lookahead||t!==Q&&n.status!==ye){if(r=0===n.level?A(n,t):n.strategy===le?function(e,t){for(var n;;){if(0===e.lookahead&&(we(e),0===e.lookahead)){if(t===Q)return 1;break}if(e.match_length=0,n=$(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(I(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===te?(I(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(I(e,!1),0===e.strm.avail_out)?1:2}(n,t):n.strategy===he?function(e,t){for(var n,r,i,o,s=e.window;;){if(e.lookahead<=ge){if(we(e),e.lookahead<=ge&&t===Q)return 1;if(0===e.lookahead)break}if(e.match_length=0,3<=e.lookahead&&0<e.strstart&&(r=s[i=e.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){for(o=e.strstart+ge;r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o;);e.match_length=ge-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(3<=e.match_length?(n=$(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=$(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(I(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===te?(I(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(I(e,!1),0===e.strm.avail_out)?1:2}(n,t):Ie[n.level].func(n,t),3!==r&&4!==r||(n.status=ye),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),re;if(2===r&&(t===J?X(n):t!==ne&&(Z(n,0,0,!1),t===ee)&&(Se(n.head),0===n.lookahead)&&(n.strstart=0,n.block_start=0,n.insert=0),Te(e),0===e.avail_out))return n.last_flush=-1,re}return t===te&&(n.wrap<=0||(2===n.wrap?(k(n,255&e.adler),k(n,e.adler>>8&255),k(n,e.adler>>16&255),k(n,e.adler>>24&255),k(n,255&e.total_in),k(n,e.total_in>>8&255),k(n,e.total_in>>16&255),k(n,e.total_in>>24&255)):(O(n,e.adler>>>16),O(n,65535&e.adler)),Te(e),0<n.wrap&&(n.wrap=-n.wrap),0===n.pending))?ie:re}(s,r))===qe)return 0<s.next_out&&this.onData(s.output.subarray(0,s.next_out)),i=this.strm,o=void 0,n=Oe(i)?oe:(o=i.state.status,i.state=null,o===ve?w(i,se):re),this.onEnd(n),this.ended=!0,n===Fe;if(0!==s.avail_out){if(0<r&&0<s.next_out)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},We.prototype.onData=function(e){this.chunks.push(e)},We.prototype.onEnd=function(e){e===Fe&&(this.result=function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n].length;for(var i=new Uint8Array(t),o=0,s=0,a=e.length;o<a;o++){var u=e[o];i.set(u,s),s+=u.length}return i}(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Xe={Deflate:We,deflate:F=Ze,deflateRaw:Ke,gzip:$e,constants:W};e.Deflate=We,e.constants=W,e.default=Xe,e.deflate=F,e.deflateRaw=Ke,e.gzip=$e,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,n){"use strict";function r(e,t,n,r){if(this.bucketSize=1,this.tokensPerInterval=1,this.interval=1e3,this.parentBucket=null,this.content=0,this.lastDrip=0,this.bucketSize=e,this.tokensPerInterval=t,"string"==typeof n)switch(n){case"sec":case"second":this.interval=1e3;break;case"min":case"minute":this.interval=6e4;break;case"hr":case"hour":this.interval=36e5;break;case"day":this.interval=864e5;break;default:throw new Error("Invaid interval "+n)}else this.interval=n;this.parentBucket=r,this.content=0,this.lastDrip=+new Date}Object.defineProperty(t,"__esModule",{value:!0}),t.TokenBucket=void 0,r.prototype.removeTokens=function(e,t){var n=this;return this.bucketSize?e>this.bucketSize?(setTimeout(t.bind(null,"Requested tokens "+e+" exceeds bucket size "+this.bucketSize,null),0),!1):(this.drip(),e>this.content?r():this.parentBucket?this.parentBucket.removeTokens(e,(function(i,o){return i?t(i,null):e>n.content?r():(n.content-=e,void t(null,Math.min(o,n.content)))})):(this.content-=e,setTimeout(t.bind(null,null,this.content),0),!0)):(setTimeout(t.bind(null,null,e,Number.POSITIVE_INFINITY),0),!0);function r(){var r=Math.ceil((e-n.content)*(n.interval/n.tokensPerInterval));return setTimeout((function(){n.removeTokens(e,t)}),r),!1}},r.prototype.tryRemoveTokens=function(e){if(this.bucketSize){if(e>this.bucketSize)return!1;if(this.drip(),e>this.content)return!1;if(this.parentBucket&&!this.parentBucket.tryRemoveTokens(e))return!1;this.content-=e}return!0},r.prototype.drip=function(){var e,t;this.tokensPerInterval?(t=+new Date,e=Math.max(t-this.lastDrip,0),this.lastDrip=t,t=e*(this.tokensPerInterval/this.interval),this.content=Math.min(this.content+t,this.bucketSize)):this.content=this.bucketSize},t.TokenBucket=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,(u=i?[2&u[0],i.value]:u)[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3]))o.label=u[1];else if(6===u[0]&&o.label<i[1])o.label=i[1],i=u;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(u)}}u=t.call(e,o)}catch(a){u=[6,a],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStoreHandler=void 0,n(11)),a=n(5),u=n(4),c=o(n(12));function l(e,t,n,r,i,o){this.name=e,this.storeName=t,this.config=n,this.traceType=r,this.staticConfig=i,this.stateCenter=o,this.storeSize=0,this.storeTime=0,this.storeDelPer=u.STORE_SIZE.storeDelPer,this.updateTimeFreq=6e4,this.storeSleepInterval=6e5,this.droping=!1,this.bufferData=[],this.updateTimer=null,this.interSymbol="#",this.drops=[],this.storesKeys="",this.transStores=[],this.store=s.createZegoStore(e,n.env,t),this.commonStore=s.createZegoStore("data_common",n.env,"reporter")}Object.defineProperty(l.prototype,"KEY",{get:function(){return"z_t_"+this.config.appID},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"STORES_KEY",{get:function(){return"z_store_keys"},enumerable:!1,configurable:!0}),l.prototype.init=function(){return r(this,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,6,,7]),this.setCommonStoreState(),[4,this.transferStoreData()];case 1:return n.sent(),[4,this.commonStore.getItem(this.name+this.interSymbol+this.storeName)];case 2:return(e=n.sent())?[3,4]:(t={storeSize:this.storeSize,lock:0,pros:1},[4,this.commonStore.setItem(this.name+this.interSymbol+this.storeName,t)]);case 3:return n.sent(),[3,5];case 4:t="string"==typeof e?JSON.parse(e):e,this.storeSize=t.storeSize,n.label=5;case 5:return[3,7];case 6:return n.sent(),[3,7];case 7:return[2]}}))}))},l.prototype.uninit=function(){this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=null)},l.prototype.setCommonStoreState=function(){var e=this,t=(this.getStorage(this.STORES_KEY)||"").split(";");this.transStores=t.filter((function(t){return t.includes(e.config.appID+"")})),t=t.filter((function(t){return!t.includes(e.config.appID+"")})),this.storesKeys=t.join(";")},l.prototype.resetCommonStore=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return e=0<this.storesKeys.length?";":"",this.saveStorage(this.STORES_KEY,this.storesKeys+e+this.name+this.interSymbol+this.storeName),[4,this.commonStore.setItem(this.name+this.interSymbol+this.storeName,{storeSize:this.storeSize,lock:0,pros:0})];case 1:return t.sent(),[2]}}))}))},l.prototype.transferStoreData=function(){return r(this,void 0,void 0,(function(){var e,t,n,o,u=this;return i(this,(function(c){switch(c.label){case 0:return[4,this.commonStore.keys()];case 1:e=c.sent(),t=function(t){var o,c,l,h,d,f,p,g;return i(this,(function(_){switch(_.label){case 0:return(o=e[t])===n.name+n.interSymbol+n.storeName?[3,9]:[4,n.commonStore.getItem(o)];case 1:return(c="string"==typeof(c=_.sent())?JSON.parse(c):c).lock||c.pros&&!n.transStores.includes(o)?[3,9]:(h=o.split(n.interSymbol),l=h[0],h=h[1],[4,(d=s.createZegoStore(l,n.config.env,h)).keys()]);case 2:return 0!=(f=_.sent()).length?[3,3]:[3,8];case 3:return c.lock=1,[4,n.commonStore.setItem(o,c)];case 4:_.sent(),p=function(e){var t,o,s,c,l;return i(this,(function(h){switch(h.label){case 0:return t=f[e],[4,d.getItem(t)];case 1:return o=h.sent(),-1!==t.indexOf("pending")?o&&JSON.parse(o).forEach((function(e){return r(u,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.storeData(e)];case 1:return t.sent(),[2]}}))}))})):(l=a.analyzeKey(t),s=l.level,c=l.timestamp,l=l.seq,n.storeData({level:s,timestamp:c,seq:l,content:o})),setTimeout((function(){return r(u,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,d.removeItem(t)];case 1:return e.sent(),[2]}}))}))}),300),[2]}}))},g=0,_.label=5;case 5:return g<f.length?[5,p(g)]:[3,8];case 6:_.sent(),_.label=7;case 7:return g++,[3,5];case 8:n.drops.push({name:l,storeName:h}),_.label=9;case 9:return[2]}}))},n=this,o=0,c.label=2;case 2:return o<e.length?[5,t(o)]:[3,5];case 3:c.sent(),c.label=4;case 4:return o++,[3,2];case 5:return this.transportStorageData(),setTimeout((function(){return r(u,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:e=0,r.label=1;case 1:if(!(e<this.drops.length))return[3,7];n=this.drops[e],t=n.name,n=n.storeName,r.label=2;case 2:return r.trys.push([2,5,,6]),[4,this.dropInstance(t,n)];case 3:return r.sent(),[4,this.commonStore.removeItem(t+this.interSymbol+n)];case 4:case 5:return r.sent(),[3,6];case 6:return e++,[3,1];case 7:return[2]}}))}))}),1e3),[2]}}))}))},l.prototype.dropInstance=function(e,t){return new Promise((function(n,r){c.default.dropInstance({name:e+":"+t}).then((function(){n()})).catch((function(e){r(e)}))}))},l.prototype.setDropCallBack=function(e){this.dropCallBack=e},l.prototype.storeData=function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,o,s,u,c=this;return i(this,(function(i){switch(i.label){case 0:t=e.level,s=e.timestamp,r=e.seq,o=e.content,s=t+"_"+s+"_"+r,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.store.getItem(s)];case 2:return i.sent()?(n(),[2]):[3,4];case 3:return i.sent(),[3,4];case 4:if(this.droping)return this.bufferData.push(e),[2];if(u=a.calculateMemSize(s)+a.calculateMemSize(o),this.staticConfig.totalDBSize-u<=0)return this.dropDBData(t,s,o).then((function(){c.droping=!1,c.bufferDump()})).catch((function(e){})),n(),[2];i.label=5;case 5:return i.trys.push([5,8,,9]),[4,this.store.setItem(s,o)];case 6:return i.sent(),this.storeSize+=u,this.staticConfig.totalDBSize-=u,[4,this.refreshStoreInfo()];case 7:return i.sent(),n(),[3,9];case 8:return"QuotaExceededError"===i.sent().name&&this.dropDBData(t,s,o).then((function(){c.droping=!1,c.bufferDump()})).catch((function(e){})),[3,9];case 9:return[2]}}))}))}))},l.prototype.loadPendingData=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){switch(t.label){case 0:return[4,this.store.keys()];case 1:return t.sent().forEach((function(t){return r(e,void 0,void 0,(function(){var e,n=this;return i(this,(function(o){switch(o.label){case 0:return-1===t.indexOf("pending")?[3,3]:[4,this.store.getItem(t)];case 1:return(e=o.sent())?(JSON.parse(e).forEach((function(e){return r(n,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.storeData(e)];case 1:return t.sent(),[2]}}))}))})),[4,this.store.removeItem(t)]):[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))})),[2]}}))}))},l.prototype.storePendingData=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.store.setItem("pending"+(new Date).getTime(),JSON.stringify(e))];case 1:return t.sent(),[2]}}))}))},l.prototype.bufferDump=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return(e=this.bufferData.pop())?[4,this.storeData(e)]:[3,2];case 1:t.sent(),this.bufferDump(),t.label=2;case 2:return[2]}}))}))},l.prototype.dropDBData=function(e,t,n){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(o){return this.droping=!0,[2,new Promise((function(o,s){return r(e,void 0,void 0,(function(){var e,r,u,c,l;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,10,,11]),[4,this.store.keys()];case 1:(e=i.sent()).reverse(),r=Math.ceil(e.length*this.storeDelPer),u=0,i.label=2;case 2:return u<r?[4,this.store.getItem(e[u])]:[3,7];case 3:return null==(c=i.sent())?[3,6]:[4,this.store.removeItem(e[u])];case 4:return i.sent(),l=a.calculateMemSize(e[u])+a.calculateMemSize(c),this.staticConfig.totalDBSize+=l,this.storeSize-=l,[4,this.refreshStoreInfo()];case 5:i.sent(),this.dropCallBack(c),i.label=6;case 6:return u++,[3,2];case 7:return[4,this.store.setItem(t,n)];case 8:return i.sent(),this.storeSize+=a.calculateMemSize(t)+a.calculateMemSize(n),[4,this.refreshStoreInfo()];case 9:return i.sent(),o(),[3,11];case 10:return l=i.sent(),s(l),[3,11];case 11:return[2]}}))}))}))]}))}))},l.prototype.removeDataItem=function(e){var t=this;return new Promise((function(n,o){return r(t,void 0,void 0,(function(){var t,r,s,u,c;return i(this,(function(i){switch(i.label){case 0:t=e.level,s=e.timestamp,u=e.seq,e.content,t=t+"_"+s+"_"+u,i.label=1;case 1:return i.trys.push([1,6,,7]),[4,this.store.getItem(t)];case 2:return(r=i.sent())?[4,this.store.removeItem(t)]:[3,5];case 3:return i.sent(),s=1==this.config.env?a.calculateMemSize(JSON.parse(r)):a.calculateMemSize(r),u=a.calculateMemSize(t)+s,this.storeSize-=u,this.staticConfig.totalDBSize+=u,this.traceType.DB_O_DONE+=u,[4,this.refreshStoreInfo()];case 4:i.sent(),n(),i.label=5;case 5:return[3,7];case 6:return c=i.sent(),o(c),[3,7];case 7:return[2]}}))}))}))},l.prototype.refreshStoreInfo=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,this.commonStore.getItem(this.name+this.interSymbol+this.storeName)];case 1:return e.sent()?[4,this.commonStore.setItem(this.name+this.interSymbol+this.storeName,{storeSize:this.storeSize,lock:0,pros:1})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:return e.sent(),[3,5];case 5:return[2]}}))}))},l.prototype.readStoreDataItem=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,r,o,s,u;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.store.keys()];case 1:return e=i.sent(),[4,this.store.getItem(e[0])];case 2:return r=i.sent(),s=a.analyzeKey(e[0]),u=s.level,o=s.timestamp,s=s.seq,t({level:u,timestamp:o,seq:s,content:r}),[3,4];case 3:return u=i.sent(),n(u),[3,4];case 4:return[2]}}))}))}))},l.prototype.loadDBData=function(e,t,n,o){var s=this;return new Promise((function(u,c){return r(s,void 0,void 0,(function(){var r,s,l,h,d,f,p,g,_,m;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),[4,this.store.keys()];case 1:r=i.sent(),s=[],f=d=h=l=0,i.label=2;case 2:return f<r.length?o(r[f])?[3,4]:[4,this.store.getItem(r[f])]:[3,5];case 3:if(null==(p=i.sent()))return[3,4];if(g=a.analyzeKey(r[f]),_=g.level,m=g.timestamp,g=g.seq,s.push({level:_,timestamp:m,seq:g,content:p,key:r[f]}),_=a.calculateMemSize(p),h+=_,e<=(l+=_)&&(l=0,d++),t<=d&&n<=h)return[3,5];i.label=4;case 4:return f++,[3,2];case 5:return u({datas:s,len:h}),[3,7];case 6:return m=i.sent(),c(m),[3,7];case 7:return[2]}}))}))}))},l.prototype.sortKeys=function(e,t){void 0===t&&(t=!1),e.sort((function(e,t){return e=e.split("_"),+(t=t.split("_"))[0]-+e[0]||+t[1]-+e[1]||+t[2]-+e[2]})),t&&e.reverse()},l.prototype.saveStorage=function(e,t){try{localStorage.setItem(e,t)}catch(e){this.stateCenter._log.debug("storage set err")}},l.prototype.getStorage=function(e){try{return localStorage.getItem(e)}catch(e){this.stateCenter._log.debug("storage get err")}},l.prototype.saveDataToStorage=function(e){try{var t=e.level,n=e.timestamp,r=e.seq,i=e.content,o=t+"_"+n+"_"+r;this.saveStorage(this.KEY+"_"+o,i)}catch(e){this.stateCenter._log.debug("saveDataToStorage "+JSON.stringify(e))}},l.prototype.transportStorageData=function(){for(var e=[],t=0;t<localStorage.length;t++){var n,r,i,o,s=localStorage.key(t);this.stateCenter._log.debug("transportStorageData "+s),null!=s&&s.startsWith(this.KEY)&&(i=s.replace(this.KEY+"_",""),n=(i=a.analyzeKey(i)).level,r=i.timestamp,i=i.seq,"string"==typeof(o=this.getStorage(s))&&this.storeData({level:n,timestamp:r,seq:i,content:o}),e.push(s))}setTimeout((function(){for(var t=0;t<e.length;t++)localStorage.removeItem(e[t])}),100)},t.ZegoStoreHandler=l},function(e,t,n){"use strict";var r=n(32),i=n(33).Buffer;function o(e){return function(t){if(i.isBuffer(t))return t.length;switch(typeof t){case"string":return t.length*r.STRING;case"boolean":return r.BOOLEAN;case"number":return r.NUMBER;case"symbol":return Symbol.keyFor&&Symbol.keyFor(t)?Symbol.keyFor(t).length*r.STRING:(t.toString().length-8)*r.STRING;case"object":if(Array.isArray(t))return t.map(o(e)).reduce((function(e,t){return e+t}),0);var n=e,s=t;if(null==s)return 0;for(var a=0,u=function(e){var t,n=[];for(t in e)n.push(t);return Object.getOwnPropertySymbols&&(e=Object.getOwnPropertySymbols(e),Array.prototype.push.apply(n,e)),n}(s),c=0;c<u.length;c++){var l=u[c];if("object"==typeof s[l]&&null!==s[l]){if(n.has(s[l]))continue;n.add(s[l])}a+=o(n)(l);try{a+=o(n)(s[l])}catch(n){n instanceof RangeError&&(a=0)}}return a;default:return 0}}}e.exports=function(e){return o(new WeakSet)(e)}},function(e,t){e.exports={STRING:2,BOOLEAN:4,NUMBER:8}},function(e,t,n){"use strict";(function(e){var r=n(35),i=n(36),o=n(37);function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(e=null===e?new u(t):e).length=t,e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"!=typeof e)return c(this,e,t,n);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer){var i=e,s=t,c=n;if(s.byteLength,c<0||s.byteLength<c)throw new RangeError("'offset' is out of bounds");if(s.byteLength<c+(r||0))throw new RangeError("'length' is out of bounds");return s=void 0===c&&void 0===r?new Uint8Array(s):void 0===r?new Uint8Array(s,c):new Uint8Array(s,c,r),u.TYPED_ARRAY_SUPPORT?(i=s).__proto__=u.prototype:i=d(i,s),i}if("string"!=typeof t){if(c=e,r=t,u.isBuffer(r))return 0!==(c=a(c,s=0|f(r.length))).length&&r.copy(c,0,0,s),c;if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||(s=r.length)!=s?a(c,0):d(c,r);if("Buffer"===r.type&&o(r.data))return d(c,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}if(i=e,r=t,u.isEncoding(e="string"==typeof(e=n)&&""!==e?e:"utf8"))return(r=(i=a(i,t=0|p(r,e))).write(r,e))!==t?i.slice(0,r):i;throw new TypeError('"encoding" must be a valid string encoding')}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=a(e,t<0?0:0|f(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|f(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;var n=(e="string"!=typeof e?""+e:e).length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return O(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return N(e).length;default:if(r)return O(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function _(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,(n=(n=isNaN(n)?i?0:e.length-1:n)<0?e.length+n:n)>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){var o=1,s=e.length,a=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s/=o=2,a/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i)for(var c=-1,l=n;l<s;l++)if(u(e,l)===u(t,-1===c?0:l-c)){if(l-(c=-1===c?l:c)+1===a)return c*o}else-1!==c&&(l-=l-c),c=-1;else for(l=n=s<n+a?s-a:n;0<=l;l--){for(var h=!0,d=0;d<a;d++)if(u(e,l+d)!==u(t,d)){h=!1;break}if(h)return l}return-1}function v(e,t,n,r){return A(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function y(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,u,c=e[i],l=null,h=239<c?4:223<c?3:191<c?2:1;if(i+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&127<(u=(31&c)<<6|63&o)&&(l=u);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&2047<(u=(15&c)<<12|(63&o)<<6|63&s)&&(u<55296||57343<u)&&(l=u);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&65535<(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)&&u<1114112&&(l=u)}null===l?(l=65533,h=1):65535<l&&(r.push((l-=65536)>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}var d=r,f=d.length;if(f<=S)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=S));return p}t.Buffer=u,t.SlowBuffer=function(e){return u.alloc(+(e=+e!=e?0:e))},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol)&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0}),u.alloc=function(e,t,n){return l(e),e<=0||void 0===t?a(null,e):"string"==typeof n?a(null,e).fill(t,n):a(null,e).fill(t)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);if(void 0===t)for(i=t=0;i<e.length;++i)t+=e[i].length;for(var n=u.allocUnsafe(t),r=0,i=0;i<e.length;++i){var s=e[i];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,r),r+=s.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0==e?"":0===arguments.length?y(this,0,e):function(e,t,n){var i,o,s=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((n=void 0===n||n>this.length?this.length:n)<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var a=t,u=n,c=this.length;(!u||u<0||c<u)&&(u=c);for(var l="",h=a=!a||a<0?0:a;h<u;++h)l+=(o=this[h])<16?"0"+o.toString(16):o.toString(16);return l;case"utf8":case"utf-8":return y(this,t,n);case"ascii":c=t;for(var d=n,f="",p=(d=Math.min(this.length,d),c);p<d;++p)f+=String.fromCharCode(127&this[p]);return f;case"latin1":case"binary":a=t;for(var g=n,_="",m=(g=Math.min(this.length,g),a);m<g;++m)_+=String.fromCharCode(this[m]);return _;case"base64":return v=this,i=n,0===(S=t)&&i===v.length?r.fromByteArray(v):r.fromByteArray(v.slice(S,i));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var v=t,S=n,E=this.slice(v,S),b="",T=0;T<E.length;T+=2)b+=String.fromCharCode(E[T]+256*E[T+1]);return b;default:if(s)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(u.isBuffer(e))return this===e||0===u.compare(this,e);throw new TypeError("Argument must be a Buffer")},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n)&&(e+=" ... "),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),(t=void 0===t?0:t)<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(i<=r&&n<=t)return 0;if(i<=r)return-1;if(n<=t)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(r,i),l=e.slice(t,n),h=0;h<a;++h)if(c[h]!==l[h]){o=c[h],s=l[h];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return _(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return _(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||i<n)&&(n=i),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r=r||"utf8";for(var o,s,a,u,c=!1;;)switch(r){case"hex":var l,h=e,d=n,f=(l=Number(t)||0,this.length-l);if((!d||f<(d=Number(d)))&&(d=f),(f=h.length)%2!=0)throw new TypeError("Invalid hex string");f/2<d&&(d=f/2);for(var p=0;p<d;++p){var g=parseInt(h.substr(2*p,2),16);if(isNaN(g))return p;this[l+p]=g}return p;case"utf8":case"utf-8":return f=t,s=n,A(O(e,(o=this).length-f),o,f,s);case"ascii":case"latin1":case"binary":return v(this,e,t,n);case"base64":return o=this,s=t,a=n,A(N(e),o,s,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a=t,u=n,A(function(e,t){for(var n,r,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i.push(n%256),i.push(r);return i}(e,this.length-a),this,a,u);default:if(c)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),c=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function E(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function b(e,t,n,r,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function T(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function C(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function w(e,t,n,r){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function R(e,t,n,r,o){return o||w(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function I(e,t,n,r,o){return o||w(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=u.prototype;else for(var r=t-e,i=new u(r,void 0),o=0;o<r;++o)i[o]=this[o+e];return i},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||E(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||E(e,t,this.length);for(var r=this[e+--t],i=1;0<t&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||E(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||E(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||E(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||E(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return(i*=128)<=r&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||E(e,t,this.length);for(var r=t,i=1,o=this[e+--r];0<r&&(i*=256);)o+=this[e+--r]*i;return(i*=128)<=o&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){return t||E(e,2,this.length),32768&(t=this[e]|this[e+1]<<8)?4294901760|t:t},u.prototype.readInt16BE=function(e,t){return t||E(e,2,this.length),32768&(t=this[e+1]|this[e]<<8)?4294901760|t:t},u.prototype.readInt32LE=function(e,t){return t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||E(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||E(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||E(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||E(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||b(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||b(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;0<=--i&&(o*=256);)this[t+i]=e/o&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):T(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):T(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):C(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):C(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){e=+e,t|=0,r||b(this,e,t,n,(r=Math.pow(2,8*n-1))-1,-r);var i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){e=+e,t|=0,r||b(this,e,t,n,(r=Math.pow(2,8*n-1))-1,-r);var i=n-1,o=1,s=0;for(this[t+i]=255&e;0<=--i&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&(e=e<0?255+e+1:e),t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):T(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):T(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):C(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||b(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):C(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return R(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return R(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return I(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return I(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n=n||0,r||0===r||(r=this.length),t>=e.length&&(t=e.length),(r=0<r&&r<n?n:r)===n)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length);var i,o=(r=e.length-t<r-n?e.length-t+n:r)-n;if(this===e&&n<t&&t<r)for(i=o-1;0<=i;--i)e[i+t]=this[i+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){var i;if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length&&(i=e.charCodeAt(0))<256&&(e=i),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(!(n<=t))if(t>>>=0,n=void 0===n?this.length:n>>>0,"number"==typeof(e=e||0))for(a=t;a<n;++a)this[a]=e;else for(var o=u.isBuffer(e)?e:O(new u(e,r).toString()),s=o.length,a=0;a<n-t;++a)this[a+t]=o[a%s];return this};var k=/[^+\/0-9A-Za-z-_]/g;function O(e,t){t=t||1/0;for(var n,r=e.length,i=null,o=[],s=0;s<r;++s){if(55295<(n=e.charCodeAt(s))&&n<57344){if(!i){if(56319<n){-1<(t-=3)&&o.push(239,191,189);continue}if(s+1===r){-1<(t-=3)&&o.push(239,191,189);continue}i=n;continue}if(n<56320){-1<(t-=3)&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&-1<(t-=3)&&o.push(239,191,189);if(i=null,n<128){if(--t<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function N(e){return r.toByteArray(function(e){var t;if((e=((t=e).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(k,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(34))},function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";t.byteLength=function(e){return 3*((e=u(e))[0]+(e=e[1]))/4-e},t.toByteArray=function(e){for(var t,n=(r=u(e))[0],r=r[1],s=new o(3*(n+r)/4-r),a=0,c=0<r?n-4:n,l=0;l<c;l+=4)t=i[e.charCodeAt(l)]<<18|i[e.charCodeAt(l+1)]<<12|i[e.charCodeAt(l+2)]<<6|i[e.charCodeAt(l+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=255&t;return 2===r&&(t=i[e.charCodeAt(l)]<<2|i[e.charCodeAt(l+1)]>>4,s[a++]=255&t),1===r&&(t=i[e.charCodeAt(l)]<<10|i[e.charCodeAt(l+1)]<<4|i[e.charCodeAt(l+2)]>>2,s[a++]=t>>8&255,s[a++]=255&t),s},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(function(e,t){for(var n,i=[],o=s;o<t;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(r[n>>18&63]+r[n>>12&63]+r[n>>6&63]+r[63&n]);return i.join("")}(e,a<s+16383?a:s+16383));return 1==i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2==i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0;a<64;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return t=(e=-1===(e=e.indexOf("="))?t:e)===t?0:4-e%4,[e,t]}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,l=-7,h=n?i-1:0,d=n?-1:1;for(i=e[t+h],h+=d,o=i&(1<<-l)-1,i>>=-l,l+=a;0<l;o=256*o+e[t+h],h+=d,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;0<l;s=256*s+e[t+h],h+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(i?-1:1);s+=Math.pow(2,r),o-=c}return(i?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,u=8*o-i-1,c=(1<<u)-1,l=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1;for(o=t<0||0===t&&1/t<0?1:0,t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-s))<1&&(s--,r*=2),2<=(t+=1<=s+l?h/r:h*Math.pow(2,1-l))*r&&(s++,r/=2),c<=s+l?(a=0,s=c):1<=s+l?(a=(t*r-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));8<=i;e[n+d]=255&a,d+=f,a/=256,i-=8);for(s=s<<i|a,u+=i;0<u;e[n+d]=255&s,d+=f,s/=256,u-=8);e[n+d-f]|=128*o}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.PendingQueue=void 0,n(0)),s=n(5);function a(e,t,n,r){var i=this;this.levels=e,this.product=t,this.staticConfig=n,this.stateCenter=r,this.byteLength=0,this.size=0,this.pendingDataSize=0,this.cacheMap=new Map,e.forEach((function(e){i.cacheMap.set(e,new o.Queue)}))}a.prototype.enqueue=function(e,t){(t=this.cacheMap.get(t))&&!t.all().find((function(t){return t.content==e.content}))&&(t.enqueue(e),t=s.calculateMemSize(e.content),this.pendingDataSize+=t,this.size++,this.staticConfig.totalAvailCache-=t,this.enCallback)&&this.enCallback(this.byteLength,this.size,this.pendingDataSize)},a.prototype.dequeue=function(e){return e=null==(e=this.cacheMap.get(e))?void 0:e.dequeue(),this.size--,this.deCallback&&this.deCallback(),e},a.prototype.findInQueue=function(e){var t=null==(t=this.cacheMap.get(e.level))?void 0:t.all();return null==t?void 0:t.find((function(t){return t.key===e.key}))},a.prototype.readReportData=function(e){var t=i(this.cacheMap.entries());t=this.readData(t,e,!0);return this.reset(),{totalLen:t.totalLen,reportDataArr:t.resArr}},a.prototype.readStoreData=function(e){e=Math.ceil(this.pendingDataSize*e);var t=i(this.cacheMap.entries()).reverse();t=this.readData(t,e,!1);return this.refresh(t.totalLen),{totalLen:t.totalLen,storeArr:t.resArr}},a.prototype.readData=function(e,t,n){var i=[],o=0;e:for(var a=0;a<e.length;a++)for(var u=r(e[a],2),c=u[0],l=u[1];l.size();){var h=this.dequeue(c);if(i.push(h),t<(o+=s.calculateMemSize(h.content)))break e}return{totalLen:o,resArr:i}},a.prototype.decodeReportData=function(e){var t=this;e.forEach((function(e){t.enqueue(e,e.level)}))},a.prototype.setListener=function(e){this.enCallback=e.enCallback,this.deCallback=e.deCallback},a.prototype.getPendingDataInfo=function(){return{pendingDataSize:this.pendingDataSize,size:this.size}},a.prototype.refresh=function(e){this.pendingDataSize-=e,this.staticConfig.totalAvailCache+=e},a.prototype.reset=function(){this.byteLength=0},t.PendingQueue=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,(u=i?[2&u[0],i.value]:u)[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3]))o.label=u[1];else if(6===u[0]&&o.label<i[1])o.label=i[1],i=u;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(u)}}u=t.call(e,o)}catch(a){u=[6,a],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.loadJS=void 0,n(40));function s(e,t,n){return(e=o.decrypt(e,t))&&o.hashMd5(e)===n?e:""}t.loadJS=function(e,t,n,o,a,u,c){var l=this;return new Promise((function(h,d){return r(l,void 0,void 0,(function(){var l,f,p,g,_;return i(this,(function(m){switch(m.label){case 0:if(l="dy",e)return[3,7];m.label=1;case 1:return m.trys.push([1,5,,6]),[4,t.getItem("code")];case 2:return f=m.sent(),[4,t.getItem("key")];case 3:return p=m.sent(),[4,t.getItem("hash")];case 4:g=m.sent();var v=s(f,p,g)||u,y=l,S=c,E=document.getElementsByTagName("HEAD").item(0),b=document.createElement("script");b.language="javascript",b.type="text/javascript",b.id=y,b.param=S;try{b.appendChild(document.createTextNode(v))}catch(y){b.text=v}return E.appendChild(b),h(),[3,6];case 5:return m.sent(),d(),[3,6];case 6:return[2];case 7:if(window.ActiveXObject)try{_=new ActiveXObject("Msxml2.XMLHTTP")}catch(m){_=new ActiveXObject("Microsoft.XMLHTTP")}else window.XMLHttpRequest&&(_=new XMLHttpRequest);return _.open("GET",n,!0),_.send(null),_.onreadystatechange=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:if(4!=_.readyState)return[3,10];if(!(200<=_.status&&_.status<300||0==_.status||304==_.status))return[3,8];e.label=1;case 1:return e.trys.push([1,6,,7]),s(_.responseText,o,a)?[4,t.setItem("code",_.responseText)]:[3,5];case 2:return e.sent(),[4,t.setItem("key",o)];case 3:return e.sent(),[4,t.setItem("hash",a)];case 4:e.sent(),e.label=5;case 5:return h(),[3,7];case 6:return e.sent(),d(),[3,7];case 7:return[2];case 8:return d(),[2];case 9:return[3,11];case 10:case 11:return[2]}}))}))},[2]}}))}))}))}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.hashMd5=t.decrypt=void 0,r(n(41))),o=r(n(42)),s=r(n(43));t.decrypt=function(e,t){var n="";try{n=o.default.decrypt(e,t).toString(s.default)}catch(e){}return n},t.hashMd5=function(e){return i.default(e).toString()}},function(e,t){e.exports=o},function(e,t){e.exports=s},function(e,t){e.exports=a},function(e,t,n){"use strict";function r(){this.logLevel=t.ENUM_LOG_LEVEL.DISABLE}Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLog=t.ENUM_LOG_LEVEL=void 0,t.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},r.prototype.setLogLevel=function(e){return void 0!==(e=t.ENUM_LOG_LEVEL[e])&&(this.logLevel=e,!0)},r.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.join(" ");this.logLevel!==t.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=t.ENUM_LOG_LEVEL.DEBUG&&console.debug(r)},r.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.join(" ");this.logLevel!==t.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=t.ENUM_LOG_LEVEL.INFO&&console.log(r)},r.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.join(" ");this.logLevel!==t.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=t.ENUM_LOG_LEVEL.INFO&&console.info(r)},r.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.join(" ");this.logLevel!==t.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=t.ENUM_LOG_LEVEL.WARN&&console.warn(r)},r.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.join(" ");this.logLevel!==t.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=t.ENUM_LOG_LEVEL.ERROR&&console.error(r)},t.ZegoLog=r},function(e,t,n){"use strict";function r(e){this.logger=e,this._log=e}Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0,r.prototype.isLogin=function(){return!0},t.StateCenter=r},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicCode=void 0,n(3));function s(){this.init()}s.prototype.init=function(){window.dyObj={}},s.prototype.runExecution=function(e,t,n){e=new(Function.bind.apply(Function,i([void 0],e,[n])));try{e.apply(void 0,i(t))}catch(e){o.log.error(e)}},t.DynamicCode=s}],c={},r.m=u,r.c=c,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=13))},function(e,n){e.exports=t},function(e,t,n){var r,i,o,s,a;e.exports=(e=n(1),n(16),n(17),r=(o=(n=e).lib).Base,i=o.WordArray,s=(o=n.algo).MD5,a=o.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:s,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,r=this.cfg,o=r.hasher.create(),s=i.create(),a=s.words,u=r.keySize,c=r.iterations;a.length<u;){n&&o.update(n),n=o.update(e).finalize(t),o.reset();for(var l=1;l<c;l++)n=o.finalize(n),o.reset();s.concat(n)}return s.sigBytes=4*u,s}}),n.EvpKDF=function(e,t,n){return a.create(n).compute(e,t)},e.EvpKDF)},function(e,t,n){function r(e){var t;return(a[e]||(t=a[e]={i:e,l:!1,exports:{}},s[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}var i,o,s,a;e.exports=(i=n(0),o=n(2),s=[function(e,t){e.exports=i},function(e,t){e.exports=o},function(e,t,n){"use strict";var r,i,o,s,a,u,c,l;n.r(t),n.d(t,"ZegoConnectionAgent",(function(){return we})),n.d(t,"NetAgentPCRequest",(function(){return ge})),n.d(t,"NetAgentHttpRequest",(function(){return Ee})),n.d(t,"BusinessService",(function(){return o})),n.d(t,"BrokenType",(function(){return g})),n.d(t,"NET_ACCESS_CONFIG",(function(){return ue})),n.d(t,"ConnectedType",(function(){return p})),n.d(t,"DisconnectedType",(function(){return f})),n.d(t,"Mode",(function(){return a})),n.d(t,"Method",(function(){return d})),(t=r=r||{})[t.offline=0]="offline",t[t.online=1]="online",(t=i=i||{})[t.MSG_TYPE_STREAM_CLOSED=2]="MSG_TYPE_STREAM_CLOSED",t[t.MSG_TYPE_CLOSE_CONNECTION=3]="MSG_TYPE_CLOSE_CONNECTION",t[t.MSG_TYPE_HTTP_REQUEST=4]="MSG_TYPE_HTTP_REQUEST",t[t.MSG_TYPE_HTTP_RESPONSE=5]="MSG_TYPE_HTTP_RESPONSE",t[t.MSG_TYPE_HB_REQUEST=12]="MSG_TYPE_HB_REQUEST",t[t.MSG_TYPE_HB_RESPONSE=13]="MSG_TYPE_HB_RESPONSE",t[t.MSG_TYPE_GET_CONFIG_REQUEST=14]="MSG_TYPE_GET_CONFIG_REQUEST",t[t.MSG_TYPE_GET_CONFIG_RESPONSE=15]="MSG_TYPE_GET_CONFIG_RESPONSE",t[t.MSG_TYPE_HTTP_REQUEST_ACK=16]="MSG_TYPE_HTTP_REQUEST_ACK",t[t.MSG_TYPE_PC_UPWARD_MESSAGE=17]="MSG_TYPE_PC_UPWARD_MESSAGE",t[t.MSG_TYPE_PC_UPWARD_MESSAGE_ACK=18]="MSG_TYPE_PC_UPWARD_MESSAGE_ACK",t[t.MSG_TYPE_PC_ESTABLISHED=19]="MSG_TYPE_PC_ESTABLISHED",t[t.MSG_TYPE_PC_BROKEN=20]="MSG_TYPE_PC_BROKEN",t[t.MSG_TYPE_PC_DOWNWARD_MESSAGE=21]="MSG_TYPE_PC_DOWNWARD_MESSAGE",t[t.MSG_TYPE_REDIRECT=22]="MSG_TYPE_REDIRECT",t[t.MSG_TYPE_GET_APPCONFIG_REQUEST=23]="MSG_TYPE_GET_APPCONFIG_REQUEST",t[t.MSG_TYPE_GET_APPCONFIG_RESPONSE=24]="MSG_TYPE_GET_APPCONFIG_RESPONSE",t[t.MSG_TYPE_PUSH_APPCONFIG=25]="MSG_TYPE_PUSH_APPCONFIG",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST=26]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE=27]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE",t[t.MSG_TYPE_PUSH_EXCEPTION=30]="MSG_TYPE_PUSH_EXCEPTION",t[t.MSG_TYPE_HTTP_REQUEST2=33]="MSG_TYPE_HTTP_REQUEST2",t[t.MSG_TYPE_REDIRECT2=34]="MSG_TYPE_REDIRECT2",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2=35]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2=36]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2",t[t.MSG_TYPE_GET_SVRADDR_REQUEST=39]="MSG_TYPE_GET_SVRADDR_REQUEST",t[t.MSG_TYPE_GET_SVRADDR_RESPONSE=40]="MSG_TYPE_GET_SVRADDR_RESPONSE",(t=v=v||{})[t.ACCESSHUB_INVALID_FRAME=2e4]="ACCESSHUB_INVALID_FRAME",t[t.ACCESSHUB_NEED_ENCRYPT=20001]="ACCESSHUB_NEED_ENCRYPT",t[t.ACCESSHUB_DECRYPT=20002]="ACCESSHUB_DECRYPT",t[t.ACCESSHUB_MSGTYPE=20003]="ACCESSHUB_MSGTYPE",t[t.ACCESSHUB_UNMARSHAL=20004]="ACCESSHUB_UNMARSHAL",t[t.ACCESSHUB_TIMEOUT=20005]="ACCESSHUB_TIMEOUT",t[t.ACCESSHUB_CONNECT=20006]="ACCESSHUB_CONNECT",t[t.ACCESSHUB_BROKEN=20007]="ACCESSHUB_BROKEN",t[t.ACCESSHUB_INTERNAL_ERROR=20008]="ACCESSHUB_INTERNAL_ERROR",t[t.ACCESSHUB_MARSHAL=20009]="ACCESSHUB_MARSHAL",t[t.ACCESSHUB_UNSUPPORTED_SERVICE=20010]="ACCESSHUB_UNSUPPORTED_SERVICE",t[t.ACCESSHUB_TOO_FREQUENTLY=20011]="ACCESSHUB_TOO_FREQUENTLY",t[t.ACCESSHUB_INVALID_APPID=20012]="ACCESSHUB_INVALID_APPID",t[t.ACCESSHUB_HB_TIMEOUT=20013]="ACCESSHUB_HB_TIMEOUT",t[t.ACCESSHUB_INVALID_SIGNATURE=20014]="ACCESSHUB_INVALID_SIGNATURE",(t=o=o||{})[t.SERVICE_UNSET=0]="SERVICE_UNSET",t[t.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",t[t.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",t[t.SERVICE_MIX=3]="SERVICE_MIX",t[t.SERVICE_ZEUS=4]="SERVICE_ZEUS",t[t.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",t[t.SERVICE_L3=6]="SERVICE_L3",t[t.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",t[t.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",t[t.SERVICE_ZIM=9]="SERVICE_ZIM",t[t.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",t[t.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",t[t.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",t[t.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",t[t.SERVICE_QUALITY=14]="SERVICE_QUALITY",t[t.SERVICE_SECURITY=15]="SERVICE_SECURITY",t[t.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",t[t.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",t[t.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",t[t.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",t[t.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",t[t.SERVICE_CDN=21]="SERVICE_CDN",t[t.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",t[t.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",t[t.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",t[t.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",t[t.SERVICE_ECHO=26]="SERVICE_ECHO",t[t.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",t[t.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR",(t=s=s||{})[t.ZEGOCONN_RUN_ENV_UNSET=0]="ZEGOCONN_RUN_ENV_UNSET",t[t.ZEGOCONN_RUN_ENV_BROWSER=1]="ZEGOCONN_RUN_ENV_BROWSER",t[t.ZEGOCONN_RUN_ENV_APPLET=2]="ZEGOCONN_RUN_ENV_APPLET",(t=a=a||{})[t.Mode_UNSET=0]="Mode_UNSET",t[t.MODE_ONLINE=1]="MODE_ONLINE",t[t.MODE_TEST=2]="MODE_TEST",t[t.MODE_ALPHA=3]="MODE_ALPHA",(t=u=u||{})[t.HTTP=0]="HTTP",t[t.PC=1]="PC",t[t.OTHER=2]="OTHER",(t=c=c||{})[t.NONE=0]="NONE",t[t.BROKEN=1]="BROKEN",t[t.DISCONNECT=2]="DISCONNECT",(t=l=l||{})[t.CONNECTED=0]="CONNECTED",t[t.DISCONNECT=1]="DISCONNECT",t[t.BROKEN=2]="BROKEN";var h,d,f,p,g,_=[v.ACCESSHUB_INVALID_APPID,v.ACCESSHUB_INVALID_SIGNATURE],m=((t=h=h||{})[t.ACTION_RESERVED=0]="ACTION_RESERVED",t[t.ACTION_DISPATCH=1]="ACTION_DISPATCH",t[t.ACTION_RETRY=2]="ACTION_RETRY",t[t.ACTION_NEXT_NODE=3]="ACTION_NEXT_NODE",t[t.ACTION_ABORT=4]="ACTION_ABORT",t[t.ACTION_NEXT_GROUP=5]="ACTION_NEXT_GROUP",(v=d=d||{})[v.METHOD_UNSET=0]="METHOD_UNSET",v[v.METHOD_GET=1]="METHOD_GET",v[v.METHOD_POST=2]="METHOD_POST",v[v.METHOD_PUT=3]="METHOD_PUT",v[v.METHOD_PATCH=4]="METHOD_PATCH",v[v.METHOD_DELETE=5]="METHOD_DELETE",v[v.METHOD_HEAD=6]="METHOD_HEAD",v[v.METHOD_OPTIONS=7]="METHOD_OPTIONS",(t=f=f||{})[t.CLOSE=0]="CLOSE",t[t.TEMP=1]="TEMP",t[t.TIMEOUT=2]="TIMEOUT",(v=p=p||{})[v.AUTO=0]="AUTO",v[v.MANUAL=1]="MANUAL",(t=g=g||{})[t.EMPTY=0]="EMPTY",t[t.CLOSE=1]="CLOSE",{2:"stream_closed",3:"close_connection",4:"http_request",5:"http_response",12:"hb_request",13:"hb_response",14:"get_config_request",15:"get_config_response",16:"http_request_ack",17:"pc_upward_message",18:"pc_upward_message_ack",19:"pc_established",20:"pc_broken",21:"pc_downward_message",22:"redirect",23:"get_appconfig_request",24:"get_appconfig_response",25:"push_appconfig",26:"accesshub_dispatch_request",27:"accesshub_dispatch_response",30:"push_exception",33:"http_request2",34:"redirect2",35:"accesshub_dispatch_request2",36:"accesshub_dispatch_response2",39:"get_svraddr_request",40:"get_svraddr_response"}),v=n(0),y=n.n(v),S=(t=n(1),n(1));const E=S.roots.default||(S.roots.default={}),b=n(0);S.util.Long=b,S.util.Long.fromBits=S.util.Long?S.util.Long.fromBits:function(){return 0};for(var T=S.types?S.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},C=S.types?S.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},w=Object.keys(T),R={$:function(e){return R[e]?R[e].call(this):E[e].decode?E[e].decode(this,this.uint32()):R.$.call(this,"int32")}},I={$:function(e,t,n){var r=T[e];return void 0===r?E[e].encode?(this.uint32((n<<3|2)>>0).fork(),E[e].encode(t,this).ldelim()):I.$.call(this,"int32",t,n):I[e].call(this.uint32(n<<3|r),t)}},k=0;k<w.length;k++)R[w[k]]=S.Reader.prototype[w[k]],I[w[k]]=S.Writer.prototype[w[k]];!function e(t,n,r,i){for(var o=0,s=Object.keys(t);o<s.length;o++){var a=s[o];if(t[a].$m&&Object.keys(t[a].$m).every((function(e){return Number(e)}))){if(r[a])throw Error(`nested type ${r}.${a} has already exist`);r[a]=function(t,r){function i(e){for(var n in t)"{"===(n=t[n])[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[]);if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)null!=e[r[i]]&&(this[r[i]]=e[r[i]])}var o,s={};for(o in t){var a=t[o],u=a[1];"{"===u.charAt(0)?(i.prototype[a[0]]=S.util.emptyObject,s[u]={$m:u.substring(1).split(",").map((function(e,t){return["$"+(t+1),e,null]})).reduce((function(e,t,n){return e[n+1]=t,e}),{})}):"["===u.charAt(0)||"<"===u.charAt(0)?i.prototype[a[0]]=S.util.emptyArray:"bytes"===u?i.prototype[a[0]]=S.util.newBuffer([]):a[2]&&a[2].hasOwnProperty("low")&&a[2].hasOwnProperty("high")?i.prototype[a[0]]=S.util.Long.fromBits(a[2].low,a[2].high,a[2].unsigned):i.prototype[a[0]]=a[2]}return i.decode=function(e,n){e instanceof S.Reader||(e=S.Reader.create(e));for(var r=void 0===n?e.len:e.pos+n,o=new i;e.pos<r;){var s=e.uint32(),a=s>>>3;if(0<a&&t[a]){var u=t[a][0],c=t[a][1];if("{"===c.charAt(0))o[u]===S.util.emptyObject&&(o[u]={}),a=i.$namespace[c].decode(e,e.uint32()),o[u][a.$1]=a.$2;else if("["===c.charAt(0)||"<"===c.charAt(0))if(c=c.substring(1),o[u]&&o[u].length||(o[u]=[]),void 0!==C[c]&&2==(7&s))for(var l=e.uint32()+e.pos;e.pos<l;)o[u].push(R.$.call(e,c));else o[u].push(R.$.call(e,c));else o[u]=R.$.call(e,c)}else e.skipType(7&s)}return o},i.encode=function(e,n){for(var r in n=n||S.Writer.create(),t){var o=t[r][0];if("{"===(c=t[r][1]).charAt(0)){if(null!=e[o]&&e.hasOwnProperty(o))for(var s=0,a=Object.keys(e[o]);s<a.length;++s)n.uint32((r<<3|2)>>0).fork(),i.$namespace[c].encode({$1:a[s],$2:e[o][a[s]]},n).ldelim()}else if("["===c.charAt(0)||"<"===c.charAt(0)){var u="<"===c.charAt(0),c=c.substring(1),l=e[o];if(null!=l&&l.length)if(u&&void 0!==C[c]){for(n.uint32((r<<3|2)>>0).fork(),s=0;s<l.length;s++)I[c].call(n,l[s]);n.ldelim()}else for(s=0;s<l.length;s++)I.$.call(n,c,l[s],r)}else null!=e[o]&&e.hasOwnProperty(o)&&I.$.call(n,c,e[o],r)}return n},Object.keys(s).length&&(i.$namespace=e(s,n+"."+r,i.$namespace||{},!0)),i}(t[a].$m,a)}else t[a].$s?r[a]=function(e,t){function r(e,t,n){S.rpc.Service.call(this,e,t,n)}return(r.prototype=Object.create(S.rpc.Service.prototype)).constructor=r,Object.keys(e).forEach((function(i){var o=e[i];function s(e,t){return this.rpcCall(s,E[o[0]],E[o[1]],e,t)}Object.defineProperty(s,"name",{value:i}),Object.defineProperty(s,"path",{value:n+"."+t}),r.prototype[i]=s})),r}(t[a].$s,a):t[a].$e&&Object.values(t[a].$e).every((function(e){return Number(e)===e}))&&(r[a]=function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[n[t[r]]=e[t[r]]]=t[r];return n}(t[a].$e));r[a]&&!i&&(E[n+"."+a]=r[a]),delete t[a].$m,delete t[a].$s,delete t[a].$e,r[a]=e(t[a],n?n+"."+a:a,r[a]||{})}return r}({PB:{proto_accesshub:{AccesshubAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","PB.proto_accesshub.IPV6Addr",null],3:["quic_port","uint32",0],4:["wss_port","uint32",0]}},AccesshubDispatchGroup:{$m:{1:["group","string",""],2:["quic_nodes","<string",null],3:["mtcp_nodes","<string",null],4:["wss_nodes","<string",null]}},AccesshubDispatchGroup2:{$m:{1:["group","string",""],2:["nodes","<PB.proto_accesshub.AccesshubAddr",null],3:["nodes_dual","<PB.proto_accesshub.AccesshubAddr",null]}},AccesshubDispatchRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","PB.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","PB.proto_accesshub.SdkType",0],7:["zegoconn_version","uint32",0],8:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],9:["device_id","string",""],10:["client_ip","string",""],11:["geofencing_type","uint32",0],12:["geofencings","[uint32",null],13:["addr_type","uint32",0]}},AccesshubDispatchResponse2:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","PB.proto_accesshub.AccesshubDispatchResponseData2",null]}},AccesshubDispatchResponseData2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["rand","string",""],3:["secret","string",""],4:["groups","<PB.proto_accesshub.AccesshubDispatchGroup2",null],5:["wss_groups","<PB.proto_accesshub.WssAccesshubDispatchGroup",null],6:["ttl","uint32",0]}},BackendConnType:{$e:{BACKEND_CONN_TYPE_UNSET:0,BACKEND_CONN_TYPE_TCP:1,BACKEND_CONN_TYPE_WSS:2}},CloseConnection:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["action","int32",0]},Action:{$e:{ACTION_RESERVED:0,ACTION_DISPATCH:1,ACTION_RETRY:2,ACTION_NEXT_NODE:3,ACTION_ABORT:4,ACTION_NEXT_GROUP:5}}},ConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},ErrorCode:{$e:{OK:0,DISPATCH_NO_AVAILABLE_NODE:1e4,DISPATCH_INTERNAL_ERROR:10001,DISPATCH_INVALID_FRAME:10002,DISPATCH_UNMARSHAL:10003,DISPATCH_MSGTYPE:10004,DISPATCH_MARSHAL:10005,DISPATCH_TOO_FREQUENTLY:10006,DISPATCH_EMPTY_GEOFENCING:10007,ACCESSHUB_INVALID_FRAME:2e4,ACCESSHUB_NEED_ENCRYPT:20001,ACCESSHUB_DECRYPT:20002,ACCESSHUB_MSGTYPE:20003,ACCESSHUB_UNMARSHAL:20004,ACCESSHUB_TIMEOUT:20005,ACCESSHUB_CONNECT:20006,ACCESSHUB_BROKEN:20007,ACCESSHUB_INTERNAL_ERROR:20008,ACCESSHUB_MARSHAL:20009,ACCESSHUB_UNSUPPORTED_SERVICE:20010,ACCESSHUB_TOO_FREQUENTLY:20011,ACCESSHUB_INVALID_APPID:20012,ACCESSHUB_HB_TIMEOUT:20013,ACCESSHUB_INVALID_SIGNATURE:20014,ACCESSHUB_AUTH_FAILED:20015,ACCESSHUB_UNSUPPORTED_INTERFACE:20016,ACCESSHUB_EMPTY_GEOFENCING:20017,ACCESSHUB_ACCESS_DENIED:20018,ACCESSHUB_SPECIAL_CUSTOMER:20019,ACCESSHUB_GET_STREAM_FAILED:3e4,ACCESSHUB_GET_CONN_FAILED:30001,ACCESSHUB_DO_HTTP_REQUEST_FAILED:30002,ACCESSHUB_UNMARSHAL_HB_FAILED:30003,ACCESSHUB_DO_BACKEND_DISPATCH_FAILED:30004}},GeoFencing:{$e:{CN:2,NA:3,EU:4,AS:5,IN:6,NCN:7}},GeoFencingType:{$e:{NONE:0,UNION:1,EXCLUDE:2}},GetAppConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","PB.proto_accesshub.Mode",0],5:["id_name","string",""],6:["config_key","string",""],7:["ts","uint64",{low:0,high:0,unsigned:!0}],8:["signature","bytes",[]],9:["lite_sign","string",""],10:["token","string",""],11:["sdk_type","PB.proto_accesshub.SdkType",0],12:["zegoconn_version","uint32",0],13:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],14:["device_id","string",""],15:["etag","uint32",0],16:["is_special_customer","uint32",0]}},GetAppConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","PB.proto_accesshub.GetAppConfigResponseData",null]}},GetAppConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["data","bytes",[]],3:["ts","uint64",{low:0,high:0,unsigned:!0}],4:["etag","uint32",0]}},GetConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["zegoconn_version","uint32",0],8:["sdk_type","PB.proto_accesshub.SdkType",0],9:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],10:["device_id","string",""],11:["mode_no","PB.proto_accesshub.Mode",0],12:["geofencing_type","uint32",0],13:["geofencings","[uint32",null]}},GetConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","PB.proto_accesshub.GetConfigResponseData",null]}},GetConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["quic_hb_interval","uint32",0],3:["quic_hb_timeout","uint32",0],4:["logic_hb_interval","uint32",0],5:["logic_hb_timeout","uint32",0],6:["pc_establish_timeout","uint32",0],7:["sdk_link_detect_interval","uint32",0],8:["sdk_link_detect_duration","uint32",0],9:["client_outer_ip","string",""],10:["ntp_time","uint64",{low:0,high:0,unsigned:!0}],11:["root_rsa_certs_ver","uint32",0],12:["geofencing_id","uint32",0],13:["svraddr_ver","uint32",0],14:["root_ecc_certs_ver","uint32",0]}},HBRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}]}},HBResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}],3:["ntp_time","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["stick","string",""],8:["service","string",""],9:["location","string",""],10:["method","string",""],11:["headers","<PB.proto_accesshub.HTTPRequest.HTTPHeader",null],12:["body","bytes",[]],13:["ack","bool",!1],14:["mode_no","PB.proto_accesshub.Mode",0],15:["service_no","PB.proto_accesshub.Service",0],16:["method_no","PB.proto_accesshub.Method",0],17:["sdk_type","PB.proto_accesshub.SdkType",0],18:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],19:["zegoconn_version","uint32",0],20:["device_id","string",""],21:["reduce_resp_header","uint32",0]},HTTPHeader:{$m:{1:["name","string",""],2:["val","string",""]}}},HTTPRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","PB.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","PB.proto_accesshub.SdkType",0],7:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["headers","<PB.proto_accesshub.HTTPRequest.HTTPHeader",null],10:["method","PB.proto_accesshub.Method",0],11:["interface_id","uint32",0],12:["res_id","string",""],13:["params","string",""],14:["body","bytes",[]],15:["ack","bool",!1],16:["device_id","string",""],17:["ts","uint64",{low:0,high:0,unsigned:!0}],18:["signature","bytes",[]],19:["token","string",""],20:["lite_sign","string",""],21:["reduce_resp_header","uint32",0]}},HTTPRequestAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequestDroped:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["reason","int32",0],3:["msg","string",""]}},HTTPResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["headers","<PB.proto_accesshub.HTTPRequest.HTTPHeader",null],3:["status_code","int32",0],4:["body","bytes",[]]}},IPAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","PB.proto_accesshub.IPV6Addr",null]}},IPV6Addr:{$m:{1:["high","fixed64",{low:0,high:0,unsigned:!1}],2:["low","fixed64",{low:0,high:0,unsigned:!1}]}},MessageType:{$e:{MSG_TYPE_EMPTY:0,MSG_TYPE_CONNECTION_CLOSED:1,MSG_TYPE_STREAM_CLOSED:2,MSG_TYPE_CLOSE_CONNECTION:3,MSG_TYPE_HTTP_REQUEST:4,MSG_TYPE_HTTP_RESPONSE:5,MSG_TYPE_HTTP_REQUEST_DROPED:6,MSG_TYPE_PROXY_CONNECT:7,MSG_TYPE_PROXY_CONNECTED:8,MSG_TYPE_PROXY_CONNECTION_CLOSED:9,MSG_TYPE_PROXY_SEND_DATA:10,MSG_TYPE_PROXY_RECV_DATA:11,MSG_TYPE_HB_REQUEST:12,MSG_TYPE_HB_RESPONSE:13,MSG_TYPE_GET_CONFIG_REQUEST:14,MSG_TYPE_GET_CONFIG_RESPONSE:15,MSG_TYPE_HTTP_REQUEST_ACK:16,MSG_TYPE_PC_UPWARD_MESSAGE:17,MSG_TYPE_PC_UPWARD_MESSAGE_ACK:18,MSG_TYPE_PC_ESTABLISHED:19,MSG_TYPE_PC_BROKEN:20,MSG_TYPE_PC_DOWNWARD_MESSAGE:21,MSG_TYPE_REDIRECT:22,MSG_TYPE_GET_APPCONFIG_REQUEST:23,MSG_TYPE_GET_APPCONFIG_RESPONSE:24,MSG_TYPE_PUSH_APPCONFIG:25,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST:26,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE:27,MSG_TYPE_GET_IM_CONFIG_REQUEST:28,MSG_TYPE_GET_IM_CONFIG_RESPONSE:29,MSG_TYPE_PUSH_EXCEPTION:30,MSG_TYPE_RESOLVE_DOMAIN_REQUEST:31,MSG_TYPE_RESOLVE_DOMAIN_RESPONSE:32,MSG_TYPE_HTTP_REQUEST2:33,MSG_TYPE_REDIRECT2:34,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2:35,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2:36,MSG_TYPE_GET_ROOTCERTS_REQUEST:37,MSG_TYPE_GET_ROOTCERTS_RESPONSE:38,MSG_TYPE_GET_SVRADDR_REQUEST:39,MSG_TYPE_GET_SVRADDR_RESPONSE:40,MSG_TYPE_UA_DISPATCH_REQUEST:50,MSG_TYPE_UA_DISPATCH_RESPONSE:51,MSG_TYPE_UA_ECHO_REQUEST:52,MSG_TYPE_UA_ECHO_RESPONSE:53,MSG_TYPE_NODE_REGISTER_REQUEST:100,MSG_TYPE_NODE_REGISTER_RESPONSE:101,MSG_TYPE_NODE_HB_REQUEST:102,MSG_TYPE_NODE_HB_RESPONSE:103}},Method:{$e:{METHOD_UNSET:0,METHOD_GET:1,METHOD_POST:2,METHOD_PUT:3,METHOD_PATCH:4,METHOD_DELETE:5,METHOD_HEAD:6,METHOD_OPTIONS:7}},Mode:{$e:{Mode_UNSET:0,MODE_ONLINE:1,MODE_TEST:2,MODE_ALPHA:3}},PCBroken:{$m:{}},PCDownwardMessage:{$m:{1:["payload","bytes",[]],2:["wss_message_type","uint32",0],3:["ts","uint64",{low:0,high:0,unsigned:!0}]}},PCEstablished:{$m:{1:["elapse","uint32",0],2:["from","uint32",0]}},PCUpwardMessage:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","PB.proto_accesshub.Mode",0],5:["id_name","string",""],6:["service_no","PB.proto_accesshub.Service",0],7:["ack","bool",!1],8:["payload","bytes",[]],9:["sdk_type","PB.proto_accesshub.SdkType",0],10:["wss_message_type","uint32",0],11:["wss_path","string",""],12:["wss_raw_query","string",""],13:["zegoconn_version","uint32",0],14:["zegoconn_run_env","PB.proto_accesshub.ZegoconnRunEnv",0],15:["backend_conn_type","PB.proto_accesshub.BackendConnType",0],16:["device_id","string",""],17:["geofencing_type","uint32",0],18:["geofencings","[uint32",null],19:["addr_type","uint32",0]}},PCUpwardMessageAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},ProxyConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""],3:["connected","int32",0]}},PushAppConfig:{$m:{1:["config_key","string",""],2:["data","bytes",[]]}},PushException:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["txid","uint64",{low:0,high:0,unsigned:!0}]}},Redirect2:{$m:{1:["rand","string",""],2:["secret","string",""],3:["groups","<PB.proto_accesshub.AccesshubDispatchGroup2",null],4:["wss_groups","<PB.proto_accesshub.WssAccesshubDispatchGroup",null],5:["ttl","uint32",0]}},SdkType:{$e:{SDK_TYPE_UNSET:0,SDK_TYPE_NATIVE:1,SDK_TYPE_WSS_WEB:3}},Service:{$e:{SERVICE_UNSET:0,SERVICE_MEDIAGW:1,SERVICE_LIVEROOM:2,SERVICE_MIX:3,SERVICE_ZEUS:4,SERVICE_ZPUSH:5,SERVICE_L3:6,SERVICE_TALKLINE:7,SERVICE_EDUSUITE:8,SERVICE_ZIM:9,SERVICE_ClOUD_SETTING:10,SERVICE_ZEUSHB:11,SERVICE_USER_LOGIC:12,SERVICE_UNIFYDISPATCH:13,SERVICE_QUALITY:14,SERVICE_SECURITY:15,SERVICE_KTVCPR:16,SERVICE_SWITCH4LIVEROOM:17,SERVICE_WEBRTC_SIGNAL:18,SERVICE_L3_WEBRTC_SIGNAL:19,SERVICE_VIDEOCPR:20,SERVICE_CDN:21,SERVICE_CLOUDRECORD:22,SERVICE_INNER_ECHO:23,SERVICE_OUTER_ECHO:24,SERVICE_LOCALHOST_ECHO:25,SERVICE_ECHO:26,SERVICE_DOCSERVICE:27,SERVICE_AUTHSVR:28,SERVICE_WEBLIVEROOM:29,SERVICE_WHITEBOARD:30,SERVICE_METAWORLD:31,SERVICE_ZEGOLAND:32}},StreamClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},WssAccesshubDispatchGroup:{$m:{1:["group","string",""],2:["host","string",""],3:["main_domain","string",""]}},ZegoconnRunEnv:{$e:{ZEGOCONN_RUN_ENV_UNSET:0,ZEGOCONN_RUN_ENV_BROWSER:1,ZEGOCONN_RUN_ENV_APPLET:2}}},proto_initconfig:{AppConfig:{$m:{1:["test_id","int32",0],2:["domain","string",""],3:["flexible_domain","string",""],4:["replace_flexible_domain","string",""]}},InitConfig:{$m:{1:["app_config","PB.proto_initconfig.AppConfig",null],4:["speedlog_config","PB.proto_initconfig.SpeedlogConfig",null],5:["media_config","PB.proto_initconfig.MediaConfig",null]}},MediaConfig:{$m:{1:["play_config","PB.proto_initconfig.MediaPlayConfig",null],2:["publish_config","PB.proto_initconfig.MediaPublishConfig",null]}},MediaPlayConfig:{$m:{5:["resource_info","<PB.proto_initconfig.MediaResourceInfo",null]}},MediaPublishConfig:{$m:{2:["resource_info","<PB.proto_initconfig.MediaResourceInfo",null],5:["enable_subject_segmentation","int32",0],6:["object_segmentation_platform","int32",0]}},MediaResourceInfo:{$m:{1:["resource_type","PB.proto_initconfig.ResourceType",0],2:["service_info","<PB.proto_initconfig.MediaServiceProtocolInfo",null]}},MediaServiceProtocolInfo:{$m:{1:["config_id","string",""],2:["protocol","PB.proto_initconfig.ProtocolType",0],3:["url_template","string",""],4:["resolve_type","PB.proto_initconfig.ResolveType",0],5:["push_cdn_authentication","int32",0],6:["cdn_quic_version","<int32",null]}},ProtocolType:{$e:{UDP:0,RTMP:1,FLV:2,HLS:3,WEBRTC:4}},ResolveType:{$e:{LOCAL_DNS:0,DISPATCH:1}},ResourceType:{$e:{CDN:0,RTC:1,L3:2,CDN_PLUS:3,CDN_PLUS_BACKUP:4}},SpeedlogConfig:{$m:{1:["report_count","int32",0],2:["report_retry_interval","int32",0],3:["push_quality_sample_count","int32",0],4:["pull_quality_sample_count","int32",0],5:["hardware_report_cycle","int32",0],6:["room_user_max_count","int32",0],7:["room_stream_max_count","int32",0],8:["charge_info_report_cycle","int32",0],9:["charge_info_report_mode","int32",0],10:["disable_report_pull","<PB.proto_initconfig.ResourceType",null],11:["report_max_bytes","int32",0],12:["push_quality_report_freq","int32",0],13:["pull_quality_report_freq","int32",0],14:["charge_info_report_no_playing","int32",0]}}}}},"",E,!1),S.util.global.PB=E.PB;var O=E.PB,N=function(){return(N=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};t.util.Long=y.a,t.configure(),B.prototype.encodeRequest=function(e,t,n){var r=(i=this.protoMap[e])[0],i=i[1];i=(r=this.encode(this.protoInstance[r][i],t)).length;return(t=new Uint8Array(13+i))[0]=175,t[1]=0,t[2]=e>>8,t[3]=e-(t[2]<<8),t.set(new Uint8Array(Int32Array.from([i]).buffer).reverse(),4),t.set(new Uint8Array(Int32Array.from([n]).buffer).reverse(),8),t[12]=0,t.set(r,13),t},B.prototype.decodeResponse=function(e){var t=(e[2]<<8)+e[3],n=new DataView(e.buffer).getUint32(8),r=e.slice(13);try{var i=this.protoMap[t],o=i[0],s=i[1];return[n,t,this.decode(this.protoInstance[o][s],r)]}catch(e){return[n,t,{code:1}]}},B.prototype.decodeConfigMessage=function(e){return this.decode(this.protoInstance.proto_initconfig.InitConfig,e)},B.prototype.encode=function(e,t){return e.encode(new e(t)).finish()},B.prototype.decode=function(e,t){return N({},e.decode(t))};var A,L=B,P=(Object.defineProperty(U.prototype,"id",{get:function(){return this._id||null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),U.prototype.hasNext=function(){return this.next&&this.next.id},U.prototype.hasPrev=function(){return this.prev&&this.prev.id},U),M=(x.prototype.insertBefore=function(e,t){return(t=new P(this._idCounter,t)).next=e,t.prev=e.prev,e.prev&&(e.prev.next=t),e.prev=t,++this._idCounter,++this._numNodes,t},x.prototype.addLast=function(e){return this.insertBefore(this.end,e)},x.prototype.add=function(e){return this.addLast(e)},x.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},x.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},x.prototype.size=function(){return this._numNodes},x.prototype.getFromFirst=function(e){var t=0,n=this.start.next;if(0<=e)for(;t<e&&null!==n;)n=n.next,++t;else n=null;if(null===n)throw"Index out of bounds.";return n},x.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},x.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},x.prototype.removeFirst=function(){var e=null;return 0<this._numNodes&&this.start.next?this.remove(this.start.next):e},x.prototype.removeLast=function(){var e=null;return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):e},x.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},x.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},x.prototype.find=function(e){for(var t=this.start,n=!1,r=null;t.hasNext()&&!n;)e(t=t.next)&&(r=t,n=!0);return r},x.prototype.map=function(e){for(var t=this.start,n=[];t.hasNext();)e(t=t.next)&&n.push(t);return n},x.prototype.push=function(e){return this.addLast(e)},x.prototype.unshift=function(e){0<this._numNodes?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},x.prototype.pop=function(){return this.removeLast()},x.prototype.shift=function(){return this.removeFirst()},x);D.prototype.createSocket=function(e){},D.prototype.setState=function(e){},D.prototype.initEvent=function(e,t,n,r){},D.prototype.sendMessage=function(e,t,n,r,i,o,s,a){void 0===r&&(r=!0),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null)},v=D;function D(){this.txid=0,this.linkRetryTime=60,this.updatedMsgTime=0,this.connectServer=""}function x(){this.start=new P,this.end=new P,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}function U(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}function B(){var e;this.protoInstance=O,this.protoMap=((e={})[i.MSG_TYPE_STREAM_CLOSED]=["proto_accesshub","ConnectionClosed"],e[i.MSG_TYPE_CLOSE_CONNECTION]=["proto_accesshub","CloseConnection"],e[i.MSG_TYPE_HTTP_REQUEST]=["proto_accesshub","HTTPRequest"],e[i.MSG_TYPE_HTTP_RESPONSE]=["proto_accesshub","HTTPResponse"],e[i.MSG_TYPE_HTTP_REQUEST2]=["proto_accesshub","HTTPRequest2"],e[i.MSG_TYPE_HB_REQUEST]=["proto_accesshub","HBRequest"],e[i.MSG_TYPE_HB_RESPONSE]=["proto_accesshub","HBResponse"],e[i.MSG_TYPE_GET_CONFIG_REQUEST]=["proto_accesshub","GetConfigRequest"],e[i.MSG_TYPE_GET_CONFIG_RESPONSE]=["proto_accesshub","GetConfigResponse"],e[i.MSG_TYPE_GET_SVRADDR_REQUEST]=["proto_accesshub","GetSvraddrRequest"],e[i.MSG_TYPE_GET_SVRADDR_RESPONSE]=["proto_accesshub","GetSvraddrResponse"],e[i.MSG_TYPE_HTTP_REQUEST_ACK]=["proto_accesshub","HTTPRequestAck"],e[i.MSG_TYPE_PC_UPWARD_MESSAGE]=["proto_accesshub","PCUpwardMessage"],e[i.MSG_TYPE_PC_UPWARD_MESSAGE_ACK]=["proto_accesshub","PCUpwardMessageAck"],e[i.MSG_TYPE_PC_ESTABLISHED]=["proto_accesshub","PCEstablished"],e[i.MSG_TYPE_PC_BROKEN]=["proto_accesshub","PCBroken"],e[i.MSG_TYPE_PC_DOWNWARD_MESSAGE]=["proto_accesshub","PCDownwardMessage"],e[i.MSG_TYPE_REDIRECT]=["proto_accesshub","Redirect"],e[i.MSG_TYPE_REDIRECT2]=["proto_accesshub","Redirect2"],e[i.MSG_TYPE_GET_APPCONFIG_REQUEST]=["proto_accesshub","GetAppConfigRequest"],e[i.MSG_TYPE_GET_APPCONFIG_RESPONSE]=["proto_accesshub","GetAppConfigResponse"],e[i.MSG_TYPE_PUSH_APPCONFIG]=["proto_accesshub","PushAppConfig"],e[i.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST]=["proto_accesshub","AccesshubDispatchRequest"],e[i.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE]=["proto_accesshub","AccesshubDispatchResponse"],e[i.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2]=["proto_accesshub","AccesshubDispatchRequest2"],e[i.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2]=["proto_accesshub","AccesshubDispatchResponse2"],e[i.MSG_TYPE_PUSH_EXCEPTION]=["proto_accesshub","PushException"],e)}(n=A=A||{})[n.BROWSER=0]="BROWSER",n[n.WEIXINMINI=1]="WEIXINMINI",z.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){"function"==typeof e.onmessage&&e.onmessage(t)})))})),this._websocket.onError((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onerror&&e.onerror(t)})))},z.prototype.onopen=function(e){},z.prototype.onerror=function(e){},z.prototype.onclose=function(e){},z.prototype.onmessage=function(e){},z.prototype.send=function(e){e instanceof Uint8Array&&(e=new Uint8Array(e).buffer),this._websocket&&this._websocket.send({data:e})},z.prototype.close=function(){this._websocket&&this._websocket.close()};var H=z;function z(e,t){this.url=e,this.readyState=3,this._websocket=wx.connectSocket({url:e}),this.init()}function G(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function F(e){var t=unescape||window.unescape;return Uint8Array.from(Array.from(t(encodeURIComponent(e))).map((function(e){return e.charCodeAt(0)})))}function q(e){var t=escape||window.escape;return decodeURIComponent(t(String.fromCharCode.apply(String,Array.from(e))))}function j(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Be.prototype.createSocket=function(e){this.socket=new(this.ENV%2%2===A.BROWSER?WebSocket:H)(e)},Be.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(n){t.socket.binaryType="arraybuffer",t.responseHandler(),e(n)})},Be.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){t="string"==typeof t.data?JSON.parse(t.data):t.data,e.onMessage(t)})},Be.prototype.onMessage=function(e){},Be.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},Be.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},Be.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},Be.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},Be.prototype.sendMessage=function(e){this.isDisConnect()||this.socket&&this.socket.send(e)};var V,Y=Be,W={TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},NET_CONNECT_TIMEOUT:{code:1100006,msg:"net connect timeout"}},Z="zn.zca.gc",K="zn.zca.gac",$="zn.zca.rd",X="zn.nab.du",Q="zn.nab.gac",J="zn.nhb.s",ee="zn.rlh.at",te="zn.rlh.sm",ne="zn.wl.cs.0",re="zn.wl.bse",ie="zn.napr.sr",oe="zn.napr.ope",se="zn.nahr.sr",ae="zn.nahr.sr2",ue={domains:["accesshub-wss.zego.im"],mode:"online",modeNo:a.MODE_ONLINE,sdkType:3,connectVer:30,pcEstablishTimeout:15,scheme:"wss",location:"accesshub",wssMessageType:1},ce=(V=function(e,t){return(V=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},function(){return(ce=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}),le=function(e){function t(t,n,r,o,s){var a=e.call(this)||this;return a.appID=t,a.env=n,a.protobuf=r,a.logger=o,a.stateCenter=s,a.socketService=new Y(a.env),a.urlIndex=0,a.updatedMsgTime=0,a.unUpdateMsgTimeTypes=[i.MSG_TYPE_HB_REQUEST,i.MSG_TYPE_HB_RESPONSE,i.MSG_TYPE_GET_CONFIG_REQUEST,i.MSG_TYPE_GET_CONFIG_RESPONSE,i.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,i.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2],a.netLinkState=0,a.sendCommandList=new M,a.unSendCommandList=new M,a.sendCommandMap={},a.unSendCommandMap={},a.sendDataCheckOnceCount=100,a.sendDataDropTimeout=1e4,a.sendDataCheckInterval=2e3,a.timeout=5e3,a.connectInterval=1e4,a.connectTimer=null,a.connectRsp={},a.unlogTypes=[12,13],a.tryServers=[],a.tryConnectEvents=[],a.connectStartTime=0,a.updatedMsgTime=Date.now(),a}var n=t,r=e;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=n}return V(n,r),n.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o),t.prototype.initEvent=function(e,t,n,r){this.onConnectedEvent=e,this.onDisConnectedEvent=t,this.onConnectingEvent=n,this.onPushEvent=r},t.prototype.createSocket=function(e){this.servers=e,this.urlIndex=0},t.prototype.destroySocket=function(e){this.logger.info("zn.wl.ds.0 call "+e),this.socketService.closeSocket(),this.netLinkState=0,e!==c.NONE&&this.onDisConnectedEvent&&this.onDisConnectedEvent(e===c.BROKEN),this.resetConnect()},t.prototype.refreshServers=function(e){this.servers=G(G([],e,!0),this.servers,!0)},t.prototype.connectSocket=function(e,t,n){var r=this,i=(void 0===e&&(e=!0),this.logger.info(ne+" call"),this.connectRsp.suc=t,!1),o=(this.connectRsp.fail=function(){n&&(i?r.logger.info(ne+" fail cb has exec"):(n(),i=!0))},e&&(this.urlIndex=(this.urlIndex+1)%this.servers.length),this.servers[this.urlIndex]);return this.connectServer=o,this.logger.info(ne+" server "+o),this.tryServers.push(o),this.connectStartTime=Date.now(),this.closeSocket(),this.netLinkState=1,this.socketService.createSocket(o),this.onConnectingEvent&&this.onConnectingEvent(!0),this.bindSocketEvent(),this.connectTimer=setTimeout((function(){r.logger.info(ne+" timeout"),r.connectEvent(o,W.NET_CONNECT_TIMEOUT.code),r.connectRsp.fail&&r.connectRsp.fail()}),this.connectInterval),!0},t.prototype.bindSocketEvent=function(){var e=this;this.openHandler((function(){e.logger.info(re+" open"),e.resetConnect(),e.connectRsp.suc&&e.connectRsp.suc(),e.netLinkState=2,e.connectEvent(e.connectServer,0),e.onConnectedEvent&&e.onConnectedEvent(e.tryServers,e.tryConnectEvents),e.tryConnectEvents=[],e.checkUnSendMsgs(e.unSendCommandList),e.startCheck()})),this.closeHandler((function(t){e.logger.warn(re+" close "+JSON.stringify(t.code||t)),e.resetConnect(),e.connectRsp.fail&&e.connectRsp.fail(),e.connectEvent(e.connectServer,(null==t?void 0:t.code)||W.NET_CONNECT_TIMEOUT.code),e.onDisConnectedEvent&&e.onDisConnectedEvent(!0),e.netLinkState=0})),this.errorHandler((function(t){e.logger.warn(re+" error "+JSON.stringify(t.code||t)),e.resetConnect(),e.connectRsp.fail&&e.connectRsp.fail(),e.connectEvent(e.connectServer,(null==t?void 0:t.code)||W.NET_CONNECT_TIMEOUT.code),e.onDisConnectedEvent&&e.onDisConnectedEvent(!0),e.netLinkState=0})),this.onMessage()},t.prototype.closeSocket=function(){this.logger.info("zn.wl.cs.1 call"),this.socketService.closeSocket(),this.netLinkState=0},t.prototype.connectEvent=function(e,t){var n;this.connectStartTime&&(n=Date.now()-this.connectStartTime,this.tryConnectEvents.push({url:e,time_consumed:n,connect_type:3,error:t}))},t.prototype.resetConnect=function(){this.connectTimer&&(clearTimeout(this.connectTimer),this.connectTimer=null),this.stopCheck()},t.prototype.isConnect=function(){return 2===this.netLinkState},t.prototype.isDisConnect=function(){return!this.socketService||this.socketService.isDisConnect()},t.prototype.isConnecting=function(){return 1===this.netLinkState},t.prototype.setState=function(e){this.netLinkState=e},t.prototype.closeHandler=function(e){this.socketService.closeHandler(e)},t.prototype.openHandler=function(e){this.socketService.openHandler(e)},t.prototype.errorHandler=function(e){this.socketService.errorHandler(e)},t.prototype.sendMessage=function(e,t,n,r,o,a,u,c){void 0===r&&(r=!0),void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===(c=void 0===c?{}:c).timeout&&(c.timeout=5e3),void 0===c.isInSendMap&&(c.isInSendMap=!0),void 0===c.isMsgCache&&(c.isMsgCache=!0),this.txid++;var l={appid:this.appID,biz_type:0,mode_no:(null==(l=this.stateCenter.appInfo)?void 0:l.mode)||ue.modeNo,id_name:this.stateCenter.userId,sdk_type:ue.sdkType,zegoconn_run_env:0===this.env?s.ZEGOCONN_RUN_ENV_BROWSER:s.ZEGOCONN_RUN_ENV_APPLET,zegoconn_version:(null==(l=this.stateCenter.appInfo)?void 0:l.connVer)||ue.connectVer};null!=(h=this.stateCenter.appInfo)&&h.deviceID&&(l.device_id=null==(h=this.stateCenter.appInfo)?void 0:h.deviceID);var h=ce(ce({txid:this.txid},r?l:{}),n);r={data:h,txid:this.txid,sendTime:Date.now(),streamID:t,type:e,timeOut:c.timeout||this.timeout,ack:n.ack,success:o,error:a,ackFunc:u,isSend:!0,isCheck:e!==i.MSG_TYPE_PC_UPWARD_MESSAGE,extras:c.extras};c.isInSendMap&&(l=this.sendCommandList.push(r),this.sendCommandMap[this.txid]=l),10!==h.service&&14!==h.interface_id&&this.unUpdateMsgTimeTypes.includes(e)||(this.updatedMsgTime=Date.now()),-1===this.unlogTypes.indexOf(e)&&this.logger.info("zn.wl.sm type: "+e+"-"+m[e]+" streamID: "+t+" txid: "+this.txid),this.isConnect()?this.sendUint8Data(e,h,t,c.extras):c.isMsgCache&&(r.isSend=!1,n=this.unSendCommandList.push(r),this.unSendCommandMap[this.txid]=n)},t.prototype.checkUnSendMsgs=function(e){for(var t,n=e.getFirst();null!=n;)e.remove(n),n._data&&!1===(null==(t=n._data)?void 0:t.isSend)&&n._data.type&&n._data.streamID&&n._data.data&&(this.sendUint8Data(n._data.type,n._data.data,n._data.streamID),n._data.isSend=!0),n=e.getFirst()},t.prototype.Uint8ToArrayBuffer=function(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)},t.prototype.sendUint8Data=function(e,t,n,r){e=this.protobuf.encodeRequest(e,t,n),this.socketService.sendMessage(this.Uint8ToArrayBuffer(e))},t.prototype.onMessage=function(){var e=this;this.socketService.onMessage=function(t){t=new Uint8Array(t);var n,r,i=(r=e.protobuf.decodeResponse(t))[0],o=r[1],s=((r=r[2]).txid&&y.a.isLong(r.txid)&&r.txid.toNumber&&(r.txid=r.txid.toNumber()),e.unUpdateMsgTimeTypes.includes(o)||(e.updatedMsgTime=Date.now()),(null==r?void 0:r.txid)||(null==(s=null==r?void 0:r.data)?void 0:s.txid));-1===e.unlogTypes.indexOf(o)&&(n=s?", txid: ".concat(s):"",e.logger.info("zn.wl.om"+" streamID: ".concat(i,", msgType: ").concat(o,"-").concat(m[o])+n)),s&&e.isRspMsg(s)?e.handleSendCommandMsgRsp(i,o,s,r,{size:t.length}):e.onPushEvent(i,o,r,{size:t.length})}},t.prototype.isRspMsg=function(e){return void 0!==this.sendCommandMap[e]},t.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},t.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},t.prototype.checkMessageListTimeout=function(e,t){for(var n,r=e.getFirst(),i=Date.now(),o=0,s=this;null!=r&&"break"!==function(){var a,u,c;return r._data&&r._data.sendTime+r._data.timeOut>i||(r._data&&delete t[r._data.data.txid],e.remove(r),r._data&&null==r._data.error||r._data&&r._data.sendTime+s.sendDataDropTimeout<i||(a=r&&r._data&&r._data.error,u=r&&r._data&&r._data.txid,c=r&&r._data&&(null==(n=r._data)?void 0:n.isCheck),setTimeout((function(){c&&a&&a({},u,W.TIMEOUT)}),0)),++o>=s.sendDataCheckOnceCount)?"break":void(r=e.getFirst())}(););},t.prototype.checkSendMessageList=function(e){for(var t,n=e.getFirst();null!=n&&n._data;)!function(){var r,i,o;e.remove(n),n._data.isSend&&n._data.error&&(r=n&&n._data&&n._data.error,i=n&&n._data&&n._data.txid,o=n&&n._data&&(null==(t=n._data)?void 0:t.isCheck),setTimeout((function(){o&&r&&r({},i,W.TIMEOUT)}),0)),n=e.getFirst()}()},t.prototype.handleSendCommandMsgRsp=function(e,t,n,r,o){var s,a=this.sendCommandMap[n];null!=a&&(null!=(s=a._data)&&s.ack||(delete this.sendCommandMap[n],this.sendCommandList.remove(a)),r.code&&0!==r.code?s&&null!=s.error&&s.error(r,n):t===i.MSG_TYPE_PUSH_EXCEPTION?(r.code=r.reason,r.message=r.msg,delete r.reason,delete r.msg,s&&null!=s.error&&s.error(r,n)):t===i.MSG_TYPE_HTTP_REQUEST_ACK?s&&null!=s.ackFunc&&s.ackFunc(r,n):s&&null!=s.success&&s.success(r,n,o))},t}(v),he=(Ue.prototype.getConfig=function(e,t){var n;this.logger.info("zn.nab.gc call"),this.streamManager.createStream(u.OTHER).sendMessage(i.MSG_TYPE_GET_CONFIG_REQUEST,{geofencing_type:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.type,geofencings:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.list},e,t)},Ue.prototype.dispatchURL=function(e,t){var n,r=this;this.logger.info(X+" call"),this.streamManager.createStream(u.OTHER).sendMessage(i.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,{geofencing_type:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.type,geofencings:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.list},(function(t){r.logger.info(X+" suc "),e&&e(t)}),(function(e,n,i){r.logger.info(X+" fail"),t&&t(i||e)}))},Ue.prototype.getAppConfig=function(e,t,n,r,o){var s=this;return new Promise((function(a,c){function l(e,t,n){n?(s.logger.error(Q+" fail "+JSON.stringify(n)),c(n)):0===e.code?(s.logger.info(Q+" suc"),n=s.decodeConfigMessage(e.data.data),a({code:0,data:n,etag:e.data.etag})):(s.logger.error(Q+" fail "+e.code),c({code:e.code}))}s.logger.info(Q+" call");var h={id_name:t,config_key:e,token:n,mode_no:(null==(h=s.stateCenter.appInfo)?void 0:h.mode)||ue.modeNo,etag:o};s.streamManager.createStream(u.OTHER).sendMessage(i.MSG_TYPE_GET_APPCONFIG_REQUEST,h,l,l,null,{timeout:r})}))},Ue.prototype.decodeConfigMessage=function(e){return this.protobuf.decodeConfigMessage(e)},Ue),de=(xe.prototype.init=function(e){var t=this;this.logger.info("zn.nhb.ii call"),this.hbStream||(this.hbStream=this.streamManager.createStream(u.OTHER)),1<=e.data.logic_hb_interval&&e.data.logic_hb_interval<=10&&(this.hbInterval=e.data.logic_hb_interval),3<=e.data.logic_hb_timeout&&e.data.logic_hb_timeout<=30&&(this.hbTimeout=e.data.logic_hb_timeout),this.tryHbCount=0,this.hbTimeoutMaxCount=this.hbTimeout/this.hbInterval,this.hbTimer&&clearTimeout(this.hbTimer),this.hbTimer=setTimeout((function(){t.start()}),1e3*this.hbInterval)},xe.prototype.start=function(){var e,t,n,r=this;this.logger.debug(J+" call "),this.tryHbCount++>this.hbTimeoutMaxCount?(this.logger.error(J+" come to try limit"),this.reset(),this.netHbLogout(W.NET_HB_TIMEOUT)):(e=(new Date).getTime(),t=function(t,n,i){var o=(new Date).getTime()-e;r.logger.debug(J+" hb callback "+o),i&&0!==(null==i?void 0:i.code)?r.logger.info(J+" fail "+JSON.stringify(i)):(null!=t&&t.ntp_time&&(i="number"==typeof(o=t.ntp_time)?o:o.toNumber(),t=(new Date).getTime(),r.stateCenter.updateNTP(e,i,t)),r.tryHbCount=0)},n={ts:Date.now()},this.hbStream.sendMessage(i.MSG_TYPE_HB_REQUEST,n,t,t,null),this.hbStream.isFirst=!1,this.hbTimer&&clearTimeout(this.hbTimer),this.hbTimer=setTimeout((function(){r.start()}),1e3*this.hbInterval))},xe.prototype.netHbLogout=function(e){},xe.prototype.reset=function(){this.hbTimer&&(clearTimeout(this.hbTimer),this.hbTimer=null),this.tryHbCount=0},xe),fe=(De.prototype.addEventHandler=function(e,t){if(this.handlerListMap[e]||(this.handlerListMap[e]=[]),"function"!=typeof t)throw new Error("Params callBack is not a Function");return this.handlerListMap[e]&&-1==this.handlerListMap[e].indexOf(t)&&this.handlerListMap[e].push(t),!0},De.prototype.removeEventHandler=function(e,t){return!!this.handlerListMap[e]&&(this.handlerListMap[e]=t?this.handlerListMap[e].filter((function(e){return e!==t})):[],!0)},De.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.handlerListMap[e]&&this.handlerListMap[e].forEach((function(n){try{n.apply(void 0,t)}catch(n){console.error('Fail to execute callback of event "'.concat(e,'" : ').concat(n))}}))},De),pe=function(){return(pe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ge=(Me.prototype.sendRequest=function(e,t,n,r){var o=this,s=e.payload,a=(null!=(a=this.option)&&a.encode&&(s=F(e.payload)),{service_no:this.service,ack:e.ack,payload:s,wss_message_type:null!=(s=null==(a=this.option)?void 0:a.messageType)?s:ue.wssMessageType,wss_path:null==(a=this.option)?void 0:a.path,wss_raw_query:null==(s=this.option)?void 0:s.query,zegoconn_version:ue.connectVer});this.netPcStream.isConnect()||(this.logger.info(ie+" pc is not connect"),this.eventManager.emit("connectStart")),this.netPcStream.sendMessage(i.MSG_TYPE_PC_UPWARD_MESSAGE,a,(function(){o.logger.info(ie+" suc"),n&&n()}),(function(e){o.logger.error(ie+" fail"),t&&t(e)}),null,{isInSendMap:"boolean"==typeof e.isInSendMap&&e.isInSendMap,extras:r,isMsgCache:null==(s=this.option)?void 0:s.isMsgCache})},Me.prototype.onPushEvent=function(e,t,n){var r;switch(this.logger.info(oe+" msgType: ".concat(e)),e){case i.MSG_TYPE_PC_ESTABLISHED:this.netPcStream.isFirst=!1,this.pcEstablished(t,this.netPcStream.StreamID);break;case i.MSG_TYPE_PC_BROKEN:this.pcBroken();break;case i.MSG_TYPE_PC_DOWNWARD_MESSAGE:this.logger.info(oe+" ".concat(this.service," down ").concat((null==t?void 0:t.ts)&&t.ts.toNumber&&t.ts.toNumber()||t.ts));var o=t.payload;null!=(r=this.option)&&r.encode&&(o=q(t.payload)),this.eventManager.emit("downLoadMessage",o,n);break;case i.MSG_TYPE_PUSH_EXCEPTION:this.logger.info(oe+" ".concat(this.service," exception ").concat(JSON.stringify(t))),this.eventManager.emit("exception",t,n)}},Me.prototype.on=function(e,t){return this.eventManager.addEventHandler(e,t)},Me.prototype.off=function(e,t){this.eventManager.removeEventHandler(e,t)},Me.prototype.pcEstablished=function(e,t){this.logger.info("zn.napr.pe call "+JSON.stringify(e)),this.setConnectState(l.CONNECTED);var n=p.MANUAL;this.lastConnectState===l.BROKEN&&this.connectState===l.CONNECTED&&(n=p.AUTO),this.eventManager.emit("connected",n),this.reportEvent("pcConnectedEvent",{proxy_link_sources:null==e?void 0:e.from,connect_stream:t}),this.brokenTimer&&clearTimeout(this.brokenTimer)},Me.prototype.pcBroken=function(){var e=this;this.logger.info("zn.napr.pb call"),this.setConnectState(l.BROKEN),this.eventManager.emit("broken"),this.reportEvent("pcBrokenEvent"),this.brokenTimer=setTimeout((function(){e.eventManager.emit("disconnected",f.TEMP),e.reportEvent("pcDisconnectedEvent")}),1e3*this.pcEstablishTimeout)},Me.prototype.resetBrokenTimer=function(){this.brokenTimer&&clearTimeout(this.brokenTimer)},Me.prototype._close=function(e,t){var n;this.logger.info("zn.napr.cr call "+this.service+" "+this.connectState),this.connectState!==l.DISCONNECT&&(this.netPcStream.closeStream(0,""),this.resetBrokenTimer(),n=this.streamManager.getStreamID(),this.netPcStream.refresh(n),this.eventManager.emit(e,t),n="","broken"===e?n="pcBrokenEvent":"disconnected"===e&&(n="pcDisconnectedEvent"),n)&&this.reportEvent(n),this.setConnectState(l.DISCONNECT)},Me.prototype.closePc=function(){this._close("broken")},Me.prototype.closeRequest=function(){this._close("disconnected",f.CLOSE)},Me.prototype.setConnectState=function(e){this.connectState!==e&&(this.lastConnectState=this.connectState,this.connectState=e)},Me.prototype.reportEvent=function(e,t){this.eventManager.emit(e,pe({service_no:this.service},t))},Me),_e=(Pe.prototype.getRequest=function(e,t){return e=new ge(this.logger,e,this.streamManager,this.pcEstablishTimeout,t),this.pcStreamRequests.push(e),e},Pe.prototype.updateConnectState=function(e,t,n){this.logger.info("zn.naprm.ucs call "+e+" "+t),this.pcStreamRequests.forEach((function(r){e===l.BROKEN?(r.eventManager.emit("broken"),r.reportEvent("pcBrokenEvent")):e===l.DISCONNECT&&(r.eventManager.emit("disconnected",t,n),r.reportEvent("pcDisconnectedEvent"))}))},Pe.prototype.closePCs=function(){this.pcStreamRequests.forEach((function(e){e.closePc()}))},Pe.prototype.setEstablishTimeout=function(e){this.pcEstablishTimeout=e},Pe),me=(Le.prototype.initLink=function(e){this.link=e},Le.prototype.startMaxTime=function(){var e=this;this.logger.info(te+" call"),this.maxTimer||(this.logger.info(te+" start max timer"),this.maxTimer=setTimeout((function(){e.logger.warn(te+" over max time ".concat(e.RETRY_MAX_TIME,"s, stop retry")),e.isOverTime=!0,e.link.destroySocket(c.NONE),e.stopMaxTime(),e.invalid(),e.onactive(!1,W.NET_SOCKET_TIMEOUT)}),1e3*this.RETRY_MAX_TIME))},Le.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},Le.prototype.active=function(e,t,n){var i=this;if(void 0===n&&(n=!1),this.logger.info(ee+" call "+e+" "+(t=void 0!==t&&t)),this.retryTimer)return this.logger.info(ee+" has actived, ignore"),!1;var o=this.stateCenter.networkState==r.offline;if(o){if(this.logger.info(ee+"  check if really offline. "+this.retryNetCount),this.retryNetCount>=this.retryNetMaxTimes)return this.logger.warn(ee+" network is broken, stop retry"),!1}else this.retryNetCount=0;return this.link.isConnecting()&&!n?(this.logger.info(ee+" link is connecting, ignore"),!1):this.isOverTime?(this.logger.info(ee+" retry over time, stop retry"),!1):(1==this.retryActiveCount?this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(n=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1)),this.retryActiveInterval=n>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:n),this.logger.info(ee+" interval "+this.retryActiveInterval),this.retryTimer=setTimeout((function(){i.link.destroySocket(c.BROKEN),i.link.connectSocket(e,(function(){i.logger.info(ee+" suc"),i.stateCenter.networkState=r.online,i.stopMaxTime(),i.invalid(),i.onactive(!0)}),(function(){i.logger.info(ee+" fail"),i.maxTimer||i.startMaxTime(),i.active(!0,!1,!0)})),i.retryTimer&&clearTimeout(i.retryTimer),i.retryTimer=null,o?i.retryNetCount++:i.retryActiveCount++}),t?0:1e3*this.retryActiveInterval),!0)},Le.prototype.onactive=function(){for(var e=0;e<arguments.length;e++);},Le.prototype.init=function(e,t,n,r){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof n&&(this.RETRY_CONTINUE_COUNT=n),"number"==typeof r&&(this.RETRY_MAX_TIME_INTERVAL=r)},Le.prototype.invalid=function(){this.logger.info("zn.rlh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryActiveCount=1,this.retryNetCount=0},Le),ve=(Ae.prototype.updateNTP=function(e,t,n){var r;n<e||(r=n-e,this.timeOffset=Math.round((t-e+(t-n))/2),e=Math.round(t+r/2),(!this.networkRTT||r<this.networkRTT)&&(this.networkRTT=r,this.ntpTimeInfo={performanceTime:Math.round(performance.now()),ntp:e}))},Ae),ye=(Ne.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join(" ");console.log(n)},Ne.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join(" ");console.debug(n)},Ne.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join(" ");console.info(n)},Ne.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join(" ");console.warn(n)},Ne.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join(" ");console.error(n)},Ne),Se=function(){return(Se=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ee=(Oe.prototype.sendRequest=function(e,t,n,r,o){var s=this,a=e.disableLog;e={service_no:this.service,ack:e.ack,headers:e.headers,body:F(JSON.stringify(e.body)),id_name:e.idName,method_no:e.method_no,stick:e.stick,location:e.location,reduce_resp_header:e.reduceRspHeaders?1:0};this.netHttpStream.sendMessage(i.MSG_TYPE_HTTP_REQUEST,e,(function(e){s.closeStream();var n=("gzip"===(null==(n=(null==e?void 0:e.headers).find((function(e){return"Content-Encoding"===(null==e?void 0:e.name)})))?void 0:n.val)?a||s.logger.info(se+" gzip"):e.body&&(n=q(e.body),e.body=n),Se(Se({},e),{body:void 0}));a||s.logger.info(se+" suc "+JSON.stringify(n)),t&&t(e)}),(function(e,t,r){s.closeStream(),a||s.logger.error(se+" fail"),n&&n(r||e)}),(function(e){a||s.logger.error(se+" ack"),r&&r(e)}),o),this.netHttpStream.isFirst=!1},Oe.prototype.sendRequest2=function(e,t,n,r,o){var s=this,a=1===e.format?F(JSON.stringify(e.body)):e.body;a={ack:e.ack,body:a,id_name:e.idName,method:e.method,interface_id:e.interfaceID,token:e.token,reduce_resp_header:e.reduceRspHeaders?1:0};e.headers&&(a.headers=e.headers),e.resID&&(a.res_id=e.resID),e.urlParams&&(a.params=e.urlParams),e.mode&&(a.mode=e.mode),this.netHttpStream.sendMessage(i.MSG_TYPE_HTTP_REQUEST2,a,(function(r,i){s.closeStream();var o=(null==r?void 0:r.headers).find((function(e){return"Content-Encoding"===(null==e?void 0:e.name)}));if(200===r.status_code){if("gzip"===(null==o?void 0:o.val))s.logger.info(ae+" gzip");else if(r.body&&1===e.format)try{a=q(r.body),r.body=a}catch(i){s.logger.info(ae+" decode "+JSON.stringify(i))}o=Se(Se({},r),{body:void 0}),s.logger.info(ae+" suc "+JSON.stringify(o)),t&&t(r,i)}else{try{var a=q(r.body);r.body=a}catch(i){s.logger.info(ae+" status "+r.status_code+" "+JSON.stringify(i))}n&&n(r)}}),(function(e,t,r){s.closeStream(),s.logger.error(ae+" fail"),n&&n(r||e)}),(function(e){s.logger.error(ae+" ack"),r&&r(e)}),o),this.netHttpStream.isFirst=!1},Oe.prototype.closeStream=function(){this.logger.info("zn.nahr.cs call"),this.netHttpStream.closeStream(0,"")},Oe),be=(Object.defineProperty(ke.prototype,"StreamID",{get:function(){return this.streamID},enumerable:!1,configurable:!0}),ke.prototype.refresh=function(e){this.streamID=e,this.isFirst=!0},ke.prototype.sendMessage=function(e,t,n,r,i,o){var s=this;void 0===n&&(n=null),void 0===r&&(r=null),this.zegoLink.sendMessage(e,this.streamID,t,this.isFirst,(function(e,t,r){s.type!==u.PC&&(s.isFree=!0),n&&n(e,r)}),(function(e,t,n){s.type!==u.PC&&(s.isFree=!0),r&&r(e,t,n)}),i=void 0===i?null:i,o=void 0===o?{timeout:5e3,isInSendMap:!0}:o)},ke.prototype.onPushEvent=function(e,t,n){},ke.prototype.closeStream=function(e,t){this.zegoLink.sendMessage(i.MSG_TYPE_STREAM_CLOSED,this.streamID,{code:e,msg:t})},ke.prototype.isConnect=function(){return this.zegoLink.isConnect()},ke),Te=(Ie.prototype.createStream=function(e){var t=new be(e,this.streamID++,this.zegoLink);return e===u.PC&&this.pcStreams.push(t),t},Ie.prototype.onPushEvent=function(e,t,n,r){var i=this.pcStreams.find((function(t){return t.StreamID===e}));i&&i.onPushEvent(t,n,r)},Ie.prototype.getStreamID=function(){return this.streamID++},Ie),Ce=function(){return(Ce=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},we=(Object.defineProperty(Re.prototype,"clientIP",{get:function(){return this.stateCenter.clientIP},enumerable:!1,configurable:!0}),Object.defineProperty(Re.prototype,"timeOffset",{get:function(){return this.stateCenter.timeOffset},enumerable:!1,configurable:!0}),Object.defineProperty(Re.prototype,"linkConnectState",{get:function(){return this._linkConnectState},set:function(e){this.lastLinkConnectState=this._linkConnectState,this._linkConnectState=e},enumerable:!1,configurable:!0}),Re.prototype.init=function(){this.logger=new ye,this.protobuf=new L,this.stateCenter=new ve,this.eventManager=new fe,this.checkLinkMsg(),this.inited=!0},Re.prototype.unInit=function(){this.inited=!1},Re.prototype.setAppInfo=function(e){this.logger.info("zn.sai.0 "+JSON.stringify(e)),this.stateCenter.appInfo=e,this.stateCenter.networkState=!navigator||navigator.onLine?r.online:r.offline,0===e.env?this.bindWindowListener():1===e.env&&this.bindWxListener(),this.zegoLink=new le(e.appID,e.env,this.protobuf,this.logger,this.stateCenter),this.zegoLink.initEvent(this.onConnectedEvent,this.onDisConnectedEvent,this.onConnectingEvent,this.onPushEvent),this.streamManager=new Te(this.zegoLink),this.businessRequestMgr=new he(this.streamManager,this.protobuf,this.logger,this.stateCenter),this.netHeartBeatHandler=new de(this.streamManager,this.logger,this.stateCenter),this.netAgentPCRequestMgr=new _e(this.streamManager,this.logger),this.heartBeatHandler()},Re.prototype.setUserInfo=function(e){this.stateCenter.userId=e},Re.prototype.setNetAgentDefaultServers=function(e){this.connectServers=j([],e,!0)},Re.prototype.setNetAgentSpecifiedServers=function(e){this.logger.info("zn.sss.0 "+JSON.stringify(e)),this.stateCenter.specified=!0,this.specifiedServers=j([],e,!0)},Re.prototype.setBackupDomains=function(e){this.primaryDomains=e},Re.prototype.setDispatchConnectServers=function(e){this.connect(e)},Re.prototype.startHttpRequest=function(e,t,n,r,i){var o=this,s=this.reportSeq++;this.eventManager.emit("requestEvent",s,"start"),this.isConnect()||(this.logger.info("zn.shq.0 link is not connect"),this.connectUa()),new Ee(this.logger,this.streamManager,e.service).sendRequest(e,(function(n){o.eventManager.emit("requestEvent",s,"end",{na_req_location:e.location,status_code:n.status_code,err_code:0}),t&&t(n)}),(function(t){o.eventManager.emit("requestEvent",s,"end",{na_req_location:e.location,err_code:t.code||0}),n&&n(t)}),r,i)},Re.prototype.startHttpRequest2=function(e,t,n,r,i){var o=this,s=this.reportSeq++;this.eventManager.emit("requestEvent",s,"start"),this.isConnect()||(this.logger.info("zn.shq.0 link is not connect"),this.connectUa()),new Ee(this.logger,this.streamManager).sendRequest2(e,(function(n,r){o.eventManager.emit("requestEvent",s,"end",{na_req_interface:e.interfaceID,status_code:n.status_code,err_code:0}),t&&t(n,r)}),(function(t){o.eventManager.emit("requestEvent",s,"end",{na_req_interface:e.interfaceID,err_code:t.code||0}),n&&n(t)}),r,i)},Re.prototype.getAppConfigByAgent=function(e,t,n,r){return this.isConnect()||(this.logger.info("zn.gab.0 link is not connect"),this.connectUa()),this.getAppConfig(e,this.stateCenter.userId,t,n,r)},Re.prototype.getPCRequest=function(e,t){var n=this;return(t=this.netAgentPCRequestMgr.getRequest(e,t)).on("disconnected",(function(t){n.logger.warn("zn.zca.gpr "+e+" disconnect "+t),t===f.TEMP&&(n.disConnect(),n.connectStart())})),t.on("connectStart",(function(){n.connectUa()})),t},Re.prototype.connectUa=function(){this.isDestroy||(this.logger.info("zn.zca.cua call"),this.retryLinkHandler&&(this.retryLinkHandler.init(),this.connectStart(!1,!0)))},Re.prototype.destroyConnect=function(){this.logger.info("zn.zca.dc.0 call"),this.resetNetAgent()},Re.prototype.destroy=function(){this.logger.info("zn.zca.dy.0 call"),this.destroyConnect(),this.linkCheckTimer&&clearTimeout(this.linkCheckTimer),this.retryLinkHandler&&this.retryLinkHandler.invalid(),this.retryLinkHandler&&this.retryLinkHandler.stopMaxTime(),this.isDestroy=!0},Re.prototype.isConnect=function(){return this.zegoLink&&this.zegoLink.isConnect()},Re.prototype.on=function(e,t){return this.logger.info("zn.zca.o.0 "+e),this.eventManager.addEventHandler(e,t)},Re.prototype.off=function(e,t){this.logger.info("zn.zca.o.1 "+e),this.eventManager.removeEventHandler(e,t)},Re.prototype.setLogger=function(e){this.logger=e},Re.prototype.setAccess=function(e){this.stateCenter.useNetAgent=e},Re.prototype.getVersion=function(){return"1.1.5"},Re.prototype.heartBeatHandler=function(){var e=this;this.netHeartBeatHandler.netHbLogout=function(t){e.retryLinkHandler&&([W.NET_HB_TIMEOUT.code].includes(t.code)?(e.retryLinkHandler.startMaxTime(),e.disConnect(),e.connectStart()):(e.retryLinkHandler.stopMaxTime(),e.retryLinkHandler.invalid(),e.eventManager.emit("disconnected")))}},Re.prototype.bindWindowListener=function(){var e=this;window.addEventListener("offline",(function(){e.netOffLineHandle()})),window.addEventListener("online",(function(){e.netOnLineHandle()}))},Re.prototype.bindWxListener=function(){var e=this;wx.onNetworkStatusChange((function(t){t.isConnected?e.netOnLineHandle():e.netOffLineHandle()}))},Re.prototype.netOnLineHandle=function(){this.logger.info("zn.zca.noh.0 network is online"),this.stateCenter.networkState=r.online,this.stateCenter.useNetAgent&&this.netOnLineHandler()},Re.prototype.netOffLineHandle=function(){this.logger.info("zn.zca.noh.1 network is broken"),this.stateCenter.networkState=r.offline,this.stateCenter.useNetAgent&&this.netOffLineHandler()},Re.prototype.checkLinkMsg=function(){var e=this;if(this.stateCenter.useNetAgent){if(this.isConnect()){var t=Date.now()-this.zegoLink.updatedMsgTime;if(t>1e3*this.linkMsgMaxInterval)return this.logger.info("zn.zca.clm interval: "+t),void this.resetNetAgent()}this.linkCheckTimer&&clearTimeout(this.linkCheckTimer),this.linkCheckTimer=setTimeout((function(){e.checkLinkMsg()}),1e3*this.linkMsgCheckInterval)}},Re.prototype.connect=function(e){var t=this;0<e.length&&(this.connectServers=j([],e,!0)),this.stateCenter.specified&&0<this.specifiedServers.length&&(this.connectServers=this.specifiedServers),this.zegoLink.createSocket(this.connectServers),this.retryLinkHandler||(this.retryLinkHandler=new me(this.logger,this.stateCenter)),this.retryLinkHandler.init(),this.retryLinkHandler.initLink(this.zegoLink),this.retryLinkHandler.onactive=function(e,n){n===W.NET_SOCKET_TIMEOUT&&(t.eventManager.emit("disconnected",n),t.netAgentPCRequestMgr.updateConnectState(l.DISCONNECT,f.TIMEOUT,n))},this.connectStart(!1,!0)},Re.prototype.resetNetAgent=function(){this.netHeartBeatHandler&&this.netHeartBeatHandler.reset(),this.zegoLink&&this.zegoLink.destroySocket(c.DISCONNECT)},Re.prototype.getConfig=function(){function e(e,r,i){i?t.logger.info(Z+" fail "+JSON.stringify(i)):0===e.code?(t.logger.info(Z+" suc "+JSON.stringify(e)),t.getConfigSuccess(e,n)):t.logger.info(Z+" fail "+JSON.stringify(e))}var t=this,n=(new Date).getTime();this.businessRequestMgr.getConfig(e,e)},Re.prototype.getConfigSuccess=function(e,t){this.netHeartBeatHandler.init(e),this.netAgentPCRequestMgr.setEstablishTimeout(e.data.pc_establish_timeout),null!=(n=null==e?void 0:e.data)&&n.client_outer_ip&&(this.stateCenter.clientIP=e.data.client_outer_ip),null!=(n=null==e?void 0:e.data)&&n.ntp_time&&(n="number"==typeof(n=e.data.ntp_time)?n:n.toNumber(),r=(new Date).getTime(),this.stateCenter.updateNTP(t,n,r));var n,r;t=e.data.geofencing_id;this.eventManager.emit("clientInfo",{clientIP:this.clientIP,timeOffset:this.timeOffset,geofencingID:t})},Re.prototype.dispatch=function(){var e=this;return new Promise((function(t,n){e.businessRequestMgr.dispatchURL((function(n){n=n.data.wss_groups;var r=(e.logger.info(X+" wss_groups: "+JSON.stringify(n)),n.some((function(e){return e.host.includes("geo")}))),i=null!=(i=e.stateCenter.appInfo)&&i.geoFencing||r?n:e.getConnectionDomains(n,e.primaryDomains);r=e.handleWssGroups(i);t({servers:r,domains:i})}),(function(e){n(e)}))}))},Re.prototype.handleWssGroups=function(e){return Array.isArray(e)&&0<e.length?e.map((function(e){return ue.scheme+"://"+e.host+"/"+ue.location})):[]},Re.prototype.getConnectionDomains=function(e,t){var n=j([],e,!0);return t.forEach((function(t){e.forEach((function(e){var r,i="";e.main_domain?i=e.main_domain:e.host&&(i=(r=e.host.split("."))[r.length-2]+"."+r[r.length-1]),i&&i!==t&&(r=e.host.replace(i,t),n.push({group:e.group,host:r}))}))})),n=n.filter((function(e){return!!e.host}))},Re.prototype.getAppConfig=function(e,t,n,r,i){var o=this;return new Promise((function(s,a){"string"==typeof t&&"string"==typeof n?o.businessRequestMgr.getAppConfig(e,t,n,r,i).then((function(e){s(Ce(Ce({},e),{retryCount:o.getAppConfigFailCount}))})).catch((function(r){var u;o.logger.error(K+" "+JSON.stringify(r)),!(-1<_.indexOf(r.code))&&(o.getAppConfigFailCount++,20008===r.code||1100002===r.code)&&o.getAppConfigFailCount<3?o.getAppConfig(e,t,n,i).then((function(e){return s(e)})).catch((function(e){return a(e)})):(u=o.getAppConfigFailCount,o.getAppConfigFailCount=0,a(Ce(Ce({},r),{retryCount:u})))})):o.logger.error(K+" userID or token must be string")}))},Re.prototype.reportDisConnectEvent=function(){var e=(new Date).getTime()-this.connectedTime;this.connectid&&this.eventManager.emit("disConnectedEvent",{duration:e,server:this.zegoLink.connectServer,connectid:this.connectid})},Re.prototype.redirect=function(e){this.logger.info($+" ".concat(JSON.stringify(e.wss_groups))),(e=this.handleWssGroups(e.wss_groups))&&Array.isArray(e)&&0<e.length?(this.disConnect(),this.stateCenter.specified&&(this.logger.info($+" specified"),e=this.specifiedServers),this.zegoLink.createSocket(e),this.connectStart(!1,!0)):this.logger.warn($+" wss_groups null")},Re.prototype.connectClosed=function(e){var t=this;switch(this.logger.info("zn.zca.cc"+" ".concat(e.reason," ").concat(e.msg," ").concat(e.action)),e.action){case h.ACTION_DISPATCH:var n=this.reportSeq++;this.eventManager.emit("dispatchEvent",n,"start"),this.dispatch().then((function(e){var r=e.servers;e=e.domains;t.eventManager.emit("dispatchEvent",n,"end",{domains:e,reason:"ConnectClosed"}),Array.isArray(r)&&0<r.length&&(t.eventManager.emit("dispatchResultUpdate",{servers:r,domains:e}),e=t.stateCenter.specified?t.specifiedServers:r,t.disConnect(),t.zegoLink.createSocket(e),t.connectStart(!1,!0))})).catch((function(e){t.logger.info("zn.zca.cc dispatch fail")}));break;case h.ACTION_RETRY:this.disConnect(),this.connectStart(!1);break;case h.ACTION_NEXT_GROUP:this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken",g.CLOSE),this.connectStart();case h.ACTION_ABORT:case h.ACTION_RESERVED:}},Re.prototype.netOnLineHandler=function(){this.retryLinkHandler&&(this.zegoLink.isConnect()?this.retryLinkHandler.stopMaxTime():this.connectStart())},Re.prototype.netOffLineHandler=function(){this.disConnect(),this.retryLinkHandler&&(this.retryLinkHandler.invalid(),this.retryLinkHandler.startMaxTime(),this.zegoLink.setState(0))},Re.prototype.connectStart=function(e,t){this.retryLinkHandler.active(e,t)&&this.reportConnectEvent()},Re.prototype.reportConnectEvent=function(){var e=this.reportSeq++;this.connectSeq=e,this.eventManager.emit("connectedEvent",e,"start")},Re.prototype.disConnect=function(){this.logger.info("zn.zca.dc.1 call"),this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken"),2===this.lastLinkConnectState&&0===this.linkConnectState&&this.reportDisConnectEvent()},Re.prototype.getNetworkTimeInfo=function(){var e,t=Date.now()+this.stateCenter.timeOffset,n=Math.round(this.stateCenter.networkRTT/2),r=this.stateCenter.ntpTimeInfo;return r&&(e=performance.now()-r.performanceTime,t=Math.round(r.ntp+e)),{timestamp:t,maxDeviation:n}},Re);function Re(){var e=this;this.linkCheckTimer=null,this.connectServers=[],this.specifiedServers=[],this.getAppConfigFailCount=0,this.getAppConfigTime=0,this.inited=!1,this.linkMsgMaxInterval=90,this.linkMsgCheckInterval=5,this.isDestroy=!1,this.connectedTime=0,this.connectid="",this.reportSeq=0,this.connectSeq=0,this.primaryDomains=[],this._linkConnectState=0,this.lastLinkConnectState=0,this.onConnectedEvent=function(t,n){var r;e.linkConnectState=2,e.getConfig(),e.stateCenter.specified||(r=e.reportSeq++,e.eventManager.emit("dispatchEvent",r,"start"),e.dispatch().then((function(t){var n=t.servers;t=t.domains.map((function(e){return e.host}));e.eventManager.emit("dispatchEvent",r,"end",{domains:t}),0<n.length&&e.eventManager.emit("dispatchResultUpdate",{servers:n,domains:t})})).catch((function(e){}))),e.eventManager.emit("connected"),e.connectedTime=(new Date).getTime(),e.connectid=function(e){var t,n="0123456789".split(""),r=[];for(e=n.length,t=0;t<16;t++)r[t]=n[0|Math.random()*e];return r.join("")}(),e.eventManager.emit("connectedEvent",e.connectSeq,"end",{servers:t,count:t.length,connectid:e.connectid,connectEvents:n})},this.onConnectingEvent=function(){e.logger.info("zn.zca.oce call"),e.linkConnectState=1},this.onDisConnectedEvent=function(t){e.logger.info("zn.zca.ode"+" ".concat(t)),e.linkConnectState=0,t?(e.disConnect(),e.netAgentPCRequestMgr.updateConnectState(l.BROKEN)):(e.eventManager.emit("disconnected"),e.netAgentPCRequestMgr.updateConnectState(l.DISCONNECT))},this.onPushEvent=function(t,n,r,o){switch(n){case i.MSG_TYPE_REDIRECT:case i.MSG_TYPE_REDIRECT2:e.redirect(r);break;case i.MSG_TYPE_CLOSE_CONNECTION:e.connectClosed(r);break;case i.MSG_TYPE_PC_BROKEN:case i.MSG_TYPE_PC_ESTABLISHED:case i.MSG_TYPE_PC_DOWNWARD_MESSAGE:case i.MSG_TYPE_PUSH_EXCEPTION:e.streamManager.onPushEvent(t,n,r,o);break;case i.MSG_TYPE_PUSH_APPCONFIG:e.businessRequestMgr.decodeConfigMessage(r.data)}}}function Ie(e){this.zegoLink=e,this.streamID=1,this.httpStreams=[],this.pcStreams=[]}function ke(e,t,n){this.type=e,this.streamID=t,this.zegoLink=n,this.isFree=!1,this.isFirst=!0}function Oe(e,t,n){this.logger=e,this.streamManager=t,this.service=n,this.netHttpStream=this.streamManager.createStream(u.HTTP)}function Ne(){}function Ae(){this.networkState=r.online,this.useNetAgent=!0,this.specified=!1,this.clientIP="",this.timeOffset=0,this.networkRTT=0}function Le(e,t){this.logger=e,this.stateCenter=t,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryActiveCount=1,this.retryNetCount=0,this.retryNetMaxTimes=3,this.isOverTime=!1,this.RETRY_MAX_TIME=90}function Pe(e,t){this.streamManager=e,this.logger=t,this.pcStreamRequests=[],this.pcEstablishTimeout=ue.pcEstablishTimeout}function Me(e,t,n,r,i){this.logger=e,this.service=t,this.streamManager=n,this.pcEstablishTimeout=r,this.option=i,this.connectState=l.DISCONNECT,this.lastConnectState=l.DISCONNECT,this.brokenTimer=null,this.listenerList={connected:[],broken:[]},this.netPcStream=this.streamManager.createStream(u.PC),this.eventManager=new fe,this.netPcStream.onPushEvent=this.onPushEvent.bind(this)}function De(){this.handlerListMap={}}function xe(e,t,n){this.streamManager=e,this.logger=t,this.stateCenter=n,this.hbTimer=null,this.hbInterval=5,this.hbTimeout=10,this.hbTimeoutMaxCount=0,this.tryHbCount=0}function Ue(e,t,n,r){this.streamManager=e,this.protobuf=t,this.logger=n,this.stateCenter=r}function Be(e){this.socket=null,this.ENV=e}}],a={},r.m=s,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2))},function(e,t,n){function r(e){var t;return(u[e]||(t=u[e]={i:e,l:!1,exports:{}},a[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}var i,o,s,a,u;e.exports=(i=n(8),o=n(0),s=n(2),u={},r.m=a=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_SETTING_ACTION=void 0,(t=t.ZEGO_SETTING_ACTION||(t.ZEGO_SETTING_ACTION={})).CONSTRUCTOR="zs.0",t.SETTING_INIT="zs.ii.0",t.SETTING_FETCH_SETTING="zs.fs.0",t.SETTING__FETCH_SETTING="zs.fs.1",t.SETTING_GET_CLOUD_SETTING="zs.gcs.0",t.SETTING_POLLING_SETTING="zs.ps.0",t.SETTINGCACHEHANDLER_GET_CACHE_SETTING="zs.sch.gcs.0",t.SETTINGCACHEHANDLER_STORE_SETTING="zs.sch.ss.0",t.SETTINGFETCHHANDLER_FETCHSETTING="zs.sfh.fs.0"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorList=void 0,t.errorList={NOT_INIT:{code:1001,msg:"not init"},FILE_REQUEST_FAIL:{code:1002,msg:"fetch request fail"},INFLATE_DATA_FAIL:{code:1003,msg:"inflate fail"},MULTI_FILE_NOT_EXIST:{code:1004,msg:"get multi file fail"},AUTH_FAIL:{code:1005,msg:"auth failed"}}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ProductMap=t.Product=t.SOCKET_DISCONNECT=t.ENUM_REMOTE_TYPE=t.ZEGO_BROWSER_TYPE=t.ZEGO_ENV=t.PROTO_VERSION=void 0,t.PROTO_VERSION="1.1.1",(r=t.ZEGO_ENV||(t.ZEGO_ENV={}))[r.BROWSER=0]="BROWSER",r[r.WEIXINMINI=1]="WEIXINMINI",(r=t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={}))[r.IE=0]="IE",r[r.FIREFOX=1]="FIREFOX",r[r.CHROME=2]="CHROME",r[r.SAFARI=3]="SAFARI",r[r.OPERA=4]="OPERA",r[r.WEIXIN=5]="WEIXIN",r[r.WEIXINMINI=6]="WEIXINMINI",r[r.UNKOWN=7]="UNKOWN",(r=t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={}))[r.DISABLE=0]="DISABLE",r[r.WEBSOCKET=1]="WEBSOCKET",r[r.HTTPS=2]="HTTPS",t.SOCKET_DISCONNECT=-1,(r=t.Product||(t.Product={}))[r.RTC=0]="RTC",r[r.WEB_RTC=1]="WEB_RTC",r[r.ZIM=2]="ZIM",r[r.ROOM_KIT=3]="ROOM_KIT",r[r.DOC_SHARE=4]="DOC_SHARE",r[r.WHITE_BOARD=5]="WHITE_BOARD",r[r.SELF_CHECK=999]="SELF_CHECK",r[r.TEST_ANOOUS=1e3]="TEST_ANOOUS",t.ProductMap={0:"rtc_sdk_native",1:"Web_SDK",2:"ZIM",3:"roomkitWeb",4:"docsshare",5:"WhiteBoard"}},function(e,t){e.exports=i},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.decodeString=t.decodeCompressData=t.generateUUID=t.checkValidNumber=t.analyzeKey=t.getCurrentTime=t.getBrowser=void 0,n(16)),s=(t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),n=-1!=e.indexOf("Firefox"),r=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,o=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");e=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0];return t?"IE":n?"FIREFOX":r?"OPERA":i?"CHROME":o?"SAFARI":e?"WEIXIN":"UNKOWN"},["00","01","02","03","04","05","06","07","08","09"]);t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(s[e.getMonth()+1]||e.getMonth()+1)+"/",(s[e.getDate()]||e.getDate())+" ",(s[e.getHours()]||e.getHours())+":",(s[e.getMinutes()]||e.getMinutes())+":",s[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")},t.analyzeKey=function(e){return e=e.split("_"),{level:Number(e[0]),timestamp:e[1],seq:e[2]}},t.checkValidNumber=function(e,t,n){return t=t||1,n=n||1e4,"number"==typeof e&&e%1==0&&t<=e&&e<=n},t.generateUUID=function(e){if(0===(e=void 0===e?0:e))try{n=localStorage.getItem("z_deviceID")}catch(e){}else wx.getStorageSync("z_deviceID");if(!n){var t=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(36)}));if(0===e)try{localStorage.setItem("z_deviceID",n)}catch(e){}else wx.setStorageSync("z_deviceID",n)}return n},t.decodeCompressData=function(e){try{return o.inflate(e,{to:"string"})}catch(e){console.error(e)}},t.decodeString=function(e){return decodeURIComponent(window.escape(String.fromCharCode.apply(String,i(Array.from(e)))))}},function(e,t){e.exports=o},function(e,t){e.exports=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INIT_CONFIG=void 0,t.INIT_CONFIG={env:0,compress:!0,p_version:1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSetting=void 0;var r=n(9);Object.defineProperty(t,"ZegoSetting",{enumerable:!0,get:function(){return r.ZegoSetting}})},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,(u=i?[2&u[0],i.value]:u)[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3]))o.label=u[1];else if(6===u[0]&&o.label<i[1])o.label=i[1],i=u;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(u)}}u=t.call(e,o)}catch(a){u=[6,a],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSetting=void 0,n(2)),a=n(10),u=n(11),c=n(13),l=n(0),h=n(7),d=n(1),f=n(4);function p(){this.fileList=[],this.publicEnvVariable={},this.proEnvVariable={},this.pollingTimer=null,this.pollingInterval=300,this.inited=!1,this.checkFailCount=0,this.checkFailed=!1,this.log=new a.ZegoLog}Object.defineProperty(p.prototype,"envVariable",{get:function(){return Object.assign({},this.publicEnvVariable,this.proEnvVariable)},enumerable:!1,configurable:!0}),p.prototype.init=function(e){var t,n=this;return e.pollingFreq&&!f.checkValidNumber(e.pollingFreq)?(this.log.error(l.ZEGO_SETTING_ACTION.SETTING_INIT+" pollingFreq must be integer number"),!1):(this.options=Object.assign({},h.INIT_CONFIG,e),this.getPublicEnvVariable(),this.settingFetchHandler=new c.SettingFetchHandler(this.options,this.log),this.settingFetchHandler.setDataReport(this.options.reportNotify),e=Math.round(60*Math.random()),this.log.info(l.ZEGO_SETTING_ACTION.SETTING_INIT+" delay "+e),this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null),this.options.pollingFreq&&60<=this.options.pollingFreq&&(this.pollingInterval=this.options.pollingFreq),this.delayTimer=setTimeout((function(){n.pollingSetting(1e3*n.pollingInterval,!1)}),1e3*e),e=this.options.product||this.options.productNum,this.settingCacheHandler=new u.SettingCacheHandler("setting_"+(this.options.online?"online_":"test_")+e+"_"+this.options.appID,this.log,this.options.env),[0,1,2,3,4,5].includes(e)&&(t=s.ProductMap[e])&&(1===e&&this.settingCacheHandler.dropOldStore("setting_"+(this.options.online?"online_":"test_")+"undefined_"+this.options.appID),this.settingCacheHandler.dropOldStore("setting_"+(this.options.online?"online_":"test_")+t+"_"+this.options.appID)),null!=(t=this.options)&&t.unify&&this.options.connection&&null!=(e=null==(e=this.options)?void 0:e.connection)&&e.on("connected",(function(){n.settingFetchHandler.checkUnSendMsgs(n.settingFetchHandler.unSendCommandList)})),this.refreshAuthCheck(),this.inited=!0)},p.prototype.uninit=function(){this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null)},p.prototype.setEnvVariable=function(e,t){this.proEnvVariable[e]=String(t)},p.prototype.getEnvVariable=function(e){return this.envVariable[e]},p.prototype.setEnvVariables=function(e){var t=this;Object.keys(e).forEach((function(n){"string"!=typeof e[n]&&"number"!=typeof e[n]&&t.log.error("zs.sev env "+n+" type error"),t.proEnvVariable[n]=String(e[n])}))},p.prototype.getEnvVariables=function(){return this.envVariable},p.prototype.enablePolling=function(e,t){var n=this;t?t.forEach((function(t){var r=n.fileList.find((function(e){return e.fileName===t}));r&&(r.needPolling=e)})):this.fileList.forEach((function(t){return t.needPolling=e}))},p.prototype.setToken=function(e){this.token!==e&&this.refreshAuthCheck(),this.token=e},p.prototype.setUserID=function(e){this.userID!==e&&this.refreshAuthCheck(),this.userID=e},p.prototype.getSettingCache=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return this.inited?(t=this.fileList.find((function(t){return t.fileName===e})))?[2,Promise.resolve({setting:t.setting,versions:t.versions})]:[3,1]:[2,Promise.reject(d.errorList.NOT_INIT)];case 1:return[4,this.settingCacheHandler.getCacheSetting(e)];case 2:return(t=r.sent())&&(this.fileList.find((function(t){return t.fileName===e}))||this.fileList.push({fileName:e,fetchedTime:0,needPolling:!1,setting:t.setting,versions:t.versions}),n={setting:t.setting,versions:t.versions}),[2,Promise.resolve(n)]}}))}))},p.prototype.fetchSetting=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!0),this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" call "+e),this.inited?(this.activePolling(),0<Object.keys(t).length?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" get file with params"),this._getCloudSetting(e,r(r({},this.envVariable),t))):(t=this.fileList.find((function(t){return t.fileName===e})))?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" file exist"),(new Date).getTime()-t.fetchedTime<1e3*this.pollingInterval?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" fetch time interval in freq"),t.needPolling=n,Promise.resolve({setting:t.setting,versions:t.versions})):this._fetchSetting(e,t,n)):(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" file not found"),this._fetchSetting(e,t,n))):Promise.reject(d.errorList.NOT_INIT)},p.prototype.fetchMultiSetting=function(e,t,n){var s=this;return void 0===t&&(t={}),void 0===n&&(n=!0),this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" call "+JSON.stringify(e)),this.inited?(this.activePolling(),0<Object.keys(t).length?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" get file with params"),this._getCloudSetting(e,r(r({},this.envVariable),t))):new Promise((function(t,r){var a={},u=[];if(e.forEach((function(e){return i(s,void 0,void 0,(function(){var t;return o(this,(function(n){return(t=this.fileList.find((function(t){return t.fileName===e})))&&(new Date).getTime()-t.fetchedTime<1e3*this.pollingInterval?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" fetch time interval in freq"),a[e]={setting:t.setting,versions:t.versions}):u.push(e),[2]}))}))})),!(0<u.length))return t(a);s._getCloudSetting(u,s.envVariable).then((function(e){return s.handleFetchFiles(e,n),Object.assign(a,e),t(a)})).catch((function(e){u.forEach((function(e){return i(s,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return(t=this.fileList.find((function(t){return t.fileName==e})))?t.fetchedTime=(new Date).getTime():this.fileList.find((function(t){return t.fileName===e}))||this.fileList.push({fileName:e,fetchedTime:(new Date).getTime(),needPolling:n,setting:{},versions:{}}),[4,this.settingCacheHandler.getCacheSetting(e)];case 1:return t=r.sent(),a[e]={setting:t.setting,versions:t.versions},[2]}}))}))})),0<Object.keys(a).length?t(a):r(e)}))}))):(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" not init"),Promise.reject(d.errorList.NOT_INIT))},p.prototype.setOptions=function(e){e&&"boolean"==typeof e.unify&&(this.options.unify=e.unify,this.settingFetchHandler.setOptions(this.options))},p.prototype.setLog=function(e){this.log=e},p.prototype._getCloudSetting=function(e,t){var n=this;return new Promise((function(r,s){return i(n,void 0,void 0,(function(){var n,i,a,u,c,h,f,p,g,_,m=this;return o(this,(function(o){switch(o.label){case 0:if(o.trys.push([0,6,,7]),this.checkFailed)return this.log.warn(l.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" check fail"),s(d.errorList.AUTH_FAIL),[2];h=(p=e instanceof Array)?e:[e],n=[],i={},a=function(e){return e=e.map((function(e){return m.settingCacheHandler.getCacheSetting(e)})),Promise.all(e)},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,a(h)];case 2:return u=o.sent(),h.forEach((function(e,t){var r;n.push({file_name:e,hash:null==(r=u[t].versions)?void 0:r.hash,g_version:null==(r=u[t].versions)?void 0:r.g_version}),i[e]=u[t]})),[3,4];case 3:return o.sent(),h.forEach((function(e){n.push({file_name:e})})),[3,4];case 4:return[4,this.settingFetchHandler.fetchSetting(n,t,this.token,this.userID,!1)];case 5:return h=o.sent(),c=h.data,h=h.polling_interval,this.checkFailCount=0,this.log.info(l.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" suc"),"number"==typeof h&&5<=h&&this.pollingInterval!==60*h&&(this.log.warn(l.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" polling interval change"),this.pollingInterval=60*h,this.uninit(),this.activePolling()),p?(f={},e.forEach((function(e){var t,n;0==(null==(t=c[e])?void 0:t.code)&&(c[e].hashChange?(m.log.info(l.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" file "+e+" changed"),f[e]={setting:null==(n=c[e])?void 0:n.data,versions:null==(n=c[e])?void 0:n.versions}):i[e]&&(f[e]={setting:null==(n=i[e])?void 0:n.setting,versions:null==(e=i[e])?void 0:e.versions}))})),0<Object.keys(f).length?r(f):s(d.errorList.MULTI_FILE_NOT_EXIST)):0===(null==(p=c[e])?void 0:p.code)&&null!=(g=c[e])&&g.data?r({setting:null==(g=c[e])?void 0:g.data,versions:null==(g=c[e])?void 0:g.versions}):s({code:null==(_=c[e])?void 0:_.code,msg:null==(_=c[e])?void 0:_.message}),[3,7];case 6:return _=o.sent(),this.log.error(l.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" fail "+JSON.stringify(_)),21002!==(null==_?void 0:_.code)&&401!==(null==_?void 0:_.status_code)||(this.checkFailCount+=1),2<=this.checkFailCount&&(this.checkFailed=!0),s(_),[3,7];case 7:return[2]}}))}))}))},p.prototype.handleFetchFiles=function(e,t){var n=this;Object.keys(e).forEach((function(r){var i=n.fileList.find((function(e){return e.fileName==r}));i?(i.fetchedTime=(new Date).getTime(),i.setting=e[r].setting,i.versions=e[r].versions,i.needPolling=t):n.fileList.find((function(e){return e.fileName===r}))||n.fileList.push({fileName:r,fetchedTime:(new Date).getTime(),needPolling:t,setting:e[r].setting,versions:e[r].versions}),n.settingCacheHandler.storeSetting(r,e[r])}))},p.prototype._fetchSetting=function(e,t,n){var r=this;return new Promise((function(s,a){r.log.info(l.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" call"),r._getCloudSetting(e,r.envVariable).then((function(i){t?(t.fetchedTime=(new Date).getTime(),t.setting=i.setting,t.versions=i.versions,t.needPolling=n):r.fileList.find((function(t){return t.fileName===e}))||r.fileList.push({fileName:e,fetchedTime:(new Date).getTime(),needPolling:n,setting:i.setting,versions:i.versions}),r.settingCacheHandler.storeSetting(e,i),s(i),r.log.info(l.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" call suc")})).catch((function(u){return i(r,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:t?t.fetchedTime=(new Date).getTime():this.fileList.find((function(t){return t.fileName===e}))||this.fileList.push({fileName:e,fetchedTime:(new Date).getTime(),needPolling:n,setting:{},versions:{}}),r=e,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.settingCacheHandler.getCacheSetting(r)];case 2:return r=i.sent(),s(r),[3,4];case 3:return i.sent(),a(u),[3,4];case 4:return this.log.info(l.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" setting not contain or fetch file fail"),[2]}}))}))}))}))},p.prototype.getPublicEnvVariable=function(){var e;0==this.options.env?(this.publicEnvVariable.userAgent=navigator.userAgent,this.publicEnvVariable.platform=navigator.platform,this.publicEnvVariable.browser=f.getBrowser(),this.publicEnvVariable.deviceid=f.generateUUID()):1==this.options.env&&(e=wx.getSystemInfoSync(),this.publicEnvVariable.brand=e.brand,this.publicEnvVariable.model=e.model,this.publicEnvVariable.system=e.system,this.publicEnvVariable.platform=e.platform,this.publicEnvVariable.wechatVersion=e.version,this.publicEnvVariable.wechatSDKVersion=e.SDKVersion,this.publicEnvVariable.deviceid=f.generateUUID(this.options.env))},p.prototype.pollingSetting=function(e,t){return void 0===t&&(t=!0),i(this,void 0,void 0,(function(){var n,r,s,a,u=this;return o(this,(function(c){switch(c.label){case 0:return this.log.info(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" call "+e+" "+t),n=e,t?(r=[],this.fileList.forEach((function(e){e.fileName,e.needPolling&&r.push({file_name:e.fileName,hash:e.versions.hash,g_version:e.versions.g_version})})),this.checkFailed?(this.log.warn(l.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" has checked fail"),[3,7]):[3,1]):[3,7];case 1:if(!(0<r.length))return[3,6];c.label=2;case 2:return c.trys.push([2,4,,5]),[4,this.settingFetchHandler.fetchSetting(r,this.envVariable,this.token,this.userID)];case 3:return a=c.sent(),s=a.data,a=a.polling_interval,this.log.info(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" fetch suc"),this.checkFailCount=0,"number"==typeof a&&5<=a&&this.pollingInterval!==60*a&&(this.log.warn(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" polling interval change"),this.pollingInterval=60*a,n=1e3*this.pollingInterval),this.fileList.forEach((function(e){return i(u,void 0,void 0,(function(){var t,n,r,i,a,u,c,h,d,f;return o(this,(function(o){switch(o.label){case 0:return e.fetchedTime=(new Date).getTime(),t=e.fileName,n=s[e.fileName],r=n.code,i=n.data,a=n.versions,u=n.message,c=n.hashChange,n&&0===r&&i?(d=JSON.stringify(i),f=JSON.stringify(e.setting),h={setting:i,versions:a,code:r,message:u},c&&f!==d&&(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" "+e.fileName+" setting changed"),e.setting=h.setting,e.versions=h.versions,this.options.pollingNotify(e.fileName,h)),[4,this.settingCacheHandler.getCacheSetting(t)]):[3,2];case 1:f=o.sent(),d=JSON.stringify(f),f=JSON.stringify(h),c&&d!==f&&this.settingCacheHandler.storeSetting(t,h),o.label=2;case 2:return[2]}}))}))})),[3,5];case 4:return a=c.sent(),this.log.error(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" fetch fail "+JSON.stringify(a)),21002!==(null==a?void 0:a.code)&&401!==(null==a?void 0:a.status_code)||(this.checkFailCount+=1),2<=this.checkFailCount&&(this.checkFailed=!0),[3,5];case 5:return[3,7];case 6:this.log.info(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" polling no file"),c.label=7;case 7:return this.pollingTimer&&clearTimeout(this.pollingTimer),this.pollingTimer=setTimeout((function(){u.pollingSetting(n)}),n),[2]}}))}))},p.prototype.activePolling=function(){this.pollingTimer||this.pollingSetting(1e3*this.pollingInterval)},p.prototype.refreshAuthCheck=function(){this.checkFailCount=0,this.checkFailed=!1},t.ZegoSetting=n=p},function(e,t,n){"use strict";function r(){}Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLog=void 0,r.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join(" ");console.log(n)},r.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join(" ");console.debug(n)},r.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join(" ");console.info(n)},r.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join(" ");console.warn(n)},r.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.join(" ");console.error(n)},t.ZegoLog=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){var u=[s,a];if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,(u=i?[2&u[0],i.value]:u)[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3]))o.label=u[1];else if(6===u[0]&&o.label<i[1])o.label=i[1],i=u;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(u)}}u=t.call(e,o)}catch(a){u=[6,a],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.SettingCacheHandler=void 0,o(n(3))),a=n(0),u=n(12);function c(e,t,n){void 0===n&&(n=0),this.storeName=e,this.log=t,this.store=u.createZegoStore(e,n)}c.prototype.getCacheSetting=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.log.info(a.ZEGO_SETTING_ACTION.SETTINGCACHEHANDLER_GET_CACHE_SETTING+" call"),[4,this.store.getItem(e)];case 1:return[2,t.sent()||""]}}))}))},c.prototype.storeSetting=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return this.log.info(a.ZEGO_SETTING_ACTION.SETTINGCACHEHANDLER_STORE_SETTING+" call"),[4,this.store.setItem(e,t)];case 1:return n.sent(),[2]}}))}))},c.prototype.dropOldStore=function(e){s.default.dropInstance({name:e}).then((function(){console.debug("Dropped ",e)})).catch((function(e){console.warn(e)}))},t.SettingCacheHandler=n=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoStore=t.ZegoWechatMiniStore=void 0;var r=n(3),i=n(2),o=(s.prototype.getItem=function(e){var t=this;return new Promise((function(n,r){try{n(wx.getStorageSync(t.keyPrefix+e))}catch(n){r(n)}}))},s.prototype.setItem=function(e,t){var n=this;return new Promise((function(r,i){try{wx.setStorageSync(n.keyPrefix+e,t),r()}catch(r){i(r)}}))},s.prototype.removeItem=function(e){var t=this;return new Promise((function(n,r){try{n(wx.removeStorageSync(t.keyPrefix+e))}catch(n){r(n)}}))},s.prototype.clear=function(){return new Promise((function(e,t){try{wx.clearStorageSync(),e()}catch(e){t(e)}}))},s.prototype.keys=function(){var e=this;return new Promise((function(t,n){try{var r=wx.getStorageInfoSync().keys,i=(console.warn("keys",r),[]);r.forEach((function(t){0==t.indexOf(e.keyPrefix)&&i.push(t.replace(e.keyPrefix,""))})),console.warn("keyArr",i),i.sort(),t(i)}catch(t){n(t)}}))},s);function s(e){this.storeName=e,this.keyPrefix=e+"/",this.storeName}t.ZegoWechatMiniStore=o,t.createZegoStore=function(e,t){return t===i.ZEGO_ENV.BROWSER?r.createInstance({name:e}):new o(e)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingFetchHandler=void 0;var o,s,a=n(0),u=n(1),c=n(14),l=n(15),h=n(4),d=n(17),f=n(7),p=i(n(5));function g(e,t){this.options=e,this.log=t,this.seq=0,this.userID="",this.unSendCommandList=new l.LinkedList,this.testNetPackageSize=!1,this.protobuf=new d.CloudSettingProtoBuf}n=o={SERVICE_ClOUD_SETTING:10,10:"SERVICE_ClOUD_SETTING"},n=s={METHOD_UNSET:0,0:"METHOD_UNSET",METHOD_GET:1,1:"METHOD_GET",METHOD_POST:2,2:"METHOD_POST"},g.prototype.setOptions=function(e){this.options=e},g.prototype.setDataReport=function(e){this.reportFunc=e},g.prototype.setUserID=function(e){this.userID=e},g.prototype.fetchSetting=function(e,t,n,i,o){var s=this;return void 0===o&&(o=!0),new Promise((function(u,l){var d={product:s.options.product,files:e.map((function(e){return e.file_name})),param:r(r({},t),{deviceid:void 0}),appid:s.options.appID,token:n,id_name:i,timestamp:(new Date).getTime(),biztype:0,deviceid:t.deviceid||h.generateUUID(s.options.env),compress:!1,mode:s.options.online?"online":"test"},p=d.param,g={appid:d.appid,token:d.token,id_name:d.id_name,deviceid:d.deviceid},_=s.seq++;function m(e){var t,n=e.code,r=(e.msg,e.data),i=e.polling_interval;e=e.reportData,s.log.info(a.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" unify "+n),r&&(t=[],Object.keys(r).forEach((function(e){var n;t.push({name:e,code:r[e].code,message:null==(n=r[e])?void 0:n.message,versions:JSON.stringify(null==(n=r[e])?void 0:n.versions),content:JSON.stringify(null==(e=r[e])?void 0:e.data)})}))),s.reportFunc&&s.reportFunc(_,"request_end",{code:n,reportData:e,params:g,requestKV:p,files:t,polling:o}),u({data:r,polling_interval:i})}function v(e){var t=e.code,n=e.msg,r=(e.data,e.status_code);e=e.reportData,s.log.warn(a.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" unify "+t),s.reportFunc&&s.reportFunc(_,"request_end",{code:t,params:g,requestKV:p,reportData:e,polling:o}),l({code:t,msg:n,status_code:r})}if(s.reportFunc&&s.reportFunc(_,"request_start",{polling:o}),null!=(b=s.options)&&b.unify&&s.options.connection)if(void 0!==s.options.productNum){var y,S=[];for(y in d.param)void 0!==d.param[y]&&S.push({key:y,value:d.param[y]});var E={product:s.options.productNum,response_compress:f.INIT_CONFIG.compress?0:1,files:e,param_list:S,p_version:f.INIT_CONFIG.p_version},b=(s.log.info(a.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" files "+JSON.stringify(E.files)),s.options.online?1:2);s.sendCloudPBRequest(i,E,n,b,m,v)}else s.sendCloudRequest(i,d,"/cloud-setting/get",(function(e){m(e)}),(function(e){v(e)}));else s.options.urls&&c.fetch(s.options.urls,d,s.options.env||0).then((function(e){var t,n=e.code,r=(e.msg,e.data),i=e.polling_interval;e=e.reportData,s.log.info(a.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" "+n),r&&(t=[],Object.keys(r).forEach((function(e){var n;t.push({name:e,code:r[e].code,message:null==(n=r[e])?void 0:n.message,versions:JSON.stringify(null==(n=r[e])?void 0:n.versions),content:JSON.stringify(null==(e=r[e])?void 0:e.data)})}))),s.reportFunc&&s.reportFunc(_,"request_end",{code:n,reportData:e,params:g,requestKV:p,files:t,polling:o}),u({data:r,polling_interval:i})})).catch((function(e){var t=e.code,n=e.msg;e.data,e=e.reportData,s.log.warn(a.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" "+t),s.reportFunc&&s.reportFunc(_,"request_end",{code:t,params:g,requestKV:p,reportData:e,polling:o}),l({code:t,msg:n})}))}))},g.prototype.sendCloudRequest=function(e,t,n,i,a,c,l){var h=this,d=(void 0===c&&(c=3),void 0===l&&(l=[]),(new Date).getTime());this.sendNetAgentHttpRequest({service:o.SERVICE_ClOUD_SETTING,body:t,ack:!1,idName:e,method_no:s.METHOD_POST,location:n},(function(o){var s,f,p,g,_;200===(null==o?void 0:o.status_code)?(s=(g=JSON.parse(o.body)).code,_=g.message,f=g.data,p=g.polling_interval,g=(new Date).getTime()-d,l.push({timestamp:d,url:n,error:s,duration:g}),0===s?i({code:s,msg:_,data:f,polling_interval:p,reportData:l}):a({code:s,msg:_,reportData:l})):(_=(new Date).getTime()-d,l.push({timestamp:d,url:n,error:null==o?void 0:o.status_code,duration:_}),0<c?(c--,h.sendCloudRequest(e,t,n,i,a,c,l)):a(r(r({},u.errorList.FILE_REQUEST_FAIL),{reportData:l})))}),(function(o){var s=(new Date).getTime()-d;l.push({timestamp:d,url:n,error:o.code,duration:s}),0<c?(c--,h.sendCloudRequest(e,t,n,i,a,c,l)):a(r(r({},u.errorList.FILE_REQUEST_FAIL),{reportData:l}))}),null,{timeout:4e3})},g.prototype.sendNetAgentHttpRequest=function(e,t,n,r,i){r={param:e,suc:t,err:n,ack:r,option:i},null!=(i=this.options.connection)&&i.isConnect()?this.sendNetUintData(r):this.unSendCommandList.push(r)},g.prototype.sendNetUintData=function(e){var t=e.param,n=e.suc,r=e.err,i=e.ack,o=e.option;null!=(e=this.options.connection)&&e.startHttpRequest(t,n,r,i,o)},g.prototype.checkUnSendMsgs=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data&&t._data.param&&this.sendNetUintData(t._data),t=e.getFirst()},g.prototype.sendCloudPBRequest=function(e,t,n,i,o,c,l,d){var f,g=this,_=(void 0===l&&(l=3),void 0===d&&(d=[]),(new Date).getTime()),m=this.protobuf.encodeCloudSettingReq(t);null!=(f=this.options.connection)&&f.startHttpRequest2({interfaceID:14,body:m,ack:!1,idName:e,method:s.METHOD_POST,token:n,mode:i,reduceRspHeaders:!0},(function(s,f){if(200===(null==s?void 0:s.status_code)){var m=g.protobuf.decodeCloudSettingRsp(s.body),v=m.message,y=(m.data,m.polling_interval),S=m.code||0,E=(p.default.isLong(S)&&(S=S.toNumber()),(new Date).getTime()-_);if(d.push({timestamp:_,error:S,duration:E}),0===S){for(var b={},T=0;T<m.file_response.length;T++){var C=(A=m.file_response[T]).message,w=A.file_name,R=A.hash,I=A.g_version,k=A.json_data,O=(g.log.info(a.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" file rsp "+w+" "+I+" "+R.toString()),A.code||0);if(p.default.isLong(O)&&(O=O.toNumber()),A={},0<(null==R?void 0:R.byteLength)&&0<(null==k?void 0:k.byteLength))try{var N=0===t.response_compress?h.decodeCompressData(k):h.decodeString(k),A=JSON.parse(N)}catch(s){g.log.info(a.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" decode fail "+(null==s?void 0:s.message)?s.message:JSON.stringify(s))}b[w]={code:O,message:C,versions:{hash:R,g_version:I},data:A,hashChange:0===R.byteLength?0:1}}o({code:S,msg:v,data:b,polling_interval:y,reportData:d})}else c({code:S,msg:v,reportData:d})}else v=(new Date).getTime()-_,d.push({timestamp:_,error:null==s?void 0:s.status_code,duration:v}),0<l?(l--,g.sendCloudPBRequest(e,t,n,i,o,c,l,d)):c(r(r({},u.errorList.FILE_REQUEST_FAIL),{reportData:d,status_code:null==s?void 0:s.status_code}))}),(function(s){var a=(new Date).getTime()-_;d.push({timestamp:_,error:s.code,duration:a}),0<l?(l--,g.sendCloudPBRequest(e,t,n,i,o,c,l,d)):c(r(r({},u.errorList.FILE_REQUEST_FAIL),{reportData:d,status_code:null==s?void 0:s.status_code}))}),null,{timeout:4e3,extras:{protoCmd:"GetCloudSettingConfigRequest"}})},t.SettingFetchHandler=n=g},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.fetch=void 0,n(1));t.fetch=function e(t,n,o,s,a,u){return void 0===s&&(s=5),void 0===a&&(a=0),void 0===u&&(u=[]),new Promise((function(c,l){a=a||(new Date).getTime();var h,d,f,p=(new Date).getTime();0===o?(h=new XMLHttpRequest,d=t[(s+1)%2]||t[0],h.open("post",d),1==n.compress&&(h.responseType="arraybuffer"),h.ontimeout=function(){console.warn("The request for "+d+" timed out.")},h.onreadystatechange=function(){var f,g,_,m,v;4==h.readyState&&(200<=h.status&&h.status<300||304==h.status?(g=void 0,1!=n.compress&&(g=h.responseText),v=(new Date).getTime()-p,f=(_=JSON.parse(g)).code,m=_.message,g=_.data,_=_.polling_interval,u.push({timestamp:p,url:d,error:f,duration:v}),0===f?c({code:f,msg:m,data:g,polling_interval:_,reportData:u}):l({code:f,msg:m,reportData:u})):(m=(new Date).getTime()-p,u.push({timestamp:p,url:d,error:h.status,duration:m}),v=(new Date).getTime()-a,0<s&&v<8e3?e(t,n,o,--s,a,u).then((function(e){c(e)})).catch((function(e){l(e)})):l(r(r({},i.errorList.FILE_REQUEST_FAIL),{reportData:u}))))},h.timeout=8e3,h.send(JSON.stringify(n))):(f=t[(s+1)%2]||t[0],wx.request({url:f,data:n,method:"POST",success:function(h){console.log(h.data);var d=(m=h.data).code,g=m.message,_=m.data,m=m.polling_interval;void 0!==d?0===d?(console.log("post suc"),c({code:d,msg:g,data:_,polling_interval:m,reportData:u})):(console.error("post fail ",d,g),l({code:d,msg:g,reportData:u})):(g=(new Date).getTime()-p,u.push({timestamp:p,url:f,error:i.errorList.FILE_REQUEST_FAIL.code,msg:h.data,duration:g}),0<s?e(t,n,o,--s,a,u).then((function(e){c(e)})).catch((function(e){l(e)})):l(r(r({},i.errorList.FILE_REQUEST_FAIL),{reportData:u})))},fail:function(h){console.log("send failed "+JSON.stringify(h)+h.statusCode);var d=(new Date).getTime()-p;u.push({timestamp:p,url:f,error:i.errorList.FILE_REQUEST_FAIL.code,msg:h.errMsg,duration:d}),0<s?e(t,n,o,--s,a,u).then((function(e){c(e)})).catch((function(e){l(e)})):l(r(r({},i.errorList.FILE_REQUEST_FAIL),{reportData:u}))}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedList=t.ListNode=void 0,Object.defineProperty(i.prototype,"id",{get:function(){return this._id||null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),i.prototype.hasNext=function(){return this.next&&this.next.id},i.prototype.hasPrev=function(){return this.prev&&this.prev.id};var r=i;function i(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}function o(){this.start=new r,this.end=new r,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}t.ListNode=r,o.prototype.insertBefore=function(e,t){return(t=new r(this._idCounter,t)).next=e,t.prev=e.prev,e.prev&&(e.prev.next=t),e.prev=t,++this._idCounter,++this._numNodes,t},o.prototype.addLast=function(e){return this.insertBefore(this.end,e)},o.prototype.add=function(e){return this.addLast(e)},o.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},o.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},o.prototype.size=function(){return this._numNodes},o.prototype.getFromFirst=function(e){var t=0,n=this.start.next;if(0<=e)for(;t<e&&null!==n;)n=n.next,++t;else n=null;if(null===n)throw"Index out of bounds.";return n},o.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},o.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},o.prototype.removeFirst=function(){return 0<this._numNodes&&this.start.next?this.remove(this.start.next):null},o.prototype.removeLast=function(){return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):null},o.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},o.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},o.prototype.find=function(e){for(var t=this.start,n=!1,r=null;t.hasNext()&&!n;)e(t=t.next)&&(r=t,n=!0);return r},o.prototype.map=function(e){for(var t=this.start,n=[];t.hasNext();)e(t=t.next)&&n.push(t);return n},o.prototype.push=function(e){return this.addLast(e)},o.prototype.unshift=function(e){0<this._numNodes?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},o.prototype.pop=function(){return this.removeLast()},o.prototype.shift=function(){return this.removeFirst()},t.LinkedList=o},function(e,t,n){!function(e){"use strict";function t(e,t,n,r){var o=i,s=r+n;e^=-1;for(var a=r;a<s;a++)e=e>>>8^o[255&(e^t[a])];return-1^e}function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}var r=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,s=0;0!==n;){for(n-=s=2e3<n?2e3:n;o=o+(i=i+t[r++]|0)|0,--s;);i%=65521,o%=65521}return i|o<<16|0},i=new Uint32Array(function(){for(var e=[],t=0;t<256;t++){for(var n=t,r=0;r<8;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}()),o=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),s=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),a=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),u=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),c=function(e,t,n,r,i,c,l,h){var d,f,p,g,_,m,v,y,S,E=h.bits,b=0,T=0,C=0,w=0,R=0,I=0,k=0,O=0,N=0,A=0,L=null,P=0,M=new Uint16Array(16),D=new Uint16Array(16),x=null,U=0;for(b=0;b<=15;b++)M[b]=0;for(T=0;T<r;T++)M[t[n+T]]++;for(R=E,w=15;1<=w&&0===M[w];w--);if(w<R&&(R=w),0===w)i[c++]=20971520,i[c++]=20971520,h.bits=1;else{for(C=1;C<w&&0===M[C];C++);for(R<C&&(R=C),b=O=1;b<=15;b++)if((O=(O<<1)-M[b])<0)return-1;if(0<O&&(0===e||1!==w))return-1;for(D[1]=0,b=1;b<15;b++)D[b+1]=D[b]+M[b];for(T=0;T<r;T++)0!==t[n+T]&&(l[D[t[n+T]]++]=T);if(m=0===e?(L=x=l,19):1===e?(L=o,P-=257,x=s,U-=257,256):(L=a,x=u,-1),b=C,_=c,k=T=A=0,p=-1,g=(N=1<<(I=R))-1,1===e&&852<N||2===e&&592<N)return 1;for(;;){for(S=l[T]<m?(y=0,l[T]):l[T]>m?(y=x[U+l[T]],L[P+l[T]]):(y=96,0),d=1<<(v=b-k),C=f=1<<I;i[_+(A>>k)+(f-=d)]=v<<24|y<<16|S|0,0!==f;);for(d=1<<b-1;A&d;)d>>=1;if(A=0!==d?(A&d-1)+d:0,T++,0==--M[b]){if(b===w)break;b=t[n+l[T]]}if(R<b&&(A&g)!==p){for(_+=C,O=1<<(I=b-(k=0===k?R:k));I+k<w&&!((O-=M[I+k])<=0);)I++,O<<=1;if(N+=1<<I,1===e&&852<N||2===e&&592<N)return 1;i[p=A&g]=R<<24|I<<16|_-c|0}}0!==A&&(i[_+A]=b-k<<24|64<<16|0),h.bits=R}return 0},l={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},h=l.Z_FINISH,d=l.Z_BLOCK,f=l.Z_TREES,p=l.Z_OK,g=l.Z_STREAM_END,_=l.Z_NEED_DICT,m=l.Z_STREAM_ERROR,v=l.Z_DATA_ERROR,y=l.Z_MEM_ERROR,S=l.Z_BUF_ERROR,E=l.Z_DEFLATED;function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(e,i){var o,s,a,u,l,b,T,C,I,N,A,L,P,M,D,x,U,B,H,z,G,F,q,j,V=0,Y=new Uint8Array(4),W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return m;12===(o=e.state).mode&&(o.mode=13),l=e.next_out,a=e.output,T=e.avail_out,u=e.next_in,s=e.input,b=e.avail_in,C=o.hold,I=o.bits,N=b,A=T,F=p;e:for(;;)switch(o.mode){case 1:if(0===o.wrap)o.mode=13;else{for(;I<16;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}if(2&o.wrap&&35615===C)Y[o.check=0]=255&C,Y[1]=C>>>8&255,o.check=t(o.check,Y,2,0),I=C=0,o.mode=2;else if(o.flags=0,o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&C)<<8)+(C>>8))%31)e.msg="incorrect header check",o.mode=30;else if((15&C)!==E)e.msg="unknown compression method",o.mode=30;else{if(I-=4,G=8+(15&(C>>>=4)),0===o.wbits)o.wbits=G;else if(G>o.wbits){e.msg="invalid window size",o.mode=30;break}o.dmax=1<<o.wbits,e.adler=o.check=1,o.mode=512&C?10:12,I=C=0}}break;case 2:for(;I<16;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}if(o.flags=C,(255&o.flags)!==E){e.msg="unknown compression method",o.mode=30;break}if(57344&o.flags){e.msg="unknown header flags set",o.mode=30;break}o.head&&(o.head.text=C>>8&1),512&o.flags&&(Y[0]=255&C,Y[1]=C>>>8&255,o.check=t(o.check,Y,2,0)),I=C=0,o.mode=3;case 3:for(;I<32;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}o.head&&(o.head.time=C),512&o.flags&&(Y[0]=255&C,Y[1]=C>>>8&255,Y[2]=C>>>16&255,Y[3]=C>>>24&255,o.check=t(o.check,Y,4,0)),I=C=0,o.mode=4;case 4:for(;I<16;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}o.head&&(o.head.xflags=255&C,o.head.os=C>>8),512&o.flags&&(Y[0]=255&C,Y[1]=C>>>8&255,o.check=t(o.check,Y,2,0)),I=C=0,o.mode=5;case 5:if(1024&o.flags){for(;I<16;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}o.length=C,o.head&&(o.head.extra_len=C),512&o.flags&&(Y[0]=255&C,Y[1]=C>>>8&255,o.check=t(o.check,Y,2,0)),I=C=0}else o.head&&(o.head.extra=null);o.mode=6;case 6:if(1024&o.flags&&((L=(L=o.length)>b?b:L)&&(o.head&&(G=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(s.subarray(u,u+L),G)),512&o.flags&&(o.check=t(o.check,s,L,u)),b-=L,u+=L,o.length-=L),o.length))break e;o.length=0,o.mode=7;case 7:if(2048&o.flags){if(0===b)break e;for(L=0;G=s[u+L++],o.head&&G&&o.length<65536&&(o.head.name+=String.fromCharCode(G)),G&&L<b;);if(512&o.flags&&(o.check=t(o.check,s,L,u)),b-=L,u+=L,G)break e}else o.head&&(o.head.name=null);o.length=0,o.mode=8;case 8:if(4096&o.flags){if(0===b)break e;for(L=0;G=s[u+L++],o.head&&G&&o.length<65536&&(o.head.comment+=String.fromCharCode(G)),G&&L<b;);if(512&o.flags&&(o.check=t(o.check,s,L,u)),b-=L,u+=L,G)break e}else o.head&&(o.head.comment=null);o.mode=9;case 9:if(512&o.flags){for(;I<16;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}if(C!==(65535&o.check)){e.msg="header crc mismatch",o.mode=30;break}I=C=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),e.adler=o.check=0,o.mode=12;break;case 10:for(;I<32;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}e.adler=o.check=n(C),I=C=0,o.mode=11;case 11:if(0===o.havedict)return e.next_out=l,e.avail_out=T,e.next_in=u,e.avail_in=b,o.hold=C,o.bits=I,_;e.adler=o.check=1,o.mode=12;case 12:if(i===d||i===f)break e;case 13:if(o.last)C>>>=7&I,I-=7&I,o.mode=27;else{for(;I<3;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}switch(o.last=1&C,--I,3&(C>>>=1)){case 0:o.mode=14;break;case 1:K=void 0;var Z=o;if(k){w=new Int32Array(512),R=new Int32Array(32);for(var K=0;K<144;)Z.lens[K++]=8;for(;K<256;)Z.lens[K++]=9;for(;K<280;)Z.lens[K++]=7;for(;K<288;)Z.lens[K++]=8;for(c(1,Z.lens,0,288,w,0,Z.work,{bits:9}),K=0;K<32;)Z.lens[K++]=5;c(2,Z.lens,0,32,R,0,Z.work,{bits:5}),k=!1}if(Z.lencode=w,Z.lenbits=9,Z.distcode=R,Z.distbits=5,o.mode=20,i!==f)break;C>>>=2,I-=2;break e;case 2:o.mode=17;break;case 3:e.msg="invalid block type",o.mode=30}C>>>=2,I-=2}break;case 14:for(C>>>=7&I,I-=7&I;I<32;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}if((65535&C)!=(C>>>16^65535)){e.msg="invalid stored block lengths",o.mode=30;break}if(o.length=65535&C,I=C=0,o.mode=15,i===f)break e;case 15:o.mode=16;case 16:if(L=o.length){if(0===(L=T<(L=b<L?b:L)?T:L))break e;a.set(s.subarray(u,u+L),l),b-=L,u+=L,T-=L,l+=L,o.length-=L}else o.mode=12;break;case 17:for(;I<14;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}if(o.nlen=257+(31&C),C>>>=5,I-=5,o.ndist=1+(31&C),C>>>=5,I-=5,o.ncode=4+(15&C),C>>>=4,I-=4,286<o.nlen||30<o.ndist){e.msg="too many length or distance symbols",o.mode=30;break}o.have=0,o.mode=18;case 18:for(;o.have<o.ncode;){for(;I<3;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}o.lens[W[o.have++]]=7&C,C>>>=3,I-=3}for(;o.have<19;)o.lens[W[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,q={bits:o.lenbits},F=c(0,o.lens,0,19,o.lencode,0,o.work,q),o.lenbits=q.bits,F){e.msg="invalid code lengths set",o.mode=30;break}o.have=0,o.mode=19;case 19:for(;o.have<o.nlen+o.ndist;){for(;x=(V=o.lencode[C&(1<<o.lenbits)-1])>>>16&255,U=65535&V,!((D=V>>>24)<=I);){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}if(U<16)C>>>=D,I-=D,o.lens[o.have++]=U;else{if(16===U){for(j=D+2;I<j;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}if(C>>>=D,I-=D,0===o.have){e.msg="invalid bit length repeat",o.mode=30;break}G=o.lens[o.have-1],L=3+(3&C),C>>>=2,I-=2}else if(17===U){for(j=D+3;I<j;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}G=0,L=3+(7&(C>>>=D)),C>>>=3,I=I-D-3}else{for(j=D+7;I<j;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}G=0,L=11+(127&(C>>>=D)),C>>>=7,I=I-D-7}if(o.have+L>o.nlen+o.ndist){e.msg="invalid bit length repeat",o.mode=30;break}for(;L--;)o.lens[o.have++]=G}}if(30===o.mode)break;if(0===o.lens[256]){e.msg="invalid code -- missing end-of-block",o.mode=30;break}if(o.lenbits=9,q={bits:o.lenbits},F=c(1,o.lens,0,o.nlen,o.lencode,0,o.work,q),o.lenbits=q.bits,F){e.msg="invalid literal/lengths set",o.mode=30;break}if(o.distbits=6,o.distcode=o.distdyn,q={bits:o.distbits},F=c(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,q),o.distbits=q.bits,F){e.msg="invalid distances set",o.mode=30;break}if(o.mode=20,i===f)break e;case 20:o.mode=21;case 21:if(6<=b&&258<=T){e.next_out=l,e.avail_out=T,e.next_in=u,e.avail_in=b,o.hold=C,o.bits=I,ie=ce=te=ee=J=Q=X=$=ve=me=ue=oe=void 0;var $,X,Q,J,ee,te,ne=e,re=A,ie=ne.state,oe=ne.next_in,se=ne.input,ae=oe+(ne.avail_in-5),ue=ne.next_out,ce=ne.output,le=ue-(re-ne.avail_out),he=ue+(ne.avail_out-257),de=ie.dmax,fe=ie.wsize,pe=ie.whave,ge=ie.wnext,_e=ie.window,me=ie.hold,ve=ie.bits,ye=ie.lencode,Se=ie.distcode,Ee=(1<<ie.lenbits)-1,be=(1<<ie.distbits)-1;t:do{for(ve<15&&(me+=se[oe++]<<ve,ve+=8,me+=se[oe++]<<ve,ve+=8),$=ye[me&Ee];;){if(me>>>=X=$>>>24,ve-=X,0==(X=$>>>16&255))ce[ue++]=65535&$;else{if(!(16&X)){if(0==(64&X)){$=ye[(65535&$)+(me&(1<<X)-1)];continue}if(32&X){ie.mode=12;break t}ne.msg="invalid literal/length code",ie.mode=30;break t}for(Q=65535&$,(X&=15)&&(ve<X&&(me+=se[oe++]<<ve,ve+=8),Q+=me&(1<<X)-1,me>>>=X,ve-=X),ve<15&&(me+=se[oe++]<<ve,ve+=8,me+=se[oe++]<<ve,ve+=8),$=Se[me&be];;){if(me>>>=X=$>>>24,ve-=X,!(16&(X=$>>>16&255))){if(0==(64&X)){$=Se[(65535&$)+(me&(1<<X)-1)];continue}ne.msg="invalid distance code",ie.mode=30;break t}if(J=65535&$,ve<(X&=15)&&(me+=se[oe++]<<ve,(ve+=8)<X)&&(me+=se[oe++]<<ve,ve+=8),(J+=me&(1<<X)-1)>de){ne.msg="invalid distance too far back",ie.mode=30;break t}if(me>>>=X,ve-=X,J>(X=ue-le)){if((X=J-X)>pe&&ie.sane){ne.msg="invalid distance too far back",ie.mode=30;break t}if(te=_e,(ee=0)===ge){if(ee+=fe-X,X<Q){for(Q-=X;ce[ue++]=_e[ee++],--X;);ee=ue-J,te=ce}}else if(ge<X){if(ee+=fe+ge-X,(X-=ge)<Q){for(Q-=X;ce[ue++]=_e[ee++],--X;);if(ee=0,ge<Q){for(Q-=X=ge;ce[ue++]=_e[ee++],--X;);ee=ue-J,te=ce}}}else if(ee+=ge-X,X<Q){for(Q-=X;ce[ue++]=_e[ee++],--X;);ee=ue-J,te=ce}for(;2<Q;)ce[ue++]=te[ee++],ce[ue++]=te[ee++],ce[ue++]=te[ee++],Q-=3;Q&&(ce[ue++]=te[ee++],1<Q)&&(ce[ue++]=te[ee++])}else{for(ee=ue-J;ce[ue++]=ce[ee++],ce[ue++]=ce[ee++],ce[ue++]=ce[ee++],2<(Q-=3););Q&&(ce[ue++]=ce[ee++],1<Q)&&(ce[ue++]=ce[ee++])}break}}break}}while(oe<ae&&ue<he);oe-=Q=ve>>3,me&=(1<<(ve-=Q<<3))-1,ne.next_in=oe,ne.next_out=ue,ne.avail_in=oe<ae?ae-oe+5:5-(oe-ae),ne.avail_out=ue<he?he-ue+257:257-(ue-he),ie.hold=me,ie.bits=ve,l=e.next_out,a=e.output,T=e.avail_out,u=e.next_in,s=e.input,b=e.avail_in,C=o.hold,I=o.bits,12===o.mode&&(o.back=-1);break}for(o.back=0;x=(V=o.lencode[C&(1<<o.lenbits)-1])>>>16&255,U=65535&V,!((D=V>>>24)<=I);){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}if(x&&0==(240&x)){for(B=D,H=x,z=U;x=(V=o.lencode[z+((C&(1<<B+H)-1)>>B)])>>>16&255,U=65535&V,!(B+(D=V>>>24)<=I);){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}C>>>=B,I-=B,o.back+=B}if(C>>>=D,I-=D,o.back+=D,o.length=U,0===x){o.mode=26;break}if(32&x){o.back=-1,o.mode=12;break}if(64&x){e.msg="invalid literal/length code",o.mode=30;break}o.extra=15&x,o.mode=22;case 22:if(o.extra){for(j=o.extra;I<j;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}o.length+=C&(1<<o.extra)-1,C>>>=o.extra,I-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=23;case 23:for(;x=(V=o.distcode[C&(1<<o.distbits)-1])>>>16&255,U=65535&V,!((D=V>>>24)<=I);){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}if(0==(240&x)){for(B=D,H=x,z=U;x=(V=o.distcode[z+((C&(1<<B+H)-1)>>B)])>>>16&255,U=65535&V,!(B+(D=V>>>24)<=I);){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}C>>>=B,I-=B,o.back+=B}if(C>>>=D,I-=D,o.back+=D,64&x){e.msg="invalid distance code",o.mode=30;break}o.offset=U,o.extra=15&x,o.mode=24;case 24:if(o.extra){for(j=o.extra;I<j;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}o.offset+=C&(1<<o.extra)-1,C>>>=o.extra,I-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){e.msg="invalid distance too far back",o.mode=30;break}o.mode=25;case 25:if(0===T)break e;if(o.offset>(L=A-T)){if((L=o.offset-L)>o.whave&&o.sane){e.msg="invalid distance too far back",o.mode=30;break}P=L>o.wnext?(L-=o.wnext,o.wsize-L):o.wnext-L,L>o.length&&(L=o.length),M=o.window}else M=a,P=l-o.offset,L=o.length;for(T-=L=T<L?T:L,o.length-=L;a[l++]=M[P++],--L;);0===o.length&&(o.mode=21);break;case 26:if(0===T)break e;a[l++]=o.length,T--,o.mode=21;break;case 27:if(o.wrap){for(;I<32;){if(0===b)break e;b--,C|=s[u++]<<I,I+=8}if(A-=T,e.total_out+=A,o.total+=A,A&&(e.adler=o.check=(o.flags?t:r)(o.check,a,A,l-A)),A=T,(o.flags?C:n(C))!==o.check){e.msg="incorrect data check",o.mode=30;break}I=C=0}o.mode=28;case 28:if(o.wrap&&o.flags){for(;I<32;){if(0===b)break e;b--,C+=s[u++]<<I,I+=8}if(C!==(4294967295&o.total)){e.msg="incorrect length check",o.mode=30;break}I=C=0}o.mode=29;case 29:F=g;break e;case 30:F=v;break e;case 31:return y;default:return m}return e.next_out=l,e.avail_out=T,e.next_in=u,e.avail_in=b,o.hold=C,o.bits=I,(o.wsize||A!==e.avail_out&&o.mode<30&&(o.mode<27||i!==h))&&O(e,e.output,e.next_out,A-e.avail_out),N-=e.avail_in,A-=e.avail_out,e.total_in+=N,e.total_out+=A,o.total+=A,o.wrap&&A&&(e.adler=o.check=(o.flags?t:r)(o.check,a,A,e.next_out-A)),e.data_type=o.bits+(o.last?64:0)+(12===o.mode?128:0)+(20===o.mode||15===o.mode?256:0),(0==N&&0===A||i===h)&&F===p?S:F}function C(e,t){var n,i=t.length;return!e||!e.state||0!==(n=e.state).wrap&&11!==n.mode?m:11===n.mode&&r(1,t,i,0)!==n.check?v:O(e,t,i,i)?(n.mode=31,y):(n.havedict=1,p)}var w,R,I=function(e){var t;return e&&e.state&&((t=e.state).wsize=0,t.whave=0,t.wnext=0,t=e)&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,p):m},k=!0,O=function(e,t,n,r){var i;return null===(e=e.state).window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new Uint8Array(e.wsize)),r>=e.wsize?(e.window.set(t.subarray(n-e.wsize,n),0),e.wnext=0,e.whave=e.wsize):((i=e.wsize-e.wnext)>r&&(i=r),e.window.set(t.subarray(n-r,n-r+i),e.wnext),(r-=i)?(e.window.set(t.subarray(n-r,n),0),e.wnext=r,e.whave=e.wsize):(e.wnext+=i,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=i))),0},N=I,A=function(e,t){var n,r,i;return e?(n=new b,(e.state=n).window=null,n=t,(i=!(t=e)||!t.state||(i=t.state,n<0?(r=0,n=-n):(r=1+(n>>4),n<48&&(n&=15)),n&&(n<8||15<n))?m:(null!==i.window&&i.wbits!==n&&(i.window=null),i.wrap=r,i.wbits=n,I(t)))!==p&&(e.state=null),i):m};function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var P=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){P=!1}for(var M=new Uint8Array(256),D=0;D<256;D++)M[D]=252<=D?6:248<=D?5:240<=D?4:224<=D?3:192<=D?2:1;function x(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function U(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}M[254]=M[254]=1;var B={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},H=Object.prototype.toString,z=l.Z_NO_FLUSH,G=l.Z_FINISH,F=l.Z_OK,q=l.Z_STREAM_END,j=l.Z_NEED_DICT,V=l.Z_STREAM_ERROR,Y=l.Z_DATA_ERROR,W=l.Z_MEM_ERROR;function Z(e){this.options=function(e){for(var t,n,r=Array.prototype.slice.call(arguments,1);r.length;){var i=r.shift();if(i){if("object"!==L(i))throw new TypeError(i+"must be non-object");for(var o in i)t=i,n=o,Object.prototype.hasOwnProperty.call(t,n)&&(e[o]=i[o])}}return e}({chunkSize:65536,windowBits:15,to:""},e||{});var t,n,r=this.options;if((e=(r.raw&&0<=r.windowBits&&r.windowBits<16&&(r.windowBits=-r.windowBits,0===r.windowBits)&&(r.windowBits=-15),!(0<=r.windowBits&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),15<r.windowBits&&r.windowBits<48&&0==(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new x,this.strm.avail_out=0,A(this.strm,r.windowBits)))!==F)throw new Error(B[e]);if(this.header=new U,t=this.strm,n=this.header,!t||!t.state||0==(2&(t=t.state).wrap)||((t.head=n).done=!1),r.dictionary&&("string"==typeof r.dictionary?r.dictionary=function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);for(var t,n,r,i,o=e.length,s=0,a=0;a<o;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=i=0;i<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),n<128?t[i++]=n:(n<2048?t[i++]=192|n>>>6:(n<65536?t[i++]=224|n>>>12:(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63),t[i++]=128|n>>>6&63),t[i++]=128|63&n);return t}(r.dictionary):"[object ArrayBuffer]"===H.call(r.dictionary)&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw)&&(e=C(this.strm,r.dictionary))!==F)throw new Error(B[e])}function K(e,t){if((t=new Z(t)).push(e),t.err)throw t.msg||B[t.err];return t.result}function $(e,t){return(t=t||{}).raw=!0,K(e,t)}Z.prototype.push=function(e,t){var n,r,i=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(r=t===~~t?t:!0===t?G:z,"[object ArrayBuffer]"===H.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(n=T(i,r))===j&&s&&((n=C(i,s))===F?n=T(i,r):n===Y&&(n=j));0<i.avail_in&&n===q&&0<i.state.wrap&&0!==e[i.next_in];)N(i),n=T(i,r);switch(n){case V:case Y:case j:case W:return this.onEnd(n),!(this.ended=!0)}var a,u,c,l=i.avail_out;if(!i.next_out||0!==i.avail_out&&n!==q||("string"===this.options.to?(a=function(e,t){for(var n=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=n&&128==(192&e[n]);)n--;return!(n<0||0===n)&&n+M[e[n]]>t?n:t}(i.output,i.next_out),u=i.next_out-a,c=function(e,t){var n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));for(var r=new Array(2*n),i=0,o=0;o<n;){var s=e[o++];if(s<128)r[i++]=s;else{var a=M[s];if(4<a)r[i++]=65533,o+=a-1;else{for(s&=2===a?31:3===a?15:7;1<a&&o<n;)s=s<<6|63&e[o++],a--;1<a?r[i++]=65533:s<65536?r[i++]=s:(s-=65536,r[i++]=55296|s>>10&1023,r[i++]=56320|1023&s)}}}var u=r,c=i;if(c<65534&&u.subarray&&P)return String.fromCharCode.apply(null,u.length===c?u:u.subarray(0,c));for(var l="",h=0;h<c;h++)l+=String.fromCharCode(u[h]);return l}(i.output,a),i.next_out=u,i.avail_out=o-u,u&&i.output.set(i.output.subarray(a,a+u),0),this.onData(c)):this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out))),n!==F||0!==l){if(n===q)return u=void 0,n=(a=this.strm)&&a.state?((u=a.state).window&&(u.window=null),a.state=null,p):m,this.onEnd(n),this.ended=!0;if(0===i.avail_in)break}}return!0},Z.prototype.onData=function(e){this.chunks.push(e)},Z.prototype.onEnd=function(e){e===F&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n].length;for(var i=new Uint8Array(t),o=0,s=0,a=e.length;o<a;o++){var u=e[o];i.set(u,s),s+=u.length}return i}(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var X=K,Q=K,J={Inflate:Z,inflate:X,inflateRaw:$,ungzip:Q,constants:l};e.Inflate=Z,e.constants=l,e.default=J,e.inflate=X,e.inflateRaw=$,e.ungzip=Q,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){e[r=void 0===r?n:r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},a=(Object.defineProperty(t,"__esModule",{value:!0}),t.CloudSettingProtoBuf=void 0,s=s(n(5)),o=o(n(6)),n(18));function u(){}o.util.Long=s.default,o.configure(),u.prototype.encodeCloudSettingReq=function(e){return e=a.cloudsetting.GetCloudSettingConfigRequest.create(e),a.cloudsetting.GetCloudSettingConfigRequest.encode(e).finish()},u.prototype.decodeCloudSettingRsp=function(e){return a.cloudsetting.GetCloudSettingConfigResponse.decode(e)},t.CloudSettingProtoBuf=o=u},function(e,t,n){"use strict";var r,i=n(6),o=i.Reader,s=i.Writer,a=i.util,u=i.roots.default||(i.roots.default={});function c(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function l(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function h(e){if(this.file_list=[],this.param_list=[],this.files=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function d(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function f(e){if(this.file_response=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}u.cloudsetting=((r={}).Product=(n={},(i=Object.create(n))[n[0]="RTC"]=0,i[n[1]="WEB_RTC"]=1,i[n[2]="ZIM"]=2,i[n[3]="ROOM_KIT"]=3,i[n[4]="DOC_SHARE"]=4,i[n[5]="WHITE_BOARD"]=5,i[n[999]="SELF_CHECK"]=999,i[n[1e3]="TEST_ANOOUS"]=1e3,i),r.Param=(c.prototype.key="",c.prototype.value="",c.create=function(e){return new c(e)},c.encode=function(e,t){return t=t||s.create(),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},c.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.cloudsetting.Param;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},c),r.File=(l.prototype.file_name="",l.prototype.hash=a.newBuffer([]),l.prototype.g_version=0,l.create=function(e){return new l(e)},l.encode=function(e,t){return t=t||s.create(),null!=e.file_name&&Object.hasOwnProperty.call(e,"file_name")&&t.uint32(10).string(e.file_name),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.g_version&&Object.hasOwnProperty.call(e,"g_version")&&t.uint32(24).uint32(e.g_version),t},l.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.cloudsetting.File;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.file_name=e.string();break;case 2:r.hash=e.bytes();break;case 3:r.g_version=e.uint32();break;default:e.skipType(7&i)}}return r},l),r.GetCloudSettingConfigRequest=(h.prototype.product=0,h.prototype.response_compress=0,h.prototype.file_list=a.emptyArray,h.prototype.param_list=a.emptyArray,h.prototype.files=a.emptyArray,h.prototype.p_version=0,h.create=function(e){return new h(e)},h.encode=function(e,t){if(t=t||s.create(),null!=e.product&&Object.hasOwnProperty.call(e,"product")&&t.uint32(8).int32(e.product),null!=e.response_compress&&Object.hasOwnProperty.call(e,"response_compress")&&t.uint32(16).int32(e.response_compress),null!=e.file_list&&e.file_list.length)for(var n=0;n<e.file_list.length;++n)t.uint32(26).string(e.file_list[n]);if(null!=e.param_list&&e.param_list.length)for(n=0;n<e.param_list.length;++n)u.cloudsetting.Param.encode(e.param_list[n],t.uint32(34).fork()).ldelim();if(null!=e.files&&e.files.length)for(n=0;n<e.files.length;++n)u.cloudsetting.File.encode(e.files[n],t.uint32(42).fork()).ldelim();return null!=e.p_version&&Object.hasOwnProperty.call(e,"p_version")&&t.uint32(48).uint32(e.p_version),t},h.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.cloudsetting.GetCloudSettingConfigRequest;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.product=e.int32();break;case 2:r.response_compress=e.int32();break;case 3:r.file_list&&r.file_list.length||(r.file_list=[]),r.file_list.push(e.string());break;case 4:r.param_list&&r.param_list.length||(r.param_list=[]),r.param_list.push(u.cloudsetting.Param.decode(e,e.uint32()));break;case 5:r.files&&r.files.length||(r.files=[]),r.files.push(u.cloudsetting.File.decode(e,e.uint32()));break;case 6:r.p_version=e.uint32();break;default:e.skipType(7&i)}}return r},h),r.CloudSettingFileResponse=(d.prototype.code=a.Long?a.Long.fromBits(0,0,!1):0,d.prototype.message="",d.prototype.file_name="",d.prototype.global_version="",d.prototype.version="",d.prototype.app_version="",d.prototype.json_data=a.newBuffer([]),d.prototype.hash=a.newBuffer([]),d.prototype.g_version=0,d.create=function(e){return new d(e)},d.encode=function(e,t){return t=t||s.create(),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).int64(e.code),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(18).string(e.message),null!=e.file_name&&Object.hasOwnProperty.call(e,"file_name")&&t.uint32(26).string(e.file_name),null!=e.global_version&&Object.hasOwnProperty.call(e,"global_version")&&t.uint32(34).string(e.global_version),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(42).string(e.version),null!=e.app_version&&Object.hasOwnProperty.call(e,"app_version")&&t.uint32(50).string(e.app_version),null!=e.json_data&&Object.hasOwnProperty.call(e,"json_data")&&t.uint32(58).bytes(e.json_data),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(66).bytes(e.hash),null!=e.g_version&&Object.hasOwnProperty.call(e,"g_version")&&t.uint32(72).uint32(e.g_version),t},d.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.cloudsetting.CloudSettingFileResponse;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.code=e.int64();break;case 2:r.message=e.string();break;case 3:r.file_name=e.string();break;case 4:r.global_version=e.string();break;case 5:r.version=e.string();break;case 6:r.app_version=e.string();break;case 7:r.json_data=e.bytes();break;case 8:r.hash=e.bytes();break;case 9:r.g_version=e.uint32();break;default:e.skipType(7&i)}}return r},d),r.GetCloudSettingConfigResponse=(f.prototype.code=a.Long?a.Long.fromBits(0,0,!1):0,f.prototype.message="",f.prototype.polling_interval=0,f.prototype.file_response=a.emptyArray,f.create=function(e){return new f(e)},f.encode=function(e,t){if(t=t||s.create(),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).int64(e.code),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(18).string(e.message),null!=e.polling_interval&&Object.hasOwnProperty.call(e,"polling_interval")&&t.uint32(24).int32(e.polling_interval),null!=e.file_response&&e.file_response.length)for(var n=0;n<e.file_response.length;++n)u.cloudsetting.CloudSettingFileResponse.encode(e.file_response[n],t.uint32(34).fork()).ldelim();return t},f.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.cloudsetting.GetCloudSettingConfigResponse;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.code=e.int64();break;case 2:r.message=e.string();break;case 3:r.polling_interval=e.int32();break;case 4:r.file_response&&r.file_response.length||(r.file_response=[]),r.file_response.push(u.cloudsetting.CloudSettingFileResponse.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},f),r),e.exports=u}],r.c=u,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8))},function(e,t,n){var r;e.exports=(r=n(1),function(){var e,t;"function"==typeof ArrayBuffer&&(e=r.lib.WordArray,t=e.init,(e.init=function(e){if((e=(e=e instanceof ArrayBuffer?new Uint8Array(e):e)instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e)instanceof Uint8Array){for(var n=e.byteLength,r=[],i=0;i<n;i++)r[i>>>2]|=e[i]<<24-i%4*8;t.call(this,r,n)}else t.apply(this,arguments)}).prototype=e)}(),r.lib.WordArray)},function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){},function(e,t,n){var r;e.exports=(e=n(1),r=e.lib.WordArray,e.enc.Base64={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=this._map,i=(e.clamp(),[]),o=0;o<n;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<n;a++)i.push(r.charAt(s>>>6*(3-a)&63));var u=r.charAt(64);if(u)for(;i.length%4;)i.push(u);return i.join("")},parse:function(e){var t=e.length,n=this._map;if(!(i=this._reverseMap))for(var i=this._reverseMap=[],o=0;o<n.length;o++)i[n.charCodeAt(o)]=o;var s=n.charAt(64);return s&&-1!==(s=e.indexOf(s))&&(t=s),function(e,t,n){for(var i,o,s=[],a=0,u=0;u<t;u++)u%4&&(i=n[e.charCodeAt(u-1)]<<u%4*2,o=n[e.charCodeAt(u)]>>>6-u%4*2,s[a>>>2]|=(i|o)<<24-a%4*8,a++);return r.create(s,a)}(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},e.enc.Base64)},function(e,t,n){var r,i,o,s;e.exports=(e=n(1),s=(n=e).lib,r=s.WordArray,i=s.Hasher,s=n.algo,o=[],s=s.SHA1=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],a=n[3],u=n[4],c=0;c<80;c++){c<16?o[c]=0|e[t+c]:(l=o[c-3]^o[c-8]^o[c-14]^o[c-16],o[c]=l<<1|l>>>31);var l=(r<<5|r>>>27)+u+o[c];l+=c<20?1518500249+(i&s|~i&a):c<40?1859775393+(i^s^a):c<60?(i&s|i&a|s&a)-1894007588:(i^s^a)-899497514,u=a,a=s,s=i<<30|i>>>2,i=r,r=l}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(64+r>>>9<<4)]=Math.floor(n/4294967296),t[15+(64+r>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}}),n.SHA1=i._createHelper(s),n.HmacSHA1=i._createHmacHelper(s),e.SHA1)},function(e,t,n){var r;e.exports=(e=n(1),n=e.lib.Base,r=e.enc.Utf8,void(e.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));for(var n=e.blockSize,i=4*n,o=(e=((t=t.sigBytes>i?e.finalize(t):t).clamp(),this._oKey=t.clone()),t=this._iKey=t.clone(),e.words),s=t.words,a=0;a<n;a++)o[a]^=1549556828,s[a]^=909522486;e.sigBytes=t.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;e=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(e))}})))},function(e,t,n){var r,i,o,s,a,u,c,l,h,d,f,p;e.exports=(e=n(1),n(9),void(e.lib.Cipher||(n=e.lib,r=n.Base,i=n.WordArray,o=n.BufferedBlockAlgorithm,(h=e.enc).Utf8,s=h.Base64,a=e.algo.EvpKDF,u=n.Cipher=o.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?p:d}return function(t){return{encrypt:function(n,r,i){return e(r).encrypt(t,n,r,i)},decrypt:function(n,r,i){return e(r).decrypt(t,n,r,i)}}}}()}),n.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h=e.mode={},c=n.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),h=h.CBC=function(){var e=c.extend();function t(e,t,n){var r,i=this._iv;i?(r=i,this._iv=void 0):r=this._prevBlock;for(var o=0;o<n;o++)e[t+o]^=r[o]}return e.Encryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize;t.call(this,e,n,i),r.encryptBlock(e,n),this._prevBlock=e.slice(n,n+i)}}),e.Decryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize,o=e.slice(n,n+i);r.decryptBlock(e,n),t.call(this,e,n,i),this._prevBlock=o}}),e}(),f=(e.pad={}).Pkcs7={pad:function(e,t){for(var n=(t=4*t)-e.sigBytes%t,r=n<<24|n<<16|n<<8|n,o=[],s=0;s<n;s+=4)o.push(r);t=i.create(o,n),e.concat(t)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.BlockCipher=u.extend({cfg:u.cfg.extend({mode:h,padding:f}),reset:function(){u.reset.call(this);var e,t=(n=this.cfg).iv,n=n.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,t&&t.words):(this._mode=e.call(n,this,t&&t.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),l=n.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),h=(e.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return(e=(e=e.salt)?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)},parse:function(e){var t,n=(e=s.parse(e)).words;return 1398893684==n[0]&&1701076831==n[1]&&(t=i.create(n.slice(2,4)),n.splice(0,4),e.sigBytes-=16),l.create({ciphertext:e,salt:t})}},d=n.SerializableCipher=r.extend({cfg:r.extend({format:h}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);t=(i=e.createEncryptor(n,r)).finalize(t);var i=i.cfg;return l.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),f=(e.kdf={}).OpenSSL={execute:function(e,t,n,r){return r=r||i.random(8),e=a.create({keySize:t+n}).compute(e,r),n=i.create(e.words.slice(t),4*n),e.sigBytes=4*t,l.create({key:e,iv:n,salt:r})}},p=n.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:f}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=d.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,d.decrypt.call(this,e,t,n.key,r)}}))))},function(e,t,n){"use strict";n.r(t),n.d(t,"ZegoExpressWebRTMEngine",(function(){return Zn})),n.d(t,"getReportSeq",(function(){return p})),n.d(t,"getSeq",(function(){return f})),n.d(t,"ZegoLogger",(function(){return i.ZegoLogger})),n.d(t,"ZegoDataReport",(function(){return i.ZegoDataReport})),n.d(t,"ZegoExpressWebRTM",(function(){return Bn})),n.d(t,"BusinessService",(function(){return T})),n.d(t,"NetConnection",(function(){return I})),n.d(t,"ZReporter",(function(){return Yn}));var r,i=n(3);(t=r=r||{})[t.SWITCH_ONE=1]="SWITCH_ONE",t[t.SWITCH_TWO=2]="SWITCH_TWO";var o,s,a,u,c,l,h,d,f=((t=o=o||{})[t.TT_NONE=0]="TT_NONE",t[t.TT_PC=1]="TT_PC",t[t.TT_IOS=2]="TT_IOS",t[t.TT_ANDROID=3]="TT_ANDROID",t[t.TT_MAC=4]="TT_MAC",t[t.TT_LINUX=5]="TT_LINUX",t[t.TT_WEB=6]="TT_WEB",t[t.TT_MINIPROGRAM=7]="TT_MINIPROGRAM",t[t.TT_UNKNOWN=32]="TT_UNKNOWN",(t=s=s||{})[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login",(t=a=a||{})[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L",(t=u=u||{})[t.offline=0]="offline",t[t.online=1]="online",(t=c=c||{})[t.NT_NONE=0]="NT_NONE",t[t.NT_LINE=1]="NT_LINE",t[t.NT_WIFI=2]="NT_WIFI",t[t.NT_2G=3]="NT_2G",t[t.NT_3G=4]="NT_3G",t[t.NT_4G=5]="NT_4G",t[t.NT_UNKNOWN=32]="NT_UNKNOWN",(t=l=l||{})[t.ClientType_None=0]="ClientType_None",t[t.ClientType_H5=1]="ClientType_H5",t[t.ClientType_SmallProgram=2]="ClientType_SmallProgram",t[t.ClientType_Webrtc=3]="ClientType_Webrtc",function(){return h++}),p=(d=h=1,function(){return d++}),g=(Object.defineProperty(_.prototype,"id",{get:function(){return this._id||null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),_.prototype.hasNext=function(){return this.next&&this.next.id},_.prototype.hasPrev=function(){return this.prev&&this.prev.id},_);function _(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}v.prototype.insertBefore=function(e,t){return(t=new g(this._idCounter,t)).next=e,t.prev=e.prev,e.prev&&(e.prev.next=t),e.prev=t,++this._idCounter,++this._numNodes,t},v.prototype.addLast=function(e){return this.insertBefore(this.end,e)},v.prototype.add=function(e){return this.addLast(e)},v.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},v.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},v.prototype.size=function(){return this._numNodes},v.prototype.getFromFirst=function(e){var t=0,n=this.start.next;if(0<=e)for(;t<e&&null!==n;)n=n.next,++t;else n=null;if(null===n)throw"Index out of bounds.";return n},v.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},v.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},v.prototype.removeFirst=function(){var e=null;return 0<this._numNodes&&this.start.next?this.remove(this.start.next):e},v.prototype.removeLast=function(){var e=null;return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):e},v.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},v.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},v.prototype.find=function(e){for(var t=this.start,n=!1,r=null;t.hasNext()&&!n;)e(t=t.next)&&(r=t,n=!0);return r},v.prototype.map=function(e){for(var t=this.start,n=[];t.hasNext();)e(t=t.next)&&n.push(t);return n},v.prototype.push=function(e){return this.addLast(e)},v.prototype.unshift=function(e){0<this._numNodes?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},v.prototype.pop=function(){return this.removeLast()},v.prototype.shift=function(){return this.removeFirst()};var m=v;function v(){this.start=new g,this.end=new g,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}var y,S,E,b,T,C,w="未引入消息模块",R=n(10).ZegoConnectionAgent,I=(Object.defineProperty(k.prototype,"clientIP",{get:function(){var e;return(null==(e=this.connection)?void 0:e.clientIP)||""},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"timeOffset",{get:function(){var e;return null==(e=this.connection)?void 0:e.timeOffset},enumerable:!1,configurable:!0}),k.prototype.init=function(){var e;null!=(e=this.connection)&&e.init()},k.prototype.unInit=function(){var e;null!=(e=this.connection)&&e.unInit()},k.prototype.setAppInfo=function(e){var t;null!=(t=this.connection)&&t.setAppInfo(e)},k.prototype.setUserInfo=function(e){var t;null!=(t=this.connection)&&t.setUserInfo(e)},k.prototype.setNetAgentDefaultServers=function(e){var t;null!=(t=this.connection)&&t.setNetAgentDefaultServers(e)},k.prototype.setBackupDomains=function(e){var t;null!=(t=this.connection)&&t.setBackupDomains(e)},k.prototype.setDispatchConnectServers=function(e){var t;null!=(t=this.connection)&&t.setDispatchConnectServers(e)},k.prototype.setNetAgentSpecifiedServers=function(e){var t;null!=(t=this.connection)&&t.setNetAgentSpecifiedServers(e)},k.prototype.startHttpRequest=function(e,t,n,r,i){var o;null!=(o=this.connection)&&o.startHttpRequest(e,t,n,r,i)},k.prototype.startHttpRequest2=function(e,t,n,r,i){var o;null!=(o=this.connection)&&o.startHttpRequest2(e,t,n,r,i)},k.prototype.getAppConfigByAgent=function(e,t,n,r){var i;return null==(i=this.connection)?void 0:i.getAppConfigByAgent(e,t,n,r)},k.prototype.getPCRequest=function(e,t){var n;return(null==(n=this.connection)?void 0:n.getPCRequest(e,t))||null},k.prototype.connectUa=function(){var e;null!=(e=this.connection)&&e.connectUa()},k.prototype.destroyConnect=function(){var e;null!=(e=this.connection)&&e.destroyConnect()},k.prototype.destroy=function(){var e;null!=(e=this.connection)&&e.destroy()},k.prototype.isConnect=function(){return!!this.connection&&this.connection.isConnect()},k.prototype.on=function(e,t){var n;return(null==(n=this.connection)?void 0:n.on(e,t))||!0},k.prototype.off=function(e,t){var n;return null==(n=this.connection)?void 0:n.off(e,t)},k.prototype.setLogger=function(e){var t;return null==(t=this.connection)?void 0:t.setLogger(e)},k.prototype.setAccess=function(e){var t;return null==(t=this.connection)?void 0:t.setAccess(e)},k.prototype.getNTP=function(){var e;return(null==(e=this.connection)?void 0:e.getNetworkTimeInfo())||{timestamp:0,maxDeviation:0}},k);function k(){this.connection=null,this.isLoad=!1,this.callBackList=[],this.connection=new R}(t=y=y||{})[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",(t=S=S||{})[t.EMPTY=0]="EMPTY",t[t.CLOSE=1]="CLOSE",(t=E=E||{})[t.Mode_UNSET=0]="Mode_UNSET",t[t.MODE_ONLINE=1]="MODE_ONLINE",t[t.MODE_TEST=2]="MODE_TEST",t[t.MODE_ALPHA=3]="MODE_ALPHA",(t=b=b||{})[t.CLOSE=0]="CLOSE",t[t.TEMP=1]="TEMP",t[t.TIMEOUT=2]="TIMEOUT",(t=T=T||{})[t.SERVICE_UNSET=0]="SERVICE_UNSET",t[t.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",t[t.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",t[t.SERVICE_MIX=3]="SERVICE_MIX",t[t.SERVICE_ZEUS=4]="SERVICE_ZEUS",t[t.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",t[t.SERVICE_L3=6]="SERVICE_L3",t[t.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",t[t.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",t[t.SERVICE_ZIM=9]="SERVICE_ZIM",t[t.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",t[t.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",t[t.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",t[t.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",t[t.SERVICE_QUALITY=14]="SERVICE_QUALITY",t[t.SERVICE_SECURITY=15]="SERVICE_SECURITY",t[t.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",t[t.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",t[t.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",t[t.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",t[t.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",t[t.SERVICE_CDN=21]="SERVICE_CDN",t[t.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",t[t.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",t[t.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",t[t.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",t[t.SERVICE_ECHO=26]="SERVICE_ECHO",t[t.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",t[t.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR",(t=C=C||{}).Logining="LOGINING",t.Logined="LOGINED",t.LoginFailed="LOGIN_FAILED",t.Reconnecting="RECONNECTING",t.Reconnected="RECONNECTED",t.ReconnectFailed="RECONNECT_FAILED",t.Kickout="KICKOUT",t.Logout="LOGOUT",t.LogoutFailed="LOGOUT_FAILED";var O={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},APPID_INVALID:{code:1001004,msg:"appid invalid"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},GEO_SET_ERROR:{code:1000018,msg:"geo set error"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},ROOM_COUNT_EXCEED:{code:1002001,msg:"login rooms exceeds the upper limit"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_EXTRA_INFO_KEY_LIMIT:{code:1002017,msg:"room extra info key exceed the limit"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTI_ROOM_UNABLE:{code:1002036,msg:"multi room unable"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},NETWORK_RECOVERY:{code:1002051,msg:"network recovery"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},FORBID_BLACK_USER:{code:1002066,msg:"forbid black user"},WHITE_BOARD_VERSION_ERROR:{code:1002098,msg:"Mismatch with RTC SDK version, please upgrade ZegoSuperBoard or ZegoWhiteboardView SDK to the latest version"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},UPLOAD_LOG_ERROR:{code:1102025,msg:"upload zip logs failed"}},N=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],A=(t=n(5),n.n(t)),L=(t=n(6),n.n(t));function P(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),n=-1!=e.indexOf("Firefox"),r=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome;e=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":n?"Firefox":r?"Opera":i?"Chrome":e?"Safari":"Unkown"}function M(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return((null==e?void 0:e.effectiveType)||(null==e?void 0:e.type)||"unknwon").toUpperCase()}function D(e,t){return A.a.encrypt(e,t).toString()}function x(e,t){try{return A.a.decrypt(e,t).toString(L.a)}catch(e){return""}}function U(e,t){return!(e=((null==e?void 0:e.replace("webliveroom","-"))||"").split("-")||[])[1]||!/\d*/i.test(e[1])||+e[1]==t}function B(e,t){try{localStorage.setItem(e,t)}catch(e){}}function H(e){try{return localStorage.getItem(e)}catch(e){}}var z=function(){return(z=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},G=(F.checkConfigParam=function(e,t,n){return e&&"number"==typeof e&&this.checkInteger(e)?!(!t||"string"!=typeof t&&!Array.isArray(t)||""==t)||(n.error("ccp.0 server must be string or string array and not empty"),!1):(n.error("ccp.0 appid must be positive integer number and not empty"),!1)},F.checkPriConfigParam=function(e,t,n,r,i){return e&&"number"==typeof e&&this.checkInteger(e)?t&&"string"==typeof t?"object"!=typeof n||"string"!=typeof n.deviceID?(i.error("ccp.0 deviceID must be string and not empty"),!1):1===r||0===r||(i.error("ccp.0 anType must be 0 or 1"),!1):(i.error("ccp.0 dispatchServer must be string and not empty"),!1):(i.error("ccp.0 appid must be positive integer number and not empty"),!1)},F.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},F.registerCallback=function(e,t,n){var r;t.success&&(r=t.success,n[e+"SuccessCallback"]=r),t.error&&(r=t.error,n[e+"ErrorCallback"]=r)},F.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},F.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},F.logReportCallback=function(e,t,n,r){F.registerCallback(e,{success:function(e,r){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];F.dataReportEvent(t,n,e,r,i)}},r)},F.proxyRes=function(e,t,n,r){return{interResolve:function(r){e.uploadReport(t),n(r)},interReject:function(n,i){var o;void 0===i&&(i=""),(o=n.code<2e9&&1e9<n.code?F.decodeServerError(n.code,n.msg):{code:n.code,message:n.msg})&&e.addMsgInfo(t,{error:o.code,message:o.message+i}),e.uploadReport(t),r({errorCode:n.code||n.errorCode})}}},F.getServerError=function(e){var t,n,r={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};return 0===e?O.SUCCESS:((t=z({},O.ROOM_INNER_ERROR)).code=e,t.msg=1e9<e?(n=r[e])?"liveroom cmd error, code: "+e+", message: "+n:r[1e9]+e:r[e]?r[e]+" code:"+e:"unknown error code:"+e,t)},F.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},F.decodeServerError=function(e,t){var n={code:-1,message:"server error"};return n.code=1e9<e?e-1e9+52e6:e+2002e6,t&&(n.message=t),n},F.getLiveRoomError=function(e,t){var n={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR",5022:"ROOM_COUNT_EXCEED",5030:"FORBID_BLACK_USER"};return t?2e5<e&&e<3e5?n[e-2e5]:e<2e5?{50116:"TOKEN_ERROR",50117:"TOKEN_EXPIRED",50118:"TOKEN_ERROR",50119:"TOKEN_ERROR",50120:"TOKEN_ERROR",50121:"TOKEN_ERROR",50122:"TOKEN_ERROR",50123:"TOKEN_EXPIRED",50124:"TOKEN_ERROR",50125:"TOKEN_ERROR",50126:"TOKEN_ERROR",50127:"TOKEN_ERROR",50128:"TOKEN_ERROR"}[e]||n[e]||"ROOM_INNER_ERROR":n[e]||"ROOM_INNER_ERROR":1e9<e?n[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},F.getKickoutError=function(e,t){var n={code:e,message:"kickout reason = "+e};if(t)switch(e){case 1:n.code=63000001,n.message="zpush multiple login kickout",n.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:n.code=63000002,n.message="zpush manual kickout",n.name="MANUAL_KICKOUT";break;case 4:n.code=63000005,n.message="zpush token expired",n.name="TOKEN_EXPIRED";break;default:n.code=e,n.message="kickout reason = "+e}else switch(e){case 1:n.code=63000001,n.message="zpush multiple login kickout",n.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:n.code=63000002,n.message="zpush manual kickout",n.name="MANUAL_KICKOUT";break;case 3:n.code=63000003,n.message="kickout reason = "+e;break;case 4:n.code=63000004,n.message="zpush multiple login kickout",n.name="MULTIPLE_LOGIN_KICKOUT";break;case 5:n.code=63000005,n.message="zpush token expired",n.name="TOKEN_EXPIRED";break;default:n.code=e,n.message="kickout reason = "+e}return n},F.dataReportEvent=function(e,t,n,r,i){switch(n){case"eventStart":e.eventStart(t,r);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,r,i[0]);break;case"addEventMsg":e.addEventMsg(t,r,i[0],i[1]);break;case"addEvent":e.addEvent(t,r);break;case"eventEnd":e.eventEnd(t,r);break;case"addMsgInfo":e.addMsgInfo(t,i[0])}},F.mergeUserList=function(e,t,n,r){e.debug("msl.0 call");var i=[],o=[];n=n||[];for(var s=0;s<n.length;s++){for(var a=!1,u=0;u<t.length;u++)if(n[s].userID===t[u].userID){a=!0;break}a||i.push(n[s])}for(var c=0;c<t.length;c++){a=!1;for(var l=0;l<n.length;l++)if(t[c].userID===n[l].userID){a=!0;break}a||o.push(t[c])}for(t.splice(0),s=0;s<n.length;s++)t.push(t[s]);r(i,o),e.debug("msl.0 call success")},F.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&0<=e:"number"==typeof e&&e%1==0&&0<e},F.checkValidNumber=function(e,t,n){return t=t||1,n=n||1e4,"number"==typeof e&&e%1==0&&t<=e&&e<=n},F.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},F.uuid=function(e,t){var n,r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(t=t||i.length,e)for(n=0;n<e;n++)o[n]=i[0|Math.random()*t];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;n<36;n++)o[n]||(r=0|16*Math.random(),o[n]=i[19==n?3&r|8:r]);return o.join("")},F.isTestEnv=function(e){return!(!e.startsWith("wss")||-1===e.indexOf("test")||!e.endsWith("ws"))},F.getUint64=function(e,t,n){var r=n.getUint32(e,t);n=n.getUint32(e+4,t),e=t?r+Math.pow(2,32)*n:Math.pow(2,32)*r+n;return Number.isSafeInteger(e)||console.warn(e,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),e},F.decodeTokenExpire=function(e){try{var t,n=Uint8Array.from(function(e){for(var t,n,r,i,o=e.length,s=0,a="";s<o;){for(;t=N[255&e.charCodeAt(s++)],s<o&&-1==t;);if(-1==t)break;for(;n=N[255&e.charCodeAt(s++)],s<o&&-1==n;);if(-1==n)break;a+=String.fromCharCode(t<<2|(48&n)>>4);do{if(61==(r=255&e.charCodeAt(s++)))return a}while(r=N[r],s<o&&-1==r);if(-1==r)break;a+=String.fromCharCode((15&n)<<4|(60&r)>>2);do{if(61==(i=255&e.charCodeAt(s++)))return a}while(i=N[i],s<o&&-1==i);if(-1==i)break;a+=String.fromCharCode((3&r)<<6|i)}return a}(e),(function(e){return e.charCodeAt(0)})),r=new DataView(n.buffer);return 0<(t="function"==typeof r.getBigInt64?r.getBigUint64(0):F.getUint64(0,!1,r))?Number(t):Number(r.getBigUint64(0,!0))}catch(e){console.error("token error")}return-1},F.bin2hex=function(e){for(var t,n="",r=0,i=(e+="").length;r<i;r++)n+=(t=e.charCodeAt(r).toString(16)).length<2?"0"+t:t;return n},F.getCanvasFingerprint=function(e){var t=document.createElement("canvas"),n=((n=t.getContext("2d")).textBaseline="top",n.font="14px 'Arial'",n.fillStyle="#f60",n.fillRect(125,1,62,20),n.fillStyle="#069",n.fillText(e,2,15),n.fillStyle="rgba(102, 204, 0, 0.7)",n.fillText(e,4,17),t.toDataURL().replace("data:image/png;base64,",""));e=atob(n);return this.bin2hex(e.slice(-16,-12))},F.generateUUID=function(e){void 0===e&&(e=0);var t,n=H("z_deviceID");return n||(t=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(36)})),B("z_deviceID",n=0===e?this.getCanvasFingerprint("hello, zego")+n.slice(8):n),n)},F.getNetTypeNum=function(){var e=c.NT_UNKNOWN,t="",n=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return-1<(t=((null==n?void 0:n.effectiveType)||(null==n?void 0:n.type)||"unknwon").toUpperCase()).indexOf("4G")?e=c.NT_4G:-1<t.indexOf("2G")?e=c.NT_2G:-1<t.indexOf("3G")?e=c.NT_3G:-1<t.indexOf("WIFI")?e=c.NT_WIFI:-1<t.indexOf("LINE")?e=c.NT_LINE:-1<t.indexOf("NONE")&&(e=c.NT_NONE),e},F);function F(){}var q={product:"rtc_web",importLevel:a.H,levels:[0,10,100,1e3],bps:32e3},j="init",V="0c9e6e0f8c0a8f4e",Y="z_net_access_servers",W="z_appconfig",Z="z_appconfig_etag",K={domains:["accesshub-wss.zego.im","accesshub-wss.coolzcloud.com","accesshub-wss.zegocloud.com"],primaryDomains:["zego.im","coolzcloud.com","zegocloud.com"],mode:"online",modeNo:E.MODE_ONLINE,sdkType:3,connectVer:4,pcEstablishTimeout:15,scheme:"wss",location:"accesshub",wssMessageType:1},$=[{id:2,relative_geofencings:[],accesshub:"accesshub-wss-geo-2.zego.im",logreport:"weblogger-wss-geo-2.zego.im",detaillog:"detaillog-geo-2.zego.im"},{id:3,relative_geofencings:[7],accesshub:"accesshub-wss-geo-3.zego.im",logreport:"weblogger-wss-geo-3.zego.im",detaillog:"detaillog-geo-3.zego.im"},{id:4,relative_geofencings:[7],accesshub:"accesshub-wss-geo-4.zego.im",logreport:"weblogger-wss-geo-4.zego.im",detaillog:"detaillog-geo-4.zego.im"},{id:5,relative_geofencings:[7],accesshub:"accesshub-wss-geo-5.zego.im",logreport:"weblogger-wss-geo-5.zego.im",detaillog:"detaillog-geo-5.zego.im"},{id:6,relative_geofencings:[7],accesshub:"accesshub-wss-geo-6.zego.im",logreport:"weblogger-wss-geo-6.zego.im",detaillog:"detaillog-geo-6.zego.im"},{id:7,relative_geofencings:[3,4,5,6,1],accesshub:"accesshub-wss-geo-7.zego.im",logreport:"weblogger-wss-geo-7.zego.im",detaillog:"detaillog-geo-7.zego.im"}],X=[2,3,4,5,6];function Q(e,t){this.logger=e,this.stateCenter=t,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}function J(e){return e}function ee(e){return e}function te(e){return e}function ne(e){return e}Q.prototype.init=function(e,t,n,r){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof n&&(this.RETRY_CONTINUE_COUNT=n),"number"==typeof r&&(this.RETRY_MAX_TIME_INTERVAL=r)},Q.prototype.invalid=function(){this.logger.info("zm.rh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1};var re="zm.0",ie="zm.wl",oe="zm.slf",se="zm.lg",ae="zm.lo",ue="zm.fac",ce="zm.fac.tk",le="zm.hlu",he="zm.cna",de="zm.gsac",fe="zm.zpl.url",pe="zm.on",ge="zm.rntk",_e="zm.rm.lg",me="zm.rm.tl",ve="zm.rm.lgr",ye="zm.rm.clh",Se="zm.rm.lo",Ee="zm.rm.dcn",be="zm.rm.kco",Te="zm.hhl",Ce="zm.hb.st",we="zm.hb.rsp",Re="zm.sv.ps",Ie="zm.us.urp",ke="zm.us.uph",Oe="ON_LISTENER",Ne="zm.st.ofls",Ae="zm.lrh.sm",Le="zm.lrh.hsp",Pe="zm.lrh.lgi",Me="zm.lrh.ful",De="zm.lrh.lgo",xe="zm.lrh.sru",Ue="zm.lrh.hd",Be={event:"/sdk/init",error:{kInvalidParamError:O.INPUT_PARAM},system_info:ee,servers:function(e){return e},is_from_cache:ne,project:ee,liveroom_version:ee,biz_type:te,lua_md5:ee,sev_env:ee,use_na:te},He="listener",ze="/sdk/set_debug",Ge=ee,Fe={event:"/sdk/set_log_config",error:{kInvalidParamError:O.INPUT_PARAM},log_level:function(e){return e},remote_log_level:ee,log_url:ee},qe={event:"/sdk/on_listener",listener:ee,error:{INPUT_PARAM:O.INPUT_PARAM}},je=ee,Ve=(O.INPUT_PARAM,{event:"/sdk/login",room_id:ee,room_sid_string:ee,user_state_update:te,max_member_cnt:te,message:ee,token:ee,svr_env:ee,server:ee,try_cnt:te,room_mode:te,role:te,audience_create_room:te,liveroom_sid_string:ee,error:{ROOM_ID_NULL:O.ROOM_ID_NULL,INPUT_PARAM:O.INPUT_PARAM,ROOM_ID_TOO_LONG:O.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:O.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:O.USER_ID_NULL,USER_ID_TOO_LONG:O.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:O.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:O.USER_NAME_NULL,USER_NAME_TOO_LONG:O.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:O.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:O.LOGIN_TIMEOUT,INNER_ERROR:O.ROOM_INNER_ERROR,NETWORK_BROKEN:O.NETWORK_BROKEN}}),Ye="/sdk/sublogin",We=ee,Ze={event:"/zpush/login",sdk_zpush_sessionid_string:ee},Ke={event:"/liveroom/enter"},$e={event:"/sdk/renew_token",error:{INPUT_PARAM:O.INPUT_PARAM,NOT_LOGIN:O.NOT_LOGIN},token:ee},Xe={event:"/sdk/logout",error:{INPUT_PARAM:O.INPUT_PARAM,ROOM_NOT_EXIST:O.ROOM_NOT_EXIST},room_id:ee,room_sid_string:ee,is_multi:ne,is_send_cmd_net:ne,liveroom_sid_string:ee},Qe=(O.INPUT_PARAM,O.ROOM_NOT_EXIST,"/liveroom/quit"),Je=(O.INPUT_PARAM,O.ROOM_NOT_EXIST,ee),et=ee,tt=(O.INPUT_PARAM,O.ROOM_NOT_EXIST,"/sdk/relogin"),nt=(O.ROOM_ID_NULL,O.NETWORK_BROKEN,{event:"/liveroom/tempbroken"}),rt={event:"/sdk/reconnect",room_broken_time:te},it={event:"/sdk/disconnect"},ot=te,st=te,at={event:"/liveroom/hb",room_id:ee,room_sid_string:ee,interval:te,stream_seq:te,server_user_seq:te,error:{NOT_LOGIN:O.NOT_LOGIN,HB_TIMEOUT:O.TIMEOUT}},ut={event:"/liveroom/recv_user_update_info",user_list_seq:te,update_user:J,error:{ROOM_NOT_EXIST:O.ROOM_NOT_EXIST}},ct={event:"/sdk/enable_multi_room",is_multi:ne,error:{kInvalidParamError:O.INPUT_PARAM,kAlreadyLoginError:O.ALREADY_LOGIN}},lt=J,ht=J,dt=J,ft="/cloud_setting/request",pt=J,gt=J,_t={event:"/liveroom/get_current_user_list",user_index:te,is_time_ascend:ne,use_na:te},mt="/zegoconn/connect",vt=ee,yt=te,St=J,Et=ee,bt=ee,Tt=te,Ct="/zegoconn/request",wt=J,Rt=J,It=te,kt={event:"/zegoconn/proxy_connect",service_no:te,proxy_link_sources:te,recv_time:te,connect_stream:te},Ot={event:"/zegoconn/proxy_broken",service_no:te},Nt={event:"/zegoconn/proxy_disconnect",service_no:te};At=function(e,t){return(At=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}At(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(Dt,Lt=Q),Dt.prototype.renewLocalToken=function(e,t){this.token=e,this.room.token=this.token;var n=(new Date).getTime(),r=void 0;t&&"number"==typeof t?r=1e3*t:"string"==typeof e&&["03","04"].includes(e.substring(0,2))&&(t=1e3*G.decodeTokenExpire(e.substring(2)),this.logger.info("zm.rm.rlt time "+t+" "+n+" "+this.stateCenter.local_time_deviation),r=t-(n-this.stateCenter.local_time_deviation)),r&&this.roomHandler.resetTokenTimer(r),this.logger.setTokenInfo(e),this.stateCenter.actionListener("_tokenRenewed",e,this.room.roomID)},Dt.prototype.initRoom=function(e,t,n,r,i,o,s){this.roomHandler=e,this.roomID=t,this.renewLocalToken(n),this.user=r,this.server=i,this.serverBak=o||i,this.config=s},Dt.prototype.active=function(e){var t=this,n=(this.logger.info(_e+" retry call "+(null==(n=this.room)?void 0:n.roomID)+" "+(e=void 0!==e&&e)),null!=(n=this.loginRoomCallback)&&n.success?Ye:tt);if(this.subLoginSpan||(this.subLoginSpan=this.stateCenter.reporter.createSpan(a.H,{key:Ve.event,par:this.roomID},{key:n,par:this.roomID},n,!0),this.spanKey=n),this.roomHandler.setRunState(s.trylogin),this.room.isMulti&&(null==(n=this.stateCenter.roomModulesList.find((function(e){return!e.isMulti})))?void 0:n.runState)!==s.login)this.logger.info(_e+" service is disconnected, multi room stop retry");else if(this.retryTimer)this.logger.info(_e+" has actived, ignore");else{var r=this.stateCenter.networkState==u.offline;if(r){if(this.logger.info(_e+" check if really offline. "+this.retryNetCount),this.retryNetCount>=this.retryNetMaxTimes)return void this.logger.warn(_e+" network is broken, stop retry")}else this.retryNetCount=0;this.isOverTime?this.logger.info(_e+" retry over time, stop retry"):(1==this.retryActiveCount?this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(n=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1)),this.retryActiveInterval=n>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:n),this.logger.info(_e+" interval "+this.retryActiveInterval),this.retryTimer=setTimeout((function(){t.roomHandler.login(t.retryActiveCount%2==1?t.server:t.serverBak,t.roomID,t.token,t.user,t.config,(function(e){t.stateCenter.networkState=u.online,t.handleLoginFinish(e)}),(function(e,n){t.handleLoginFinish(!1,e,n)})),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,r?t.retryNetCount++:t.retryActiveCount++}),e?0:1e3*this.retryActiveInterval))}},Dt.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.logger.info(_e+" start max timer"),this.maxTimer=setTimeout((function(){e.logger.info(_e+" over max time ".concat(e.RETRY_MAX_TIME,"s, stop retry")),e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,O.LOGIN_TIMEOUT),e.subLoginSpan&&(e.stateCenter.reporter.spanEnd({key:e.spanKey,par:e.roomID},{error:O.LOGIN_TIMEOUT.code,message:O.LOGIN_TIMEOUT.msg}),e.subLoginSpan=null),e.loginRoomCallback.fail&&(e.loginRoomCallback.fail(O.LOGIN_TIMEOUT),e.roomHandler.disconnectedHandle(O.LOGIN_TIMEOUT),e.resetCallBack())}),1e3*this.RETRY_MAX_TIME))},Dt.prototype.stopMaxTime=function(){this.logger.info(_e+" stop max timer"),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},Dt.prototype.onactive=function(e,t){},Dt.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){t=void 0;var n=void 0,r=void 0,i=(this.stateCenter.useNetAgent?(t=["202002","205030","205035","50116","50117","50118","50119","50120","50121","50122","50123","50124","50125","50126","50127","50128"],n=["40001","40100"],r=["201002","30019"]):(t=["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"],n=["1100040001","1100040100"]),e.code+"");if(this.stateCenter.useNetAgent){if(10015===e.code)return this.room.retryConnect(),!0;if(40001<=e.code&&e.code<=40100||50200<=e.code&&e.code<=50299||null!=r&&r.includes(i))return this.room.resetSessionInfo(),!0}return!(null!=t&&t.includes(i)||(null==n||!n.includes(i))&&(this.room.lastRunState!=s.login||(this.logger.warn("zm.rrh.he reset"),this.room.resetUserSession(),this.invalid(),0)))}return!0},Dt.prototype.setLoginRoomCallback=function(e,t){this.loginRoomCallback.success=e,this.loginRoomCallback.fail=t},Dt.prototype.loginFail=function(e){this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(!1,e),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(e),this.roomHandler.disconnectedHandle(e),this.resetCallBack())},Dt.prototype.handleLoginFinish=function(e,t,n){this.logger.info("zm.rrh.hlf "+e+" "+JSON.stringify(t)),t?(this.subLoginSpan&&(this.stateCenter.reporter.spanEnd({key:this.spanKey,par:this.roomID},{error:t.code,message:t.msg}),this.subLoginSpan=null),this.handleError(t,n)?(this.maxTimer||this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.roomHandler.disconnectedHandle(t),this.resetCallBack()))):(this.stopMaxTime(),this.invalid(),this.onactive(e,{code:0,msg:""}),this.subLoginSpan&&(this.stateCenter.reporter.spanEnd({key:this.spanKey,par:this.roomID},{room_id:this.roomID,room_sid_string:null==(n=this.room)?void 0:n.roomSidString}),this.subLoginSpan=null),this.loginRoomCallback.success&&(this.loginRoomCallback.success(e),this.resetCallBack()))},Dt.prototype.invalid=function(){this.logger.info("zm.rh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryActiveCount=1,this.retryNetCount=0},Dt.prototype.resetCallBack=function(){this.loginRoomCallback.success=void 0,this.loginRoomCallback.fail=void 0};var At,Lt,Pt,Mt=Dt;function Dt(e,t,n){var r=Lt.call(this,e,t)||this;return r.logger=e,r.stateCenter=t,r.room=n,r.retryNetCount=0,r.retryNetMaxTimes=3,r.spanKey="",r.loginRoomCallback={},r}(t=Pt=Pt||{}).NOT_EMPTY="NOT_EMPTY",t.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",t.TYPE_STRING="TYPE_STRING",t.TYPE_INTEGER="TYPE_INTEGER",t.TYPE_OBJECT="TYPE_OBJECT",t.MAX_LENGTH_10="MAX_LENGTH_10",t.MAX_LENGTH_64="MAX_LENGTH_64",t.MAX_LENGTH_100="MAX_LENGTH_100",t.MAX_LENGTH_128="MAX_LENGTH_128",t.MAX_LENGTH_256="MAX_LENGTH_256",t.MAX_LENGTH_1024="MAX_LENGTH_1024";var xt={error:{code:0,msg:"suc"}},Ut={NOT_EMPTY:function(e,t,n,r,i){return void 0===t||""===t||null===t?(r.error("".concat(n," ").concat(e," is empty")),i):xt},ILLEGAL_CHARACTERS:function(e,t,n,r,i){return G.checkIllegalCharacters(t)?xt:(r.error("".concat(n," ").concat(e," contains illegal characters")),i)},TYPE_STRING:function(e,t,n,r,i){return"string"!=typeof t?(r.error("".concat(n," ").concat(e," must be string")),i):xt},TYPE_INTEGER:function(e,t,n,r,i){return G.checkInteger(t,!1)?xt:(r.error("".concat(n," ").concat(e,"  must be integer number")),i)},TYPE_OBJECT:function(e,t,n,r,i){return t&&"object"==typeof t?xt:(r.error("".concat(n," ").concat(e,"  must be object")),i)},MAX_LENGTH_10:function(e,t,n,r,i){return 10<t.length?(r.error("".concat(n," ").concat(e," is too long")),i):xt},MAX_LENGTH_64:function(e,t,n,r,i){return 64<t.length?(r.error("".concat(n," ").concat(e," is too long")),i):xt},MAX_LENGTH_100:function(e,t,n,r,i){return 100<t.length?(r.error("".concat(n," ").concat(e," is too long")),i):xt},MAX_LENGTH_128:function(e,t,n,r,i){return 128<t.length?(r.error("".concat(n," ").concat(e," is too long")),i):xt},MAX_LENGTH_256:function(e,t,n,r,i){return 256<t.length?(r.error("".concat(n," ").concat(e," is too long")),i):xt},MAX_LENGTH_1024:function(e,t,n,r,i){return 1024<t.length?(r.error("".concat(n," ").concat(e," is too long")),i):xt}};Object.defineProperty(Ht.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,i.LoggerStateCenter.getInstance().debug=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ht.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e,i.LoggerStateCenter.getInstance().testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ht.prototype,"ENV",{get:function(){return this._env},set:function(e){this._env=e,i.LoggerStateCenter.getInstance().ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ht.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(Ht.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),Ht.prototype.getRequestId=function(){return this.idName+"-"+f()},Ht.prototype.actionListener=function(e){for(var t,n=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];["getAnchorInfo","HBResponse","roomOnlineUserCountUpdate","roomLoginResponse"].includes(e)||e.startsWith("_")||!this.listenerList[e]||((t=this.reporter.createSpan(a.H,{key:He},{key:""},"/sdk/listener")).setAttributes({listener:e,listener_params:JSON.stringify(r)}),t.end()),["roomStateChanged","tokenWillExpire"].includes(e)&&this.logger.info("zm.al ".concat(e," ").concat(JSON.stringify(r))),this.listenerList[e]&&this.listenerList[e].forEach((function(t){try{t.apply(void 0,r)}catch(t){n.logger.error("zm.st.at ",e," ",JSON.stringify(t))}}))},Ht.prototype.onListener=function(e,t){return this.listenerList[e]?"function"!=typeof t?(this.logger.error(Oe+" listener callBack must be funciton"),!1):(-1==this.listenerList[e].indexOf(t)&&this.listenerList[e].push(t),!0):(this.logger.error(Oe+" event "+e+" no found"),!1)},Ht.prototype.offListener=function(e,t){return this.listenerList[e]?"function"!=typeof t?(this.logger.error(Ne+" listener callBack must be funciton"),!1):(-1!==this.listenerList[e].indexOf(t)&&(this.listenerList[e]=this.listenerList[e].filter((function(e){return e!==t}))),!0):(this.logger.error(Ne+" event "+e+" no found"),!1)},Object.defineProperty(Ht.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(e){this._sdkVersion=e},enumerable:!1,configurable:!0}),Ht.prototype.proxyRes=function(e,t,n){return{interResolve:function(n){t(n),e.end()},interReject:function(t,r){var i;void 0===r&&(r=""),(i=t.code<2e9&&1e9<t.code?G.decodeServerError(t.code,t.msg):{code:t.code,message:t.msg})&&e.setAttributes({error:i.code,message:i.message+r}),e.end(),n({errorCode:t.code})}}};var Bt=Ht;function Ht(e,t){this.logger=e,this.dataReport=t,this._debug=!1,this.appConfigEtag=-1,this.appConfigFetched=!1,this.requestList={},this.mode=E.MODE_ONLINE,this.connectState="connected",this.testNetPackageSize=!1,this.netGeoFencing={},this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],_roomLogin:[],_appConfigRsp:[],_netAppConfigRsp:[],_connectChanged:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],_tokenExpired:[],roomStateChanged:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[],_cloudSettingNotify:[],_settingCanFetch:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=u.online,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this.settingFetched=!1,this.useNetAgent=!0,this.netHasSet=!1,this.configRoomAuth=!1,this.configCheckToken=!1,this._sdkVersion="unknown",this.mode=K.modeNo}Gt.prototype.init=function(e){var t=this,n=e.body.hearbeat_interval<3e3?3e3:e.body.hearbeat_interval;this.tryHeartbeatCount=0,this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.loginHeartbeatTimer=setTimeout((function(){t.start(n)}),n),this.initCount++},Gt.prototype.start=function(e){var t,n,r=this,i=(this.logger.info(Ce+" call"),this.stateCenter.reporter.createSpan(a.H,{key:Ve.event,par:this.room.roomID},{key:""},at.event));this.room.isLogin()?3<++this.tryHeartbeatCount?(this.logger.error(Ce+" come to try limit"),this.stateCenter.reporter.setError(i,at.error.HB_TIMEOUT),this.hbLogout(O.HEARTBEAT_TIMEOUT),this.stateCenter.reporter.createSpan(a.H,{key:Ve.event,par:this.room.roomID},{key:""},"/zpush/hb_timeout").end()):(t=function(e,t){var n=e.body&&e.body.err_code;e.header&&e.body?0!==n&&(n=G.decodeServerError(e.body.err_code||e.body.code,e.body.err_message||e.body.message),i.setAttributes({error:n.code,message:n.message+e.body.err_code})):i.setAttributes({error:(0<e.code?e:O.ROOM_INNER_ERROR).code,message:e.msg||O.ROOM_INNER_ERROR}),r.handleHeartbeatRsp(e,t),0===(null==(n=null==e?void 0:e.body)?void 0:n.err_code)&&i.setAttributes({interval:at.interval(null==(t=null==e?void 0:e.body)?void 0:t.hearbeat_interval),stream_seq:at.stream_seq(null==(n=null==e?void 0:e.body)?void 0:n.stream_seq),server_user_seq:at.server_user_seq(null==(t=null==e?void 0:e.body)?void 0:t.server_user_seq)}),i.end()},null!=(n=this.stateCenter.useNetAgent?this.liveRoomHandler:this.service)&&n.heartBeat(t,t,this.room),this.heartbeatInterval=e,n=this.heartbeatInterval,2<=this.initCount?(n=Math.round(Math.random()*(this.heartbeatInterval+1)),this.initCount=1):n=this.heartbeatInterval,this.heartbeatTimer=setTimeout((function(){r.start(r.heartbeatInterval)}),n),this.logger.info(Ce+" call success")):(this.logger.error(Ce+" state error"),this.stateCenter.reporter.setError(i,at.error.NOT_LOGIN))},Gt.prototype.handleHeartbeatRsp=function(e,t){if(e.body&&e.body.err_code&&0!==e.body.err_code)return this.logger.error(we+" disconnect, server error=",e.body.err_code),1000000152==e.body.err_code?void this.hbLogout(O.HEARTBEAT_TIMEOUT):void this.hbLogout(G.getServerError(e.body.err_code));e.header&&e.body?((this.tryHeartbeatCount=0)!==e.body.hearbeat_interval&&(this.heartbeatInterval=e.body.hearbeat_interval,this.heartbeatInterval<3e3)&&(this.heartbeatInterval=3e3),this.heartbeatRspNotiFy(e,this.room.roomID),this.logger.info(we+" call success")):(this.logger.error(we+" disconnect, error=",JSON.stringify(e)+", seq = "+t),this.hbLogout(e))},Gt.prototype.heartbeatRspNotiFy=function(e,t){},Gt.prototype.hbLogout=function(e){},Gt.prototype.resetHeartbeat=function(){clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null,clearTimeout(this.loginHeartbeatTimer),this.loginHeartbeatTimer=null,this.tryHeartbeatCount=0,this.initCount=0,this.logger.info("zm.hb.rst call success")};var zt=Gt;function Gt(e,t,n,r,i,o){this.logger=e,this.stateCenter=t,this.dataReport=n,this.liveRoomHandler=r,this.room=i,this.service=o,this.tryHeartbeatCount=0,this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.initCount=0}Object.defineProperty(qt.prototype,"isUseNetAgent",{get:function(){return this.stateCenter.useNetAgent},enumerable:!1,configurable:!0}),qt.prototype.resetTokenTimer=function(e){var t=this;this.logger.info("zm.rm.rst  call: "+(e=2147483647<(e=(e-=3e4)<0?0:e)?2147483647:e)),this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=setTimeout((function(){t.stateCenter.actionListener("tokenWillExpire",t.room.roomID),t.stateCenter.actionListener("roomTokenWillExpire",t.room.roomID)}),e)},qt.prototype.stopTokenTimer=function(){this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=null},qt.prototype.setRunState=function(e){this.room.runState!==e&&(this.room.lastRunState=this.room.runState,this.room.runState=e)},qt.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},qt.prototype.reportLogoutSpan=function(e){var t,n=this.stateCenter.isMultiRoom?Qe:"/switch/logout_user";n=this.stateCenter.reporter.createSpan(a.H,{key:Xe.event,par:this.room.roomID},{key:""},n),e&&this.isUseNetAgent&&"0"===this.liveRoomHandler.roomServicer.zPushSid&&(this.liveRoomHandler.roomServicer.zPushSid=null==(t=null==(t=null==(t=this.liveRoomHandler)?void 0:t.roomServicer)?void 0:t.switchSessionID)?void 0:t.toString()),e=this.isUseNetAgent?e?null==(e=null==(t=this.liveRoomHandler)?void 0:t.roomServicer)?void 0:e.zPushSid:null==(t=null==(e=null==(t=this.liveRoomHandler)?void 0:t.roomServicer)?void 0:e.switchSessionID)?void 0:t.toString():void 0;n.setAttributes({room_id:Xe.room_id(null==(t=this.room)?void 0:t.roomID),room_sid_string:Xe.room_sid_string(null==(t=this.room)?void 0:t.roomSidString),liveroom_sid_string:Je(null==(t=this.room)?void 0:t.userSidString),sdk_zpush_sessionid_string:et(e)}),n.end()},qt.prototype.resetRoom=function(e){var t,n,r=this;(e=(this.logger.info("zm.rm.rr call"),1<this.stateCenter.roomModulesList.length&&!e&&(this.room.isMulti=!0),this.resetTryLogin(),this.room.sessionExist&&this.room.runState!==s.logout&&!this.room.isDisConnect()&&(t=function(e){r.handleLogoutRsp(e,!r.room.isMulti)},n=this.isUseNetAgent?this.liveRoomHandler:this.service)&&n.logout(this.room,t,t),this.reportLogoutSpan(e),this.setRunState(s.logout),this.room.resetRoomSession(),this.room.resetUserSession(),this.room.isMulti||(this.stateCenter.userid="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.userSidString,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.isUseNetAgent?null!=(n=this.liveRoomHandler)&&n.reset():null!=(t=this.service)&&t.closeSocket()),this.resetRoomCallBack(),this.stateCenter.roomModulesList=this.stateCenter.roomModulesList.filter((function(e){return e!==r.room})),this.stateCenter.roomModulesList[0]))&&(e.isMulti=!1,e.runState!==s.login)&&e.roomTryHandler&&(e.roomTryHandler.startMaxTime(),e.roomTryHandler.active()),this.stateCenter.isMultiRoom&&0===this.stateCenter.roomModulesList.length&&(this.stateCenter.reporter.createSpan(a.H,{key:Xe.event,par:this.room.roomID},{key:""},"/zpush/multi_logout_user").end(),this.liveRoomHandler.roomServicer.zPushSid="0"),this.logger.info("zm.rm.rr call success")},qt.prototype.resetRoomCallBack=function(){},qt.prototype.loginSuccessCallBack=function(e,t){},qt.prototype.handlePushKickout=function(e,t,n){var r=this,i=(this.logger.info(be+"  call "+JSON.stringify(e)),G.getKickoutError(e.body.reason||(null==(i=e.body)?void 0:i.kickout_reason),this.isUseNetAgent)),o=this.stateCenter.reporter.createSpan(a.H,{key:Ve.event,par:this.room.roomID},{key:""},"/sdk/kickout"),u=(o.setAttributes({error:null==(u=O[i.name||"ROOM_INNER_ERROR"])?void 0:u.code,message:i.message,kickout_reason:ot((null==(u=e.body)?void 0:u.reason)||(null==(u=e.body)?void 0:u.kickout_reason)),need_relogin:st(null==(u=null==e?void 0:e.body)?void 0:u.need_relogin)}),o.end(),this.room.roomTryHandler);u?(u.onactive=function(e,t){r.logger.info(be+" onactive"),r.disconnectedHandle(t),r.stateCenter.actionListener("_kickout",t)},e.body.need_relogin&&1==e.body.need_relogin?(this.room.resetUserSession(),u.startMaxTime(),u.active()):(this.setRunState(s.logout),this.resetRoom(t),o={},e&&e.body.custom_reason?o.custom_kickout_message=e.body.custom_reason:i.name&&O[i.name]&&(u=e.body.reason||e.body.kickout_reason,o.custom_kickout_message=O[i.name].msg+"; kickout reason: "+u),i.name&&O[i.name]?this.disconnectedHandle(O[i.name],{extendedData:JSON.stringify(o),isKickout:!0}):this.disconnectedHandle(O.ROOM_INNER_ERROR,{extendedData:JSON.stringify(o),isKickout:!0}),this.stateCenter.actionListener("_kickout",{code:O.MANUAL_KICKOUT.code,msg:O.MANUAL_KICKOUT.msg+e.body.reason||e.body.kickout_reason}))):this.logger.info(be+" try handler no found")},qt.prototype.handleHbLogout=function(e){var t=this,n=this.room.roomTryHandler;n&&(n.onactive=function(e,n){t.logger.warn(Te+" onactive"),t.transError(n),t.disconnectedHandle(n)},[O.HEARTBEAT_TIMEOUT,O.SOCKET_CLOSE].includes(e)||[105,152,2001].includes(null==e?void 0:e.code)||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")||e.msg.endsWith("1000000105")?(n.startMaxTime(),n.active()):[O.TIMEOUT].includes(e)?this.logger.warn(Te+" timeout"):(this.logger.warn(Te+" unexpected error: ".concat(JSON.stringify(e))),n.stopMaxTime(),n.invalid(),this.resetRoom(),this.disconnectedHandle(e)))},qt.prototype.onDisconnect=function(e){var t=this;(e=(this.logger.error(Ee+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code||"number"==typeof e.code&&(e.code<2e9&&1e9<e.code||e.code<1e6?G.decodeServerError(e.code,e.msg):(e.code,e.msg)),G.unregisterCallback(tt,this.stateCenter.reportList),this.room.roomTryHandler))?(e.onactive=function(e,n){t.logger.error(Ee+" onactive"),n&&0!==n.code?(t.transError(n),t.roomStateHandle("DISCONNECTED",C.ReconnectFailed,n)):t.roomStateHandle("CONNECTED",C.Reconnected,n)},e.startMaxTime(),e.active()):this.logger.error(Ee+" try handler no found")},qt.prototype.onConnecting=function(e){this.roomStateHandle("CONNECTING",C.Logining,e)},qt.prototype.disconnectedHandle=function(e,t){var n;e&&0!==e.code?(this.stopTokenTimer(),n=null!=t&&t.isKickout?C.Kickout:C.ReconnectFailed,this.transError(e),this.roomStateHandle("DISCONNECTED",n,e,(null==t?void 0:t.extendedData)||e.msg)):this.roomStateHandle("CONNECTED",C.Reconnected,e,null==t?void 0:t.extendedData)},qt.prototype.roomStateHandle=function(e,t,n,r,i){if(!t||t!=C.Reconnecting||(this.reconectTimes++,1!=this.reconectTimes)){this.logger.info("zm.rm.scb "+e+" "+JSON.stringify(n)),["CONNECTED","DISCONNECTED"].includes(e)&&(this.reconectTimes=0);var o,s,u=0;switch(t=(t=(t=t&&[C.LoginFailed,C.ReconnectFailed].includes(t)?null!=(s=this.room.roomTryHandler)&&s.loginRoomCallback.fail?C.LoginFailed:C.ReconnectFailed:t)&&[C.Logined,C.Reconnected].includes(t)?null!=(s=this.room.roomTryHandler)&&s.loginRoomCallback.success?C.Logined:C.Reconnected:t)&&[C.Logining,C.Reconnecting].includes(t)?null!=(s=this.room.roomTryHandler)&&s.loginRoomCallback.success?C.Logining:C.Reconnecting:t){case C.Reconnecting:o=nt,this.tempBrokenTime=(new Date).getTime();break;case C.ReconnectFailed:o=it;break;case C.Reconnected:o=rt,u=(new Date).getTime()-this.tempBrokenTime}this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,n?n.code:0,r,i),i||(this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,n?n.code:0,r),this.stateCenter.actionListener("roomStateChanged",this.room.roomID,t,n?n.code:0,r)),o)&&(s=this.stateCenter.reporter.createSpan(a.H,{key:Ve.event,par:this.room.roomID},{key:""},o.event),t===C.Reconnected?s.setAttributes({room_broken_time:rt.room_broken_time(u)}):s.setAttributes({error:(null==n?void 0:n.code)||0,message:r||""}),s.end())}},qt.prototype.transError=function(e){var t;this.logger.info("zm.rm.te "+JSON.stringify(e)),0!==e.code&&(e.code<2e9&&1e9<e.code||e.code<1e6)&&(t=G.getLiveRoomError(e.code,this.stateCenter.useNetAgent))&&O[t]&&(e.code=O[t].code,e.msg=O[t].msg)},qt.prototype.login=function(e,t,n,r,i,o,u){this.logger.info(_e+" call:"+t+" "+n),this.room.isMulti||this.logger.setSessionInfo(this.stateCenter.appid,t,"",r.userID,"",this.stateCenter.sdKVersion),i&&(i.userUpdate&&"boolean"==typeof i.userUpdate&&(this.room.userStateUpdate=i.userUpdate),i.maxMemberCount)&&"number"==typeof i.maxMemberCount&&(this.room.maxMemberCount=i.maxMemberCount),this.stateCenter.configOK?(this.room.runState!==s.trylogin&&this.setRunState(s.trylogin),this.room.roomID=t,this.room.token=n,this.room.thirdToken=n,this.stateCenter.idName=r.userID,this.stateCenter.nickName=r.userName||r.userID,this.loginCallback.success=o,this.loginCallback.fail=u,this.server=e,this.stateCenter.reporter.spanSetAttributes({key:Ye,bak_key:tt,par:t},{server:this.isUseNetAgent?void 0:We(this.server)}),this.liveRoomLoginKey=this.room.isMulti?Ke:Ze,this.stateCenter.reporter.createSpan(a.H,{key:Ye,bak_key:tt,par:this.room.roomID},{key:this.liveRoomLoginKey.event,par:this.room.roomID},this.liveRoomLoginKey.event,!0),this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(e),this.logger.info(_e+" call success")):(this.logger.error(_e+" init sdk wrong"),u(O.INIT))},qt.prototype.tryLogin=function(e){var t,n=this;if(this.room.runState!==s.trylogin)this.logger.error("zb.rh.tl state error");else{if(this.stateCenter.reportSeqList.login,this.isUseNetAgent)return this.room.isMulti&&this.room.isDisConnect()?void this.logger.warn(me+" liveroom is not connected"):(i=function(e,t){n.handleLoginRsp(e,t)},void(null!=(t=this.liveRoomHandler)&&t.isUaConnect()?(this.stateCenter.reporter.spanSetAttributes({key:this.liveRoomLoginKey.event,par:null==(t=this.room)?void 0:t.roomID},{sdk_zpush_sessionid_string:null==(t=null==(t=null==(t=this.liveRoomHandler)?void 0:t.roomServicer)?void 0:t.switchSessionID)?void 0:t.toString()}),this.liveRoomHandler.login(this.room,i,i)):(this.tryLoginTimer=setTimeout((function(){n.logger.info(me+" over time no response, login timeout"),n.loginCallback.fail&&n.loginCallback.fail(Ve.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.warn(me+" ua is not connected"))));if(null!=(t=this.service)&&t.isDisConnect())try{if(this.service.closeSocket(),this.logger.debug(me+" new websocket"),!this.isUseNetAgent&&!U(e,this.stateCenter.appid))throw this.logger.error("".concat(me," the server does not match the appID")),new Error("The server does not match the appID");this.service.createSocket(e);var r=Date.now();this.service.openHandler((function(){var e;n.stateCenter.reporter.spanSetAttributes({key:n.liveRoomLoginKey.event,par:null==(e=n.room)?void 0:e.roomID},{connect_consume:Date.now()-r}),n.openHandler()})),this.service.closeHandler((function(e){var t;n.logger.error(me+" close "+JSON.stringify(e.code||e)),null!=(t=n.service)&&t.closeSocket(),n.closeHandler(e)})),this.service.errorHandler((function(e){var t;n.logger.error(me+" error "+JSON.stringify(e.code||e)),null!=(t=n.service)&&t.closeSocket(),n.closeHandler(e)}))}catch(e){this.logger.error(me+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(me+" use current websocket and sent login");var i=function(e,t){n.handleLoginRsp(e,t)};null!=(t=this.service)&&t.login(this.room,i,i)}this.tryLoginTimer=setTimeout((function(){n.logger.info(me+" over time no response, login timeout"),n.loginCallback.fail&&n.loginCallback.fail(Ve.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.info(me+" call success")}},qt.prototype.openHandler=function(){function e(e,t){n.handleLoginRsp(e,t)}var t,n=this;this.logger.info("zm.rm.op websocket.onpen call"),null!=(t=this.service)&&t.onPush(),null!=(t=this.service)&&t.login(this.room,e,e)},qt.prototype.handleLoginRsp=function(e,t){this.logger.info(ve+" seq: "+t+" "+JSON.stringify(e)),this.stateCenter.reportSeqList.login,this.room.runState!==s.trylogin?this.logger.error(ve+" state error"):e.header&&e.body?e.header.seq!==t&&0==this.room.isMulti?this.logger.error(ve+" in wrong seq, local=",t+"",",recv=",e.header.seq):0!==e.body.err_code?(this.logger.error(ve+" server error=",e.body.err_code),this.handleLoginFail(e)):(this.logger.info(ve+" call success."),this.handleLoginSuccess(e)):(this.logger.error(ve+" "+JSON.stringify(e)),this.handleLoginFail(e))},qt.prototype.handleLoginFail=function(e){this.resetTryLogin();var t=Ve.error.INNER_ERROR;e.header&&e.body?t=G.getServerError(e.body.err_code):e.code&&e.msg&&(t=e),this.stateCenter.reporter.spanEnd({key:this.liveRoomLoginKey.event,par:this.room.roomID},{error:t.code,message:t.msg}),this.loginCallback.fail&&this.loginCallback.fail(t,!0)},qt.prototype.handleLoginSuccess=function(e){var t,n,r=this,i=(this.room.checkRoomSession(e.body.room_session_id)&&(this.room.loginTime=Date.now()),this.room.lastRunState),o=(this.setRunState(s.login),this.stateCenter.userid=e.body.user_id,this.isUseNetAgent?(this.room.longRoomSid=e.body.room_session_id,this.room.longSid=e.body.session_id):(this.room.sessionID=e.body.session_id,this.room.roomSessionID=e.body.room_session_id),(o={})[this.room.roomID]={room_sid_string:this.room.roomSidString},this.stateCenter.reporter.setPublicPros(o),null==(o=null==e?void 0:e.body)?void 0:o.token_remain_time);this.stateCenter.configRoomAuth=0<o,e.body.ret_timestamp&&["03","04"].includes(this.room.token.substring(0,2))&&(t=(n=(new Date).getTime())-e.body.ret_timestamp,this.stateCenter.local_time_deviation=t<5e3?0:t,t=0<o?1e3*o:1e3*G.decodeTokenExpire(this.room.token.substring(2))-(n-this.stateCenter.local_time_deviation),this.resetTokenTimer(t)),this.room.isMulti||this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.userSidString,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.isUseNetAgent||(e.body.config_info&&(n=(null==(o=this.stateCenter.settingConfig)?void 0:o.getSetting("remote_log_level",!0))||e.body.config_info.log_level,this.logger.setRemoteLogLevel(n),""==e.body.config_info.log_url||this.logger.url||(this.logger.setLogServer(e.body.config_info.log_url),0===this.stateCenter.ENV&&(this.stateCenter.logDomain=null==(t=this.logger.url)?void 0:t.split("/")[2],this.stateCenter.reporter.setConfig({serverUrl:"wss://"+this.stateCenter.logDomain+"/zglog/tlog"})),e.body.config_info.log_url)),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,this.stateCenter.debugCustom||(this.stateCenter.debug=!0))),this.stateCenter.reporter.spanEnd({key:this.liveRoomLoginKey.event,par:this.room.roomID},{server:this.isUseNetAgent?void 0:We(this.server),room_id:null==(o=this.room)?void 0:o.roomID,room_sid_string:null==(n=this.room)?void 0:n.roomSidString,zpush_sessionid_string:this.isUseNetAgent&&null!=(o=null==(t=null==e?void 0:e.header)?void 0:t.session_id)?o.toString():void 0,liveroom_sid_string:null==(n=this.room)?void 0:n.userSidString}),this.resetTryLogin(),this.loginSuccessCallBack(i,e),this.roomStateHandle("CONNECTED",C.Logined,{code:0,msg:""}),this.logger.makeZipLogSpaceUpload().catch((function(e){r.logger.error("zm.rm.lgsuc zip log upload error: "+e.message)})),this.loginCallback.success&&this.loginCallback.success(!0)},qt.prototype.closeHandler=function(e){this.logger.error(ye+" room websocket close "+JSON.stringify(e.code||e)),this.room.runState!==s.logout?this.room.runState===s.trylogin?(this.resetTryLogin(),this.loginCallback.fail&&this.loginCallback.fail(1006==e.code?Ve.error.LOGIN_TIMEOUT:e)):this.room.runState===s.login&&(this.logger.info(ye+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(Ve.error.NETWORK_BROKEN)):this.logger.info(ye+" onclose logout flow call websocket.close")},qt.prototype.logout=function(e,t){this.logger.info(Se+" call"),this.room.runState===s.logout?this.logger.warn("zb.rh.lo at logout"):(this.resetRoom(e),this.roomStateHandle("DISCONNECTED",C.Logout,{code:0,msg:""},void 0,t),this.stopTokenTimer(),this.logger.info(Se+" call success"))},qt.prototype.handleLogoutRsp=function(e,t){this.logger.info(Se+" result=",e.body&&e.body.err_code?e.body.err_code:"-1"),this.isUseNetAgent&&t&&null!=(e=this.liveRoomHandler)&&e.closeRequest()};var Ft=qt;function qt(e,t,n,r,i,o){this.logger=e,this.stateCenter=t,this.dataReport=n,this.room=r,this.liveRoomHandler=i,this.service=o,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4,this.tokenTimer=null,this.beforeExpire=30,this.server="",this.tempBrokenTime=0,this.reconectTimes=0,this.loginCallback={}}var jt=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},Vt=(Yt.prototype.loginRsp=function(e,t){this.anchor_info=e.body.anchor_info||this.anchor_info,this.userListInterval=e.body.userlist_interval||this.userListInterval,this.userListMergeInterval=e.body.userlist_merge_timeout||this.userListMergeInterval,e.body.anchor_info&&(this.stateCenter.actionListener("getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name),this.stateCenter.actionListener("_getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name)),e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count),this.logger.info("zm.us.lgr  userStateUpdate "+this.room.userStateUpdate),this.room.userStateUpdate&&this.fetchUserList(t)},Yt.prototype.patchUserList=function(e){var t=this;e.body.server_user_seq!==this.userSeq&&this.room.userStateUpdate&&!this.userSeqMergeMap&&(this.logger.info("zm.us.pt call update user "+this.userSeq+" server "+e.body.server_user_seq),this.userSeqMergeMap||(this.userSeqMergeMap={}),this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){t.handleMergeTimeout()}),this.userListMergeInterval)),this.minUserSeq=e.body.server_user_seq,null!=e.body.online_count&&0!=e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count)},Yt.prototype.resetUserHandler=function(){this.userQuerying=!1,this.lastUserQueryTime=0,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=void 0,this.userSeqMergeMap={},this.userSeqMergeTimer=void 0,this.userQueryTimer=void 0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},Yt.prototype.fetchUserList=function(e){this.userQuerying?this.logger.warn("zm.us.ftu is already querying"):(this.userQuerying=!0,this.userTempList=[],this.fetchUserListWithPage(0,e||0),this.logger.info("zm.us.ftu the first time call"))},Yt.prototype.fetchUserListWithPage=function(e,t){function n(e){r.handleFetchUserListRsp(e,t)}var r=this,i={user_index:e,sort_type:0},o=_t;null!=(o=(this.stateCenter.reporter.createSpan(a.H,{key:Ve.event,par:this.room.roomID},{key:o.event,par:this.room.roomID},o.event,!0).setAttribute("user_index",o.user_index(e)),this.stateCenter.useNetAgent?this.liveRoomHandler:this.service))&&o.fetchUserList(i,n,n,this.room)},Yt.prototype.handleFetchUserListRsp=function(e,t){var n=this;if(this.stateCenter.reporter.spanEnd({key:_t.event,par:this.room.roomID},{error:(null==(r=null==e?void 0:e.body)?void 0:r.err_code)||(null==e?void 0:e.code),message:(null==(r=null==e?void 0:e.body)?void 0:r.err_message)||(null==e?void 0:e.msg)}),e.body&&0!=e.body.err_code)this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.logger.info(Ie+" fetch error "+e.body.err_code);else if(e.header&&e.body)if(this.room.userStateUpdate){this.userTempList=jt(jt([],this.userTempList,!0),e.body.user_baseinfos,!0);var r=e.body.ret_user_index;if(r!=e.body.server_user_index)this.logger.info(Ie+" fetch another page"),this.fetchUserListWithPage(r+1,t);else{this.userSeq=e.body.server_user_seq;for(var i=[],o=[],a=0;a<this.userTempList.length;a++){var u={userID:this.userTempList[a].id_name,userName:this.userTempList[a].nick_name,role:this.userTempList[a].role};4!==u.role&&(i.push(u),o.push({idName:this.userTempList[a].id_name,nickName:this.userTempList[a].nick_name,role:this.userTempList[a].role}))}this.stateCenter.actionListener("_getTotalUserList",this.room.roomID,o),t==s.login?(this.userList&&G.mergeUserList(this.logger,this.userList,i,(function(e,t){0!==e.length&&n.onUserStateUpdate(n.room.roomID,"ADD",e),0!==t.length&&n.onUserStateUpdate(n.room.roomID,"DELETE",t)})),this.userList=i):0!==(this.userList=i).length&&this.onUserStateUpdate(this.room.roomID,"ADD",i),this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.userTempList=[],this.logger.info(Ie+" call success user_list "+i+", count: "+i.length+", seq: "+this.userSeq)}}else this.logger.info(Ie+" not update");else this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.logger.info(Ie+" fetch error "+e)},Yt.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info(ke+" call"),this.room.userStateUpdate)if(this.userSeq===e.body.user_list_seq)this.logger.warn(ke+" user_list_seq is the same with local seq");else if(this.userSeq+e.body.user_actions.length!==e.body.user_list_seq)this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else{this.userSeq=e.body.user_list_seq;for(var t=[],n=0;n<e.body.user_actions.length;n++){var r={action:e.body.user_actions[n].Action,idName:e.body.user_actions[n].IdName,nickName:e.body.user_actions[n].NickName,role:e.body.user_actions[n].Role,loginTime:e.body.user_actions[n].LoginTime};4!==r.role&&t.push(r)}this.stateCenter.actionListener("_userStateUpdate",e.body.room_id,t);var i=[],o=[];t.forEach((function(e){1==e.action?i.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&o.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList&&(this.userList=this.userList.concat(i).filter((function(e){return!o.some((function(t){return t.userID==e.userID}))}))),0!==i.length&&this.onUserStateUpdate(e.body.room_id,"ADD",i),0!==o.length&&this.onUserStateUpdate(e.body.room_id,"DELETE",o),this.logger.info(ke+" call success")}else this.logger.info(ke+" userStateUpdate is false")},Yt.prototype.onUserStateUpdate=function(e,t,n){var r=this;n=n.filter((function(e){return e.userID!==r.stateCenter.idName}));0!=n.length&&(n=n.map((function(e){return{userID:e.userID,userName:e.userName}})),this.stateCenter.actionListener("roomUserUpdate",e,t,n))},Yt.prototype.mergeUserByUserSeq=function(e,t){var n=this;this.userSeqMergeMap||(this.logger.warn("zm.us.mg new merge userlist "+this.userSeq+" server "+e),this.userSeqMergeMap={},this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){n.handleMergeTimeout()}),this.userListMergeInterval)),this.userSeqMergeMap[e]=t,this.logger.warn("zm.us.mg  merge userlist "+this.userSeq+" server "+e+" userlist "+t.length)},Yt.prototype.mergeUser=function(e){var t=this,n=(this.logger.info("zm.us.mg merge userlist "+this.userSeq+" userSeqList "+e.join(",")),this.userSeq=e[e.length-1],this.lastUserQueryTime=Date.now()+this.userListInterval,{}),r=((e=(e.forEach((function(e){t.userSeqMergeMap&&t.userSeqMergeMap[e].forEach((function(e){n[e.IdName]=e}))})),this.userSeqMergeMap=null,Object.values(n).map((function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):""}})).filter((function(e){return 4!==e.role})))).sort((function(e,t){return e.loginTime.localeCompare(t.loginTime)})),[]),i=[];e.forEach((function(e){1==e.action?r.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&i.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList=this.userList&&this.userList.concat(r).filter((function(e){return!i.some((function(t){return t.userID==e.userID}))})),0!==r.length&&this.onUserStateUpdate(this.room.roomID,"ADD",r),0!==i.length&&this.onUserStateUpdate(this.room.roomID,"DELETE",i),this.stateCenter.actionListener("_userStateUpdate",this.room.roomID,e)},Yt.prototype.handleMergeTimeout=function(){var e,t=this,n=Object.keys(this.userSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));n[n.length-1]-n[0]+1===n.length||n[n.length-1]>=this.minUserSeq?this.mergeUser(n):(this.userSeqMergeMap=null,e=this.lastUserQueryTime-Date.now(),this.logger.info("zm.us.mto  fetch merge userlist "+this.userSeq+" userSeqList "+n.join(",")+" wait "+e),0<e?(this.userQueryTimer&&clearTimeout(this.userQueryTimer),this.userQueryTimer=setTimeout((function(){t.fetchUserList()}),e)):this.fetchUserList())},Yt);function Yt(e,t,n,r,i,o){this.logger=e,this.stateCenter=t,this.dataReport=n,this.liveRoomHandler=r,this.room=i,this.service=o,this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=[],this.userSeqMergeMap=null,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}Object.defineProperty(Zt.prototype,"isUseNetAgent",{get:function(){return this.stateCenter.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(Zt.prototype,"sessionExist",{get:function(){return null!==this.longSid||"0"!==this.sessionID},enumerable:!1,configurable:!0}),Object.defineProperty(Zt.prototype,"roomSidString",{get:function(){return this.isUseNetAgent?this.longRoomSid?this.longRoomSid.toString():"0":this.roomSessionID},enumerable:!1,configurable:!0}),Object.defineProperty(Zt.prototype,"userSidString",{get:function(){return this.isUseNetAgent?this.longSid?this.longSid.toString():"0":this.sessionID},enumerable:!1,configurable:!0}),Zt.prototype.initMessageHandler=function(){},Zt.prototype.initLiveHandler=function(){},Zt.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},Zt.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.roomHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t,n){e.messageHandler&&e.messageHandler.loginRsp(t),e.userHandler.patchUserList(t),e.HBResponse(t,n)}},Zt.prototype.bindRoomHandler=function(){var e=this;this.roomHandler.loginSuccessCallBack=function(t,n){e.logger.info("zm.lrm.brh login suc "+t),e.heartBeatHandler.init(n),e.isUseNetAgent?e.liveRoomHandler.startCheck():e.service&&(e.service.stopCheck(),e.service.startCheck()),e.userHandler.loginRsp(n,t),e.messageHandler&&e.messageHandler.loginRsp(n),e.isMulti||e.handleMultiRoom(),e.roomLoginResponse(n)},this.roomHandler.resetRoomCallBack=function(){var t;e.heartBeatHandler.resetHeartbeat(),e.liveHandler&&e.liveHandler.resetLiveHandler(),e.messageHandler&&e.messageHandler.resetMessageInfo(),e.isUseNetAgent&&e.liveRoomHandler&&e.liveRoomHandler.stopCheck(),e.userHandler.resetUserHandler(),null!=(t=e.service)&&t.stopCheck(),e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.stopMaxTime())}},Zt.prototype.bindUserHandler=function(){},Zt.prototype.bindMessageHandler=function(){},Zt.prototype.bindLiveHandler=function(){},Zt.prototype.HBResponse=function(e,t){this.stateCenter.actionListener("HBResponse",e,t)},Zt.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},Zt.prototype.checkRoomSession=function(e){return this.isUseNetAgent?null!==this.longRoomSid&&this.longRoomSid.eq(e):this.roomSessionID===e},Zt.prototype.handleMultiRoom=function(){var e=this;this.stateCenter.roomModulesList.forEach((function(t){t.runState!==s.login&&t.roomTryHandler&&1==t.isMulti&&(t.roomTryHandler.onactive=function(n,r){var i;r&&0!==r.code?(0!==r.code&&(i=G.getLiveRoomError(r.code,e.isUseNetAgent))&&O[i]&&(r=O[i]),t.roomHandler.roomStateHandle("DISCONNECTED",C.ReconnectFailed,r,r.msg)):t.roomHandler.roomStateHandle("CONNECTED",C.Reconnected,r)},t.roomTryHandler.startMaxTime(),t.roomTryHandler.active())}))},Zt.prototype.isLogin=function(){return this.runState===s.login},Zt.prototype.isLogout=function(){return this.runState===s.logout},Zt.prototype.isTryLogin=function(){return this.runState===s.trylogin},Zt.prototype.isDisConnect=function(){return(this.isUseNetAgent?this.liveRoomHandler:this.service).isDisConnect()},Zt.prototype.retryConnect=function(){this.logger.info("zm.lrm.rc call"),this.isUseNetAgent&&(this.resetSessionInfo(),this.liveRoomHandler.closeRequest())},Zt.prototype.retryRoom=function(){this.logger.info("zm.lrm.rr.0 call"),this.roomTryHandler&&this.rtm.netAgent.isConnect()&&(this.resetRoomSession(),this.resetUserSession(),this.roomTryHandler.active(!0))},Zt.prototype.resetSessionInfo=function(){var e;this.logger.info("zm.lrm.rsi call"),this.resetRoomSession(),this.resetUserSession(),null!=(e=this.liveRoomHandler)&&e.reset()},Zt.prototype.resetRoomSession=function(){this.roomSessionID="0",this.longRoomSid=null},Zt.prototype.resetUserSession=function(){this.sessionID="0",this.longSid=null};var Wt=Zt;function Zt(e,t,n,r,i,o,a){this.roomID=e,this.stateCenter=t,this.logger=n,this.dataReport=r,this.rtm=i,this.liveRoomHandler=o,this.service=a,this.runState=s.logout,this.lastRunState=s.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomSessionID="0",this.sessionID="0",this.longSid=null,this.longRoomSid=null,this.isMulti=!1,this.token="",this.thirdToken="",this.loginTime=0,this.userStateUpdate=!1,this.maxMemberCount=0,this.roomName="",this.roomHandler=new Ft(this.logger,this.stateCenter,this.dataReport,this,o,this.service),this.heartBeatHandler=new zt(this.logger,this.stateCenter,this.dataReport,this.liveRoomHandler,this,this.service),this.userHandler=new Vt(this.logger,this.stateCenter,this.dataReport,this.liveRoomHandler,this,this.service),this.initMessageHandler(),this.initLiveHandler(),this.init()}$t.prototype.createSocket=function(e){this.socket=Object(i.createZegoWebSocket)(e,this.ENV%2)},$t.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},$t.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},$t.prototype.sendMessage=function(e,t,n,r,i){return void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i={timeOut:6e3}),i={data:t={header:e,body:t},seq:e.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:i.timeOut,success:n,error:r},n=this.sendCommandList.push(i),this.sendCommandMap[i.seq]=n,this.socket&&this.socket.send(JSON.stringify(t)),e.seq},$t.prototype.sendPB=function(e){return this.socket&&this.socket.send(e),!0},$t.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)!function(){var n,r,i;e.remove(t),t&&t._data&&(n=t._data.error,r=t._data.seq,i=t._data.data.body.custom_msg,setTimeout((function(){n&&n(O.TIMEOUT,r,i)}),0)),t=e.getFirst()}()},$t.prototype.checkMessageListTimeout=function(e,t){for(var n=e.getFirst(),r=Date.parse(new Date+""),i=0,o=this;null!=n&&"break"!==function(){var s,a,u;return n._data&&n._data.sendTime+n._data.timeOut>r||(n._data&&delete t[n._data.data.header.seq],e.remove(n),n._data&&null==n._data.error||n._data&&n._data.sendTime+o.sendDataDropTimeout<r||n&&n._data&&(s=n._data.error,a=n._data.seq,u=n._data.data.body.custom_msg,setTimeout((function(){s&&s(O.TIMEOUT,a,u)}),0)),++i>=o.sendDataCheckOnceCount)?"break":void(n=e.getFirst())}(););},$t.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},$t.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),this.sendCommandMap={},clearTimeout(this.sendDataCheckTimer)},$t.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(n){t.socket.binaryType="arraybuffer",t.responseHandler(),e(n)})},$t.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){t="string"==typeof t.data?JSON.parse(t.data):t.data,e.onMessage(t)})},$t.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},$t.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},$t.prototype.onMessage=function(e){};var Kt=$t;function $t(e){this.socket=null,this.sendCommandList=new m,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.ENV=e}var Xt=function(){return(Xt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Qt=(Jt.prototype.checkResponse=function(e){return 0!=this.stateCenter.roomModulesList.filter((function(e){return e.runState!==s.logout})).length&&(e.header.appid!==this.stateCenter.appid||e.header.user_id!==this.stateCenter.userid)},Jt.prototype.handleSendCommandMsgRsp=function(e){var t,n=this,r=this.service.sendCommandMap[e.header.seq];null!=r&&(t=r._data,delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(r),0===e.body.err_code?setTimeout((function(){t&&null!=t.success&&t.success(e,n.cmdSeq)}),0):setTimeout((function(){t&&null!=t.error&&t.error(e,n.cmdSeq)}),0))},Jt.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){t instanceof ArrayBuffer?e.stateCenter.actionListener("_protobufResponse",t):t.header?(0!==t.body.err_code?t.body.err_message&&e.logger.error("".concat(Re," cmd=").concat(t.header.cmd,", err_code=").concat(t.body.err_code,", err_message=").concat(t.body.err_message," ")):e.logger.info("".concat(Re," cmd=").concat(t.header.cmd,", msg=").concat(JSON.stringify(t)," ")),-1<["login","logout"].indexOf(t.header.cmd)?e.handleSendCommandMsgRsp(t):e.checkResponse(t)?e.logger.error(Re+"  check session fail."):(e.logger.info("".concat(Re," cmd=").concat(t.header.cmd,",function=").concat(!!e.responseRouters[t.header.cmd])),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq))):e.logger.error("".concat(Re," msg type error "))}},Jt.prototype.handlePushKickout=function(e){var t,n;void 0===(null==(n=null==e?void 0:e.body)?void 0:n.protocol)||1===(null==(n=null==e?void 0:e.body)?void 0:n.protocol)?function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([],this.stateCenter.roomModulesList,!0).forEach((function(t){return t.roomHandler.handlePushKickout(e,!0)})):(t=null==(n=null==e?void 0:e.header)?void 0:n.room_id,(n=this.stateCenter.roomModulesList.find((function(e){return e.roomID==t})))?n.roomHandler.handlePushKickout(e):this.logger.error(Re+" room no found ignore "+JSON.stringify(null==(n=e.header)?void 0:n.room_id)))},Jt.prototype.handlePushCustomMsg=function(e){},Jt.prototype.handlePushRoomMsg=function(e){},Jt.prototype.handlePushUserStateUpdateMsg=function(e){var t,n=null==(r=null==e?void 0:e.header)?void 0:r.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==n})),i=this.stateCenter.reporter.createSpan(a.H,{key:Ve.event,par:n},{key:""},ut.event);r?(i.setAttributes({user_list_seq:null==(t=null==e?void 0:e.body)?void 0:t.user_list_seq,update_user:null==(t=null==e?void 0:e.body)?void 0:t.user_actions}),i.end(),r.userHandler.handlePushUserStateUpdateMsg(e)):(this.logger.error(Re+" room no found ignore "+JSON.stringify(e)),this.stateCenter.reporter.setError(i,ut.error.ROOM_NOT_EXIST))},Jt.prototype.handlePushMergeMsg=function(e){},Jt.prototype.handlePushTransMsg=function(e){},Jt.prototype.handleBigImMsgRsp=function(e){},Jt.prototype.handlePushSignalMsg=function(e){},Jt.prototype.handlePushTokenExpire=function(e){this.stateCenter.actionListener("_tokenExpired",e)},Jt.prototype.closeHandler=function(e){this.service.closeHandler(e)},Jt.prototype.openHandler=function(e){this.service.openHandler(e)},Jt.prototype.errorHandler=function(e){this.service.errorHandler(e)},Jt.prototype.getHeader=function(e,t,n,r){return{Protocol:"req",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:t||"",room_id:n||"",room_session_id:r||"",biz_version:this.stateCenter.bizVersion||""}},Jt.prototype.startCheck=function(){this.logger.info("zm.sc.0 start"),this.service.startCheck()},Jt.prototype.stopCheck=function(){this.logger.info("zm.sc.1 stop"),this.service.stopCheck()},Jt.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},Jt.prototype.createSocket=function(e){var t=this;this.stateCenter.roomServer=e,this.service.createSocket(e),this.responseRouters=Xt(Xt({},this.responseRouters),{push_kickout:function(e){t.handlePushKickout(e)},push_custommsg:function(e){t.handlePushCustomMsg(e)},push_im_chat:function(e){t.handlePushRoomMsg(e)},push_userlist_update:function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)},push_token_expire:function(e){t.handlePushTokenExpire(e)}})},Jt.prototype.closeSocket=function(){this.service.closeSocket()},Jt.prototype.sendMessage=function(e,t,n,r,i,o){var s,a;return this.service.isDisConnect()?(this.logger.error("zm.sv.sd socket is disconnect"),r(O.SOCKET_CLOSE),0):(s=null!=o&&o.roomID?o.roomID:null==(s=this.stateCenter.roomModulesList[0])?void 0:s.roomID,a=null!=o&&o.roomSessionID?o.roomSessionID:null==(a=this.stateCenter.roomModulesList[0])?void 0:a.roomSessionID,o=null!=o&&o.sessionID?o.sessionID:null==(o=this.stateCenter.roomModulesList[0])?void 0:o.sessionID,i=i||this.getHeader(e,o,s,a),this.logger.info("zm.sv.sd sendMsg:"+JSON.stringify({header:i,body:t})),this.service.sendMessage(i,t,n,r))},Jt.prototype.on=function(e,t){this.responseRouters[e]=t},Jt.prototype.login=function(e,t,n){var r=this.getHeader(e.isMulti?"enter":"login",e.sessionID,e.roomID,e.roomSessionID);e={id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:e.token,version:this.stateCenter.sdKVersion,room_name:e.roomID,user_state_flag:e.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:0===this.stateCenter.ENV?l.ClientType_Webrtc:l.ClientType_SmallProgram,third_token:e.thirdToken,user_count_limit:e.maxMemberCount,relate_service:this.stateCenter.relateService.join()||"",login_logic:this.stateCenter.isMultiRoom?3:1,proto_format:this.stateCenter.protoFormat};return this.sendMessage("",e,t,n,r)},Jt.prototype.logout=function(e,t,n){var r=e.isMulti?"quit":"logout",i={reserve:0};return"logout"==r&&(i.login_logic=this.stateCenter.isMultiRoom?3:1),this.sendMessage(r,i,t,n,void 0,{sessionID:e.sessionID,roomID:e.roomID,roomSessionID:e.roomSessionID})},Jt.prototype.heartBeat=function(e,t,n){return this.sendMessage("hb",{reserve:0},e,t,void 0,n)},Jt.prototype.fetchUserList=function(e,t,n,r){return this.sendMessage("user_list",e,t,n,void 0,r)},Jt.prototype.fetchUserListV2=function(e,t,n,r){return this.sendMessage("user_list_v2",e,t,n,void 0,r)},Jt.prototype.fetchReliableMessage=function(e,t,n,r){return this.sendMessage("trans_fetch",e,t,n,void 0,r)},Jt.prototype.sendReliableMessage=function(e,t,n,r){return this.sendMessage("trans",e,t,n,void 0,r)},Jt.prototype.sendRoomMsg=function(e,t,n,r){return this.sendMessage("im_chat",e,t,n,void 0,r)},Jt.prototype.sendCustomCommand=function(e,t,n,r){return this.sendMessage("custommsg",e,t,n,void 0,r)},Jt.prototype.sendBigRoomMessage=function(e,t,n,r){return this.sendMessage("bigim_chat",e,t,n,void 0,r)},Jt.prototype.sendRelayMessage=function(e,t,n,r){return this.sendMessage("relay",e,t,n,void 0,r)},Jt.prototype.sendSignalCmd=function(e,t,n,r){return this.sendMessage("signal",e,t,n,void 0,r)},Jt.prototype.sendPB=function(e){return this.service.isDisConnect()||this.stateCenter.networkState==u.offline?(this.logger.error("zm.spb socket is disconnected"),!1):this.service.sendPB(e)},Jt);function Jt(e,t,n){this.stateCenter=e,this.logger=t,this.rtm=n,this.service=new Kt(this.stateCenter.ENV),this.cmdSeq=0,this.responseRouters={}}tn.prototype.setSetting=function(e,t){var n,r,i=Array.isArray(t)&&0<t.length;for(n in e)if("number"==typeof e[n].ctrlmode&&[1,2].includes(e[n].ctrlmode))this.setting[n]=e[n],this.setting[n+"_ctrlmode"]=e[n].ctrlmode;else for(var o in e[n])o.endsWith("_ctrlmode")||i&&-1==t.indexOf(o)||(1===(r=e[n][o+"_ctrlmode"])||2===r?this.setting[o]=e[n][o]:this.defaultSetting[o]&&(this.setting[o]=this.defaultSetting[o]),"number"==typeof r&&(this.setting[o+"_ctrlmode"]=e[n][o+"_ctrlmode"]))},tn.prototype.getSetting=function(e,t){return(t=void 0!==t&&t)&&2!=this.setting[e+"_ctrlmode"]?void 0:this.setting[e]};var en=tn;function tn(){this.defaultSetting={remote_log_level:"info",zip_log:0,detaillog_domain:""},this.requestList={},this.setting=JSON.parse(JSON.stringify(this.defaultSetting))}for(var nn=n(2),rn=nn.roots,on=nn.types?nn.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},sn=nn.types?nn.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},an=Object.keys(on),un=nn.util.Long?nn.util.Long.fromBits:function(){return 0},cn={$:function(e){return cn[e]?cn[e].call(this):rn[e].decode?rn[e].decode(this,this.uint32()):cn.$.call(this,"int32")}},ln={$:function(e,t,n){var r=on[e];return void 0===r?rn[e].encode?(this.uint32((n<<3|2)>>0).fork(),rn[e].encode(t,this).ldelim()):ln.$.call(this,"int32",t,n):ln[e].call(this.uint32(n<<3|r),t)}},hn=0;hn<an.length;hn++)cn[an[hn]]=nn.Reader.prototype[an[hn]],ln[an[hn]]=nn.Writer.prototype[an[hn]];!function e(t,n,r,i){for(var o=0,s=Object.keys(t);o<s.length;o++){var a=s[o];if(t[a].$m&&Object.keys(t[a].$m).every((function(e){return Number(e)}))){if(r[a])throw Error(`nested type ${r}.${a} has already exist`);r[a]=function(t,r){function i(e){for(var n in t)"{"===(n=t[n])[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[]);if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)null!=e[r[i]]&&(this[r[i]]=e[r[i]])}var o,s={};for(o in t){var a=t[o],u=a[1];"{"===u.charAt(0)?(i.prototype[a[0]]=nn.util.emptyObject,s[u]={$m:u.substring(1).split(",").map((function(e,t){return["$"+(t+1),e,null]})).reduce((function(e,t,n){return e[n+1]=t,e}),{})}):"["===u.charAt(0)||"<"===u.charAt(0)?i.prototype[a[0]]=nn.util.emptyArray:"bytes"===u?i.prototype[a[0]]=nn.util.newBuffer([]):a[2]&&a[2].hasOwnProperty("low")&&a[2].hasOwnProperty("high")?i.prototype[a[0]]=un(a[2].low,a[2].high,a[2].unsigned):i.prototype[a[0]]=a[2]}return i.create=function(e){return new i(e)},i.decode=function(e,n){e instanceof nn.Reader||(e=nn.Reader.create(e));for(var r=void 0===n?e.len:e.pos+n,o=new i;e.pos<r;){var s=e.uint32(),a=s>>>3;if(0<a&&t[a]){var u=t[a][0],c=t[a][1];if("{"===c.charAt(0))o[u]===nn.util.emptyObject&&(o[u]={}),a=i.$namespace[c].decode(e,e.uint32()),o[u][a.$1]=a.$2;else if("["===c.charAt(0)||"<"===c.charAt(0))if(c=c.substring(1),o[u]&&o[u].length||(o[u]=[]),void 0!==sn[c]&&2==(7&s))for(var l=e.uint32()+e.pos;e.pos<l;)o[u].push(cn.$.call(e,c));else o[u].push(cn.$.call(e,c));else o[u]=cn.$.call(e,c)}else e.skipType(7&s)}return o},i.encode=function(e,n){for(var r in n=n||nn.Writer.create(),t){var o=t[r][0];if("{"===(c=t[r][1]).charAt(0)){if(null!=e[o]&&e.hasOwnProperty(o))for(var s=0,a=Object.keys(e[o]);s<a.length;++s)n.uint32((r<<3|2)>>0).fork(),i.$namespace[c].encode({$1:a[s],$2:e[o][a[s]]},n).ldelim()}else if("["===c.charAt(0)||"<"===c.charAt(0)){var u="<"===c.charAt(0),c=c.substring(1),l=e[o];if(null!=l&&l.length)if(u&&void 0!==sn[c]){for(n.uint32((r<<3|2)>>0).fork(),s=0;s<l.length;s++)ln[c].call(n,l[s]);n.ldelim()}else for(s=0;s<l.length;s++)ln.$.call(n,c,l[s],r)}else null!=e[o]&&e.hasOwnProperty(o)&&ln.$.call(n,c,e[o],r)}return n},Object.keys(s).length&&(i.$namespace=e(s,n+"."+r,i.$namespace||{},!0)),i}(t[a].$m,a)}else t[a].$s?r[a]=function(e,t){function r(e,t,n){nn.rpc.Service.call(this,e,t,n)}return((r.prototype=Object.create(nn.rpc.Service.prototype)).constructor=r).create=function(e,t,n){return new r(e,t,n)},Object.keys(e).forEach((function(i){var o=e[i];function s(e,t){return this.rpcCall(s,rn[o[0]],rn[o[1]],e,t)}Object.defineProperty(s,"name",{value:i}),Object.defineProperty(s,"path",{value:n+"."+t}),r.prototype[i]=s})),r}(t[a].$s,a):t[a].$e&&Object.values(t[a].$e).every((function(e){return Number(e)===e}))&&(r[a]=function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[n[t[r]]=e[t[r]]]=t[r];return n}(t[a].$e));r[a]&&!i&&(rn[n+"."+a]=r[a]),delete t[a].$m,delete t[a].$s,delete t[a].$e,r[a]=e(t[a],n?n+"."+a:a,r[a]||{})}return r}({PB:{liveroom_cs_v3:{AddStreamReq:{$m:{1:["stream_id","bytes",[]],2:["stream_title","bytes",[]],3:["stream_type","uint32",0],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["third_token","bytes",[]],8:["censor_mode","uint32",0],9:["need_gather","uint32",0]}},AddStreamRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_sid","string",""],4:["stream_ver","uint32",0],5:["stream_nid","uint32",0],6:["token_remain_time","uint32",0]}},AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},BigImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","bytes",[]],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}]}},CommonRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},DeleteStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["client_req_seq","uint32",0]}},DeleteStreamRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},EnterRoomReq:{$m:{1:["net_type","uint32",0],2:["conn_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["third_token","bytes",[]],7:["room_create_flag","uint32",0],8:["user_state_flag","uint32",0],9:["user_count_limit","uint32",0],10:["relate_service","string",""],11:["need_gather_stream","uint32",0],12:["callback_data","bytes",[]],13:["service_flags","uint32",0],14:["license_token","bytes",[]]}},EnterRoomRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["user_id","uint64",{low:0,high:0,unsigned:!0}],5:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],6:["big_im_time_window","uint32",0],7:["liveroom_hb_interval","uint32",0],8:["liveroom_hb_timeout","uint32",0],9:["online_count","uint32",0],10:["anchor_info","PB.liveroom_cs_v3.AnchorInfo",null],11:["userlist_merge_timeout","uint32",0],12:["userlist_interval","uint32",0],13:["token_remain_time","uint32",0],14:["trans_list_seq","uint32",0],15:["trans_channel_list","<PB.liveroom_cs_v3.TransChannel",null],16:["stream_count","uint32",0],17:["stream_list_seq","uint32",0],18:["stream_info_list","<PB.liveroom_cs_v3.StreamInfo",null],19:["stream_fetch_flag","uint32",0],20:["stream_list_push_merge_timeout","uint32",0],21:["stream_list_hb_merge_timeout","uint32",0],22:["relate_result_list","<PB.liveroom_cs_v3.RelateResult",null],23:["gather_list_seq","uint32",0],24:["gather_info_list","<PB.liveroom_cs_v3.GatherInfo",null]}},EnumSignalTransmitResult:{$e:{ok:0,version_err:1}},GatherInfo:{$m:{1:["gather_id","string",""]}},GetGatherListReq:{$m:{}},GetGatherListRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["gather_list_seq","uint32",0],3:["gather_info_list","<PB.liveroom_cs_v3.GatherInfo",null]}},GetImReq:{$m:{1:["msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["sort_type","uint32",0],3:["msg_count","uint32",0]}},GetImRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],3:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<PB.liveroom_cs_v3.GetImRspImData",null]}},GetImRspImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},GetStreamListReq:{$m:{}},GetStreamListRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["stream_list_seq","uint32",0],3:["stream_info_list","<PB.liveroom_cs_v3.StreamInfo",null],4:["stream_refresh","uint32",0]}},GetTransReq:{$m:{1:["trans_channel","bytes",[]],2:["trans_list","<PB.liveroom_cs_v3.GetTransReqTransData",null]}},GetTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetTransRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["trans_list_seq","uint32",0],4:["trans_list","<PB.liveroom_cs_v3.GetTransRspTransData",null]}},GetTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},GetUserlistReq:{$m:{1:["sort_type","uint32",0],2:["user_index","uint32",0]}},GetUserlistRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["server_user_seq","uint64",{low:0,high:0,unsigned:!0}],3:["server_user_index","int64",{low:0,high:0,unsigned:!1}],4:["ret_user_index","int64",{low:0,high:0,unsigned:!1}],5:["user_base_info_list","<PB.liveroom_cs_v3.UserBaseInfo",null]}},GetUserTransReq:{$m:{1:["trans_channel","bytes",[]],2:["user_trans_list","<PB.liveroom_cs_v3.GetUserTransReqTransData",null]}},GetUserTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetUserTransRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["user_trans_list","<PB.liveroom_cs_v3.GetUserTransRspTransData",null]}},GetUserTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},HbReq:{$m:{}},HbRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],3:["hb_interval","uint32",0],4:["hb_timeout","uint32",0],5:["stream_seq","uint32",0],6:["user_seq","int64",{low:0,high:0,unsigned:!1}],7:["online_count","uint32",0],8:["big_im_time_window","uint32",0],9:["trans_channel_list","<PB.liveroom_cs_v3.TransChannel",null],10:["user_trans_channel_list","<PB.liveroom_cs_v3.TransChannel",null],11:["stream_refresh","uint32",0],12:["trans_list_seq","uint32",0],13:["gather_list_seq","uint32",0]}},ImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},LiveroomSessionInfo:{$m:{1:["RoomId","bytes",[]],2:["UserSessionId","uint64",{low:0,high:0,unsigned:!0}],3:["RoomSessionId","uint64",{low:0,high:0,unsigned:!0}],4:["Role","uint32",0]}},PushBigIm:{$m:{1:["msg_list","<PB.liveroom_cs_v3.BigImData",null]}},PushIm:{$m:{1:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<PB.liveroom_cs_v3.ImData",null]}},PushStartGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStopGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStream:{$m:{1:["stream_seq","uint32",0],2:["stream_info_list","<PB.liveroom_cs_v3.PushStreamInfo",null]}},PushStreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["stream_src","uint32",0],9:["stream_state","uint32",0],10:["stream_type","uint32",0],11:["stream_nid","uint32",0],12:["extra_info","bytes",[]],13:["create_time","int64",{low:0,high:0,unsigned:!1}],14:["close_type","uint32",0],15:["need_gather","uint32",0]}},PushTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_type","bytes",[]],5:["trans_data","bytes",[]],6:["trans_seq","uint32",0],7:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],8:["trans_channel","bytes",[]],9:["trans_list_seq","uint32",0]}},PushUserInfoUpdated:{$m:{1:["server_user_seq","int64",{low:0,high:0,unsigned:!1}],2:["user_action_list","<PB.liveroom_cs_v3.UserAction",null]}},PushUserKickout:{$m:{1:["id_name","bytes",[]],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["kickout_reason","int32",0],4:["custom_reason","bytes",[]]}},PushUserLogReport:{$m:{}},PushUserTokenExpire:{$m:{1:["token","string",""],2:["stop_stream_info","PB.liveroom_cs_v3.StopStream",null]}},PushUserTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_channel","bytes",[]],6:["trans_seq_list","<PB.liveroom_cs_v3.PushUserTransInfo",null]}},PushUserTransInfo:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_seq","uint32",0]}},QuitRoomReq:{$m:{}},QuitRoomRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},RenewTokenReq:{$m:{1:["token","string",""]}},RenewTokenRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["token_remain_time","uint32",0],3:["stop_stream_id_list","<bytes",null]}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SendBigImReq:{$m:{1:["msg_list","<PB.liveroom_cs_v3.SendBigImReqMsgData",null]}},SendBigImReqMsgData:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}],5:["msg_client_id","bytes",[]]}},SendBigImRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["big_im_time_window","uint32",0],3:["msg_list","<PB.liveroom_cs_v3.SendBigImRspMsgData",null]}},SendBigImRspMsgData:{$m:{1:["msg_id","bytes",[]],2:["msg_client_id","bytes",[]]}},SendImReq:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SendImRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["msg_id","uint64",{low:0,high:0,unsigned:!0}]}},SetTransReq:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_local_seq","uint32",0],4:["trans_channel","bytes",[]]}},SetTransRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["trans_type","bytes",[]],3:["trans_seq","uint32",0],4:["trans_list_seq","uint32",0],5:["trans_channel","bytes",[]]}},SetUserAttrReq:{$m:{1:["use_data_channel","uint32",0],2:["is_modify_use_data_channel","bool",!1],3:["user_type","uint32",0],4:["is_modify_user_type","bool",!1]}},SetUserAttrRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalLiveCustomReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SignalLiveCustomRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalLiveInviteReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SignalLiveInviteRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalLiveRequestReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SignalLiveRequestRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalLiveResultReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SignalLiveResultRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalLiveStopReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<PB.liveroom_cs_v3.ToUser",null]}},SignalLiveStopRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null]}},SignalTransmitReq:{$m:{1:["to_user_list","<bytes",null],2:["transmit_data","bytes",[]]}},SignalTransmitResult:{$m:{1:["to_user","bytes",[]],2:["result","PB.liveroom_cs_v3.EnumSignalTransmitResult",0]}},SignalTransmitRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["result","<PB.liveroom_cs_v3.SignalTransmitResult",null]}},StopStream:{$m:{1:["stream_id_list","<bytes",null]}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["create_time","int64",{low:0,high:0,unsigned:!1}],9:["stream_src","uint32",0],10:["stream_state","uint32",0],11:["stream_type","uint32",0],12:["stream_nid","uint32",0],13:["extra_info","bytes",[]],14:["need_gather","uint32",0]}},ToUser:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}]}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<PB.liveroom_cs_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}},UpdateStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["stream_title","bytes",[]],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["nick_name","bytes",[]]}},UpdateStreamRsp:{$m:{1:["rsp_head","PB.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},UserAction:{$m:{1:["action","uint32",0],2:["id_name","bytes",[]],3:["nick_name","bytes",[]],4:["role","uint32",0],5:["login_time","int64",{low:0,high:0,unsigned:!1}]}},UserBaseInfo:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0]}}},proto_switch_v3:{AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},CommonRsp:{$m:{1:["rsp_head","PB.proto_switch_v3.RspHead",null]}},GatherInfo:{$m:{1:["gather_id","string",""]}},Header:{$m:{1:["cmd","uint32",0],2:["seq","uint32",0],3:["timestamp","int64",{low:0,high:0,unsigned:!1}],4:["controls","bytes",[]],5:["flags","bytes",[]],6:["context_key","uint32",0],101:["dev_traffic_label","bytes",[]]}},LiveroomProtoVersion:{$e:{PROTO_VERSION_NONE:0,RPOTO_V020000:131072}},LoginRoomReq:{$m:{1:["app_id","uint32",0],2:["biz_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["device_id","string",""],9:["term_type","PB.proto_switch_v3.TermType",0],10:["net_type","PB.proto_switch_v3.NetType",0],11:["sdk_conn_type","PB.proto_switch_v3.SdkConnType",0],12:["sdk_version","uint32",0],13:["biz_version","string",""],14:["client_stamp","bytes",[]],15:["login_logic","uint32",0],16:["third_token","bytes",[]],17:["login_token","bytes",[]],18:["relogin_token","bytes",[]],19:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],20:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],21:["room_create_flag","uint32",0],22:["user_state_flag","uint32",0],23:["user_count_limit","uint32",0],24:["relate_service","string",""],25:["need_gather_stream","uint32",0],26:["callback_data","bytes",[]],27:["service_flags","uint32",0],28:["license_token","bytes",[]]}},LoginRoomRsp:{$m:{1:["rsp_head","PB.proto_switch_v3.RspHead",null],2:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],5:["user_id","uint64",{low:0,high:0,unsigned:!0}],6:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],7:["big_im_time_window","uint32",0],8:["liveroom_hb_interval","uint32",0],9:["liveroom_hb_timeout","uint32",0],10:["online_count","uint32",0],11:["anchor_info","PB.proto_switch_v3.AnchorInfo",null],12:["relogin_token","bytes",[]],13:["userlist_merge_timeout","uint32",0],14:["userlist_interval","uint32",0],15:["token_remain_time","uint32",0],16:["trans_list_seq","uint32",0],17:["trans_channel_list","<PB.proto_switch_v3.TransChannel",null],18:["stream_count","uint32",0],19:["stream_list_seq","uint32",0],20:["stream_info_list","<PB.proto_switch_v3.StreamInfo",null],21:["stream_fetch_flag","uint32",0],22:["stream_list_push_merge_timeout","uint32",0],23:["stream_list_hb_merge_timeout","uint32",0],24:["relate_result_list","<PB.proto_switch_v3.RelateResult",null],25:["gather_list_seq","uint32",0],26:["gather_info_list","<PB.proto_switch_v3.GatherInfo",null]}},LogoutRoomReq:{$m:{1:["logout_code","uint32",0],2:["logout_check","bytes",[]],3:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["logout_logic","uint32",0]}},LogoutRoomRsp:{$m:{1:["rsp_head","PB.proto_switch_v3.RspHead",null]}},MergePushHead:{$m:{1:["qos_flag","uint32",0],2:["send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0],3:["msg_body","bytes",[]]}},MergePushReq:{$m:{1:["head","PB.proto_switch_v3.MergePushHead",null],2:["message_list","<PB.proto_switch_v3.MergePushInfo",null]}},MergePushRsp:{$m:{1:["message_list","<PB.proto_switch_v3.MergePushRspInfo",null],2:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushRspInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0]}},NetType:{$e:{NT_NONE:0,NT_LINE:1,NT_WIFI:2,NT_2G:3,NT_3G:4,NT_4G:5,NT_UNKNOWN:32}},PushKickout:{$m:{1:["reason","uint32",0],2:["message","string",""],3:["is_need_relogin","uint32",0]}},PushReq:{$m:{1:["head","PB.proto_switch_v3.PushReqHead",null],2:["msg_body","bytes",[]]}},PushReqHead:{$m:{1:["sub_cmd","uint32",0],2:["qos_flag","uint32",0],3:["send_time","int64",{low:0,high:0,unsigned:!1}]}},PushRsp:{$m:{1:["code","uint32",0],2:["message","string",""],3:["sub_cmd","uint32",0],4:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SdkConnType:{$e:{SdkConnType_None:0,SdkConnType_Tcp:1,SdkConnType_Websocket:2}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["create_time","int64",{low:0,high:0,unsigned:!1}],6:["extra_info","bytes",[]],7:["title","bytes",[]],8:["stream_ver","uint32",0],9:["stream_attr","bytes",[]],10:["stream_src","uint32",0],11:["stream_state","uint32",0],12:["stream_type","uint32",0],13:["stream_nid","uint32",0],14:["need_gather","uint32",0]}},TermType:{$e:{TT_NONE:0,TT_PC:1,TT_IOS:2,TT_ANDROID:3,TT_MAC:4,TT_LINUX:5,TT_WEB:6,TT_MINI_PROGRAM:7,TT_UNKNOWN:32}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<PB.proto_switch_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}}}}},"",rn,!1),nn.util.global.PB=rn.PB;t=rn.PB;var dn,fn={1002:"LoginRoomRsp",1004:"LogoutRoomRsp",1101:"PushReq",1103:"MergePushReq",1105:"PushKickout",10001:"PushUserInfoUpdated",10002:"PushUserKickout",10003:"PushUserLogReport",10004:"PushUserTokenExpire",12001:"PushStream",12002:"PushStream",12003:"PushStream",13001:"PushIm",14001:"PushBigIm",15001:"PushTrans",15002:"PushUserTrans",301002:"EnterRoomRsp",301004:"QuitRoomRsp",301006:"HbRsp",301008:"RenewTokenRsp",301012:"SetTransRsp",301014:"GetTransRsp",302002:"AddStreamRsp",302004:"DeleteStreamRsp",302006:"UpdateStreamRsp",302008:"GetStreamListRsp",303002:"SendImRsp",303006:"SendBigImRsp",303010:"SignalLiveRequestRsp",303012:"SignalLiveResultRsp",303014:"SignalLiveInviteRsp",303016:"SignalLiveStopRsp",303018:"SignalLiveCustomRsp",304002:"GetUserlistRsp"},pn=((pn=dn=dn||{})[pn.LoginRoomReq=1001]="LoginRoomReq",pn[pn.LoginRoomRsp=1002]="LoginRoomRsp",pn[pn.LogoutRoomReq=1003]="LogoutRoomReq",pn[pn.LogoutRoomRsp=1004]="LogoutRoomRsp",pn[pn.PushReq=1101]="PushReq",pn[pn.PushRsp=1102]="PushRsp",pn[pn.MergePushReq=1103]="MergePushReq",pn[pn.MergePushRsp=1104]="MergePushRsp",pn[pn.PushKickout=1105]="PushKickout",pn[pn.PushUserInfoUpdated=10001]="PushUserInfoUpdated",pn[pn.PushUserKickout=10002]="PushUserKickout",pn[pn.PushUserLogReport=10003]="PushUserLogReport",pn[pn.PushUserTokenExpire=10004]="PushUserTokenExpire",pn[pn.PushIm=13001]="PushIm",pn[pn.PushBigIm=14001]="PushBigIm",pn[pn.PushTrans=15001]="PushTrans",pn[pn.PushUserTrans=15002]="PushUserTrans",pn[pn.EnterRoomReq=301001]="EnterRoomReq",pn[pn.EnterRoomRsp=301002]="EnterRoomRsp",pn[pn.QuitRoomReq=301003]="QuitRoomReq",pn[pn.QuitRoomRsp=301004]="QuitRoomRsp",pn[pn.HbReq=301005]="HbReq",pn[pn.HbRsp=301006]="HbRsp",pn[pn.RenewTokenReq=301007]="RenewTokenReq",pn[pn.RenewTokenRsp=301008]="RenewTokenRsp",pn[pn.SetUserAttrReq=301009]="SetUserAttrReq",pn[pn.SetUserAttrRsp=301010]="SetUserAttrRsp",pn[pn.SetTransReq=301011]="SetTransReq",pn[pn.SetTransRsp=301012]="SetTransRsp",pn[pn.GetTransReq=301013]="GetTransReq",pn[pn.GetTransRsp=301014]="GetTransRsp",pn[pn.GetUserTransReq=301015]="GetUserTransReq",pn[pn.GetUserTransRsp=301016]="GetUserTransRsp",pn[pn.AddStreamReq=302001]="AddStreamReq",pn[pn.AddStreamRsp=302002]="AddStreamRsp",pn[pn.DeleteStreamReq=302003]="DeleteStreamReq",pn[pn.DeleteStreamRsp=302004]="DeleteStreamRsp",pn[pn.UpdateStreamReq=302005]="UpdateStreamReq",pn[pn.UpdateStreamRsp=302006]="UpdateStreamRsp",pn[pn.GetStreamListReq=302007]="GetStreamListReq",pn[pn.GetStreamListRsp=302008]="GetStreamListRsp",pn[pn.SendImReq=303001]="SendImReq",pn[pn.SendImRsp=303002]="SendImRsp",pn[pn.GetImReq=303003]="GetImReq",pn[pn.GetImRsp=303004]="GetImRsp",pn[pn.SendBigImReq=303005]="SendBigImReq",pn[pn.SendBigImRsp=303006]="SendBigImRsp",pn[pn.SignalLiveRequestReq=303009]="SignalLiveRequestReq",pn[pn.SignalLiveRequestRsp=303010]="SignalLiveRequestRsp",pn[pn.SignalLiveResultReq=303011]="SignalLiveResultReq",pn[pn.SignalLiveResultRsp=303012]="SignalLiveResultRsp",pn[pn.SignalLiveInviteReq=303013]="SignalLiveInviteReq",pn[pn.SignalLiveInviteRsp=303014]="SignalLiveInviteRsp",pn[pn.SignalLiveStopReq=303015]="SignalLiveStopReq",pn[pn.SignalLiveStopRsp=303016]="SignalLiveStopRsp",pn[pn.SignalLiveCustomReq=303017]="SignalLiveCustomReq",pn[pn.SignalLiveCustomRsp=303018]="SignalLiveCustomRsp",pn[pn.SignalTransmitReq=303019]="SignalTransmitReq",pn[pn.SignalTransmitRsp=303020]="SignalTransmitRsp",pn[pn.GetUserlistReq=304001]="GetUserlistReq",pn[pn.GetUserlistRsp=304002]="GetUserlistRsp",n(2)),gn=n(12),_n=n.n(gn),mn=(gn=n(4),n.n(gn)),vn=(yn.prototype.md5Bytes=function(e){return this.wordArray2Uint8Array(mn()(this.uint8Array2WordArray(e)))},yn.prototype.wordArray2Uint8Array=function(e){for(var t=e.words,n=e.sigBytes,r=new Uint8Array(n),i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r[i]=o}return r},yn.prototype.uint8Array2WordArray=function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e[r])<<24-r%4*8;return _n.a.create(n,t)},yn);function yn(){}function Sn(e){var t=unescape||window.unescape;return Uint8Array.from(Array.from(t(encodeURIComponent(e))).map((function(e){return e.charCodeAt(0)})))}function En(e){var t=escape||window.escape;return decodeURIComponent(t(String.fromCharCode.apply(String,Array.from(e))))}gn=n(0);var bn,Tn=n.n(gn),Cn=function(){return(Cn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},wn=(pn.util.Long=Tn.a,pn.configure(),t),Rn=t.liveroom_cs_v3,In=t.proto_switch_v3,kn=((gn=bn=bn||{})[gn.disconnected=0]="disconnected",gn[gn.broken=1]="broken",gn[gn.connected=2]="connected",Object.defineProperty(On.prototype,"nickName",{get:function(){return Sn(this.stateCenter.nickName)},enumerable:!1,configurable:!0}),Object.defineProperty(On.prototype,"TermType",{get:function(){return this.stateCenter.ENV%2==0?o.TT_WEB:o.TT_MINIPROGRAM},enumerable:!1,configurable:!0}),On.prototype.isDisConnect=function(){return this.state!==bn.connected},On.prototype.getHeader=function(e,t){return e={cmd:e,seq:++this.seq,timestamp:(new Date).getTime()},this.controls&&(e.controls=this.controls),null!=t&&t.contextKey&&(e.context_key=null==t?void 0:t.contextKey),t=In.Header.create(e),t=In.Header.encode(t).finish(),[e.seq,t]},On.prototype.isUaConnect=function(){return this.ua.isConnect()},On.prototype.sendMessage=function(e,t,n,r,i,o,s){var a=this;if(void 0===o&&(o={timeout:6e3}),void 0===s&&(s=!0),this.logger.info(Ae+" call"),"LoginRoomReq"!==e&&this.state!==bn.connected)return this.logger.warn(Ae+" state "+this.state),-1;if("number"==typeof e)l=e;else if(void 0===(l=dn[e]))return this.logger.warn(Ae+" cmd not found "+e),-1;var u=0,c=void 0!==(null==i?void 0:i.roomID)?null==i?void 0:i.roomID:null==(c=this.stateCenter.roomModulesList[0])?void 0:c.roomID,l=(c=("LoginRoomReq"!==e&&c&&(u=this.roomIDKeys[c]),this.getHeader(l,{contextKey:u})))[1];u=t,t=this.getHead(l.length,u.length),t=new Uint8Array(Array.from(t).concat(Array.from(l)).concat(Array.from(u)));return s&&(l={seq:this.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeout:o.timeout,success:n,error:function(e,t,n){var i;if(a.logger.info(Ae+" seq: "+t+" "+JSON.stringify(e)+" "+JSON.stringify(n)),(null==(i=null==e?void 0:e.header)?void 0:i.cmd)!==dn.LoginRoomRsp&&-1<[1002,105].indexOf(null==(i=null==e?void 0:e.body)?void 0:i.err_code))return(null==(i=null==e?void 0:e.header)?void 0:i.cmd)===dn.EnterRoomRsp&&null!=n&&n.roomID?(i=a.stateCenter.roomModulesList.find((function(e){return e.roomID==n.roomID})))?void i.retryRoom():void a.logger.error(Ae+" room no found ignore "):void a.rtm.retryRoom();[207,208].indexOf(null==(i=null==e?void 0:e.body)?void 0:i.err_code),r&&r(e,t)},params:i},u=this.sendCommandList.push(l),this.sendCommandMap[l.seq]=u),this.logger.info(Ae+" seq: "+c[0]+" cmd: "+e),null!=(s=this.liveroomRequest)&&s.sendRequest({payload:t,ack:"LoginRoomReq"===e},(function(e){a.logger.info(Ae+" fail")}),(function(){a.logger.info(Ae+" ack")}),{}),c[0]},On.prototype.getHead=function(e,t){var n=new Uint8Array(7);return n[0]=49,n[1]=e>>8,n[2]=e-(n[1]<<8),n.set(new Uint8Array(Int32Array.from([t]).buffer).reverse(),3),n},On.prototype.handlePush=function(e,t){var n,r,i;49===e[0]&&(i=(e[1]<<8)+e[2],n=In.Header.decode(e.slice(7,7+i)),e=e.slice(7+i),fn[n.cmd]?(i=this.decodeResponseBody(n,e),this.swPushCmdList.includes(n.cmd)?this.handleSwitchPush(n,i):(r=fn[n.cmd]||n.cmd,this.logger.info("zm.lrh.hp down "+r+" "+JSON.stringify(this.transBuf(i))),r={header:this.transHeader(n),body:this.transRsp(i)},void 0!==(i=this.roomKeyIDs[n.context_key])&&(r.header.room_id=i),this.handleSendCommandMsgRsp(r))):(this.logger.info("zm.lrh.hp cmd is not rtc"),this.onSwitchMessage(n,e)))},On.prototype.handleSwitchPush=function(e,t){var n,r,i=this.roomKeyIDs[e.context_key];if(i||this.noContextKeyCmdList.includes(e.cmd))if(e.cmd===dn.PushReq)if((r=this.transRsp(t.head)).room_id=i,this.stateCenter.roomModulesList.find((function(e){return e.roomID==i}))){var o,s,a,u=void 0,c={header:r,body:u=this.unStructCmdList.includes(t.head.sub_cmd)?{signal_msg:En(t.msg_body),sub_cmd:t.head.sub_cmd}:11005===t.head.sub_cmd?{custommsg:En(t.msg_body)}:fn[t.head.sub_cmd]?this.transRsp(this.decode(Rn[fn[t.head.sub_cmd]],t.msg_body)):{}};if(this.logger.info(Le+" push "+JSON.stringify(this.transBuf(c))),this.rtcPushCmdList.includes(t.head.sub_cmd))switch(t.head.sub_cmd){case dn.PushUserInfoUpdated:this.handlePushUserStateUpdateMsg(c);break;case dn.PushUserKickout:this.transKeysName(c.body,this.loginKeyTransMap),this.handlePushKickout(c,!1);break;case dn.PushTrans:this.handlePushTransMsg(c);break;case dn.PushIm:this.handlePushRoomMsg(c);break;case 11005:this.handlePushCustomMsg(c);break;case 12001:case 12002:case 12003:this.handlePushStreamMsg(c);break;case 11001:case 11002:case 11003:case 11004:this.handlePushSignalMsg(c);break;case dn.PushUserTokenExpire:this.handlePushTokenExpire(c)}else this.logger.info(Le+" white "),this.onSwitchMessage(e,t);1==t.head.qos_flag&&(o={code:0,message:"",sub_cmd:t.head.sub_cmd,server_send_time:t.head.send_time},s=In.PushRsp.create(o),a=In.PushRsp.encode(s).finish(),this.sendMessage("PushRsp",a,void 0,void 0))}else this.logger.warn(Le+" room no found ignore ");else e.cmd===dn.MergePushReq?((r=this.transRsp(t.head)).room_id=i,this.stateCenter.roomModulesList.find((function(e){return e.roomID==i}))?(n=[],t.message_list.forEach((function(e){var t;n.push({sub_cmd:e.sub_cmd,sub_seq:e.sub_seq}),e.sub_cmd===dn.PushBigIm&&(t=Rn.PushBigIm.decode(e.msg_body),e.msg_body=t)})),delete(r={header:r,body:u=this.transRsp(t)}).body.head,this.handlePushMergeMsg(r),1==t.head.qos_flag&&(o={messages:n,server_send_time:t.head.send_time},s=In.MergePushRsp.create(o),a=In.MergePushRsp.encode(s).finish(),this.sendMessage("MergePushRsp",a,void 0,void 0))):this.logger.warn(Le+" room no found ignore ")):e.cmd===dn.PushKickout&&(u={reason:900<t.reason?t.reason-900:t.reason,msg:t.message,need_relogin:void 0!==t.is_need_relogin?t.is_need_relogin:0},this.handlePushKickout({header:e,body:u},!0));else this.logger.warn(Le+" ctx key not found")},On.prototype.handlePushTokenExpire=function(e){},On.prototype.handlePushKickout=function(e,t){},On.prototype.handlePushStreamMsg=function(e){},On.prototype.handlePushSignalMsg=function(e){},On.prototype.handlePushMergeMsg=function(e){},On.prototype.handlePushCustomMsg=function(e){},On.prototype.handlePushRoomMsg=function(e){},On.prototype.handlePushTransMsg=function(e){},On.prototype.onSwitchMessage=function(e,t){},On.prototype.decodeResponseBody=function(e,t){var n=this.onSwitchCmdList.includes(e.cmd)?"proto_switch_v3":"liveroom_cs_v3";return this.decode(this.protoInstance[n][fn[e.cmd]],t)},On.prototype.handlePushUserStateUpdateMsg=function(e){},On.prototype.login=function(e,t,n){var r,i,o,s=this,a=(this.state==bn.disconnected&&(this.logger.info(Pe+" state disconnect"),this.closeRequest()),(new Date).getTime()+""),u={net_type:G.getNetTypeNum(),room_id:Sn(e.roomID),room_name:Sn(e.roomName),nick_name:this.nickName,role:this.stateCenter.role,third_token:Sn(e.token),room_create_flag:this.stateCenter.roomCreateFlag,user_state_flag:e.userStateUpdate?1:0,user_count_limit:e.maxMemberCount,relate_service:this.stateCenter.relateService.join()||""};e.isMulti?(i=Cn(Cn({},u),{conn_type:2}),r=Cn(Cn({},i),{room_id:e.roomID,room_name:e.roomName,third_token:e.token}),this.logger.info(Pe+" enter "+JSON.stringify(r)),i=Rn.EnterRoomReq.create(i),o=Rn.EnterRoomReq.encode(i).finish(),this.sendMessage("EnterRoomReq",o,(function(n,r){s.transLoginRspKeys(n,e),t&&t(n,r)}),(function(e,t){n&&n(e,t)}),{roomID:e.roomID})):(u=Cn(Cn({},u),{app_id:this.stateCenter.appid,id_name:Sn(this.stateCenter.idName),device_id:this.stateCenter.deviceID,term_type:this.TermType,sdk_version:this.getNumSDKVersion(),client_stamp:Sn(a),relogin_token:this.switchSessionID.notEquals(Tn.a.fromInt(0))?Sn(this.reloginToken):"",switch_session_id:this.switchSessionID,user_session_id:null!=(u=e.longSid)?u:Tn.a.fromInt(0),biz_type:0,biz_version:this.stateCenter.bizVersion||"",login_logic:this.stateCenter.isMultiRoom?3:1,sdk_conn_type:2}),r=Cn(Cn({},u),{id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,client_stamp:a,k1_sign:void 0,relogin_token:this.reloginToken,room_id:e.roomID,room_name:e.roomName,third_token:e.token,user_session_id:e.longSid}),this.logoutCheckToken=e.token,this.logger.info(Pe+" login "+JSON.stringify(r)),i=In.LoginRoomReq.create(u),o=In.LoginRoomReq.encode(i).finish(),this.sendMessage("LoginRoomReq",o,(function(n,r){var i;s.logger.info(Pe+" login rsp"),s.switchSessionID=n.body.switch_session_id,s.reloginToken=n.body.relogin_token,null!=(i=null==n?void 0:n.header)&&i.controls&&(s.controls=null==(i=null==n?void 0:n.header)?void 0:i.controls),s.transLoginRspKeys(n,e),t&&t(n,r)}),(function(e,t){n&&n(e,t)})))},On.prototype.transLoginRspKeys=function(e,t){null!=(n=e.header)&&n.context_key&&(this.roomIDKeys[t.roomID]=null==(n=e.header)?void 0:n.context_key,this.roomKeyIDs[null==(n=e.header)?void 0:n.context_key]=t.roomID,e.header.room_id=t.roomID),this.longToStringNumber(e.body,["ret_timestamp"],"toString"),this.transKeysName(e.body,this.loginKeyTransMap),this.keysExist(e.body,["token_remain_time","stream_seq"]);var n={anchor_id_name:e.body.anchor_info.id_name,anchor_id:e.body.anchor_info.user_id,anchor_nick_name:e.body.anchor_info.nick_name};e.body.anchor_info=n},On.prototype.transKeysName=function(e,t){t.forEach((function(t){void 0!==e[t[0]]&&(e[t[1]]=e[t[0]],delete e[t[0]])}))},On.prototype.keysExist=function(e,t){t.forEach((function(t){void 0===e[t]&&(e[t]=0)}))},On.prototype.longToStringNumber=function(e,t,n){t.forEach((function(t){Tn.a.isLong(e[t])&&(e[t]=e[t][n]())}))},On.prototype.logout=function(e,t,n){var r,i,o,s;return e.isMulti?(r={},this.logger.info(De+" quit "+e.roomID),o=Rn.QuitRoomReq.create(r),s=Rn.QuitRoomReq.encode(o).finish(),this.sendMessage("QuitRoomReq",s,t,n,{roomID:null==e?void 0:e.roomID})):(r={logout_code:0,logout_check:this.crypto.md5Bytes(Sn(this.logoutCheckToken)),user_session_id:e.longSid,logout_logic:this.stateCenter.isMultiRoom?3:1},i=this.transBuf(r),this.logger.info(De+" logout "+JSON.stringify(i)),o=In.LogoutRoomReq.create(r),s=In.LogoutRoomReq.encode(o).finish(),this.sendMessage("LogoutRoomReq",s,t,n,{roomID:null==e?void 0:e.roomID}))},On.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data&&t._data.error&&setTimeout((function(){t&&t._data&&t._data.error&&t._data.error(O.TIMEOUT,t._data.seq)}),0),t=e.getFirst()},On.prototype.checkMessageListTimeout=function(e,t){for(var n=e.getFirst(),r=Date.parse(new Date+""),i=0,o=this;null!=n&&"break"!==function(){var s,a;return n._data&&n._data.sendTime+n._data.timeout>r||(n._data&&delete t[n._data.seq],e.remove(n),n._data&&null==n._data.error||n._data&&n._data.sendTime+o.sendDataDropTimeout<r||(s=n&&n._data&&n._data.error,a=n&&n._data&&n._data.seq,setTimeout((function(){s&&s(O.TIMEOUT,a)}),0)),++i>=o.sendDataCheckOnceCount)?"break":void(n=e.getFirst())}(););},On.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},On.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},On.prototype.handleSendCommandMsgRsp=function(e){var t,n,r=this.sendCommandMap[e.header.seq];null!=r&&(t=r._data,n=null==t?void 0:t.params,delete this.sendCommandMap[e.header.seq],this.sendCommandList.remove(r),0===e.body.err_code?setTimeout((function(){t&&null!=t.success&&t.success(e,e.header.seq)}),0):setTimeout((function(){t&&null!=t.error&&t.error(e,e.header.seq,n)}),0))},On.prototype.getReqHead=function(e){return{}},On.prototype.heartBeat=function(e,t,n){var r=this,i=Rn.HbReq.create({});i=Rn.HbReq.encode(i).finish();this.sendMessage("HbReq",i,(function(t,n){r.transKeysName(t.body,[["hb_interval","hearbeat_interval"],["hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"]]),t.body.server_user_seq=t.body.user_seq.toNumber(),r.longToStringNumber(t.body,["ret_timestamp"],"toNumber"),e&&e(t,n)}),t,{roomID:null==n?void 0:n.roomID})},On.prototype.fetchUserList=function(e,t,n,r){var i=this,o=(e=Cn({},e),this.transBuf(e));this.logger.info(Me+" "+JSON.stringify(o)),o=Rn.GetUserlistReq.create(e),e=Rn.GetUserlistReq.encode(o).finish();return this.sendMessage("GetUserlistReq",e,(function(e,n){i.logger.info(Me+" suc "+n),i.transKeysName(e.body,[["user_base_info_list","user_baseinfos"]]),i.longToStringNumber(e.body,["server_user_seq","server_user_index","ret_user_index"],"toNumber"),t&&t(e,n)}),n,{roomID:null==r?void 0:r.roomID})},On.prototype.sendRoomMsg=function(e,t,n,r){var i=this,o=(e={msg_category:e.msg_category,msg_type:e.msg_type,msg_content:Sn(e.msg_content)},this.transBuf(e));this.logger.info("zm.lrh.srm.1 "+JSON.stringify(o)),o=Rn.SendImReq.create(e),e=Rn.SendImReq.encode(o).finish();return this.sendMessage("SendImReq",e,(function(e,n){i.longToStringNumber(e.body,["msg_id"],"toNumber"),t&&t(e,n)}),n,{roomID:null==r?void 0:r.roomID})},On.prototype.sendReliableMessage=function(e,t,n,r){e={trans_type:Sn(e.trans_type),trans_data:Sn(e.trans_data),trans_local_seq:e.trans_local_seq,trans_channel:Sn(e.trans_channel)};var i=this.transBuf(e);this.logger.info("zm.lrh.srm.0 "+JSON.stringify(i)),i=Rn.SetTransReq.create(e),e=Rn.SetTransReq.encode(i).finish();return this.sendMessage("SetTransReq",e,t,n,{roomID:null==r?void 0:r.roomID})},On.prototype.fetchReliableMessage=function(e,t,n,r){var i=e.fetch_array.map((function(e){return{trans_type:Sn(e.trans_type),trans_local_seq:e.trans_seq}}));e={trans_channel:Sn(e.trans_channel),trans_list:i},i=this.transBuf(e),this.logger.info("zm.lrh.frm "+JSON.stringify(i)),i=Rn.GetTransReq.create(e),e=Rn.GetTransReq.encode(i).finish();return this.sendMessage("GetTransReq",e,t,n,{roomID:null==r?void 0:r.roomID})},On.prototype.sendCustomCommand=function(e,t,n,r){var i=this,o=e.dest_id_name.map((function(e){return{id_name:Sn(e)}}));o=Cn({to_user_list:o,push_message:Sn(e.custom_msg)},e),e=this.transBuf(o),this.logger.info("zm.lrh.scc "+JSON.stringify(e)),e=Rn.SignalLiveCustomReq.create(o),o=Rn.SignalLiveCustomReq.encode(e).finish();return this.sendMessage("SignalLiveCustomReq",o,(function(e,n){t&&t(i.transRsp(e),n)}),(function(e,t){n&&n(e,t)}),{roomID:null==r?void 0:r.roomID})},On.prototype.sendBigRoomMessage=function(e,t,n,r){e={msg_list:e.msgs.map((function(e){return{msg_category:e.msg_category,msg_type:e.msg_type,msg_timestamp:Tn.a.fromNumber(Date.now()),msg_content:Sn(e.msg_content),msg_client_id:Sn(e.bigmsg_client_id)}}))};var i=this.transBuf(e);this.logger.info("zm.lrh.sbrm "+JSON.stringify(i)),i=Rn.SendBigImReq.create(e),e=Rn.SendBigImReq.encode(i).finish();return this.sendMessage("SendBigImReq",e,t,n,{roomID:null==r?void 0:r.roomID})},On.prototype.sendSignalCmd=function(e,t,n,r){var i="";switch(e.sub_cmd){case 1003:i="SignalLiveInviteReq";break;case 1001:i="SignalLiveRequestReq";break;case 1002:i="SignalLiveResultReq";break;case 1004:i="SignalLiveStopReq"}var o=e.dest_id_name.map((function(e){return{id_name:Sn(e)}}));e={push_message:Sn(e.signal_msg),to_user_list:o},o=this.transBuf(e),this.logger.info("zm.lrh.ssc "+JSON.stringify(o)),o=Rn[i].create(e),e=Rn[i].encode(o).finish();return this.sendMessage(i,e,t,n,{roomID:null==r?void 0:r.roomID})},On.prototype.sendStreamUpdate=function(e,t,n,r){var i,o=this;try{i=JSON.parse(e.stream_msg)}catch(e){}var s,a="",u=(this.logger.info(xe+" "+JSON.stringify(e)),this.stateCenter.roomModulesList.find((function(e){return e.roomID==r.roomID})));if(!u)return this.logger.error(xe+" room no found ignore "),-1;switch(e.sub_cmd){case 2001:a="AddStreamReq",s={stream_id:Sn(i.stream_id),extra_info:Sn(i.extra_info),client_req_seq:this.seq+1,third_token:Sn(e.third_token||"")};break;case 2002:a="DeleteStreamReq",s={stream_id:Sn(i.stream_id),stream_sid:i.stream_sid,client_req_seq:this.seq+1};break;case 2003:a="UpdateStreamReq",s={stream_id:Sn(i.stream_id),stream_sid:i.stream_sid,client_req_seq:this.seq+1,extra_info:Sn(i.extra_info)}}var c=this.transBuf(s);this.logger.info(xe+" "+JSON.stringify(c)),c=Rn[a].create(s),c=Rn[a].encode(c).finish();return this.sendMessage(a,c,(function(e,n){o.logger.info(xe+" suc "+a+" "+JSON.stringify(e)),e.header.room_id=u.roomID,t&&t(e,n)}),(function(e,t){o.logger.info(xe+" fail "+a+" "+JSON.stringify(e)),n&&n(e,t)}),{roomID:null==r?void 0:r.roomID})},On.prototype.getStreamList=function(e,t,n,r){var i,o,s=this;this.stateCenter.roomModulesList.find((function(e){return e.roomID==r.roomID}))?(i=this.transBuf(o={}),this.logger.info("zm.lrh.gs "+JSON.stringify(i)),i=Rn.GetStreamListReq.create(o),o=Rn.GetStreamListReq.encode(i).finish(),this.sendMessage("GetStreamListReq",o,(function(e,n){var r;null!=(r=e.body)&&r.stream_info_list.forEach((function(e){e.create_time=e.create_time.toNumber()})),s.transKeysName(e.body,[["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]]),t&&t(e,n)}),(function(e,t){n&&n(e,t)}),{roomID:null==r?void 0:r.roomID})):this.logger.error("zm.lrh.gs room no found ignore "+r.roomID)},On.prototype.transBuf=function(e){var t=this,n={};return Object.keys(e).forEach((function(r){["logout_check","k2_sign","k1_sign"].includes(r)?n[r]=e[r]:t.transReqBytes(n,e,r)})),n},On.prototype.transReqBytes=function(e,t,n){var r=this;if(Tn.a.isLong(t[n]))e[n]=t[n].toString();else if("[object Object]"===Object.prototype.toString.call(t[n]))e[n]={},Object.keys(t[n]).forEach((function(i){return r.transReqBytes(e[n],t[n],i)}));else if("[object Array]"===Object.prototype.toString.call(t[n])&&"[object Object]"===Object.prototype.toString.call(t[n][0])){e[n]=[];for(var i=0;i<t[n].length;i++)!function(i){var o={};Object.keys(t[n][i]).forEach((function(e){r.transReqBytes(o,t[n][i],e)})),e[n].push(o)}(i)}else"[object Uint8Array]"===Object.prototype.toString.call(t[n])?e[n]=En(t[n]):e[n]=t[n]},On.prototype.transHeader=function(e){return e.timestamp=Tn.a.isLong(e.timestamp)?e.timestamp.toString():e.timestamp,e},On.prototype.transRsp=function(e){var t=this,n=e&&e.rsp_head?this.transRspHead(e.rsp_head):{},r=Cn(Cn({},e),n),i=(delete r.rsp_head,{});return Object.keys(r).forEach((function(e){"k2_sign"===e?i[e]=r[e]:t.transBytes(i,r,e)})),i},On.prototype.transBytes=function(e,t,n){var r=this;if(Tn.a.isLong(t[n]))e[n]=t[n];else if("[object Object]"===Object.prototype.toString.call(t[n]))e[n]={},Object.keys(t[n]).forEach((function(i){return r.transBytes(e[n],t[n],i)}));else if("[object Array]"===Object.prototype.toString.call(t[n])&&"[object Object]"===Object.prototype.toString.call(t[n][0])){e[n]=[];for(var i=0;i<t[n].length;i++)!function(i){var o={};Object.keys(t[n][i]).forEach((function(e){r.transBytes(o,t[n][i],e)})),e[n].push(o)}(i)}else"[object Uint8Array]"===Object.prototype.toString.call(t[n])?e[n]=En(t[n]):e[n]=t[n]},On.prototype.transRspHead=function(e){return e?{err_code:e.code||0,err_message:e.message}:{}},On.prototype.decode=function(e,t){return Cn({},e.decode(t))},On.prototype.handleDisconnected=function(e,t){var n=this;this.logger.info(Ue+" call"),this.state=bn.disconnected,this.stateCenter.useNetAgent&&e===b.TIMEOUT&&this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&(n.ua.isConnect()?(n.logger.info(Ue+" ua is connect"),e.roomTryHandler.active()):(n.logger.info(Ue+" ua is disconnect"),n.ua.connectUa()))}))},On.prototype.handleBroken=function(){var e=this;this.logger.info("zm.lrh.hb call"),this.state=bn.broken,this.stateCenter.useNetAgent&&this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&(t.roomTryHandler.invalid(),t.roomTryHandler.onactive=function(n,r){e.logger.info("zm.lrh.hb onactive"),t.roomHandler.transError(r),t.roomHandler.disconnectedHandle(r)},t.roomTryHandler.startMaxTime(),t.roomHandler.roomStateHandle("CONNECTING",C.Reconnecting,O.NETWORK_BROKEN))}))},On.prototype.handleConnected=function(e){var t=this;this.logger.info("zm.lrh.hc call "+e),this.state=bn.connected,this.stateCenter.useNetAgent&&e===y.AUTO&&this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&t.ua.isConnect()&&e.roomTryHandler.active()}))},On.prototype.renewToken=function(e,t,n,r){var i=this,o=(e={token:e.token},Rn.RenewTokenReq.create(e));o=Rn.RenewTokenReq.encode(o).finish(),e=this.transBuf(e);this.logger.info("zm.lrh.rt "+JSON.stringify(e)),this.sendMessage("RenewTokenReq",o,(function(e,n){i.keysExist(e.body,["token_remain_time"]),t&&t(e,n)}),n,{roomID:null==r?void 0:r.roomID})},On.prototype.reset=function(){this.logger.info("zm.lrh.r.0 call "),this.state=bn.disconnected,this.switchSessionID=Tn.a.fromInt(0),this.sendDataCheckTimer&&clearTimeout(this.sendDataCheckTimer)},On.prototype.closeRequest=function(){var e;null!=(e=this.liveroomRequest)&&e.closeRequest()},On.prototype.resetSessionInfo=function(){this.switchSessionID=Tn.a.fromInt(0)},On.prototype.getNumSDKVersion=function(){var e=0===this.stateCenter.ENV?6:7,t=this.rtm.version.split(".").map((function(e){return parseInt(e)}));return e<<28|t[0]<<20|t[1]<<8|t[2]},On);function On(e,t,n,r,i){var o=this;this.logger=e,this.stateCenter=t,this.ua=n,this.dataReport=r,this.rtm=i,this.seq=0,this.sendCommandList=new m,this.sendCommandMap={},this.logoutCheckToken="",this.zPushSid="0",this.loginKeyTransMap=[["user_session_id","session_id"],["liveroom_hb_interval","hearbeat_interval"],["liveroom_hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"],["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]],this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.protoInstance=wn,this.roomKeyIDs={},this.roomIDKeys={},this.swPushCmdList=[dn.PushReq,dn.MergePushReq,dn.PushKickout],this.onSwitchCmdList=[dn.LoginRoomRsp,dn.LogoutRoomRsp,dn.PushKickout,dn.PushReq,dn.MergePushReq],this.noContextKeyCmdList=[1105],this.rtcPushCmdList=[10001,10002,10004,11001,11002,11003,11004,11005,12001,12002,12003,13001,15001],this.state=bn.disconnected,this.unStructCmdList=[11001,11002,11003,11004],this.reloginToken="",this.crypto=new vn,this.liveroomRequest=this.ua.getPCRequest(T.SERVICE_SWITCH4LIVEROOM),this.switchSessionID=Tn.a.fromInt(0),null!=(e=this.liveroomRequest)&&e.on("connected",(function(e){o.handleConnected(e)})),null!=(t=this.liveroomRequest)&&t.on("broken",(function(e){o.handleBroken()})),null!=(n=this.liveroomRequest)&&n.on("disconnected",(function(e,t){o.handleDisconnected(e,t)})),null!=(r=this.liveroomRequest)&&r.on("downLoadMessage",(function(e,t){o.handlePush(e,t)})),null!=(i=this.liveroomRequest)&&i.on("exception",(function(e,t){o.logger.info("zm.lrh.o.0 except "+JSON.stringify(e))})),null!=(e=this.liveroomRequest)&&e.on("pcBrokenEvent",(function(e){var t=Ot,n=o.stateCenter.reporter.createSpan(a.H,{key:mt},{key:""},t.event);n.setAttributes({service_no:t.service_no(null==e?void 0:e.service_no)}),n.end()})),null!=(t=this.liveroomRequest)&&t.on("pcDisconnectedEvent",(function(e){var t=Nt,n=o.stateCenter.reporter.createSpan(a.H,{key:mt},{key:""},t.event);n.setAttributes({service_no:t.service_no(null==e?void 0:e.service_no)}),n.end()})),null!=(n=this.liveroomRequest)&&n.on("pcConnectedEvent",(function(e){var t=kt,n=o.stateCenter.reporter.createSpan(a.H,{key:mt},{key:""},t.event);n.setAttributes({service_no:t.service_no(e.service_no),recv_time:t.recv_time((new Date).getTime()),proxy_link_sources:t.proxy_link_sources(e.proxy_link_sources),connect_stream:t.connect_stream(e.connect_stream)}),n.end()}))}var Nn=(An.prototype.listenCallBack=function(){var e=this;this.roomServicer.handlePushCustomMsg=function(t){e.handlePushCustomMsg(t)},this.roomServicer.handlePushTokenExpire=function(t){var n,r=null==(r=null==(r=null==t?void 0:t.body)?void 0:r.stop_stream)?void 0:r.stream_id_list.map(En);null!=(n=null==(n=null==t?void 0:t.body)?void 0:n.stop_stream)&&(n.stream_id_list=r),e.stateCenter.actionListener("_tokenExpired",t)},this.roomServicer.handlePushKickout=function(t,n){var r;n?function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([],e.stateCenter.roomModulesList,!0).forEach((function(e){e.roomHandler.handlePushKickout(t,!0,!0)})):(r=null==(n=null==t?void 0:t.header)?void 0:n.room_id,n=e.stateCenter.roomModulesList.find((function(e){return e.roomID==r})),e.roomServicer.longToStringNumber(t.body,["session_id"],"toString"),n?n.roomHandler.handlePushKickout(t):e.logger.error("zm.lrh.pk room no found ignore "+JSON.stringify(null==(n=t.header)?void 0:n.room_id)))},this.roomServicer.handlePushStreamMsg=function(t){e.handlePushStreamMsg(t)},this.roomServicer.handlePushSignalMsg=function(t){e.handlePushSignalMsg(t)},this.roomServicer.handlePushMergeMsg=function(t){e.handlePushMergeMsg(t)},this.roomServicer.handlePushRoomMsg=function(t){e.handlePushRoomMsg(t)},this.roomServicer.handlePushTransMsg=function(t){e.handlePushTransMsg(t)},this.roomServicer.onSwitchMessage=function(t,n){e.onSwitchMessage(t,n)},this.roomServicer.handlePushUserStateUpdateMsg=function(t){var n,r,i,o=null==(s=null==t?void 0:t.header)?void 0:s.room_id,s=e.stateCenter.roomModulesList.find((function(e){return e.roomID==o}));s?(i=t.body.user_action_list.map((function(e){return{Action:e.action,IdName:e.id_name,NickName:e.nick_name,Role:e.role,LoginTime:e.login_time.toString()}})),r=e.stateCenter.reporter.createSpan(a.H,{key:Ve.event,par:o},{key:""},ut.event),i={body:{user_actions:i,user_list_seq:t.body.server_user_seq.toNumber(),room_id:o}},r.setAttributes({user_list_seq:null==(n=null===i?void 0:i.body)?void 0:n.user_list_seq,update_user:null==(n=null===i?void 0:i.body)?void 0:n.user_actions}),r.end(),s.userHandler.handlePushUserStateUpdateMsg(i)):e.logger.error("zm.lrh.puu room no found ignore "+JSON.stringify(t))}},An.prototype.isDisConnect=function(){return!!this.roomServicer&&this.roomServicer.isDisConnect()},An.prototype.isUaConnect=function(){var e;return null==(e=this.roomServicer)?void 0:e.isUaConnect()},An.prototype.sendMessage=function(e,t,n,r,i,o,s){var a;return null==(a=this.roomServicer)?void 0:a.sendMessage(e,t,n,r,i,o)},An.prototype.handlePushTokenExpire=function(e){},An.prototype.handlePushKickout=function(e,t){},An.prototype.handlePushStreamMsg=function(e){},An.prototype.handlePushSignalMsg=function(e){},An.prototype.handlePushMergeMsg=function(e){},An.prototype.handlePushCustomMsg=function(e){},An.prototype.handlePushRoomMsg=function(e){},An.prototype.handlePushTransMsg=function(e){},An.prototype.onSwitchMessage=function(e,t){},An.prototype.handlePushUserStateUpdateMsg=function(e){},An.prototype.login=function(e,t,n){var r;null!=(r=this.roomServicer)&&r.login(e,t,n)},An.prototype.logout=function(e,t,n){var r;return null==(r=this.roomServicer)?void 0:r.logout(e,t,n)},An.prototype.startCheck=function(){var e;null!=(e=this.roomServicer)&&e.startCheck()},An.prototype.stopCheck=function(){var e;null!=(e=this.roomServicer)&&e.stopCheck()},An.prototype.getReqHead=function(e){var t;return null==(t=this.roomServicer)?void 0:t.getReqHead(e)},An.prototype.heartBeat=function(e,t,n){var r;null!=(r=this.roomServicer)&&r.heartBeat(e,t,n)},An.prototype.fetchUserList=function(e,t,n,r){var i;return null==(i=this.roomServicer)?void 0:i.fetchUserList(e,t,n,r)},An.prototype.sendRoomMsg=function(e,t,n,r){var i;return null==(i=this.roomServicer)?void 0:i.sendRoomMsg(e,t,n,r)},An.prototype.sendReliableMessage=function(e,t,n,r){var i;return null==(i=this.roomServicer)?void 0:i.sendReliableMessage(e,t,n,r)},An.prototype.fetchReliableMessage=function(e,t,n,r){var i;return null==(i=this.roomServicer)?void 0:i.fetchReliableMessage(e,t,n,r)},An.prototype.sendCustomCommand=function(e,t,n,r){var i;return null==(i=this.roomServicer)?void 0:i.sendCustomCommand(e,t,n,r)},An.prototype.sendBigRoomMessage=function(e,t,n,r){var i;return null==(i=this.roomServicer)?void 0:i.sendBigRoomMessage(e,t,n,r)},An.prototype.sendSignalCmd=function(e,t,n,r){var i;return null==(i=this.roomServicer)?void 0:i.sendSignalCmd(e,t,n,r)},An.prototype.sendStreamUpdate=function(e,t,n,r){var i;return null==(i=this.roomServicer)?void 0:i.sendStreamUpdate(e,t,n,r)},An.prototype.getStreamList=function(e,t,n,r){var i;return null==(i=this.roomServicer)?void 0:i.getStreamList(e,t,n,r)},An.prototype.renewToken=function(e,t,n,r){var i;null!=(i=this.roomServicer)&&i.renewToken(e,t,n,r)},An.prototype.reset=function(){var e;null!=(e=this.roomServicer)&&e.reset()},An.prototype.closeRequest=function(){var e;null!=(e=this.roomServicer)&&e.closeRequest()},An);function An(e,t,n,r,i){this.logger=e,this.stateCenter=t,this.ua=n,this.dataReport=r,this.rtm=i,this.roomServicer=new kn(e,t,n,r,i),this.listenCallBack()}var Ln=n(11),Pn=(Mn.prototype.setLog=function(e){this.zegoSetting.setLog(e)},Mn.prototype.init=function(e){this.zegoSetting.init(e)},Mn.prototype.setEnvVariable=function(e,t){this.zegoSetting.setEnvVariable(e,t)},Mn.prototype.getEnvVariables=function(){return this.zegoSetting.getEnvVariables()},Mn.prototype.fetchSetting=function(e,t,n){return this.zegoSetting.fetchSetting(e,t,n)},Mn.prototype.fetchMultiSetting=function(e,t,n){return this.zegoSetting.fetchMultiSetting(e,t,n)},Mn.prototype.setOptions=function(e){return this.zegoSetting.setOptions(e)},Mn.prototype.getSettingCache=function(e){return this.zegoSetting.getSettingCache(e)},Mn.prototype.setToken=function(e){this.zegoSetting.setToken(e)},Mn.prototype.setUserID=function(e){this.zegoSetting.setUserID(e)},Mn.prototype.activePolling=function(){this.zegoSetting.activePolling()},Mn.prototype.uninit=function(){var e;null!=(e=this.zegoSetting)&&e.uninit()},Mn.prototype.getEnvVariable=function(e){this.zegoSetting.getEnvVariable(e)},Mn);function Mn(){this.isLoad=!1,this.callBackList=[],this.zegoSetting=new Ln.ZegoSetting}var Dn=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},xn=function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var c=[a,u];if(n)throw new TypeError("Generator is already executing.");for(;o=s&&c[s=0]?0:o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,(c=i?[2&c[0],i.value]:c)[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3]))o.label=c[1];else if(6===c[0]&&o.label<i[1])o.label=i[1],i=c;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(c)}}c=t.call(e,o)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},Un=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},Bn=(Object.defineProperty(Hn.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),Object.defineProperty(Hn.prototype,"isUseNetAgent",{get:function(){return this.stateCenter.useNetAgent},enumerable:!1,configurable:!0}),Hn.prototype.destroyRTM=function(){this.stateCenter.roomModulesList.some((function(e){return!(null!=e&&e.isLogout()||"DISCONNECTED"===e.roomState)}))&&this.logoutRoom(),this.stateCenter.reporter.setUnloadState(a.I),this.reporter.destroy()},Hn.prototype.getSettingUnify=function(e){var t=this.stateCenter.settingConfig.getSetting("unify",e=void 0!==e&&e);return this.logger.info("zm.gsu "+e+" "+JSON.stringify(t)),t?(e=t.enable,t=t.sdk_conn_ver,!!(e&&t<=K.connectVer)):this.isUseNetAgent},Hn.prototype.initCallback=function(){this.proxyRes=G.proxyRes,this.actionSuccessCallback=G.actionSuccessCallback,this.actionErrorCallback=G.actionErrorCallback,this.getServerError=G.getServerError,this.generateRandumNumber=G.generateRandumNumber,this.unregisterCallback=G.unregisterCallback,this.logReportCallback=G.logReportCallback,this.registerCallback=G.registerCallback},Hn.prototype.initSpans=function(){this.stateCenter.reporter.createSpan(a.H,{key:Be.event},{key:He},He,!0).end()},Hn.prototype.handleZipLogUrl=function(){var e,t="";null!=(e=this.stateCenter.geoFencing)&&e.detaillog&&""!==(null==(e=this.stateCenter.geoFencing)?void 0:e.detaillog)?(t="https://".concat(null==(e=this.stateCenter.geoFencing)?void 0:e.detaillog,"/log/userupload"),this.logger.info(fe+" set detaillog url by geoFencing "+t),this.logger.setZipLogUploadUrl(t)):(e=this.stateCenter.settingConfig.getSetting("detaillog_domain"))&&""!==e&&(t="https://".concat(e,"/log/userupload"),this.logger.info(fe+" set detaillog url by cloudsetting "+t),this.logger.setZipLogUploadUrl(t))},Hn.prototype.getStoreAppConfig=function(){if(this.logger.info(de+" call"),null!=(e=this.stateCenter.geoFencing)&&e.logreport&&this.handleLogUpload(),null!=(e=this.stateCenter.geoFencing)&&e.detaillog&&this.handleZipLogUrl(),localStorage){var e=H(W+"_"+this.getAppID()+"_"+(this.stateCenter.mode||K.modeNo));if(e){var t=H(Z+"_"+this.getAppID()+"_"+(this.stateCenter.mode||K.modeNo));t||this.logger.info(de+" no store config etag");try{var n,r=x(e,V);r?(this.stateCenter.appConfig=JSON.parse(r),this.stateCenter.reporter.spanSetAttributes({key:Be.event},{is_from_cache:Be.is_from_cache(!0)}),this.stateCenter.actionListener("_appConfigRsp"),this.handleLogUpload()):localStorage.removeItem(W+"_"+this.getAppID()+"_"+(this.stateCenter.mode||K.modeNo)),t&&(n=x(t,V),this.stateCenter.appConfigEtag=parseInt(n))}catch(e){this.logger.warn(de+" "+JSON.stringify(e))}}else this.logger.info(de+" no store config")}else this.logger.warn(de+" no localstorage")},Hn.prototype.createNetAgent=function(){var e=this,t=(this.logger.info(he+" call"),this.netAgent.on("disconnected",(function(t){e.logger.info("".concat(he," netAgent disconnect"))})),this.netAgent.on("connected",(function(){e.logger.info("".concat(he," netAgent connect")),e.stateCenter.reporter.setNetStateCheck(),e.isUseNetAgent?(e.fetchAppConfig(),e.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.netAgent.isConnect()&&t.roomTryHandler.active(!0)}))):e.logger.info("".concat(he," unify false"))})),this.netAgent.on("broken",(function(t){e.logger.info("".concat(he," netAgent broken")),t===S.CLOSE&&e.stateCenter.roomModulesList.forEach((function(e){e.resetSessionInfo()}))})),this.netAgent.on("dispatchEvent",(function(t,n,r){var i;e.logger.info("".concat(he," dispatch")),"start"===n?(i=e.stateCenter.reporter.createSpan(a.H,{key:mt},{key:""},"/zegoconn/auto_dispatch"),e.stateCenter.requestList[t]=i):"end"===n&&(i=e.stateCenter.requestList[t])&&(i.setAttributes({domain_list:r.domains}),i.end())})),this.netAgent.on("dispatchResultUpdate",(function(t){var n,r=t.servers;t=t.domains;e.logger.info("".concat(he," dispatchResult ").concat(JSON.stringify(r),", ").concat(JSON.stringify(t))),null!=(n=e.stateCenter.geoFencing)&&n.id?(t&&t[0]&&(e.stateCenter.netGeoFencing.accesshub=t[0]),e.setLocalGeoFencing()):(n=D(JSON.stringify(r),V),B(Y+"_"+e.stateCenter.appid+"_"+(e.stateCenter.mode||K.modeNo),n))})),this.netAgent.on("connectedEvent",(function(t,n,r){var i;e.logger.info("".concat(he," connect")),"start"===n?(i=e.stateCenter.reporter.createSpan(a.H,{key:Be.event},{key:mt},mt,!0),e.stateCenter.requestList[t]=i):"end"===n&&(i=e.stateCenter.requestList[t])&&(i.setAttributes({request_count:yt(r.count),connect_id:vt(r.connectid),events:St(r.connectEvents)}),i.end())})),this.netAgent.on("requestEvent",(function(t,n,r){var i;e.logger.info("".concat(he," request")),"start"===n?(i=e.stateCenter.reporter.createSpan(a.H,{key:Be.event},{key:Ct},Ct,!0),e.stateCenter.requestList[t]=i):"end"===n&&(i=e.stateCenter.requestList[t])&&(i.setAttributes({req_location:wt(r.na_req_location),http_code:r.status_code,error:r.err_code}),i.end())})),this.netAgent.on("disConnectedEvent",(function(t){var n=t.duration,r=t.server,i=(t=t.connectid,e.logger.info("".concat(he," disconnect")),e.stateCenter.reporter.createSpan(a.H,{key:Be.event},{key:""},"/zegoconn/disconnect"));i.setAttributes({url:bt(r),connect_duration:Tt(n),connect_id:Et(t)}),i.end()})),null!=(t=this.netAgent)&&t.on("clientInfo",(function(t){var n=t.timeOffset;t=t.geofencingID;"number"==typeof n&&e.stateCenter.reporter.setTimeOffset(n),e.updateTimeOffsetInterval(),"number"==typeof t&&(e.stateCenter.netGeoFencing.id=t,e.setLocalGeoFencing())})),K.domains);if(Hn.geoFenceType&&Hn.geoFenceAreaList){this.logger.info("".concat(he," geo type ").concat(Hn.geoFenceType," area ").concat(Hn.geoFenceAreaList.join(",")));var n=void 0,r=[],i=this.getGeoFencingIDAndDomain(Hn.geoFenceType,Hn.geoFenceAreaList);if(!i)throw this.logger.warn("".concat(he," geofencing not exist")),O.GEO_SET_ERROR;var o,s=this.getLocalGeoFencing(),u=!1;null!=s&&s.id&&(o=i.find((function(e){return e.id===(null==s?void 0:s.id)})))&&(u=!0,n={id:null==s?void 0:s.id,accesshub:(null==s?void 0:s.accesshub)||(null==o?void 0:o.accesshub),logreport:null==o?void 0:o.logreport,detaillog:null==o?void 0:o.detaillog},null!=s&&s.accesshub&&r.push(null==s?void 0:s.accesshub),r.push(null==o?void 0:o.accesshub)),u||(n={id:(o=i[0]).id,accesshub:u=o.accesshub,logreport:o.logreport,detaillog:o.detaillog},r.push(u)),this.stateCenter.geoFencing=n,this.logger.info("".concat(he," use geo ").concat(JSON.stringify(this.stateCenter.geoFencing))),t=r}this.logger.info("".concat(he," domains ").concat(JSON.stringify(t))),i=t.map((function(e){return"wss://".concat(e,"/accesshub")})),this.netAgent.setBackupDomains(K.primaryDomains),this.netAgent.setNetAgentDefaultServers(i),!this.stateCenter.geoFencing&&null!=(o=this.options)&&o.accessURL&&this.netAgent.setNetAgentSpecifiedServers([null==(u=this.options)?void 0:u.accessURL]),null!=(n=this.options)&&n.customDomain&&(r="wss://accesshub-wss."+this.options.customDomain+"/accesshub",this.stateCenter.geoFencing&&(this.replaceMainDomain(this.options.customDomain),r="wss://".concat(null==(t=this.stateCenter.geoFencing)?void 0:t.accesshub,"/accesshub")),this.netAgent.setNetAgentSpecifiedServers([r])),this.dispatchServers=[],this.stateCenter.geoFencing?this.dispatchServers=i:this.dispatchServers=this.getDispatchUrl(),this.netAgent.setDispatchConnectServers(this.dispatchServers)},Hn.prototype.getMainDomain=function(e){return(e=e.split("."))[e.length-2]+"."+e[e.length-1]},Hn.prototype.replaceMainDomain=function(e){var t,n;this.stateCenter.geoFencing&&(n=this.getMainDomain(null==(n=this.stateCenter.geoFencing)?void 0:n.accesshub),this.stateCenter.geoFencing.accesshub=null==(t=this.stateCenter.geoFencing)?void 0:t.accesshub.replace(n,e),this.stateCenter.geoFencing.logreport=null==(t=this.stateCenter.geoFencing)?void 0:t.logreport.replace(n,e),this.stateCenter.geoFencing.detaillog=null==(t=this.stateCenter.geoFencing)?void 0:t.detaillog.replace(n,e))},Hn.prototype.getDispatchUrl=function(){var e=H(Y+"_"+this.stateCenter.appid+"_"+(this.stateCenter.mode||K.modeNo));if(e&&(e=x(e,V)))try{return JSON.parse(e)}catch(e){}return[]},Hn.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),n=P(),r="micromessenger"==(i=navigator.userAgent).toLowerCase().match(/MicroMessenger/i),i=-1<i.indexOf("Android")||-1<i.indexOf("Adr"),o=t||r&&i?"pagehide":"Firefox"===n?"beforeunload":"unload";window.addEventListener(o,(function(){return Dn(e,void 0,void 0,(function(){return xn(this,(function(e){switch(e.label){case 0:return this.logger.info(ie+" "+o),this.stateCenter.reporter.setUnloadState(a.I),this._onBeforePageUnload?[4,this._onBeforePageUnload()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.logoutRoom(),[2]}}))}))})),window.addEventListener("offline",(function(){e.netOffLineHandle()})),window.addEventListener("online",(function(){e.netOnLineHandle()}))},Hn.prototype.retryRoom=function(){var e=this;this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.netAgent.isConnect()&&(t.resetSessionInfo(),t.roomTryHandler.active(!0))}))},Hn.prototype.netOnLineHandle=function(){var e=this;this.logger.info(ie+" network is online"),this.stateCenter.networkState=u.online,this.isUseNetAgent||this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.service.isDisConnect()?t.roomTryHandler.active():t.roomTryHandler&&(t.roomTryHandler.stopMaxTime(),t.roomHandler.roomStateHandle("CONNECTED",C.Reconnected,{code:0,msg:""}))}))},Hn.prototype.netOffLineHandle=function(){var e=this;this.logger.info(ie+" network is broken"),this.stateCenter.networkState=u.offline,this.isUseNetAgent||this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&(t.roomTryHandler.invalid(),t.roomTryHandler.onactive=function(n,r){e.logger.info(ie+" onactive"),t.roomHandler.transError(r),t.roomHandler.disconnectedHandle(r)},t.roomTryHandler.startMaxTime(),t.roomHandler.roomStateHandle("CONNECTING",C.Reconnecting,O.NETWORK_BROKEN))}))},Hn.prototype.setLogConfig=function(e){this.logger.info(oe+" call");var t,n=this.stateCenter.reporter.createSpan(a.H,{key:Be.event},{key:Fe.event},Fe.event);if(e.logLevel&&["debug","info","warn","error","report","disable"].includes(e.logLevel)&&(this.logger.setLogLevel(e.logLevel),n.setAttributes({log_level:Fe.log_level(e.logLevel)})),e.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(e.remoteLogLevel)&&n.setAttributes({remote_log_level:Fe.remote_log_level(e.remoteLogLevel)}),"string"==typeof e.logURL&&(e.logURL.startsWith("wss://")||e.logURL.startsWith("https://")))null!=(t=this.stateCenter.geoFencing)&&t.logreport?this.logger.info(oe+" geo exist"):(this.logger.setLogServer(e.logURL),0===this.stateCenter.ENV&&(this.stateCenter.logDomain=null==(t=this.logger.url)?void 0:t.split("/")[2],this.stateCenter.reporter.setConfig({serverUrl:"wss://"+this.stateCenter.logDomain+"/zglog/tlog"}))),n.setAttributes({log_url:Fe.log_url(e.logURL)}),n.end();else if(e.logURL)return this.logger.error(oe+"log url must be a wss or https url"),this.stateCenter.reporter.setError(n,Fe.error.kInvalidParamError),!1;return this.logger.info(oe+" call success"),n.end(),!0},Hn.prototype.setDebugVerbose=function(e){var t=this.stateCenter.reporter.createSpan(a.H,{key:Be.event},{key:ze},ze);"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,t.setAttributes({debug:Ge(e?"true":"false")})),t.end(),this.logger.info("zm.sdv call success")},Hn.prototype.setDebug=function(e){"string"==typeof e&&-1<e.indexOf("wss")?this.stateCenter.debug=G.isTestEnv(e):Array.isArray(e)&&0<e.length&&e.every((function(e){return"string"==typeof e&&-1<e.indexOf("wss")}))?this.stateCenter.debug=G.isTestEnv(e[0]):this.logger.info("zm.0 server wrong"),this.stateCenter.testEnvironment=this.stateCenter.debug},Hn.prototype.renewToken=function(e,t){var n,r,i,o,s=this,u=this.stateCenter.reporter.createSpan(a.H,{key:Ve.event,par:t},{key:""},$e.event);return void 0===t||"string"==typeof t&&""!=t?(r=this.getRoomModules(t)||this.stateCenter.roomModulesList[0])?"string"==typeof e&&r.roomTryHandler?(e===r.roomTryHandler.token?(this.logger.info(ge+" token has not changed"),u.setAttributes({error:$e.error.INPUT_PARAM.code,message:"token has not changed"}),u.end()):(u.setAttributes({token:$e.token(e)}),this.stateCenter.configRoomAuth?(i=function(t){var n;null!=(n=r.roomTryHandler)&&n.renewLocalToken(e,null==(n=null==t?void 0:t.body)?void 0:n.token_remain_time),s.cloudSetting.setToken(e),s.reporter.setReporterInfo(s.stateCenter.idName||"",e),s.stateCenter.configCheckToken=!0,u.end(),s.logger.info(ge+" "+JSON.stringify(t))},o=function(t){var n=null==(n=null==t?void 0:t.body)?void 0:n.err_code;s.stateCenter.reporter.setError(u,t),!n||1000002014!==n&&2014!==n?s.logger.error(ge+" "+JSON.stringify(t)):(s.stateCenter.configCheckToken=!1,null!=(n=r.roomTryHandler)&&n.renewLocalToken(e),s.cloudSetting.setToken(e),s.logger.warn(ge+" "+JSON.stringify(t)))},this.isUseNetAgent?null!=(n=this.liveRoomHandler)&&n.renewToken({token:e},i,o,r):this.service.sendMessage("renew_token",{token:e},i,o,void 0,{sessionID:r.sessionID,roomID:t,roomSessionID:r.roomSessionID})):(null!=(n=r.roomTryHandler)&&n.renewLocalToken(e),this.cloudSetting.setToken(e),this.reporter.setReporterInfo(this.stateCenter.idName||"",e),u.end())),!0):("string"!=typeof e||r.roomTryHandler?(this.logger.error(ge+" token must be string and not empty"),this.stateCenter.reporter.setError(u,$e.error.INPUT_PARAM)):(this.logger.error(ge+" calling must after loginRoom"),this.stateCenter.reporter.setError(u,$e.error.NOT_LOGIN)),!1):(this.logger.error(ge+" calling must after loginRoom"),this.stateCenter.reporter.setError(u,$e.error.NOT_LOGIN),!1):(this.logger.error(ge+" roomID must be string and no empty"),!1)},Hn.prototype.setCloudSettingURLs=function(e){var t=this;this.logger.info("zm.scsu call "),Array.isArray(e)&&0<e.length&&e.every((function(e){return"string"==typeof e&&-1<e.indexOf("http")}))&&this.cloudSetting.init({productNum:1,appID:this.stateCenter.appid,env:this.stateCenter.ENV,pollingNotify:function(e,n){t.logger.info("zm.scsu"," setting file changed "+e+" "+JSON.stringify(n)),t.stateCenter.actionListener("_cloudSettingNotify",e,n)},reportNotify:this.cloudReportNotify.bind(this),online:!this.stateCenter.testEnvironment,unify:this.isUseNetAgent,connection:this.netAgent})},Hn.prototype.loginRoom=function(e,t,n,r){var i=this;return this.logger.info(se+" call by user "+(null==n?void 0:n.userID)+" "+e+" "+this.version),new Promise((function(o,a){return Dn(i,void 0,void 0,(function(){var i,c,l,h,d;return xn(this,(function(f){switch(f.label){case 0:return 1!==this.stateCenter.ENV?[3,2]:[4,new Promise((function(e){}))];case 1:f.sent(),f.label=2;case 2:return c=this.loginReport(o,a,e,t,r),h=c.interResolve,i=c.interReject,c=c.loginSpan,(r=r||{}).maxMemberCount||(r.maxMemberCount=0),l=this.getRoomModules(e),d=Ve.error,l?(this.logger.setSessionInfo(this.stateCenter.appid,e,"",n.userID,"",this.stateCenter.sdKVersion),i(d.REPEATEDLY_LOGIN)):((l=new Wt(e,this.stateCenter,this.logger,this.dataReport,this,this.liveRoomHandler,this.service)).roomTryHandler||(l.roomTryHandler=new Mt(this.logger,this.stateCenter,l)),l.roomTryHandler.init(this.stateCenter.roomRetryTime),l.roomTryHandler.initRoom(l.roomHandler,e,t,n,this.stateCenter.server,this.stateCenter.serverBak,r),l.roomTryHandler.setLoginRoomCallback(h,i),l.roomHandler.roomStateHandle("CONNECTING",C.Logining,{code:0,msg:""}),(h=function(e,t){var n,r,i=[],o={};for(n in e)o[e[n].order]=e[n],e[n].key=n;for(r in o)i.push(o[r]);for(var s=0;s<i.length;s++)for(var a=i[s].rules,u=0;u<a.length;u++){var c={key:i[s].key,value:i[s].value,action:t.action,logger:t.logger},l=c.value,h=a[u].name?""+a[u].name:"";if((void 0===l&&h===Pt.NOT_EMPTY||void 0!==l)&&Ut[h]&&(h=Ut[h](c.key,l,c.action,c.logger,a[u]))!=xt)return h}return xt}({roomID:{order:0,value:e,rules:[{name:Pt.NOT_EMPTY,error:d.ROOM_ID_NULL},{name:Pt.TYPE_STRING,error:d.INPUT_PARAM,extMsg:"roomID must be string"},{name:Pt.MAX_LENGTH_128,error:d.ROOM_ID_TOO_LONG},{name:Pt.ILLEGAL_CHARACTERS,error:d.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:t,rules:[{name:Pt.NOT_EMPTY,error:d.INPUT_PARAM},{name:Pt.TYPE_STRING,error:d.INPUT_PARAM}]},user:{order:2,value:n,rules:[{name:Pt.NOT_EMPTY,error:d.INPUT_PARAM,extMsg:" param user error."},{name:Pt.TYPE_OBJECT,error:d.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:n.userID,rules:[{name:Pt.NOT_EMPTY,error:d.USER_ID_NULL,extMsg:" param user error."},{name:Pt.TYPE_STRING,error:d.INPUT_PARAM,extMsg:" param userID error."},{name:Pt.MAX_LENGTH_64,error:d.USER_ID_TOO_LONG},{name:Pt.ILLEGAL_CHARACTERS,error:d.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:n.userName,rules:[{name:Pt.TYPE_STRING,error:d.INPUT_PARAM,extMsg:" userName must be string."},{name:Pt.MAX_LENGTH_256,error:d.USER_NAME_TOO_LONG}]},config:{order:5,value:r,rules:[]},"config.maxMemberCount":{order:6,value:r.maxMemberCount,rules:[{name:Pt.TYPE_INTEGER,error:d.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:se,logger:this.logger}))!==xt?(l.roomHandler.roomStateHandle("DISCONNECTED",C.LoginFailed,h.error,h.extMsg),i(h.error,h.extMsg)):(this.logger.setSessionInfo(this.stateCenter.appid,"","",n.userID,"",this.version),0<this.stateCenter.roomModulesList.length&&1==this.stateCenter.isMultiRoom?l.isMulti=!0:Un([],this.stateCenter.roomModulesList,!0).forEach((function(e){return e.roomHandler.logout()})),r&&(l.config=r),this.stateCenter.roomModulesList.push(l),this.netAgent&&(this.stateCenter.idName=n.userID,this.netAgent.setUserInfo(n.userID),this.stateCenter.actionListener("_roomLogin",e,t),this.netAgent.isConnect())&&this.fetchAppConfig(t),this.cloudSetting.setUserID(n.userID),this.cloudSetting.setToken(t),this.cloudSetting.activePolling(),this.stateCenter.reporter.setCommonAttributes({id_name:n.userID}),this.stateCenter.reporter.setReporterInfo(n.userID,t),this.logger.setTokenInfo(t,n.userID),this.stateCenter.reporter.setSpanInMap(c,{key:Ve.event,par:e}),d=this.stateCenter.settingConfig.getSetting("room_server",!0),Array.isArray(d)&&0<d.length&&(this.logger.info(se," setting room_server "+d),this.stateCenter.server=d[0],this.stateCenter.serverBak=d[1]||d[0]),this.stateCenter.setMultiRoom=!0,l.roomTryHandler.startMaxTime(),this.isUseNetAgent&&!this.netAgent.isConnect()?(this.logger.info(se," us is not connected"),l.roomHandler.setRunState(s.trylogin),this.netAgent.connectUa()):(this.isUseNetAgent&&(this.stateCenter.networkState=u.online),l.roomTryHandler.active(!0)))),[2]}}))}))}))},Hn.prototype.handleLogUpload=function(e){var t="";e&&e.app_config?t=e.app_config.domain:this.stateCenter.appConfig&&this.stateCenter.appConfig.app_config&&(t=this.stateCenter.appConfig.app_config.domain),this.logger.info(le+" call"),this.logger.url?this.logger.info(le+" log is connected"):(null!=(e=this.stateCenter.geoFencing)&&e.logreport?(this.stateCenter.logDomain=null==(e=this.stateCenter.geoFencing)?void 0:e.logreport,t=this.getMainDomain(null==(e=this.stateCenter.geoFencing)?void 0:e.logreport)):this.stateCenter.testEnvironment?(this.stateCenter.logDomain="weblogger-hk-test.zegocloud.com",t="zegocloud.com"):this.stateCenter.logDomain="weblogger".concat(this.stateCenter.appid,"-api.").concat(t),t?(e="",0===this.stateCenter.ENV?(e="wss://".concat(this.stateCenter.logDomain,"/log"),this.reporter.setConfig({serverUrl:"wss://".concat(this.stateCenter.logDomain,"/zglog/tlog")})):e="https://".concat(this.stateCenter.logDomain,"/httplog"),this.logger.setLogServer(e)):this.logger.warn(le+" appconfig no domain"))},Hn.prototype.fetchAppConfigByTargetToken=function(e,t){return Dn(this,void 0,void 0,(function(){var n,r,i,o,s,a;return xn(this,(function(u){switch(u.label){case 0:if(this.logger.info(ce+" call"),!t)return this.logger.warn(ce+" user not exist"),[2];if(n=this.getUserID(),r="",i=null,e)r=e;else{if(!(0<this.stateCenter.roomModulesList.length))return this.logger.warn(ce+" token not exist"),[2];r=this.getToken()}this.logger.roomid||this.logger.setSessionInfo(this.stateCenter.appid,"player-no-room","",t,"",this.stateCenter.sdKVersion),u.label=1;case 1:return u.trys.push([1,3,4,5]),this.netAgent.setUserInfo(t),[4,this.netAgent.getAppConfigByAgent("init",r,5e3)];case 2:return o=u.sent(),s=o.code,a=o.data,o.retryCount,0===s&&(this.handleLogUpload(a),i=a),[3,5];case 3:return u.sent(),this.logger.error(ce+" token not validated"),[3,5];case 4:return n&&this.netAgent.setUserInfo(n),this.logger.info(ce+" call success"),[2,i];case 5:return[2]}}))}))},Hn.prototype.fetchAppConfig=function(e){return Dn(this,void 0,void 0,(function(){var t,n,r,i,o,s,u,c;return xn(this,(function(l){switch(l.label){case 0:if(this.stateCenter.appConfigFetched)return this.logger.warn(ue+" config fetched"),[2];if(!this.getUserID())return this.logger.warn(ue+" user not exist"),[2];if(t="",e)t=e;else{if(!(0<this.stateCenter.roomModulesList.length))return this.logger.warn(ue+" token not exist"),[2];t=this.getToken()}n=this.stateCenter.reporter.createSpan(a.H,{key:Be.event},{key:""},"/sdk_config/init"),this.logger.info(se+" initConfig etag: "+this.stateCenter.appConfigEtag),r=!!this.stateCenter.appConfig,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.netAgent.getAppConfigByAgent("init",t,5e3,this.stateCenter.appConfigEtag)];case 2:if(o=l.sent(),u=o.code,c=o.data,i=o.etag,o=o.retryCount,n.setAttributes({trigger_reason:Rt(this.stateCenter.appConfig?"refresh":"normal"),try_count:It(o||0)}),n.end(),this.stateCenter.appConfigFetched=!0,this.logger.info(se+" initConfig code:"+u+" data: "+JSON.stringify(c)+" etag: "+i),this.stateCenter.appConfigEtag!==i){if(0==Object.keys(c).length)return this.logger.info(se+" initConfig data null"),[2];o=c.app_config,u=c.media_config,s=u.publish_config,u=u.play_config,c=c.speedlog_config.charge_info_report_no_playing,this.stateCenter.appConfig={app_config:o,media_config:{publish_config:s,play_config:u},speedlog_config:{charge_info_report_no_playing:c||0}},this.stateCenter.appConfigEtag=i,o=JSON.stringify(this.stateCenter.appConfig),s=D(o,V),B(W+"_"+this.getAppID()+"_"+(this.stateCenter.mode||K.modeNo),s),u=D(this.stateCenter.appConfigEtag+"",V),B(Z+"_"+this.getAppID()+"_"+(this.stateCenter.mode||K.modeNo),u)}return this.handleLogUpload(),!r&&this.stateCenter.appConfig&&this.stateCenter.actionListener("_appConfigRsp"),!this.stateCenter.netAppConfig&&this.stateCenter.appConfig&&(this.stateCenter.netAppConfig=Object.assign(this.stateCenter.appConfig),this.stateCenter.actionListener("_netAppConfigRsp",this.stateCenter.netAppConfig),this._onAppConfigUpdate)&&this._onAppConfigUpdate(this.stateCenter.netAppConfig),[3,4];case 3:return c=l.sent(),this.logger.error(se+" fail "+JSON.stringify(c)),n.setAttributes({error:null==c?void 0:c.code}),n.end(),[20012,20008].includes(null==c?void 0:c.code)&&this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&e.roomTryHandler.loginFail(O.APPID_INVALID)})),[3,4];case 4:return[2]}}))}))},Hn.prototype.getCloudSetting=function(){var e,t=this;null!=(e=this.cloudSetting)&&e.fetchMultiSetting([j,"room","rtc"]).then((function(e){var n,r;t.logger.info(se," settingConfig "+JSON.stringify(e)),e&&(t.stateCenter.settingConfig.setSetting(null==(r=null==e?void 0:e.init)?void 0:r.setting,["remote_log_level","zip_log","detaillog_domain"]),t.stateCenter.actionListener("_settingCanFetch",null==e?void 0:e.rtc),(r=t.stateCenter.settingConfig.getSetting("remote_log_level",!0))&&(t.logger.info("".concat(se,"  setting remote_log_level ").concat(r)),t.logger.setRemoteLogLevel(r)),void 0!==(e=t.stateCenter.settingConfig.getSetting("zip_log"))&&(t.logger.info("".concat(re," force setting zip_log ").concat(e)),t.logger.setZipLogConfig(e,!0)),t.handleZipLogUrl(),(r=t.stateCenter.settingConfig.getSetting("unify",t.stateCenter.netHasSet))&&(t.logger.info("".concat(se," unify ").concat(JSON.stringify(r))),e=r.enable,r=r.sdk_conn_ver,n=!0,n=!!(e&&r<=K.connectVer),!0===t.isUseNetAgent)&&!1===n&&(t.cloudSetting.setOptions({unify:!1}),"connecting"!==t.stateCenter.connectState&&(t.stateCenter.connectState="connecting",t.stateCenter.actionListener("_connectChanged","connecting")),e=Un([],t.stateCenter.roomModulesList,!0),Un([],t.stateCenter.roomModulesList,!0).forEach((function(e){e.roomHandler.logout(!0,!0)})),t.stateCenter.useNetAgent=n,e.forEach((function(e){var n;t.stateCenter.roomModulesList.push(e),e.roomTryHandler||(e.roomTryHandler=new Mt(t.logger,t.stateCenter,e)),e.roomTryHandler.init(t.stateCenter.roomRetryTime),e.roomTryHandler.initRoom(e.roomHandler,e.roomID,e.token,{userID:t.stateCenter.idName,userName:t.stateCenter.nickName},t.stateCenter.server,t.stateCenter.serverBak,e.config),null!=(n=e.roomTryHandler)&&n.startMaxTime(),e.roomTryHandler.onactive=function(n,r){n?"connected"!==t.stateCenter.connectState&&(t.stateCenter.connectState="connected",t.stateCenter.actionListener("_connectChanged","connected",{roomID:e.roomID})):(t.logger.info(se," onactive"),e.roomHandler.transError(r),e.roomHandler.disconnectedHandle(r))},null!=(n=e.roomTryHandler)&&n.active()}))),r=t.stateCenter.settingConfig.getSetting("report_script"))&&(n=r.url,e=r.key,r=r.hash,t.logger.info("".concat(se," report script ").concat(n," ").concat(e," ").concat(r)),t.stateCenter.reporter.loadScript(!0,n,e,r))})).catch((function(e){t.logger.warn(se," settingConfig "+JSON.stringify(e))})),this.stateCenter.onListener("_cloudSettingNotify",(function(e,n){var r=t.cloudSetting.getEnvVariables()||{},i=t.stateCenter.reporter.createSpan(a.H,{key:Be.event},{key:""},"/cloud_setting/refresh");i.setAttributes({request_kv:ht(r),files:dt([{name:e,content:n.setting,versions:n.versions,code:null==n?void 0:n.code,message:null==n?void 0:n.message}])}),i.end(),e===j&&(t.stateCenter.settingConfig.setSetting(null==n?void 0:n.setting,["remote_log_level"]),r=t.stateCenter.settingConfig.getSetting("remote_log_level"))&&(t.logger.info(se," setting remote_log_level "+r),t.logger.setRemoteLogLevel(r))}))},Hn.prototype.cloudReportNotify=function(e,t,n){0!==(null==n?void 0:n.code)||!1===(null==n?void 0:n.polling)?"request_start"===t?this.stateCenter.reporter.createSpan(a.H,{key:Be.event},{key:ft,par:e+""},ft,!0):"request_end"===t&&this.stateCenter.reporter.spanEnd({key:ft,par:e+""},{request_detail:pt(null==n?void 0:n.reportData),files:gt(null==n?void 0:n.files),code:null==n?void 0:n.code,request_params:null==n?void 0:n.params,request_kv:null==n?void 0:n.requestKV}):this.logger.info("zm.crn not report")},Hn.prototype.loginReport=function(e,t,n,r,i){var o=this,s=Ve,u=this.stateCenter.reporter.createSpan(a.I,{key:Be.event},{key:""},s.event);return u.setAttributes({svr_env:s.svr_env(this.stateCenter.testEnvironment?"test":"online"),token:s.token(r)}),i&&("boolean"==typeof i.userUpdate&&u.setAttribute("user_state_update",s.user_state_update(i.userUpdate?1:0)),"number"==typeof i.maxMemberCount)&&u.setAttributes({max_member_cnt:s.max_member_cnt(i.maxMemberCount)}),{interResolve:function(t){var r=o.getRoomSessionID(n),i=o.getRoomModules(n),a=o.getSessionId(n);u.setAttributes({room_id:s.room_id(n),room_sid_string:s.room_sid_string(r),liveroom_sid_string:s.liveroom_sid_string(a),try_cnt:s.try_cnt(null==(r=null==i?void 0:i.roomTryHandler)?void 0:r.retryActiveCount),server:s.server(null==(a=null==i?void 0:i.roomHandler)?void 0:a.server),room_mode:s.room_mode(o.stateCenter.isMultiRoom?1:0),role:s.role(o.stateCenter.role),audience_create_room:s.audience_create_room(o.stateCenter.roomCreateFlag?1:0),max_member_cnt:s.max_member_cnt((null==i?void 0:i.maxMemberCount)||0)}),u.end(),e(t)},interReject:function(e,r){var i,a;void 0===r&&(r=""),u.setAttributes({room_id:s.room_id(n)}),e.code<2e9&&1e9<e.code||e.code<1e6?(i=G.decodeServerError(e.code,e.msg),a=G.getLiveRoomError(e.code,o.isUseNetAgent)):i={code:e.code,message:e.msg},i&&o.stateCenter.reporter.setError(u,{code:i.code,msg:i.message+r}),a&&O[a]&&(e.code=O[a].code,e.msg.includes("unknown"))&&(e.msg=O[a].msg),e.code&&e.msg&&""!==r?t({code:e.code,msg:e.msg+r}):t(e)},loginSpan:u}},Hn.prototype.logoutRoom=function(e){var t,n=this;this.logger.info(ae+" call by user "+e),this.stateCenter.roomModulesList.length?void 0===e?(Un([],this.stateCenter.roomModulesList,!0).forEach((function(e){n.logoutSpan(e),e.roomHandler.logout(!0)})),this.cloudSetting.uninit()):"string"!=typeof e||""==e?(this.logger.error(ae+" roomID must be string and not empty"),this.logoutSpan(void 0,Xe.error.INPUT_PARAM)):(t=this.getRoomModules(e))?(this.logoutSpan(t),t.roomHandler.logout(),0===this.stateCenter.roomModulesList.length&&this.cloudSetting.uninit()):(this.logger.error(ae+" room not exist"),this.logoutSpan(void 0,Xe.error.ROOM_NOT_EXIST,e)):this.logger.warn(ae+" no room")},Hn.prototype.uploadLog=function(){var e=this;return new Promise((function(t,n){e.logger.info("zm.zip.udlg call"),e.logger.uploadStorageLog().then((function(){e.logger.info("zm.zip.udlg call success"),t({errorCode:0,extendedData:"upload logs success!"})})).catch((function(t){e.logger.error("zm.zip.udlg upload zip log failed, result: "+((null==t?void 0:t.message)||"unknown")),n({errorCode:O.UPLOAD_LOG_ERROR.code,extendedData:O.UPLOAD_LOG_ERROR.msg+", result: "+((null==t?void 0:t.message)||"unknown")})}))}))},Hn.prototype.sendCustomCommand=function(e,t,n){return new Promise((function(e,t){console.error(w),t()}))},Hn.prototype._sendCustomCommand=function(e,t,n){return new Promise((function(e,t){console.error(w),t()}))},Hn.prototype.sendBroadcastMessage=function(e,t){return new Promise((function(e,t){console.error(w),t()}))},Hn.prototype._sendBroadcastMessage=function(e,t,n,r){return void 0===n&&(n=1),void 0===r&&(r=1),new Promise((function(e,t){console.error(w),t()}))},Hn.prototype.setRoomExtraInfo=function(e,t,n){return new Promise((function(e,t){console.error(w),t()}))},Hn.prototype._setRoomExtraInfo=function(e,t,n){return new Promise((function(e,t){console.error(w),t()}))},Hn.prototype.sendBarrageMessage=function(e,t){return new Promise((function(e,t){console.error(w),t()}))},Hn.prototype._sendBarrageMessage=function(e,t,n,r){return void 0===n&&(n=1),void 0===r&&(r=1),new Promise((function(e,t){console.error(w),t()}))},Hn.prototype.sendRelayMessage=function(e,t,n,r,i){console.error(w)},Hn.prototype.requestJoinLive=function(e,t,n,r,i){return console.error(w),!1},Hn.prototype.inviteJoinLive=function(e,t,n,r,i){return console.error(w),!1},Hn.prototype.endJoinLive=function(e,t,n,r){return console.error(w),!1},Hn.prototype.respondJoinLive=function(e,t,n,r,i){return console.error(w),!1},Hn.prototype.getVersion=function(){return this.version},Hn.prototype.setSdkBizVersion=function(e){"string"==typeof e&&""!==e&&(this.stateCenter.bizVersion=e)},Hn.prototype.on=function(e,t){var n=this.stateCenter.reporter.createSpan(a.H,{key:He},{key:""},qe.event);return n.setAttributes({listener:qe.listener(e)}),this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(pe+" listener callBack must be funciton"),this.stateCenter.reporter.setError(n,qe.error.INPUT_PARAM," listener callBack must be function"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),n.end(),!0):(this.logger.error(pe+" event "+e+" no found"),this.stateCenter.reporter.setError(n,qe.error.INPUT_PARAM," event "+e+" no found"),!1)},Hn.prototype.off=function(e,t){var n,r=this.stateCenter.reporter.createSpan(a.H,{key:He},{key:""},"/sdk/off_listener");return r.setAttributes({listener:je(e)}),this.stateCenter.listenerList[e]?(n=this.stateCenter.listenerList[e],t?n.splice(n.indexOf(t),1):this.stateCenter.listenerList[e]=[],r.end(),!0):(this.logger.error("zm.off listener no found"),this.stateCenter.reporter.setError(r,qe.error.INPUT_PARAM," event "+e+" no found"),!1)},Hn.prototype._on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(pe+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(pe+" event "+e+" no found"),!1)},Hn.prototype._off=function(e,t){var n;return this.stateCenter.listenerList[e]?(n=this.stateCenter.listenerList[e],t?n.splice(n.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0):(this.logger.error("zm.off listener no found"),!1)},Hn.prototype.isTestEnvironment=function(){return this.stateCenter.testEnvironment},Hn.prototype.isLogin=function(e){return!!(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])&&e.isLogin()},Hn.prototype.getMultiRoom=function(){return this.stateCenter.isMultiRoom},Hn.prototype.getAppID=function(){return this.stateCenter.appid},Hn.prototype.getUserID=function(){return this.stateCenter.idName},Hn.prototype.getUserName=function(){return this.stateCenter.nickName},Hn.prototype.getToken=function(e){return(this.getRoomModules(e)||this.stateCenter.roomModulesList[0]).token},Hn.prototype.setRoomCreateFlag=function(e){this.stateCenter.roomCreateFlag=e},Hn.prototype.setRole=function(e){this.stateCenter.role=e},Hn.prototype.getSessionId=function(e){return(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])?e.userSidString:"0"},Hn.prototype.getRoomSessionID=function(e){return(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])?e.roomSidString:"0"},Hn.prototype.getAppConfig=function(){return this.stateCenter.appConfig},Hn.prototype.setTestPackageSize=function(e){this.cloudSetting.zegoSetting.settingFetchHandler.testNetPackageSize=e,this.stateCenter.testNetPackageSize=e},Hn.prototype.setAccess=function(e){this.stateCenter.configOK&&(this.stateCenter.netHasSet=!0,this.stateCenter.useNetAgent=e,this.stateCenter.useNetAgent=this.getSettingUnify(!0),this.netAgent.setAccess(this.isUseNetAgent),this.cloudSetting.setOptions({unify:this.isUseNetAgent}))},Hn.prototype.enableMultiRoom=function(e){var t=this.stateCenter.reporter.createSpan(a.H,{key:Be.event},{key:""},ct.event);return"boolean"!=typeof e?(this.logger.error("zm.emr param must be boolean"),this.stateCenter.reporter.setError(t,ct.error.kAlreadyLoginError),!1):(t.setAttribute("is_multi",ct.is_multi(e)),0<this.stateCenter.roomModulesList.length||this.stateCenter.setMultiRoom?(this.logger.error("zm.emr multi room can only be set once before first login"),this.stateCenter.reporter.setError(t,ct.error.kInvalidParamError),!1):(t.end(),this.stateCenter.isMultiRoom=e,this.stateCenter.setMultiRoom=!0))},Hn.prototype.getRoomModules=function(e){return this.stateCenter.roomModulesList.find((function(t){return t.roomID==e}))},Hn.prototype._onAppConfigUpdate=function(e){},Hn.prototype._onBeforePageUnload=function(){},Hn.use=function(e){switch(e.type){case"message":case"live":e.install(Hn,Wt,Qt,Nn)}},Hn.setGeoFence=function(e,t){if(![0,1,2].includes(e))throw new Error("GeoFencing set Error");if(!t.every((function(e){return X.find((function(t){return t===e}))})))throw new Error("GeoFencing set Error");Hn.geoFenceType=e,Hn.geoFenceAreaList=t},Hn.setEngineOptions=function(e){if(e.geoFenceType){if(![0,1,2].includes(e.geoFenceType))throw new Error("GeoFencing set Error");Hn.geoFenceType=e.geoFenceType}if(e.geoFenceAreaList){if(!e.geoFenceAreaList.every((function(e){return $.find((function(t){return t.id===e}))})))throw new Error("GeoFencing set Error");Hn.geoFenceAreaList=e.geoFenceAreaList}Hn.engineOptions=e},Hn.prototype.resetRoomTokenTimer=function(e,t){(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])&&t&&0<t&&e.roomHandler.resetTokenTimer(1e3*t)},Hn.prototype.isDisConnect=function(){return(this.isUseNetAgent?this.liveRoomHandler:this.service).isDisConnect()},Hn.prototype.sendMessage=function(e,t,n,r){(this.isUseNetAgent?this.liveRoomHandler:this.service).sendMessage(e,t,n,r)},Hn.prototype.getNetworkInfo=function(){return this.netAgent.getNTP()},Hn.prototype.setProtoFormat=function(e){if(!["json","pb"].includes(e=void 0===e?"json":e))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.stateCenter.protoFormat=e},Hn.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))&&(this.stateCenter.relateService=e)},Hn.prototype.sendMessageByService=function(e,t,n,r,i,o){return this.service.sendMessage(e,t,n,r,i,o)},Hn.prototype.getHeader=function(e){var t,n,r=this.stateCenter.roomModulesList[0];if(r&&r.isLogin())return t=r.roomID,n=r.sessionID,r=r.roomSessionID,this.service.getHeader(e,n,t,r);this.logger.error("zm.gh room no found or no login")},Hn.prototype.sendPB=function(e){return e instanceof Uint8Array?this.service.sendPB(e):(this.logger.error("zm.spb type error"),!1)},Hn.prototype.onPushBizChannel=function(e){e&&this.service.on("push_biz_channel",e)},Hn.prototype.getRoomID=function(){return this.stateCenter.roomid},Hn.prototype.getServerTimeOffset=function(){return this.stateCenter.serverTimeOffset},Hn.prototype.getReqHead=function(e){return e="string"==typeof e&&""!==e&&this.getRoomModules(e)||this.stateCenter.roomModulesList[0],this.liveRoomHandler.getReqHead(e)},Hn.prototype.sendSwitchMessage=function(e,t){throw this.logger.error("".concat("zm.ssm"," ").concat(O.WHITE_BOARD_VERSION_ERROR.msg)),O.WHITE_BOARD_VERSION_ERROR},Hn.prototype.onSwitchMessage=function(e){e&&this.liveRoomHandler&&(this.liveRoomHandler.onSwitchMessage=e)},Hn.prototype.onAppConfigUpdate=function(e){e&&(this._onAppConfigUpdate=e)},Hn.prototype.onBeforePageUnload=function(e){e&&(this._onBeforePageUnload=e)},Hn.prototype.getProtoVer=function(){return r.SWITCH_TWO},Hn.prototype.sendBusinessMessage=function(e,t,n){return"number"==typeof e&&t?this.liveRoomHandler.sendMessage(e,t,void 0,void 0,n,void 0,!1):-1},Hn.prototype.logoutSpan=function(e,t,n){var r=this,i=this.stateCenter.reporter.createSpan(a.I,{key:Be.event},{key:Xe.event,par:null==e?void 0:e.roomID},Xe.event,!0);i.setAttributes({is_multi:Xe.is_multi(this.stateCenter.isMultiRoom),is_send_cmd_net:Xe.is_send_cmd_net(!0)}),e?i.setAttributes({room_id:Xe.room_id(null==e?void 0:e.roomID),room_sid_string:Xe.room_sid_string(null==e?void 0:e.roomSidString),liveroom_sid_string:Xe.liveroom_sid_string(null==e?void 0:e.userSidString)}):"string"==typeof n&&i.setAttributes({room_id:Xe.room_id(n)}),t?this.stateCenter.reporter.setError(i,t):i.end(),setTimeout((function(){r.reporter.flush()}),200)},Hn.prototype.getMsgSpan=function(e,t,n){return this.stateCenter.reporter.createSpan(a.H,{key:Ve.event,par:t},{key:e,par:t},e,n=void 0!==n&&n)},Hn.prototype.updateTimeOffsetInterval=function(){var e=this;"number"==typeof this.netAgent.timeOffset&&this.stateCenter.reporter.setTimeOffset(this.netAgent.timeOffset),this.timeOffsetUpdateTimer=setTimeout((function(){e.updateTimeOffsetInterval()}),9e5)},Hn.prototype.setLocalGeoFencing=function(){var e;null!=(e=this.stateCenter.netGeoFencing)&&e.id&&null!=(e=this.stateCenter.netGeoFencing)&&e.accesshub&&(e=D(JSON.stringify(this.stateCenter.netGeoFencing),V),B("z_geos_"+this.stateCenter.appid+"_"+(this.stateCenter.mode||K.modeNo),e),this.stateCenter.netGeoFencing={})},Hn.prototype.getLocalGeoFencing=function(){var e=H("z_geos_"+this.stateCenter.appid+"_"+(this.stateCenter.mode||K.modeNo));if(e){if(e=x(e,V))try{return JSON.parse(e)}catch(e){this.logger.warn("zm.glgf local geo descrypt fail")}}else this.logger.info("zm.glgf no local geo");return null},Hn.prototype.getGeoFencingIDAndDomain=function(e,t){var n=[];return 1===e?t.forEach((function(e){var t=$.find((function(t){return t.id===e}));t&&n.push(t)})):2===e&&(n=JSON.parse(JSON.stringify($)),t.forEach((function(e){var t=$.find((function(t){return t.id===e}));t&&(n=n.filter((function(e){return e.id!==(null==t?void 0:t.id)})),t.relative_geofencings.forEach((function(e){n=n.filter((function(t){return t.id!==e}))})))}))),0<n.length?n:null},Hn.rtmVersion="2.0.0",Hn);function Hn(e,t,n,r,o,s,c,l){var h,d,g,_=this,m=(this.logger=n,this.dataReport=r,this.reporter=o,this.version=s,this.options=l,this.roomLoginResponseListener=function(){clearTimeout(_.cloudSettingTimer),_.cloudSettingTimer=setTimeout((function(){_.logger.info(se+" fetch cloud setting"),_.getCloudSetting()}),100)},this.stateCenter=new Bt(this.logger,this.dataReport),this.stateCenter.ENV=c,this.stateCenter.product=q.product,this.cloudSetting=new Pn,this.getReportSeq=p,this.getSeq=f,this.initCallback(),this.stateCenter.deviceID=G.generateUUID(c),this.logger.info("".concat(re," device ID is ").concat(this.stateCenter.deviceID)),this.reporter.init(e,c,this.stateCenter.deviceID),this.reporter.setLogger(this.logger),this.stateCenter.reporter=this.reporter,Be),v=this.stateCenter.reporter.createSpan(a.H,{key:""},{key:m.event},m.event,!0);0!=c&&1!=c||this.setDebug(t),n="Express";null!=(r=this.options)&&r.reportData&&(h=null==(s=null==(o=this.options)?void 0:o.reportData)?void 0:s.version,n=(null==(r=null==(l=this.options)?void 0:l.reportData)?void 0:r.project)||n),v.setAttributes({biz_type:m.biz_type(0),project:m.project(n),servers:m.servers("string"==typeof t?[t]:t),liveroom_version:m.liveroom_version(h),is_from_cache:m.is_from_cache(!1),sev_env:m.sev_env(this.stateCenter.testEnvironment?"test":"online")}),G.checkConfigParam(e,t,this.logger)?(this.stateCenter.appid=e,this.stateCenter.configOK=!0,this.stateCenter.sdKVersion=this.version,this.stateCenter.testEnvironment&&(this.stateCenter.mode=E.MODE_TEST),this.netAgent=new I,this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version),this.netAgent.init(),this.netAgent.setLogger(this.logger),o={appID:this.stateCenter.appid,env:this.stateCenter.ENV,mode:this.stateCenter.mode},Hn.geoFenceType&&Hn.geoFenceAreaList&&(o.geoFencing={type:Hn.geoFenceType,list:Hn.geoFenceAreaList}),this.netAgent.setAppInfo(o),this.liveRoomHandler=new Nn(this.logger,this.stateCenter,this.netAgent,this.dataReport,this),this.service=new Qt(this.stateCenter,this.logger,this),s="",0===c?s="rtc":1===c&&(s="ali"),this.stateCenter.settingConfig=new en,this.cloudSetting.setLog(this.logger),this.cloudSetting.init({productNum:1,appID:e,env:c,pollingNotify:function(e,t){_.logger.info(re," setting file changed "+e+" "+JSON.stringify(t)),_.stateCenter.actionListener("_cloudSettingNotify",e,t)},reportNotify:this.cloudReportNotify.bind(this),online:!this.stateCenter.testEnvironment,unify:this.isUseNetAgent,connection:this.netAgent}),(l=this.stateCenter.settingConfig.getSetting("remote_log_level"))&&(this.logger.info("".concat(re," setting remote_log_level default ").concat(l)),this.logger.setRemoteLogLevel(l)),void 0!==(r=this.stateCenter.settingConfig.getSetting("zip_log"))&&(this.logger.info("".concat(re," setting zip_log default ").concat(r)),this.logger.setZipLogConfig(r)),this.cloudSetting.setEnvVariable("environment",s),n=this.cloudSetting.getSettingCache(j),h=this.cloudSetting.getSettingCache("room"),d=!1,g=setTimeout((function(){_.logger.warn("".concat(re," time out, get cache settings failed!")),_.isUseNetAgent&&(d=!0,_.createNetAgent(),_.getStoreAppConfig()),v.setAttributes({use_na:m.use_na(_.isUseNetAgent?1:0)}),v.end()}),3e3),Promise.all([n,h]).then((function(n){g&&clearTimeout(g);var r=null==n?void 0:n[0],i=((s=(void 0!==(s=((s=(_.stateCenter.settingConfig.setSetting(null==r?void 0:r.setting),_.stateCenter.useNetAgent=_.getSettingUnify(_.stateCenter.netHasSet),_.cloudSetting.setOptions({unify:_.isUseNetAgent}),_.isUseNetAgent&&!d&&(_.createNetAgent(),_.getStoreAppConfig()),_.stateCenter.settingConfig.getSetting("remote_log_level",!0)))&&(_.logger.info("".concat(re,"  setting remote_log_level ").concat(s)),_.logger.setRemoteLogLevel(s)),_.handleZipLogUrl(),_.stateCenter.settingConfig.getSetting("zip_log")))&&(_.logger.info("".concat(re," setting zip_log ").concat(s)),_.logger.setZipLogConfig(s)),_.stateCenter.settingConfig.getSetting("report_script")))?(i=s.url,o=s.key,s=s.hash,_.logger.info("".concat(re," report script ").concat(i," ").concat(o," ").concat(s)),_.stateCenter.reporter.loadScript(!1,i,o,s),v.setAttributes({lua_md5:m.lua_md5(s)})):_.stateCenter.reporter.loadScript(!1,"","",""),null==n?void 0:n[1]),o=(_.stateCenter.settingConfig.setSetting(null==i?void 0:i.setting),_.stateCenter.reporter.createSpan(a.H,{key:m.event},{key:""},"/cloud_setting/cache")),s=(o.setAttributes({files:lt([{name:j,content:JSON.stringify(null==r?void 0:r.setting),versions:JSON.stringify(null==r?void 0:r.versions),code:0,message:""},{name:"room",content:JSON.stringify(null==i?void 0:i.setting),versions:JSON.stringify(null==i?void 0:i.versions),code:0,message:""}])}),o.end(),v.setAttributes({use_na:m.use_na(_.isUseNetAgent?1:0)}),v.end(),Array.isArray(t)?t[0]:t);if(!_.isUseNetAgent&&!U(s,e))throw _.logger.error("".concat(re," the server does not match the appID")),new Error("The server does not match the appID")})).catch((function(e){if(g&&clearTimeout(g),v.setAttributes({use_na:m.use_na(_.isUseNetAgent?1:0)}),v.end(),_.logger.warn("".concat(re,"  initConfig ").concat(JSON.stringify(e))),(null==e?void 0:e.code)===O.GEO_SET_ERROR.code)throw Error("GeoFencing set Error")})),"string"==typeof t?(this.stateCenter.server=t,this.stateCenter.serverBak=t):Array.isArray(t)&&0<t.length&&(this.stateCenter.server=t[0],this.stateCenter.serverBak=t[1]||t[0]),this.logger.info("".concat(re,"  ").concat(null===navigator||void 0===navigator?void 0:navigator.appVersion," ").concat(this.version," rtmVersion: ").concat(Hn.rtmVersion," logVersion:").concat(i.ZegoLogger.logVersion)),this.bindWindowListener(),this.stateCenter.networkState=!navigator||navigator.onLine?u.online:u.offline,o="Firefox"===P()?null===navigator||void 0===navigator?void 0:navigator.userAgent:null===navigator||void 0===navigator?void 0:navigator.appVersion,v.setAttribute("sys_info",o||""),this.initSpans(),this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version)):(this.logger.error("".concat(re," init sdk error")),this.stateCenter.reporter.setError(v,m.error.kInvalidParamError)),this.stateCenter.onListener("roomLoginResponse",this.roomLoginResponseListener)}var zn=n(7),Gn=function(){return(Gn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Fn=(qn.prototype.init=function(e,t,n){var r=this,i=0==t?"rtc":"ali";this.tracer.init({product:this.product,version:"1.0.0",env:t,appID:e,deviceID:n,importantLevel:q.importLevel,levels:q.levels,bps:q.bps,spanStart:function(e){try{"function"==typeof scriptSpanStart&&scriptSpanStart(r.commonStates,r.tracer,e)}catch(e){r.logger.warn("zm.tc.ii dy span start ",JSON.stringify(e))}},spanBeforeEnd:function(e){e.setAttribute("ntype_end",M())},spanEnd:function(e,t){try{"function"==typeof scriptSpanEnd&&scriptSpanEnd(r.commonStates,r.tracer,e)}catch(e){r.logger.warn("zm.tc.ii dy span end ",JSON.stringify(e))}},resources:{product:this.product,appid:e,device_id:n,console:i}})},qn.prototype.setConfig=function(e){this.tracer.setConfig(e)},qn.prototype.loadScript=function(e,t,n,r){return function(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){var i;return function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){var c=[a,u];if(n)throw new TypeError("Generator is already executing.");for(;o=s&&c[s=0]?0:o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,(c=i?[2&c[0],i.value]:c)[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3]))o.label=c[1];else if(6===c[0]&&o.label<i[1])o.label=i[1],i=c;else{if(!(i&&o.label<i[2])){i[2]&&o.ops.pop(),o.trys.pop();continue}o.label=i[2],o.ops.push(c)}}c=t.call(e,o)}catch(u){c=[6,u],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.tracer.loadJs(e,t,n,r,"\nfunction scriptSpanStart(states, tracer, span) {\n    \n}\nfunction scriptSpanEnd(states, tracer, span) {\n    if (span['tags']['msg_content']) {\n        span['tags']['msg_content_size'] = span['tags']['msg_content'].length;\n        delete span['tags']['msg_content'];\n    }\n    delete span['tags']['resp'];\n    const filterSpans = ['/rtc/login', '/rtc/hb', '/rtc/recv_remote_stream'];\n    if (filterSpans.includes(span.name)) {\n        console.log(span.name + ' do not report');\n        span.droped = true;\n    }\n}\nfunction scriptInit(states, tracer) {\n\n}\n\n",{})];case 1:return o.sent(),"function"==typeof scriptInit&&scriptInit(this.commonStates,this.tracer),[3,3];case 2:return i=o.sent(),this.logger.warn("zm.tc.ls"," load script fail "+JSON.stringify(i)),[3,3];case 3:return[2]}}))}))},qn.prototype.setReporterInfo=function(e,t){var n=new Map;n.set("userID",e),n.set("token",t),this.tracer.startReport(n)},qn.prototype.flush=function(e){this.tracer.flush(e)},qn.prototype.destroy=function(){this.tracer.destroy()},qn.prototype.setCommonStates=function(e){this.commonStates=e},qn.prototype.setResource=function(e){this.tracer.setResource(e)},qn.prototype.setCommonAttributes=function(e){this.commonAttrs=Object.assign({},this.commonAttrs,e)},qn.prototype.createSpan=function(e,t,n){return(e=this.tracer.createSpan(e,t,{parent:n})).setAttributes(Gn({ntype:M(),error:0,message:""},this.commonAttrs)),e},qn.prototype.spanEnd=function(e,t){e&&t&&e.setAttributes(Gn({},t)),e&&e.end()},qn.prototype.spanSetAttributes=function(e,t){e&&e.setAttributes(t)},qn.prototype.spanAppendAttribute=function(e,t,n){e&&e.appendAttribute(t,n)},qn.prototype.setError=function(e,t,n){e.setAttributes({error:t.code||t.errorCode,message:(t.msg||t.message||t.extendedData)+" "+(n=void 0===n?"":n)}),e.end()},qn.prototype.setLogger=function(e){this.tracer.setLogger(e)},qn.prototype.setTimeOffset=function(e){this.tracer.setTimeOffset(e)},qn.prototype.setUnloadState=function(e){this.isUnload=!0,this.tracer.setUnloadState(e)},qn.prototype.setNetStateCheck=function(){this.tracer.setNetStateCheck()},qn);function qn(e){this.logger=e,this.product=q.product,this.commonAttrs={},this.commonStates={},this.isUnload=!1,new zn.DynamicCode,this.tracer=new zn.ZegoTracer,this.tracer.setSampleConfig({level:a.L})}var jn=["/sdk/start_publish","/publish/start","/publish/restart"],Vn=["/sdk/start_play","/play/start","/play/restart"],Yn=(Wn.prototype.init=function(e,t,n){this.tracerHandler.init(e,t,n)},Wn.prototype.setConfig=function(e){this.tracerHandler.setConfig(e)},Wn.prototype.loadScript=function(e,t,n,r){return this.tracerHandler.loadScript(e,t,n,r)},Wn.prototype.setReporterInfo=function(e,t){this.tracerHandler.setReporterInfo(e,t)},Wn.prototype.flush=function(e){this.tracerHandler.flush(e)},Wn.prototype.destroy=function(){this.tracerHandler.destroy()},Wn.prototype.setCommonStates=function(e){this.tracerHandler.setCommonStates(e)},Wn.prototype.setResource=function(e){this.tracerHandler.setResource(e)},Wn.prototype.setCommonAttributes=function(e){this.tracerHandler.setCommonAttributes(e)},Wn.prototype.setPublicPros=function(e){this.publicPros=Object.assign({},this.publicPros,e)},Wn.prototype.createSpan=function(e,t,n,r,i){var o;t&&t.key&&t.par?(s=t.par1?"_"+t.par1:"",!(o=null==(o=this.reportList[t.key])?void 0:o[t.par+s])&&t.bak_key&&(o=null==(a=this.reportList[t.bak_key])?void 0:a[t.par+s])):t&&!(o=this.reportList[t.key])&&t.bak_key&&(o=this.reportList[t.bak_key]),o=o||this.reportList[Be.event];var s,a=this.tracerHandler.createSpan(e,r,o);return"/sdk/login"===t.key&&(a.setAttribute("room_id",t.par),this.publicPros[t.par])&&a.setAttributes(this.publicPros[t.par]),(jn.includes(t.key)||Vn.includes(t.key))&&a.setAttribute("stream_id",t.par),jn.includes(t.key)&&this.publicPros["_publish_"+t.par]&&a.setAttributes(this.publicPros["_publish_"+t.par]),Vn.includes(t.key)&&this.publicPros["_play_"+t.par]&&a.setAttributes(this.publicPros["_play_"+t.par]),i&&(n.par?(this.reportList[n.key]||(this.reportList[n.key]={}),s=n.par1?"_"+n.par1:"",this.reportList[n.key][n.par+s]=a):this.reportList[n.key]=a),a},Wn.prototype.setSpanInMap=function(e,t){var n;t.par?(this.reportList[t.key]||(this.reportList[t.key]={}),n=t.par2?"_"+t.par2:"",this.reportList[t.key][t.par+n]=e):this.reportList[t.key]=e},Wn.prototype.spanEnd=function(e,t,n){var r;e.par?(r=e.par1?"_"+e.par1:"",r=this.reportList[e.key]&&this.reportList[e.key][e.par+r],this.reportList[e.key]&&!n&&delete this.reportList[e.key][e.par]):(r=this.reportList[e.key],n||delete this.reportList[e.key]),this.tracerHandler.spanEnd(r,t)},Wn.prototype.spanSetAttributes=function(e,t){var n,r;e.par?(n=e.par1?"_"+e.par1:"",!(r=this.reportList[e.key]&&this.reportList[e.key][e.par+n])&&e.bak_key&&(r=this.reportList[e.bak_key]&&this.reportList[e.bak_key][e.par+n])):!(r=this.reportList[e.key])&&e.bak_key&&(r=this.reportList[e.key]),this.tracerHandler.spanSetAttributes(r,t)},Wn.prototype.spanAppendAttribute=function(e,t,n){var r,i;e.par?(r=e.par1?"_"+e.par1:"",!(i=this.reportList[e.key]&&this.reportList[e.key][e.par+r])&&e.bak_key&&(i=this.reportList[e.bak_key]&&this.reportList[e.bak_key][e.par+r])):!(i=this.reportList[e.key])&&e.bak_key&&(i=this.reportList[e.key]),this.tracerHandler.spanAppendAttribute(i,t,n)},Wn.prototype.setError=function(e,t,n){this.tracerHandler.setError(e,t,n)},Wn.prototype.setLogger=function(e){this.tracerHandler.setLogger(e)},Wn.prototype.setTimeOffset=function(e){this.tracerHandler.setTimeOffset(e)},Wn.prototype.setUnloadState=function(e){this.tracerHandler.setUnloadState(e)},Wn.prototype.setNetStateCheck=function(){this.tracerHandler.setNetStateCheck()},Wn);function Wn(e){this.logger=e,this.reportList={},this.publicPros={},this.tracerHandler=new Fn(e)}Kn.prototype.enableMultiRoom=function(e){return this.zegoWebRTM.enableMultiRoom(e)},Kn.prototype.loginRoom=function(e,t,n,r){return this.zegoWebRTM.loginRoom(e,t,n,r)},Kn.prototype.logoutRoom=function(e){return this.zegoWebRTM.logoutRoom(e)},Kn.prototype.renewToken=function(e,t){return this.zegoWebRTM.renewToken(e,t)},Kn.prototype.sendBarrageMessage=function(e,t){return this.zegoWebRTM.sendBarrageMessage(e,t)},Kn.prototype.sendBroadcastMessage=function(e,t){return this.zegoWebRTM.sendBroadcastMessage(e,t)},Kn.prototype.sendCustomCommand=function(e,t,n){return this.zegoWebRTM.sendCustomCommand(e,t,n)},Kn.prototype.setRoomExtraInfo=function(e,t,n){return this.zegoWebRTM.setRoomExtraInfo(e,t,n)},Kn.prototype.setLogConfig=function(e){return this.zegoWebRTM.setLogConfig(e)},Kn.prototype.setDebugVerbose=function(e){return this.zegoWebRTM.setDebugVerbose(e)},Kn.prototype.on=function(e,t){return this.zegoWebRTM.on(e,t)},Kn.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},Kn.prototype.off=function(e,t){return this.zegoWebRTM.off(e,t)},Kn.use=function(e){Bn.use(e)},Kn.setGeoFence=function(e,t){Bn.setGeoFence(e,t)},Kn.setEngineOptions=function(e){Bn.setEngineOptions(e)},Kn.version="2.0.0";var Zn=Kn;function Kn(e,t,n,r){this.logger=new i.ZegoLogger(n=void 0===n?0:n),this.dataReport=new i.ZegoDataReport(this.logger),this.reporter=new Yn(this.logger),this.zegoWebRTM=new Bn(e,t,this.logger,this.dataReport,this.reporter,Kn.version,n,r)}}],i={},n.m=r,n.c=i,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19);function n(e){var t;return(i[e]||(t=i[e]={i:e,l:!1,exports:{}},r[e].call(t.exports,t,t.exports,n),t.l=!0,t)).exports}var r,i}));