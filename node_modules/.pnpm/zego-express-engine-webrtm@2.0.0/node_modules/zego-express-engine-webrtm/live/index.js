!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r,i=t();for(r in i)("object"==typeof exports?exports:e)[r]=i[r]}}("undefined"!=typeof self?self:this,(function(){return t={21:function(e,t,r){"use strict";function i(e){return e}r.r(t);var o="zm.lv.ssg",n="zm.lv.pss",s="/liveroom/send_end_join_live",u=i,a=i,l="/liveroom/send_invite_join_live",d=i,v=i,h="/liveroom/send_join_live_result",f=i,p=i,m="/liveroom/send_request_join_live",c=i,g=i,_={code:1002014,msg:"room not exist"},L={code:1002099,msg:"room inner error"},C=(y.prototype.resetLiveHandler=function(){this.joinLiveCallbackMap={},this.joinLiveRequestMap={}},y.prototype.getSignalCmdContent=function(e,t,r){return e={request_id:e,room_id:this.room.roomID,from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,to_userid:t},null!=r&&(e.result=r),JSON.stringify(e)},y.prototype.requestJoinLive=function(e,t,r,i){var o,n=this.stateCenter.getRequestId(),s=this.getSignalCmdContent(n,e);return null!=i&&(this.stateCenter.reporter.spanSetAttributes({key:m,par:null==(o=this.room)?void 0:o.roomID},{request_id:g(n)}),this.joinLiveCallbackMap[n]=i,this.sendSignalCmd(1001,s,e,t,r),!0)},y.prototype.sendSignalCmd=function(e,t,r,i,n){var s=this;this.room.isLogin()?((this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendSignalCmd({sub_cmd:e,signal_msg:t,dest_id_name:[r]},(function(e){i&&i(e.header.seq)}),(function(e){var t=L;e.header&&e.body?n&&n(s.rtm.getServerError(e.body.err_code),e.header.seq):(e.code&&e.msg&&(t=e),n&&n(t,0))}),this.room),this.logger.info(o+" call success"+e)):this.logger.error(o+" state error")},y.prototype.inviteJoinLive=function(e,t,r,i){var o,n=this.stateCenter.getRequestId(),s=this.getSignalCmdContent(n,e);return null!=i&&(this.stateCenter.reporter.spanSetAttributes({key:l,par:null==(o=this.room)?void 0:o.roomID},{request_id:v(n)}),this.joinLiveCallbackMap[n]=i,this.sendSignalCmd(1003,s,e,t,r),!0)},y.prototype.endJoinLive=function(e,t,r){var i,o=this.stateCenter.getRequestId(),n=this.getSignalCmdContent(o,e);return this.stateCenter.reporter.spanSetAttributes({key:s,par:null==(i=this.room)?void 0:i.roomID},{request_id:a(o)}),this.sendSignalCmd(1004,n,e,t,r),!0},y.prototype.respondJoinLive=function(e,t,r,i){var o=this.joinLiveRequestMap[e];if(!o)return this.logger.info("zm.lv.rjl no dest id name"),!1;this.stateCenter.reporter.spanSetAttributes({key:h,par:null==(n=this.room)?void 0:n.roomID},{to_user_id:f(o)});var n=0;t=this.getSignalCmdContent(e,o,n=!0===t?1:n);return this.sendSignalCmd(1002,t,o,r,i),delete this.joinLiveRequestMap[e],!0},y.prototype.handlePushSignalMsg=function(e){var t=JSON.parse(e.body.signal_msg);switch(this.logger.info(n+" hpsm= ",t),e.body.sub_cmd){case 11001:this.handlePushJoinLiveRequestMsg(t);break;case 11002:this.handlePushJoinLiveResultMsg(t);break;case 11003:this.handlePushJoinLiveInviteMsg(t);break;case 11004:this.handlePushJoinLiveStopMsg(t)}},y.prototype.handlePushJoinLiveRequestMsg=function(e){var t,r=e.request_id;"string"!=typeof r?this.logger.error(n+" no requestId"):"string"!=typeof(t=e.from_userid)?this.logger.error(n+" no from user"):(this.joinLiveRequestMap[r]=t,this.onRecvJoinLiveRequest(r,e.from_userid,e.from_username,e.room_id),this.logger.info(n+" onRecvJoinLiveRequest "+t))},y.prototype.onRecvJoinLiveRequest=function(e,t,r,i){this.stateCenter.actionListener("recvJoinLiveRequest",e,t,r,i)},y.prototype.handlePushJoinLiveInviteMsg=function(e){var t,r=e.request_id;"string"!=typeof r?this.logger.error(n+"no requestId"):"string"!=typeof(t=e.from_userid)?this.logger.error(n+" no from user"):(this.joinLiveRequestMap[r]=t,this.onRecvInviteJoinLiveRequest(r,e.from_userid,e.from_username,e.room_id),this.logger.info(n+" onRecvInviteJoinLiveRequest "+t))},y.prototype.onRecvInviteJoinLiveRequest=function(e,t,r,i){this.stateCenter.actionListener("recvInviteJoinLiveRequest",e,t,r,i)},y.prototype.handlePushJoinLiveResultMsg=function(e){var t,r,i=e.request_id;"string"!=typeof i?this.logger.error(n+" no requestId"):null==(t=e.result)?this.logger.info(n+" no result"):(t=1==t,this.joinLiveCallbackMap[i]&&((r=this.joinLiveCallbackMap[i])?(this.logger.info(n+" joinLiveRequest/invite result "+t),delete this.joinLiveCallbackMap[i],r(t,e.from_userid,e.from_username)):this.logger.info(n+" no callback")))},y.prototype.handlePushJoinLiveStopMsg=function(e){var t=e.request_id;"string"!=typeof t?this.logger.error(n+" no requestId"):(this.logger.info(n+" onRecvEndJoinLiveCommand "+e.from_userid),this.onRecvEndJoinLiveCommand(t,e.from_userid,e.from_username,e.room_id))},y.prototype.onRecvEndJoinLiveCommand=function(e,t,r,i){this.stateCenter.actionListener("recvEndJoinLiveCommand",e,t,r,i)},y);function y(e,t,r,i,o,n){this.logger=e,this.stateCenter=t,this.service=r,this.liveRoomHandler=i,this.rtm=o,this.room=n,this.joinLiveCallbackMap={},this.joinLiveRequestMap={}}var b={requestJoinLive:function(e,t,r,i,o){var n=this,s=this.getMsgSpan(m,o||(null==(u=this.stateCenter.roomModulesList[0])?void 0:u.roomID),!0),u=this.getRoomModules(o)||this.stateCenter.roomModulesList[0];return u?(s.setAttributes({to_user_id:c(e)}),u.liveHandler.requestJoinLive(e,(function(e){s.end(),t(e)}),(function(e,t){n.stateCenter.reporter.setError(s,e),r(e,t)}),i)):(this.stateCenter.reporter.setError(s,_),r&&r(_,0),!1)},inviteJoinLive:function(e,t,r,i,o){var n=this,s=this.getMsgSpan(l,o||(null==(u=this.stateCenter.roomModulesList[0])?void 0:u.roomID),!0),u=this.getRoomModules(o)||this.stateCenter.roomModulesList[0];return u?(s.setAttributes({to_user_id:d(e)}),u.liveHandler.inviteJoinLive(e,(function(e){s.end(),t(e)}),(function(e,t){n.stateCenter.reporter.setError(s,e),r(e,t)}),i)):(this.stateCenter.reporter.setError(s,_),r&&r(_,0),!1)},endJoinLive:function(e,t,r,i){var o=this,n=this.getMsgSpan(s,i||(null==(a=this.stateCenter.roomModulesList[0])?void 0:a.roomID),!0),a=this.getRoomModules(i)||this.stateCenter.roomModulesList[0];return a?(n.setAttributes({to_user_id:u(e)}),a.liveHandler.endJoinLive(e,(function(e){n.end(),t(e)}),(function(e,t){o.stateCenter.reporter.setError(n,e),r(e,t)}))):(this.stateCenter.reporter.setError(n,_),r&&r(_,0),!1)},respondJoinLive:function(e,t,r,i,o){var n=this,s=this.getMsgSpan(h,o||(null==(u=this.stateCenter.roomModulesList[0])?void 0:u.roomID),!0),u=this.getRoomModules(o)||this.stateCenter.roomModulesList[0];return u?(s.setAttributes({request_id:p(e),join_result:t}),u.liveHandler.respondJoinLive(e,t,(function(e){s.end(),r(e)}),(function(e,t){n.stateCenter.reporter.setError(s,e),i(e,t)}))):(this.stateCenter.reporter.setError(s,_),i&&i(_,0),!1)}},M={handlePushSignalMsg:function(e){var t=null==(r=null==e?void 0:e.header)?void 0:r.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==t}));r?r.liveHandler.handlePushSignalMsg(e):this.logger.error("zm.sv.ps room no found ignore "+JSON.stringify(e))}},q={initLiveHandler:function(){this.liveHandler=new C(this.logger,this.stateCenter,this.service,this.liveRoomHandler,this.rtm,this)}};t.default={type:"live",install:function(e,t,r,i){for(var o in b)Object.defineProperty(e.prototype,o,{value:b[o],writable:!1});for(var o in M)Object.defineProperty(r.prototype,o,{value:M[o],writable:!1}),Object.defineProperty(i.prototype,o,{value:M[o],writable:!1});for(var o in q)Object.defineProperty(t.prototype,o,{value:q[o],writable:!1})}}}},r={},e.m=t,e.c=r,e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:i})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)e.d(i,o,function(e){return t[e]}.bind(null,o));return i},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=21);function e(i){var o;return(r[i]||(o=r[i]={i:i,l:!1,exports:{}},t[i].call(o.exports,o,o.exports,e),o.l=!0,o)).exports}var t,r}));