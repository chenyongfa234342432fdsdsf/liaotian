import{i18n as r}from"@lingui/core";import{useState as i,useRef as ie,useEffect as B}from"react";import C from"@nbit/arco";import{I as N}from"./chunk-c41c86a9.js";import{o as ae}from"./chunk-86c9a026.js";import{L as ne}from"./chunk-38b7cb18.js";import{b as le}from"./chunk-20806ff6.js";import{u as ce,a as U}from"./chunk-33e5f5bc.js";import{l as j}from"./chunk-75081d50.js";import{L as A}from"./chunk-6bf38136.js";import"./chunk-20abda34.js";import{C as me}from"./chunk-52911f54.js";import{u as de}from"./chunk-7a6de6d7.js";import{c as ue,d as _e,g as fe,p as pe}from"./chunk-eddfc2c9.js";import{c as ge}from"./chunk-60db822c.js";import{u as he}from"./chunk-c4940547.js";import{g as ye,b as be}from"./chunk-357fcbd2.js";import{u as xe}from"./chunk-b1571a13.js";import{e as Ce,v as Ne,p as we}from"./chunk-385bfa11.js";import{U as Ie}from"./chunk-e44b5a13.js";import{j as s,a}from"./chunk-ea028b12.js";import"classnames";import"./chunk-77d12848.js";import"@nbit/utils";import"react-lazy-load-image-component";import"./chunk-687b5088.js";import"make-plural/plurals";import"ahooks";import"axios";import"zustand";import"zustand/middleware";import"react-tracked";import"immer";import"store";import"vike/client/router";import"crypto-js";import"pinyin";import"js-cookie";import"lodash";const ve="create-account-index-module__scoped--zag",ke={scoped:ve};var F,L;const{Form:n,Input:f,Button:E,Message:w}=(L=(F=C)==null?void 0:F.default)!=null&&L.__esModule?C.default:C;function us(){de();const{setBusinessId:I,setAccessKey:v}=he(),{setUserTransitionDatas:k,setUserInfo:q,setLogin:S,setZimToken:R}=ce(),[u,h]=i(0),[y,V]=i(""),[_,z]=i(""),[b,M]=i(""),[o,P]=i("email"),[p,$]=i(!1),[G,l]=i(!1),[x,O]=i(!1),g=ie(),[c]=n.useForm(),[K,T]=i(!1),D=()=>{T(!0)},H=()=>{T(!1)},W=e=>{V(e.countryName),z(e.countryEnCode),M(e.countryShortName),c.setFieldValue("area",e.countryName)},Z=()=>{ge({}).then(e=>{if(e.isOk&&e.data){let{countryName:t,countryShortName:m,countryEnCode:d}=e.data;V(t||""),z(d||""),M(m||""),c.setFieldValue("area",t)}})},J=()=>{const e={mobile:{validateName:["account","area","serverId"],sendRequest:Q},email:{validateName:["email","serverId"],sendRequest:X}};c.validate(e[o].validateName).then(()=>{e[o].sendRequest()}).catch(()=>{})},Q=()=>{const{account:e}=c.getFieldsValue();fe({mobileNumber:e,mobileCountryCd:_,typeCd:"1"}).then(m=>{var d;m.isOk&&((d=m.data)!=null&&d.success)&&h(60)})},X=()=>{let t={email:c.getFieldValue("email"),typeCd:"1"};pe(t).then(m=>{var d;m.isOk&&((d=m.data)!=null&&d.success)&&h(60)})},Y=()=>{$(!p),c.setFieldValue("protocol",!p)},ee=async e=>{{l(!0);const t=await be(e.serverId);if(t)I(e.serverId),t&&v(t);else{l(!1),v(""),I("1"),await w.error(r._("features_users_create_account_index_sysmxmxmi8"));return}}o==="mobile"?re(e):se(e)},se=async e=>{l(!0);const{data:t}=await ue({email:e.email,loginPassword:e.loginPassword,emailCode:e.code,regCountry:b,mobileCountryCd:_});if(!t){l(!1);return}R((t==null?void 0:t.zeGoToken)||""),q({...t==null?void 0:t.userInfo,bindCountry:y}),S(!0),U(t),l(!1),g.current={email:e.email,password:e.loginPassword,verifyCode:e.code},k({...g.current}),w.success(r._("features_users_create_account_index_hs4vign49m")),j("/set-information")},te=()=>{O(!x)},re=async e=>{l(!0);const{data:t}=await _e({mobileNumber:e.account,loginPassword:e.loginPassword,mobileTelCode:e.code,regCountry:b,mobileCountryCd:_});if(!t){l(!1);return}l(!1),R((t==null?void 0:t.zeGoToken)||""),q({...t==null?void 0:t.userInfo,bindCountry:y}),U(t),S(!0),g.current={mobileCountryCd:_,mobile:e.account,shortName:b,password:e.loginPassword,verifyCode:e.code},k({...g.current}),w.success(r._("features_users_create_account_index_hs4vign49m")),j("/set-information")};B(()=>{Z()},[]),B(()=>{let e=null;return u>0?e=setInterval(()=>{h(t=>t-1)},1e3):clearInterval(e),()=>{e&&clearInterval(e)}},[u]);const oe=`${xe("terms_service")}?redirect=/register`;return s(Ie,{children:a("div",{className:ke.scoped,children:[s(le,{}),s("div",{className:"qcode-box",children:s("div",{className:"qcrode",children:s(ne,{className:"overflow-hidden rounded-3xl",src:`${ae}plogo.png`})})}),s(n,{form:c,layout:"vertical",onSubmit:ee,autoComplete:"off",validateTrigger:"onBlur",children:a("div",{className:"register-box",children:[a("h1",{className:"text-text_color_01 font-semibold size32",children:[o==="email"?r._("features_settings_center_personal_information_index_suyk940elg"):r._("features_settings_center_personal_information_index_4sbsiya1gg"),r._("features_users_create_account_index_xyxpcp1rku")]}),s(n.Item,{className:"list-item server-box",field:"serverId",requiredSymbol:!1,rules:[{required:!0,message:r._("features_users_create_account_index_xhrbqemwnq")}],children:s(f,{autoComplete:"off",placeholder:r._("features_users_create_account_index_xhrbqemwnq"),className:"input-box"})}),s("div",{className:"tab-box",children:a("ul",{children:[s("li",{className:o==="email"?"active":"",onClick:()=>P("email"),children:r._("features_settings_center_personal_information_index_suyk940elg")}),s("li",{className:o==="mobile"?"active":"",onClick:()=>P("mobile"),children:r._("features_settings_center_personal_information_index_4sbsiya1gg")})]})}),a("div",{className:"register-content",children:[s(n.Item,{className:"list-item cursor-pointer",field:"area",requiredSymbol:!1,rules:[{required:!0,message:r._("features_users_create_account_index_0dlxrrysk4")}],children:s(f,{readOnly:!0,value:y,onClick:D,suffix:s(N,{name:"icon_chat_arrow",fontSize:16,className:"text-icon_color"}),placeholder:r._("features_users_create_account_index_0dlxrrysk4"),className:"area"})}),o==="mobile"&&s(n.Item,{className:"list-item",field:"account",requiredSymbol:!1,rules:[{required:!0,message:r._("features_settings_center_bind_mobile_index_rocukuvszt")}],children:s(f,{addBefore:_?`+${_}`:"--",placeholder:r._("features_settings_center_bind_mobile_index_rocukuvszt"),className:"input-box"})}),o==="email"&&s(n.Item,{className:"list-item",field:"email",requiredSymbol:!1,rules:[Ce()],children:s(f,{placeholder:r._("features_users_create_account_index_jgkp094fey"),className:"input-box"})}),s(n.Item,{className:"list-item",requiredSymbol:!1,field:"code",rules:[Ne(u>0)],children:s(f,{placeholder:o==="email"?r._("features_settings_center_verify_identidy_index_rwtzuuhnki"):r._("features_settings_center_bind_mobile_index_avn5naqutc"),className:"input-box",addAfter:s(E,{onClick:J,disabled:u>0,className:"getcode pr-4",type:"text",children:u>0?`${u}s`:r._("features_users_create_account_index_dlm0wqw8rw")})})}),s(n.Item,{className:"list-item last-item",requiredSymbol:!1,field:"loginPassword",rules:[we()],children:s(f,{type:x?"text":"password",className:"input-box",suffix:s(N,{name:x?"icon_register_open":"icon_register_hide",fontSize:22,onClick:te,className:"password-icon pr-4 text-icon_color"}),placeholder:r._("features_users_create_account_index_uqp_bpomjo")})})]}),s(n.Item,{requiredSymbol:!1,field:"protocol",rules:[{required:!0,message:r._("features_users_create_account_index_ytob4evvng")}],children:a("div",{className:"flex mt-4 justify-start w-full",children:[s(N,{name:p?"icon_register_single_selected":"icon_register_single_unselected",fontSize:20,className:p?"country-icon-active":"country-icon",onClick:Y}),a("p",{className:"text-sm text-text_color_02",children:[r._({id:"features_settings_center_logout_index_g9lscxwdky",values:{0:ye()}}),s(A,{href:oe,className:"text-brand_color",children:r._("features_settings_center_logout_index_zladk_meh5")})]})]})}),s("div",{className:"w-full",children:s(E,{type:"primary",loading:G,htmlType:"submit",long:!0,className:"commit-btn",children:r._("features_users_create_account_index_xyxpcp1rku")})}),a("div",{className:"text-text_color_02 text-sm mt-6",children:[a("span",{children:[r._("features_users_create_account_index_tyytj1iz0w")," "]}),s(A,{href:"/login",className:"text-brand_color unline",children:r._("features_users_create_account_index_iog8k6vuh1")})]})]})}),s(me,{visible:K,onClose:H,onSelect:W})]})})}export{us as default};
