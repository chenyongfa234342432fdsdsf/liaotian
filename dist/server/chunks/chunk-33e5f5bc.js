import H from"axios";import{a as S,g as z,b,c as q,e as O}from"./chunk-20abda34.js";import{create as $}from"zustand";import{devtools as V,subscribeWithSelector as G}from"zustand/middleware";import{createTrackedSelector as J}from"react-tracked";import i from"immer";import o from"store";import{s as C,r as Y,g as Z,a as W,b as Q}from"./chunk-c4940547.js";import{I as X}from"./chunk-687b5088.js";import"vike/client/router";import"./chunk-357fcbd2.js";import p from"@nbit/arco";import c from"crypto-js";const T="USER_INFO",N="ZIM_TOKEN";function j(){return o.get(N)||""}function ee(e){return o.set(N,e)}var L=(e=>(e[e.greenUpRedDown=1]="greenUpRedDown",e[e.redUpGreenDown=2]="redUpGreenDown",e))(L||{}),M=(e=>(e.cny="Â¥",e.usd="$",e))(M||{}),B=(e=>(e.yes="yes",e.no="no",e))(B||{}),F=(e=>(e[e.grandTotal=1]="grandTotal",e[e.Single=2]="Single",e))(F||{}),te=(e=>(e.login="login",e.register="register",e.agentCenter="agentCenter",e.default="default",e))(te||{});const Ke=e=>{e!=null&&e.token&&(C(e.token),u.getState().setToken({accessToken:e.token,refreshToken:e.refreshToken,accessTokenExpireTime:999999999999999,refreshTokenExpireTime:999999999999999})),e!=null&&e.accessToken&&(C(e.accessToken),u.getState().setToken(e))},se=async()=>{Y(),await u.getState().setToken(null)},ne=12*60*60*1e3;let ae;function P(){return ae}const l=Z(),g="USER_TRANSITION_DATA",D="DEVICE_ID",R="IM_CONFIG",h="MULTIPLE_LOGIN_TIME",y="THIRD_PARTY_TOKEN";L.greenUpRedDown,F.grandTotal,M.usd,X["en-US"],B.no;function re(){return l?Date.now()<=l.refreshTokenExpireTime&&!!l.accessToken:!!l}function oe(e,n){return{token:l,setToken:t=>e(s=>i(s,a=>{a.token=t,W(t)})),isLogin:re(),setLogin:t=>{e(s=>i(s,a=>{a.isLogin=t}))},isBan:!1,setIsBan:t=>e(s=>i(s,a=>{a.isBan=t})),zimToken:j(),setZimToken:t=>e(s=>i(s,a=>{ee(t),a.zimToken=t})),userInfo:o.get(T)||{},setUserInfo:t=>e(s=>i(s,a=>{const r={...a.userInfo,...t};P().updateUserAvatarUrl(r.avatarPath),P().updateUserName(r.nickName),a.userInfo=r,o.set(T,r)})),removeUserInfo:()=>e(t=>i(t,s=>{s.userInfo={},o.set(T,"")})),deviceId:o.get(D)||"",setDeviceId:t=>e(s=>i(s,a=>{a.deviceId=t,o.set(D,t)})),imConfig:o.get(R)||{},setImConfig:t=>e(s=>i(s,a=>{const r={...a.imConfig,...t};a.imConfig=r,o.set(R,r)})),clearUserCacheData:async()=>{const t=n();await se(),await t.removeUserInfo(),t.setLogin(!1)},async updateUserInfoData(){},showUserClassificationPopUp:!1,setUserClassificationPopUpStatus:t=>e(s=>i(s,a=>{a.showUserClassificationPopUp=t})),multipleLoginTime:o.get(h)||0,setMultipleLoginTime(t){e(s=>i(s,a=>{a.multipleLoginTime=t,o.set(h,t)}))},clearMultipleLoginTime(){e(t=>i(t,s=>{s.multipleLoginTime=0,o.set(h,0)}))},thirdPartyToken:o.get(y)||"",setThirdPartyToken(t){e(s=>i(s,a=>{a.thirdPartyToken=t,o.set(y,t)}))},clearThirdPartyToken(){e(t=>i(t,s=>{s.thirdPartyToken="",o.set(y,"")}))},userTransitionDatas:o.get(g)||{},setUserTransitionDatas:t=>e(s=>i(s,a=>{const r={...a.userTransitionDatas,...t};a.userTransitionDatas=r,o.set(g,r)})),removeUserTransitionDatas:()=>e(t=>i(t,s=>{s.userTransitionDatas={},o.set(g,"")}))}}const u=$(V(G(oe),{name:"user-store"})),xe=J(u);u.subscribe(e=>!!e.token,e=>{u.getState().setLogin(e)});var A,w;(w=(A=p)==null?void 0:A.default)!=null&&w.__esModule?p.default:p;const ie=[10030,10000059,10000065,10080003,10096004,10106004,10106001,10106003,10106005,10109014,10000011],E=async(e,n,t)=>{},ce=e=>{let n;const t=e.data,s=t.message,a=e.config;return t.code===200||S.includes("yapi")?(n={isOk:!0,data:t.data,message:s},a.needAllRes&&(n={...n,...t}),n):(ie.includes(t.code)||E(t.code),n={isOk:!1,data:t.data,message:s,code:t.code},Promise.resolve(n))},ue=e=>{var a,r,m,f,k;console.debug("[responseHandler interceptor error ]",e);let n;const t=e==null?void 0:e.response,s=((a=t==null?void 0:t.data)==null?void 0:a.message)||((m=(r=e==null?void 0:e.toJSON)==null?void 0:r.call(e))==null?void 0:m.message);return(f=t==null?void 0:t.data)!=null&&f.code||t!=null&&t.status,(k=e==null?void 0:e.config)==null||k.errorMessage,E(),n={isOk:!1,data:"",message:s,code:-1},Promise.resolve(n)},U={onFulfilled:ce,onRejected:ue},de=e=>([].forEach(t=>{delete e[t]}),e),le={onFulfilled:de},me=["password","oldPassword","loginPassword","newPassword"];let d={RANDOMKEY:"",RANDOMIV:"",encrypt:async e=>{{const n=await import("node-rsa");return new n.default(v).encrypt(e,"base64")}},encryptAES:(e,n,t,s)=>{e=n?e:JSON.stringify(e);let a=c.enc.Utf8.parse(e);return t=c.enc.Utf8.parse(v),s=c.enc.Utf8.parse(fe),c.AES.encrypt(a,t,{iv:s,mode:c.mode.CBC,padding:c.pad.Pkcs7}).toString()},decryptedAES:(e,n,t)=>(n=c.enc.Utf8.parse(d.RANDOMKEY),t=c.enc.Utf8.parse(d.RANDOMIV),c.AES.decrypt(e,n,{iv:t,mode:c.mode.CBC,padding:c.pad.Pkcs7}).toString(c.enc.Utf8).toString()),hmacSHA256:(e,n)=>{let t=c.HmacSHA256(n,e);return c.enc.Base64.stringify(t)},sortASCII:e=>_(e),len16Str:e=>{e=e||16;let n="ABCDEFJHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=n.length,s="";for(let a=0;a<e;a++)s+=n.charAt(Math.floor(Math.random()*t));return s}};const v="snra6h1yki7fvgzo",fe="46kd4xzguyt1xs3c";let _=e=>{if(typeof e=="object"){for(let n in e)(typeof e[n]>"u"||e[n]===null)&&delete e[n],typeof e[n]=="object"&&_(e[n]);return pe(e)}},pe=e=>{let n=new Array,t=0;for(let r in e)n[t]=r,t++;let s=n.sort(),a={};for(let r in s)a[s[r]]=e[s[r]];return a};d.RANDOMKEY=d.len16Str();d.RANDOMIV=d.len16Str();const Te=e=>{const{contentType:n,method:t}=e;if(!["POST","PUT"].includes(String(t).toUpperCase()))return e;switch(n){case 1:{e.headers={...e.headers,"Content-Type":"application/x-www-form-urlencoded"};break}case 2:{e.headers={...e.headers,"Content-Type":"multipart/form-data"};break}default:{if(e.signature){const s=Object.keys(e.data);me.map(a=>s.includes(a)&&(e.data[a]=d.encryptAES(e.data[a])))}break}}return e},ge={onFulfilled:Te},he=e=>{const{path:n,method:t,headers:s}=e;return e.url=n,e.responseType="json",e.method=t||"GET",e.headers={"Content-Type":"application/json; charset=utf-8",...s},e},ye={onFulfilled:he};let I="",K="";z().then(e=>{I=e,K=q(I)});const Se=e=>{const n=u.getState();let t={};e.token&&(t={Authorization:e.token});const s=Q.getState(),a=s.locale,r=s.accessKey,m=s.businessId,f={"nb-access-key":r||K};return{...t,"Nb-Bid":m||b,"Accept-Language":a,"nb-device-no":n.deviceId,"nb-device-name":navigator.platform,"nb-device-model":"","nb-platform":I,...f}},Ie=e=>{const{method:n,headers:t={}}=e,s=Se(t);switch(e.headers={...t,...s},n){case"put":case"PUT":case"post":case"POST":break;default:e.params={...e.params};break}return e},ke={onFulfilled:Ie},Ce=[ye,ge,ke,le],Pe=Ce.reverse(),x=H.create({baseURL:O?S:S,withCredentials:!1,timeout:30*1e3});Pe.forEach(e=>{x.interceptors.request.use(e.onFulfilled,e.onRejected)});const He=e=>x.request(e).then(n=>U.onFulfilled(n)).catch(n=>U.onRejected(n));export{He as R,te as U,Ke as a,u as b,P as g,d as s,xe as u};
