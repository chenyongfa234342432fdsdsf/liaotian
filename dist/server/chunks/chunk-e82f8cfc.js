import{i18n as D}from"@lingui/core";import a from"@nbit/arco";import f from"classnames";import{I as d}from"./chunk-c41c86a9.js";import{useState as p,useEffect as M,useMemo as T}from"react";import{useDebounce as b,useRequest as E,useUpdateEffect as O}from"ahooks";import{createPortal as j}from"react-dom";import{H as k}from"./chunk-03c313ff.js";import{a as q,n as A,i as v,s as H,o as R}from"./chunk-afa2f5f1.js";import{c as B}from"./chunk-7cc161e2.js";import{l as _}from"./chunk-75081d50.js";import{a as w,j as o}from"./chunk-ea028b12.js";import{g as K}from"./chunk-33e5f5bc.js";import{C as P}from"./chunk-b4b66d69.js";import"./chunk-77d12848.js";import"./chunk-c4940547.js";import"zustand";import"zustand/middleware";import"react-tracked";import"js-cookie";import"store";import"./chunk-20abda34.js";import"@nbit/utils";import"immer";import"./chunk-86c9a026.js";import"./chunk-30329d74.js";import"@protobuf-ts/runtime";import"dayjs";import"./chunk-6bf38136.js";import"./chunk-357fcbd2.js";import"./chunk-7a6de6d7.js";import"lodash";import"axios";import"vike/client/router";import"./chunk-687b5088.js";import"make-plural/plurals";import"./chunk-a6cae7c5.js";import"./chunk-53514b52.js";import"./chunk-61a1b424.js";import"./chunk-9a1033a2.js";import"lottie-react";import"./chunk-13ae7681.js";import"react-dom/client";import"./chunk-8d494217.js";import"./chunk-2fc83edf.js";import"dayjs/plugin/utc.js";import"dayjs/plugin/timezone.js";import"dayjs/plugin/customParseFormat.js";import"crypto-js";import"./chunk-bb1e6206.js";import"./chunk-2cc5d128.js";const U={"announcement-carousel":"announcement-carousel-index-module__announcement-carousel---h2"};var I,g;const{Carousel:$,Typography:F}=(g=(I=a)==null?void 0:I.default)!=null&&g.__esModule?a.default:a;function z(){const[e,r]=p([]);return M(()=>{B({}).then(t=>{t.isOk&&t.data&&r(t.data.lampList||[])})},[]),w("div",{className:U["announcement-carousel"],children:[o("div",{className:"icon-chat-speaker ",children:o(d,{className:"text-[8px]",name:"icon_chat_speaker"})}),o("div",{className:"w-[100%] ",children:o($,{direction:"vertical",autoPlay:!0,showArrow:"never",indicatorType:"never",children:e==null?void 0:e.map((t,n)=>o(F.Paragraph,{ellipsis:!0,children:o("div",{className:"text-brand_color cursor-pointer",onClick:()=>_(`/announcement-center#${t.id}/${t.parentId}`),children:t.name})},n))})}),o(d,{className:"text-sm ml-2",name:"icon_chat_announcement",onClick:()=>_("/announcement-center")})]})}const C={"search-wrapper":"search-index-module__search-wrapper--quM","list-wrapper":"search-index-module__list-wrapper--O3K"};var x,N;const{Input:V}=(N=(x=a)==null?void 0:x.default)!=null&&N.__esModule?a.default:a;function W(e){const{conversations:r}=q(),[t,n]=p([]),h=K(),c=A(e),{run:i,loading:S}=E(async()=>{if(!e){n([]);return}const m=await h.searchLocalConversations({totalConversationCount:200,keywords:[e],conversationMessageCount:10,messageTypes:[],subMessageTypes:[],senderUserIDs:[],startTime:0,endTime:0});n(m.conversationSearchInfoList)},{manual:!0});return O(()=>{i()},[e]),{conversationList:T(()=>{if(!e)return[];const m=t.map(s=>({...r.find(u=>u.conversationID===s.conversationID)})),L=c.filter(s=>!m.find(l=>v(l.conversationID,s.conversationID))).map(s=>({...r.find(u=>v(u.conversationID,s.conversationID))||{},...s})),y=[...m,...L];return H(y).map(s=>R(s))},[r,t,e]),loadMore:i,loading:S}}function G({children:e}){const r=document.querySelector(`#${k}`);return r?j(e,r):null}function We(){const[e,r]=p(""),t=b(e,{wait:300}),{conversationList:n}=W(t),[h,c]=p(!1);return w("div",{className:f(C["search-wrapper"]),children:[o(V,{onFocus:()=>c(!0),onBlur:()=>c(!1),onChange:r,allowClear:!0,className:"with-search",placeholder:D._("features_group_components_search_input_index_tq98cmscdb"),prefix:o(d,{name:"icon_chat_search",className:"text-icon_color text-xl/5"})}),o("div",{className:f({hidden:n.length>0}),children:o(z,{})}),n.length>0&&o(G,{children:o("div",{className:C["list-wrapper"],children:n.map(i=>o(P,{keyword:e,conversation:i},i.conversationID))})})]})}export{We as default};
