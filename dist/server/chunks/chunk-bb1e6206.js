import{i18n as r}from"@lingui/core";import f from"classnames";import{j as t,a as _,F as b}from"./chunk-ea028b12.js";import{R as x,b as B,I as C,M as v,c as g,d as N}from"./chunk-61a1b424.js";import{f as re,i as p,e as ce,u as ae,h as oe}from"./chunk-afa2f5f1.js";import{R as D,u as M,b as j}from"./chunk-33e5f5bc.js";import{o as h}from"./chunk-86c9a026.js";import{useRef as L,useEffect as O,createContext as ie,useContext as _e,useState as W}from"react";import{I as G}from"./chunk-c41c86a9.js";import k from"@nbit/arco";import{W as de,a as le,w as z,b as me,c as ue}from"./chunk-30329d74.js";import{useRequest as ge}from"ahooks";import{C as V}from"./chunk-a6cae7c5.js";import{f as w}from"./chunk-2fc83edf.js";import{u as fe}from"./chunk-2cc5d128.js";function he(e){if(!e.keyword)return t("span",{className:e.className,children:e.text});const s=e.text.toUpperCase().split((e.keyword||"").toUpperCase()).reduce((c,a,o)=>o?c.concat(e.keyword,a):[a],[]),n=s.map((c,a)=>{let o=0;for(let d=0;d<a;d+=1)o+=s[d].length;const i=e.text.slice(o,o+c.length);return c===e.keyword?t("span",{className:e.highlightClassName,children:i},`${e.keyword}${a}`):i});return t("span",{className:e.className,children:n})}const ke={"message-wrapper":"message-index-module__message-wrapper--wJY"},pe=e=>D({path:"/v1/im/redPackage/receive",method:"POST",data:e}),T=e=>D({path:"/v1/im/redPackage/getPackageInfo",method:"GET",params:e}),ve="red-envelope-modal-module__modal--Rd7",xe={modal:ve};var $,P;const{Modal:Ne}=(P=($=k)==null?void 0:$.default)!=null&&P.__esModule?k.default:k;function H(e){return t(Ne,{className:xe.modal,simple:!0,visible:e.visible,footer:null,children:_("div",{className:"content",children:[e.children,t("div",{role:"button",tabIndex:0,onClick:e.onClose,className:"close-btn",children:t(G,{fontSize:32,className:"icon text-icon_color",name:"icon_set_logout"})})]})})}const be="red-envelope-sealed-envelope-module__sealed--uYn",J={sealed:be};function R(e){const s=ge(()=>T({packageId:String(e)}),{cacheKey:`getV1ImRedPackageGetPackageInfoApiRequest-${e}`}),n=L({req:s,id:e});return n.current={req:s,id:e},O(()=>{const c={biz:de.im,type:le.redPackageStatus},a=o=>{const{req:i,id:d}=n.current;o.packageId===String(d)&&i.refresh()};return z.subscribe({subs:c,callback:a,throttleType:me.increment,throttleTime:ue.Market}),()=>{z.unsubscribe({subs:c,callback:a})}},[]),s}function K(e){var d,l,m,u;const{onReceived:s,...n}=e,c=R(e.packageId),a=((l=(d=c.data)==null?void 0:d.data)==null?void 0:l.remark)||r._("features_messenger_chat_message_custom_red_pocket_message_hflxvdk0jj"),o=async()=>{var y;(await pe({packageId:e.packageId})).isOk&&((y=e.onReceived)==null||y.call(e))},i=(u=(m=c.data)==null?void 0:m.data)==null?void 0:u.nickName;return t(H,{...n,children:_("div",{role:"button",tabIndex:0,onClick:o,style:{backgroundImage:`url(${h}redpacket.svg)`},className:J.sealed,children:[i&&_("div",{className:"sender",children:[i,r._("features_messenger_chat_red_envelope_detail_ztxmrjfhp7")]}),t("div",{className:"bless",children:a})]})})}function Ie(e){var a,o;const n=(o=(a=R(e.packageId).data)==null?void 0:a.data)==null?void 0:o.nickName,{...c}=e;return t(H,{visible:!0,...c,onClose:e.onClose,children:_("div",{style:{backgroundImage:`url(${h}redpacket.svg)`},className:J.sealed,children:[_("div",{className:"sender",children:[n,r._("features_messenger_chat_red_envelope_detail_ztxmrjfhp7")]}),_("div",{className:"bless",children:[r._("features_messenger_chat_red_envelope_expired_envelope_4tqt0cmyid")," 24"," ",r._("features_messenger_chat_red_envelope_expired_envelope_8txbckapdy"),t("br",{}),r._("features_messenger_chat_message_custom_red_pocket_message_uqobfipajg")]})]})})}const ye="red-envelope-opened-envelop-modal-module__opened--Feu",Se={opened:ye};var E,A;const{Modal:Ce}=(A=(E=k)==null?void 0:E.default)!=null&&A.__esModule?k.default:k;function Me(e){return t(Ce,{simple:!0,visible:!0,className:Se.opened,footer:null,children:_("div",{className:"content",style:{backgroundImage:`url(${h}opened-red-packet.svg)`},children:[t(G,{className:"icon",name:"icon_chat_close",fontSize:20,onClick:e.onClose}),e.children]})})}const je="red-envelope-receiver-module__sender--jN3",Re="red-envelope-receiver-module__receiver--sYh",we={"sent-peer-info-modal":"red-envelope-receiver-module__sent-peer-info-modal--T0s",sender:je,receiver:Re};function qe(e){return _("div",{className:we.receiver,children:[t("div",{className:"avatar-icon",children:t(V,{size:40,src:e.url})}),_("div",{className:f("msg",e.underline&&"border-bottom-underline","receiver-grid"),children:[t("div",{className:"name",children:e.name}),_("div",{className:"score",children:[e.score.toFixed(2)," ",r._("features_messenger_chat_red_envelope_receiver_pm1ruksqfc")]}),t("div",{className:"time",children:re(+e.time)})]})]})}const Te="red-envelope-detail-module__sender--Hk5",ze="red-envelope-detail-module__tips--6wW",Z={sender:Te,tips:ze},$e="red-envelope-score-module__score--ZRp",Pe={score:$e};function Ee(e){return _("div",{className:f(Pe.score,e.className),children:[_("div",{className:"score",children:[e.score.toFixed(2),t("span",{className:"points",children:r._("features_messenger_chat_red_envelope_receiver_pm1ruksqfc")})]}),_("div",{className:"link",children:[r._("features_messenger_chat_red_envelope_score_akn17fouoc")," >"]})]})}var U,F;const{Spin:Ae}=(F=(U=k)==null?void 0:U.default)!=null&&F.__esModule?k.default:k,Y=ie(null),Ue=Y.Provider;function Q(e){var c;const n=(c=R(e.packageId).data)==null?void 0:c.data;return t(Me,{onClose:e.onClose,children:n?t(Ue,{value:n,children:e.children}):t("div",{className:"flex justify-center",children:t(Ae,{})})})}function S(){return _e(Y)}function X(e){var n,c,a;const s=S();return t(Ee,{className:e.className,score:(a=(c=(n=s.receiveList)==null?void 0:n.find(o=>String(o.uid)===e.uid))==null?void 0:c.receiveAmount)!=null?a:0})}function q(){var n,c;const e=S(),s=(n=e.receiveList)==null?void 0:n.length;return s?t("div",{className:"pl-6 pr-6 pt-4 pb-1",children:(c=e.receiveList)==null?void 0:c.map(a=>{var o,i;return t(qe,{underline:s>1,name:(o=a.nickName)!=null?o:"",url:a.avatarPath,time:`${a.createdByTime}`,score:(i=a.receiveAmount)!=null?i:0},a.uid)})}):null}function ee(){const e=S(),s=e.remark||r._("features_messenger_chat_message_custom_red_pocket_message_hflxvdk0jj");return t("div",{className:Z.sender,children:_("div",{className:"grid-box",children:[t(V,{size:30,src:e.avatarPath}),_("div",{className:"sender",children:[e.nickName,r._("features_messenger_chat_red_envelope_detail_ztxmrjfhp7")]}),t("div",{className:"bless",children:s})]})})}function Fe(e){return t(b,{children:e.children(S())})}function se(){var n;const e=S();let s="";if((e==null?void 0:e.refTypeCd)==="single")switch(e.statusInd){case x.expired:s=r._("features_messenger_chat_red_envelope_detail_ceuh4nhbx6");break;default:s=r._({id:"features_messenger_chat_red_envelope_detail_8rtzqv9bjn",values:{0:e.packageAmount}});break}else switch(e.statusInd){case x.normal:s=r._({id:"features_messenger_chat_red_envelope_detail_3r_veb9eps",values:{0:e.yetCount,1:e.packageCount,2:e.residueAmount,3:e.packageAmount}});break;case x.received:s=r._({id:"features_messenger_chat_red_envelope_detail_na3lthatfp",values:{0:e.packageCount,1:Number(((n=e.complateTime)!=null?n:0)/6e3).toFixed(0)}});break;case x.expired:s=r._({id:"features_messenger_chat_red_envelope_detail_qgn_ltza3n",values:{0:e.yetCount,1:e.packageCount,2:e.residueAmount,3:e.packageAmount}});break}return t("div",{className:Z.tips,children:s})}const Be=t("div",{style:{borderBottomWidth:1},className:"border-text_color_04 border-solid mb-3 mt-3"}),te=t("div",{style:{borderBottomWidth:1},className:"border-text_color_04 border-solid"}),De={"red-packet-message":"custom-red-pocket-message-module__red-packet-message--iNp"};function ne(e){var m,u,I,y;const{data:s}=R(e.id),n=((m=s==null?void 0:s.data)==null?void 0:m.remark)||r._("features_messenger_chat_message_custom_red_pocket_message_hflxvdk0jj"),c=((u=s==null?void 0:s.data)==null?void 0:u.statusInd)===x.expired,a=((y=(I=s==null?void 0:s.data)==null?void 0:I.residueAmount)!=null?y:0)>0,o=a?`${h}red-packet-icon.svg`:`${h}opened-red-packet-icon.svg`,i=c||!a,d=e.isSelf?`${h}got-red-packet-message.svg`:`${h}message-red-packet.svg`,l=e.isSelf?`${h}send-red-packet-message-front-img.svg`:`${h}got-red-packet-message-front-img.svg`;return _("div",{className:f("relative"),role:"button",tabIndex:0,onClick:e.onClick,children:[_("div",{style:{backgroundImage:`url(${d})`},className:f("relative",De["red-packet-message"],e.isSelf?"mr-[-6px]":"ml-[-6px]",{opened:!a||c}),children:[_("div",{className:"content",children:[t("img",{alt:"red packet",src:o,className:f("icon shrink-0")}),_("div",{className:"text-box text-ellipsis overflow-hidden whitespace-nowrap",children:[t("div",{className:"title",children:n}),t("div",{className:f("status",{"with-shadow":i}),children:a?"":r._("features_messenger_chat_message_custom_red_pocket_message_c5sdqtfpqv")})]})]}),t("div",{className:f("payment",{"with-shadow":i}),children:c?r._("features_messenger_chat_message_custom_red_pocket_message_uqobfipajg"):r._("features_messenger_chat_message_custom_red_pocket_message_panqdkltlw")})]}),(!a||c)&&t("div",{className:f(e.isSelf?"mr-[-6px]":"ml-[-6px]"),style:{backgroundImage:`url(${l})`,position:"absolute",top:0,bottom:0,left:0,right:0}})]})}function Le({data:e,message:s,inConversation:n}){const c=s.direction===B.Send;return e&&!n?c?t(We,{uid:s.senderUserID,data:e}):t(Oe,{data:e}):t("div",{children:r._("features_messenger_chat_message_custom_red_pocket_axvzvhydct")})}function Oe(e){const{data:s}=e,[n,c]=W("none"),a=M(),o=String(a.userInfo.uid);return _(b,{children:[n==="expired"&&t(Ie,{packageId:s.id,onClose:()=>c("none")}),n==="sealed"&&t(K,{packageId:s.id,visible:!0,onClose:()=>c("none"),onReceived:()=>c("detail")}),n==="detail"&&_(Q,{packageId:s.id,onClose:()=>c("none"),children:[t(ee,{}),t(X,{uid:o}),s.refTypeCd!==C.single?_(b,{children:[t("div",{className:"h-2 bg-card_bg_color_01 mt-5"}),t(se,{}),te,t(q,{})]}):_(b,{children:[Be,t(q,{})]})]}),t(ne,{id:s.id,isSelf:!1,onClick:async()=>{var d,l;const i=await T({packageId:`${s.id}`});if(i.data){if(i.data.statusInd===x.expired){s.refTypeCd===C.single?c("expired"):c("detail");return}!((l=(d=i.data)==null?void 0:d.receiveList)==null?void 0:l.some(u=>String(u.uid)===o))&&i.data.statusInd===x.normal?c("sealed"):c("detail")}}})]})}function We(e){const{data:s}=e,[n,c]=W("none");return _(b,{children:[n==="detail"&&_(Q,{packageId:e.data.id,onClose:()=>c("none"),children:[t(ee,{}),e.data.refTypeCd!==C.single&&_(b,{children:[t(X,{uid:e.uid}),t("div",{className:"h-2 bg-card_bg_color_01 mt-5"})]}),t(se,{}),t(Fe,{children:a=>{var o;return(o=a.receiveList)!=null&&o.length?te:null}}),t(q,{})]}),n==="sealed"&&t(K,{visible:!0,packageId:e.data.id,onClose:()=>c("none"),onReceived:()=>c("detail")}),t(ne,{isSelf:!0,id:s.id,onClick:async()=>{const a=await T({packageId:`${e.data.id}`});if(a.data){const{selfIfReceive:o,statusInd:i}=a.data;e.data.refTypeCd===C.single?c("detail"):!o&&i===x.normal?c("sealed"):c("detail")}}})]})}function Ge({data:e}){const s=j.getState().userInfo.uid,c=p(e==null?void 0:e.sendUid,s)?r._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):e==null?void 0:e.sendNickName,o=p(e==null?void 0:e.uid,s)?r._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):e==null?void 0:e.nickName,i=r._({id:"features_messenger_chat_message_custom_red_pocket_x4d_jpbmxe",values:{0:o,1:c}});return _("div",{className:"flex items-center text-text_color_02",children:[t("img",{className:"w-4 mr-1",src:`${h}image_little_red_envelope.png`,alt:""}),t("span",{className:"message-text",dangerouslySetInnerHTML:{__html:i}})]})}function Ve({data:e,inConversation:s,message:n}){const c="add_friend",a=L(null),o=()=>{s||ce(n==null?void 0:n.senderUserID)};return O(()=>{const i=a.current.querySelector(`#${c}`);return i==null||i.addEventListener("click",o),()=>{i==null||i.removeEventListener("click",o)}}),r._({id:"features_messenger_chat_message_custom_send_failed_cahcplicfg",values:{0:c}}),_("span",{ref:a,children:[r._("features_messenger_chat_message_custom_send_failed_3fmj8r_hi9"),t("span",{onClick:o,id:"{0}",className:f(s?"":"text-brand_color cursor-pointer mx-px"),children:r._("features_messenger_addition_index_pngdv3umj8")}),r._("features_messenger_chat_message_custom_send_failed_pyme0grqlz")]})}const He={[v.notFriend]:Ve};function Je(e){return{[v.notFriend]:r._("features_messenger_chat_message_custom_send_failed_edc4b49rhk"),[v.youBlocked]:r._("features_messenger_chat_message_custom_send_failed_plse0q9s_f"),[v.youAreBlocked]:r._("features_messenger_chat_message_custom_send_failed_ap_lh8wrm_"),[v.otherBlocked]:r._("features_messenger_chat_message_custom_send_failed_szqwkabtkd"),[v.yourAccountBlocked]:r._("features_messenger_chat_message_custom_send_failed_ci415ki0bh"),[v.otherAccountCancelled]:r._("features_messenger_chat_message_custom_send_failed_7muom7relx"),[v.sensitiveContent]:r._("features_messenger_chat_message_custom_send_failed_djr2rsm7pd")}[e]}function Ke({data:e,...s}){const n=r._("features_messenger_chat_message_custom_send_failed_mkobftp6qr"),c=He[e.type];return t("span",{className:"text-text_color_02 message-text",children:c?t(c,{data:e,...s}):_(b,{children:[n,r._("features_messenger_chat_message_custom_send_failed_afhp0bx_xs"),Je(e.type)]})})}function Ze({data:e}){var d,l,m;const{userInfo:s}=M(),n=(e==null?void 0:e.users)||[],a=p((d=n[0])==null?void 0:d.inviterUid,s.uid)?r._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):(l=n[0])==null?void 0:l.inviterNickName,o=n.map(u=>p(s.uid,u.uid)?r._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):u.nickName).join(r._("features_messenger_chat_message_custom_group_join_cwrwuajmcz")),i=(m=n[0])!=null&&m.isInitiative?r._({id:"features_messenger_chat_message_custom_group_join_jdhf1f4kzt",values:{0:o}}):r._({id:"features_messenger_chat_message_custom_group_join_mrcqvfb4y8",values:{0:a,1:o}});return t("span",{className:"text-text_color_02 message-text",children:i})}function Ye({data:e}){var l,m,u;const{userInfo:s}=M(),n=(e==null?void 0:e.users)||[],c=((l=n[0])==null?void 0:l.kickedUid)===s.uid,o=((m=n[0])==null?void 0:m.kickUid)===s.uid?r._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):(u=n[0])==null?void 0:u.kickUsername,i=n.map(I=>I.kickedUsername).join(r._("features_messenger_chat_message_custom_group_join_cwrwuajmcz")),d=c?r._("features_messenger_chat_message_custom_group_kick_out_gakdukoucr"):r._({id:"features_messenger_chat_message_custom_group_kick_out_0mx_re4uen",values:{0:o,1:i}});return t("span",{className:"text-text_color_02 message-text",children:d})}function Qe(e){const s=Math.floor(e/1e3),n=Math.floor(s/60),c=Math.floor(n/60),a=new Date;a.setHours(0,0,0,e);const o=w(a.getTime(),"hh"),i=w(a.getTime(),"mm"),d=w(a.getTime(),"ss"),l={0:o,1:i,2:d};return c>0?r._({id:"features_messenger_chat_message_custom_call_end_0qjzqjxq6y",values:l}):n>0?r._({id:"features_messenger_chat_message_custom_call_end_w4wzlfwzcg",values:l}):r._({id:"features_messenger_chat_message_custom_call_end_ytq9kkjcfd",values:l})}function Xe({data:e}){const n=`${r._("features_messenger_chat_message_custom_call_end_onibxwenii")}${Qe((e==null?void 0:e.time)||0)}`;return t("span",{className:"text-text_color_02 message-text",children:n})}function es({data:e}){const{userInfo:s}=M(),c=p(e==null?void 0:e.uid,s.uid)?r._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):e==null?void 0:e.nickName,a=r._({id:"features_messenger_chat_message_custom_group_exit_cahcplicfg",values:{0:c}});return t("span",{className:"text-text_color_02 message-text",children:a})}function ss({data:e,message:s}){const n=p(e==null?void 0:e.applyUid,j.getState().userInfo.uid),{addressBookList:c}=ae(),a=c.find(d=>p(d.uid,s.conversationID)),o=n?e==null?void 0:e.targetNickName:e==null?void 0:e.applyNickName,i=r._({id:"features_messenger_chat_message_custom_index_36vp8jlbxc",values:{0:o||(a==null?void 0:a.friendRemark)||(a==null?void 0:a.nickName)||s.conversationID}});return t("div",{className:"message-text text-text_color_02",children:i})}function ts({message:e}){const s=r._("features_messenger_chat_message_custom_index_3yikiam465");return t("div",{className:"message-text text-text_color_02",children:s})}function ns({message:e}){const s=r._("features_messenger_chat_message_custom_index_zyccegch3h");return t("div",{className:"message-text text-text_color_02",children:s})}function rs({data:e}){const n=p(e==null?void 0:e.callCancelUserId,j.getState().userInfo.uid)?r._("features_messenger_chat_message_custom_index_nlytzmkgps"):r._("features_messenger_chat_message_custom_index_8b7fsr9ilc");return t("div",{className:"message-text text-text_color_02",children:n})}function cs({data:e}){const n=p(e==null?void 0:e.callRejectUserId,j.getState().userInfo.uid)?r._("features_messenger_chat_message_custom_index__smd9t2fmg"):r._("features_messenger_chat_message_custom_index_walrv5icoj");return t("div",{className:"message-text text-text_color_02",children:n})}const as={[g.mediaZoomClosed]:Xe,[g.friendAdded]:ss,[g.checkInReminder]:ts,[g.redPocket]:Le,[g.redPocketReceive]:Ge,[g.messageSendFail]:Ke,[g.groupBlocked]:ns,[g.groupJoin]:Ze,[g.groupKickOut]:Ye,[g.groupExit]:es,[g.callCancel]:rs,[g.callReject]:cs};function os({message:e,inConversation:s}){const n=as[e.subType],c=JSON.parse(e.message||"{}");return n?t(n,{inConversation:s,data:c,message:e}):t("div",{className:"message-text",children:r._("features_messenger_chat_message_custom_index_vhq21v00jo")})}function is({message:e,inConversation:s}){const n=e.direction===B.Send,c=oe(e),a=JSON.parse(e.revokeExtendedData||"{}"),o=n?r._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):`"${a.operatorName||c.fromNickname}"`,i=r._({id:"features_messenger_chat_message_revoke_kz3olsbqcf",values:{0:o}}),d=!s&&n&&e.originalMessageType===N.Text&&e.originalTextMessageContent,{setMessageByReEdit:l}=fe();return _("div",{className:"text-text_color_02",children:[t("span",{children:i}),d&&t("span",{onClick:()=>{l(e.originalTextMessageContent)},className:"ml-1 text-text_color_special_04 cursor-pointer",children:r._("features_messenger_chat_message_revoke_bdfs2yos58")})]})}function _s({message:e,keyword:s}){return t(he,{text:(e==null?void 0:e.message)||"",keyword:s,highlightClassName:"text-brand_color"})}function ds({message:e}){const s={[N.Image]:r._("features_messenger_conversations_message_index_kqkestu3_e"),[N.File]:r._("features_messenger_conversations_message_index_1dhlm1h_qs"),[N.Video]:r._("features_messenger_conversations_message_index_tdztmxc8jl"),[N.Audio]:r._("features_messenger_conversations_message_index_uuzi_vc9cr")};return e?t("span",{children:s[e==null?void 0:e.type]||r._("features_messenger_conversations_message_index_lhk9n5q4qp")}):null}const ls={[N.Text]:_s,[N.Revoke]:is,[N.Custom]:os};function Ms({message:e,keyword:s}){const n=ls[e==null?void 0:e.type];return t("div",{className:f(ke["message-wrapper"]),children:n?t(n,{inConversation:!0,message:e,keyword:s}):t(ds,{message:e})})}export{Ms as C,he as H};
