import{i18n as a}from"@lingui/core";import{p as ie,e as J,a as ce}from"./chunk-8d494217.js";import{useState as u,useEffect as A}from"react";import k from"@nbit/arco";import{I as w}from"./chunk-c41c86a9.js";import{a as le,u as W,d as _e}from"./chunk-afa2f5f1.js";import{M as H,C as K}from"./chunk-67316d61.js";import{N as ue}from"./chunk-4bfa64b6.js";import{L as fe}from"./chunk-bbab396b.js";import F from"classnames";import"react-dom";import{useSafeState as pe,useUpdateEffect as Q}from"ahooks";import"./chunk-20abda34.js";import{u as me}from"./chunk-2cc5d128.js";import{a as p,j as s,F as he}from"./chunk-ea028b12.js";import{createRoot as ge}from"react-dom/client";import{create as xe}from"zustand";import{createTrackedSelector as ve}from"react-tracked";import Ne from"immer";import{devtools as be}from"zustand/middleware";import{g as T}from"./chunk-53514b52.js";import{A as we}from"./chunk-a28ca130.js";import{C as P}from"./chunk-e17c2dfa.js";import{b as ye,A as ke,a as Ce}from"./chunk-0e7315a4.js";import{p as Ae}from"./chunk-60db822c.js";import"./chunk-33e5f5bc.js";import"axios";import"store";import"./chunk-c4940547.js";import"./chunk-77d12848.js";import"js-cookie";import"./chunk-687b5088.js";import"make-plural/plurals";import"vike/client/router";import"./chunk-357fcbd2.js";import"@nbit/utils";import"./chunk-7a6de6d7.js";import"lodash";import"crypto-js";import"./chunk-86c9a026.js";import"./chunk-61a1b424.js";import"dayjs";import"./chunk-9a1033a2.js";import"lottie-react";import"./chunk-13ae7681.js";import"./chunk-2fc83edf.js";import"dayjs/plugin/utc.js";import"dayjs/plugin/timezone.js";import"dayjs/plugin/customParseFormat.js";import"./chunk-38b7cb18.js";import"react-lazy-load-image-component";import"react-highlight-words";import"./chunk-a6cae7c5.js";import"@aws-sdk/client-s3";const Se={"drawer-content-wrapper":"messenger-messenger-right-drawer-module__drawer-content-wrapper--JlU","messenger-right-nav-bar":"messenger-messenger-right-drawer-module__messenger-right-nav-bar--ij-"};function Te(o){const[m,i]=u(!1),[h,b]=pe(0),{currentConversation:r}=le(),{drawersCount:c,increaseDrawersCount:_,decreaseDrawersCount:l}=me();return A(()=>{o.visible?(_(),i(!0),setTimeout(()=>{b(c+1)},100)):m&&(l(),setTimeout(()=>{b(0)},100))},[o.visible]),Q(()=>{var x;(x=o.onClose)==null||x.call(o)},[r==null?void 0:r.conversationID]),null}function je({title:o,onClose:m,isCloseIcon:i}){return p("div",{className:F(Se["messenger-right-nav-bar"],"bg-box_bg_color",{"bg-brand_color_animate":!i},{"border-line_color_02 border-b-2":i}),children:[s("span",{onClick:()=>m(),children:i?s(w,{className:"close-icon",name:"icon_chat_close"}):s(w,{className:"back-icon",name:"a-Notselected"})}),o&&s("span",{className:F("ml-6 text-button_text_01 text-base",{"text-text_color_01":i}),children:o})]})}function De(o=!0){const[m,i]=u(!1),[h,b]=u(null),r=d=>{i(!0),b(d)},c=()=>{i(!1)},[_,l]=u(null),x=s(Te,{destroyOnClose:o,onClose:c,visible:m,children:h});return A(()=>{const d=document.createElement("div");l(d),document.body.appendChild(d);const f=ge(d);return f.render(x),l(f),()=>{setTimeout(()=>{f.unmount()},100),document.body.removeChild(d)}},[]),Q(()=>{_.render(x)},[m,h]),[r,c]}function Ie(o,m){return{newFriendItem:{},setNewFriendItem:i=>{o(Ne(h=>{h.newFriendItem=i}))}}}const Me=xe(be(Ie,{name:"new-friend-store"})),X=ve(Me),qe={"new-friend":"new-friend-index-module__new-friend--Ev9"},Re={"chat-complain-model":"user-complain-modal-index-module__chat-complain-model--AGu"};var V,B;const{Button:U,Input:Ee,Message:L,Modal:Fe,Upload:Pe}=(B=(V=k)==null?void 0:V.default)!=null&&B.__esModule?k.default:k,Ue=Ee.TextArea;function Le({visible:o,setvisible:m,userInfo:i}){const[h,b]=u(),[r,c]=u("");let _;i.initiativeAdd?_=i.targetUid:_=i.uid;const l=async()=>{var g;const f=(h==null?void 0:h.map(D=>ye(D,Ce.im,ke.complain_application)))||[],v=await Promise.all(f),y=await Ae({complaintType:1,complaintReason:r,complaintImage:v.join(","),complaintUid:_});y.isOk&&((g=y.data)!=null&&g.success)?(d(!1),L.success(a._("features_messenger_chat_information_modals_chat_complain_modal_index_vypvbrvdtg"))):(d(!1),L.error(a._("features_messenger_chat_information_modals_chat_complain_modal_index_9xd4v0bewm")))},[x,d]=u(o);return A(()=>{d(o)},[o]),A(()=>{m(x)},[x]),s(Fe,{autoFocus:!1,closable:!1,className:Re["chat-complain-model"],visible:o,onCancel:()=>d(!1),title:a._("features_messenger_chat_chat_header_more_qwqejeixxl"),footer:()=>p(he,{children:[s(U,{className:"ml-auto",type:"outline",onClick:()=>d(!1),children:a._("features_group_components_comfirm_btn_pop_index_2sr1guu0iy")}),s(U,{onClick:()=>l(),type:"primary",children:a._("features_messenger_chat_information_modals_chat_complain_modal_index_njx6ip3sh8")})]}),children:p("div",{children:[s("span",{className:"text-base text-text_color_01",children:a._("features_messenger_chat_information_modals_chat_complain_modal_index_t4sy5xghsn")}),s(Ue,{onChange:c,showWordLimit:!0,maxLength:200}),s("div",{className:"text-base text-text_color_01 mt-6",children:a._("features_messenger_chat_information_modals_chat_complain_modal_index_2fq23veoy8")}),s("div",{className:"text-text_color_02 text-xs mb-3",children:a._("features_messenger_chat_information_modals_chat_complain_modal_index_kqg5woa3og")}),s(Pe,{multiple:!0,limit:5,action:"/",listType:"picture-card",onChange:(f,v)=>{const y=f==null?void 0:f.map(g=>g==null?void 0:g.originFile);y&&b(y)}})]})})}const Ve="stranger-index-module__stranger--TnC",Be={stranger:Ve};var O,z;const{Message:j}=(z=(O=k)==null?void 0:O.default)!=null&&z.__esModule?k.default:k;function Oe(o){const{setApplyList:m}=W(),[i,h]=u(!1),{onClose:b}=o,{newFriendItem:r}=X(),[c,_]=u(!1),l=async()=>{if(r!=null&&r.initiativeAdd||(r==null?void 0:r.applyStatus)!==1){const d=await ie({uid:r==null?void 0:r.targetUid}),{isOk:f,data:v}=d||{};f&&(v!=null&&v.success)?(_(!1),j.success(a._("features_messenger_addition_index_t0o7celfir"))):(_(!1),j.error(a._("features_messenger_addition_index_79dzbswbuk")))}else{const d=await J({recordId:r==null?void 0:r.recordId}),{isOk:f,data:v}=d||{};f&&(v!=null&&v.success)?(_(!1),j.success(a._("features_messenger_new_friend_stranger_index_4ahi2ggjls")),m()):(_(!1),j.error(a._("features_messenger_new_friend_stranger_index_yu9yxtmlq_")))}},x=d=>{h(d)};return p("div",{className:Be.stranger,children:[s(je,{onClose:b,title:a._("features_messenger_new_friend_stranger_index_5nq5jufpaa")}),s("div",{className:"flex justify-center items-center py-8 header",children:p("div",{children:[s("div",{className:"w-48 h-48",style:{borderRadius:"50%"},children:s("img",{src:"https://oss.chainstar.cloud/im-web/image/defaultheadurl.png",alt:"",width:200,height:200})}),s("div",{className:"text-center name",children:r==null?void 0:r.nickName})]})}),p("div",{className:"add-friend",onClick:()=>{_(!0)},children:[s(w,{name:"icon_address_book_invite_friend",className:"ml-6 mr-4",fontSize:20}),a._("features_messenger_chat_information_chat_settings_schema_tgrf_5rcdi")]}),p("div",{className:"complain add-friend",onClick:()=>{h(!0)},children:[s(w,{name:"icon_chat_complaint",className:"ml-6 mr-4",fontSize:20}),a._("features_messenger_chat_chat_header_more_vegbnukvgl")]}),s(Le,{visible:i,setvisible:x,userInfo:r}),c&&s(H,{children:s(K,{title:r.nickName,content:a._("features_messenger_addition_index_1fx0wn_hbe"),confirmEvent:()=>{l()},cancelEvent:()=>{_(!1)}})})]})}var $,G;const{Input:ze}=(G=($=k)==null?void 0:$.default)!=null&&G.__esModule?k.default:k;function $s(){const[o,m]=De(),{setNewFriendItem:i}=X(),{addressBookList:h,setAddressBookList:b,applyList:r}=W(),[c,_]=u([]),[l,x]=u(""),[d,f]=u(""),[v,y]=u(!1),[g,D]=u({recordId:"",nickName:""}),[C,I]=u([]),[Y,M]=u(!1),S=3,Z=c==null?void 0:c.filter(n=>T(n.applyTime)<=S?n:null),ee=c==null?void 0:c.filter(n=>T(n.applyTime)>S?n:null),se=C==null?void 0:C.filter(n=>T(n.applyTime)<=S?n:null),ae=C==null?void 0:C.filter(n=>T(n.applyTime)>S?n:null),ne=async n=>{const t=await J({recordId:n});t!=null&&t.data&&(y(!1),f(g.nickName))},q=async()=>{M(!0);const n=await ce({});M(!1);const{isOk:t,data:e}=n||{};t&&e&&_(e)};A(()=>{q(),b()},[r]);const re=c==null?void 0:c.filter(n=>{var t;return(t=n.nickName)!=null&&t.toLowerCase().includes(l.toLowerCase())?n:null});A(()=>{I(l===""?[]:re)},[l]);const R=n=>{const t=h.filter(e=>e.nickName===n.nickName?e:null);t.length===0&&(i(n),o(s(Oe,{onClose:m}))),t.length>0&&(m(),_e({friend:t[0]}))};function E(n,t){return p("div",{className:"scroll-show",children:[!!(n!=null&&n.length)&&p("div",{className:"new-friends-list near",children:[s("div",{className:"new-friends-lis-title",children:a._("features_messenger_new_friend_index_rv5hzy39dd")}),s("div",{children:n==null?void 0:n.map(e=>{let N;return(e==null?void 0:e.applyStatus)===1&&(N=d===(e==null?void 0:e.nickName)?N=s("div",{className:"add-text",children:a._("features_messenger_addition_index_j3tuca3fsx")}):e!=null&&e.initiativeAdd?p("div",{className:"add-text",children:[s(w,{name:"icon_address_book_added",className:"added"}),a._("features_messenger_new_friend_index_0mcf2pkakz")]}):s("div",{className:"add-btn",onClick:de=>{de.stopPropagation(),D({recordId:e==null?void 0:e.recordId.toString(),nickName:e==null?void 0:e.nickName}),q(),y(!0)},children:a._("features_messenger_addition_index_hi1mctpr4u")})),(e==null?void 0:e.initiativeAdd)===!0&&(e==null?void 0:e.applyStatus)===2&&(N=p("div",{className:"add-text",children:[s(w,{name:"icon_address_book_added",className:"added"}),a._("features_messenger_addition_index_j3tuca3fsx")]})),(e==null?void 0:e.initiativeAdd)===!1&&(e==null?void 0:e.applyStatus)===2&&(N=s("div",{className:"add-text",children:a._("features_messenger_addition_index_j3tuca3fsx")})),s("div",{onClick:()=>{R(e)},children:s(P,{crewName:e==null?void 0:e.nickName,right:N,img:e==null?void 0:e.avatarPath,searchValue:l})},e==null?void 0:e.recordId)})})]}),!!(t!=null&&t.length)&&p("div",{className:"new-friends-list",children:[s("div",{className:"new-friends-lis-title",children:a._("features_messenger_new_friend_index_p6tq9ytho9")}),s("div",{children:t==null?void 0:t.map(e=>{let N;return(e==null?void 0:e.initiativeAdd)===!0&&(e==null?void 0:e.applyStatus)===2&&(N=p("div",{className:"add-text",children:[s(w,{name:"icon_address_book_added",className:"added"}),a._("features_messenger_addition_index_j3tuca3fsx")]})),(e==null?void 0:e.initiativeAdd)===!0&&((e==null?void 0:e.applyStatus)===3||(e==null?void 0:e.applyStatus)===1)&&(N=p("div",{className:"add-text",children:[s(w,{name:"icon_address_book_added",className:"added"}),a._("features_messenger_chat_message_custom_red_pocket_message_uqobfipajg")]})),(e==null?void 0:e.initiativeAdd)===!1&&(e==null?void 0:e.applyStatus)===2&&(N=s("div",{className:"add-text",children:a._("features_messenger_addition_index_j3tuca3fsx")})),(e==null?void 0:e.initiativeAdd)===!1&&((e==null?void 0:e.applyStatus)===3||(e==null?void 0:e.applyStatus)===1)&&(N=s("div",{className:"add-text",children:a._("features_messenger_chat_message_custom_red_pocket_message_uqobfipajg")})),s("div",{onClick:()=>{R(e)},children:s(P,{crewName:e==null?void 0:e.nickName,right:N,img:e==null?void 0:e.avatarPath,searchValue:l})},e==null?void 0:e.recordId)})})]})]})}const te=E(se,ae),oe=E(Z,ee);return p("div",{className:qe["new-friend"],children:[s(we,{titleText:a._("features_messenger_address_book_index_enlckk2obg")}),s("div",{className:"search-input",children:s(ze,{type:"text",className:"search-input-comm",prefix:s(w,{name:"icon_chat_search"}),suffix:l.length&&s(w,{name:"icon_chat_delete",onClick:()=>{x("")}}),placeholder:a._("features_group_components_search_input_index_tq98cmscdb"),value:l,onChange:n=>{x(n)}})}),l.length>0&&C.length===0?s("div",{children:s(ue,{name:"no_search_result",footerText:a._("features_group_components_search_friend_index_eppdggih18")})}):te,Y?s("div",{className:"flex justify-center mt-52",children:s(fe,{})}):!l.length&&oe,v&&s(H,{children:s(K,{title:g==null?void 0:g.nickName,content:a._("features_messenger_addition_index_1fx0wn_hbe"),confirmEvent:()=>{ne(g==null?void 0:g.recordId)},cancelEvent:()=>{y(!1)}})})]})}export{$s as default};
