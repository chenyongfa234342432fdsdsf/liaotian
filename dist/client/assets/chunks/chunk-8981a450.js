import{g as getDefaultExportFromCjs,c as commonjsGlobal}from"./chunk-e9cd8943.js";function _mergeNamespaces(Q,O){for(var b=0;b<O.length;b++){const T=O[b];if(typeof T!="string"&&!Array.isArray(T)){for(const I in T)if(I!=="default"&&!(I in Q)){const p=Object.getOwnPropertyDescriptor(T,I);p&&Object.defineProperty(Q,I,p.get?p:{enumerable:!0,get:()=>T[I]})}}}return Object.freeze(Object.defineProperty(Q,Symbol.toStringTag,{value:"Module"}))}var zegoZimWeb={exports:{}};(function(module,exports){(function(Q,O){module.exports=O()})(typeof self<"u"?self:commonjsGlobal,function(){return function(Q){var O={};function b(T){if(O[T])return O[T].exports;var I=O[T]={i:T,l:!1,exports:{}};return Q[T].call(I.exports,I,I.exports,b),I.l=!0,I.exports}return b.m=Q,b.c=O,b.d=function(T,I,p){b.o(T,I)||Object.defineProperty(T,I,{enumerable:!0,get:p})},b.r=function(T){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(T,"__esModule",{value:!0})},b.t=function(T,I){if(1&I&&(T=b(T)),8&I||4&I&&typeof T=="object"&&T&&T.__esModule)return T;var p=Object.create(null);if(b.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:T}),2&I&&typeof T!="string")for(var k in T)b.d(p,k,(function(S){return T[S]}).bind(null,k));return p},b.n=function(T){var I=T&&T.__esModule?function(){return T.default}:function(){return T};return b.d(I,"a",I),I},b.o=function(T,I){return Object.prototype.hasOwnProperty.call(T,I)},b.p="",b(b.s=22)}([function(Q,O,b){var T=b(8),I=(b.d(O,"f",function(){return T.a}),b.d(O,"g",function(){return T.b}),b.d(O,"h",function(){return T.c}),b.d(O,"j",function(){return T.d}),b.d(O,"k",function(){return T.e}),b.d(O,"n",function(){return T.f}),b.d(O,"o",function(){return T.g}),b.d(O,"q",function(){return T.h}),b.d(O,"s",function(){return T.i}),b.d(O,"w",function(){return T.j}),b.d(O,"y",function(){return T.k}),b.d(O,"A",function(){return T.l}),b.d(O,"C",function(){return T.m}),b.d(O,"F",function(){return T.n}),b.d(O,"G",function(){return T.o}),b.d(O,"H",function(){return T.p}),b.d(O,"K",function(){return T.q}),b.d(O,"L",function(){return T.r}),b.d(O,"M",function(){return T.s}),b.d(O,"N",function(){return T.t}),b.d(O,"P",function(){return T.u}),b.d(O,"R",function(){return T.v}),b.d(O,"S",function(){return T.w}),b.d(O,"T",function(){return T.x}),b.d(O,"U",function(){return T.y}),b.d(O,"V",function(){return T.z}),b(35)),p=(b.d(O,"a",function(){return I.a}),b.d(O,"b",function(){return I.b}),b.d(O,"e",function(){return I.c}),b.d(O,"m",function(){return I.d}),b.d(O,"p",function(){return I.e}),b.d(O,"u",function(){return I.f}),b.d(O,"x",function(){return I.g}),b.d(O,"z",function(){return I.h}),b.d(O,"B",function(){return I.i}),b.d(O,"D",function(){return I.j}),b.d(O,"E",function(){return I.k}),b.d(O,"O",function(){return I.l}),b.d(O,"Q",function(){return I.m}),b(36)),k=(b.d(O,"c",function(){return p.a}),b.d(O,"d",function(){return p.b}),b.d(O,"i",function(){return p.c}),b.d(O,"W",function(){return p.d}),b(37)),S=(b.d(O,"l",function(){return k.a}),b.d(O,"t",function(){return k.b}),b.d(O,"v",function(){return k.c}),b(38)),f=(b.d(O,"r",function(){return S.a}),b(39));b.d(O,"I",function(){return f.a}),b.d(O,"J",function(){return f.b})},function(Q,O,b){var T=b(26),I=(b.d(O,"m",function(){return T.a}),b.d(O,"o",function(){return T.b}),b.d(O,"p",function(){return T.c}),b(15)),p=(b.d(O,"s",function(){return I.a}),b(27));b.d(O,"a",function(){return p.a}),b.d(O,"b",function(){return p.b}),b.d(O,"c",function(){return p.c}),b.d(O,"d",function(){return p.d}),b.d(O,"e",function(){return p.e}),b.d(O,"f",function(){return p.f}),b.d(O,"g",function(){return p.g}),b.d(O,"h",function(){return p.h}),b.d(O,"i",function(){return p.i}),b.d(O,"j",function(){return p.j}),b.d(O,"k",function(){return p.k}),b.d(O,"l",function(){return p.l}),b.d(O,"n",function(){return p.m}),b.d(O,"q",function(){return p.n}),b.d(O,"r",function(){return p.o})},function(Q,O,b){b.d(O,"a",function(){return c});var T=b(52),I=b(60),p=b(62),k=b(79),S=b(83),f=b(84),d=b(0),o=d.J.Manager,c=(r.getInstance=function(){return this.instance||(this.instance=new r)},r.prototype.getVersion=function(){return"2.12.0"},r.prototype.createEngine=function(t){var n={appID:t,msg:"first create",tag:"2023/11/15 11:37:11",version:"2.12.0"},s=this.handle;return this.enginMap.get(s)?(n.msg="had created",this.logger.info(o,d.I.Create,n),null):(t=new p.a(s,t),this.enginMap.set(s,t),this.logger.info(o,d.I.Create,n),t)},r.prototype.destroyEngine=function(t){this.logger.info(o,d.I.Destroy),t&&(this.enginMap.delete(t.engineConfig.handle),t.destroy())},r.prototype.setLogConfig=function(t){this.logger.info(o,d.I.SetLogConfig,t),this.logger.setLogConfig(Object.assign({logLevel:"info"},t))},r.prototype.setAdvancedConfig=function(t,n){this.settings.advancedConfig[t]=n},r.prototype.setGeofencingConfig=function(t,n){var s,u;return(n==d.w.Include||n==d.w.Exclude)&&t&&0<t.length&&t.every(function(a){return 2<=a&&a<=7})?(t=t.map(function(a){return 0|a}),this.settings.advancedConfig.geoFence.type=n,this.settings.advancedConfig.geoFence.areas=t,u=n==d.w.Include?t[u=1<t.length?(Math.random()*t.length|0)%t.length:0]:((s=new Set(Object.keys(d.v).map(function(a){return+a}))).delete(1),t.forEach(function(a){s.delete(a),d.v[a].relatives.forEach(function(i){return s.delete(i)})}),u=1<(t=Array.from(s)).length?(Math.random()*t.length|0)%t.length:0,t[u]||1),this.settings.advancedConfig.geoFence.id=u,this.settings.advancedConfig.geoFence.host=d.v[u].host,this.logger.info(o,d.I.SetGeoFence,this.settings.advancedConfig.geoFence),this.settings.advancedConfig.geoFence.id!=1):(this.logger.info(o,d.I.SetGeoFence,{type:n,areas:t}),!1)},r);function r(){if(this.handle=Symbol(),this.enginMap=new Map,r.instance)return r.instance;this.logger=new k.a(this.getVersion()),this.settings=new S.a(this.getVersion()),this.dataReport=new f.a(this.settings),this.crypto=new T.a,this.protobuf=new I.a(this.crypto,this.settings.advancedConfig.geoFence),r.instance=this}},function(Q,O){Q.exports=T;var b=null;try{b=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function T(M,R,D){this.low=0|M,this.high=0|R,this.unsigned=!!D}function I(M){return(M&&M.__isLong__)===!0}Object.defineProperty(T.prototype,"__isLong__",{value:!0}),T.isLong=I;var p={},k={};function S(M,R){var D,q,L;return R?(L=0<=(M>>>=0)&&M<256)&&(q=k[M])?q:(D=d(M,(0|M)<0?-1:0,!0),L&&(k[M]=D),D):(L=-128<=(M|=0)&&M<128)&&(q=p[M])?q:(D=d(M,M<0?-1:0,!1),L&&(p[M]=D),D)}function f(M,R){if(isNaN(M))return R?i:a;if(R){if(M<0)return i;if(n<=M)return y}else{if(M<=-s)return w;if(s<=M+1)return g}return M<0?f(-M,R).neg():d(M%t|0,M/t|0,R)}function d(M,R,D){return new T(M,R,D)}T.fromInt=S,T.fromNumber=f,T.fromBits=d;var o=Math.pow;function c(M,R,D){if(M.length===0)throw Error("empty string");if(M==="NaN"||M==="Infinity"||M==="+Infinity"||M==="-Infinity")return a;if(R=typeof R=="number"?(D=R,!1):!!R,(D=D||10)<2||36<D)throw RangeError("radix");var q;if(0<(q=M.indexOf("-")))throw Error("interior hyphen");if(q===0)return c(M.substring(1),R,D).neg();for(var L=f(o(D,8)),j=a,G=0;G<M.length;G+=8){var J=Math.min(8,M.length-G),K=parseInt(M.substring(G,G+J),D);j=J<8?(J=f(o(D,J)),j.mul(J).add(f(K))):(j=j.mul(L)).add(f(K))}return j.unsigned=R,j}function r(M,R){return typeof M=="number"?f(M,R):typeof M=="string"?c(M,R):d(M.low,M.high,typeof R=="boolean"?R:M.unsigned)}T.fromString=c,T.fromValue=r;var t=4294967296,n=t*t,s=n/2,u=S(1<<24),a=S(0),i=(T.ZERO=a,S(0,!0)),l=(T.UZERO=i,S(1)),h=(T.ONE=l,S(1,!0)),m=(T.UONE=h,S(-1)),g=(T.NEG_ONE=m,d(-1,2147483647,!1)),y=(T.MAX_VALUE=g,d(-1,-1,!0)),w=(T.MAX_UNSIGNED_VALUE=y,d(0,-2147483648,!1));(Q=(T.MIN_VALUE=w,T.prototype)).toInt=function(){return this.unsigned?this.low>>>0:this.low},Q.toNumber=function(){return this.unsigned?(this.high>>>0)*t+(this.low>>>0):this.high*t+(this.low>>>0)},Q.toString=function(M){if((M=M||10)<2||36<M)throw RangeError("radix");if(this.isZero())return"0";var R,D;if(this.isNegative())return this.eq(w)?(D=f(M),D=(R=this.div(D)).mul(D).sub(this),R.toString(M)+D.toInt().toString(M)):"-"+this.neg().toString(M);for(var q=f(o(M,6),this.unsigned),L=this,j="";;){var G=L.div(q),J=(L.sub(G.mul(q)).toInt()>>>0).toString(M);if((L=G).isZero())return J+j;for(;J.length<6;)J="0"+J;j=""+J+j}},Q.getHighBits=function(){return this.high},Q.getHighBitsUnsigned=function(){return this.high>>>0},Q.getLowBits=function(){return this.low},Q.getLowBitsUnsigned=function(){return this.low>>>0},Q.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var M=this.high!=0?this.high:this.low,R=31;0<R&&!(M&1<<R);R--);return this.high!=0?R+33:R+1},Q.isZero=function(){return this.high===0&&this.low===0},Q.eqz=Q.isZero,Q.isNegative=function(){return!this.unsigned&&this.high<0},Q.isPositive=function(){return this.unsigned||0<=this.high},Q.isOdd=function(){return(1&this.low)==1},Q.isEven=function(){return(1&this.low)==0},Q.equals=function(M){return I(M)||(M=r(M)),(this.unsigned===M.unsigned||this.high>>>31!=1||M.high>>>31!=1)&&this.high===M.high&&this.low===M.low},Q.eq=Q.equals,Q.notEquals=function(M){return!this.eq(M)},Q.neq=Q.notEquals,Q.ne=Q.notEquals,Q.lessThan=function(M){return this.comp(M)<0},Q.lt=Q.lessThan,Q.lessThanOrEqual=function(M){return this.comp(M)<=0},Q.lte=Q.lessThanOrEqual,Q.le=Q.lessThanOrEqual,Q.greaterThan=function(M){return 0<this.comp(M)},Q.gt=Q.greaterThan,Q.greaterThanOrEqual=function(M){return 0<=this.comp(M)},Q.gte=Q.greaterThanOrEqual,Q.ge=Q.greaterThanOrEqual,Q.compare=function(M){if(I(M)||(M=r(M)),this.eq(M))return 0;var R=this.isNegative(),D=M.isNegative();return R&&!D?-1:!R&&D?1:this.unsigned?M.high>>>0>this.high>>>0||M.high===this.high&&M.low>>>0>this.low>>>0?-1:1:this.sub(M).isNegative()?-1:1},Q.comp=Q.compare,Q.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(l)},Q.neg=Q.negate,Q.add=function(M){I(M)||(M=r(M));var R=this.high>>>16,D=65535&this.high,q=this.low>>>16,L=65535&this.low,j=M.high>>>16,G=65535&M.high,J=M.low>>>16,K=0,ee=0,A=0,v=0;return ee+=(A=A+((v+=L+(65535&M.low))>>>16)+(q+J))>>>16,d((A&=65535)<<16|(v&=65535),((K+=(ee+=D+G)>>>16)+(R+j)&65535)<<16|(ee&=65535),this.unsigned)},Q.subtract=function(M){return I(M)||(M=r(M)),this.add(M.neg())},Q.sub=Q.subtract,Q.multiply=function(M){if(this.isZero())return a;if(I(M)||(M=r(M)),b)return d(b.mul(this.low,this.high,M.low,M.high),b.get_high(),this.unsigned);if(M.isZero())return a;if(this.eq(w))return M.isOdd()?w:a;if(M.eq(w))return this.isOdd()?w:a;if(this.isNegative())return M.isNegative()?this.neg().mul(M.neg()):this.neg().mul(M).neg();if(M.isNegative())return this.mul(M.neg()).neg();if(this.lt(u)&&M.lt(u))return f(this.toNumber()*M.toNumber(),this.unsigned);var R=this.high>>>16,D=65535&this.high,q=this.low>>>16,L=65535&this.low,j=M.high>>>16,G=65535&M.high,J=M.low>>>16,K=0,ee=0,A=0,v=(v=0)+((ee=ee+((A+=L*(M=65535&M.low))>>>16)+q*M)>>>16)+((ee=(65535&ee)+L*J)>>>16);return d((ee&=65535)<<16|(A&=65535),((K+=(v+=D*M)>>>16)+((v=(65535&v)+q*J)>>>16)+((v=(65535&v)+L*G)>>>16)+(R*M+D*J+q*G+L*j)&65535)<<16|(v&=65535),this.unsigned)},Q.mul=Q.multiply,Q.divide=function(M){if((M=I(M)?M:r(M)).isZero())throw Error("division by zero");var R,D,q;if(b)return this.unsigned||this.high!==-2147483648||M.low!==-1||M.high!==-1?d((this.unsigned?b.div_u:b.div_s)(this.low,this.high,M.low,M.high),b.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?i:a;if(this.unsigned){if((M=M.unsigned?M:M.toUnsigned()).gt(this))return i;if(M.gt(this.shru(1)))return h;D=i}else{if(this.eq(w))return M.eq(l)||M.eq(m)?w:M.eq(w)?l:(q=this.shr(1).div(M).shl(1)).eq(a)?M.isNegative()?l:m:(R=this.sub(M.mul(q)),q.add(R.div(M)));if(M.eq(w))return this.unsigned?i:a;if(this.isNegative())return M.isNegative()?this.neg().div(M.neg()):this.neg().div(M).neg();if(M.isNegative())return this.div(M.neg()).neg();D=a}for(R=this;R.gte(M);){q=Math.max(1,Math.floor(R.toNumber()/M.toNumber()));for(var L=Math.ceil(Math.log(q)/Math.LN2),j=L<=48?1:o(2,L-48),G=f(q),J=G.mul(M);J.isNegative()||J.gt(R);)J=(G=f(q-=j,this.unsigned)).mul(M);G.isZero()&&(G=l),D=D.add(G),R=R.sub(J)}return D},Q.div=Q.divide,Q.modulo=function(M){return I(M)||(M=r(M)),b?d((this.unsigned?b.rem_u:b.rem_s)(this.low,this.high,M.low,M.high),b.get_high(),this.unsigned):this.sub(this.div(M).mul(M))},Q.mod=Q.modulo,Q.rem=Q.modulo,Q.not=function(){return d(~this.low,~this.high,this.unsigned)},Q.and=function(M){return I(M)||(M=r(M)),d(this.low&M.low,this.high&M.high,this.unsigned)},Q.or=function(M){return I(M)||(M=r(M)),d(this.low|M.low,this.high|M.high,this.unsigned)},Q.xor=function(M){return I(M)||(M=r(M)),d(this.low^M.low,this.high^M.high,this.unsigned)},Q.shiftLeft=function(M){return I(M)&&(M=M.toInt()),(M&=63)==0?this:M<32?d(this.low<<M,this.high<<M|this.low>>>32-M,this.unsigned):d(0,this.low<<M-32,this.unsigned)},Q.shl=Q.shiftLeft,Q.shiftRight=function(M){return I(M)&&(M=M.toInt()),(M&=63)==0?this:M<32?d(this.low>>>M|this.high<<32-M,this.high>>M,this.unsigned):d(this.high>>M-32,0<=this.high?0:-1,this.unsigned)},Q.shr=Q.shiftRight,Q.shiftRightUnsigned=function(M){var R;return I(M)&&(M=M.toInt()),(M&=63)==0?this:(R=this.high,M<32?d(this.low>>>M|R<<32-M,R>>>M,this.unsigned):d(M===32?R:R>>>M-32,0,this.unsigned))},Q.shru=Q.shiftRightUnsigned,Q.shr_u=Q.shiftRightUnsigned,Q.toSigned=function(){return this.unsigned?d(this.low,this.high,!1):this},Q.toUnsigned=function(){return this.unsigned?this:d(this.low,this.high,!0)},Q.toBytes=function(M){return M?this.toBytesLE():this.toBytesBE()},Q.toBytesLE=function(){var M=this.high,R=this.low;return[255&R,R>>>8&255,R>>>16&255,R>>>24,255&M,M>>>8&255,M>>>16&255,M>>>24]},Q.toBytesBE=function(){var M=this.high,R=this.low;return[M>>>24,M>>>16&255,M>>>8&255,255&M,R>>>24,R>>>16&255,R>>>8&255,255&R]},T.fromBytes=function(M,R,D){return D?T.fromBytesLE(M,R):T.fromBytesBE(M,R)},T.fromBytesLE=function(M,R){return new T(M[0]|M[1]<<8|M[2]<<16|M[3]<<24,M[4]|M[5]<<8|M[6]<<16|M[7]<<24,R)},T.fromBytesBE=function(M,R){return new T(M[4]<<24|M[5]<<16|M[6]<<8|M[7],M[0]<<24|M[1]<<16|M[2]<<8|M[3],R)}},function(Q,O,b){b.d(O,"b",function(){return I}),b.d(O,"a",function(){return p}),b.d(O,"g",function(){return k}),b.d(O,"d",function(){return S}),b.d(O,"f",function(){return d}),b.d(O,"e",function(){return o}),b.d(O,"c",function(){return t});var T,I={importantLevel:0,reportSize:2e3,reportNum:20,bps:16e3,netTimeout:3},p={totalAvailCache:102400,cacheMaxSize:2e4,cacheDelPer:.2},k=(T=1,function(){return T++}),S=(f.prototype.isEmpty=function(){return this.items.length==0},f.prototype.enqueue=function(s){this.items.push(s)},f.prototype.dequeue=function(){return this.items.shift()},f.prototype.front=function(){return this.isEmpty()?"No elements in Queue":this.items[0]},f.prototype.size=function(){return this.items.length},f.prototype.clear=function(){this.items=[]},f);function f(){this.items=[],this.items=[]}var d={TIMEOUT:{code:100001,msg:"network timeout"},DATAEXIST:{code:100002,msg:"data exist"}},o=-1,c=(Object.defineProperty(r.prototype,"id",{get:function(){return this._id||null},set:function(s){this._id=s},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"data",{get:function(){return this._data},set:function(s){this._data=s},enumerable:!1,configurable:!0}),r.prototype.hasNext=function(){return this.next&&this.next.id},r.prototype.hasPrev=function(){return this.prev&&this.prev.id},r);function r(s,u){s===void 0&&(s=null),u===void 0&&(u=null),this.next=null,this.prev=null,this._id=s,this._data=u}n.prototype.insertBefore=function(s,u){return(u=new c(this._idCounter,u)).next=s,u.prev=s.prev,s.prev&&(s.prev.next=u),s.prev=u,++this._idCounter,++this._numNodes,u},n.prototype.addLast=function(s){return this.insertBefore(this.end,s)},n.prototype.add=function(s){return this.addLast(s)},n.prototype.getFirst=function(){return this._numNodes===0?null:this.start.next},n.prototype.getLast=function(){return this._numNodes===0?null:this.end.prev},n.prototype.size=function(){return this._numNodes},n.prototype.getFromFirst=function(s){var u=0,a=this.start.next;if(0<=s)for(;u<s&&a!==null;)a=a.next,++u;else a=null;if(a===null)throw"Index out of bounds.";return a},n.prototype.get=function(s){return s===0?this.getFirst():s===this._numNodes-1?this.getLast():this.getFromFirst(s)},n.prototype.remove=function(s){return s.prev&&(s.prev.next=s.next),s.next&&(s.next.prev=s.prev),--this._numNodes,s},n.prototype.removeFirst=function(){var s=null;return 0<this._numNodes&&this.start.next?this.remove(this.start.next):s},n.prototype.removeLast=function(){var s=null;return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):s},n.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},n.prototype.each=function(s){for(var u=this.start;u.hasNext();)s(u=u.next)},n.prototype.find=function(s){for(var u=this.start,a=!1,i=null;u.hasNext()&&!a;)s(u=u.next)&&(i=u,a=!0);return i},n.prototype.map=function(s){for(var u=this.start,a=[];u.hasNext();)s(u=u.next)&&a.push(u);return a},n.prototype.push=function(s){return this.addLast(s)},n.prototype.unshift=function(s){0<this._numNodes?this.insertBefore(this.start.next,s):this.insertBefore(this.end,s)},n.prototype.pop=function(){return this.removeLast()},n.prototype.shift=function(){return this.removeFirst()};var t=n;function n(){this.start=new c,this.end=new c,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}},function(Q,O,b){(function(T){Q.exports=function(I){var p;if(typeof window<"u"&&window.crypto&&(p=window.crypto),typeof self<"u"&&self.crypto&&(p=self.crypto),!(p=!(p=!(p=typeof globalThis<"u"&&globalThis.crypto?globalThis.crypto:p)&&typeof window<"u"&&window.msCrypto?window.msCrypto:p)&&T!==void 0&&T.crypto?T.crypto:p))try{p=b(92)}catch{}var k=Object.create||function(i){return S.prototype=i,i=new S,S.prototype=null,i};function S(){}var f={},d=f.lib={},o=d.Base={extend:function(i){var l=k(this);return i&&l.mixIn(i),l.hasOwnProperty("init")&&this.init!==l.init||(l.init=function(){l.$super.init.apply(this,arguments)}),(l.init.prototype=l).$super=this,l},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var l in i)i.hasOwnProperty(l)&&(this[l]=i[l]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}},c=d.WordArray=o.extend({init:function(i,l){i=this.words=i||[],this.sigBytes=l!=null?l:4*i.length},toString:function(i){return(i||t).stringify(this)},concat:function(i){var l=this.words,h=i.words,m=this.sigBytes,g=i.sigBytes;if(this.clamp(),m%4)for(var y=0;y<g;y++){var w=h[y>>>2]>>>24-y%4*8&255;l[m+y>>>2]|=w<<24-(m+y)%4*8}else for(var M=0;M<g;M+=4)l[m+M>>>2]=h[M>>>2];return this.sigBytes+=g,this},clamp:function(){var i=this.words,l=this.sigBytes;i[l>>>2]&=4294967295<<32-l%4*8,i.length=I.ceil(l/4)},clone:function(){var i=o.clone.call(this);return i.words=this.words.slice(0),i},random:function(i){for(var l=[],h=0;h<i;h+=4)l.push(function(){if(p){if(typeof p.getRandomValues=="function")try{return p.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof p.randomBytes=="function")try{return p.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new c.init(l,i)}}),r=f.enc={},t=r.Hex={stringify:function(i){for(var l=i.words,h=i.sigBytes,m=[],g=0;g<h;g++){var y=l[g>>>2]>>>24-g%4*8&255;m.push((y>>>4).toString(16)),m.push((15&y).toString(16))}return m.join("")},parse:function(i){for(var l=i.length,h=[],m=0;m<l;m+=2)h[m>>>3]|=parseInt(i.substr(m,2),16)<<24-m%8*4;return new c.init(h,l/2)}},n=r.Latin1={stringify:function(i){for(var l=i.words,h=i.sigBytes,m=[],g=0;g<h;g++){var y=l[g>>>2]>>>24-g%4*8&255;m.push(String.fromCharCode(y))}return m.join("")},parse:function(i){for(var l=i.length,h=[],m=0;m<l;m++)h[m>>>2]|=(255&i.charCodeAt(m))<<24-m%4*8;return new c.init(h,l)}},s=r.Utf8={stringify:function(i){try{return decodeURIComponent(escape(n.stringify(i)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(i){return n.parse(unescape(encodeURIComponent(i)))}},u=d.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(i){typeof i=="string"&&(i=s.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(i){var l,h=this._data,m=h.words,g=h.sigBytes,y=this.blockSize,w=g/(4*y),M=(w=i?I.ceil(w):I.max((0|w)-this._minBufferSize,0))*y;if(i=I.min(4*M,g),M){for(var R=0;R<M;R+=y)this._doProcessBlock(m,R);l=m.splice(0,M),h.sigBytes-=i}return new c.init(l,i)},clone:function(){var i=o.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0}),a=(d.Hasher=u.extend({cfg:o.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){return i&&this._append(i),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(l,h){return new i.init(h).finalize(l)}},_createHmacHelper:function(i){return function(l,h){return new a.HMAC.init(i,h).finalize(l)}}}),f.algo={});return f}(Math)}).call(this,b(12))},function(Q,O,b){b.d(O,"a",function(){return A}),b=typeof atob=="function",O=typeof btoa=="function";var T=typeof Buffer=="function";const I=typeof TextDecoder=="function"?new TextDecoder:void 0,p=typeof TextEncoder=="function"?new TextEncoder:void 0,k=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),S=(v=>{let E={};return v.forEach((N,P)=>E[N]=P),E})(k),f=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,d=String.fromCharCode.bind(String),o=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):(v,E=N=>N)=>new Uint8Array(Array.prototype.slice.call(v,0).map(E)),c=v=>v.replace(/=/g,"").replace(/[+\/]/g,E=>E=="+"?"-":"_"),r=v=>v.replace(/[^A-Za-z0-9\+\/]/g,"");var t=v=>{let E,N,P,H,V="";var W=v.length%3;for(let B=0;B<v.length;){if(255<(N=v.charCodeAt(B++))||255<(P=v.charCodeAt(B++))||255<(H=v.charCodeAt(B++)))throw new TypeError("invalid character found");E=N<<16|P<<8|H,V+=k[E>>18&63]+k[E>>12&63]+k[E>>6&63]+k[63&E]}return W?V.slice(0,W-3)+"===".substring(W):V};const n=O?v=>btoa(v):T?v=>Buffer.from(v,"binary").toString("base64"):t,s=T?v=>Buffer.from(v).toString("base64"):v=>{let E=[];for(let N=0,P=v.length;N<P;N+=4096)E.push(d.apply(null,v.subarray(N,N+4096)));return n(E.join(""))},u=(v,E=!1)=>E?c(s(v)):s(v),a=v=>{var E;return v.length<2?(E=v.charCodeAt(0))<128?v:E<2048?d(192|E>>>6)+d(128|63&E):d(224|E>>>12&15)+d(128|E>>>6&63)+d(128|63&E):(E=65536+1024*(v.charCodeAt(0)-55296)+(v.charCodeAt(1)-56320),d(240|E>>>18&7)+d(128|E>>>12&63)+d(128|E>>>6&63)+d(128|63&E))},i=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=v=>v.replace(i,a),h=T?v=>Buffer.from(v,"utf8").toString("base64"):p?v=>s(p.encode(v)):v=>n(l(v)),m=(v,E=!1)=>E?c(h(v)):h(v);O=v=>m(v,!0);const g=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,y=v=>{switch(v.length){case 4:var E=((7&v.charCodeAt(0))<<18|(63&v.charCodeAt(1))<<12|(63&v.charCodeAt(2))<<6|63&v.charCodeAt(3))-65536;return d(55296+(E>>>10))+d(56320+(1023&E));case 3:return d((15&v.charCodeAt(0))<<12|(63&v.charCodeAt(1))<<6|63&v.charCodeAt(2));default:return d((31&v.charCodeAt(0))<<6|63&v.charCodeAt(1))}},w=v=>v.replace(g,y);var M=v=>{if(v=v.replace(/\s+/g,""),!f.test(v))throw new TypeError("malformed base64.");v+="==".slice(2-(3&v.length));let E,N,P,H="";for(let V=0;V<v.length;)E=S[v.charAt(V++)]<<18|S[v.charAt(V++)]<<12|(N=S[v.charAt(V++)])<<6|(P=S[v.charAt(V++)]),H+=N===64?d(E>>16&255):P===64?d(E>>16&255,E>>8&255):d(E>>16&255,E>>8&255,255&E);return H};const R=b?v=>atob(r(v)):T?v=>Buffer.from(v,"base64").toString("binary"):M,D=T?v=>o(Buffer.from(v,"base64")):v=>o(R(v),E=>E.charCodeAt(0)),q=v=>D(j(v)),L=T?v=>Buffer.from(v,"base64").toString("utf8"):I?v=>I.decode(D(v)):v=>w(R(v)),j=v=>r(v.replace(/[-_]/g,E=>E=="-"?"+":"/")),G=v=>L(j(v));function J(){var v=(E,N)=>Object.defineProperty(String.prototype,E,ee(N));v("fromBase64",function(){return G(this)}),v("toBase64",function(E){return m(this,E)}),v("toBase64URI",function(){return m(this,!0)}),v("toBase64URL",function(){return m(this,!0)}),v("toUint8Array",function(){return q(this)})}function K(){var v=(E,N)=>Object.defineProperty(Uint8Array.prototype,E,ee(N));v("toBase64",function(E){return u(this,E)}),v("toBase64URI",function(){return u(this,!0)}),v("toBase64URL",function(){return u(this,!0)})}const ee=v=>({value:v,enumerable:!1,writable:!0,configurable:!0}),A={version:"3.7.2",VERSION:"3.7.2",atob:R,atobPolyfill:M,btoa:n,btoaPolyfill:t,fromBase64:G,toBase64:m,encode:m,encodeURI:O,encodeURL:O,utob:l,btou:w,decode:G,isValid:v=>typeof v=="string"&&(v=v.replace(/\s+/g,"").replace(/={0,2}$/,""),!/[^\s0-9a-zA-Z\+/]/.test(v)||!/[^\s0-9a-zA-Z\-_]/.test(v)),fromUint8Array:u,toUint8Array:q,extendString:J,extendUint8Array:K,extendBuiltins:()=>{J(),K()}}},function(Q,O,b){b.d(O,"a",function(){return I}),b.d(O,"b",function(){return p});var T,I={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},p=(T=1,function(){return T++})},function(Q,O,b){var T=b(28),I=(b.d(O,"i",function(){return T.a}),b(29)),p=(b.d(O,"d",function(){return I.a}),b.d(O,"e",function(){return I.b}),b.d(O,"j",function(){return I.c}),b.d(O,"r",function(){return I.d}),b(30)),k=(b.d(O,"a",function(){return p.a}),b.d(O,"b",function(){return p.b}),b.d(O,"c",function(){return p.c}),b(31)),S=(b.d(O,"f",function(){return k.a}),b.d(O,"g",function(){return k.b}),b.d(O,"h",function(){return k.c}),b.d(O,"q",function(){return k.d}),b.d(O,"s",function(){return k.e}),b.d(O,"t",function(){return k.f}),b.d(O,"u",function(){return k.g}),b.d(O,"v",function(){return k.h}),b.d(O,"w",function(){return k.i}),b(32)),f=(b.d(O,"k",function(){return S.a}),b.d(O,"l",function(){return S.b}),b.d(O,"m",function(){return S.c}),b.d(O,"n",function(){return S.d}),b.d(O,"o",function(){return S.e}),b.d(O,"p",function(){return S.f}),b(33));b.d(O,"x",function(){return f.a}),b.d(O,"y",function(){return f.b}),b.d(O,"z",function(){return f.c}),b(34)},function(Q,O,b){Q.exports=b(97)},function(Q,O,b){(function(T){var I=O;function p(S,f,d){for(var o=Object.keys(f),c=0;c<o.length;++c)S[o[c]]!==void 0&&d||(S[o[c]]=f[o[c]]);return S}function k(S){function f(d,o){if(!(this instanceof f))return new f(d,o);Object.defineProperty(this,"message",{get:function(){return d}}),Error.captureStackTrace?Error.captureStackTrace(this,f):Object.defineProperty(this,"stack",{value:new Error().stack||""}),o&&p(this,o)}return(f.prototype=Object.create(Error.prototype)).constructor=f,Object.defineProperty(f.prototype,"name",{get:function(){return S}}),f.prototype.toString=function(){return this.name+": "+this.message},f}I.asPromise=b(98),I.base64=b(99),I.EventEmitter=b(100),I.float=b(101),I.inquire=b(102),I.utf8=b(103),I.pool=b(104),I.LongBits=b(105),I.isNode=!!(T!==void 0&&T&&T.process&&T.process.versions&&T.process.versions.node),I.global=I.isNode&&T||typeof window<"u"&&window||typeof self<"u"&&self||this,I.emptyArray=Object.freeze?Object.freeze([]):[],I.emptyObject=Object.freeze?Object.freeze({}):{},I.isInteger=Number.isInteger||function(S){return typeof S=="number"&&isFinite(S)&&Math.floor(S)===S},I.isString=function(S){return typeof S=="string"||S instanceof String},I.isObject=function(S){return S&&typeof S=="object"},I.isset=I.isSet=function(S,f){var d=S[f];return!(d==null||!S.hasOwnProperty(f))&&(typeof d!="object"||0<(Array.isArray(d)?d:Object.keys(d)).length)},I.Buffer=function(){try{var S=I.inquire("buffer").Buffer;return S.prototype.utf8Write?S:null}catch{return null}}(),I._Buffer_from=null,I._Buffer_allocUnsafe=null,I.newBuffer=function(S){return typeof S=="number"?I.Buffer?I._Buffer_allocUnsafe(S):new I.Array(S):I.Buffer?I._Buffer_from(S):typeof Uint8Array>"u"?S:new Uint8Array(S)},I.Array=typeof Uint8Array<"u"?Uint8Array:Array,I.Long=I.global.dcodeIO&&I.global.dcodeIO.Long||I.global.Long||I.inquire("long"),I.key2Re=/^true|false|0|1$/,I.key32Re=/^-?(?:0|[1-9][0-9]*)$/,I.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,I.longToHash=function(S){return S?I.LongBits.from(S).toHash():I.LongBits.zeroHash},I.longFromHash=function(S,f){return S=I.LongBits.fromHash(S),I.Long?I.Long.fromBits(S.lo,S.hi,f):S.toNumber(!!f)},I.merge=p,I.lcFirst=function(S){return S.charAt(0).toLowerCase()+S.substring(1)},I.newError=k,I.ProtocolError=k("ProtocolError"),I.oneOfGetter=function(S){for(var f={},d=0;d<S.length;++d)f[S[d]]=1;return function(){for(var o=Object.keys(this),c=o.length-1;-1<c;--c)if(f[o[c]]===1&&this[o[c]]!==void 0&&this[o[c]]!==null)return o[c]}},I.oneOfSetter=function(S){return function(f){for(var d=0;d<S.length;++d)S[d]!==f&&delete this[S[d]]}},I.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},I._configure=function(){var S=I.Buffer;S?(I._Buffer_from=S.from!==Uint8Array.from&&S.from||function(f,d){return new S(f,d)},I._Buffer_allocUnsafe=S.allocUnsafe||function(f){return new S(f)}):I._Buffer_from=I._Buffer_allocUnsafe=null}}).call(this,b(12))},function(Q,O,b){Q.exports=function(T){for(var I=Math,p=T,k=p.lib,S=k.WordArray,f=k.Hasher,d=p.algo,o=[],c=0;c<64;c++)o[c]=4294967296*I.abs(I.sin(c+1))|0;var r=d.MD5=f.extend({_doReset:function(){this._hash=new S.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,i){for(var l=0;l<16;l++){var h=i+l,m=a[h];a[h]=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8)}var g=this._hash.words,y=a[i+0],w=a[i+1],M=a[i+2],R=a[i+3],D=a[i+4],q=a[i+5],L=a[i+6],j=a[i+7],G=a[i+8],J=a[i+9],K=a[i+10],ee=a[i+11],A=a[i+12],v=a[i+13],E=a[i+14],N=a[i+15],P=g[0],H=g[1],V=g[2],W=g[3];P=t(P,H,V,W,y,7,o[0]),W=t(W,P,H,V,w,12,o[1]),V=t(V,W,P,H,M,17,o[2]),H=t(H,V,W,P,R,22,o[3]),P=t(P,H,V,W,D,7,o[4]),W=t(W,P,H,V,q,12,o[5]),V=t(V,W,P,H,L,17,o[6]),H=t(H,V,W,P,j,22,o[7]),P=t(P,H,V,W,G,7,o[8]),W=t(W,P,H,V,J,12,o[9]),V=t(V,W,P,H,K,17,o[10]),H=t(H,V,W,P,ee,22,o[11]),P=t(P,H,V,W,A,7,o[12]),W=t(W,P,H,V,v,12,o[13]),V=t(V,W,P,H,E,17,o[14]),P=n(P,H=t(H,V,W,P,N,22,o[15]),V,W,w,5,o[16]),W=n(W,P,H,V,L,9,o[17]),V=n(V,W,P,H,ee,14,o[18]),H=n(H,V,W,P,y,20,o[19]),P=n(P,H,V,W,q,5,o[20]),W=n(W,P,H,V,K,9,o[21]),V=n(V,W,P,H,N,14,o[22]),H=n(H,V,W,P,D,20,o[23]),P=n(P,H,V,W,J,5,o[24]),W=n(W,P,H,V,E,9,o[25]),V=n(V,W,P,H,R,14,o[26]),H=n(H,V,W,P,G,20,o[27]),P=n(P,H,V,W,v,5,o[28]),W=n(W,P,H,V,M,9,o[29]),V=n(V,W,P,H,j,14,o[30]),P=s(P,H=n(H,V,W,P,A,20,o[31]),V,W,q,4,o[32]),W=s(W,P,H,V,G,11,o[33]),V=s(V,W,P,H,ee,16,o[34]),H=s(H,V,W,P,E,23,o[35]),P=s(P,H,V,W,w,4,o[36]),W=s(W,P,H,V,D,11,o[37]),V=s(V,W,P,H,j,16,o[38]),H=s(H,V,W,P,K,23,o[39]),P=s(P,H,V,W,v,4,o[40]),W=s(W,P,H,V,y,11,o[41]),V=s(V,W,P,H,R,16,o[42]),H=s(H,V,W,P,L,23,o[43]),P=s(P,H,V,W,J,4,o[44]),W=s(W,P,H,V,A,11,o[45]),V=s(V,W,P,H,N,16,o[46]),P=u(P,H=s(H,V,W,P,M,23,o[47]),V,W,y,6,o[48]),W=u(W,P,H,V,j,10,o[49]),V=u(V,W,P,H,E,15,o[50]),H=u(H,V,W,P,q,21,o[51]),P=u(P,H,V,W,A,6,o[52]),W=u(W,P,H,V,R,10,o[53]),V=u(V,W,P,H,K,15,o[54]),H=u(H,V,W,P,w,21,o[55]),P=u(P,H,V,W,G,6,o[56]),W=u(W,P,H,V,N,10,o[57]),V=u(V,W,P,H,L,15,o[58]),H=u(H,V,W,P,v,21,o[59]),P=u(P,H,V,W,D,6,o[60]),W=u(W,P,H,V,ee,10,o[61]),V=u(V,W,P,H,M,15,o[62]),H=u(H,V,W,P,J,21,o[63]),g[0]=g[0]+P|0,g[1]=g[1]+H|0,g[2]=g[2]+V|0,g[3]=g[3]+W|0},_doFinalize:function(){var a=this._data,i=a.words,l=8*this._nDataBytes,h=8*a.sigBytes;i[h>>>5]|=128<<24-h%32;var m=I.floor(l/4294967296),g=l;i[15+(h+64>>>9<<4)]=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8),i[14+(h+64>>>9<<4)]=16711935&(g<<8|g>>>24)|4278255360&(g<<24|g>>>8),a.sigBytes=4*(i.length+1),this._process();for(var y=this._hash,w=y.words,M=0;M<4;M++){var R=w[M];w[M]=16711935&(R<<8|R>>>24)|4278255360&(R<<24|R>>>8)}return y},clone:function(){var a=f.clone.call(this);return a._hash=this._hash.clone(),a}});function t(a,i,l,h,m,g,y){var w=a+(i&l|~i&h)+m+y;return(w<<g|w>>>32-g)+i}function n(a,i,l,h,m,g,y){var w=a+(i&h|l&~h)+m+y;return(w<<g|w>>>32-g)+i}function s(a,i,l,h,m,g,y){var w=a+(i^l^h)+m+y;return(w<<g|w>>>32-g)+i}function u(a,i,l,h,m,g,y){var w=a+(l^(i|~h))+m+y;return(w<<g|w>>>32-g)+i}return p.MD5=f._createHelper(r),p.HmacMD5=f._createHmacHelper(r),T.MD5}(b(5))},function(Q,O){var b=function(){return this}();try{b=b||new Function("return this")()}catch{typeof window=="object"&&(b=window)}Q.exports=b},function(Q,O,b){b.d(O,"a",function(){return o});var T=b(2),I=b(1),p=b(0),k=function(){return(k=Object.assign||function(r){for(var t,n=1,s=arguments.length;n<s;n++)for(var u in t=arguments[n])Object.prototype.hasOwnProperty.call(t,u)&&(r[u]=t[u]);return r}).apply(this,arguments)},S=function(r,t){var n=typeof Symbol=="function"&&r[Symbol.iterator];if(!n)return r;var s,u,a=n.call(r),i=[];try{for(;(t===void 0||0<t--)&&!(s=a.next()).done;)i.push(s.value)}catch(l){u={error:l}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(u)throw u.error}}return i},f=function(r,t,n){if(n||arguments.length===2)for(var s,u=0,a=t.length;u<a;u++)!s&&u in t||((s=s||Array.prototype.slice.call(t,0,u))[u]=t[u]);return r.concat(s||Array.prototype.slice.call(t))},d=p.J.Conversation,o=(c.prototype.destroy=function(){this.dbMgr=null,this.connMgr=null,this.eventBus=null,this.logger=null,this.engineConfig=null},c.prototype.setDBConv=function(r){Object.assign(r,this.dbConv),this.dbConv=r},c.prototype.setDBUser=function(r){r&&this.convType==p.q.Peer&&(this.dbUser=r)},c.prototype.sendMessage=function(r,t,n,s){var u=this,a=(r=Object.isFrozen(r)?k({},r):r).type>=p.R.Image&&r.type<=p.R.Video,i=a&&!!r.fileUID,l=a?p.I.SendMediaMessage:p.I.SendMessage,h=Date.now();if(!i&&h-this.lastSendTime<this.engineConfig.cloudSetting.qps.send_msg)return g=Object(I.s)(p.s.CommonModuleTriggerSDKFrequencyLimit),m={convID:this.convID,error:g},this.logger.warn(d,l,m),r.sentStatus=p.P.Failed,this.emitMessageSentStatusChanged(r),Promise.reject(g);this.lastSendTime=h,s=s||{time:h,convID:this.convID,message:k({},r)};var m=Object(I.i)(r.message),g=(a?r.message="":this.emitSendingMessage(r,t,n),i&&(r.clientSeq=++this.clientMsgSeq),k(k({},this.getAssociatedReqBody()),{conv_id:this.convID,msg_info:{msg_type:r.type,priority_type:t.priority,msg:m,payload:Object(I.i)(r.extendedData||""),has_receipt:t.hasReceipt&&this.convType!==p.q.Room?1:void 0,conv_id:this.convID,msg_client_info:{conv_sid:r.clientSid,client_msg_seq:r.clientSeq},offline_push:this.convType==p.q.Room?void 0:Object(I.e)(t.pushConfig)}}));return this.convType!=p.q.Peer||this.dbUser||this.dbConv.maxOrderKey||(g.fetch_peer_user_info=1),r.type==p.R.Custom&&(g.msg_info.sub_msg_type=r.subType,g.msg_info.searched_content=r.searchedContent),h=this.engineConfig.cloudSetting.req_to.send_msg,this.connMgr.sendRequest(this.convTypeMap.textMsgCmd,g,p.i.API,h).then(function(y){if(y.code==111100)return u.dbConv.state=y.conv_disable&&u.convType==p.q.Peer?p.p.Disable:p.p.Normal,u.updateConvWhenSendedMessage(y),s.result=u.saveLocalMessage(r,p.P.Success,y.audit_info),u.logger.info(d,l,s),{message:r};if(y.code==6000104)return u.queryMessageStatus([r],!0).then(function(M){var R,D=(M=S(M,2))[0];if(M=M[1])return i&&u.dbMgr.deleteMessageList(u.convID,u.convType,[r]),R=M.conversationSeq,q=u.dbConv.state,u.dbConv.state=p.p.Normal,u.saveMessageList([M],R,q,p.O.Sended),s.result=R,u.logger.info(d,l,s),Object.assign(r,M),{message:r};var q=u.handleSendMessageFail(r,D,l,s,i);if(i)throw q;return Promise.reject(q)});if(y.code){var w=u.handleSendMessageFail(r,y,l,s,i);if(i)throw w;return Promise.reject(w)}return u.handleSendMessageSuccess(r,y,l,s,i)})},c.prototype.sendCommand=function(r,t,n){var s,u=this,a=(Object.isFrozen(r)&&(r=k({},r)),Date.now()),i=a-this.lastSendTime<this.engineConfig.cloudSetting.qps.send_msg;if(r.type!=p.R.Barrage&&i)return s=Object(I.s)(p.s.CommonModuleTriggerSDKFrequencyLimit),i={convID:this.convID,error:s},this.logger.warn(d,p.I.SendMessage,i),r.sentStatus=p.P.Failed,this.emitMessageSentStatusChanged(r),Promise.reject(s);i=r.type;var l=r.message,h=(i!=p.R.Barrage&&(this.lastSendTime=a),{time:a,convID:this.convID,message:k({},r)});if(r.clientSeq=++this.clientMsgSeq,r.clientSid=""+this.convSid,r.localMessageID=r.clientSid+r.clientSeq,r.conversationID=this.convID,r.conversationType=this.convType,r.senderUserID=this.engineConfig.user.userID,r.direction=p.K.Send,r.sentStatus=p.P.Sending,r.conversationSeq=0,r.orderKey=0,r.isUserInserted=!1,r.receiptStatus=p.M.None,r.isBroadcastMessage&&(r.isBroadcastMessage=!1),n&&typeof n.onMessageAttached=="function")try{n.onMessageAttached(r)}catch{}return n=a-this.lastSendTime<this.engineConfig.cloudSetting.qps.send_barrage_msg,r.type==p.R.Barrage&&n?new Promise(function(m){setTimeout(function(){r.sentStatus=p.P.Success,r.messageID=r.localMessageID,r.timestamp=a+u.settings.serverOffsetTime,u.emitMessageSentStatusChanged(r),m({message:r})},80*Math.random()+50)}):(n={msg_type:i,priority_type:t.priority,msg:typeof l=="string"?Object(I.i)(l):l,conv_id:this.convID},r.extendedData&&(n.payload=Object(I.i)(r.extendedData)),i=k(k({},this.getAssociatedReqBody()),{conv_id:this.convID,command_msg_info:n}),this.connMgr.sendRequest(this.convTypeMap.commandMsgCmd,i).then(function(m){if(a+=u.settings.serverOffsetTime,m.code)return r.sentStatus=p.P.Failed,r.messageID=r.localMessageID,r.timestamp=a,u.emitMessageSentStatusChanged(r),g=u.withSendMessageErrorCode(m),h.error=g,u.logger.warn(d,p.I.SendMessage,h),Promise.reject(g);var g=m.msg_id;return m=m.command_svr_info,r.sentStatus=p.P.Success,r.messageID=m?m.msg_id:g,r.timestamp=m?m.msg_time:a,u.emitMessageSentStatusChanged(r),u.logger.info(d,p.I.SendMessage,h),{message:r}}))},c.prototype.sendMediaMessage=function(r,t,n){var s=this,u=(Object.isFrozen(r)&&(r=k({},r)),{time:new Date,uploadTime:0,convID:this.convID,message:k({},r)});return this.emitSendingMessage(r,t,n),r.fileDownloadUrl&&typeof r.fileDownloadUrl=="string"?(r.fileUID="",r.message=this.encodeMediaMsgBody(r.fileDownloadUrl,r,!0),this.sendMessage(r,t,void 0,u)):this.dbMgr.getFileInfo(r.fileLocalPath).then(function(a){return r.fileUID=a.md5,r.fileName=r.fileName||a.name,r.fileSize=+r.fileSize||a.size||1,s.saveLocalMessage(r,p.P.Sending),a={md5:r.fileUID,name:r.fileName,size:r.fileSize,file_type:r.type-10,duration:s.getMediaMessageDuration(r)},s.connMgr.sendRequest(p.c.file_upload,a)}).then(function(a){if(a.code)throw Object(I.s)(p.s.MessageModuleFileServerError,a.message,a.code);function i(m){var g=m.loaded||m.totalBytesSent||m.totalBytesWritten||0;if(m=m.total||m.totalBytesExpectedToSend||m.totalBytesExpectedToWrite||1,n&&typeof n.onMediaUploadingProgress=="function")try{n.onMediaUploadingProgress(r,g,m)}catch{}}if(i({loaded:0,total:r.fileSize}),a.state==1)return i({loaded:r.fileSize,total:r.fileSize}),s.fetchFileProcess(r,t,u);var l=Date.now(),h={file_size:r.fileSize,file_type:r.type,file_env:I.n?I.n._zim_env:""};return s.dbMgr.uploadFile(a.upload_req,r.fileLocalPath,i).then(function(){return h.time_consumed=Date.now()-l,s.dataReport.reportSDKEvent("/sdk/file/upload_msg",h),u.uploadTime=h.time_consumed,s.fetchFileProcess(r,t,u)},function(m){throw h.time_consumed=Date.now()-l,h.error=m.code,h.error_message=m.message,s.dataReport.reportSDKEvent("/sdk/file/upload_msg",h),m.code=0,m})}).catch(function(a){var i=I.n?I.n._zim_env:"",l=a?a.code:0,h=a?a.stack||a.message||a.errMsg:l;throw a=l?a:Object(I.s)(p.s.MessageModuleSendMessageFailed,h),u.error=a,s.logger.warn(d,p.I.SendMediaMessage,u),l||(s.dataReport.reportSDKEvent("/sdk/log",{error_message:"API.sendMediaMessage:"+i+h}),s.logger.upload("sendMediaMessage error",!0)),a})},c.prototype.deleteMessages=function(r,t){var n=this;if(!(r=r.filter(function(a){return a.messageID&&a.conversationSeq&&a.conversationID===n.convID&&a.conversationType===n.convType})).length)return Promise.reject(Object(I.s)(p.s.CommonModuleParamInvalid,"messageList is invalid."));var s={time:new Date,convID:this.convID,config:t};if(t&&t.isAlsoDeleteServerMessage){if((t=r.filter(function(a){return!a.isUserInserted&&!a.isBroadcastMessage&&a.sentStatus==p.P.Success})).length==0)return this.deleteLocalMessages(r,s);var u=this.convType==p.q.Peer?p.c.c2c_del_msg:p.c.group_del_msg;return t=this.convType==p.q.Peer?{conv_id:this.convID,conv_type:this.convType,msg_ids:t.map(function(a){return a.messageID})}:{conv_id:this.convID,conv_msg_seq:t.map(function(a){return a.conversationSeq})},this.connMgr.sendRequest(u,t).then(function(a){return a.code?(a=Object(I.s)(p.s.ConversationModuleServerError,a.message,a.code),s.error=a,n.logger.warn(d,p.I.DeleteMessages,s),Promise.reject(a)):n.deleteLocalMessages(r,s)})}return this.deleteLocalMessages(r,s)},c.prototype.deleteAllMessage=function(r){var t,n=this,s={time:new Date,convID:this.convID,config:r};return r&&r.isAlsoDeleteServerMessage?(r=this.convType==p.q.Peer?p.c.c2c_del_all_msg:p.c.group_del_all_msg,t={conv_id:this.convID,conv_type:this.convType},this.connMgr.sendRequest(r,t).then(function(u){return u.code?(u=Object(I.s)(p.s.ConversationModuleServerError,u.message,u.code),s.error=u,n.logger.warn(d,p.I.DeleteAllMessage,s),Promise.reject(u)):n.deleteLocalAllMessage(s)})):this.deleteLocalAllMessage(s)},c.prototype.queryHistoryMessage=function(r){var t=this;return new Promise(function(n){function s(q,L){i?q.sort(function(J,K){return K.orderKey-J.orderKey}):q.sort(function(J,K){return J.orderKey-K.orderKey});var j=0,G=(j=u?q.findIndex(function(J){return u===J.messageID})+1:j)+a;q=q.slice(j,G),i&&q.sort(function(J,K){return J.orderKey-K.orderKey}),R.seqs=[l,h,m,j,a].join(),D.count=q.length,D.statusMap=R,L&&(D.dataReport=L),(G=q.filter(function(J){return J.sentStatus==p.P.Sending})).length&&t.queryMessageStatus(G),n({list:q,log:D})}var u=r.nextMessage?r.nextMessage.messageID:"",a=r.count,i=r.reverse,l=t.dbConv.msgSeq||0,h=t.dbConv.maxSeq||0,m=r.nextMessage?r.nextMessage.conversationSeq:0,g=!m&&i,y=!1,w=0,M=0,R=(i?(M=m?m-1:l,w=Math.max(t.dbConv.deletedMsgMaxSeq||0,M-a)):(w=Math.max(t.dbConv.deletedMsgMaxSeq||0,m),M=w+a),{reverse:i,seqs:"",degree:{},flag:{}}),D={time:new Date,convID:t.convID,smin:w,smax:M,lmin:0,lmax:0,dbCount:0,count:0};t.dbMgr.getMessageList(t.dbConv,r).then(function(q){var L=t.dbConv.deletedMsgMaxSeq||0,j=t.dbConv.deletedMsgSeqs||[],G=q.filter(function(oe){return!oe.isUserInserted&&oe.sentStatus==p.P.Success}).map(function(oe){return oe.conversationSeq}),J=(j.length&&G.push.apply(G,f([],S(j),!1)),G.sort(function(oe,ie){return oe-ie}),G[0]||0),K=G[G.length-1]||0;if(D.dbCount=q.length,D.lmin=J,D.lmax=K,!g&&q.length>=a&&K-J<G.length&&J<=w+1&&M<=K)return s(q);function ee(oe){var ie,ue,pe,de,_e;t.dbMgr&&(P+=oe.list.length,ue=ie=0,oe.list.forEach(function(le,be){var ge=le.msg_svr_info.msg_id,ve=le.msg_svr_info.conv_msg_seq;B.push(ve),j.indexOf(ve)==-1&&L<ve&&!H.has(ge)&&(E<ve&&(E=ve),(!v||ve<v)&&(v=ve),H.set(ge,t.transform2Message(le,!0))),be==0?ie=ve:be==oe.list.length-1&&(ue=ve),(ge=le.msg_info.msg)!=null&&ge.length||(R.flag[ve]=le.msg_info.msg)}),R.degree[N]=v+","+E+","+ie+","+ue,de=g?y:i,oe.nextSeq&&H.size<a&&(!de&&E<M||de&&w<v)?t.fetchServerPageMessage(oe.nextSeq,++N,V,de).then(ee):(oe.degree=N,oe.svrCount=P,pe=t.dataReport.endNetworkRequest(t.convTypeMap.fetchMsgList.cmd,W,oe),de=Array.from(H.values()),(_e=t.dbConv.state)!=p.p.Delete&&de.length&&(t.dbConv.state=p.p.Normal),t.insertDeletedMsgSeqs(B,D),de.length?t.saveMessageList(de,E,_e,p.O.Fetch).then(function(){return t.dbMgr.getMessageList(t.dbConv,r)}).then(function(le){return s(le,pe)}):s(q)))}var A,v=0,E=0,N=1,P=0,H=new Map,V=p.u.Biz,W=++t.mergeMsgListSeq+t.convType+t.convID,B=[];if(g)h&&l<=h?t.fetchServerPageMessage(l,N,V,y,W).then(ee):(y=!0,A=Math.min(100,l-h),t.fetchServerPageMessage(-1,N,V,y,W,A).then(ee));else{var $=i?J:K,X=100;if(i)if(M<=K){for(var ne=G.length-1;0<ne;ne--)if(1<G[ne]-G[ne-1]){$=G[ne],X=Math.min(100,G[ne]-G[ne-1]),R.seqs=G[ne-1]+","+$;break}}else $=M+1,X=Math.min(100,M+1-K);else if($=K,J<=w+1){for(ne=1;ne<G.length;ne++)if(1<G[ne]-G[ne-1]){$=G[ne-1],X=Math.min(100,G[ne]-G[ne-1]),R.seqs=$+","+G[ne];break}}else $=w,X=Math.min(100,J-w+1);t.fetchServerPageMessage($,N,V,i,W,X).then(ee)}})})},c.prototype.insertMessageToLocalDB=function(r){var t=this,n=(Object.isFrozen(r)&&(r=k({},r)),this.dbConv.msgSeq||0),s={convID:this.convID,dbSeq:n,orderKey:this.dbConv.maxOrderKey,message:k({},r)},u=(r.clientSeq=++this.clientMsgSeq,r.clientSid=""+this.convSid,r.localMessageID=r.clientSid+r.clientSeq,r.messageID=r.localMessageID,r.conversationSeq=n,r.orderKey=(this.dbConv.maxOrderKey||0)+1,r.conversationID=this.convID,r.conversationType=this.convType,r.direction=p.K.Send,r.sentStatus=p.P.Success,r.timestamp=Date.now()+this.settings.serverOffsetTime,r.isUserInserted=!0,r.receiptStatus=p.M.None,this.dbUser&&(this.dbConv.conversationName=this.dbUser.userName,this.dbConv.conversationAvatarUrl=this.dbUser.userAvatarUrl),k({},r)),a=this.dbConv.state;return a==p.p.Delete&&(this.dbConv.state=p.p.Normal),this.saveMessageList([u],n,a,p.O.Insert).then(function(){return t.logger.info(d,p.I.InsertMessageToLocalDB,s),{message:r}})},c.prototype.onPushMessage=function(r,t){t&&(this.dbConv.sendMsgCount=t),t=this.transform2Message(r,!1),r=this.dbConv.state,this.dbConv.state=p.p.Normal,this.saveMessageList([t],t.conversationSeq,r,p.O.Push),this.emitReceiveMessage([t],p.u.SDKPush,"push")},c.prototype.onPushMsgDelete=function(r,t){var n=this,s=this.dbConv.readMsgSeq||0;this.dbMgr.deleteMessageListFromRemote(this.convID,this.convType,r,s,function(u,a,i){0<u.length&&(u={conversationID:n.convID,conversationType:n.convType,isDeleteConversationAllMessage:!1,messageList:u},n.eventBus.emit(p.t.MsgDeleted,u)),n.afterDeleteLocalMessages(r,a,!1,t,i)})},c.prototype.onPushAllMsgDelete=function(r,t){function n(m){var g={conversationID:s.convID,conversationType:s.convType,isDeleteConversationAllMessage:!0,messageList:[]},y=(g=(s.eventBus.emit(p.t.MsgDeleted,g),[0,s.dbConv.unreadMessageCount,0]),!1);s.dbConv.deletedMsgCount=m,(w=s.dbConv.lastMessage)&&!w.isUserInserted&&w.sentStatus==p.P.Success&&w.conversationSeq==r&&(y=!0,g[0]=w.conversationSeq,s.dbConv.lastMessage=void 0);var w=Math.max(i-u-l-m,0);(g[2]=w)!=s.dbConv.unreadMessageCount&&(y=!0,s.dbConv.unreadMessageCount=w,s.emitUnreadMessageCount(t)),y&&s.emitConversationChanged(p.n.Updated,t),s.dbMgr.addConversationList([s.dbConv],t+g.join())}var s=this,u=Math.max(r,this.dbConv.readMsgSeq||0),a=(this.dbConv.readMsgSeq=u,this.dbConv.deletedMsgMaxSeq=Math.max(r,this.dbConv.deletedMsgMaxSeq||0),[]),i=(this.dbConv.deletedMsgSeqs&&this.dbConv.deletedMsgSeqs.length&&(this.dbConv.deletedMsgSeqs=this.dbConv.deletedMsgSeqs.filter(function(m){return u<m&&a.push(m),r<m})),this.dbConv.msgSeq||0),l=this.dbConv.sendMsgCount||0,h=0<a.length;h||n(0),this.dbMgr.deleteAllMessageFromRemote(this.convID,this.convType,r,a,h?n:void 0)},c.prototype.insertDeletedMsgSeqs=function(r,t){r.sort(function(i,l){return i-l});for(var n=[],s=0;s<r.length-1;s++){var u=r[s+1]-r[s];if(1<u)for(var a=1;a<u;a++)n.push(r[s]+a)}n.length&&(t&&(t.delSeqs=n.join()),(t=this.dbConv.deletedMsgSeqs)&&t.length&&n.push.apply(n,f([],S(t),!1)),this.dbConv.deletedMsgSeqs=Array.from(new Set(n)))},c.prototype.deleteLocalMessages=function(r,t){var n=this,s=this.dbConv.readMsgSeq||0,u=[],a=0;return r.forEach(function(i){i.isUserInserted||i.isBroadcastMessage||i.sentStatus!=p.P.Success||(u.push(i.conversationSeq),i.direction===p.K.Receive&&i.conversationSeq>s&&a++)}),this.dbMgr.deleteMessageList(this.convID,this.convType,r,!0).then(function(i){return n.afterDeleteLocalMessages(u,a,!0,"deleteMsgs",i),n.logger.info(d,p.I.DeleteMessages,t),u})},c.prototype.afterDeleteLocalMessages=function(r,t,n,s,u){var a,i=!1,l=(r=(this.dbConv.deletedMsgSeqs=r.concat(this.dbConv.deletedMsgSeqs||[]),this.dbConv.lastMessage?this.dbConv.lastMessage.messageID:""),u?u.messageID:"");u&&l!=r&&(this.dbConv.orderKey=u.timestamp),r!=l&&(i=!0),this.dbConv.lastMessage=u,u=[r,l,0,this.dbConv.unreadMessageCount,t],0<t&&(t+=this.dbConv.deletedMsgCount||0,this.dbConv.deletedMsgCount=t,r=this.dbConv.readMsgSeq||0,l=this.dbConv.msgSeq||0,a=this.dbConv.sendMsgCount||0,r=Math.max(l-r-a-t,0),u[2]=r,n&&r==0&&(this.dbConv.readMsgSeq=l,this.dbConv.sendMsgCount=0,this.dbConv.deletedMsgCount=0,this.updateServerReadMsgSeq(l)),this.dbConv.unreadMessageCount!=r&&(i=!0,this.dbConv.unreadMessageCount=r,this.emitUnreadMessageCount(s))),i&&this.emitConversationChanged(p.n.Updated,s),this.dbMgr.addConversationList([this.dbConv],s+u.join())},c.prototype.deleteLocalAllMessage=function(r){this.dbMgr.deleteAllMessage(this.convID,this.convType);var t=this.dbConv.msgSeq||0,n=(this.dbConv.sendMsgCount=0,this.dbConv.deletedMsgCount=0,this.dbConv.unreadMessageCount=0,this.dbConv.readMsgSeq=t,this.dbConv.deletedMsgMaxSeq=t,this.dbConv.deletedMsgSeqs=[],this.dbConv.lastMessage=void 0,"deleteAllMsg");return this.emitConversationChanged(p.n.Updated,n),this.emitUnreadMessageCount(n),this.updateServerReadMsgSeq(t),this.dbMgr.addConversationList([this.dbConv],n),this.logger.info(d,p.I.DeleteAllMessage,r),Promise.resolve({conversationID:this.convID,conversationType:this.convType})},c.prototype.updateServerReadMsgSeq=function(r){this.dbConv.state||(r={conv_id:this.convID,conv_type:this.convType,read_seq:r},this.connMgr.sendRequest(p.c.usermail_update_read_seq,r,p.i.SDK))},c.prototype.fetchServerPageMessage=function(r,t,n,s,u,a){if(a=this.getFetchMessageReqBody(r,n,s?1:0,a||100),this.convType==p.q.Room&&!a)return Promise.resolve({nextSeq:0,list:[]});a.degree=t,a.how=n;var i=this.convTypeMap.fetchMsgList,l=n==p.u.Biz?p.i.API:p.i.SDK;return t==1&&u&&this.dataReport.beginNetworkRequest(i.cmd,u,l,a),this.connMgr.sendRequest(i,a,l).then(function(h){if(h.code)return h.list=[],h;var m=h.max_conv_msg_seq,g=h.next_conv_msg_seq,y={fetch_end:h.fetch_end,next_seq:g,maxSeq:m,nextSeq:g,list:h.msgs};return(n==p.u.SDKLogin||h.fetch_end||!s&&(m?m<=r||m<=g:g<=r))&&(y.nextSeq=0),y})},c.prototype.saveLocalMessage=function(r,t,n){var s=this.dbConv.msgSeq||0,u=(r.messageID||(r.messageID=r.localMessageID),r.sentStatus=t,r.timestamp=Date.now()+this.settings.serverOffsetTime,r.conversationSeq=s,r.orderKey=(this.dbConv.maxOrderKey||0)+1,k({},r)),a=t==p.P.Sending?p.O.Sending:p.O.Sended;return this.saveMessageList([u],s,this.dbConv.state,a),t!=p.P.Sending&&this.emitMessageSentStatusChanged(r,n),r.conversationSeq},c.prototype.saveMessageList=function(r,t,n,s){if(r.length==0)return Promise.resolve();r.sort(function(y,w){return y.orderKey-w.orderKey});var u,a,i={maxSeq:this.dbConv.maxSeq||0,msgSeq:this.dbConv.msgSeq||0,maxOrderKey:this.dbConv.maxOrderKey||0,lastMessage:this.dbConv.lastMessage||{messageID:""}},l=i.lastMessage.orderKey||0,h=r[r.length-1],m=(this.dbConv.maxSeq=Math.max(i.maxSeq,t),this.dbConv.maxOrderKey=Math.max(i.maxOrderKey,h.orderKey),t=Math.max(i.msgSeq,t),this.dbConv.msgSeq=t,"saveMsgs_"+s),g=(this.convType==p.q.Room||s!=p.O.Fetch&&s!=p.O.Push||(a=this.dbConv.readMsgSeq||0,g=this.dbConv.sendMsgCount||0,u=this.dbConv.deletedMsgCount||0,s!=p.O.Push||i.msgSeq||(this.dbConv.readMsgSeq=a=t-1),(t=Math.max(t-a-g-u,0))!=this.dbConv.unreadMessageCount&&(this.dbConv.unreadMessageCount=t,this.emitUnreadMessageCount(m))),this.convType!=p.q.Room&&i.lastMessage.messageID!=h.messageID&&(i.lastMessage.sentStatus==p.P.Failed||h.orderKey>=l||s==p.O.Push)&&(this.dbConv.orderKey=h.timestamp,this.dbConv.lastMessage=h,s!=p.O.Sending&&(a=s==p.O.Sended||i.maxOrderKey&&n!=p.p.Delete?this.dbConv.state==p.p.Disable?p.n.Disabled:p.n.Updated:p.n.Added,this.emitConversationChanged(a,m))),[i.msgSeq,i.maxSeq,i.maxOrderKey,l,h.orderKey].join());return this.dbMgr.addConversationList([this.dbConv],m+"_"+g),this.dbMgr.addMessageList(this.convID,this.convType,r,s==p.O.Fetch)},c.prototype.transform2Message=function(r,t){var n=r.msg_info,s=(r=r.msg_svr_info,n.msg_type),u=r.sender_user_id;return(s={type:200<=s&&s<=400?p.R.Custom:s,localMessageID:"",messageID:r.msg_id,timestamp:r.msg_time,extendedData:n.payload&&s!=p.R.Revoke?Object(I.f)(n.payload):void 0,conversationID:this.convID,conversationType:this.convType,senderUserID:u,sentStatus:p.P.Success,direction:u===this.engineConfig.user.userID?p.K.Send:p.K.Receive,conversationSeq:r.conv_msg_seq,orderKey:0,isUserInserted:!1,receiptStatus:p.M.None,clientSeq:n.msg_client_info?n.msg_client_info.client_msg_seq:0,clientSid:n.msg_client_info?n.msg_client_info.conv_sid:""}).localMessageID=s.clientSid+s.clientSeq,this.protobuf.decodeMsgBody(s,n.msg,r.version,r.is_server),s.type==p.R.Custom&&(s.subType=n.sub_msg_type||0,s.searchedContent=n.searched_content),s.type!=p.R.Revoke&&n.msg_status&&(s.receiptStatus=Object(I.r)(n.msg_status).receipt,t&&this.dbMgr.checkMessageStatus(s)),s.reactions=this.convMgr.handleReactionList(s,r.reactions),this.calculateMessageOrderKey(s,!0),s},c.prototype.withSendMessageErrorCode=function(r){return r=Object(I.s)(p.s.MessageModuleSendMessageFailed,r.message,r.code),this.convType==p.q.Group&&this.auditErrorCodes.indexOf(r.code)==-1&&(r.code=6000203),r},c.prototype.calculateMessageOrderKey=function(r,t){if(r.orderKey)return r.orderKey;var n=p.l.MESSAGE_SEQ_MULTIPLIER,s=r.clientSeq,u=r.clientSid;if(!s||!u)return r.orderKey=r.conversationSeq*n,r.orderKey;var a=this.msgCaches[r.senderUserID];if(!a)return r.orderKey=r.conversationSeq*n,t&&(this.msgCaches[r.senderUserID]=a=[r]),r.orderKey;var i=a.find(function(w){return w.messageID==r.messageID});if(i&&i.orderKey)return r.orderKey=i.orderKey,i.orderKey;var l=0,h=0,m=0,g=0,y=(a.forEach(function(w){var M=w.clientSeq;w.clientSid==u&&M&&(s<M&&(!h||M<h)?(h=M,g=w.conversationSeq*n):M<s&&(!l||l<M)&&(l=M,m=w.conversationSeq*n))}),r.conversationSeq*n);return l&&h?(y<=m||g<=y)&&(y=m+Math.floor(Math.random()*(g-m+1))):y<m?y=m+s-l:h&&g<y&&(y=g+s-h),r.orderKey=y,!i&&t&&a.push(r),100<a.length&&(a.sort(function(w,M){return w.orderKey-M.orderKey}),a.splice(0,90)),r.orderKey},c.prototype.mergeServerMessageList=function(r,t,n){var s,u,a,i,l,h,m,g,y,w,M=this;this.isFetchMessageWhenLogin(r)&&(s=Math.max(this.dbConv.maxSeq||0,this.dbConv.deletedMsgMaxSeq||0),n=n||this.dbConv.msgSeq||0,r==p.u.SDKHb&&n<=s||(u=new Map,a=++this.mergeMsgListSeq+this.convType+this.convID,h=1,m=l=i=0,g={time:new Date,convID:this.convID,how:r,action:t,dbSeq:s,msgSeq:n,emitSeq:0,statusMap:{degree:{},flag:{}}},y=function(R){var D,q,L,j,G,J;M.dbMgr&&(D=M.dbConv.deletedMsgSeqs||[],q=[],m+=R.list.length,j=L=0,R.list.forEach(function(K,ee){var A=K.msg_svr_info.msg_id,v=K.msg_svr_info.conv_msg_seq;q.push(v),D.indexOf(v)==-1&&s<v&&!u.has(A)&&(l<v&&(l=v),(!i||v<i)&&(i=v),u.set(A,M.transform2Message(K,!0))),ee==0?L=v:ee==R.list.length-1&&(j=v),K.msg_info.msg_type==31||(A=K.msg_info.msg)!=null&&A.length||(g.statusMap.flag[v]=K.msg_info.msg)}),g.statusMap.degree[h]=i+","+l+","+L+","+j,R.nextSeq?M.fetchServerPageMessage(R.nextSeq,++h,r,!1).then(y):(R.degree=h,R.svrCount=m,R.dbSeq=s,G=Array.from(u.values()),(J=M.dbConv.state)!=p.p.Delete&&G.length&&(M.dbConv.state=p.p.Normal),M.insertDeletedMsgSeqs(q,g),M.saveMessageList(G,l,J,p.O.Fetch),M.emitReceiveMessage(G,r,t),g.dataReport=M.dataReport.endNetworkRequest(M.convTypeMap.fetchMsgList,a,R),M.logger.info(d,"mergeSvrMsgs",g)))},r==p.u.SDKLogin?s<n?this.fetchServerPageMessage(n+1,h,r,!0,a,n+1-s).then(y):this.dbConv.state==p.p.Delete&&this.convType==p.q.Peer&&((w=0<n?n+1:-1)==-1||s<n)&&this.fetchServerPageMessage(w,h,r,!0,a,0<n?n+1-s:0).then(y):this.fetchServerPageMessage(s,h,r,!1,a).then(y)))},c.prototype.fetchMsgListFromCache=function(r){var t=this;return new Promise(function(n){r.sort(function(u,a){return u-a});var s=new Map;if(Object.values(t.msgCaches).forEach(function(u){u&&u.length&&u.forEach(function(a){var i=a.conversationSeq;r.indexOf(i)!=-1&&s.set(i,a)})}),s.size==r.length)return n(s);t.dbMgr.getMessageListBySeqs(t.convID,t.convType,r).then(n)})},c.prototype.updateMsgCacheList=function(r){var t=this;r.forEach(function(n){var s,u=t.msgCaches[n.senderUserID];u&&u.length&&(s=u.findIndex(function(a){return a.messageID==n.messageID}))!=-1&&(u[s]=n)})},c.prototype.fetchFileProcess=function(r,t,n){var s=this,u={md5:r.fileUID,file_type:r.type-10,file_name:r.fileName};return this.connMgr.sendRequest(p.c.file_process,u).then(function(a){if(a.code)throw Object(I.s)(p.s.MessageModuleSendMessageFailed,a.message,a.code);return r.message=s.encodeMediaMsgBody(a.download_url,r),r.fileLocalPath="",s.sendMessage(r,t,void 0,n)})},c.prototype.emitUnreadMessageCount=function(r){this.convType!=p.q.Room&&this.eventBus.exec(p.t.IUnreadMsgCount,r)},c.prototype.emitConversationChanged=function(r,t,n){this.convType!=p.q.Room&&this.dbConv.state!=p.p.Delete&&(r={event:r,conversation:{conversationID:this.dbConv.conversationID,conversationName:this.dbConv.conversationName,conversationAvatarUrl:this.dbConv.conversationAvatarUrl,type:this.dbConv.type,unreadMessageCount:this.dbConv.unreadMessageCount,notificationStatus:this.dbConv.notificationStatus,orderKey:n?n.timestamp:this.dbConv.orderKey,isPinned:!!this.dbConv.isPinned,lastMessage:n||this.dbConv.lastMessage}},this.eventBus.emit(p.t.ConvChanged,{infoList:[r]},t))},c.prototype.emitSendingMessage=function(r,t,n){if(r.clientSeq=++this.clientMsgSeq,r.clientSid=""+this.convSid,r.localMessageID=r.clientSid+r.clientSeq,r.conversationID=this.convID,r.conversationType=this.convType,r.senderUserID=this.engineConfig.user.userID,r.direction=p.K.Send,r.sentStatus=p.P.Sending,r.timestamp=Date.now()+this.settings.serverOffsetTime,r.isUserInserted=!1,r.receiptStatus=t.hasReceipt?p.M.Processing:p.M.None,r.isBroadcastMessage&&(r.isBroadcastMessage=!1),n&&typeof n.onMessageAttached=="function")try{n.onMessageAttached(r)}catch{}this.dbUser&&(this.dbConv.conversationName=this.dbUser.userName,this.dbConv.conversationAvatarUrl=this.dbUser.userAvatarUrl),t=p.n.Added,this.dbConv.state==p.p.Delete?this.dbConv.state=p.p.Normal:this.dbConv.maxOrderKey&&(t=this.dbConv.state==p.p.Disable?p.n.Disabled:p.n.Updated),this.emitConversationChanged(t,"sendingMessage_"+this.dbConv.maxOrderKey,r)},c.prototype.emitReceiveMessage=function(r,t,n){r.length&&(r.sort(function(s,u){return s.orderKey-u.orderKey}),this.eventBus.emit(this.convTypeMap.receiveMessage,{messageList:r,fromConversationID:this.convID},n))},c.prototype.getMediaMessageDuration=function(r){var t=0;return r.type==p.R.Audio?t=+r.audioDuration||0:r.type==p.R.Video&&(t=+r.videoDuration||0),t},c.prototype.encodeMediaMsgBody=function(r,t,n){r={version:"1",file_type:t.type-10,file_download_url:r};var s,u=(n||(r.file_uid=t.fileUID||""),r.file_name=t.fileName||"",r.file_size=String(+t.fileSize||0),t.type);return u==p.R.Image&&n?(n=t.thumbnailDownloadUrl,s=t.largeImageDownloadUrl,n&&(r.thumbnail_download_url=n),s&&(r.large_image_download_url=s)):u==p.R.Audio?(n=t.audioDuration,r.media_duration=String(n||0)):u==p.R.Video&&(s=t.videoDuration,n=t.videoFirstFrameDownloadUrl,r.media_duration=String(s||0),n&&(r.video_first_frame_download_url=n)),this.protobuf.encodeMediaMsgBody(u,r)},c.prototype.emitMessageSentStatusChanged=function(r,t){t={status:r.sentStatus,reason:t,message:r},this.eventBus.emit(p.t.MsgSentStatus,{infos:[t]})},c.prototype.queryMessageStatus=function(r,t){var n=this,s=r.map(function(u){return{conv_sid:u.clientSid,client_msg_seq:u.clientSeq}});return s=k(k({},this.getAssociatedReqBody()),{room_id:this.convID,client_infos:s}),this.connMgr.sendRequest(this.convTypeMap.msgStatusQuery,s,p.i.SDK).then(function(u){var a=[];return u.msgs=u.msgs||[],u.msgs.forEach(function(i){var l,h,m,g,y,w=i.msg_info,M=(i=i.msg_svr_info,w.msg_status),R=w.msg_client_info;(w=(w=r.find(function(D){return D.clientSeq==R.client_msg_seq&&D.clientSid==R.conv_sid}))?JSON.parse(JSON.stringify(w)):null)&&w.sentStatus!==p.P.Success&&(l=w.type>=p.R.Image&&w.type<=p.R.Video&&!!w.fileUID,h=i.conv_msg_seq,m=i.msg_id,g=i.msg_time,y=i.msg_rsp,i=i.version,w.sentStatus=p.P.Success,w.messageID=m,w.timestamp=g,w.conversationSeq=h,M&&w.receiptStatus==p.M.Processing&&(w.receiptStatus=Object(I.r)(M).receipt),l&&n.protobuf.decodeMsgBody(w,y,i,!1),n.calculateMessageOrderKey(w,!0),a.push(w))}),u.fail_list=u.fail_list||[],u.fail_list.forEach(function(i){var l,h=i.client_info;i=i.reason,(l=(l=r.find(function(m){return m.clientSeq==h.client_msg_seq&&m.clientSid==h.conv_sid}))?JSON.parse(JSON.stringify(l)):null)&&i==1&&(l.sentStatus=p.P.Failed,a.push(l))}),0<a.length&&(t||n.dbMgr.addMessageList(n.convID,n.convType,a,!0),n.eventBus.emit(p.t.MsgSentStatus,{infos:a.map(function(i){return{status:i.sentStatus,message:i}})})),[u,a[0]]})},c.prototype.updateConvWhenSendedMessage=function(r){r.peer_user_name&&(this.dbConv.conversationName=Object(I.f)(r.peer_user_name)),r.peer_user_avatar&&(this.dbConv.conversationAvatarUrl=Object(I.f)(r.peer_user_avatar)),r.send_count_after_read&&(this.dbConv.sendMsgCount=r.send_count_after_read)},c.prototype.handleSendMessageFail=function(r,t,n,s,u){this.dbConv.state=t.conv_disable&&this.convType==p.q.Peer?p.p.Disable:p.p.Normal;var a=t.code==6000104?p.P.Sending:p.P.Failed;return s.result=this.saveLocalMessage(r,a,t.audit_info),r=this.withSendMessageErrorCode(t),u||(s.error=r,this.logger.warn(d,n,s)),r},c.prototype.handleSendMessageSuccess=function(r,t,n,s,u){this.updateConvWhenSendedMessage(t);var a=(m=t.msg_svr_info).conv_msg_seq,i=m.msg_id,l=m.msg_time,h=m.msg_rsp,m=m.version;return(l=(r.sentStatus=p.P.Success,r.messageID=i,r.timestamp=l,r.conversationSeq=a,t.msg_status||((i=t.msg_info)==null?void 0:i.msg_status)))&&r.receiptStatus==p.M.Processing&&(r.receiptStatus=Object(I.r)(l).receipt),i=null,this.convType==p.q.Group&&t.receipt_seq&&(i={seq:t.receipt_seq,count:t.unread_count||0}),u&&(this.dbMgr.deleteMessageList(this.convID,this.convType,[r]),this.protobuf.decodeMsgBody(r,h,m,!1)),l=k({},r),r.orderKey=this.calculateMessageOrderKey(l,!0),u=this.dbConv.state,this.dbConv.state=p.p.Normal,this.saveMessageList([l],a,u,p.O.Sended),this.emitMessageSentStatusChanged(r,t.audit_info),s.result=a,this.logger.info(d,n,s),{message:r,receiptInfo:i}},c);function c(r,t,n,s,u,a){this.logger=T.a.getInstance().logger,this.dataReport=T.a.getInstance().dataReport,this.protobuf=T.a.getInstance().protobuf,this.settings=T.a.getInstance().settings,this.lastSendTime=0,this.convSid=Date.now(),this.clientMsgSeq=0,this.dbConv={},this.mergeMsgListSeq=0,this.msgCaches={},this.auditErrorCodes=[6000104,6000221,,6000222],this.dbConv.conversationID=r,this.convID=r,this.engineConfig=t,this.eventBus=n,this.dbMgr=s,this.connMgr=u,this.convMgr=a}},function(Q,O,b){Q.exports=function(T){for(var I=T,p=I.lib.BlockCipher,k=I.algo,S=[],f=[],d=[],o=[],c=[],r=[],t=[],n=[],s=[],u=[],a=[],i=0;i<256;i++)a[i]=i<128?i<<1:i<<1^283;var l=0,h=0;for(i=0;i<256;i++){var m=h^h<<1^h<<2^h<<3^h<<4;m=m>>>8^255&m^99,S[l]=m,f[m]=l;var g=a[l],y=a[g],w=a[y],M=257*a[m]^16843008*m;d[l]=M<<24|M>>>8,o[l]=M<<16|M>>>16,c[l]=M<<8|M>>>24,r[l]=M,M=16843009*w^65537*y^257*g^16843008*l,t[m]=M<<24|M>>>8,n[m]=M<<16|M>>>16,s[m]=M<<8|M>>>24,u[m]=M,l?(l=g^a[a[a[w^g]]],h^=a[a[h]]):l=h=1}var R=[0,1,2,4,8,16,32,64,128,27,54],D=k.AES=p.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var q=this._keyPriorReset=this._key,L=q.words,j=q.sigBytes/4,G=4*((this._nRounds=j+6)+1),J=this._keySchedule=[],K=0;K<G;K++)K<j?J[K]=L[K]:(v=J[K-1],K%j?j>6&&K%j==4&&(v=S[v>>>24]<<24|S[v>>>16&255]<<16|S[v>>>8&255]<<8|S[255&v]):(v=S[(v=v<<8|v>>>24)>>>24]<<24|S[v>>>16&255]<<16|S[v>>>8&255]<<8|S[255&v],v^=R[K/j|0]<<24),J[K]=J[K-j]^v);for(var ee=this._invKeySchedule=[],A=0;A<G;A++){if(K=G-A,A%4)var v=J[K];else v=J[K-4];ee[A]=A<4||K<=4?v:t[S[v>>>24]]^n[S[v>>>16&255]]^s[S[v>>>8&255]]^u[S[255&v]]}}},encryptBlock:function(q,L){this._doCryptBlock(q,L,this._keySchedule,d,o,c,r,S)},decryptBlock:function(q,L){var j=q[L+1];q[L+1]=q[L+3],q[L+3]=j,this._doCryptBlock(q,L,this._invKeySchedule,t,n,s,u,f),j=q[L+1],q[L+1]=q[L+3],q[L+3]=j},_doCryptBlock:function(q,L,j,G,J,K,ee,A){for(var v=this._nRounds,E=q[L]^j[0],N=q[L+1]^j[1],P=q[L+2]^j[2],H=q[L+3]^j[3],V=4,W=1;W<v;W++){var B=G[E>>>24]^J[N>>>16&255]^K[P>>>8&255]^ee[255&H]^j[V++],$=G[N>>>24]^J[P>>>16&255]^K[H>>>8&255]^ee[255&E]^j[V++],X=G[P>>>24]^J[H>>>16&255]^K[E>>>8&255]^ee[255&N]^j[V++],ne=G[H>>>24]^J[E>>>16&255]^K[N>>>8&255]^ee[255&P]^j[V++];E=B,N=$,P=X,H=ne}B=(A[E>>>24]<<24|A[N>>>16&255]<<16|A[P>>>8&255]<<8|A[255&H])^j[V++],$=(A[N>>>24]<<24|A[P>>>16&255]<<16|A[H>>>8&255]<<8|A[255&E])^j[V++],X=(A[P>>>24]<<24|A[H>>>16&255]<<16|A[E>>>8&255]<<8|A[255&N])^j[V++],ne=(A[H>>>24]<<24|A[E>>>16&255]<<16|A[N>>>8&255]<<8|A[255&P])^j[V++],q[L]=B,q[L+1]=$,q[L+2]=X,q[L+3]=ne},keySize:8});return I.AES=p._createHelper(D),T.AES}(b(5),(b(93),b(11),b(23),b(96)))},function(Q,O,b){b.d(O,"a",function(){return I});var T={0:"Success.",1:"Failed.",6000001:"The incoming parameter is invalid.",6000002:"The SDK is not initialized.",6000003:"Invalid AppID.",6000004:"Trigger SDK internal frequency limit.",6000005:"Trigger background service frequency limit.",6000006:"Switch server internal error.",6000007:"ZIM service internal error.",6000010:"Failed to upload log.",6000011:"User is not exist.",6000012:"Trigger frequency limit when querying user information.",6000013:"Unsupported request.",6000014:"The ZIM service is being activated for you, please try again in five minutes.",6000015:"Exceed DAU limit.",6000016:"Exceed MAU limit.",6000101:"Login failed.",6000102:"Login failed due to background service.",6000103:"Token is invalid.",6000104:"Network error.",6000106:"Token expired.",6000107:"Token version number is wrong.",6000108:"Token duration is too short.",6000109:"Token duration is too long.",6000111:"User has already logged in.",6000121:"User is not logged in.",6000201:"Internal error sending message.",6000202:"Error sending message background service.",6000203:"Message sending failed.",6000204:"The message target does not exist.",6000211:"File is not exist.",6000212:"File server internal error.",6000213:"File type is not supported.",6000214:"File size is invalid.",6000215:"File duration is invalid.",6000221:"Failed to pass security audit.",6000222:"Security audit failed.",6000230:"Failed to pass custom security audit.",6000270:"Call invitation failed.",6000271:"Failed to cancel call invitation.",6000272:"Failed to initiate call invitation service.",6000273:"The non-initiator cancel the call invitation.",6000274:"Uninvited users.",6000275:"CallID already exists.",6000276:"CallID does not exist.",6000277:"Receipt error.",6000278:"Revoke time is exceed.",6000279:"The message has been revoked.",6000280:"The message reaction type exist.",6000281:"The user invited by the call does not exist.",6000282:"The number of message receipts exceeds the limit.",6000283:"User is already in call.",6000301:"Internal error in room.",6000302:"Error in room service.",6000303:"Failed to create room.",6000304:"Failed to join room.",6000306:"Failed to leave the room.",6000310:"Failed to query room members.",6000311:"Failed to query room members.",6000321:"The user is not in the room.",6000322:"Room does not exist.",6000323:"Room already exist.",6000324:"The maximum number of rooms can exist at the same time.",6000325:"The number of rooms a user can join at the same time has reached the upper limit.",6000330:"Internal error in room attributes.",6000331:"Failed to operate room attributes.",6000333:"Failed to query room attributes.",6000334:"The number of room attributes exceeds limit.",6000335:"The key length of room attribute exceeds limit.",6000336:"The value length of room attribute exceeds limit.",6000337:"The total value length of the room attributes exceeds limit.",6000350:"Internal error in room member attributes.",6000351:"The total length of room member attributes exceeds limit.",6000352:"The key length of room member attribute exceeds limit.",6000353:"The value length of room member attributes exceeds limit.",6000357:"The member number of room member attributes exceeds limit.",6000501:"Internal error in group.",6000502:"Error in group service.",6000503:"Failed to create group.",6000504:"Failed to dismiss group.",6000505:"Failed to join group.",6000506:"Failed to leave group.",6000507:"Failed to kick group member.",6000508:"Failed to invite user to group.",6000509:"Failed to transfer group owner.",6000510:"Failed to update group information.",6000511:"Failed to query group information.",6000512:"Failed to operate group attributes.",6000513:"Failed to query group attributes.",6000514:"Failed to update group member information.",6000515:"Failed to query group member information.",6000516:"Failed to query group list.",6000517:"Failed to query group member list.",6000521:"User is not in group.",6000522:"User is already in the group.",6000523:"Group does not exist.",6000524:"Group already exists.",6000525:"The group members have reached the limit.",6000526:"Group attribute does not exist.",6000527:"Cannot create group after dismissed.",6000531:"The number of group attributes exceeds limit.",6000532:"The key length of group attribute exceeds limit.",6000533:"The value length of group attribute exceeds limit.",6000534:"The total value length of the group attributes exceeds limit.",6000541:"There is no operation permission for group-related interfaces.",6000601:"Internal error in conversation.",6000602:"Error in conversation service.",6000603:"Conversation does not exist.",6000604:"The number of pinned conversations has reached the upper limit."},I=function(p,k,S){return k=S&&S!=6000104?(p=function(f){switch(f){case 50012:return 6000121;case 100002:case 100003:case 100004:case 50013:case 50014:case 104002:return 6000001;case 50008:case 103019:case 100017:case 103020:case 103034:case 103041:case 103042:case 103044:case 103016:case 103017:case 108050:return 6000005;case 102002:return 6000016;case 102003:return 6000015;case 100018:return 6000012;case 100021:return 6000013;case 50001:case 50002:case 50003:case 50004:case 50005:case 50007:case 50009:case 50101:case 50102:case 50105:case 50106:case 50107:case 50108:case 50110:return 6000006;case 50111:return 6000103;case 100001:case 102001:case 100005:case 100006:case 100007:case 100008:case 100009:case 100010:case 100011:case 101001:case 101002:case 101003:case 101004:return 6000007;case 105e3:case 105004:case 103033:return 6000011;case 103015:case 103001:return 6000321;case 103021:return 6000322;case 103032:return 6000323;case 103050:return 6000311;case 103018:return 6000324;case 103010:return 6000325;case 103022:return 6000334;case 103023:return 6000335;case 103024:return 6000336;case 103025:return 6000337;case 103039:return 6000352;case 103040:return 6000353;case 103038:return 6000351;case 103045:return 6000357;case 107003:return 6000271;case 107004:return 6000272;case 107005:case 61002:case 61003:return 6000276;case 107006:case 107007:return 6000272;case 107012:return 6000273;case 107014:return 6000274;case 107019:return 6000275;case 107026:return 6000281;case 111101:return 6000230;case 111003:case 111006:case 111007:return 6000221;case 111002:case 111004:case 111005:return 6000222;case 61004:return 6000272;case 109001:return 6000204;case 108054:case 106019:return 6000277;case 100039:return 6000282;case 107025:return 6000283;case 106022:return 6000604;case 100015:case 110002:case 110003:case 110005:case 110006:case 110007:case 110008:case 110009:case 110010:case 110011:case 110012:case 110013:case 110014:case 110015:return 6000212;case 110004:return 6000211;case 110016:case 110019:case 110021:case 110023:return 6000213;case 110017:case 110020:case 110022:case 110024:return 6000214;case 110018:return 6000215;case 108035:case 108051:return 6000521;case 108003:return 6000541;case 108040:return 6000531;case 108041:return 6000532;case 108042:return 6000533;case 108037:return 6000522;case 108038:case 108039:return 6000514;case 108043:return 6000524;case 108060:return 6000527;case 108044:case 106011:return 6000523;case 108046:return 6000526;case 108049:return 6000525;case 100012:return 6000278;case 100013:return 6000279;case 100022:return 6000278;case 100037:return 6000280;default:return 0}}(S)||p,"code: "+S+", message: "+(k||T[p])):k||T[p],{code:p=S==6000104?S:p,message:k}}},function(Q,O,b){Q.exports=b(5).enc.Hex},function(Q,O,b){Q.exports=b(5).enc.Utf8},function(Q,O,b){b.d(O,"a",function(){return I}),b.d(O,"b",function(){return c});var T=b(20),I=(p.prototype.toString=function(i){if(this.s<0)return"-"+this.negate().toString(i);var l;if(i==16)l=4;else if(i==8)l=3;else if(i==2)l=1;else if(i==32)l=5;else{if(i!=4)return this.toRadix(i);l=2}var h,m=(1<<l)-1,g=!1,y="",w=this.t,M=this.DB-w*this.DB%l;if(0<w--)for(M<this.DB&&0<(h=this[w]>>M)&&(g=!0,y=Object(T.a)(h));0<=w;)M<l?(h=(this[w]&(1<<M)-1)<<l-M,h|=this[--w]>>(M+=this.DB-l)):(h=this[w]>>(M-=l)&m,M<=0&&(M+=this.DB,--w)),(g=0<h||g)&&(y+=Object(T.a)(h));return g?y:"0"},p.prototype.negate=function(){var i=o();return p.ZERO.subTo(this,i),i},p.prototype.abs=function(){return this.s<0?this.negate():this},p.prototype.compareTo=function(i){var l=this.s-i.s;if(l!=0)return l;var h=this.t;if((l=h-i.t)!=0)return this.s<0?-l:l;for(;0<=--h;)if((l=this[h]-i[h])!=0)return l;return 0},p.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+a(this[this.t-1]^this.s&this.DM)},p.prototype.mod=function(i){var l=o();return this.abs().divRemTo(i,null,l),this.s<0&&0<l.compareTo(p.ZERO)&&i.subTo(l,l),l},p.prototype.modPowInt=function(i,l){return l=new(i<256||l.isEven()?k:f)(l),this.exp(i,l)},p.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},p.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},p.prototype.copyTo=function(i){for(var l=this.t-1;0<=l;--l)i[l]=this[l];i.t=this.t,i.s=this.s},p.prototype.fromInt=function(i){this.t=1,this.s=i<0?-1:0,0<i?this[0]=i:i<-1?this[0]=i+this.DV:this.t=0},p.prototype.fromString=function(i,l){var h;if(l==16)h=4;else if(l==8)h=3;else if(l==256)h=8;else if(l==2)h=1;else if(l==32)h=5;else{if(l!=4)return void this.fromRadix(i,l);h=2}this.t=0,this.s=0;for(var m=i.length,g=!1,y=0;0<=--m;){var w=h==8?255&+i[m]:s(i,m);w<0?i.charAt(m)=="-"&&(g=!0):(g=!1,y==0?this[this.t++]=w:y+h>this.DB?(this[this.t-1]|=(w&(1<<this.DB-y)-1)<<y,this[this.t++]=w>>this.DB-y):this[this.t-1]|=w<<y,(y+=h)>=this.DB&&(y-=this.DB))}h==8&&128&+i[0]&&(this.s=-1,0<y&&(this[this.t-1]|=(1<<this.DB-y)-1<<y)),this.clamp(),g&&p.ZERO.subTo(this,this)},p.prototype.clamp=function(){for(var i=this.s&this.DM;0<this.t&&this[this.t-1]==i;)--this.t},p.prototype.dlShiftTo=function(i,l){for(var h=this.t-1;0<=h;--h)l[h+i]=this[h];for(h=i-1;0<=h;--h)l[h]=0;l.t=this.t+i,l.s=this.s},p.prototype.drShiftTo=function(i,l){for(var h=i;h<this.t;++h)l[h-i]=this[h];l.t=Math.max(this.t-i,0),l.s=this.s},p.prototype.lShiftTo=function(i,l){for(var h=i%this.DB,m=this.DB-h,g=(1<<m)-1,y=Math.floor(i/this.DB),w=this.s<<h&this.DM,M=this.t-1;0<=M;--M)l[M+y+1]=this[M]>>m|w,w=(this[M]&g)<<h;for(M=y-1;0<=M;--M)l[M]=0;l[y]=w,l.t=this.t+y+1,l.s=this.s,l.clamp()},p.prototype.rShiftTo=function(i,l){l.s=this.s;var h=Math.floor(i/this.DB);if(h>=this.t)l.t=0;else{var m=i%this.DB,g=this.DB-m,y=(1<<m)-1;l[0]=this[h]>>m;for(var w=h+1;w<this.t;++w)l[w-h-1]|=(this[w]&y)<<g,l[w-h]=this[w]>>m;0<m&&(l[this.t-h-1]|=(this.s&y)<<g),l.t=this.t-h,l.clamp()}},p.prototype.subTo=function(i,l){for(var h=0,m=0,g=Math.min(i.t,this.t);h<g;)m+=this[h]-i[h],l[h++]=m&this.DM,m>>=this.DB;if(i.t<this.t){for(m-=i.s;h<this.t;)m+=this[h],l[h++]=m&this.DM,m>>=this.DB;m+=this.s}else{for(m+=this.s;h<i.t;)m-=i[h],l[h++]=m&this.DM,m>>=this.DB;m-=i.s}l.s=m<0?-1:0,m<-1?l[h++]=this.DV+m:0<m&&(l[h++]=m),l.t=h,l.clamp()},p.prototype.multiplyTo=function(i,l){var h=this.abs(),m=i.abs(),g=h.t;for(l.t=g+m.t;0<=--g;)l[g]=0;for(g=0;g<m.t;++g)l[g+h.t]=h.am(0,m[g],l,g,0,h.t);l.s=0,l.clamp(),this.s!=i.s&&p.ZERO.subTo(l,l)},p.prototype.squareTo=function(i){for(var l=this.abs(),h=i.t=2*l.t;0<=--h;)i[h]=0;for(h=0;h<l.t-1;++h){var m=l.am(h,l[h],i,2*h,0,1);(i[h+l.t]+=l.am(h+1,2*l[h],i,2*h+1,m,l.t-h-1))>=l.DV&&(i[h+l.t]-=l.DV,i[h+l.t+1]=1)}0<i.t&&(i[i.t-1]+=l.am(h,l[h],i,2*h,0,1)),i.s=0,i.clamp()},p.prototype.divRemTo=function(i,l,h){if(!((D=i.abs()).t<=0)){var m=this.abs();if(m.t<D.t)return l!=null&&l.fromInt(0),void(h!=null&&this.copyTo(h));h==null&&(h=o());var g=o(),y=this.s,w=(i=i.s,this.DB-a(D[D.t-1])),M=(0<w?(D.lShiftTo(w,g),m.lShiftTo(w,h)):(D.copyTo(g),m.copyTo(h)),g.t),R=g[M-1];if(R!=0){var D=R*(1<<this.F1)+(1<M?g[M-2]>>this.F2:0),q=this.FV/D,L=(1<<this.F1)/D,j=1<<this.F2,G=h.t,J=G-M,K=l==null?o():l;for(g.dlShiftTo(J,K),0<=h.compareTo(K)&&(h[h.t++]=1,h.subTo(K,h)),p.ONE.dlShiftTo(M,K),K.subTo(g,g);g.t<M;)g[g.t++]=0;for(;0<=--J;){var ee=h[--G]==R?this.DM:Math.floor(h[G]*q+(h[G-1]+j)*L);if((h[G]+=g.am(0,ee,h,J,0,M))<ee)for(g.dlShiftTo(J,K),h.subTo(K,h);h[G]<--ee;)h.subTo(K,h)}l!=null&&(h.drShiftTo(M,l),y!=i&&p.ZERO.subTo(l,l)),h.t=M,h.clamp(),0<w&&h.rShiftTo(w,h),y<0&&p.ZERO.subTo(h,h)}}},p.prototype.invDigit=function(){if(this.t<1)return 0;var i=this[0];if(!(1&i))return 0;var l=3&i;return 0<(l=(l=(l=(l=l*(2-(15&i)*l)&15)*(2-(255&i)*l)&255)*(2-((65535&i)*l&65535))&65535)*(2-i*l%this.DV)%this.DV)?this.DV-l:-l},p.prototype.isEven=function(){return(0<this.t?1&this[0]:this.s)==0},p.prototype.exp=function(i,l){if(4294967295<i||i<1)return p.ONE;var h,m=o(),g=o(),y=l.convert(this),w=a(i)-1;for(y.copyTo(m);0<=--w;)l.sqrTo(m,g),0<(i&1<<w)?l.mulTo(g,y,m):(h=m,m=g,g=h);return l.revert(m)},p.prototype.chunkSize=function(i){return Math.floor(Math.LN2*this.DB/Math.log(i))},p.prototype.toRadix=function(i){if(i==null&&(i=10),this.signum()==0||i<2||36<i)return"0";var l=this.chunkSize(i),h=Math.pow(i,l),m=u(h),g=o(),y=o(),w="";for(this.divRemTo(m,g,y);0<g.signum();)w=(h+y.intValue()).toString(i).substr(1)+w,g.divRemTo(m,g,y);return y.intValue().toString(i)+w},p.prototype.fromRadix=function(i,l){this.fromInt(0);for(var h=this.chunkSize(l=l==null?10:l),m=Math.pow(l,h),g=!1,y=0,w=0,M=0;M<i.length;++M){var R=s(i,M);R<0?i.charAt(M)=="-"&&this.signum()==0&&(g=!0):(w=l*w+R,++y>=h&&(this.dMultiply(m),this.dAddOffset(w,0),w=y=0))}0<y&&(this.dMultiply(Math.pow(l,y)),this.dAddOffset(w,0)),g&&p.ZERO.subTo(this,this)},p.prototype.dMultiply=function(i){this[this.t]=this.am(0,i-1,this,0,0,this.t),++this.t,this.clamp()},p.prototype.dAddOffset=function(i,l){if(i!=0){for(;this.t<=l;)this[this.t++]=0;for(this[l]+=i;this[l]>=this.DV;)this[l]-=this.DV,++l>=this.t&&(this[this.t++]=0),++this[l]}},p);function p(i,l){i!=null&&(l==null&&typeof i!="string"?this.fromString(i,256):this.fromString(i,l))}S.prototype.convert=function(i){return i.s<0||0<=i.compareTo(this.m)?i.mod(this.m):i},S.prototype.revert=function(i){return i},S.prototype.reduce=function(i){i.divRemTo(this.m,null,i)},S.prototype.mulTo=function(i,l,h){i.multiplyTo(l,h),this.reduce(h)},S.prototype.sqrTo=function(i,l){i.squareTo(l),this.reduce(l)};var k=S;function S(i){this.m=i}d.prototype.convert=function(i){var l=o();return i.abs().dlShiftTo(this.m.t,l),l.divRemTo(this.m,null,l),i.s<0&&0<l.compareTo(I.ZERO)&&this.m.subTo(l,l),l},d.prototype.revert=function(i){var l=o();return i.copyTo(l),this.reduce(l),l},d.prototype.reduce=function(i){for(;i.t<=this.mt2;)i[i.t++]=0;for(var l=0;l<this.m.t;++l){var h=32767&i[l],m=h*this.mpl+((h*this.mph+(i[l]>>15)*this.mpl&this.um)<<15)&i.DM;for(i[h=l+this.m.t]+=this.m.am(0,m,i,l,0,this.m.t);i[h]>=i.DV;)i[h]-=i.DV,i[++h]++}i.clamp(),i.drShiftTo(this.m.t,i),0<=i.compareTo(this.m)&&i.subTo(this.m,i)},d.prototype.mulTo=function(i,l,h){i.multiplyTo(l,h),this.reduce(h)},d.prototype.sqrTo=function(i,l){i.squareTo(l),this.reduce(l)};var f=d;function d(i){this.m=i,this.mp=i.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<i.DB-15)-1,this.mt2=2*i.t}function o(){return new I(null)}function c(i,l){return new I(i,l)}b=(O=typeof navigator<"u")&&navigator.appName=="Microsoft Internet Explorer"?(I.prototype.am=function(i,l,h,m,g,y){for(var w=32767&l,M=l>>15;0<=--y;){var R=32767&this[i],D=this[i++]>>15,q=M*R+D*w;g=((R=w*R+((32767&q)<<15)+h[m]+(1073741823&g))>>>30)+(q>>>15)+M*D+(g>>>30),h[m++]=1073741823&R}return g},30):O&&navigator.appName!="Netscape"?(I.prototype.am=function(i,l,h,m,g,y){for(;0<=--y;){var w=l*this[i++]+h[m]+g;g=Math.floor(w/67108864),h[m++]=67108863&w}return g},26):(I.prototype.am=function(i,l,h,m,g,y){for(var w=16383&l,M=l>>14;0<=--y;){var R=16383&this[i],D=this[i++]>>14,q=M*R+D*w;g=((R=w*R+((16383&q)<<14)+h[m]+g)>>28)+(q>>14)+M*D,h[m++]=268435455&R}return g},28);for(var r=(I.prototype.DB=b,I.prototype.DM=(1<<b)-1,I.prototype.DV=1<<b,I.prototype.FV=Math.pow(2,52),I.prototype.F1=52-b,I.prototype.F2=2*b-52,[]),t="0".charCodeAt(0),n=0;n<=9;++n)r[t++]=n;for(t="a".charCodeAt(0),n=10;n<36;++n)r[t++]=n;for(t="A".charCodeAt(0),n=10;n<36;++n)r[t++]=n;function s(i,l){return(i=r[i.charCodeAt(l)])==null?-1:i}function u(i){var l=o();return l.fromInt(i),l}function a(i){var l,h=1;return(l=i>>>16)!=0&&(i=l,h+=16),(l=i>>8)!=0&&(i=l,h+=8),(l=i>>4)!=0&&(i=l,h+=4),(l=i>>2)!=0&&(i=l,h+=2),(l=i>>1)!=0&&(i=l,h+=1),h}I.ZERO=u(0),I.ONE=u(1)},function(Q,O,b){b.d(O,"a",function(){return f});var T=b(2),I=b(1),p=b(0),k=function(){return(k=Object.assign||function(o){for(var c,r=1,t=arguments.length;r<t;r++)for(var n in c=arguments[r])Object.prototype.hasOwnProperty.call(c,n)&&(o[n]=c[n]);return o}).apply(this,arguments)},S=p.J.Group,f=(d.prototype.destroy=function(){this.connMgr=null,this.eventBus=null,this.logger=null,this.settings=null,this.engineConfig=null,this.dbMgr=null,this.dbGroupMemberMap=null},d.prototype.setDBGroup=function(o,c){var r=this;this.dbGroup=o,this.groupName=o.groupName,this.groupAvatarUrl=o.groupAvatarUrl,c&&this.dbMgr.getGroupMemberList(this.groupID).then(function(t){r.tatalMemberCount=o.tatalMemberCount||t.length,t.forEach(function(n){return r.dbGroupMemberMap.set(n.userID,n)})})},d.prototype.createGroup=function(o,c,r){var t=this,n={time:new Date,groupInfo:o,config:r,userIDs:c},s=[],u=(Array.isArray(c)&&(c=c.filter(function(l){return!!Object(I.l)(l)||(s.push({userID:l,reason:6000001}),!1)}),c=Array.from(new Set(c))),r.groupAttributes),a=Object.keys(u).map(function(l){return{key:l,value:u[l],seq:1}}),i={group_name:o.groupName||"",group_notice:r.groupNotice||"",group_avatar:Object(I.i)(o.groupAvatarUrl||""),user_ids:c,attributes:a};return o.groupID&&(i.group_id=o.groupID),this.connMgr.sendRequest(p.c.group_create,i).then(function(l){if(l.code)return h=Object(I.s)(p.s.GroupModuleCreateGroupError,l.message,l.code),n.error=h,t.logger.warn(S,p.I.CreateGroup,n),Promise.reject(h);t.groupID=l.group_id,t.dbGroup.groupID=t.groupID,t.tatalMemberCount=l.member_count,t.groupMember.memberRole=p.E.Owner,l.attributes={attributes:a,seq:l.group_attribute_seq},l.group_name=o.groupName,l.group_avatar=i.group_avatar,l.group_notice=r.groupNotice,l.error_users.forEach(function(m){return s.push(t.createErrorUser(m))});var h=t.createGroupCallback(l);return t.logger.info(S,p.I.CreateGroup,n),{groupInfo:t.createGroupFullInfo(),userList:h,errorUserList:s}})},d.prototype.joinGroup=function(){var o=this,c={time:new Date,groupID:this.groupID},r={group_id:this.groupID};return this.connMgr.sendRequest(p.c.group_enter,r).then(function(t){var n;return t.code?(n=Object(I.s)(p.s.GroupModuleJoinGroupError,t.message,t.code),c.error=n,o.logger.warn(S,p.I.JoinGroup,c),Promise.reject(n)):(o.tatalMemberCount=t.member_count,o.groupMember.memberRole=p.E.Member,t.member.member_data.user_avatar||(t.member.member_data.user_avatar=o.engineConfig.user.userAvatarUrl),t.op_user=k(k({},t.member.member_data),{user_id:t.member.user_id}),t.members=[t.member],o.joinGroupCallback(t,p.C.Joined,p.A.Joined),o.logger.info(S,p.I.JoinGroup,c),{groupInfo:o.createGroupFullInfo(),seq:t.conv_msg_seq})})},d.prototype.inviteUsersIntoGroup=function(o){var c=this,r={time:new Date,groupID:this.groupID,userIDs:o},t=[];return o=o.filter(function(n){return!!Object(I.l)(n)||(t.push({userID:n,reason:6000001}),!1)}),o=Array.from(new Set(o)),o={group_id:this.groupID,user_ids:o},this.connMgr.sendRequest(p.c.group_invite,o).then(function(n){if(n.code)return s=Object(I.s)(p.s.GroupModuleInviteUserIntoGroupError,n.message,n.code),r.error=s,c.logger.warn(S,p.I.InviteUsersIntoGroup,r),Promise.reject(s);c.tatalMemberCount=n.member_count;var s=c.inviteUsersIntoGroupCallback(n);return n.error_users.forEach(function(u){return t.push(c.createErrorUser(u))}),c.eventBus.emit(p.t.GroupMemberState,{groupID:c.groupID,state:p.F.Enter,event:p.C.Invited,operatedInfo:c.createOwnerOperator(),userList:s}),c.logger.info(S,p.I.InviteUsersIntoGroup,r),{groupID:c.groupID,userList:s,errorUserList:t}})},d.prototype.kickGroupMembers=function(o){var c=this,r={time:new Date,groupID:this.groupID,userIDs:o},t=[],n=(o=o.filter(function(s){return!!Object(I.l)(s)||(t.push({userID:s,reason:6000001}),!1)}),o=Array.from(new Set(o)),{group_id:this.groupID,user_ids:o});return this.connMgr.sendRequest(p.c.group_kickout,n).then(function(s){var u;if(s.code)return u=Object(I.s)(p.s.GroupModuleKickoutGroupMemberError,s.message,s.code),r.error=u,c.logger.warn(S,p.I.KickGroupMembers,r),Promise.reject(u);c.tatalMemberCount=s.member_count;var a=[];return o.forEach(function(i){var l;s.error_users.some(function(h){return h.user_id===i})||(l=c.dbGroupMemberMap.get(i),a.push(k(k({},l),{userID:i})),c.dbGroupMemberMap.delete(i))}),o=a.map(function(i){return i.userID}),s.error_users.forEach(function(i){return t.push(c.createErrorUser(i))}),c.updateMemberSeq(s.member_all_seq),c.dbMgr.deleteGroupMemberList(c.groupID,o),c.eventBus.emit(p.t.GroupMemberState,{groupID:c.groupID,state:p.F.Quit,event:p.C.KickedOut,operatedInfo:c.createOwnerOperator(),userList:a}),c.logger.info(S,p.I.KickGroupMembers,r),{groupID:c.groupID,kickedUserIDs:o,errorUserList:t}})},d.prototype.transferGroupOwner=function(o){var c=this,r={time:new Date,groupID:this.groupID,userID:o},t={group_id:this.groupID,group_name:o};return this.connMgr.sendRequest(p.c.group_owner_transfer,t).then(function(n){var s;return n.code?(s=Object(I.s)(p.s.GroupModuleTransferOwnerError,n.message,n.code),r.error=s,c.logger.warn(S,p.I.TransferGroupOwner,r),Promise.reject(s)):(c.groupMember.memberRole=p.E.Member,c.transferGroupOwnerCallback([{userID:o,dataSeq:+n.conv_msg_seq.toString()},{userID:c.groupMember.userID,dataSeq:+n.conv_list_seq.toString()}]),c.logger.info(S,p.I.TransferGroupOwner,r),{groupID:c.groupID,toUserID:o})})},d.prototype.updateGroupInfo=function(o,c){var r=this,t={time:new Date,value:o},n=c==p.z.Name?p.c.group_modify_name:p.c.group_modify_notice,s=c==p.z.Name?p.I.UpdateGroupName:p.I.UpdateGroupNotice,u={group_id:this.groupID,group_name:o};return this.connMgr.sendRequest(n,u).then(function(a){var i;return a.code?(i=Object(I.s)(p.s.GroupModuleUpdateGroupInfoError,a.message,a.code),t.error=i,r.logger.warn(S,s,t),Promise.reject(i)):(r.mergeGroupData(c,+a.conv_list_seq.toString(),o,r.createOwnerOperator()),r.logger.info(S,s,t),c==p.z.Name?{groupID:r.groupID,groupName:o}:{groupID:r.groupID,groupNotice:o})})},d.prototype.updateGroupAvatarUrl=function(o){var c=this,r={time:new Date,value:o},t={user_id:this.groupID,user_name:Object(I.i)(o)};return this.connMgr.sendRequest(p.c.group_modify_avatar,t).then(function(n){var s;return n.code?(s=Object(I.s)(p.s.GroupModuleUpdateGroupInfoError,n.message,n.code),r.error=s,c.logger.warn(S,p.I.UpdateGroupAvatarUrl,r),Promise.reject(s)):(c.mergeGroupData(p.z.Avatar,+n.conv_list_seq.toString(),o,c.createOwnerOperator()),c.logger.info(S,p.I.UpdateGroupAvatarUrl,r),{groupID:c.groupID,groupAvatarUrl:o})})},d.prototype.queryGroupInfo=function(){var o=this,c={time:new Date,groupID:this.groupID},r={group_id:this.groupID};return this.connMgr.sendRequest(p.c.group_data,r).then(function(t){var n,s=t.code;return s&&s!=6000104?(n=Object(I.s)(p.s.GroupModuleQueryGroupInfoError,t.message,s),c.error=n,o.logger.warn(S,p.I.QueryGroupInfo,c),Promise.reject(n)):(s!=6000104&&(o.syncGroupInfo(t.group_name,Object(I.f)(t.group_avatar)),o.dbGroup.groupNotice=t.group_notice,t.group_data_seq&&(o.dbGroup.dataSeq=t.group_data_seq),o.dbMgr.addGroupList([o.dbGroup])),o.logger.info(S,p.I.QueryGroupInfo,c),{groupInfo:o.createGroupFullInfo()})})},d.prototype.updateGroupAttributes=function(o){var c,r=this,t={time:new Date,groupID:this.groupID,params:o},n=[],s=p.x.Set,u=Array.isArray(o)?(s=p.x.Delete,c=p.I.DeleteGroupAttributes,o=o.filter(function(a){return!!Object(I.l)(a)||(n.push(a),!1)}),(o=Array.from(new Set(o))).map(function(a){return{key:a,value:""}})):(c=p.I.SetGroupAttributes,Object.keys(o).map(function(a){return{key:a,value:o[a]}}));return u={group_id:this.groupID,attributes:{action:s,attributes:u}},this.connMgr.sendRequest(p.c.group_modify_attributes,u).then(function(a){var i;return a.code?(i=Object(I.s)(p.s.GroupModuleGroupAttributesOperationFailed,a.message,a.code),t.error=i,r.logger.warn(S,c,t),Promise.reject(i)):(r.mergeGroupAttributes(s,a.attributes,r.createOwnerOperator()),a.fail_keys.forEach(function(l){return n.push(l.key)}),r.logger.info(S,c,t),{groupID:r.groupID,errorKeys:n})})},d.prototype.queryGroupAttributes=function(o){var c=this,r={time:new Date,groupID:this.groupID,keys:o},t=this.dbGroup.attributes||{},n=(o||Object.keys(t)).map(function(s){return{key:s,seq:((s=t[s])==null?void 0:s.seq)||1}});return n={group_id:this.groupID,attributes:{seq:this.dbGroup.attributeSeq||0,attributes:n}},this.connMgr.sendRequest(p.c.group_attributes,n).then(function(s){var u,a=s.code;return a&&a!=6000104?(u=Object(I.s)(p.s.GroupModuleGroupAttributesQueryFailed,s.message,a),r.error=u,c.logger.warn(S,p.I.QueryGroupAttributes,r),Promise.reject(u)):(a!=6000104&&c.mergeGroupAttributes(p.x.Query,s.attributes),c.logger.info(S,p.I.QueryGroupAttributes,r),{groupID:c.groupID,groupAttributes:c.createGroupAttributes(o)})})},d.prototype.setGroupMemberInfo=function(o,c,r){var t=this,n={time:new Date,userID:o,value:c},s=r==p.D.Nickname?p.c.group_member_nickname_set:p.c.group_member_role_set,u=r==p.D.Nickname?p.I.SetGroupMemberNickname:p.I.SetGroupMemberRole,a={group_id:this.groupID};return r==p.D.Nickname?(a.group_name=o,a.group_notice=c):(a.user_id=o,a.role=c),this.connMgr.sendRequest(s,a).then(function(i){var l;return i.code?(l=Object(I.s)(p.s.GroupModuleUpdateGroupMemberInfoError,i.message,i.code),n.error=l,t.logger.warn(S,u,n),Promise.reject(l)):(t.mergeGroupMemberInfo(r,+i.conv_list_seq.toString(),c,o),t.logger.info(S,u,n),r==p.D.Nickname?{groupID:t.groupID,forUserID:o,nickname:c}:{groupID:t.groupID,forUserID:o,role:c})})},d.prototype.queryGroupMemberInfo=function(o){var c=this,r={time:new Date,groupID:this.groupID,userID:o},t={group_id:this.groupID,user_id:o};return this.connMgr.sendRequest(p.c.group_member_data,t).then(function(n){var s=n.code;if(s&&s!=6000104)return u=Object(I.s)(p.s.GroupModuleQueryGroupMemberInfoError,n.message,s),r.error=u,c.logger.warn(S,p.I.QueryGroupMemberInfo,r),Promise.reject(u);var u=c.dbGroupMemberMap.get(o)||{userID:o};return s!=6000104&&(u=c.createDBMember(n.member),c.dbMgr.addGroupMemberList(c.groupID,[u])),c.logger.info(S,p.I.QueryGroupMemberInfo,r),{groupID:c.groupID,userInfo:u}})},d.prototype.queryGroupMemberList=function(o){var c=this;return new Promise(function(r,t){var n={time:new Date,groupID:c.groupID,config:o};c.isFullMembers?c.queryGroupMembersCallback(o,null,n,r,t):c.mergeServerMemberList(p.u.Biz,"apicall",function(s){c.queryGroupMembersCallback(o,s,n,r,t)})})},d.prototype.queryGroupMemberCount=function(){var o={groupID:this.groupID,count:this.tatalMemberCount};return this.logger.info(S,p.I.QueryGroupMemberCount,o),Promise.resolve(o)},d.prototype.queryReceiptMemberList=function(o,c,r,t){var n=this;return new Promise(function(s){function u(){for(var R={},D=(n.dbGroupMemberMap.forEach(function(G){return R[G.seq]=G}),Object.keys(c.memberSeqs).filter(function(G){return(t?c.memberSeqs[G]:c.memberSeqs[G]===0)&&!R[G]})),q=[],L=0;L<D.length;L+=100){var j=n.connMgr.sendRequest(p.c.group_members_by_seq,{conv_id:n.groupID,conv_msg_seq:D.slice(L,L+100)},p.i.SDK);q.push(j)}Promise.all(q).then(function(G){var J=[];G.forEach(function(K){(K=K.members)&&K.length&&K.forEach(function(ee){ee=n.createDBMember(ee),R[ee.seq]=ee,J.push(ee)})}),n.dbMgr.addGroupMemberList(n.groupID,J)}).then(function(){var G=0,J=[],K=(Object.keys(c.memberSeqs).forEach(function(W){var B;(t?c.memberSeqs[W]:c.memberSeqs[W]===0)&&(G++,(B=R[W])?J.push(B):h.push(W))}),J.sort(function(W,B){return W.seq-B.seq}),J.length),ee=((ee=J[J.length-1])==null?void 0:ee.seq)||0,A=r.nextFlag||0,v=0,E=(0<A&&A<ee?v=J.findIndex(function(W){return W.seq==A})+1:ee<=A&&ee&&(v=J.length),v+r.count),N=(J=J.slice(v,E)).length,P=((P=J[N-1])==null?void 0:P.seq)||0,H=J.map(function(W){return Object(I.q)(n.memberKeys,W)}),V=N==K||ee==P?0:P;m.flag=h.join(),Object.assign(m,{start:v,end:E,next:P,max:ee,total:K,totalSeq:G,count:N,nextFlag:V}),n.logger.info(S,l,m),s({groupID:n.groupID,nextFlag:V,userList:H})})}var a=c.receiptMemberListSeq||0,i=o.conversationSeq,l=t?p.I.QueryReceiptReadMemberList:p.I.QueryReceiptUnreadMemberList,h=[],m={time:new Date,groupID:n.groupID,msgSeq:i,dbSeq:a,config:r,flag:""};if(a&&c.receiptStatus!=p.M.Processing)return u();var g=1,y=0,w=0,M=++n.mergeListSeqs.receiptDetail+n.groupID;n.fetchServerPageReceiptDetail(a,g,i).then(function R(D){var q=D.code&&D.code!=6000104?0:D.next_list_seq;q&&(c.receiptMemberListSeq=q),D.read_members&&(y+=D.read_members.length,D.read_members.forEach(function(L){return c.memberSeqs[L.toString()]=1})),D.unread_members&&(w+=D.unread_members.length,D.unread_members.forEach(function(L){return c.memberSeqs[L.toString()]=0})),c.readMemberCount=D.read_count||0,c.unreadMemberCount=D.unread_count||0,!D.fetch_end&&q&&n.engineConfig.token?n.fetchServerPageReceiptDetail(q,++g,i).then(R):(D.degree=g,D.read_members_len=y,D.unread_members_len=w,q=p.c.msg_read_receipt_detail.cmd,m.dataReport=n.dataReport.endNetworkRequest(q,M,D),n.dbMgr.addMessageExtraList([c],"receiptinfo"),u())})})},d.prototype.onPushGroupCreate=function(o){this.tatalMemberCount=o.member_count,this.createGroupCallback(o)},d.prototype.onPushGroupJoin=function(o,c,r){this.tatalMemberCount=o.member_count,this.groupMember.memberRole=p.E.Member,o.members=[{user_id:this.engineConfig.user.userID,member_data:{user_name:this.engineConfig.user.userName,user_avatar:this.engineConfig.user.userAvatarUrl,role:p.E.Member}}],this.joinGroupCallback(o,c,r)},d.prototype.onPushGroupDataModify=function(o){var c,r=this.dbGroup.dataSeq||0,t=o.group_data_seq;t&&r<=t?(c=o.modify_type==2?Object(I.f)(o.group_avatar):o.modify_type==1?o.group_name:o.group_notice,this.mergeGroupData(o.modify_type||0,t,c,this.createOperator(o.op_user))):this.logger.info(S,p.I.PCMD,{dbSeq:r,svrSeq:t,type:o.modify_type})},d.prototype.onPushGroupAttributesModify=function(o){var c=this.dbGroup.attributeSeq||0,r=o.attributes.seq;r&&c<=r?this.mergeGroupAttributes(p.x.Push,o.attributes,this.createOperator(o.op_user)):this.logger.info(S,p.I.PCMD,{dbSeq:c,svrSeq:r})},d.prototype.onPushGroupOwnerTransfer=function(o){o.user_id==this.groupMember.userID&&(this.groupMember.memberRole=p.E.Owner),this.transferGroupOwnerCallback([{userID:o.user_id},{userID:o.op_user.user_id}]),this.updateMemberSeq(o.member_all_seq)},d.prototype.onPushGroupMemberChange=function(o){var c=this,r=(this.tatalMemberCount=o.member_count,this.dbGroup.memberSeq||0),t=o.member_all_seq;if(!t||t<r)this.logger.info(S,p.I.PCMD,{dbSeq:r,svrSeq:t});else switch(o.new_owner_id==this.groupMember.userID&&(this.groupMember.memberRole=p.E.Owner),o.change_type){case p.B.Enter:this.joinGroupCallback(o,p.C.Joined);break;case p.B.Invited:this.eventBus.emit(p.t.GroupMemberState,{groupID:this.groupID,state:p.F.Enter,event:p.C.Invited,operatedInfo:this.createOperator(o.op_user),userList:this.inviteUsersIntoGroupCallback(o)});break;case p.B.Quit:case p.B.Kickout:case p.B.OwnerQuit:var n=this.createOperator(o.op_user);this.eventBus.emit(p.t.GroupMemberState,{groupID:this.groupID,state:p.F.Quit,event:o.change_type===p.B.Kickout?p.C.KickedOut:p.C.Left,operatedInfo:n,userList:this.kickGroupMemberCallback(o)}),o.change_type==p.B.OwnerQuit&&this.groupOwnerQuitCallback(o.new_owner_id,n);break;case p.B.Modify:n=o.members.map(function(s){return(s=c.createDBMember(s)).userID==c.groupMember.userID&&(s.memberNickname&&(c.groupMember.memberNickname=s.memberNickname),s.memberRole&&(c.groupMember.memberRole=s.memberRole)),s}),this.dbMgr.addGroupMemberList(this.groupID,n),this.eventBus.emit(p.t.GroupMemberInfo,{groupID:this.groupID,operatedInfo:this.createOperator(o.op_user),userList:n})}},d.prototype.onDisConnected=function(){this.isFullMembers=!1},d.prototype.onUpdateSelf=function(){this.groupMember.userName=this.engineConfig.user.userName,this.groupMember.memberAvatarUrl=this.engineConfig.user.userAvatarUrl;var o=this.dbGroupMemberMap.get(this.engineConfig.user.userID);o&&(o.userName=this.engineConfig.user.userName,o.memberAvatarUrl=this.engineConfig.user.userAvatarUrl,this.dbMgr.addGroupMemberList(this.groupID,[o]))},d.prototype.createGroupFullInfo=function(){return{baseInfo:{groupID:this.dbGroup.groupID,groupName:this.dbGroup.groupName,groupAvatarUrl:this.dbGroup.groupAvatarUrl},groupNotice:this.dbGroup.groupNotice,notificationStatus:this.dbGroup.notificationStatus,groupAttributes:this.createGroupAttributes()}},d.prototype.createOwnerOperator=function(){return k(k({},this.groupMember),{operatedUserInfo:this.groupMember})},d.prototype.createOperator=function(o){var c=o.user_id,r=o.user_name,t=o.group_nick_name;return o=o.role,c=Object(I.q)(this.memberKeys,this.dbGroupMemberMap.get(c)||{userID:c,userName:""}),r&&(c.userName=typeof r=="string"?r:Object(I.f)(r)),c.memberNickname=t||"",c.memberRole=o||p.E.Member,k(k({},c),{operatedUserInfo:c})},d.prototype.createDBMember=function(o,c){var r=o.user_id,t=this.dbGroupMemberMap.get(r)||{userID:r},n=(i=o.member_data).user_name,s=i.user_avatar,u=i.group_nick_name,a=i.role,i=i.member_data_seq;return!(n=(n&&(t.userName=n),s&&s.length&&(t.memberAvatarUrl=Object(I.f)(s)),u&&(t.memberNickname=u),a&&(t.memberRole=a),i&&(t.dataSeq=i),o.member_seq))&&t.seq||(t.seq=n),c?this.dbGroupMemberMap.delete(r):this.dbGroupMemberMap.set(r,t),t},d.prototype.createErrorUser=function(o){return{userID:o.user_id,reason:o.sub_code}},d.prototype.createGroupAttributes=function(o){var c=this;if(!this.dbGroup.attributes)return this.dbGroup.attributes={},{};var r={};return(o=o||Object.keys(this.dbGroup.attributes)).forEach(function(t){var n=c.dbGroup.attributes[t];n&&!n.state&&(r[t]=n.value)}),r},d.prototype.createDBGroupAttributes=function(o){return(o||[]).reduce(function(c,r){return c[r.key]=r,c},{})},d.prototype.mergeMemberList=function(o,c,r){var t,n=this,s=[],u=(c&&(t=this.engineConfig.user.userID,c=this.dbGroupMemberMap.get(t),Array.from(this.dbGroupMemberMap.keys()).forEach(function(m){m!=t&&s.push(m)}),this.dbGroupMemberMap.clear(),c&&this.dbGroupMemberMap.set(c.userID,c)),"");if(o.forEach(function(m){var g=m.event_type;m=m.member,g&&g!==p.B.Enter&&g!==p.B.Modify&&g!==p.B.Invited?g!==p.B.Quit&&g!==p.B.Kickout&&g!==p.B.OwnerQuit||(s.push(m.user_id),n.dbGroupMemberMap.delete(m.user_id)):(g=n.createDBMember(m)).memberRole==p.E.Owner&&(u=g.userID)}),u&&this.dbGroupMemberMap.forEach(function(m){m.memberRole==p.E.Owner&&m.userID!=u&&(m.memberRole=p.E.Member)}),this.tatalMemberCount>=this.dbGroupMemberMap.size)return this.dbMgr.deleteGroupMemberList(this.groupID,s),this.dbMgr.addGroupMemberList(this.groupID,Array.from(this.dbGroupMemberMap.values())),r&&r();for(var a=Array.from(this.dbGroupMemberMap.values()).filter(function(m){return m.seq}),i=[],l=0;l<a.length;l+=100){var h=this.connMgr.sendRequest(p.c.group_members_by_seq,{conv_id:this.groupID,conv_msg_seq:a.slice(l,l+100).map(function(m){return m.seq})},p.i.SDK);i.push(h)}Promise.all(i).then(function(m){m.forEach(function(g,y){if(!g.code&&g.members)for(var w=g.members.map(function(D){return D.user_id}),M=100*y;M<100*y+100&&M<a.length;M++){var R=a[M].userID;w.indexOf(R)==-1&&(s.push(R),n.dbGroupMemberMap.delete(R))}}),n.dbMgr.deleteGroupMemberList(n.groupID,s),n.dbMgr.addGroupMemberList(n.groupID,Array.from(n.dbGroupMemberMap.values())),r&&r()})},d.prototype.syncGroupInfo=function(o,c){typeof o=="string"&&(this.groupName=o,this.dbGroup.groupName=o),typeof c=="string"&&(this.groupAvatarUrl=c,this.dbGroup.groupAvatarUrl=c),this.eventBus.exec(p.t.ISyncGroupInfo,this.groupID,o,c)},d.prototype.mergeGroupData=function(o,c,r,t){o==p.z.Name?(this.syncGroupInfo(r,void 0),this.eventBus.emit(p.t.GroupName,{groupID:this.groupID,groupName:r,operatedInfo:t})):o!=p.z.Notice&&o?o==p.z.Avatar&&(this.syncGroupInfo(void 0,r),this.eventBus.emit(p.t.GroupAvatar,{groupID:this.groupID,groupAvatarUrl:r,operatedInfo:t})):(this.dbGroup.groupNotice=r,this.eventBus.emit(p.t.GroupNotice,{groupID:this.groupID,groupNotice:r,operatedInfo:t})),c&&(this.dbGroup.dataSeq=c),this.dbMgr.addGroupList([this.dbGroup])},d.prototype.mergeGroupAttributes=function(o,c,r){var t=c.seq,n=(c=c.attributes,this.dbGroup.attributes||{}),s={},u={},a=[],i={action:o,seq:t,attributes:c,setAttrs:s,delAtrrs:u};c.forEach(function(l){var h,m=l.key,g=l.value;l=l.seq,o!=p.x.Delete&&l?l&&(h=((h=n[m])==null?void 0:h.state)||0,(!n[m]||l>n[m].seq)&&(h=0,s[m]=g),n[m]={key:m,value:g,seq:l,state:h}):(o!=p.x.Query&&(u[m]=g),n[m]=k(k({},n[m]),{key:m,state:1}))}),Object.keys(s).length&&a.push({action:p.y.Set,groupAttributes:s}),Object.keys(u).length&&a.push({action:p.y.Delete,groupAttributes:u}),r&&a.length&&this.eventBus.emit(p.t.GroupAttr,{groupID:this.groupID,operatedInfo:r,infoList:a}),this.dbGroup.attributes=n,t&&(this.dbGroup.attributeSeq=t),this.dbMgr.addGroupList([this.dbGroup]),i.dbSeq=this.dbGroup.attributeSeq,i.dbAttr=n,this.logger.info(S,"mergeAttr",i)},d.prototype.mergeGroupMemberInfo=function(o,c,r,t){var n=k(k({},this.dbGroupMemberMap.get(t)),{userID:t});c&&(n.dataSeq=c),o===p.D.Nickname?(n.memberNickname=r,t==this.groupMember.userID&&(this.groupMember.memberNickname=n.memberNickname)):o===p.D.Role&&(n.memberRole=r,t==this.groupMember.userID&&(this.groupMember.memberRole=n.memberRole)),this.dbGroupMemberMap.set(t,n),this.dbMgr.addGroupMemberList(this.groupID,[n]),this.eventBus.emit(p.t.GroupMemberInfo,{groupID:this.groupID,operatedInfo:this.createOwnerOperator(),userList:[n]})},d.prototype.fetchServerPageMember=function(o,c,r){var t=p.c.group_member_list;return o={group_id:this.groupID,count:100,cur_member_seq:o,full_pull:1,degree:c,how:r},r=r==p.u.Biz?p.i.API:p.i.SDK,c==1&&(c=this.mergeListSeqs.member+this.groupID,this.dataReport.beginNetworkRequest(t.cmd,c,r,o)),this.connMgr.sendRequest(t,o,r)},d.prototype.fetchServerPageReceiptDetail=function(o,c,r){return r={group_id:this.groupID,conv_msg_seq:r,list_seq:o,count:100,degree:c},o=p.c.msg_read_receipt_detail,c==1&&(c=this.mergeListSeqs.receiptDetail+this.groupID,this.dataReport.beginNetworkRequest(o.cmd,c,p.i.API,r)),this.connMgr.sendRequest(o,r)},d.prototype.mergeServerMemberList=function(o,c,r){var t=this,n=this.dbGroup.memberSeq||0,s={time:new Date,groupID:this.groupID,dbSeq:n,how:o,action:c,count:0},u=1,a=++this.mergeListSeqs.member+this.groupID,i=[],l=function(m){t.logger&&(m.degree=u,m.svrCount=i.length,s.count=i.length,s.dataReport=t.dataReport.endNetworkRequest(p.c.group_member_list.cmd,a,m),t.logger.info(S,"mergeSvrMembers",s))},h=function(m){if(m.code||!t.dbMgr)return l(m),r&&r(m);t.tatalMemberCount=m.member_count;var g=m.member_all_seq;if(g<=n)return t.isFullMembers=!0,l(m),r&&r();var y=m.cur_member_seq;i.push.apply(i,function(w,M,R){if(R||arguments.length===2)for(var D,q=0,L=M.length;q<L;q++)!D&&q in M||((D=D||Array.prototype.slice.call(M,0,q))[q]=M[q]);return w.concat(D||Array.prototype.slice.call(M))}([],function(w,M){var R=typeof Symbol=="function"&&w[Symbol.iterator];if(!R)return w;var D,q,L=R.call(w),j=[];try{for(;(M===void 0||0<M--)&&!(D=L.next()).done;)j.push(D.value)}catch(G){q={error:G}}finally{try{D&&!D.done&&(R=L.return)&&R.call(L)}finally{if(q)throw q.error}}return j}(m.change_list),!1)),y<g?t.fetchServerPageMember(y,++u,o).then(h):(t.isFullMembers=!0,l(m),t.updateMemberSeq(g,!0),t.mergeMemberList(i,m.full_list,r))};this.fetchServerPageMember(n,u,o).then(h)},d.prototype.fetchMembersInfo=function(o,c){var r=this,t=[];if(o.forEach(function(a){a.member_data.user_avatar&&a.member_data.user_avatar.length||t.push(a.user_id)}),t.length){for(var n=[],s=0;s<t.length;s+=100){var u=this.connMgr.sendRequest(p.c.fetch_user_info,{_ev_:c,quey_user_id:t.slice(s,s+100)},p.i.SDK);n.push(u)}Promise.all(n).then(function(a){var i=[];a.forEach(function(l){(l=l.result)&&l.length&&l.forEach(function(h){var m=h.user_id,g=o.find(function(y){return m==y.user_id});g&&(g.member_data.user_name=Object(I.f)(h.user_name),g.member_data.user_avatar=h.avatar,i.push(r.createDBMember(g)))})}),r.dbMgr.addGroupMemberList(r.groupID,i)})}},d.prototype.createGroupCallback=function(o){return Object.assign(this.dbGroup,{id:this.engineConfig.user.userID+o.group_id,groupID:o.group_id,groupNotice:o.group_notice,notificationStatus:p.G.Notify,attributes:this.createDBGroupAttributes(o.attributes.attributes)}),o.group_list_seq&&(this.dbGroup.groupSeq=o.group_list_seq.toString()),o.attributes.seq&&(this.dbGroup.attributeSeq=o.attributes.seq),o.member_all_seq&&(this.dbGroup.memberSeq=o.member_all_seq),this.syncGroupInfo(o.group_name,Object(I.f)(o.group_avatar)),this.dbMgr.addGroupList([this.dbGroup]),o.group_notice||this.queryGroupInfo(),this.fetchMembersInfo(o.members,"createGroupCallback"),this.handleCreateGroupCallback(o)},d.prototype.handleCreateGroupCallback=function(o){var c=this,r=o.members.map(function(s){return c.createDBMember(s)}),t=(o=(this.dbMgr.addGroupMemberList(this.groupID,r),o.op_user?this.createOperator(o.op_user):this.createOwnerOperator())).userID,n=(this.groupMember.memberRole=t==this.engineConfig.user.userID?p.E.Owner:p.E.Member,this.eventBus.emit(p.t.GroupState,{state:p.H.Enter,event:p.A.Created,operatedInfo:o,groupInfo:this.createGroupFullInfo()}),this.dbGroup.attributes&&0<Object.keys(this.dbGroup.attributes).length&&(n={action:p.y.Set,groupAttributes:this.createGroupAttributes()},this.eventBus.emit(p.t.GroupAttr,{groupID:this.groupID,operatedInfo:o,infoList:[n]})),this.eventBus.emit(p.t.GroupMemberState,{groupID:this.groupID,state:p.F.Enter,event:p.C.Joined,operatedInfo:o,userList:[o.operatedUserInfo]}),r.filter(function(s){return s.userID!=t}));return n.length&&this.eventBus.emit(p.t.GroupMemberState,{groupID:this.groupID,state:p.F.Enter,event:p.C.Invited,operatedInfo:o,userList:n}),r},d.prototype.handleJoinGroup=function(o,c,r){var t=this,n=o.group_notice,s=o.member_all_seq,u=o.group_data_seq,a=o.group_list_seq,i=o.properties;return n&&(this.dbGroup.groupNotice=n),a&&(this.dbGroup.groupSeq=a.toString()),n=o.members.map(function(l){return t.createDBMember(l)}),r?(this.syncGroupInfo(o.group_name,Object(I.f)(o.group_avatar)),this.dbGroup.notificationStatus=p.G.Notify,this.mergeServerMemberList(p.u.SDKPush,"joinGroup"),this.dbGroup.attributes={},i?(this.dbGroup.attributes=this.createDBGroupAttributes(i.attributes),i.seq&&(this.dbGroup.attributeSeq=i.seq)):this.queryGroupAttributes([]),this.queryGroupInfo(),u&&(this.dbGroup.dataSeq=u)):(s&&(this.dbGroup.memberSeq=s),this.dbMgr.addGroupMemberList(this.groupID,n)),this.dbMgr.addGroupList([this.dbGroup]),o.op_user||(o.op_user={user_id:this.engineConfig.user.userID,user_name:this.engineConfig.user.userName}),a=this.createOperator(o.op_user),r&&(this.eventBus.emit(p.t.GroupState,{state:p.H.Enter,event:r,operatedInfo:a,groupInfo:this.createGroupFullInfo()}),this.dbGroup.attributes&&0<Object.keys(this.dbGroup.attributes).length&&(i={action:p.y.Set,groupAttributes:this.createGroupAttributes()},this.eventBus.emit(p.t.GroupAttr,{groupID:this.groupID,operatedInfo:a,infoList:[i]}))),n.length&&this.eventBus.emit(p.t.GroupMemberState,{groupID:this.groupID,state:p.F.Enter,event:c,operatedInfo:a,userList:n}),n},d.prototype.joinGroupCallback=function(o,c,r){c!=p.C.Joined||r||this.fetchMembersInfo(o.members,"joinGroupCallback"),this.handleJoinGroup(o,c,r)},d.prototype.inviteUsersIntoGroupCallback=function(o){var c=this,r=o.members.map(function(t){return c.createDBMember(t)});return this.dbMgr.addGroupMemberList(this.groupID,r),this.updateMemberSeq(o.member_all_seq),r},d.prototype.kickGroupMemberCallback=function(o){var c=this,r=(o=(this.updateMemberSeq(o.member_all_seq),o.members.map(function(t){return c.createDBMember(t,!0)}))).map(function(t){return t.userID});return this.dbMgr.deleteGroupMemberList(this.groupID,r),o},d.prototype.transferGroupOwnerCallback=function(o){var c=this,r=this.dbGroupMemberMap.get(o[0].userID),t=this.dbGroupMemberMap.get(o[1].userID);(r&&t?Promise.resolve([r,t]):this.dbMgr.getGroupMemberList(this.groupID)).then(function(n){r=n.find(function(s){return s.userID==o[0].userID}),t=n.find(function(s){return s.userID==o[1].userID}),r&&t&&(r.memberRole=p.E.Owner,t.memberRole=p.E.Member,o[0].dataSeq&&(r.dataSeq=o[0].dataSeq),o[1].dataSeq&&(t.dataSeq=o[1].dataSeq),c.dbGroupMemberMap.set(r.userID,r),c.dbGroupMemberMap.set(t.userID,t),c.dbMgr.addGroupMemberList(c.groupID,[r,t]),n=k(k({},t),{operatedUserInfo:t}),c.eventBus.emit(p.t.GroupMemberInfo,{groupID:c.groupID,operatedInfo:n,userList:[r,t]}))})},d.prototype.groupOwnerQuitCallback=function(o,c){var r=k(k({},this.dbGroupMemberMap.get(o)),{userID:o});r.memberRole=p.E.Owner,this.dbGroupMemberMap.set(o,r),this.dbMgr.addGroupMemberList(this.groupID,[r]),this.eventBus.emit(p.t.GroupMemberInfo,{groupID:this.groupID,operatedInfo:c,userList:[r]})},d.prototype.queryGroupMembersCallback=function(o,c,r,t,n){var s=this,u=(r.total=this.tatalMemberCount,r.dbTotal=this.dbGroupMemberMap.size,c&&c.code);if(u&&u!=6000104)return u=Object(I.s)(p.s.GroupModuleQueryGroupMemberListError,c.message,c.code),r.error=u,this.logger.info(S,p.I.QueryGroupMemberList,r),n(u);this.dbMgr.getGroupMemberList(this.groupID).then(function(a){r.dbTotal=a.length,s.dbGroupMemberMap.size||a.forEach(function(y){return s.dbGroupMemberMap.set(y.userID,y)}),a.sort(function(y,w){return y.seq-w.seq});var i=o.nextFlag,l=((l=a[a.length-1])==null?void 0:l.seq)||0,h=0,m=(l=(0<i&&i<l?h=a.findIndex(function(y){return y.seq==i}):l<=i&&l&&(h=a.length-1),h+o.count),((m=a[l])==null?void 0:m.seq)||0),g=(a=a.slice(h,l)).map(function(y){return Object(I.q)(s.memberKeys,y)});Object.assign(r,{start:h,end:l,count:a.length,nextFlag:m}),s.logger.info(S,p.I.QueryGroupMemberList,r),t({groupID:s.groupID,userList:g,nextFlag:m})})},d.prototype.updateMemberSeq=function(o,c){this.dbGroup&&o&&(c||!this.dbGroup.memberSeq||this.dbGroup.memberSeq+1==o)&&(this.dbGroup.memberSeq=o,this.dbMgr.addGroupList([this.dbGroup]))},d);function d(o,c,r,t,n){this.type=p.q.Group,this.groupID="",this.groupName=void 0,this.groupAvatarUrl=void 0,this.tatalMemberCount=0,this.mergeListSeqs={member:0,receiptDetail:0},this.dbGroup={},this.isFullMembers=!1,this.dbGroupMemberMap=new Map,this.memberKeys=["userID","userName","memberRole","memberAvatarUrl","memberNickname"],this.dbGroup.groupID=o,this.groupID=o,this.engineConfig=c,this.logger=T.a.getInstance().logger,this.settings=T.a.getInstance().settings,this.dataReport=T.a.getInstance().dataReport,this.eventBus=r,this.dbMgr=t,this.connMgr=n,this.groupMember={userID:this.engineConfig.user.userID,userName:this.engineConfig.user.userName||"",memberAvatarUrl:this.engineConfig.user.userAvatarUrl||"",memberNickname:"",memberRole:p.E.Member}}},function(Q,O,b){b.d(O,"a",function(){return T});function T(I){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(I)}},function(Q,O,b){b.d(O,"a",function(){return p}),b.d(O,"b",function(){return k}),I.prototype.init=function(S){for(var f,d,o=0;o<256;++o)this.S[o]=o;for(o=f=0;o<256;++o)f=f+this.S[o]+S[o%S.length]&255,d=this.S[o],this.S[o]=this.S[f],this.S[f]=d;this.i=0,this.j=0},I.prototype.next=function(){this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255;var S=this.S[this.i];return this.S[this.i]=this.S[this.j],this.S[this.j]=S,this.S[S+this.S[this.i]&255]};var T=I;function I(){this.i=0,this.j=0,this.S=[]}function p(){return new T}var k=256},function(Q,O,b){b.r(O),b.d(O,"ZIM",function(){return S});var T=b(2),I=b(1),p=b(8),k=function(){return(k=Object.assign||function(d){for(var o,c=1,r=arguments.length;c<r;c++)for(var t in o=arguments[c])Object.prototype.hasOwnProperty.call(o,t)&&(d[t]=o[t]);return d}).apply(this,arguments)},S=(b=function(d,o,c,r){var t,n=arguments.length,s=n<3?o:r===null?r=Object.getOwnPropertyDescriptor(o,c):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(d,o,c,r);else for(var u=d.length-1;0<=u;u--)(t=d[u])&&(s=(n<3?t(s):3<n?t(o,c,s):t(o,c))||s);return 3<n&&s&&Object.defineProperty(o,c,s),s},f.setEventHandler=function(d){f._flutter_handler=d},f.toJSON=function(d){return JSON.stringify(d)},f.prototype.createNotInitError=function(){return this.engine?void 0:Object(I.s)(p.i.CommonModuleNotInit)},f.getVersion=function(){return T.a.getInstance().getVersion()},f.getInstance=function(){return f._instance},f.setAdvancedConfig=function(d,o){T.a.getInstance().setAdvancedConfig(d,o)},f.setGeofencingConfig=function(d,o){return T.a.getInstance().setGeofencingConfig(d,o)},f.create=function(d){if(!(d=typeof d=="object"?d.appID:d)||typeof d!="number")throw o=Object(I.s)(p.i.CommonModuleInvalidAppID),new Error(JSON.stringify(k({appID:d,version:f.getVersion()},o)));var o=T.a.getInstance().createEngine(d);return o?f._instance=new f(o):null},f.prototype.destroy=function(){this.engine&&T.a.getInstance().destroyEngine(this.engine),this.engine=null},f.prototype.setLogConfig=function(d){this.engine&&T.a.getInstance().setLogConfig(d)},f.prototype.uploadLog=function(){return this.engine.uploadLog()},f.prototype.on=function(d,o){this.engine&&this.engine.on(d,o)},f.prototype.off=function(d){this.engine&&this.engine.off(d)},f.prototype.login=function(d,o){return this.engine.login(d,o)},f.prototype.logout=function(){this.engine&&this.engine.logout()},f.prototype.renewToken=function(d){return this.engine.renewToken(d)},f.prototype.queryUsersInfo=function(d,o){return this.engine.queryUsersInfo(d,o)},f.prototype.updateUserName=function(d){return this.engine.updateUserName(d)},f.prototype.updateUserAvatarUrl=function(d){return this.engine.updateUserAvatarUrl(d)},f.prototype.updateUserExtendedData=function(d){return this.engine.updateUserExtendedData(d)},f.prototype.queryConversation=function(d,o){return this.engine.queryConversation(d,o)},f.prototype.queryConversationList=function(d){return this.engine.queryConversationList(d)},f.prototype.queryConversationPinnedList=function(d){return this.engine.queryConversationPinnedList(d)},f.prototype.deleteConversation=function(d,o,c){return this.engine.deleteConversation(d,o,c)},f.prototype.deleteAllConversations=function(d){return this.engine.deleteAllConversations(d)},f.prototype.setConversationNotificationStatus=function(d,o,c){return this.engine.setConversationNotificationStatus(d,o,c)},f.prototype.updateConversationPinnedState=function(d,o,c){return this.engine.updateConversationPinnedState(d,o,c)},f.prototype.clearConversationUnreadMessageCount=function(d,o){return this.engine.clearConversationUnreadMessageCount(d,o)},f.prototype.clearConversationTotalUnreadMessageCount=function(){return this.engine.clearConversationTotalUnreadMessageCount()},f.prototype.sendPeerMessage=function(d,o,c,r){return this.engine.sendMessage(d,o,p.h.Peer,c,r)},f.prototype.sendGroupMessage=function(d,o,c,r){return this.engine.sendMessage(d,o,p.h.Group,c,r)},f.prototype.sendRoomMessage=function(d,o,c,r){return this.engine.sendMessage(d,o,p.h.Room,c,r)},f.prototype.sendMessage=function(d,o,c,r,t){return this.engine.sendMessage(d,o,c,r,t)},f.prototype.sendMediaMessage=function(d,o,c,r,t){return this.engine.sendMediaMessage(d,o,c,r,t)},f.prototype.deleteMessages=function(d,o,c,r){return this.engine.deleteMessages(d,o,c,r)},f.prototype.deleteAllMessage=function(d,o,c){return this.engine.deleteAllMessage(d,o,c)},f.prototype.queryHistoryMessage=function(d,o,c){return this.engine.queryHistoryMessage(d,o,c)},f.prototype.insertMessageToLocalDB=function(d,o,c,r){return this.engine.insertMessageToLocalDB(d,o,c,r)},f.prototype.updateMessageLocalExtendedData=function(d,o){return this.engine.updateMessageLocalExtendedData(d,o)},f.prototype.revokeMessage=function(d,o){return this.engine.revokeMessage(d,o)},f.prototype.sendConversationMessageReceiptRead=function(d,o){return this.engine.sendReceiptRead(d,o)},f.prototype.sendMessageReceiptsRead=function(d,o,c){return this.engine.sendMessageReceiptsRead(d,o,c)},f.prototype.queryMessageReceiptsInfo=function(d,o,c){return this.engine.queryMessageReceiptsInfo(d,o,c)},f.prototype.queryGroupMessageReceiptReadMemberList=function(d,o,c){return this.engine.queryReceiptMemberList(d,o,c,!0)},f.prototype.queryGroupMessageReceiptUnreadMemberList=function(d,o,c){return this.engine.queryReceiptMemberList(d,o,c,!1)},f.prototype.addMessageReaction=function(d,o){return this.engine.addMessageReaction(d,o)},f.prototype.deleteMessageReaction=function(d,o){return this.engine.deleteMessageReaction(d,o)},f.prototype.queryMessageReactionUserList=function(d,o){return this.engine.queryMessageReactionUserList(d,o)},f.prototype.createRoom=function(d,o){return this.engine.createRoom(d,o)},f.prototype.enterRoom=function(d,o){return this.engine.enterRoom(d,o)},f.prototype.joinRoom=function(d){return this.engine.joinRoom(d)},f.prototype.leaveRoom=function(d){return this.engine.leaveRoom(d)},f.prototype.queryRoomMemberList=function(d,o){return this.engine.queryRoomMemberList(d,o)},f.prototype.queryRoomMembers=function(d,o){return this.engine.queryRoomMembers(d,o)},f.prototype.queryRoomOnlineMemberCount=function(d){return this.engine.queryRoomOnlineMemberCount(d)},f.prototype.queryRoomAllAttributes=function(d){return this.engine.queryRoomAllAttributes(d)},f.prototype.setRoomAttributes=function(d,o,c){return this.engine.setRoomAttributes(d,o,c)},f.prototype.deleteRoomAttributes=function(d,o,c){return this.engine.deleteRoomAttributes(d,o,c)},f.prototype.beginRoomAttributesBatchOperation=function(d,o){this.engine&&this.engine.beginRoomAttributesBatchOperation(d,o)},f.prototype.endRoomAttributesBatchOperation=function(d){return this.engine.endRoomAttributesBatchOperation(d)},f.prototype.setRoomMembersAttributes=function(d,o,c,r){return this.engine.setRoomMembersAttributes(d,o,c,r)},f.prototype.queryRoomMembersAttributes=function(d,o){return this.engine.queryRoomMembersAttributes(d,o)},f.prototype.queryRoomMemberAttributesList=function(d,o){return this.engine.queryRoomMemberAttributesList(d,o)},f.prototype.createGroup=function(d,o,c){return this.engine.createGroup(d,o,c)},f.prototype.joinGroup=function(d){return this.engine.joinGroup(d)},f.prototype.leaveGroup=function(d){return this.engine.leaveGroup(d)},f.prototype.dismissGroup=function(d){return this.engine.dismissGroup(d)},f.prototype.queryGroupList=function(){return this.engine.queryGroupList()},f.prototype.updateGroupNotice=function(d,o){return this.engine.updateGroupNotice(d,o)},f.prototype.updateGroupName=function(d,o){return this.engine.updateGroupName(d,o)},f.prototype.updateGroupAvatarUrl=function(d,o){return this.engine.updateGroupAvatarUrl(d,o)},f.prototype.queryGroupInfo=function(d){return this.engine.queryGroupInfo(d)},f.prototype.setGroupAttributes=function(d,o){return this.engine.setGroupAttributes(d,o)},f.prototype.deleteGroupAttributes=function(d,o){return this.engine.deleteGroupAttributes(d,o)},f.prototype.queryGroupAttributes=function(d,o){return this.engine.queryGroupAttributes(o,d)},f.prototype.queryGroupAllAttributes=function(d){return this.engine.queryGroupAttributes(d)},f.prototype.setGroupMemberNickname=function(d,o,c){return this.engine.setGroupMemberNickname(d,o,c)},f.prototype.setGroupMemberRole=function(d,o,c){return this.engine.setGroupMemberRole(d,o,c)},f.prototype.transferGroupOwner=function(d,o){return this.engine.transferGroupOwner(d,o)},f.prototype.queryGroupMemberInfo=function(d,o){return this.engine.queryGroupMemberInfo(d,o)},f.prototype.inviteUsersIntoGroup=function(d,o){return this.engine.inviteUsersIntoGroup(d,o)},f.prototype.kickGroupMembers=function(d,o){return this.engine.kickGroupMembers(d,o)},f.prototype.queryGroupMemberList=function(d,o){return this.engine.queryGroupMemberList(d,o)},f.prototype.queryGroupMemberCount=function(d){return this.engine.queryGroupMemberCount(d)},f.prototype.callInvite=function(d,o){return this.engine.callInvite(d,o)},f.prototype.callCancel=function(d,o,c){return this.engine.callCancel(d,o,c)},f.prototype.callAccept=function(d,o){return this.engine.callAccept(d,o)},f.prototype.callReject=function(d,o){return this.engine.callReject(d,o)},f.prototype.callQuit=function(d,o){return this.engine.callQuit(d,o)},f.prototype.callEnd=function(d,o){return this.engine.callEnd(d,o)},f.prototype.callJoin=function(d,o){return this.engine.callJoin(d,o)},f.prototype.callingInvite=function(d,o,c){return this.engine.callingInvite(d,o,c)},f.prototype.queryCallInvitationList=function(d){return this.engine.queryCallInvitationList(d)},f.prototype.searchLocalConversations=function(d){return this.engine.searchConversations(d)},f.prototype.searchGlobalLocalMessages=function(d){return this.engine.searchGlobalMessages(d)},f.prototype.searchLocalMessages=function(d,o,c){return this.engine.searchMessages(d,o,c)},f.prototype.searchLocalGroups=function(d){return this.engine.searchGroups(d)},f.prototype.searchLocalGroupMembers=function(d,o){return this.engine.searchGroupMembers(d,o)},f.TAG="2023/11/15 11:37:11",f._instance=null,b([Object(I.o)()],f.prototype,"uploadLog",null),b([Object(I.o)()],f.prototype,"login",null),b([Object(I.o)()],f.prototype,"renewToken",null),b([Object(I.o)()],f.prototype,"queryUsersInfo",null),b([Object(I.o)()],f.prototype,"updateUserName",null),b([Object(I.o)()],f.prototype,"updateUserAvatarUrl",null),b([Object(I.o)()],f.prototype,"updateUserExtendedData",null),b([Object(I.o)()],f.prototype,"queryConversation",null),b([Object(I.o)()],f.prototype,"queryConversationList",null),b([Object(I.o)()],f.prototype,"queryConversationPinnedList",null),b([Object(I.o)()],f.prototype,"deleteConversation",null),b([Object(I.o)()],f.prototype,"deleteAllConversations",null),b([Object(I.o)()],f.prototype,"setConversationNotificationStatus",null),b([Object(I.o)()],f.prototype,"updateConversationPinnedState",null),b([Object(I.o)()],f.prototype,"clearConversationUnreadMessageCount",null),b([Object(I.o)()],f.prototype,"clearConversationTotalUnreadMessageCount",null),b([Object(I.o)()],f.prototype,"sendPeerMessage",null),b([Object(I.o)()],f.prototype,"sendGroupMessage",null),b([Object(I.o)()],f.prototype,"sendRoomMessage",null),b([Object(I.o)()],f.prototype,"sendMessage",null),b([Object(I.o)()],f.prototype,"sendMediaMessage",null),b([Object(I.o)()],f.prototype,"deleteMessages",null),b([Object(I.o)()],f.prototype,"deleteAllMessage",null),b([Object(I.o)()],f.prototype,"queryHistoryMessage",null),b([Object(I.o)()],f.prototype,"insertMessageToLocalDB",null),b([Object(I.o)()],f.prototype,"updateMessageLocalExtendedData",null),b([Object(I.o)()],f.prototype,"revokeMessage",null),b([Object(I.o)()],f.prototype,"sendConversationMessageReceiptRead",null),b([Object(I.o)()],f.prototype,"sendMessageReceiptsRead",null),b([Object(I.o)()],f.prototype,"queryMessageReceiptsInfo",null),b([Object(I.o)()],f.prototype,"queryGroupMessageReceiptReadMemberList",null),b([Object(I.o)()],f.prototype,"queryGroupMessageReceiptUnreadMemberList",null),b([Object(I.o)()],f.prototype,"addMessageReaction",null),b([Object(I.o)()],f.prototype,"deleteMessageReaction",null),b([Object(I.o)()],f.prototype,"queryMessageReactionUserList",null),b([Object(I.o)()],f.prototype,"createRoom",null),b([Object(I.o)()],f.prototype,"enterRoom",null),b([Object(I.o)()],f.prototype,"joinRoom",null),b([Object(I.o)()],f.prototype,"leaveRoom",null),b([Object(I.o)()],f.prototype,"queryRoomMemberList",null),b([Object(I.o)()],f.prototype,"queryRoomMembers",null),b([Object(I.o)()],f.prototype,"queryRoomOnlineMemberCount",null),b([Object(I.o)()],f.prototype,"queryRoomAllAttributes",null),b([Object(I.o)()],f.prototype,"setRoomAttributes",null),b([Object(I.o)()],f.prototype,"deleteRoomAttributes",null),b([Object(I.o)()],f.prototype,"endRoomAttributesBatchOperation",null),b([Object(I.o)()],f.prototype,"setRoomMembersAttributes",null),b([Object(I.o)()],f.prototype,"queryRoomMembersAttributes",null),b([Object(I.o)()],f.prototype,"queryRoomMemberAttributesList",null),b([Object(I.o)()],f.prototype,"createGroup",null),b([Object(I.o)()],f.prototype,"joinGroup",null),b([Object(I.o)()],f.prototype,"leaveGroup",null),b([Object(I.o)()],f.prototype,"dismissGroup",null),b([Object(I.o)()],f.prototype,"queryGroupList",null),b([Object(I.o)()],f.prototype,"updateGroupNotice",null),b([Object(I.o)()],f.prototype,"updateGroupName",null),b([Object(I.o)()],f.prototype,"updateGroupAvatarUrl",null),b([Object(I.o)()],f.prototype,"queryGroupInfo",null),b([Object(I.o)()],f.prototype,"setGroupAttributes",null),b([Object(I.o)()],f.prototype,"deleteGroupAttributes",null),b([Object(I.o)()],f.prototype,"queryGroupAttributes",null),b([Object(I.o)()],f.prototype,"queryGroupAllAttributes",null),b([Object(I.o)()],f.prototype,"setGroupMemberNickname",null),b([Object(I.o)()],f.prototype,"setGroupMemberRole",null),b([Object(I.o)()],f.prototype,"transferGroupOwner",null),b([Object(I.o)()],f.prototype,"queryGroupMemberInfo",null),b([Object(I.o)()],f.prototype,"inviteUsersIntoGroup",null),b([Object(I.o)()],f.prototype,"kickGroupMembers",null),b([Object(I.o)()],f.prototype,"queryGroupMemberList",null),b([Object(I.o)()],f.prototype,"queryGroupMemberCount",null),b([Object(I.o)()],f.prototype,"callInvite",null),b([Object(I.o)()],f.prototype,"callCancel",null),b([Object(I.o)()],f.prototype,"callAccept",null),b([Object(I.o)()],f.prototype,"callReject",null),b([Object(I.o)()],f.prototype,"callQuit",null),b([Object(I.o)()],f.prototype,"callEnd",null),b([Object(I.o)()],f.prototype,"callJoin",null),b([Object(I.o)()],f.prototype,"callingInvite",null),b([Object(I.o)()],f.prototype,"queryCallInvitationList",null),b([Object(I.o)()],f.prototype,"searchLocalConversations",null),b([Object(I.o)()],f.prototype,"searchGlobalLocalMessages",null),b([Object(I.o)()],f.prototype,"searchLocalMessages",null),b([Object(I.o)()],f.prototype,"searchLocalGroups",null),b([Object(I.o)()],f.prototype,"searchLocalGroupMembers",null),f);function f(d){if(!d||!d.setContext)throw new Error("Can not use new.");(this.engine=d).setContext(this)}O.default=S},function(Q,O,b){var T,I,p,k,S;Q.exports=(Q=b(5),b(94),b(95),T=(p=(b=Q).lib).Base,I=p.WordArray,k=(p=b.algo).MD5,S=p.EvpKDF=T.extend({cfg:T.extend({keySize:4,hasher:k,iterations:1}),init:function(f){this.cfg=this.cfg.extend(f)},compute:function(f,d){for(var o,c=this.cfg,r=c.hasher.create(),t=I.create(),n=t.words,s=c.keySize,u=c.iterations;n.length<s;){o&&r.update(o),o=r.update(f).finalize(d),r.reset();for(var a=1;a<u;a++)o=r.finalize(o),r.reset();t.concat(o)}return t.sigBytes=4*s,t}}),b.EvpKDF=function(f,d,o){return S.create(o).compute(f,d)},Q.EvpKDF)},function(Q,O,b){Q.exports=c;var T,I=b(10),p=I.LongBits,k=I.base64,S=I.utf8;function f(i,l,h){this.fn=i,this.len=l,this.next=void 0,this.val=h}function d(){}function o(i){this.head=i.head,this.tail=i.tail,this.len=i.len,this.next=i.states}function c(){this.len=0,this.head=new f(d,0,0),this.tail=this.head,this.states=null}function r(){return I.Buffer?function(){return(c.create=function(){return new T})()}:function(){return new c}}function t(i,l,h){l[h]=255&i}function n(i,l){this.len=i,this.next=void 0,this.val=l}function s(i,l,h){for(;i.hi;)l[h++]=127&i.lo|128,i.lo=(i.lo>>>7|i.hi<<25)>>>0,i.hi>>>=7;for(;127<i.lo;)l[h++]=127&i.lo|128,i.lo=i.lo>>>7;l[h++]=i.lo}function u(i,l,h){l[h]=255&i,l[h+1]=i>>>8&255,l[h+2]=i>>>16&255,l[h+3]=i>>>24}c.create=r(),c.alloc=function(i){return new I.Array(i)},I.Array!==Array&&(c.alloc=I.pool(c.alloc,I.Array.prototype.subarray)),c.prototype._push=function(i,l,h){return this.tail=this.tail.next=new f(i,l,h),this.len+=l,this},(n.prototype=Object.create(f.prototype)).fn=function(i,l,h){for(;127<i;)l[h++]=127&i|128,i>>>=7;l[h]=i},c.prototype.uint32=function(i){return this.len+=(this.tail=this.tail.next=new n((i>>>=0)<128?1:i<16384?2:i<2097152?3:i<268435456?4:5,i)).len,this},c.prototype.int32=function(i){return i<0?this._push(s,10,p.fromNumber(i)):this.uint32(i)},c.prototype.sint32=function(i){return this.uint32((i<<1^i>>31)>>>0)},c.prototype.int64=c.prototype.uint64=function(i){return i=p.from(i),this._push(s,i.length(),i)},c.prototype.sint64=function(i){return i=p.from(i).zzEncode(),this._push(s,i.length(),i)},c.prototype.bool=function(i){return this._push(t,1,i?1:0)},c.prototype.sfixed32=c.prototype.fixed32=function(i){return this._push(u,4,i>>>0)},c.prototype.sfixed64=c.prototype.fixed64=function(i){return i=p.from(i),this._push(u,4,i.lo)._push(u,4,i.hi)},c.prototype.float=function(i){return this._push(I.float.writeFloatLE,4,i)},c.prototype.double=function(i){return this._push(I.float.writeDoubleLE,8,i)};var a=I.Array.prototype.set?function(i,l,h){l.set(i,h)}:function(i,l,h){for(var m=0;m<i.length;++m)l[h+m]=i[m]};c.prototype.bytes=function(i){var l,h=i.length>>>0;return h?(I.isString(i)&&(l=c.alloc(h=k.length(i)),k.decode(i,l,0),i=l),this.uint32(h)._push(a,h,i)):this._push(t,1,0)},c.prototype.string=function(i){var l=S.length(i);return l?this.uint32(l)._push(S.write,l,i):this._push(t,1,0)},c.prototype.fork=function(){return this.states=new o(this),this.head=this.tail=new f(d,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new f(d,0,0),this.len=0),this},c.prototype.ldelim=function(){var i=this.head,l=this.tail,h=this.len;return this.reset().uint32(h),h&&(this.tail.next=i.next,this.tail=l,this.len+=h),this},c.prototype.finish=function(){for(var i=this.head.next,l=this.constructor.alloc(this.len),h=0;i;)i.fn(i.val,l,h),h+=i.len,i=i.next;return l},c._configure=function(i){T=i,c.create=r(),T._configure()}},function(Q,O,b){Q.exports=f;var T,I=b(10),p=I.LongBits,k=I.utf8;function S(s,u){return RangeError("index out of range: "+s.pos+" + "+(u||1)+" > "+s.len)}function f(s){this.buf=s,this.pos=0,this.len=s.length}function d(){return I.Buffer?function(s){return(f.create=function(u){return I.Buffer.isBuffer(u)?new T(u):c(u)})(s)}:c}var o,c=typeof Uint8Array<"u"?function(s){if(s instanceof Uint8Array||Array.isArray(s))return new f(s);throw Error("illegal buffer")}:function(s){if(Array.isArray(s))return new f(s);throw Error("illegal buffer")};function r(){var s=new p(0,0),u=0;if(!(4<this.len-this.pos)){for(;u<3;++u){if(this.pos>=this.len)throw S(this);if(s.lo=(s.lo|(127&this.buf[this.pos])<<7*u)>>>0,this.buf[this.pos++]<128)return s}return s.lo=(s.lo|(127&this.buf[this.pos++])<<7*u)>>>0,s}for(;u<4;++u)if(s.lo=(s.lo|(127&this.buf[this.pos])<<7*u)>>>0,this.buf[this.pos++]<128)return s;if(s.lo=(s.lo|(127&this.buf[this.pos])<<28)>>>0,s.hi=(s.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return s;if(u=0,4<this.len-this.pos){for(;u<5;++u)if(s.hi=(s.hi|(127&this.buf[this.pos])<<7*u+3)>>>0,this.buf[this.pos++]<128)return s}else for(;u<5;++u){if(this.pos>=this.len)throw S(this);if(s.hi=(s.hi|(127&this.buf[this.pos])<<7*u+3)>>>0,this.buf[this.pos++]<128)return s}throw Error("invalid varint encoding")}function t(s,u){return(s[u-4]|s[u-3]<<8|s[u-2]<<16|s[u-1]<<24)>>>0}function n(){if(this.pos+8>this.len)throw S(this,8);return new p(t(this.buf,this.pos+=4),t(this.buf,this.pos+=4))}f.create=d(),f.prototype._slice=I.Array.prototype.subarray||I.Array.prototype.slice,f.prototype.uint32=(o=4294967295,function(){if(o=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(o=(o|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(o=(o|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(o=(o|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(o=(o|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return o;if((this.pos+=5)>this.len)throw this.pos=this.len,S(this,10);return o}),f.prototype.int32=function(){return 0|this.uint32()},f.prototype.sint32=function(){var s=this.uint32();return s>>>1^-(1&s)|0},f.prototype.bool=function(){return this.uint32()!==0},f.prototype.fixed32=function(){if(this.pos+4>this.len)throw S(this,4);return t(this.buf,this.pos+=4)},f.prototype.sfixed32=function(){if(this.pos+4>this.len)throw S(this,4);return 0|t(this.buf,this.pos+=4)},f.prototype.float=function(){if(this.pos+4>this.len)throw S(this,4);var s=I.float.readFloatLE(this.buf,this.pos);return this.pos+=4,s},f.prototype.double=function(){if(this.pos+8>this.len)throw S(this,4);var s=I.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,s},f.prototype.bytes=function(){var s=this.uint32(),u=this.pos,a=this.pos+s;if(a>this.len)throw S(this,s);return this.pos+=s,Array.isArray(this.buf)?this.buf.slice(u,a):u===a?new this.buf.constructor(0):this._slice.call(this.buf,u,a)},f.prototype.string=function(){var s=this.bytes();return k.read(s,0,s.length)},f.prototype.skip=function(s){if(typeof s=="number"){if(this.pos+s>this.len)throw S(this,s);this.pos+=s}else do if(this.pos>=this.len)throw S(this);while(128&this.buf[this.pos++]);return this},f.prototype.skipType=function(s){switch(s){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(s=7&this.uint32())!=4;)this.skipType(s);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+s+" at offset "+this.pos)}return this},f._configure=function(s){T=s,f.create=d(),T._configure();var u=I.Long?"toLong":"toNumber";I.merge(f.prototype,{int64:function(){return r.call(this)[u](!1)},uint64:function(){return r.call(this)[u](!0)},sint64:function(){return r.call(this).zzDecode()[u](!1)},fixed64:function(){return n.call(this)[u](!0)},sfixed64:function(){return n.call(this)[u](!1)}})}},function(Q,O,b){b.d(O,"b",function(){return T}),b.d(O,"c",function(){return I}),b.d(O,"a",function(){return p});var T=function(){return function(k,S,f){return{value:function(){for(var d=[],o=0;o<arguments.length;o++)d[o]=arguments[o];var c=k.createNotInitError.call(this);return c?Promise.reject(c):f.value.apply(this,d)}}}},I=function(k,S){return function(f,d,o){return{value:function(){for(var c=[],r=0;r<arguments.length;r++)c[r]=arguments[r];var t=f.createNotLoggedError.call(this,k,S);return t?Promise.reject(t):o.value.apply(this,c)}}}},p=function(k,S,f){var d,o=0;return function(c,r,t){return{value:function(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];var u=Date.now();if(o++,u-(d=d||u)<S){if(k<o)return Promise.reject(c.createFrequencyLimitError.call(this,f))}else d=u,o=0;return t.value.apply(this,n)}}}}},function(Q,O,b){b.d(O,"m",function(){return S}),b.d(O,"g",function(){return f}),b.d(O,"h",function(){return d}),b.d(O,"j",function(){return o}),b.d(O,"i",function(){return c}),b.d(O,"f",function(){return r}),b.d(O,"c",function(){return t}),b.d(O,"b",function(){return n}),b.d(O,"l",function(){return s}),b.d(O,"k",function(){return u}),b.d(O,"n",function(){return a}),b.d(O,"o",function(){return l}),b.d(O,"e",function(){return h}),b.d(O,"d",function(){return m}),b.d(O,"a",function(){return y}),O=b(3);var T=b.n(O),I=b(6),p=b(0),k="web".indexOf("wx")!=-1,S=k?typeof tt<"u"?(tt._zim_platform="douyin",tt._zim_env=tt.env.VERSION,tt):typeof swan<"u"?(swan._zim_platform="baidu",swan._zim_env="",swan):typeof my<"u"?(my._zim_platform="alipay",my._zim_isAlipay=!0,my._zim_env=my.getAccountInfoSync().miniProgram.envVersion,my):typeof wx<"u"?(wx._zim_platform="weixin",wx._zim_env=wx.getAccountInfoSync().miniProgram.envVersion,wx):null:null,f=function(){var w,M,R="z_deviceID",D=(w=new Date().getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(L){var j=(w+16*Math.random())%16|0;return w=Math.floor(w/16),(L=="x"?j:3&j|8).toString(36)})),q="";try{k?(M=S.getStorageSync(S._zim_isAlipay?{key:R}:R)||"")&&M.data?q=typeof M=="object"?M.data:M:(q=D,S._zim_isAlipay?S.setStorageSync({key:R,data:q}):S.setStorageSync(R,q)):(q=localStorage.getItem(R)||"")||(q=D,localStorage.setItem(R,q))}catch{q=D}return q}(),d=function(){if(!k)return navigator.userAgent;var w=(j=S.getSystemInfoSync()).brand,M=j.model,R=j.version,D=j.system,q=j.platform,L=j.SDKVersion,j=j.benchmarkLevel;return JSON.stringify({env:S._zim_env,brand:w,model:M,version:R,system:D,platform:S._zim_platform+","+q,SDKVersion:L,benchmarkLevel:j})}(),o=function(){return new Date().getTime()+Math.random().toString().substring(2,7)},c=function(w){return typeof w=="string"?new Uint8Array(Array.from(unescape(encodeURIComponent(w||""))).map(function(M){return M.charCodeAt(0)})):w},r=function(w){if(typeof w=="string")return w;if(!w||!w.length)return"";w=String.fromCharCode.apply(String,function(M,R,D){if(D||arguments.length===2)for(var q,L=0,j=R.length;L<j;L++)!q&&L in R||((q=q||Array.prototype.slice.call(R,0,L))[L]=R[L]);return M.concat(q||Array.prototype.slice.call(R))}([],function(M,R){var D=typeof Symbol=="function"&&M[Symbol.iterator];if(!D)return M;var q,L,j=D.call(M),G=[];try{for(;(R===void 0||0<R--)&&!(q=j.next()).done;)G.push(q.value)}catch(J){L={error:J}}finally{try{q&&!q.done&&(D=j.return)&&D.call(j)}finally{if(L)throw L.error}}return G}(Array.from(w)),!1));try{return decodeURIComponent(escape(w))}catch{return decodeURIComponent(w)}},t=function(w){return I.a.fromUint8Array(w)},n=function(w){return I.a.toUint8Array(w)},s=function(w,M){return!!w&&typeof w=="string"&&w.length<=p.l.MAX_ID_SIZE&&(!M||w[0]!="#")},u=function(w,M){if(!w||typeof w!="string"||w.length<31)return[6000103];if(w.substring(0,2)!=="04")return[6000107];try{var R=Date.now()/1e3,D=Array.from(I.a.toUint8Array(w.substring(2,14))),q=T.a.fromBytes(D.slice(0,8)).toInt();return[q<M||q<R?6000106:q<30+R?6000108:2073600+R<q?6000109:0,q]}catch(L){return(0,console.warn)("Parse token fail for invalid Base64.",L),[6000103]}},a=function(w,M){var R={};return w.forEach(function(D){return R[D]=M[D]}),R},i=((O={})[p.Q.RevokeSelf]=p.N.SelfRevoke,O[p.Q.RevokeSystem]=p.N.SystemRevoke,O[p.Q.RevokeService]=p.N.ServiceAPIRevoke,O[p.Q.RevokeGroupAdmin]=p.N.GroupAdminRevoke,O[p.Q.RevokeGroupOwner]=p.N.GroupOwnerRevoke,O[p.Q.ReceiptDoing]=p.M.Processing,O[p.Q.ReceiptDone]=p.M.Done,O[p.Q.ReceiptExpired]=p.M.Expired,O[p.Q.ReceiptFailed]=p.M.Failed,O),l=function(w){for(var M,R=0,D={revoke:0,receipt:0};w;)1&w&&((M=1<<R)>=p.Q.RevokeSelf&&M<=p.Q.RevokeGroupOwner?D.revoke+=M:M>=p.Q.ReceiptDone&&M<=p.Q.ReceiptDoing&&(D.receipt+=M)),R++,w>>=1;return D.revoke=D.revoke>=p.Q.RevokeSelf&&D.revoke<=p.Q.RevokeGroupOwner?i[D.revoke]:p.N.Unknown,D.receipt=D.receipt>=p.Q.ReceiptDone&&D.receipt<=p.Q.ReceiptDoing?i[D.receipt]:p.M.None,D},h=function(w){if(w&&w.title&&w.content)return{enable_push:1,title:String(w.title),content:String(w.content),payload:String(w.payload||""),pushStrategyId:String(w.resourcesID||""),custom_map:w.enableBadge||w.voIPConfig?{badge_increment:w.enableBadge?String(w.badgeIncrement||0):void 0,sdk_params:w.voIPConfig?JSON.stringify({voip_handle_type:w.voIPConfig.iOSVoIPHandleType,voip_handle_value:String(w.voIPConfig.iOSVoIPHandleValue||""),voip_has_video:!!w.voIPConfig.iOSVoIPHasVideo}):void 0}:void 0}},m=function(w,M){return!!w.isPinned!=!!M.isPinned?M.isPinned?1:-1:M.orderKey-w.orderKey},g=function(w,M){if(!w||!M||Object.keys(w).length!==Object.keys(M).length)return!1;var R,D=!0;for(R in w)M[R]===void 0&&(D=!1),(typeof w[R]=="object"&&typeof M[R])=="object"?D=g(w[R],M[R]):w[R]!==M[R]&&(D=!1);return D},y=function(w,M){if(!w||!M||w.length!==M.length)return!1;var R=!0;return w.forEach(function(D,q){g(D,M[q])||(R=!1)}),R}},function(Q,O,b){var T;b.d(O,"a",function(){return T}),(b=T=T||{})[b.Success=0]="Success",b[b.Failed=1]="Failed",b[b.CommonModuleParamInvalid=6000001]="CommonModuleParamInvalid",b[b.CommonModuleNotInit=6000002]="CommonModuleNotInit",b[b.CommonModuleInvalidAppID=6000003]="CommonModuleInvalidAppID",b[b.CommonModuleTriggerSDKFrequencyLimit=6000004]="CommonModuleTriggerSDKFrequencyLimit",b[b.CommonModuleTriggerServerFrequencyLimit=6000005]="CommonModuleTriggerServerFrequencyLimit",b[b.CommonModuleSwitchServerError=6000006]="CommonModuleSwitchServerError",b[b.CommonModuleIMServerError=6000007]="CommonModuleIMServerError",b[b.CommonModuleUploadLogError=6000010]="CommonModuleUploadLogError",b[b.CommonModuleUserIsNotExist=6000011]="CommonModuleUserIsNotExist",b[b.CommonModuleUserInfoQueriedLimit=6000012]="CommonModuleUserInfoQueriedLimit",b[b.CommonModuleUnsupportedRequest=6000013]="CommonModuleUnsupportedRequest",b[b.CommonModuleUnactivatedIMServer=6000014]="CommonModuleUnactivatedIMServer",b[b.CommonModuleExceedDAULimit=6000015]="CommonModuleExceedDAULimit",b[b.CommonModuleExceedMAULimit=6000016]="CommonModuleExceedMAULimit",b[b.NetworkModuleCommonError=6000101]="NetworkModuleCommonError",b[b.NetworkModuleServerError=6000102]="NetworkModuleServerError",b[b.NetworkModuleTokenInvalid=6000103]="NetworkModuleTokenInvalid",b[b.NetworkModuleNetworkError=6000104]="NetworkModuleNetworkError",b[b.NetworkModuleTokenExpired=6000106]="NetworkModuleTokenExpired",b[b.NetworkModuleTokenVersionError=6000107]="NetworkModuleTokenVersionError",b[b.NetworkModuleTokenTimeIsTooShort=6000108]="NetworkModuleTokenTimeIsTooShort",b[b.NetworkModuleTokenTimeIsTooLong=6000109]="NetworkModuleTokenTimeIsTooLong",b[b.NetworkModuleUserHasAlreadyLogged=6000111]="NetworkModuleUserHasAlreadyLogged",b[b.NetworkModuleUserIsNotLogged=6000121]="NetworkModuleUserIsNotLogged",b[b.ConversationModuleCommonError=6000601]="ConversationModuleCommonError",b[b.ConversationModuleServerError=6000602]="ConversationModuleServerError",b[b.ConversationModuleConversationDoesNotExist=6000603]="ConversationModuleConversationDoesNotExist",b[b.ConversationModulePinnedListReachedLimit=6000604]="ConversationModulePinnedListReachedLimit",b[b.MessageModuleCommonError=6000201]="MessageModuleCommonError",b[b.MessageModuleServerError=6000202]="MessageModuleServerError",b[b.MessageModuleSendMessageFailed=6000203]="MessageModuleSendMessageFailed",b[b.MessageModuleTargetDoesNotExist=6000204]="MessageModuleTargetDoesNotExist",b[b.MessageModuleFileNotExist=6000211]="MessageModuleFileNotExist",b[b.MessageModuleFileServerError=6000212]="MessageModuleFileServerError",b[b.MessageModuleFileTypeUnsupported=6000213]="MessageModuleFileTypeUnsupported",b[b.MessageModuleFileSizeInvalid=6000214]="MessageModuleFileSizeInvalid",b[b.MessageModuleFileDurationInvalid=6000215]="MessageModuleFileDurationInvalid",b[b.MessageModuleAuditRejected=6000221]="MessageModuleAuditRejected",b[b.MessageModuleAuditFailed=6000222]="MessageModuleAuditFailed",b[b.MessageModuleAuditCustomSentRejected=6000230]="MessageModuleAuditCustomSentRejected",b[b.MessageModuleReceiptReadError=6000277]="MessageModuleReceiptReadError",b[b.MessageModuleMessageExceedsRevokeTime=6000278]="MessageModuleMessageExceedsRevokeTime",b[b.MessageModuleMessageHasBeenRevoked=6000279]="MessageModuleMessageHasBeenRevoked",b[b.MessageModuleMessageReactionTypeExisted=6000280]="MessageModuleMessageReactionTypeExisted",b[b.MessageModuleMessageReceiptLimit=6000282]="MessageModuleMessageReceiptLimit",b[b.RoomModuleCommonError=6000301]="RoomModuleCommonError",b[b.RoomModuleServerError=6000302]="RoomModuleServerError",b[b.RoomModuleCreateRoomError=6000303]="RoomModuleCreateRoomError",b[b.RoomModuleJoinRoomError=6000304]="RoomModuleJoinRoomError",b[b.RoomModuleLeaveRoomError=6000306]="RoomModuleLeaveRoomError",b[b.RoomModuleTheRoomMemberQueryFailed=6000310]="RoomModuleTheRoomMemberQueryFailed",b[b.RoomModuleTheRoomMembersQueryFailedCompletely=6000311]="RoomModuleTheRoomMembersQueryFailedCompletely",b[b.RoomModuleUserIsNotInTheRoom=6000321]="RoomModuleUserIsNotInTheRoom",b[b.RoomModuleTheRoomDoesNotExist=6000322]="RoomModuleTheRoomDoesNotExist",b[b.RoomModuleTheRoomAlreadyExists=6000323]="RoomModuleTheRoomAlreadyExists",b[b.RoomModuleTheNumberOfExistingRoomsHasReachedLimit=6000324]="RoomModuleTheNumberOfExistingRoomsHasReachedLimit",b[b.RoomModuleTheNumberOfJoinedRoomsHasReachedLimit=6000325]="RoomModuleTheNumberOfJoinedRoomsHasReachedLimit",b[b.RoomModuleRoomAttributesCommonError=6000330]="RoomModuleRoomAttributesCommonError",b[b.RoomModuleRoomAttributesOperationFailedCompletely=6000331]="RoomModuleRoomAttributesOperationFailedCompletely",b[b.RoomModuleRoomAttributesQueryFailed=6000333]="RoomModuleRoomAttributesQueryFailed",b[b.RoomModuleTheNumberOfRoomAttributesExceedsLimit=6000334]="RoomModuleTheNumberOfRoomAttributesExceedsLimit",b[b.RoomModuleTheLengthOfRoomAttributeKeyExceedsLimit=6000335]="RoomModuleTheLengthOfRoomAttributeKeyExceedsLimit",b[b.RoomModuleTheLengthOfRoomAttributeValueExceedsLimit=6000336]="RoomModuleTheLengthOfRoomAttributeValueExceedsLimit",b[b.RoomModuleTheTotalLengthOfRoomAttributesValueExceedsLimit=6000337]="RoomModuleTheTotalLengthOfRoomAttributesValueExceedsLimit",b[b.RoomModuleRoomMemberAttributesCommonError=6000350]="RoomModuleRoomMemberAttributesCommonError",b[b.RoomModuleTheTotalLengthOfRoomMemberAttributesExceedsLimit=6000351]="RoomModuleTheTotalLengthOfRoomMemberAttributesExceedsLimit",b[b.RoomModuleTheLengthOfRoomMemberAttributesKeyExceedsLimit=6000352]="RoomModuleTheLengthOfRoomMemberAttributesKeyExceedsLimit",b[b.RoomModuleTheLengthOfRoomMemberAttributesValueExceedsLimit=6000353]="RoomModuleTheLengthOfRoomMemberAttributesValueExceedsLimit",b[b.RoomModuleTheMemberNumberOfRoomMemberAttributesExceedsLimit=6000357]="RoomModuleTheMemberNumberOfRoomMemberAttributesExceedsLimit",b[b.GroupModuleCommonError=6000501]="GroupModuleCommonError",b[b.GroupModuleServerError=6000502]="GroupModuleServerError",b[b.GroupModuleCreateGroupError=6000503]="GroupModuleCreateGroupError",b[b.GroupModuleDismissGroupError=6000504]="GroupModuleDismissGroupError",b[b.GroupModuleJoinGroupError=6000505]="GroupModuleJoinGroupError",b[b.GroupModuleLeaveGroupError=6000506]="GroupModuleLeaveGroupError",b[b.GroupModuleKickoutGroupMemberError=6000507]="GroupModuleKickoutGroupMemberError",b[b.GroupModuleInviteUserIntoGroupError=6000508]="GroupModuleInviteUserIntoGroupError",b[b.GroupModuleTransferOwnerError=6000509]="GroupModuleTransferOwnerError",b[b.GroupModuleUpdateGroupInfoError=6000510]="GroupModuleUpdateGroupInfoError",b[b.GroupModuleQueryGroupInfoError=6000511]="GroupModuleQueryGroupInfoError",b[b.GroupModuleGroupAttributesOperationFailed=6000512]="GroupModuleGroupAttributesOperationFailed",b[b.GroupModuleGroupAttributesQueryFailed=6000513]="GroupModuleGroupAttributesQueryFailed",b[b.GroupModuleUpdateGroupMemberInfoError=6000514]="GroupModuleUpdateGroupMemberInfoError",b[b.GroupModuleQueryGroupMemberInfoError=6000515]="GroupModuleQueryGroupMemberInfoError",b[b.GroupModuleQueryGroupListError=6000516]="GroupModuleQueryGroupListError",b[b.GroupModuleQueryGroupMemberListError=6000517]="GroupModuleQueryGroupMemberListError",b[b.GroupModuleUserIsNotInTheGroup=6000521]="GroupModuleUserIsNotInTheGroup",b[b.GroupModuleMemberIsAlreadyInTheGroup=6000522]="GroupModuleMemberIsAlreadyInTheGroup",b[b.GroupModuleGroupDoesNotExist=6000523]="GroupModuleGroupDoesNotExist",b[b.GroupModuleGroupAlreadyExists=6000524]="GroupModuleGroupAlreadyExists",b[b.GroupModuleGroupMemberHasReachedLimit=6000525]="GroupModuleGroupMemberHasReachedLimit",b[b.GroupModuleGroupAttributeDoesNotExist=6000526]="GroupModuleGroupAttributeDoesNotExist",b[b.GroupModuleCreateGroupWithDismissed=6000527]="GroupModuleCreateGroupWithDismissed",b[b.GroupModuleTheNumberOfGroupAttributesExceedsLimit=6000531]="GroupModuleTheNumberOfGroupAttributesExceedsLimit",b[b.GroupModuleTheLengthOfGroupAttributeKeyExceedsLimit=6000532]="GroupModuleTheLengthOfGroupAttributeKeyExceedsLimit",b[b.GroupModuleTheLengthOfGroupAttributeValueExceedsLimit=6000533]="GroupModuleTheLengthOfGroupAttributeValueExceedsLimit",b[b.GroupModuleTheTotalLengthOfGroupAttributesValueExceedsLimit=6000534]="GroupModuleTheTotalLengthOfGroupAttributesValueExceedsLimit",b[b.GroupModuleNoCorrespondingOperationAuthority=6000541]="GroupModuleNoCorrespondingOperationAuthority",b[b.CallModuleCommonError=6000270]="CallModuleCommonError",b[b.CallModuleCancelError=6000271]="CallModuleCancelError",b[b.CallModuleServerError=6000272]="CallModuleServerError",b[b.CallModuleIsNotInvitor=6000273]="CallModuleIsNotInvitor",b[b.CallModuleIsNotInvitee=6000274]="CallModuleIsNotInvitee",b[b.CallModuleAlreadyExists=6000275]="CallModuleAlreadyExists",b[b.CallModuleDoesNotExist=6000276]="CallModuleDoesNotExist",b[b.CallModuleInviteUserDoesNotExist=6000281]="CallModuleInviteUserDoesNotExist",b[b.CallModuleUserAlreadyInTheCall=6000283]="CallModuleUserAlreadyInTheCall"},function(Q,O,b){var T,I,p,k;b.d(O,"b",function(){return T}),b.d(O,"a",function(){return I}),b.d(O,"d",function(){return p}),b.d(O,"c",function(){return k}),(b=T=T||{})[b.Disconnected=0]="Disconnected",b[b.Connecting=1]="Connecting",b[b.Connected=2]="Connected",b[b.Reconnecting=3]="Reconnecting",(O=I=I||{})[O.Success=0]="Success",O[O.ActiveLogin=1]="ActiveLogin",O[O.LoginTimeout=2]="LoginTimeout",O[O.LoginInterrupted=3]="LoginInterrupted",O[O.KickedOut=4]="KickedOut",(b=p=p||{})[b.Low=1]="Low",b[b.Medium=2]="Medium",b[b.High=3]="High",(O=k=k||{})[O.None=0]="None",O[O.Include=1]="Include",O[O.Exclude=2]="Exclude"},function(Q,O,b){var T,I,p;b.d(O,"a",function(){return T}),b.d(O,"b",function(){return I}),b.d(O,"c",function(){return p}),(b=T=T||{})[b.Unknown=-1]="Unknown",b[b.General=0]="General",b[b.Advanced=1]="Advanced",(O=I=I||{})[O.Unknown=-1]="Unknown",O[O.Started=1]="Started",O[O.Ended=2]="Ended",(b=p=p||{})[b.Unknown=-1]="Unknown",b[b.Inviting=0]="Inviting",b[b.Accepted=1]="Accepted",b[b.Rejected=2]="Rejected",b[b.Cancelled=3]="Cancelled",b[b.Offline=4]="Offline",b[b.Received=5]="Received",b[b.Timeout=6]="Timeout",b[b.Quit=7]="Quit",b[b.Ended=8]="Ended"},function(Q,O,b){var T,I,p,k,S,f,d,o,c;b.d(O,"c",function(){return T}),b.d(O,"a",function(){return I}),b.d(O,"b",function(){return p}),b.d(O,"h",function(){return k}),b.d(O,"g",function(){return S}),b.d(O,"d",function(){return f}),b.d(O,"e",function(){return d}),b.d(O,"f",function(){return o}),b.d(O,"i",function(){return c}),(b=T=T||{})[b.Unknown=-1]="Unknown",b[b.Peer=0]="Peer",b[b.Room=1]="Room",b[b.Group=2]="Group",(O=I=I||{})[O.Added=0]="Added",O[O.Updated=1]="Updated",O[O.Disabled=2]="Disabled",O[O.Deleted=3]="Deleted",(b=p=p||{})[b.Notify=1]="Notify",b[b.DoNotDisturb=2]="DoNotDisturb",(O=k=k||{})[O.Unknown=0]="Unknown",O[O.Text=1]="Text",O[O.Command=2]="Command",O[O.Image=11]="Image",O[O.File=12]="File",O[O.Audio=13]="Audio",O[O.Video=14]="Video",O[O.Barrage=20]="Barrage",O[O.System=30]="System",O[O.Revoke=31]="Revoke",O[O.Custom=200]="Custom",(b=S=S||{})[b.Sending=0]="Sending",b[b.Success=1]="Success",b[b.Failed=2]="Failed",(O=f=f||{})[O.Send=0]="Send",O[O.Receive=1]="Receive",(b=d=d||{})[b.None=0]="None",b[b.Processing=1]="Processing",b[b.Done=2]="Done",b[b.Expired=3]="Expired",b[b.Failed=4]="Failed",(O=o=o||{})[O.Unknown=-1]="Unknown",O[O.SelfRevoke=0]="SelfRevoke",O[O.SystemRevoke=1]="SystemRevoke",O[O.ServiceAPIRevoke=2]="ServiceAPIRevoke",O[O.GroupAdminRevoke=3]="GroupAdminRevoke",O[O.GroupOwnerRevoke=4]="GroupOwnerRevoke",(b=c=c||{})[b.TwoWay=0]="TwoWay",b[b.OneWay=1]="OneWay"},function(Q,O,b){var T,I,p,k,S,f;b.d(O,"e",function(){return T}),b.d(O,"f",function(){return I}),b.d(O,"b",function(){return p}),b.d(O,"d",function(){return k}),b.d(O,"c",function(){return S}),b.d(O,"a",function(){return f}),(b=T=T||{})[b.Notify=1]="Notify",b[b.Disturb=2]="Disturb",(O=I=I||{})[O.Quit=0]="Quit",O[O.Enter=1]="Enter",(b=p=p||{})[b.Created=1]="Created",b[b.Dismissed=2]="Dismissed",b[b.Joined=3]="Joined",b[b.Invited=4]="Invited",b[b.Left=5]="Left",b[b.KickedOut=6]="KickedOut",(O=k=k||{})[O.Quit=0]="Quit",O[O.Enter=1]="Enter",(b=S=S||{})[b.Joined=1]="Joined",b[b.Left=2]="Left",b[b.KickedOut=4]="KickedOut",b[b.Invited=5]="Invited",(O=f=f||{})[O.Set=0]="Set",O[O.Delete=1]="Delete"},function(Q,O,b){var T,I,p;b.d(O,"c",function(){return T}),b.d(O,"b",function(){return I}),b.d(O,"a",function(){return p}),(b=T=T||{})[b.Disconnected=0]="Disconnected",b[b.Connecting=1]="Connecting",b[b.Connected=2]="Connected",(O=I=I||{})[O.Success=0]="Success",O[O.NetworkInterrupted=1]="NetworkInterrupted",O[O.NetworkDisconnected=2]="NetworkDisconnected",O[O.RoomNotExist=3]="RoomNotExist",O[O.ActiveCreate=4]="ActiveCreate",O[O.CreateFailed=5]="CreateFailed",O[O.ActiveEnter=6]="ActiveEnter",O[O.EnterFailed=7]="EnterFailed",O[O.KickedOut=8]="KickedOut",O[O.ConnectTimeout=9]="ConnectTimeout",O[O.KickedOutByOtherDevice=10]="KickedOutByOtherDevice",(b=p=p||{})[b.Set=0]="Set",b[b.Delete=1]="Delete"},function(Q,O,b){},function(Q,O,b){var T,I,p,k,S,f,d,o,c,r,t,n,s;b.d(O,"c",function(){return T}),b.d(O,"e",function(){return I}),b.d(O,"h",function(){return p}),b.d(O,"k",function(){return k}),b.d(O,"g",function(){return S}),b.d(O,"i",function(){return f}),b.d(O,"j",function(){return d}),b.d(O,"f",function(){return o}),b.d(O,"l",function(){return c}),b.d(O,"m",function(){return r}),b.d(O,"d",function(){return t}),b.d(O,"b",function(){return n}),b.d(O,"a",function(){return s}),(b=T=T||{})[b.Cancel=0]="Cancel",b[b.Timeout=1]="Timeout",(O=I=I||{})[O.Normal=0]="Normal",O[O.Disable=1]="Disable",O[O.Delete=2]="Delete",(b=p=p||{})[b.Notice=0]="Notice",b[b.Name=1]="Name",b[b.Avatar=2]="Avatar",(O=k=k||{})[O.Owner=1]="Owner",O[O.Member=3]="Member",(b=S=S||{})[b.Set=0]="Set",b[b.Delete=1]="Delete",b[b.Push=2]="Push",b[b.Query=3]="Query",(O=f=f||{})[O.None=0]="None",O[O.Enter=1]="Enter",O[O.Quit=2]="Quit",O[O.Modify=3]="Modify",O[O.Kickout=4]="Kickout",O[O.Invited=5]="Invited",O[O.OwnerQuit=6]="OwnerQuit",(b=d=d||{})[b.Nickname=0]="Nickname",b[b.Role=1]="Role",(O=o=o||{})[O.Other=0]="Other",O[O.SDKLogin=1]="SDKLogin",O[O.SDKPush=2]="SDKPush",O[O.SDKHb=3]="SDKHb",O[O.Biz=4]="Biz",(b=c=c||{}).Insert="Insert",b.Sending="Sending",b.Sended="Sended",b.Fetch="Fetch",b.Push="Push",(O=r=r||{})[O.None=0]="None",O[O.RevokeSelf=4]="RevokeSelf",O[O.RevokeSystem=8]="RevokeSystem",O[O.RevokeService=12]="RevokeService",O[O.RevokeGroupAdmin=16]="RevokeGroupAdmin",O[O.RevokeGroupOwner=20]="RevokeGroupOwner",O[O.ReceiptDone=64]="ReceiptDone",O[O.ReceiptExpired=128]="ReceiptExpired",O[O.ReceiptFailed=192]="ReceiptFailed",O[O.ReceiptDoing=256]="ReceiptDoing",O[O.VoteDoing=1024]="VoteDoing",O[O.VoteDone=2048]="VoteDone",(b=t=t||{})[b.DontDisturb=-1]="DontDisturb",b[b.RecoverDisturb=0]="RecoverDisturb",b[b.HandleMessage=1]="HandleMessage",(O=n=n||{})[O.Insert=0]="Insert",O[O.Remove=1]="Remove",(b=s=s||{})[b.FetchAll=0]="FetchAll",b[b.FetchMessageList=1]="FetchMessageList",b[b.FetchMessageStatusList=2]="FetchMessageStatusList"},function(Q,O,b){b.d(O,"d",function(){return p}),b.d(O,"c",function(){return T}),b.d(O,"b",function(){return I}),b.d(O,"a",function(){return k});var T,I,p=100021,k=((b=T=T||{})[b.SDK=0]="SDK",b[b.API=1]="API",(O=I=I||{})[O.Low=0]="Low",O[O.Medium=1]="Medium",O[O.High=2]="High",O[O.Highest=3]="Highest",{Accesshub:{cmd:"Accesshub"},sw_handshake_req:{cmd:"/sw/handshake_req",req:"HandshakeReq"},sw_login:{cmd:"/sw/login",req:"LoginReq",rsp:"LoginRsp",w:I.Highest},sw_logout:{cmd:"/sw/logout",req:"LogoutReq",rsp:"CommonCodeMessage",w:I.Highest},sw_renew_token:{cmd:"/sw/renew_token",req:"ModifyUserInfoReq",rsp:"CommonCodeMessage",w:I.Highest},sw_hb:{cmd:"/sw/hb",req:"ModifyUserInfoReq",rsp:"HbRsp",w:I.Highest},sw_push_kickout:{cmd:"/sw/push_kickout",rsp:"ErrList"},sw_push_redirect:{cmd:"/sw/push_redirect",rsp:"UserInfo"},sw_push_list:{cmd:"/sw/push_list",rsp:"PushListRequest"},sw_push_list_rsp:{cmd:"/sw/push_list_rsp",req:"PushListRsp"},p_detaillog_report:{cmd:"/im/push_detaillog_report",rsp:"CommonCodeMessage"},p_user_modify:{cmd:"/im/push_modify_userinfo",rsp:"ModifyUserInfoReq"},p_msg_delete:{cmd:"/im/push_conv_msg_delete",rsp:"PushDelConvMsg"},p_conv_delete:{cmd:"/im/push_conv_delete",rsp:"ConvInfo"},p_conv_readseq:{cmd:"/im/push_update_readseq",rsp:"ConvInfo"},p_conv_mute:{cmd:"/im/push_group_mute",rsp:"ConvInfo"},p_conv_pinned:{cmd:"/im/push_conv_pinned",rsp:"PushPinnedConvChange"},p_group_enter:{cmd:"/im/push_enter_group",rsp:"PushEnterGroup"},p_group_quit:{cmd:"/im/push_quit_group",rsp:"PushGroupOwnerTransfer"},p_del_all_conv:{cmd:"/im/push_del_all_conv",rsp:"StMsgClientInfo"},p_clean_unread:{cmd:"/im/push_clean_unread",rsp:"StMsgClientInfo"},modify_user_info:{cmd:"/sw/modify_info",req:"ModifyUserInfoReq",rsp:"CommonCodeMessage",w:I.Medium},fetch_user_info:{cmd:"/im/account/fetch_user_info",req:"UserInfo",rsp:"UserInfoRsp",w:I.Low},userstate_zpns_report:{cmd:"/im/userstate/zpns_report",req:"StGroupAttribute",rsp:"CommonCodeMessage",w:I.Medium},usermail_hb:{cmd:"/im/usermail/hb",req:"StMsgClientInfo",rsp:"UserMailHbRsp",w:I.Highest},usermail_convlist:{cmd:"/im/usermail/convlist",req:"GetConvListReq",rsp:"GetConvListRsp",w:I.Highest},usermail_del_conv:{cmd:"/im/usermail/del_conv",req:"UpdateReadSeqReq",rsp:"ConvDelRsp",w:I.Medium},usermail_del_all_conv:{cmd:"/im/usermail/del_all_conv",req:"StMsgClientInfo",rsp:"CommonCodeMessage",w:I.Medium},usermail_update_read_seq:{cmd:"/im/usermail/update_read_seq",req:"UpdateReadSeqReq",rsp:"CommonCodeMessage",w:I.Medium},usermail_clean_all_unread:{cmd:"/im/usermail/clean_all_unread",req:"StMsgClientInfo",rsp:"CommonCodeMessage",w:I.Medium},usermail_modify_conv_pinned_lv:{cmd:"/im/usermail/conv_pinned",req:"ConvModifyPinnedLvReq",rsp:"ConvDelRsp",w:I.High},usermail_convpinnedlist:{cmd:"/im/usermail/convpinnedlist",req:"GetConvListReq",rsp:"GetConvListRsp",w:I.High},c2c_msg:{cmd:"/im/c2c/msg",req:"C2CMsgReq",rsp:"C2CMsgRsp",w:I.High},c2c_command:{cmd:"/im/c2c/command",req:"C2CCommandReq",rsp:"C2CCommandReqRsp",w:I.High},c2c_msglist:{cmd:"/im/usermail/msglist",req:"FetchConvMsgReq",rsp:"FetchConvMsgRsp",w:I.High},c2c_query_msg:{cmd:"/im/usermail/query_msg",req:"QueryRoomMsgReq",rsp:"QueryRoomMsgRsp",w:I.High},c2c_del_msg:{cmd:"/im/usermail/del_msg_by_msgid",req:"ConvDelMsgByMsgIdReq",rsp:"CommonCodeMessage",w:I.Medium},c2c_del_all_msg:{cmd:"/im/usermail/del_all_msg",req:"UpdateReadSeqReq",rsp:"CommonCodeMessage",w:I.Medium},c2c_fetch_msg:{cmd:"/im/usermail/fetch_c2c_msg",req:"FetchC2CMsgReq",rsp:"FetchC2CMsgRsp",w:I.Low},group_msg:{cmd:"/im/group/msg",req:"C2CMsgReq",rsp:"GroupMsgRsp",w:I.High},group_command:{cmd:"/im/group/command",req:"C2CCommandReq",rsp:"C2CCommandReqRsp",w:I.High},group_msglist:{cmd:"/im/group/msglist",req:"FetchGroupMsgList",rsp:"FetchGroupMsgListRsp",w:I.High},group_query_msg:{cmd:"/im/group/query_msg",req:"QueryRoomMsgReq",rsp:"QueryRoomMsgRsp",w:I.High},group_del_msg:{cmd:"/im/group/del_msg",req:"C2CReadReceiptReq",rsp:"CommonCodeMessage",w:I.Medium},group_del_all_msg:{cmd:"/im/group/del_all_msg",req:"C2CReadReceiptReq",rsp:"CommonCodeMessage",w:I.Medium},room_msg:{cmd:"/im/room/msg",req:"RoomMsgReq",rsp:"RoomMsgRsp",w:I.High},room_command:{cmd:"/im/msg/room_msg",req:"RoomCommandMsgReq",rsp:"RoomMsgRsp",w:I.High},room_msglist:{cmd:"/im/room/room_msglist",req:"RoomMsglistReq",rsp:"RoomMsglistRsp",w:I.High},room_query_msg:{cmd:"/im/room/query_msg",req:"QueryRoomMsgReq",rsp:"QueryRoomMsgRsp",w:I.High},p_c2c_msg:{cmd:"/im/push_c2c_msg",rsp:"PushGroupMsg"},p_c2c_command:{cmd:"/im/push_c2c_command",rsp:"PushC2CCommand"},p_group_msg:{cmd:"/im/push_group_msg",rsp:"PushGroupMsg"},p_group_command:{cmd:"/im/push_group_command_msg",rsp:"PushGroupCommand"},p_room_msg:{cmd:"/im/push_roommsg",rsp:"PushRoomMsg"},p_room_command:{cmd:"/im/push_room_msg",rsp:"PushRoomCommand"},p_msg_to_all_users:{cmd:"/im/push_msg_to_all_users",rsp:"PushGroupMsg"},file_upload:{cmd:"/im/file/upload",req:"FileUploadReq",rsp:"FileUploadRsp",w:I.High},file_process:{cmd:"/im/file/process",req:"FileUploadReq",rsp:"FileProcessRsp",w:I.High},file_del:{cmd:"/im/file/delete",req:"FileUploadReq",rsp:"CommonCodeMessage",w:I.Low},c2c_msg_state_list:{cmd:"/im/usermail/statemsg_list",req:"GetStatemsgListReq",rsp:"GetStatemsgListRsp",w:I.Medium},group_msg_state_list:{cmd:"/im/group/statemsg_list",req:"GetStatemsgListReq",rsp:"GetStatemsgListRsp",w:I.Medium},extra_msglist:{cmd:"/im/usermail/extra_msglist",req:"GetExtraMsgListReq",rsp:"GetExtraMsgListRsp",w:I.Medium},c2c_conv_read_receipt:{cmd:"/im/usermail/conv_read",req:"GetGroupReadReceiptDetailReq",rsp:"ConvDelRsp",w:I.Medium},c2c_msg_read_receipt:{cmd:"/im/usermail/read_receipt",req:"C2CReadReceiptReq",rsp:"C2CReadReceiptRsp",w:I.Medium},group_msg_read_receipt:{cmd:"/im/group/read_receipt",req:"C2CReadReceiptReq",rsp:"C2CReadReceiptRsp",w:I.Medium},msg_read_receipt_detail:{cmd:"/im/usermail/receipt_detail",req:"GetGroupReadReceiptDetailReq",rsp:"GetGroupReadReceiptDetailRsp",w:I.Medium},c2c_msg_revoke:{cmd:"/im/usermail/msg_revoke",req:"RevokeMsgReq",rsp:"RevokeMsgRsp",w:I.Medium},group_msg_revoke:{cmd:"/im/group/msg_revoke",req:"RevokeMsgReq",rsp:"RevokeMsgRsp",w:I.Medium},c2c_add_reaction:{cmd:"/im/usermail/add_reaction",req:"SetReactionReq",rsp:"SetReactionRsp",w:I.Medium},c2c_del_reaction:{cmd:"/im/usermail/del_reaction",req:"DelReactionReq",rsp:"SetReactionRsp",w:I.Medium},c2c_get_reaction:{cmd:"/im/usermail/get_reaction_info",req:"ReactionInfoReq",rsp:"ReactionInfoRsp",w:I.Medium},c2c_reaction_list:{cmd:"/im/usermail/reaction_list",req:"ReactionListReq",rsp:"ReactionListRsp",w:I.Medium},group_add_reaction:{cmd:"/im/group/add_reaction",req:"SetReactionReq",rsp:"SetReactionRsp",w:I.Medium},group_del_reaction:{cmd:"/im/group/del_reaction",req:"DelReactionReq",rsp:"SetReactionRsp",w:I.Medium},group_get_reaction:{cmd:"/im/group/get_reaction_info",req:"ReactionInfoReq",rsp:"ReactionInfoRsp",w:I.Medium},group_reaction_list:{cmd:"/im/group/reaction_list",req:"ReactionListReq",rsp:"ReactionListRsp",w:I.Medium},p_read_receipt:{cmd:"/im/push_read_receipt",rsp:"PushReadReceipt"},p_msg_revoke:{cmd:"/im/push_msg_revoke",rsp:"PushMsgRevoke"},p_reaction:{cmd:"/im/push_reaction",rsp:"PushMsgReaction"},room_create:{cmd:"/im/room/create",req:"RoomCreateReq",rsp:"RoomCreateRsp",w:I.High},room_enter:{cmd:"/im/room/enter",req:"RoomEnterReq",rsp:"RoomEnterRsp",w:I.High},room_quit:{cmd:"/im/room/quit",req:"QueryRoomUserInfosReq",rsp:"CommonCodeMessage",w:I.High},room_info:{cmd:"/im/room/info",req:"QueryRoomUserInfosReq",rsp:"RoomInfoRsp",w:I.Highest},room_userlist:{cmd:"/im/room/userlist",req:"RoomUserlistReq",rsp:"RoomUserlistRsp",w:I.Medium},room_userinfos:{cmd:"/im/room/user_infos",req:"QueryRoomUserInfosReq",rsp:"UserInfoRsp",w:I.Medium},room_attributes:{cmd:"/im/room/get_attributes",req:"GetRoomAttributesReq",rsp:"ModifyRoomAttributesRsp",w:I.Low},room_attributes_modify:{cmd:"/im/room/modify_attributes",req:"ModifyRoomAttributesReq",rsp:"ModifyRoomAttributesRsp",w:I.Medium},room_user_attributes_modify:{cmd:"/im/room/modify_user_attributes",req:"ModifyRoomUserAttributesReq",rsp:"ModifyRoomUserAttributesRsp",w:I.Medium},room_user_attributes_get:{cmd:"/im/room/get_user_attributes",req:"GetRoomUserAttributesReq",rsp:"ModifyRoomUserAttributesRsp",w:I.Medium},room_user_attributes_list_get:{cmd:"/im/room/get_user_attribute_list",req:"GetRoomUserAttributeListReq",rsp:"GetRoomUserAttributeListRsp",w:I.Medium},p_room_enter:{cmd:"/im/push_room_enter",rsp:"PushRoomEnter"},p_room_quit:{cmd:"/im/push_room_quit",rsp:"PushRoomEnter"},p_room_kickout:{cmd:"/im/push_room_kickout",rsp:"PushRoomKickout"},p_room_attrs:{cmd:"/im/push_room_attrs_modify",rsp:"PushRoomAttributesModify"},p_room_user_attrs:{cmd:"/im/push_room_user_attrs_modify",rsp:"PushRoomUserAttributesModify"},group_create:{cmd:"/im/group/create",req:"GroupCreateReq",rsp:"GroupCreateRsp",w:I.Medium},group_enter:{cmd:"/im/group/enter",req:"GroupInviteReq",rsp:"GroupEnterRsp",w:I.Medium},group_invite:{cmd:"/im/group/invite",req:"GroupInviteReq",rsp:"GroupInviteRsp",w:I.Medium},group_quit:{cmd:"/im/group/quit",req:"GroupInviteReq",rsp:"ConvDelRsp",w:I.Medium},group_kickout:{cmd:"/im/group/kickout",req:"GroupInviteReq",rsp:"GroupKickOutRsp",w:I.Medium},group_destroy:{cmd:"/im/group/destroy",req:"GroupInviteReq",rsp:"ConvDelRsp",w:I.Medium},group_list:{cmd:"/im/usermail/grouplist",req:"GetConvListReq",rsp:"GroupListRsp",w:I.High},group_infos:{cmd:"/im/group/infos",req:"UserInfo",rsp:"GroupInfosRsp",w:I.Low},group_owner_transfer:{cmd:"/im/group/owner_transfer",req:"GroupCreateReq",rsp:"ConvDelRsp",w:I.Medium},group_data:{cmd:"/im/group/data",req:"GroupInviteReq",rsp:"GroupDataRsp",w:I.Medium},group_attributes:{cmd:"/im/group/get_attributes",req:"GroupGetAttributesReq",rsp:"GroupModifyAttributeRsp",w:I.Low},group_mute:{cmd:"/im/group/mute",req:"GroupMuteReq",rsp:"ConvDelRsp",w:I.Medium},group_modify_name:{cmd:"/im/group/modify_group_name",req:"GroupCreateReq",rsp:"ConvDelRsp",w:I.Medium},group_modify_avatar:{cmd:"/im/group/modify_group_avatar",req:"StUserInfo",rsp:"ConvDelRsp",w:I.Medium},group_modify_notice:{cmd:"/im/group/modify_group_notice",req:"GroupCreateReq",rsp:"ConvDelRsp",w:I.Medium},group_modify_attributes:{cmd:"/im/group/modify_attribute",req:"GroupModifyAttributeReq",rsp:"GroupModifyAttributeRsp",w:I.Medium},group_member_list:{cmd:"/im/group/members",req:"GroupGetMembersReq",rsp:"GroupGetMembersRsp",w:I.Medium},group_members_by_seq:{cmd:"/im/group/members_by_seq",req:"C2CReadReceiptReq",rsp:"GetGroupMembersByMemberSeqRsp",w:I.Medium},group_member_data:{cmd:"/im/group/member_data",req:"GroupMemberDataReq",rsp:"GroupMemberDataRsp",w:I.Low},group_member_nickname_set:{cmd:"/im/group/set_nickname",req:"GroupCreateReq",rsp:"ConvDelRsp",w:I.Medium},group_member_role_set:{cmd:"/im/group/set_member_role",req:"GroupSetMemberRoleReq",rsp:"ConvDelRsp",w:I.Medium},p_group_create:{cmd:"/im/push_create_group",rsp:"PushCreateGroup"},p_group_invite:{cmd:"/im/push_group_invite",rsp:"PushGroupInvite"},p_group_destroy:{cmd:"/im/push_group_destroy",rsp:"PushModifyGroupData"},p_group_owner_transfer:{cmd:"/im/push_group_owner_transfer",rsp:"PushGroupOwnerTransfer"},p_group_modify_attributes:{cmd:"/im/push_modify_group_attribute",rsp:"PushModifyGroupAttribute"},p_group_modify_data:{cmd:"/im/push_modify_group_data",rsp:"PushModifyGroupData"},p_group_member_change:{cmd:"/im/push_group_member_change",rsp:"PushGroupMemberChange"},p_group_member_kickout:{cmd:"/im/push_group_member_kickout",rsp:"PushGroupOwnerTransfer"},call_create:{cmd:"/im/call/create",req:"CallReq",rsp:"CallRsp",w:I.High},call_cancel:{cmd:"/im/call/cancel",req:"CallReq",rsp:"CallCancelRsp",w:I.High},call_accept:{cmd:"/im/call/accept",req:"StUserInfo",rsp:"CallQuitRsp",w:I.High},call_refuse:{cmd:"/im/call/refuse",req:"CallQuitReq",rsp:"CallQuitRsp",w:I.High},call_ack:{cmd:"/im/call/ack",req:"CallQuitReq",rsp:"CommonCodeMessage",w:I.High},call_info:{cmd:"/im/call/call_info",req:"CallQuitReq",rsp:"CallInfoRsp",w:I.Medium},call_invite:{cmd:"/im/call/invite",req:"CallInviteReq",rsp:"CallInviteRsp",w:I.High},call_quit:{cmd:"/im/call/quit",req:"CallQuitReq",rsp:"CallQuitRsp",w:I.High},call_enter:{cmd:"/im/call/enter",req:"CallEnterReq",rsp:"CallEnterRsp",w:I.High},call_destroy:{cmd:"/im/call/destroy",req:"CallQuitReq",rsp:"CallQuitRsp",w:I.High},call_list:{cmd:"/im/usermail/call_list",req:"CallListReq",rsp:"CallListRsp",w:I.Medium},p_call_invite:{cmd:"/im/push_call_invite",rsp:"PushCallInvited"},p_call_cancel:{cmd:"/im/push_call_cancel",rsp:"PushCallCancel"},p_call_accept:{cmd:"/im/push_call_accept",rsp:"PushCallAccept"},p_call_refuse:{cmd:"/im/push_call_refuse",rsp:"PushCallRefuse"},p_call_quit:{cmd:"/im/push_call_quit",rsp:"PushCallQuit"},p_call_destroy:{cmd:"/im/push_call_destroy",rsp:"PushCallDestroy"},p_call_inviting:{cmd:"/im/push_on_call_invite",rsp:"PushOnCallInvited"},p_call_ack:{cmd:"/im/push_call_ack",rsp:"PushCallAck"},p_call_enter:{cmd:"/im/push_call_enter",rsp:"PushCallEnter"}})},function(Q,O,b){b.d(O,"b",function(){return T}),b.d(O,"a",function(){return I}),b.d(O,"c",function(){return p}),(b=T=T||{}).ILogined="logined",b.ILogout="logout",b.IUpdateSelf="updateSelf",b.IJoinedGroup="joinedGroup",b.ILeftGroup="leftGroup",b.ISyncGroups="syncGroups",b.ISyncGroupInfo="syncGroupInfo",b.IUnreadMsgCount="unreadMsgCount",b.IConnectedRoom="connectedRoom",b.IConnected="connected",b.IDisConnected="disConnected",b.INetworkChange="networkChange",b.IIdleFetchConvMsg="idleFetchConvMsg",b.ITriggerHB="triggerHB",b.IQPSSend="QPSSend",b.Error="error",b.ConnState="connectionStateChanged",b.TokenExpire="tokenWillExpire",b.UserInfoUpdated="userInfoUpdated",b.ConvChanged="conversationChanged",b.ConvUnreadMsgCount="conversationTotalUnreadMessageCountUpdated",b.ConvMsgReceipt="conversationMessageReceiptChanged",b.ConvAllDeleted="conversationsAllDeleted",b.MsgReceipt="messageReceiptChanged",b.MsgRevoke="messageRevokeReceived",b.MsgReactions="messageReactionsChanged",b.MsgDeleted="messageDeleted",b.MsgSentStatus="messageSentStatusChanged",b.RecvPeerMsg="receivePeerMessage",b.RecvGroupMsg="receiveGroupMessage",b.RecvRoomMsg="receiveRoomMessage",b.BroadcastMsg="broadcastMessageReceived",b.RoomState="roomStateChanged",b.RoomMemberJoined="roomMemberJoined",b.RoomMemberLeft="roomMemberLeft",b.RoomAttr="roomAttributesUpdated",b.RoomAttrBatch="roomAttributesBatchUpdated",b.RoomMemberAttr="roomMemberAttributesUpdated",b.GroupState="groupStateChanged",b.GroupName="groupNameUpdated",b.GroupNotice="groupNoticeUpdated",b.GroupAvatar="groupAvatarUrlUpdated",b.GroupAttr="groupAttributesUpdated",b.GroupMemberState="groupMemberStateChanged",b.GroupMemberInfo="groupMemberInfoUpdated",b.CallRecv="callInvitationReceived",b.CallCancel="callInvitationCancelled",b.CallTimeout="callInvitationTimeout",b.CallEnd="callInvitationEnded",b.CallUserState="callUserStateChanged",b.CallAccept="callInvitationAccepted",b.CallReject="callInvitationRejected",b.CallAnswerTimeout="callInviteesAnsweredTimeout";var T,I={MAX_ID_SIZE:1024,MAX_NAME_SIZE:2048,MAX_MESSAGE_SIZE:49152,MESSAGE_SEQ_MULTIPLIER:100,get_user_attribute_qps:5,get_user_attribute_interval:3e4,hbTimeoutMaxCount:3,needReloginCodeList:[50107,103015,103021]},p={2:{relatives:[],host:k(2)},3:{relatives:[7],host:k(3)},4:{relatives:[7],host:k(4)},5:{relatives:[7],host:k(5)},6:{relatives:[7],host:k(6)},7:{relatives:[3,4,5,6,1],host:k(7)},1:{relatives:[7],host:{accesshub:"wss://accesshub-wss.zego.im/accesshub",logreport:"wss://weblogger-wss.zego.im/zglog/web",detaillog:"https://detaillog-global.zego.im",fileproxy:"https://access-zfpxy-global.zego.im"}}};function k(S){return{accesshub:"wss://accesshub-wss"+(S="-geo-"+S+".zego.im")+"/accesshub",logreport:"wss://weblogger-wss"+S+"/zglog/web",detaillog:"https://detaillog"+S,fileproxy:"https://access-zfpxy"+S}}},function(Q,O,b){b.d(O,"a",function(){return T});var T={Log:"Log",DataReport:"DataReport",User:"User",Call:"Call",Conv:"Conversation",Group:"Group",MessageExtra:"MessageExtra",Member:"GroupMember",Message:"Message"}},function(Q,O,b){var T,I;b.d(O,"b",function(){return T}),b.d(O,"a",function(){return I}),(b=T=T||{}).Manager="MGR",b.Connection="Conn",b.Database="DB",b.User="User",b.Conversation="Conv",b.Strategy="ST",b.Room="Room",b.Group="Group",b.Call="Call",(O=I=I||{}).SCMD="SCMD",O.PCMD="PCMD",O.Create="API.create",O.Destroy="API.destroy",O.SetLogConfig="API.setLogConfig",O.SetGeoFence="API.setGeofencingConfig",O.UploadLog="API.uploadLog",O.Login="API.login",O.Logout="API.logout",O.RenewToken="API.renewToken",O.QueryUsersInfo="API.queryUsersInfo",O.UpdateUserName="API.updateUserName",O.UpdateUserAvatarUrl="API.updateUserAvatarUrl",O.UpdateUserExtendedData="API.updateUserExtendedData",O.QueryConv="API.queryConversation",O.QueryConvList="API.queryConversationList",O.QueryPinnedList="API.queryConversationPinnedList",O.DeleteConv="API.deleteConversation",O.DeleteAllConv="API.deleteAllConversations",O.ClearUnreadCount="API.clearConversationUnreadMessageCount",O.ClearAllUnreadCount="API.clearConversationTotalUnreadMessageCount",O.SetNotificationStatus="API.setConversationNotificationStatus",O.UpdatePinnedState="API.updateConversationPinnedState",O.SendMessage="API.sendMessage",O.SendMediaMessage="API.sendMediaMessage",O.DeleteMessages="API.deleteMessages",O.DeleteAllMessage="API.deleteAllMessage",O.QueryHistoryMessage="API.queryHistoryMessage",O.InsertMessageToLocalDB="API.insertMessageToLocalDB",O.UpdateMessageLocalExtendedData="API.updateMessageLocalExtendedData",O.RevokeMessage="API.revokeMessage",O.SendReceiptRead="API.sendConversationMessageReceiptRead",O.SendMessageReceiptsRead="API.sendMessageReceiptsRead",O.QueryReceiptsInfo="API.queryMessageReceiptsInfo",O.QueryReceiptReadMemberList="API.queryGroupMessageReceiptReadMemberList",O.QueryReceiptUnreadMemberList="API.queryGroupMessageReceiptUnreadMemberList",O.AddReaction="API.addMessageReaction",O.DeleteReaction="API.deleteMessageReaction",O.QueryReaction="API.queryMessageReactionUserList",O.CreateRoom="API.createRoom",O.JoinRoom="API.joinRoom",O.LeaveRoom="API.leaveRoom",O.QueryRoomMemberList="API.queryRoomMemberList",O.QueryRoomMembers="API.queryRoomMembers",O.QueryRoomOnlineMemberCount="API.queryRoomOnlineMemberCount",O.SetRoomAttributes="API.setRoomAttributes",O.DeleteRoomAttributes="API.deleteRoomAttributes",O.QueryRoomAllAttributes="API.queryRoomAllAttributes",O.BeginRoomAttributesBatchOperation="API.beginRoomAttributesBatchOperation",O.EndRoomAttributesBatchOperation="API.endRoomAttributesBatchOperation",O.SetRoomMembersAttributes="API.setRoomMembersAttributes",O.QueryRoomMembersAttributes="API.queryRoomMembersAttributes",O.QueryRoomMemberAttributesList="API.queryRoomMemberAttributesList",O.CreateGroup="API.createGroup",O.EnterRoom="API.enterRoom",O.JoinGroup="API.joinGroup",O.DismissGroup="API.dismissGroup",O.LeaveGroup="API.leaveGroup",O.InviteUsersIntoGroup="API.inviteUsersIntoGroup",O.KickGroupMembers="API.kickGroupMembers",O.QueryGroupList="API.queryGroupList",O.QueryGroupMemberList="API.queryGroupMemberList",O.QueryGroupMemberCount="API.queryGroupMemberCount",O.TransferGroupOwner="API.transferGroupOwner",O.QueryGroupInfo="API.queryGroupInfo",O.UpdateGroupName="API.updateGroupName",O.UpdateGroupNotice="API.updateGroupNotice",O.UpdateGroupAvatarUrl="API.updateGroupAvatarUrl",O.SetGroupAttributes="API.setGroupAttributes",O.DeleteGroupAttributes="API.deleteGroupAttributes",O.QueryGroupAttributes="API.queryGroupAttributes",O.SetGroupMemberNickname="API.setGroupMemberNickname",O.SetGroupMemberRole="API.setGroupMemberRole",O.QueryGroupMemberInfo="API.queryGroupMemberInfo",O.CallInvite="API.callInvite",O.CallCancel="API.callCancel",O.CallAccept="API.callAccept",O.CallReject="API.callReject",O.CallQuit="API.callQuit",O.callJoin="API.callJoin",O.CallEnd="API.callEnd",O.CallingInvite="API.callingInvite",O.QueryCallList="API.queryCallInvitationList",O.SearchConvs="API.searchLocalConversations",O.SearchGlobalMessages="API.searchGlobalLocalMessages",O.SearchMessages="API.searchLocalMessages",O.SearchGroups="API.searchLocalGroups",O.SearchGroupMembers="API.searchLocalGroupMembers"},function(Q,O){throw new Error(`Module parse failed: Unexpected token (6:29)
You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders
| import { ZIMLogTag } from '../entity';
| 
> export class ZIMFileStoreBase<T extends Record<string, any>> {
|     private logger = ZIMManager.getInstance().logger;
|     private logTags: string;`)},function(Q,O){throw new Error(`Module parse failed: Unexpected token (31:26)
You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders
| } from '../entity';
| 
> export class ZIMStoreImpl implements ZIMStoreBase {
|     private userID = '';
|     private userStore: ZIMFileStoreBase<ZIMDBUser>;`)},function(Q,O,b){b.r(O),b.d(O,"ZIMStoreImpl",function(){return o}),O=b(78);var T=b.n(O),I=b(2),p=b(15),k=b(0),S=function(r,t,n,s){return new(n=n||Promise)(function(u,a){function i(m){try{h(s.next(m))}catch(g){a(g)}}function l(m){try{h(s.throw(m))}catch(g){a(g)}}function h(m){var g;m.done?u(m.value):((g=m.value)instanceof n?g:new n(function(y){y(g)})).then(i,l)}h((s=s.apply(r,t||[])).next())})},f=function(r,t){var n,s,u,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function l(h){return function(m){var g=[h,m];if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,s&&(u=2&g[0]?s.return:g[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,g[1])).done)return u;switch(s=0,(g=u?[2&g[0],u.value]:g)[0]){case 0:case 1:u=g;break;case 4:return a.label++,{value:g[1],done:!1};case 5:a.label++,s=g[1],g=[0];continue;case 7:g=a.ops.pop(),a.trys.pop();continue;default:if(!(u=0<(u=a.trys).length&&u[u.length-1])&&(g[0]===6||g[0]===2)){a=0;continue}if(g[0]===3&&(!u||g[1]>u[0]&&g[1]<u[3])){a.label=g[1];break}if(g[0]===6&&a.label<u[1]){a.label=u[1],u=g;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(g);break}u[2]&&a.ops.pop(),a.trys.pop();continue}g=t.call(r,a)}catch(y){g=[6,y],s=0}finally{n=u=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}},d=k.J.Database,o=(c.prototype.destroy=function(){this.storeMap.forEach(function(r){return r.close()}),this.storeMap.clear(),this.unloadDB()},c.prototype.clearDB=function(r){var t=this;this.unloadDB(),I.a.getInstance().dataReport.clearDB(),this.createStaticDB().then(function(n){n.transaction([k.r.Log],"readwrite").objectStore(k.r.Log).clear(),n.transaction([k.r.DataReport],"readwrite").objectStore(k.r.DataReport).clear(),n.transaction([k.r.User],"readwrite").objectStore(k.r.User).put(r),t.innerDeleteAllByOwnerID(n,k.r.Call,t.userID),t.innerDeleteAllByOwnerID(n,k.r.Conv,t.userID),t.innerDeleteAllByOwnerID(n,k.r.Group,t.userID),t.innerDeleteAllByOwnerID(n,k.r.MessageExtra,t.userID)}),this.createGlobalDB().then(function(n){n.transaction([k.r.Member],"readwrite").objectStore(k.r.Member).clear(),n.transaction([k.r.Message],"readwrite").objectStore(k.r.Message).clear()})},c.prototype.loadDB=function(){var r=this,t=Date.now();this.createGlobalDB().then(function(n){return r.innerGetAll(n,k.r.Member,"loadGDB")}).then(function(n){n.forEach(function(s){return r.globalMemberMap.set(s.id,s)}),r.reportLog.memberTime=Date.now()-t,r.handleMemberCallbackList(),setTimeout(function(){return r.copyOldDB2GlobalDB()},1e3)})},c.prototype.unloadDB=function(){this.isGlobalMsg=!1,this.isGlobalMember=!1,this.globalMsgMap.clear(),this.globalMemberMap.clear(),this.searchMsgByConvCallbackList.length=0,this.searchMsgCallbackList.length=0,this.searchGroupsCallbackList.length=0,this.searchMembersCallbackList.length=0,this.getMembersCallbackList.length=0},c.prototype.searchConversations=function(r){var t=this;return new Promise(function(n){var s=new Date;t.innerSearchMessagesByConv(!0,r,function(u){var a=u.length,i=(u.forEach(function(y){y.messageList.sort(function(w,M){return M.timestamp-w.timestamp}),y.totalMessageCount>r.conversationMessageCount&&(y.messageList=y.messageList.slice(0,r.conversationMessageCount))}),u.sort(function(y,w){return w.messageList[0].timestamp-y.messageList[0].timestamp}),r.nextFlag),l=i?u.findIndex(function(y){return y.messageList[0].timestamp<=i})+1:0,h=l+r.totalConversationCount,m=u[h]?u[h-1].messageList[0].timestamp:void 0,g=(u=u.slice(l,h),t.globalMsgMap.size);g={time:s,dbCount:g,start:l,end:h,total:a,count:u.length,config:r},t.logger.info(d,k.I.SearchConvs,g),n({conversationSearchInfoList:u,nextFlag:m})})})},c.prototype.searchGlobalMessages=function(r){var t=this;return new Promise(function(n){t.innerSearchMessages(!0,"",0,r,function(s,u){t.logger.info(d,k.I.SearchGlobalMessages,u),n(s)})})},c.prototype.searchMessages=function(r,t,n){var s=this;return new Promise(function(u){s.innerSearchMessages(!0,r,t,n,function(a,i){s.logger.info(d,k.I.SearchMessages,i),u({conversationID:r,conversationType:t,messageList:a.messageList,nextMessage:a.nextMessage})})})},c.prototype.searchGroups=function(r,t,n,s,u){var a,i=this;if(!t&&!n)return s([],0);u||this.isGlobalMember?(a=[],this.globalMemberMap.forEach(function(l){(t&&!n&&i.isSomeKeys(l.userName,r)||n&&!t&&i.isSomeKeys(l.memberNickname,r)||i.isSomeKeys(l.userName,r)&&i.isSomeKeys(l.memberNickname,r))&&a.push(l)}),s(a,this.globalMemberMap.size)):this.searchGroupsCallbackList.push({keywords:r,isName:t,isNick:n,resolve:s})},c.prototype.searchGroupMembers=function(r,t){var n=this;return new Promise(function(s){var u=t.keywords.filter(function(l){return typeof l=="string"&&l&&l.trim().length});if(!u.length)return s({groupID:r,nextFlag:0,userList:[]});var a=new Date,i=t.isAlsoMatchGroupMemberNickname;n.innerSearchGroupMembers(!0,r,u,i,function(l){l.sort(function(R,D){return R.seq-D.seq});var h=l.length,m=t.nextFlag,g=((g=l[l.length-1])==null?void 0:g.seq)||0,y=0,w=(g=(0<m&&m<g?y=l.findIndex(function(R){return R.seq==m}):g<=m&&g&&(y=l.length-1),y+t.count),((w=l[g])==null?void 0:w.seq)||0),M=(l=l.slice(y,g).map(function(R){return{userID:R.userID,userName:R.userName,memberAvatarUrl:R.memberAvatarUrl,memberNickname:R.memberNickname,memberRole:R.memberRole}}),n.globalMemberMap.size);M={time:a,dbCount:M,start:y,end:g,total:h,count:l.length,nextFlag:w,groupID:r,config:t},n.logger.info(d,k.I.SearchGroupMembers,M),s({groupID:r,nextFlag:w,userList:l})})})},c.prototype.getFileInfo=function(r){return new Promise(function(t,n){try{var s=r.size,u=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,a=1048576,i=Math.ceil(s/a),l=new T.a.ArrayBuffer,h=new FileReader,m=0,g=(h.onload=function(){var y=h.result||h.content;y?(l.append(y),++m<i?g():t({md5:l.end(),name:r.name,size:s})):n(Object(p.a)(k.s.MessageModuleFileSizeInvalid))},h.onerror=function(){n(Object(p.a)(k.s.MessageModuleFileNotExist))},function(){var y=m*a,w=Math.min(y+a,s);y=u.call(r,y,w),h.readAsArrayBuffer(y)});g()}catch(y){n(y)}})},c.prototype.uploadFile=function(r,t,n){return new Promise(function(s,u){var a=new XMLHttpRequest,i=(a.onreadystatechange=function(){if(a.readyState==4){if(a.status!=200)return u({code:6000212,message:a.responseText});s()}},a.upload.addEventListener("progress",n),a.onerror=function(){return u({code:6000212,message:"upload file onerror."})},a.ontimeout=function(){return u({code:6000104,message:"upload file ontimeout."})},a.open(r.method,r.url,!0),a.timeout=6e5,r.headers);i&&(delete i["User-Agent"],delete i["user-agent"],Object.keys(i).forEach(function(l){return a.setRequestHeader(l,i[l])})),a.send(t)})},c.prototype.setUserID=function(r){this.userID=r,this.clearOldRoomDB()},c.prototype.setUser=function(r){var t=this;this.createStaticDB().then(function(n){return t.batchAdd(n,k.r.User,[r])})},c.prototype.getUserList=function(){var r=this;return this.createStaticDB().then(function(t){return r.innerGetAll(t,k.r.User)})},c.prototype.addUserList=function(r){var t=this;this.createStaticDB().then(function(n){return t.batchAdd(n,k.r.User,r)})},c.prototype.addConversationList=function(r,t){var n=this,s=this.userID,u={_action_:t};r.forEach(function(a){a.id||(a.id=n.appendID(a.type+a.conversationID)),a.ownerID||(a.ownerID=s),a.state=a.state||k.p.Normal,r.length<11&&(u[a.conversationID]=[a.state+","+a.unreadMessageCount+","+a.maxSeq+","+a.maxOrderKey,a.msgSeq+","+a.readMsgSeq+","+a.sendMsgCount+","+a.deletedMsgCount].join(";"))}),this.createStaticDB().then(function(a){return n.batchAdd(a,k.r.Conv,r,u)})},c.prototype.getConversationList=function(){var r=this;return this.createStaticDB().then(function(t){return r.innerGetListByOwnerID(t,k.r.Conv)})},c.prototype.addGroupList=function(r){var t=this,n=this.userID,s={};r.forEach(function(u){u.id||(u.id=t.appendID(u.groupID)),u.ownerID||(u.ownerID=n),r.length<11&&(s[u.groupID]=[u.dataSeq,u.attributeSeq,u.memberSeq].join())}),this.createStaticDB().then(function(u){return t.batchAdd(u,k.r.Group,r,s)})},c.prototype.deleteGroupList=function(r){var t=this,n=(this.isGlobalMember&&this.globalMemberMap.forEach(function(s){r.indexOf(s.ownerID)!=-1&&t.globalMemberMap.delete(s.id)}),r.map(function(s){return t.createGlobalDB().then(function(u){return t.innerDeleteAllByOwnerID(u,k.r.Member,s)}),t.appendID(s)}));this.createStaticDB().then(function(s){return t.batchDelete(s,k.r.Group,n)})},c.prototype.getGroupList=function(){var r=this;return this.createStaticDB().then(function(t){return r.innerGetListByOwnerID(t,k.r.Group)})},c.prototype.addGroupMemberList=function(r,t){var n=this,s={_groupID_:r};t.forEach(function(u){u.id||(u.id=r+"_"+u.userID),u.ownerID||(u.ownerID=r),t.length<11&&(s[u.userID]=u.seq),n.isGlobalMember&&n.globalMemberMap.set(u.id,u)}),this.createGlobalDB().then(function(u){return n.batchAdd(u,k.r.Member,t,s)})},c.prototype.deleteGroupMemberList=function(r,t){var n,s=this;t.length&&(n=t.map(function(u){return u=r+"_"+u,s.isGlobalMember&&s.globalMemberMap.delete(u),u}),this.createGlobalDB().then(function(u){return s.batchDelete(u,k.r.Member,n)}))},c.prototype.getGroupMemberList=function(r){var t,n=this;return this.isGlobalMember?(t=[],this.globalMemberMap.forEach(function(s){s.ownerID==r&&t.push(s)}),Promise.resolve(t)):new Promise(function(s){return n.getMembersCallbackList.push({groupID:r,resolve:s})})},c.prototype.addMessageList=function(r,t,n,s){var u=this,a=t==k.q.Room,i=!a&&this.isGlobalMsg;return n.forEach(function(l){l.id||(l.id=t+"_"+l.localMessageID+"_"+l.messageID),i&&u.globalMsgMap.set(l.id,l)}),(a?this.createDynamicDB(r,t,1):this.createGlobalDB()).then(function(l){return new Promise(function(h){var m;s?(m=n.filter(function(g){return!g.isUserInserted&&g.direction==k.K.Send}).map(function(g){return g=t+"_"+g.localMessageID+"_"+g.localMessageID,i&&u.globalMsgMap.delete(g),g}),u.batchDelete(l,k.r.Message,m,function(){u.batchAdd(l,k.r.Message,n,{convID:r,type:t},h)})):u.batchAdd(l,k.r.Message,n,{convID:r,type:t},h)})})},c.prototype.deleteAllMessage=function(r,t){var n=this;this.isGlobalMsg&&this.globalMsgMap.forEach(function(s){s.conversationID==r&&s.conversationType==t&&n.globalMsgMap.delete(s.id)}),this.createGlobalDB().then(function(s){return n.innerDeleteAllByOwnerID(s,k.r.Message,[t,r])})},c.prototype.deleteMessageList=function(r,t,n,s){var u=this,a=n.map(function(i){return i=s?t+"_"+i.localMessageID+"_"+i.messageID:t+"_"+i.localMessageID+"_"+i.localMessageID,u.isGlobalMsg&&u.globalMsgMap.delete(i),i});return(t==k.q.Room?this.createDynamicDB(r,t,1):this.createGlobalDB()).then(function(i){return new Promise(function(l){u.batchDelete(i,k.r.Message,a,function(){if(!s)return l(void 0);var h;if(u.isGlobalMsg)return h={orderKey:0},u.globalMsgMap.forEach(function(w){w.conversationID==r&&w.conversationType==t&&w.orderKey>h.orderKey&&(h=w)}),l(h.messageID?h:void 0);var m=u.seq++,g=new Date,y=i.transaction([k.r.Message],"readonly").objectStore(k.r.Message).index("ownerID").getAll([t,r]);y.onsuccess=function(){var w=y.result||[];w.sort(function(M,R){return R.orderKey-M.orderKey}),u.logger.info(d,"getLastMsg",{seq:m,time:g,convID:r,type:t,msg:w[0]}),l(w[0])},y.onerror=function(w){w=w.target&&w.target.error&&w.target.error.message,u.logger.info(d,"getLastMsg",{seq:m,time:g,convID:r,type:t,onerror:w}),l(void 0)}})})})},c.prototype.getDeleteMessageCount=function(r,t,n,s){var u;this.isGlobalMsg?(u=0,this.globalMsgMap.forEach(function(a){a.conversationID==r&&a.conversationType==t&&a.direction==k.K.Receive&&n.indexOf(a.conversationSeq)!=-1&&u++}),s(u)):this.getDelMsgCountCallbackList.push({convID:r,type:t,delSeqs:n,resolve:s})},c.prototype.deleteAllMessageFromRemote=function(r,t,n,s,u){var a,i,l=this;this.isGlobalMsg?(a=0,i=[],this.globalMsgMap.forEach(function(h){h.conversationID==r&&h.conversationType==t&&(h.sentStatus==k.P.Success&&!h.isUserInserted&&(h.direction==k.K.Receive&&s.indexOf(h.conversationSeq)!=-1&&a++,h.conversationSeq<=n)?l.globalMsgMap.delete(h.id):i.push(h))}),u&&u(a),this.createGlobalDB().then(function(h){return l.innerDeleteAllByOwnerID(h,k.r.Message,[t,r],function(){return l.batchAdd(h,k.r.Message,i)})})):this.delAllMsgCallbackList.push({convID:r,type:t,maxSeq:n,delSeqs:s,resolve:u})},c.prototype.deleteMessageListFromRemote=function(r,t,n,s,u){var a,i,l,h,m=this;this.isGlobalMsg?(i={orderKey:a=0},l=[],h=[],this.globalMsgMap.forEach(function(g){g.conversationID==r&&g.conversationType==t&&(g.sentStatus!=k.P.Success||g.isUserInserted||n.indexOf(g.conversationSeq)==-1?g.orderKey>i.orderKey&&(i=g):(m.globalMsgMap.delete(g.id),l.push(g.id),h.push(g),g.direction==k.K.Receive&&g.conversationSeq>s&&a++))}),u(h,a,i.messageID?i:void 0),this.createGlobalDB().then(function(g){return m.batchDelete(g,k.r.Message,l)})):this.delMsgsCallbackList.push({convID:r,type:t,seqs:n,readSeq:s,resolve:u})},c.prototype.clearRoomMessage=function(r){var t,n=this;r.length&&(t=r.map(function(s){s=n.appendID(k.q.Room+s);var u=n.dbNameMap.dynamic+s,a=(indexedDB.deleteDatabase(u),n.storeMap.get(u));return a&&(a.close(),n.storeMap.delete(u)),s}),this.createStaticDB().then(function(s){return n.batchDelete(s,k.r.Conv,t)}),this.logger.info(d,this.action.delete,{roomIDs:r}))},c.prototype.getMessageList=function(r,t){var n,s=this,u=t.count,a=t.reverse,i=t.nextMessage,l=r.conversationID,h=r.type,m=h==k.q.Room;return!m&&this.isGlobalMsg?(n=[],this.globalMsgMap.forEach(function(g){g.conversationID==l&&g.conversationType==h&&n.push(g)}),t={convID:l,type:h,reverse:a,queryCount:u,count:n.length},this.logger.info(d,"getMsgs",t),Promise.resolve(n)):(m?this.createDynamicDB(l,h,1):this.createGlobalDB()).then(function(g){return new Promise(function(y){var w=s.seq++,M=new Date,R=i?i.orderKey:0,D=0,q=0,L=(a?q=R?R-1:r.maxOrderKey||0:D=R+1,{seq:w,time:M,convID:l,type:h,reverse:a,queryCount:u,count:0,orderKey:R,min:D,max:q}),j=(w=m?Math.max(2*u,60):void 0,M=m?a?IDBKeyRange.upperBound(q):IDBKeyRange.lowerBound(D):[h,l],g.transaction([k.r.Message],"readonly").objectStore(k.r.Message).index(m?"orderKey":"ownerID").getAll(M,w));j.onsuccess=function(){var G=j.result||[];L.count=G.length,s.logger.info(d,"getMsgs",L),y(G)},j.onerror=function(G){L.onerror=G.target&&G.target.error&&G.target.error.message,s.logger.info(d,"getMsgs",L),y([])}})})},c.prototype.getMessageListBySeqs=function(r,t,n){var s=this,u=new Map;return this.isGlobalMsg?(this.globalMsgMap.forEach(function(a){a.conversationID!=r||a.conversationType!=t||a.sentStatus!=k.P.Success||a.isUserInserted||n.indexOf(a.conversationSeq)==-1||u.set(a.conversationSeq,a)}),Promise.resolve(u)):this.createGlobalDB().then(function(a){return new Promise(function(i){var l=s.seq++,h=new Date,m=a.transaction([k.r.Message],"readonly").objectStore(k.r.Message).index("ownerID").getAll([t,r]);m.onsuccess=function(){(m.result||[]).forEach(function(y){y.sentStatus!=k.P.Success||y.isUserInserted||n.indexOf(y.conversationSeq)==-1||u.set(y.conversationSeq,y)});var g={seq:l,time:h,convID:r,type:t,count:u.size,seqs:n};s.logger.info(d,"getMsgSeqs",g),i(u)},m.onerror=function(g){g=g.target&&g.target.error&&g.target.error.message,s.logger.info(d,"getMsgSeqs",{seq:l,time:h,convID:r,type:t,seqs:n,onerror:g}),i(new Map)}})})},c.prototype.checkMessageStatus=function(r){var t;!r.receiptStatus||r.conversationType==k.q.Room||(t=this.globalMsgMap.get(r.conversationType+"_"+r.localMessageID+"_"+r.messageID))&&r.receiptStatus<t.receiptStatus&&(r.receiptStatus=t.receiptStatus)},c.prototype.addMessageExtraList=function(r,t){var n=this;this.createStaticDB().then(function(s){return n.batchAdd(s,k.r.MessageExtra,r,{_action_:t})})},c.prototype.getMessageExtraList=function(){var r=this;return this.createStaticDB().then(function(t){return r.innerGetListByOwnerID(t,k.r.MessageExtra)})},c.prototype.deleteMessageExtraList=function(r){var t=this;this.createStaticDB().then(function(n){return t.batchDelete(n,k.r.MessageExtra,r)})},c.prototype.addCallList=function(r){var t=this;r.forEach(function(n){n.id||(n.id=t.appendID(n.callID)),n.ownerID||(n.ownerID=t.userID)}),this.createStaticDB().then(function(n){return t.batchAdd(n,k.r.Call,r)})},c.prototype.getCallList=function(){var r=this;return this.createStaticDB().then(function(t){return r.innerGetListByOwnerID(t,k.r.Call)})},c.prototype.createStaticDB=function(){var r=this,t=this.dbNameMap.static,n=this.storeMap.get(t);return n?Promise.resolve(n):new Promise(function(s){return r.openStaticDB(t,s,new Date)})},c.prototype.createDynamicDB=function(r,t,n){var s=this,u=this.dbNameMap.dynamic+this.appendID(t+r),a=this.storeMap.get(u);return a?Promise.resolve(a):new Promise(function(i){return s.openDynamicDB(u,i,new Date,r,t,n)})},c.prototype.createGlobalDB=function(){var r=this,t=this.dbNameMap.global+this.userID,n=this.storeMap.get(t);return n?Promise.resolve(n):new Promise(function(s){return r.openGlobalDB(t,s,new Date)})},c.prototype.openStaticDB=function(r,t,n){var s=this,u=indexedDB.open(r,4);u.onsuccess=function(){u.onsuccess=null,s.initStaticStore(u.result,u.transaction,r,t,{time:n,event:"onsuccess"})},u.onupgradeneeded=function(a){u.onupgradeneeded=null,a.newVersion&&a.newVersion>a.oldVersion&&(a=a.target.result,s.initStaticStore(a,u.transaction,r,t,{time:n,event:"onupgradeneeded"}))},u.onerror=function(a){a="Static open onerror: "+(a.target&&a.target.error&&a.target.error.message),s.logger.info(d,s.action.create,{time:n,onerror:a}),s.storeMap.delete(r),indexedDB.deleteDatabase(r),u.onsuccess=null,u.onupgradeneeded=null,u.onerror=null,s.openStaticDB(r,t,n)},u.onblocked=function(){s.logger.info(d,s.action.create,{time:n,onerror:"Static open onblocked"})}},c.prototype.openDynamicDB=function(r,t,n,s,u,a){var i=this,l=indexedDB.open(r,a);l.onsuccess=function(){l.onsuccess=null,i.initDynamicStore(l.result,l.transaction,r,t,{time:n,convID:s,type:u,event:"onsuccess"})},l.onupgradeneeded=function(h){l.onupgradeneeded=null,h.newVersion&&h.newVersion>h.oldVersion&&(h=h.target.result,i.initDynamicStore(h,l.transaction,r,t,{time:n,convID:s,type:u,event:"onupgradeneeded"}))},l.onerror=function(h){h="Dynamic open onerror: "+(h.target&&h.target.error&&h.target.error.message),i.logger.info(d,i.action.create,{time:n,convID:s,type:u,onerror:h}),i.storeMap.delete(r),indexedDB.deleteDatabase(r),l.onsuccess=null,l.onupgradeneeded=null,l.onerror=null,i.openDynamicDB(r,t,n,s,u,a)},l.onblocked=function(){i.logger.info(d,i.action.create,{time:n,convID:s,type:u,onerror:"Dynamic open onblocked"})}},c.prototype.openGlobalDB=function(r,t,n){var s=this,u=indexedDB.open(r,1);u.onsuccess=function(){u.onsuccess=null,s.initGlobalStore(u.result,u.transaction,r,t,{time:n,event:"onsuccess"})},u.onupgradeneeded=function(a){u.onupgradeneeded=null,a.newVersion&&a.newVersion>a.oldVersion&&(a=a.target.result,s.initGlobalStore(a,u.transaction,r,t,{time:n,event:"onupgradeneeded"}))},u.onerror=function(a){a="Global open onerror: "+(a.target&&a.target.error&&a.target.error.message),s.logger.info(d,s.action.create,{time:n,onerror:a}),s.storeMap.delete(r),indexedDB.deleteDatabase(r),u.onsuccess=null,u.onupgradeneeded=null,u.onerror=null,s.openGlobalDB(r,t,n)},u.onblocked=function(){s.logger.info(d,s.action.create,{time:n,onerror:"Global open onblocked"})}},c.prototype.initStaticStore=function(r,t,n,s,u){var a=this,i=!(r.onclose=function(){return a.storeMap.delete(n)});if(i=(r.objectStoreNames.contains(k.r.Log)||(i=!0,r.createObjectStore(k.r.Log)),r.objectStoreNames.contains(k.r.DataReport)||(i=!0,r.createObjectStore(k.r.DataReport)),r.objectStoreNames.contains(k.r.User)||(i=!0,r.createObjectStore(k.r.User,{keyPath:"userID"})),r.objectStoreNames.contains(k.r.Conv)||(i=!0,r.createObjectStore(k.r.Conv,{keyPath:"id"}).createIndex("ownerID","ownerID")),r.objectStoreNames.contains(k.r.Group)||(i=!0,r.createObjectStore(k.r.Group,{keyPath:"id"}).createIndex("ownerID","ownerID")),r.objectStoreNames.contains(k.r.MessageExtra)||(i=!0,r.createObjectStore(k.r.MessageExtra,{keyPath:"id"}).createIndex("ownerID","ownerID")),r.objectStoreNames.contains(k.r.Call)||(i=!0,r.createObjectStore(k.r.Call,{keyPath:"id"}).createIndex("ownerID","ownerID")),u.isCreate=i,this.storeMap.get(n)))return u.db="Static is opened",this.logger.info(d,this.action.create,u),s(i);t?t.oncomplete=function(){a.storeMap.set(n,r),a.logger.setDB(r),I.a.getInstance().dataReport.setDB(r),s(r),u.db="Static oncomplete",a.logger.info(d,a.action.create,u)}:(this.storeMap.set(n,r),this.logger.setDB(r),I.a.getInstance().dataReport.setDB(r),s(r),u.db="Static",this.logger.info(d,this.action.create,u))},c.prototype.initDynamicStore=function(r,t,n,s,u){var a=this,i=!(r.onclose=function(){return a.storeMap.delete(n)});r.objectStoreNames.contains(k.r.Message)||(i=!0,r.createObjectStore(k.r.Message,{keyPath:"id"}).createIndex("orderKey","orderKey")),t?t.oncomplete=function(){a.storeMap.set(n,r),s(r),i&&(u.db="Dynamic oncomplete",a.logger.info(d,a.action.create,u))}:(this.storeMap.set(n,r),s(r),i&&(u.db="Dynamic",this.logger.info(d,this.action.create,u)))},c.prototype.initGlobalStore=function(r,t,n,s,u){var a=this,i=!(r.onclose=function(){return a.storeMap.delete(n)});r.objectStoreNames.contains(k.r.Message)||(i=!0,r.createObjectStore(k.r.Message,{keyPath:"id"}).createIndex("ownerID",["conversationType","conversationID"])),r.objectStoreNames.contains(k.r.Member)||(i=!0,r.createObjectStore(k.r.Member,{keyPath:"id"}).createIndex("ownerID","ownerID")),t?t.oncomplete=function(){a.storeMap.set(n,r),s(r),i&&(u.db="Global oncomplete",a.logger.info(d,a.action.create,u))}:(this.storeMap.set(n,r),s(r),i&&(u.db="Global",this.logger.info(d,this.action.create,u)))},c.prototype.batchAdd=function(r,t,n,s,u){var a=this;if(!n.length)return u&&u();var i=this.seq++,l=new Date,h=r.transaction([t],"readwrite").objectStore(t);t="ba"+t,h.transaction.oncomplete=function(){a.logger.info(d,t,{seq:i,time:l,total:n.length,flag:s}),u&&u()},h.transaction.onerror=function(m){m=m.target&&m.target.error&&m.target.error.message,a.logger.info(d,t,{seq:i,time:l,onerror:"onerror: "+m,flag:s}),u&&u()},h.transaction.onabort=function(){a.logger.info(d,t,{seq:i,time:l,onerror:"onabort",flag:s}),u&&u()},n.forEach(function(m){return h.put(m)})},c.prototype.batchDelete=function(r,t,n,s){var u=this;if(!r.objectStoreNames.contains(t)||!n.length)return s&&s();var a=this.seq++,i=new Date,l=r.transaction([t],"readwrite").objectStore(t);t="bd"+t,l.transaction.oncomplete=function(){u.logger.info(d,t,{seq:a,time:i,total:n.length}),s&&s()},l.transaction.onerror=function(h){h=h.target&&h.target.error&&h.target.error.message,h={seq:a,time:i,total:n.length,onerror:"onerror: "+h},u.logger.info(d,t,h)},l.transaction.onabort=function(){var h={seq:a,time:i,total:n.length,onerror:"onabort"};u.logger.info(d,t,h)},n.forEach(function(h){return l.delete(h)})},c.prototype.innerDeleteAllByOwnerID=function(r,t,n,s){var u,a,i,l,h=this;r.objectStoreNames.contains(t)&&(u=this.seq++,a=new Date,i=r.transaction([t],"readwrite").objectStore(t),l=i.index("ownerID").getAllKeys(n),t="da"+t,l.onsuccess=function(){var m=l.result||[];i.transaction.oncomplete=function(){h.logger.info(d,t,{seq:u,time:a,total:m.length,ownerID:n}),s&&s()},m.forEach(function(g){return i.delete(g)})},l.onerror=function(m){m=m.target&&m.target.error&&m.target.error.message,h.logger.info(d,t,{seq:u,time:a,ownerID:n,onerror:m})})},c.prototype.innerGetListByOwnerID=function(r,t){var n=this;return r.objectStoreNames.contains(t)?new Promise(function(s){var u=n.seq++,a=new Date,i=r.transaction([t],"readonly").objectStore(t).index("ownerID").getAll(n.userID);t="ga"+t+"s",i.onsuccess=function(){var l=i.result||[];n.logger.info(d,t,{seq:u,time:a,total:l.length}),s(l)},i.onerror=function(l){l=l.target&&l.target.error&&l.target.error.message,n.logger.info(d,t,{seq:u,time:a,onerror:l}),s([])}}):Promise.resolve([])},c.prototype.innerGetAll=function(r,t,n){var s=this;return r.objectStoreNames.contains(t)?new Promise(function(u){var a=s.seq++,i=new Date,l=r.transaction([t],"readonly").objectStore(t).getAll();t="ga"+t,l.onsuccess=function(){var h=l.result||[];s.logger.info(d,t,{seq:a,time:i,total:h.length,pid:n}),u(h)},l.onerror=function(h){h=h.target&&h.target.error&&h.target.error.message,s.logger.info(d,t,{seq:a,time:i,onerror:h,pid:n}),u([])}}):Promise.resolve([])},c.prototype.appendID=function(r){return this.userID+r},c.prototype.filterKeys=function(r){return r&&r.length&&(r=r.filter(function(t){return typeof t=="string"&&t&&t.trim().length})).length?r:null},c.prototype.isMsgKeywords=function(r,t){var n;return!t||!!(n=r.type==k.R.Custom?r.searchedContent:r.message||r.fileName||r.fileDownloadUrl)&&t.every(function(s){return n.indexOf(s)!=-1})},c.prototype.isMsgType=function(r,t,n,s){var u=!s||!s.length,a=!n||!n.length;return u&&a||(u&&!a?n.indexOf(r)!=-1:r==k.R.Custom&&s.indexOf(t)!=-1)},c.prototype.isMsgTimeRange=function(r,t,n){return!t&&!n||(!n&&t?t<r:(!t&&n||t<r)&&r<n)},c.prototype.isSomeKeys=function(r,t){return!t||!!r&&t.some(function(n){return r.indexOf(n)!=-1})},c.prototype.isEveryKeys=function(r,t){return!t||!!r&&t.every(function(n){return r.indexOf(n)!=-1})},c.prototype.handleMsgCallbackList=function(){var r=this;this.isGlobalMsg=!0,this.isGlobalMember&&(this.reportLog.messageCount=this.globalMsgMap.size,this.dataReport.reportSDKEvent("/sdk/log",{error_message:JSON.stringify(this.reportLog)})),this.searchMsgCallbackList.forEach(function(t){r.innerSearchMessages(!1,t.convID,t.type,t.config,t.resolve)}),this.searchMsgByConvCallbackList.forEach(function(t){r.innerSearchMessagesByConv(!1,t.config,t.resolve)}),this.searchMsgCallbackList.length=0,this.searchMsgByConvCallbackList.length=0,this.getDelMsgCountCallbackList.forEach(function(t){r.getDeleteMessageCount(t.convID,t.type,t.delSeqs,t.resolve)}),this.delMsgsCallbackList.forEach(function(t){r.deleteMessageListFromRemote(t.convID,t.type,t.seqs,t.readSeq,t.resolve)}),this.delAllMsgCallbackList.forEach(function(t){r.deleteAllMessageFromRemote(t.convID,t.type,t.maxSeq,t.delSeqs,t.resolve)}),this.getDelMsgCountCallbackList.length=0,this.delMsgsCallbackList.length=0,this.delAllMsgCallbackList.length=0},c.prototype.handleMemberCallbackList=function(){var r=this;this.isGlobalMember=!0,this.isGlobalMsg&&(this.reportLog.memberCount=this.globalMemberMap.size,this.dataReport.reportSDKEvent("/sdk/log",{error_message:JSON.stringify(this.reportLog)})),this.searchGroupsCallbackList.forEach(function(t){r.searchGroups(t.keywords,t.isName,t.isNick,t.resolve,!0)}),this.searchMembersCallbackList.forEach(function(t){r.innerSearchGroupMembers(!1,t.groupID,t.keywords,t.isNick,t.resolve)}),this.searchGroupsCallbackList.length=0,this.searchMembersCallbackList.length=0,this.getMembersCallbackList.forEach(function(t){var n=t.groupID,s=(t=t.resolve,[]);r.globalMemberMap.forEach(function(u){u.ownerID==n&&s.push(u)}),t(s)}),this.getMembersCallbackList.length=0},c.prototype.innerSearchMessagesByConv=function(r,t,n){var s,u=this;if(t.keywords=this.filterKeys(t.keywords),t.senderUserIDs=this.filterKeys(t.senderUserIDs),!(t.keywords&&t.keywords.length||t.messageTypes&&t.messageTypes.length||t.subMessageTypes&&t.subMessageTypes.length||t.senderUserIDs&&t.senderUserIDs.length||t.startTime&&!(t.startTime<0)||t.endTime&&!(t.endTime<0)))return n([]);r&&!this.isGlobalMsg?this.searchMsgByConvCallbackList.push({config:t,resolve:n}):(s=new Map,this.globalMsgMap.forEach(function(a){var i,l;a.type!=k.R.Revoke&&u.isMsgKeywords(a,t.keywords)&&u.isMsgTimeRange(a.timestamp,t.startTime,t.endTime)&&u.isMsgType(a.type,a.subType,t.messageTypes,t.subMessageTypes)&&u.isSomeKeys(a.senderUserID,t.senderUserIDs)&&(i=a.conversationType+a.conversationID,(l=s.get(i)||{conversationID:a.conversationID,conversationType:a.conversationType,totalMessageCount:0,messageList:[]}).totalMessageCount+=1,l.messageList.push(a),s.set(i,l))}),n(Array.from(s.values())))},c.prototype.innerSearchMessages=function(r,t,n,s,u){var a,i,l,h,m,g,y=this;if(s.keywords=this.filterKeys(s.keywords),s.senderUserIDs=this.filterKeys(s.senderUserIDs),!(s.keywords&&s.keywords.length||s.messageTypes&&s.messageTypes.length||s.subMessageTypes&&s.subMessageTypes.length||s.senderUserIDs&&s.senderUserIDs.length||s.startTime&&!(s.startTime<0)||s.endTime&&!(s.endTime<0)))return u({messageList:[]},{convID:t,config:s});r&&!this.isGlobalMsg?this.searchMsgCallbackList.push({convID:t,type:n,config:s,resolve:u}):(m=[],this.globalMsgMap.forEach(function(w){(!t||w.conversationID==t&&w.conversationType==n)&&w.type!=k.R.Revoke&&y.isMsgKeywords(w,s.keywords)&&y.isMsgTimeRange(w.timestamp,s.startTime,s.endTime)&&y.isMsgType(w.type,w.subType,s.messageTypes,s.subMessageTypes)&&y.isSomeKeys(w.senderUserID,s.senderUserIDs)&&m.push(w)}),r=m.length,s.order?m.sort(function(w,M){return w.timestamp-M.timestamp}):m.sort(function(w,M){return M.timestamp-w.timestamp}),l=(i=(a=s.nextMessage?s.nextMessage.id:"")?m.findIndex(function(w){return a===w.id})+1:0)+s.count,h=m[l]?m[l-1]:void 0,m=m.slice(i,l),s.nextMessage=a,g=this.globalMsgMap.size,g={time:new Date,dbCount:g,start:i,end:l,total:r,count:m.length,convID:t,config:s},u({messageList:m,nextMessage:h},g))},c.prototype.innerSearchGroupMembers=function(r,t,n,s,u){var a,i=this;r&&!this.isGlobalMember?this.searchMembersCallbackList.push({groupID:t,keywords:n,isNick:s,resolve:u}):(a=[],this.globalMemberMap.forEach(function(l){l.ownerID==t&&(i.isEveryKeys(l.userName,n)||s&&i.isEveryKeys(l.memberNickname,n))&&a.push(l)}),u(a))},c.prototype.clearOldRoomDB=function(){var r=this;indexedDB.databases&&typeof indexedDB.databases=="function"&&indexedDB.databases().then(function(t){var n=[];t.forEach(function(s){var u=s.version||1;s=(s.name||"-1").replace(r.dbNameMap.dynamic+r.userID,""),Number(s.charAt(0))==k.q.Room&&1<u&&n.push(s.substring(1))}),r.clearRoomMessage(n)})},c.prototype.loadGlobaDB=function(r,t,n,s){var u=this,a=(n.forEach(function(i){return u.globalMemberMap.set(i.id,i)}),this.isGlobalMember=!0,Date.now());this.innerGetAll(r,k.r.Message,"loadGDB").then(function(i){u.globalMsgMap.clear(),t.forEach(function(l){return u.globalMsgMap.set(l.id,l)}),i.forEach(function(l){return u.globalMsgMap.set(l.id,l)}),u.reportLog.messageTime=Date.now()-a,u.handleMsgCallbackList()}).then(function(){return S(u,void 0,void 0,function(){var i,l,h,m,g,y,w=this;return f(this,function(M){switch(M.label){case 0:i={time:new Date,msgs:[],users:[]},l=function(R){return f(this,function(D){switch(D.label){case 0:return[4,new Promise(function(q){var L=Date.now(),j=r.transaction([k.r.Message],"readwrite").objectStore(k.r.Message);j.transaction.oncomplete=function(){i.msgs.push(Date.now()-L),q(0)},t.slice(R,R+1e4).forEach(function(G){return j.put(G)}),R+=1e4})];case 1:return D.sent(),h=R,[2]}})},y=0,M.label=1;case 1:return y<t.length?[5,l(y)]:[3,4];case 2:M.sent(),y=h,M.label=3;case 3:return[3,1];case 4:m=function(R){return f(this,function(D){switch(D.label){case 0:return[4,new Promise(function(q){var L=Date.now(),j=r.transaction([k.r.Member],"readwrite").objectStore(k.r.Member);j.transaction.oncomplete=function(){i.users.push(Date.now()-L),q(0)},n.slice(R,R+1e4).forEach(function(G){return j.put(G)}),R+=1e4})];case 1:return D.sent(),g=R,[2]}})},y=0,M.label=5;case 5:return y<n.length?[5,m(y)]:[3,8];case 6:M.sent(),y=g,M.label=7;case 7:return[3,5];case 8:return s&&s.forEach(function(R){indexedDB.deleteDatabase(R),w.storeMap.delete(R)}),(t.length||n.length)&&this.logger.info(d,"loadGDB",i),[2]}})})})},c.prototype.copyOldDB2GlobalDB=function(){var r,t=this;indexedDB.databases&&typeof indexedDB.databases=="function"?(r=new Date,indexedDB.databases().then(function(n){var s=[];return n.forEach(function(u){var a=u.version||1,i=(u=(u.name||"-1").replace(t.dbNameMap.dynamic+t.userID,""),Number(u.charAt(0)));i!=k.q.Peer&&i!=k.q.Group||s.push({type:i,convID:u.substring(1),ver:a})}),s}).then(function(n){t.createGlobalDB().then(function(s){return S(t,void 0,void 0,function(){var u,a,i,l,h,m,g,y,w=this;return f(this,function(M){switch(M.label){case 0:if(u=n.length,a=[],i=[],l=[],u==0)return this.loadGlobaDB(s,a,i),[2];h=function(R){var D,q,L;return f(this,function(j){switch(j.label){case 0:return L=n[R],D=L.convID,q=L.type,L=L.ver,[4,m.createDynamicDB(D,q,L).then(function(G){var J=[w.innerGetAll(G,k.r.Message,D)];return q==k.q.Group&&J.push(w.innerGetAll(G,k.r.Member,D)),Promise.all(J).then(function(K){var ee=(K=function(A,v){var E=typeof Symbol=="function"&&A[Symbol.iterator];if(!E)return A;var N,P,H=E.call(A),V=[];try{for(;(v===void 0||0<v--)&&!(N=H.next()).done;)V.push(N.value)}catch(W){P={error:W}}finally{try{N&&!N.done&&(E=H.return)&&E.call(H)}finally{if(P)throw P.error}}return V}(K,2))[0];K=K[1],ee.length&&ee.forEach(function(A){A.id=A.type+"_"+A.localMessageID+"_"+A.messageID,a.push(A)}),K&&K.length&&K.forEach(function(A){A.id||(A.id=D+"_"+A.userID),A.ownerID||(A.ownerID=D),i.push(A)}),G.close(),l.push(w.dbNameMap.dynamic+w.appendID(q+D))})})];case 1:return j.sent(),[2]}})},m=this,g=0,M.label=1;case 1:return g<u?[5,h(g)]:[3,4];case 2:M.sent(),M.label=3;case 3:return g++,[3,1];case 4:return this.loadGlobaDB(s,a,i,l),y={time:r,dbs:u,msgs:a.length,users:i.length},this.logger.info(d,this.action.delete,y),[2]}})})})})):this.createGlobalDB().then(function(n){return t.loadGlobaDB(n,[],[])})},c);function c(r){this.logger=I.a.getInstance().logger,this.dataReport=I.a.getInstance().dataReport,this.dbNameMap={static:"",dynamic:"",global:""},this.storeMap=new Map,this.seq=1,this.userID="",this.action={delete:"delete",create:"create"},this.isGlobalMsg=!1,this.isGlobalMember=!1,this.reportLog={messageTime:0,memberTime:0,messageCount:0,memberCount:0},this.globalMsgMap=new Map,this.globalMemberMap=new Map,this.searchMsgByConvCallbackList=[],this.searchMsgCallbackList=[],this.searchGroupsCallbackList=[],this.searchMembersCallbackList=[],this.getMembersCallbackList=[],this.getDelMsgCountCallbackList=[],this.delMsgsCallbackList=[],this.delAllMsgCallbackList=[],this.dbNameMap.static="ZIMSDKSTATIC"+r,this.dbNameMap.dynamic="ZIMSDKDYNAMIC"+r,this.dbNameMap.global="ZIMSDKGLOBAL"+r,this.createStaticDB()}},function(Q,O,b){b.d(O,"a",function(){return k});var T=b(81),I=b(7),p=function(){return(p=Object.assign||function(f){for(var d,o=1,c=arguments.length;o<c;o++)for(var r in d=arguments[o])Object.prototype.hasOwnProperty.call(d,r)&&(f[r]=d[r]);return f}).apply(this,arguments)},k=(S.prototype.init=function(f){return function(d,o,c,r){return new(c=c||Promise)(function(t,n){function s(i){try{a(r.next(i))}catch(l){n(l)}}function u(i){try{a(r.throw(i))}catch(l){n(l)}}function a(i){var l;i.done?t(i.value):((l=i.value)instanceof c?l:new c(function(h){h(l)})).then(s,u)}a((r=r.apply(d,o||[])).next())})}(this,void 0,void 0,function(){var d;return function(o,c){var r,t,n,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},u={next:a(0),throw:a(1),return:a(2)};return typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function a(i){return function(l){var h=[i,l];if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,t&&(n=2&h[0]?t.return:h[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,h[1])).done)return n;switch(t=0,(h=n?[2&h[0],n.value]:h)[0]){case 0:case 1:n=h;break;case 4:return s.label++,{value:h[1],done:!1};case 5:s.label++,t=h[1],h=[0];continue;case 7:h=s.ops.pop(),s.trys.pop();continue;default:if(!(n=0<(n=s.trys).length&&n[n.length-1])&&(h[0]===6||h[0]===2)){s=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){s.label=h[1];break}if(h[0]===6&&s.label<n[1]){s.label=n[1],n=h;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(h);break}n[2]&&s.ops.pop(),s.trys.pop();continue}h=c.call(o,s)}catch(m){h=[6,m],t=0}finally{r=n=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}}(this,function(o){return d=this.miniProgram?"zego.fileHandler":"zego.storeHandler",this.fileConfig=p({maxSize:5e6,maxFiles:3,dropPer:1},f),d=b(112)("./"+d).ZegoStoreImpl,this.storeHandler=new d(this.product,this.fileConfig,this.miniProgram),[2]})})},S.prototype.setDB=function(f){this.storeHandler.setDB(f)},S.prototype.setLogLevel=function(f){return(f=I.a[f])!==void 0&&(this.logLevel=f,!0)},S.prototype.setHeaderInfo=function(f){this.storeHandler.storeData(f)},S.prototype.setCommonField=function(f){return Object.prototype.toString.call(f)==="[object Map]"&&f.get("userID")!=null&&typeof f.get("userID")=="string"&&f.get("userID")!==""&&(this.commonField=f,this.isUserIDExist=!0)},S.prototype.write=function(f,d,o,c){var r=I.a[d];return r!==void 0&&(f=this.logParams(f,o,c),this.logLevel!==I.a.DISABLE&&this.logLevel<=r&&(d=="debug"||d=="report"||d=="info"?console.info:console.warn)(f),this.logRemoteLevel!==I.a.DISABLE&&this.logRemoteLevel<=r&&this.storeHandler.storeData(f),!0)},S.prototype.upload=function(f,d,o){return this.storeHandler.upload(f,d,o)},S.prototype.logParams=function(f,d,o){return"[".concat(this.getCurrentTime(),"][").concat(f,"][").concat(d,"]:").concat(o)},S.prototype.getCurrentTime=function(){var f=new Date;return"".concat(this.D[f.getMonth()+1]||f.getMonth()+1).concat(this.D[f.getDate()]||f.getDate()," ").concat(f.toLocaleTimeString("zh-CN"),".").concat(f.getMilliseconds())},S);function S(f,d,o){this.product=f,this.miniProgram=d,this.logLevel=I.a.INFO,this.logRemoteLevel=0,this.isUserIDExist=!1,this.D=["00","01","02","03","04","05","06","07","08","09"],this.stateCenter=T.a.getInstance(),this.init(o)}},function(Q,O,b){b.r(O),b.d(O,"convertFormData",function(){return k});var T=function(S,f){var d=typeof Symbol=="function"&&S[Symbol.iterator];if(!d)return S;var o,c,r=d.call(S),t=[];try{for(;(f===void 0||0<f--)&&!(o=r.next()).done;)t.push(o.value)}catch(n){c={error:n}}finally{try{o&&!o.done&&(d=r.return)&&d.call(r)}finally{if(c)throw c.error}}return t},I=function(S,f,d){if(d||arguments.length===2)for(var o,c=0,r=f.length;c<r;c++)!o&&c in f||((o=o||Array.prototype.slice.call(f,0,c))[c]=f[c]);return S.concat(o||Array.prototype.slice.call(f))};function p(S){for(var f=[],d=0;d<S.length;d++){f.push.apply(f,I([],T(function(c,r){var t=[],n=0,s=c.charCodeAt(r);return s<128?t[n++]=s:(s<2048?t[n++]=s>>6|192:((64512&s)==55296&&r+1<c.length&&(64512&c.charCodeAt(r+1))==56320?(s=65536+((1023&s)<<10)+(1023&c.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128):t[n++]=s>>12|224,t[n++]=s>>6&63|128),t[n++]=63&s|128),t}(S,d)),!1));var o=S.codePointAt(d);o&&65535<o&&d++}return f}function k(S,f,d,o){var c,r,t,n,s="wxmpFormBoundary"+Math.random().toString(16).substring(2),u="--"+s,a=u+"--",i=[];for(c in S)i=i.concat((t=S[r=c],p("".concat(u,`\r
Content-Disposition: form-data; name="`).concat(r,`"\r
\r
`).concat(t,`\r
`))));return i=(i=i.concat((f=f,d=d,o=o,(n=(n=p("".concat(n=u,`\r
Content-Disposition: form-data; name="`).concat(f,'"; filename="').concat(o,`"\r
Content-Type: application/x-zip-compressed\r
\r
`))).concat(Array.prototype.slice.call(d))).push.apply(n,I([],T(p(`\r
`)),!1)),n))).concat(p(a)),["multipart/form-data; boundary="+s,new Uint8Array(i).buffer]}},function(Q,O){throw new Error(`Module parse failed: Unexpected token (5:27)
You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders
| import { ZegoStore, FileConfig, UploadRequestParam } from '../zego.entity';
| 
> export class ZegoStoreImpl implements ZegoStore {
|     basePath = '';
|     fileManager: any;`)},function(Q,O,b){b.r(O),b.d(O,"ZegoStoreImpl",function(){return p}),O=b(82);var T=b.n(O),I=b(7),p=(k.prototype.setDB=function(S){var f=this;this.store=S,this.storeData(this.buffer,function(){return f.buffer.length=0})},k.prototype.storeData=function(S,f){var d=this;if(S&&S.length)if(this.store){var o=Object(I.b)(),c=new Date().getTime()+"_";try{var r=this.store.transaction([this.tname],"readwrite").objectStore(this.tname);typeof S=="string"?r.put(S,c+o):S.forEach(function(t,n){return r.put(t,c+o+"_"+d.padStart(n/100))})}catch{}f&&f()}else typeof S=="string"?this.buffer.push(S):(f=this.buffer).push.apply(f,function(t,n,s){if(s||arguments.length===2)for(var u,a=0,i=n.length;a<i;a++)!u&&a in n||((u=u||Array.prototype.slice.call(n,0,a))[a]=n[a]);return t.concat(u||Array.prototype.slice.call(n))}([],function(t,n){var s=typeof Symbol=="function"&&t[Symbol.iterator];if(!s)return t;var u,a,i=s.call(t),l=[];try{for(;(n===void 0||0<n--)&&!(u=i.next()).done;)l.push(u.value)}catch(h){a={error:h}}finally{try{u&&!u.done&&(s=i.return)&&s.call(i)}finally{if(a)throw a.error}}return l}(S),!1))},k.prototype.upload=function(S,f,d){var o=this,c={time:Date.now(),readTime:0,appID:S.appID,userID:S.userID,version:S.version,action:f,apicall:d,total:0,files:"",key:""};return this.readData(c,d).then(function(r){var t,n;if(r)return t=new Date().getTime(),(n=new FormData).append("logs",r),n.append("id_name",S.userID),n.append("appid",S.appID),n.append("timestamp",t+""),n.append("token",S.token),n.append("deviceid",S.deviceID||""),n.append("product",S.product),n.append("req_sdk","1"),new Promise(function(s,u){o.postFile(S.uploadURL,n,c,s,u)})})},k.prototype.postFile=function(S,f,d,o,c){var r=this,t=new XMLHttpRequest;t.open("post",S),t.onreadystatechange=function(){var n;t.readyState==4&&(200<=t.status&&t.status<300||t.status==304?(n=JSON.parse(t.responseText)).code===0?(d.time=Date.now()-d.time,(0,console.log)("ZegoLoggerSDK:upload",JSON.stringify(d)),r.postFailCount=0,r.clearUploaded(),o()):n.code==4&&(r.postFailCount++,r.postFailCount<3?r.postFile(S,f,d,o,c):(r.postFailCount=0,c(n))):(r.postFailCount=0,c({code:1001,message:"upload fail"})))},t.send(f)},k.prototype.readData=function(S,f){return function(d,o,c,r){return new(c=c||Promise)(function(t,n){function s(i){try{a(r.next(i))}catch(l){n(l)}}function u(i){try{a(r.throw(i))}catch(l){n(l)}}function a(i){var l;i.done?t(i.value):((l=i.value)instanceof c?l:new c(function(h){h(l)})).then(s,u)}a((r=r.apply(d,o||[])).next())})}(this,void 0,void 0,function(){var d=this;return function(o,c){var r,t,n,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},u={next:a(0),throw:a(1),return:a(2)};return typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function a(i){return function(l){var h=[i,l];if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,t&&(n=2&h[0]?t.return:h[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,h[1])).done)return n;switch(t=0,(h=n?[2&h[0],n.value]:h)[0]){case 0:case 1:n=h;break;case 4:return s.label++,{value:h[1],done:!1};case 5:s.label++,t=h[1],h=[0];continue;case 7:h=s.ops.pop(),s.trys.pop();continue;default:if(!(n=0<(n=s.trys).length&&n[n.length-1])&&(h[0]===6||h[0]===2)){s=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){s.label=h[1];break}if(h[0]===6&&s.label<n[1]){s.label=n[1],n=h;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(h);break}n[2]&&s.ops.pop(),s.trys.pop();continue}h=c.call(o,s)}catch(m){h=[6,m],t=0}finally{r=n=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}}(this,function(o){return[2,new Promise(function(c){var r=0,t=[{datas:[],size:0}],n=d.store.transaction([d.tname],"readonly").objectStore(d.tname);n.getAll().onsuccess=function(s){if(s.target.result.forEach(function(u){t[r].size>d.fileConfig.maxSize&&(t[++r]={datas:[],size:0}),t[r].datas.push(u),t[r].size+=u.length+1}),r==0&&!f)return c(null);n.getAllKeys().onsuccess=function(u){d.lastUploadKey=u.target.result.pop();var a=(u=new T.a).folder("log");a&&1<t[0].size?(S.readTime=Date.now()-S.time,S.files=t.map(function(i){return i.size}),S.key=d.lastUploadKey,t[t.length-1].datas.push(JSON.stringify(S)),t.forEach(function(i,l){return a.file("".concat(d.product).concat(l,".txt"),i.datas.join(`
`))}),u.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}).then(function(i){S.total=i.size,c(i)})):c(null)}}})]})})},k.prototype.clearUploaded=function(){var S,f,d=this;this.lastUploadKey?(S=IDBKeyRange.lowerBound(this.lastUploadKey,!0),this.lastUploadKey="",f=[],this.store.transaction([this.tname],"readonly").objectStore(this.tname).openCursor(S).onsuccess=function(o){var c,r,t;if(!(o=o.target.result))return(c=d.store.transaction([d.tname],"readwrite").objectStore(d.tname)).clear(),r=Object(I.b)(),t=new Date().getTime()+"_",void f.forEach(function(n,s){return c.put(n,t+r+"_"+d.padStart(s/100))});f.push(o.value),o.continue()}):this.store.transaction([this.tname],"readwrite").objectStore(this.tname).clear()},k.prototype.padStart=function(S){return String(S).replace(".","")},k);function k(S,f){this.product=S,this.fileConfig=f,this.buffer=[],this.tname="Log",this.postFailCount=0,this.lastUploadKey=""}},function(Q,O){var b,T;Q=Q.exports={};function I(){throw new Error("setTimeout has not been defined")}function p(){throw new Error("clearTimeout has not been defined")}try{b=typeof setTimeout=="function"?setTimeout:I}catch{b=I}try{T=typeof clearTimeout=="function"?clearTimeout:p}catch{T=p}function k(s){if(b===setTimeout)return setTimeout(s,0);if((b===I||!b)&&setTimeout)return(b=setTimeout)(s,0);try{return b(s,0)}catch{try{return b.call(null,s,0)}catch{return b.call(this,s,0)}}}var S,f=[],d=!1,o=-1;function c(){d&&S&&(d=!1,S.length?f=S.concat(f):o=-1,f.length&&r())}function r(){if(!d){for(var s=k(c),u=(d=!0,f.length);u;){for(S=f,f=[];++o<u;)S&&S[o].run();o=-1,u=f.length}S=null,d=!1,function(a){if(T===clearTimeout)return clearTimeout(a);if((T===p||!T)&&clearTimeout)return(T=clearTimeout)(a);try{T(a)}catch{try{return T.call(null,a)}catch{return T.call(this,a)}}}(s)}}function t(s,u){this.fun=s,this.array=u}function n(){}Q.nextTick=function(s){var u=new Array(arguments.length-1);if(1<arguments.length)for(var a=1;a<arguments.length;a++)u[a-1]=arguments[a];f.push(new t(s,u)),f.length!==1||d||k(r)},t.prototype.run=function(){this.fun.apply(null,this.array)},Q.title="browser",Q.browser=!0,Q.env={},Q.argv=[],Q.version="",Q.versions={},Q.on=n,Q.addListener=n,Q.once=n,Q.off=n,Q.removeListener=n,Q.removeAllListeners=n,Q.emit=n,Q.prependListener=n,Q.prependOnceListener=n,Q.listeners=function(s){return[]},Q.binding=function(s){throw new Error("process.binding is not supported")},Q.cwd=function(){return"/"},Q.chdir=function(s){throw new Error("process.chdir is not supported")},Q.umask=function(){return 0}},function(Q,O,b){b.d(O,"a",function(){return S});var T=b(86),I=b(91),p=b(4),k=function(){return(k=Object.assign||function(d){for(var o,c=1,r=arguments.length;c<r;c++)for(var t in o=arguments[c])Object.prototype.hasOwnProperty.call(o,t)&&(d[t]=o[t]);return d}).apply(this,arguments)},S=(f.prototype.setDB=function(d){var o=this;this.store?this.store.setDB(d).then(function(c){o.config.isProd&&c.forEach(function(r){return o.pendingQueue.enqueue(r)})}):this.db=d},f.prototype.clearDB=function(){this.pendingQueue.clear(),this.store&&this.store.clear()},f.prototype.init=function(d){return function(o,c,r,t){return new(r=r||Promise)(function(n,s){function u(l){try{i(t.next(l))}catch(h){s(h)}}function a(l){try{i(t.throw(l))}catch(h){s(h)}}function i(l){var h;l.done?n(l.value):((h=l.value)instanceof r?h:new r(function(m){m(h)})).then(u,a)}i((t=t.apply(o,c||[])).next())})}(this,void 0,void 0,function(){var o,c=this;return function(r,t){var n,s,u,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function l(h){return function(m){var g=[h,m];if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,s&&(u=2&g[0]?s.return:g[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,g[1])).done)return u;switch(s=0,(g=u?[2&g[0],u.value]:g)[0]){case 0:case 1:u=g;break;case 4:return a.label++,{value:g[1],done:!1};case 5:a.label++,s=g[1],g=[0];continue;case 7:g=a.ops.pop(),a.trys.pop();continue;default:if(!(u=0<(u=a.trys).length&&u[u.length-1])&&(g[0]===6||g[0]===2)){a=0;continue}if(g[0]===3&&(!u||g[1]>u[0]&&g[1]<u[3])){a.label=g[1];break}if(g[0]===6&&a.label<u[1]){a.label=u[1],u=g;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(g);break}u[2]&&a.ops.pop(),a.trys.pop();continue}g=t.call(r,a)}catch(y){g=[6,y],s=0}finally{n=u=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}}(this,function(r){return this.config=k(k({},p.b),d),this.logger=new T.a(this.miniProgram),this.logger.setLogUrlParams({product:this.product,signature:this.config.token||"",appid:this.config.appID,id_name:this.config.userID||"",deviceid:this.config.deviceID||""}),this.logger.setLogServer(this.config.serverUrl||""),this.logger.setPostSucCallback(this.postSucHandler.bind(this)),this.logger.setPostFailCallback(function(t){t.push.apply(t,function(n,s,u){if(u||arguments.length===2)for(var a,i=0,l=s.length;i<l;i++)!a&&i in s||((a=a||Array.prototype.slice.call(s,0,i))[i]=s[i]);return n.concat(a||Array.prototype.slice.call(s))}([],function(n,s){var u=typeof Symbol=="function"&&n[Symbol.iterator];if(!u)return n;var a,i,l=u.call(n),h=[];try{for(;(s===void 0||0<s--)&&!(a=l.next()).done;)h.push(a.value)}catch(m){i={error:m}}finally{try{a&&!a.done&&(u=l.return)&&u.call(l)}finally{if(i)throw i.error}}return h}(c.pendingQueue.readStoreData(1)),!1)),c.store.setItems(t)}),this.initPendingQueue(),o=b(49)("./"+(this.miniProgram?"zego.impl.wx":"zego.impl.web")).createZegoStore,this.store=o(this.config.appID,this.miniProgram),(this.db||this.miniProgram)&&this.store.setDB(this.db).then(function(t){c.config.isProd&&t.forEach(function(n){return c.pendingQueue.enqueue(n)})}),[2]})})},f.prototype.pause=function(){this.isPaused=!0},f.prototype.startReport=function(d){var o=d.get("userID"),c=d.get("token");return!(!o||typeof o!="string")&&!(!c||typeof c!="string")&&(this.startCommonField=d,this.config.userID=o,this.config.token=c,this.logger.setLogUrlParams({product:this.product,signature:this.config.token,appid:this.config.appID,id_name:this.config.userID||"",deviceid:this.config.deviceID||""}),(o=d.get("serverUrl"))&&(this.config.serverUrl=o,this.logger.setLogServer(this.config.serverUrl)),this.isConfigOK(this.config)&&(d=(c=this.pendingQueue.getPendingDataInfo()).pendingDataSize,o=c.size,this.checkPendingQueue(d,o)),!0)},f.prototype.resume=function(){this.isPaused=!1;var d=(o=this.pendingQueue.getPendingDataInfo()).pendingDataSize,o=o.size;this.checkPendingQueue(d,o)},f.prototype.report=function(d,o){o===void 0&&(o=!1);var c=Object(p.g)();return c={key:new Date().getTime()+"_"+c,value:d},this.config.isProd&&this.pendingQueue.enqueue(c),!this.config.isProd&&o||this.store.setItems([c]),!0},f.prototype.isConfigOK=function(d){return d.userID!==""&&d.token!==""&&d.server!==""},f.prototype.postSucHandler=function(d){this.store.removeItems(d);var o=(d=this.pendingQueue.getPendingDataInfo()).pendingDataSize;d=d.size,this.checkPendingQueue(o,d)},f.prototype.checkPendingQueue=function(d,o){if(d>this.config.reportSize||o>this.config.reportNum){if((this.isPaused||!this.config.userID||!this.config.token||!this.config.serverUrl)&&(d>=this.cacheMaxSize||p.a.totalAvailCache<=0))return this.store.setItems(this.pendingQueue.readStoreData(this.cacheDelPer));if(!this.logger.reportAllowed()&&(d>=this.cacheMaxSize||p.a.totalAvailCache<=0))return this.store.setItems(this.pendingQueue.readStoreData(this.cacheDelPer));d=(o=this.pendingQueue.readReportData(this.config.reportSize)).totalLen,o=o.reportDataArr,this.logger.report(o),this.pendingQueue.refresh(d)}},f.prototype.initPendingQueue=function(){var d=this;this.pendingQueue=new I.a,this.pendingQueue.setListener({enCallback:function(o,c,r){d.checkPendingQueue(r,c)}})},f);function f(d,o){this.product=d,this.miniProgram=o,this.QUEUE_MAX=100,this.cacheMaxSize=p.a.cacheMaxSize,this.cacheDelPer=p.a.cacheDelPer,this.forceDataTotalLen=0,this.isPaused=!1}},function(Q,O,b){var T={"./zego.impl.web":50,"./zego.impl.web.ts":50,"./zego.impl.wx":51,"./zego.impl.wx.ts":51};function I(k){return k=p(k),b(k)}function p(k){if(b.o(T,k))return T[k];throw(k=new Error("Cannot find module '"+k+"'")).code="MODULE_NOT_FOUND",k}I.keys=function(){return Object.keys(T)},I.resolve=p,(Q.exports=I).id=49},function(Q,O,b){b.r(O),b.d(O,"createZegoStore",function(){return p}),b.d(O,"createZegoWebSocket",function(){return k});var T=(I.prototype.setDB=function(S){return this.store=S,this.getAll()},I.prototype.clear=function(){this.buffer.length=0},I.prototype.setItems=function(S){var f;if(this.store)try{var d=this.store.transaction([this.tname],"readwrite").objectStore(this.tname);S.forEach(function(o){return d.put(o.value,o.key)})}catch{}else(f=this.buffer).push.apply(f,function(o,c,r){if(r||arguments.length===2)for(var t,n=0,s=c.length;n<s;n++)!t&&n in c||((t=t||Array.prototype.slice.call(c,0,n))[n]=c[n]);return o.concat(t||Array.prototype.slice.call(c))}([],function(o,c){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var t,n,s=r.call(o),u=[];try{for(;(c===void 0||0<c--)&&!(t=s.next()).done;)u.push(t.value)}catch(a){n={error:a}}finally{try{t&&!t.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return u}(S),!1))},I.prototype.removeItems=function(S){var f;this.store&&(f=this.store.transaction([this.tname],"readwrite").objectStore(this.tname),S.forEach(function(d){return f.delete(d.key)}))},I.prototype.getAll=function(){var S=this;return new Promise(function(f){var d=S.store.transaction([S.tname],"readonly").objectStore(S.tname);d.getAllKeys().onsuccess=function(o){var c=o.target.result;d.getAll().onsuccess=function(r){r=r.target.result.map(function(t,n){return{key:c[n],value:t}}),f(r)}}})},I);function I(){this.buffer=[],this.tname="DataReport"}function p(){return new T}function k(S,f){var d=[];return(S=(Object.keys(f).forEach(function(o){d.push("".concat(o,"=").concat(f[o]))}),new WebSocket(S+"?"+d.join("&")))).binaryType="arraybuffer",S}},function(Q,O){throw new Error(`Module parse failed: Unexpected token (4:20)
You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders
| import { ReportDataItem, ZegoStore, ZegoWebSocket } from '../../common/zego.entity';
| 
> class ZegoStoreImpl implements ZegoStore {
|     isAlipay = false;
|     isReadAll = false;`)},function(Q,O,b){b.d(O,"a",function(){return o});var T=b(6),I=(O=b(14),b.n(O)),p=(O=b(16),b.n(O)),k=(O=b(17),b.n(O)),S=(O=b(53),b.n(O)),f=(O=b(11),b.n(O)),d=b(54),o=(Object.defineProperty(c.prototype,"publicKey",{get:function(){return`-----BEGIN RSA Public Key-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0XCwmB4kWk0ZI9mD8AqU
KikrV4G8JWpsTeYa6txrQUaZzTtvRzfUco8wKnBe4FI+vtWqscB7/Yp9wdM+ymDX
d2THFtYqgp2ZpYBrIPr/fBBHXOOmzhu0OW89VW+fmrNHoytBHdEkGYprljIvJtjR
8mAasd6jSbhYla9soa8ukZgaOnKssgqWlgQOAf0RSSP3aBGS4ldY9lB5jtZDg2VK
3eTwRg56HrmR7HO+VwCeqaxbwLNUQkgW99ovVwtgCXCcoVOApkiqx3qWNLVrOnTr
n0H1B6g8t6QijZ3aQHW0I86UaO1SHJ8TOdZnCouWkFUfmJ03dPs7Up59u7wyzNIF
uQIDAQAB
-----END RSA Public Key-----`},enumerable:!1,configurable:!0}),c.prototype.encrypt=function(r,t){return r=I.a.encrypt(this.uint8Array2WordArray(r),t.cryptoConfig.key2,t.cryptoConfig.iv2).toString(),T.a.toUint8Array(r)},c.prototype.decrypt=function(r,t){return this.wordArray2Uint8Array(I.a.decrypt(T.a.fromUint8Array(r),t.cryptoConfig.key2,t.cryptoConfig.iv2))},c.prototype.encryptString=function(r,t){return I.a.encrypt(r,t.cryptoConfig.appIDKey,t.cryptoConfig.appIDIV).toString()},c.prototype.decryptString=function(r,t){return I.a.decrypt(r,t.cryptoConfig.appIDKey,t.cryptoConfig.appIDIV).toString(k.a)},c.prototype.generateK1Sign=function(r){var t=this.generateNonce();return r.cryptoConfig.key1=k.a.parse(t),r.cryptoConfig.iv1={iv:p.a.parse(f()(t).toString().toLowerCase())},r=new d.a(this.publicKey).encrypt(t),this.wordArray2Uint8Array(p.a.parse(r))},c.prototype.decryptK2Sign=function(r,t){try{t.cryptoConfig.key2=I.a.decrypt(T.a.fromUint8Array(r),t.cryptoConfig.key1,t.cryptoConfig.iv1),t.cryptoConfig.iv2={iv:f()(t.cryptoConfig.key2)}}catch{}},c.prototype.generateNonce=function(){var r=Math.random().toString().substring(2,18);return r.length<16&&(r+=r.substring(0,16-r.length)),r},c.prototype.generateAppIDKey=function(r){var t=f()(String(r.appID)).toString().toLowerCase();r.cryptoConfig.appIDKey=k.a.parse(t),r.cryptoConfig.appIDIV={iv:p.a.parse(t)}},c.prototype.md5=function(r){return this.wordArray2Uint8Array(f()(r))},c.prototype.md5Bytes=function(r){return this.wordArray2Uint8Array(f()(this.uint8Array2WordArray(r)))},c.prototype.wordArray2Uint8Array=function(r){for(var t=r.words,n=r.sigBytes,s=new Uint8Array(n),u=0;u<n;u++){var a=t[u>>>2]>>>24-u%4*8&255;s[u]=a}return s},c.prototype.uint8Array2WordArray=function(r){for(var t=r.length,n=[],s=0;s<t;s++)n[s>>>2]|=(255&r[s])<<24-s%4*8;return S.a.create(n,t)},c);function c(){}},function(Q,O,b){var T;Q.exports=(T=b(5),function(){var I,p;typeof ArrayBuffer=="function"&&(I=T.lib.WordArray,p=I.init,(I.init=function(k){if((k=(k=k instanceof ArrayBuffer?new Uint8Array(k):k)instanceof Int8Array||typeof Uint8ClampedArray<"u"&&k instanceof Uint8ClampedArray||k instanceof Int16Array||k instanceof Uint16Array||k instanceof Int32Array||k instanceof Uint32Array||k instanceof Float32Array||k instanceof Float64Array?new Uint8Array(k.buffer,k.byteOffset,k.byteLength):k)instanceof Uint8Array){for(var S=k.byteLength,f=[],d=0;d<S;d++)f[d>>>2]|=k[d]<<24-d%4*8;p.call(this,f,S)}else p.apply(this,arguments)}).prototype=I)}(),T.lib.WordArray)},function(Q,O,b){b.d(O,"a",function(){return f});var T=b(18),I=b(55),p=b(56),k=b(57),S=b(58),f=(d.prototype.parseKey=function(o){try{var c=0,r=0,t=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/.test(o)?p.a.decode(o):k.a.unarmor(o),n=S.a.decode(t);if((n=n.sub.length===3?n.sub[2].sub[0]:n).sub.length===9)c=n.sub[1].getHexStringValue(),this.n=Object(T.b)(c,16),r=n.sub[2].getHexStringValue(),this.e=parseInt(r,16);else{if(n.sub.length!==2)return!1;var s=n.sub[1].sub[0];c=s.sub[0].getHexStringValue(),this.n=Object(T.b)(c,16),r=s.sub[1].getHexStringValue(),this.e=parseInt(r,16)}return!0}catch{return!1}},d.prototype.pkcs1pad2=function(o,c){for(var r=[],t=o.length-1;0<=t&&0<c;){var n=o.charCodeAt(t--);n<128?r[--c]=n:127<n&&n<2048?(r[--c]=63&n|128,r[--c]=n>>6|192):(r[--c]=63&n|128,r[--c]=n>>6&63|128,r[--c]=n>>12|224)}r[--c]=0;for(var s=new I.a,u=[];2<c;){for(u[0]=0;u[0]==0;)s.nextBytes(u);r[--c]=u[0]}return r[--c]=2,r[--c]=0,new T.a(r)},d.prototype.encrypt=function(o){for(var c=this.n.bitLength()+7>>3,r=this.pkcs1pad2(o,c).modPowInt(this.e,this.n).toString(16),t=r.length,n=0;n<2*c-t;n++)r="0"+r;return r},d);function d(o){this.e=0,this.parseKey(o)}},function(Q,O,b){b.d(O,"a",function(){return d});var T,I=b(21),p=[],k=0,S=void 0;if(typeof window<"u"&&window.crypto&&window.crypto.getRandomValues){var f=new Uint32Array(256);for(window.crypto.getRandomValues(f),S=0;S<f.length;++S)p[k++]=255&f[S]}o.prototype.nextBytes=function(c){for(var r=0;r<c.length;++r)c[r]=function(){if(T==null){for(T=Object(I.a)();k<I.b;){var t=Math.floor(65536*Math.random());p[k++]=255&t}for(T.init(p),k=0;k<p.length;++k)p[k]=0;k=0}return T.next()}()};var d=o;function o(){}},function(Q,O,b){b.d(O,"a",function(){return I});var T,I={decode:function(p){if(T===void 0){var k="0123456789ABCDEF",S=` \f
\r	\u2028\u2029`;for(T={},c=0;c<16;++c)T[k.charAt(c)]=c;for(k=k.toLowerCase(),c=10;c<16;++c)T[k.charAt(c)]=c;for(c=0;c<S.length;++c)T[S.charAt(c)]=-1}for(var f=[],d=0,o=0,c=0;c<p.length;++c){var r=p.charAt(c);if(r=="=")break;if((r=T[r])!=-1){if(r===void 0)throw new Error("Illegal character at offset "+c);d|=r,2<=++o?(f[f.length]=d,o=d=0):d<<=4}}if(o)throw new Error("Hex encoding incomplete: 4 bits missing");return f}}},function(Q,O,b){b.d(O,"a",function(){return I});var T,I={decode:function(p){if(T===void 0){var k=`= \f
\r	\u2028\u2029`;for(T=Object.create(null),o=0;o<64;++o)T["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o)]=o;for(T["-"]=62,T._=63,o=0;o<k.length;++o)T[k.charAt(o)]=-1}for(var S=[],f=0,d=0,o=0;o<p.length;++o){var c=p.charAt(o);if(c=="=")break;if((c=T[c])!=-1){if(c===void 0)throw new Error("Illegal character at offset "+o);f|=c,4<=++d?(S[S.length]=f>>16,S[S.length]=f>>8&255,S[S.length]=255&f,d=f=0):f<<=6}}switch(d){case 1:throw new Error("Base64 encoding incomplete: at least 2 bits missing");case 2:S[S.length]=f>>10;break;case 3:S[S.length]=f>>16,S[S.length]=f>>8&255}return S},re:/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,unarmor:function(p){var k=I.re.exec(p);if(k)if(k[1])p=k[1];else{if(!k[2])throw new Error("RegExp out of sync");p=k[2]}return I.decode(p)}}},function(Q,O,b){b.d(O,"a",function(){return k});var T=b(59),I=(p.prototype.get=function(o){if((o=o===void 0?this.pos++:o)>=this.enc.length)throw new Error("Requesting byte offset "+o+" on a stream of length "+this.enc.length);return typeof this.enc=="string"?this.enc.charCodeAt(o):this.enc[o]},p.prototype.hexByte=function(o){return this.hexDigits.charAt(o>>4&15)+this.hexDigits.charAt(15&o)},p.prototype.hexDump=function(o,c,r){for(var t="",n=o;n<c;++n)if(t+=this.hexByte(this.get(n)),r!==!0)switch(15&n){case 7:t+="  ";break;case 15:t+=`
`;break;default:t+=" "}return t},p);function p(o,c){this.hexDigits="0123456789ABCDEF",o instanceof p?(this.enc=o.enc,this.pos=o.pos):(this.enc=o,this.pos=c)}S.prototype.posStart=function(){return this.stream.pos},S.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},S.prototype.toHexString=function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},S.decodeLength=function(o){var c=127&(r=o.get());if(c==r)return c;if(6<c)throw new Error("Length over 48 bits not supported at position "+(o.pos-1));if(c==0)return null;for(var r=0,t=0;t<c;++t)r=256*r+o.get();return r},S.prototype.getHexStringValue=function(){var o=this.toHexString(),c=2*this.header,r=2*this.length;return o.substr(c,r)},S.decode=function(o){function c(){var l=[];if(n!==null){for(var h=s+n;r.pos<h;)l[l.length]=S.decode(r);if(r.pos!=h)throw new Error("Content size is not correct for container starting at offset "+s)}else try{for(;;){var m=S.decode(r);if(m.tag.isEOC())break;l[l.length]=m}n=s-r.pos}catch(g){throw new Error("Exception while decoding undefined length content: "+g)}return l}var r=o instanceof I?o:new I(o,0),t=(o=new I(r),new f(r)),n=S.decodeLength(r),s=r.pos,u=s-o.pos,a=null;if(t.tagConstructed)a=c();else if(t.isUniversal()&&(t.tagNumber==3||t.tagNumber==4))try{if(t.tagNumber==3&&r.get()!=0)throw new Error("BIT STRINGs with unused bits cannot encapsulate.");a=c();for(var i=0;i<a.length;++i)if(a[i].tag.isEOC())throw new Error("EOC is not supposed to be actual content.")}catch{a=null}if(a===null){if(n===null)throw new Error("We can't skip over an invalid tag with undefined length at offset "+s);r.pos=s+Math.abs(n)}return new S(o,u,n,t,a)};var k=S;function S(o,c,r,t,n){if(!(t instanceof f))throw new Error("Invalid tag value.");this.stream=o,this.header=c,this.length=r,this.tag=t,this.sub=n}d.prototype.isUniversal=function(){return this.tagClass===0},d.prototype.isEOC=function(){return this.tagClass===0&&this.tagNumber===0};var f=d;function d(o){var c=o.get();if(this.tagClass=c>>6,this.tagConstructed=(32&c)!=0,this.tagNumber=31&c,this.tagNumber==31){for(var r=new T.a;c=o.get(),r.mulAdd(128,127&c),128&c;);this.tagNumber=r.simplify()}}},function(Q,O,b){b.d(O,"a",function(){return T}),I.prototype.mulAdd=function(p,k){for(var S,f=this.buf,d=f.length,o=0;o<d;++o)(S=f[o]*p+k)<1e13?k=0:S-=1e13*(k=0|S/1e13),f[o]=S;0<k&&(f[o]=k)},I.prototype.sub=function(p){for(var k,S=this.buf,f=S.length,d=0;d<f;++d)p=(k=S[d]-p)<0?(k+=1e13,1):0,S[d]=k;for(;S[S.length-1]===0;)S.pop()},I.prototype.simplify=function(){var p=this.buf;return p.length==1?p[0]:this};var T=I;function I(p){this.buf=[+p||0]}},function(Q,O,b){b.d(O,"a",function(){return S});var T=b(61),I=b(1),p=b(0),k=function(){return(k=Object.assign||function(d){for(var o,c=1,r=arguments.length;c<r;c++)for(var t in o=arguments[c])Object.prototype.hasOwnProperty.call(o,t)&&(d[t]=o[t]);return d}).apply(this,arguments)},S=(f.prototype.encodeRequest=function(d,o,c,r){var t=((s=d.cmd!=p.c.sw_handshake_req.cmd&&d.cmd!=p.c.sw_login.cmd)||(d.flags[0]=0),this.encode(this.protoInstance.proto_zim.Header,d)),n=t.length,s=(o=this.encode(this.getProtoBeanInstance(d.cmd,"req"),o),(o=s?this.crypto.encrypt(o,r):o).length);return(r=new Uint8Array(7+n+s))[0]=33,r[1]=n>>8,r[2]=n-(r[1]<<8),r.set(new Uint8Array(new Int32Array([s]).buffer).reverse(),3),r.set(t,7),r.set(o,7+n),c?this.encodeAccesshubPCUpwardMessage(c,d,r):r},f.prototype.decodeAccesshubResponse=function(d,o){return d==21?this.decode(this.protoInstance.proto_accesshub.PCDownwardMessage,o.slice(13)).payload:(d=this.accesshubDecodeTypeMap[d])&&this.decode(this.protoInstance.proto_accesshub[d],o.slice(13))},f.prototype.decodeResponseHeader=function(d){var o=(d[1]<<8)+d[2];return[this.decode(this.protoInstance.proto_zim.Header,d.slice(7,7+o)),o]},f.prototype.decodeResponseBody=function(d,o,c,r){var t,n=this;if(d=d.slice(7+c),o!=p.c.sw_login.cmd)try{d=this.crypto.decrypt(d,r)}catch{t=!0}var s=[];try{var u=this.decode(this.getProtoBeanInstance(o,"rsp"),d);return o===p.c.sw_push_list.cmd&&u.push_requests&&u.push_requests.forEach(function(a){s.push(a.sub_cmd),a.msg_body=n.decode(n.getProtoBeanInstance(a.sub_cmd,"rsp"),a.msg_body)}),u}catch(a){return(0,console.warn)("Rsp body decrypt error or Protobuf decode error",{cmd:o,decryptError:t,decodeError:!0,rspBody:d},a),{code:1,message:"Protobuf decode error for "+o,subCmds:s}}},f.prototype.encodeMediaMsgBody=function(d,o){return d=d==p.R.Image?"PictureMsgBody":"VideoMsgBody",this.encode(this.protoInstance.proto_zim[d],o)},f.prototype.decodeMsgBody=function(d,o,c,r){var t=d.type;if(t>=p.R.Image&&t<=p.R.Video){d.message="";var n,s,u,a=null,i=t==p.R.Image?"PictureMsgBody":"VideoMsgBody";if(c==1)try{a=this.decode(this.protoInstance.proto_zim[i],o)}catch{try{a=JSON.parse(Object(I.f)(o))}catch{}}else try{a=JSON.parse(Object(I.f)(o))}catch{try{a=this.decode(this.protoInstance.proto_zim[i],o)}catch{}}a&&(c=!r&&a.file_uid,i=this.handleFileProxyHost(c,a.file_download_url||""),(n=d).fileUID=!r&&a.file_uid||"",n.fileName=a.file_name||"",n.fileSize=+a.file_size||0,n.fileDownloadUrl=i,t==p.R.Image?(s=d,(u=a.large_image_download_url)?s.largeImageDownloadUrl=this.handleFileProxyHost(c,u):a.large&&(s.largeImageDownloadUrl=i+a.large),(u=a.thumbnail_download_url)?s.thumbnailDownloadUrl=this.handleFileProxyHost(c,u):a.thumbnail&&(s.thumbnailDownloadUrl=i+a.thumbnail),s.originalImageWidth=a.origin_width||0,s.originalImageHeight=a.origin_height||0,s.thumbnailWidth=a.small_width||0,s.thumbnailHeight=a.small_height||0,s.largeImageWidth=a.big_width||0,s.largeImageHeight=a.big_height||0):t==p.R.Audio?(s=d).audioDuration=+a.media_duration||0:t==p.R.Video&&((s=d).videoDuration=+a.media_duration||0,(u=a.video_first_frame_download_url)?s.videoFirstFrameDownloadUrl=this.handleFileProxyHost(c,u):a.thumbnail&&(s.videoFirstFrameDownloadUrl=i+a.thumbnail),s.videoFirstFrameWidth=a.frame_width||0,s.videoFirstFrameHeight=a.frame_height||0))}else t==p.R.Revoke?(d.message="",r=o,n=Object(I.r)(r.msg_status).revoke,c=r.msg_type,Object.assign(d,{revokeType:r.revoke_type,revokeStatus:n,revokeTimestamp:r.revoke_time,operatedUserID:r.user_id,revokeExtendedData:Object(I.f)(r.payload),originalMessageType:200<=c&&c<=400?p.R.Custom:c,originalTextMessageContent:""})):d.message=Object(I.f)(o)},f.prototype.encodeAccesshubHTTPRequest=function(d,o,c,r,t,n){var s=r.url.replace(/^(https?):\/\/[\w\-\.]+\//,"/"),u=(u=r.headers)&&Object.keys(u).map(function(a){return{name:a,val:String(u[a])}});return o={txid:o,appid:c.appID,id_name:c.user.userID,location:s,headers:u,body:t?Object(I.i)(JSON.stringify(t)):null,mode_no:1,service_no:n,method_no:r.method=="GET"?1:2,sdk_type:3,zegoconn_version:2,zegoconn_run_env:I.n?2:1},c=this.encode(this.protoInstance.proto_accesshub.HTTPRequest,o),this.createAccesshubBody(4,d,c)},f.prototype.encodeAccesshubDispatchRequest=function(d,o,c){return o={txid:o,appid:c.appID,id_name:c.user.userID,mode_no:1,sdk_type:3,zegoconn_version:2,zegoconn_run_env:I.n?2:1},this.geoFence.type&&(o.geofencing_type=this.geoFence.type,o.geofencings=this.geoFence.areas),c=this.encode(this.protoInstance.proto_accesshub.AccesshubDispatchRequest,o),this.createAccesshubBody(26,d,c)},f.prototype.encodeAccesshubGetConfigRequest=function(d,o,c){return o={txid:o,appid:c.appID,mode:"online",id_name:c.user.userID,zegoconn_version:2,sdk_type:3,zegoconn_run_env:I.n?2:1,mode_no:1},this.geoFence.type&&(o.geofencing_type=this.geoFence.type,o.geofencings=this.geoFence.areas),c=this.encode(this.protoInstance.proto_accesshub.GetConfigRequest,o),this.createAccesshubBody(14,d,c)},f.prototype.encodeAccesshubPCUpwardMessage=function(d,o,c){return o={txid:o.seq,appid:o.app_id,mode_no:1,id_name:o.user_id,service_no:9,payload:c,sdk_type:3,wss_message_type:1,wss_path:"/ws",zegoconn_version:2,zegoconn_run_env:I.n?2:1},this.geoFence.type&&(o.geofencing_type=this.geoFence.type,o.geofencings=this.geoFence.areas),c=this.encode(this.protoInstance.proto_accesshub.PCUpwardMessage,o),this.createAccesshubBody(17,d,c)},f.prototype.createAccesshubBody=function(d,o,c){var r=new Uint8Array(13+c.length);return r[0]=175,r[1]=0,r[2]=d>>8,r[3]=d-(r[2]<<8),r.set(new Uint8Array(new Int32Array([c.length]).buffer).reverse(),4),r.set(new Uint8Array(new Int32Array([o]).buffer).reverse(),8),r[12]=0,r.set(c,13),r},f.prototype.encode=function(d,o){return d.encode(new d(o)).finish()},f.prototype.decode=function(d,o){return d?k({},d.decode(o||[])):{}},f.prototype.getProtoBeanInstance=function(d,o){return d=(d=this.protoBeanMap[d])&&d[o],this.protoInstance.proto_zim[d]},f.prototype.handleFileProxyHost=function(d,o){var c=this.geoFence.host.fileproxy;return d&&c&&o?o.replace(this.geoFence.reg,c+"$4"):o},f);function f(d,o){this.crypto=d,this.geoFence=o,this.protoInstance=T.a,this.protoBeanMap=Object.values(p.c).reduce(function(c,r){return c[r.cmd]=r,c},{}),this.accesshubDecodeTypeMap={5:"HTTPResponse",27:"AccesshubDispatchResponse",15:"GetConfigResponse",3:"CloseConnection",22:"Redirect",19:"PCEstablished",30:"PushException"}}},function(Q,O,b){b.d(O,"a",function(){return f}),O=b(9);var T=b(3);function I(d,o){if(o)for(let c=Object.keys(o),r=0;r<c.length;++r)o[c[r]]!=null&&(d[c[r]]=o[c[r]])}O.util.Long=b.n(T).a,O.configure();const p=O.Reader,k=O.Writer,S=O.util,f=O.roots.default||(O.roots.default={});f.proto_accesshub=(()=>{const d={};function o(D){this.headers=[],I(this,D)}function c(D){I(this,D)}function r(){this.headers=[],this.txid=0}function t(D){I(this,D)}function n(){}function s(){}function u(){this.groups=[],this.opt_ports=[],this.wss_groups=[]}function a(){this.txid=0}function i(){}function l(D){I(this,D)}function h(){this.quic_nodes=[],this.mtcp_nodes=[],this.wss_nodes=[]}function m(){}function g(){this.txid=0,this.groups=[],this.opt_ports=[],this.wss_groups=[]}function y(){}function w(D){I(this,D)}function M(){}function R(){}return d.HTTPRequest=(o.encode=function(D,q){if(q=q||k.create(),Object.hasOwnProperty.call(D,"txid")&&q.uint32(8).uint64(D.txid),Object.hasOwnProperty.call(D,"appid")&&q.uint32(16).uint32(D.appid),Object.hasOwnProperty.call(D,"mode")&&q.uint32(34).string(D.mode),Object.hasOwnProperty.call(D,"id_name")&&q.uint32(42).string(D.id_name),Object.hasOwnProperty.call(D,"stick")&&q.uint32(58).string(D.stick),Object.hasOwnProperty.call(D,"service")&&q.uint32(66).string(D.service),Object.hasOwnProperty.call(D,"location")&&q.uint32(74).string(D.location),Object.hasOwnProperty.call(D,"method")&&q.uint32(82).string(D.method),D.headers&&D.headers.length)for(let L=0;L<D.headers.length;++L)f.proto_accesshub.HTTPRequest.HTTPHeader.encode(D.headers[L],q.uint32(90).fork()).ldelim();return Object.hasOwnProperty.call(D,"body")&&q.uint32(98).bytes(D.body),Object.hasOwnProperty.call(D,"mode_no")&&q.uint32(112).int32(D.mode_no),Object.hasOwnProperty.call(D,"service_no")&&q.uint32(120).int32(D.service_no),Object.hasOwnProperty.call(D,"method_no")&&q.uint32(128).int32(D.method_no),Object.hasOwnProperty.call(D,"sdk_type")&&q.uint32(136).int32(D.sdk_type),Object.hasOwnProperty.call(D,"zegoconn_run_env")&&q.uint32(144).int32(D.zegoconn_run_env),Object.hasOwnProperty.call(D,"zegoconn_version")&&q.uint32(152).uint32(D.zegoconn_version),q},o.HTTPHeader=(c.encode=function(D,q){return q=q||k.create(),Object.hasOwnProperty.call(D,"name")&&q.uint32(10).string(D.name),Object.hasOwnProperty.call(D,"val")&&q.uint32(18).string(D.val),q},c.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.HTTPRequest.HTTPHeader;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.name=D.string();break;case 2:j.val=D.string();break;default:D.skipType(7&G)}}return j},c),o),d.HTTPResponse=(r.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.HTTPResponse;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.txid=D.uint64();break;case 2:j.headers.push(f.proto_accesshub.HTTPRequest.HTTPHeader.decode(D,D.uint32()));break;case 3:j.status_code=D.int32();break;case 4:j.body=D.bytes();break;default:D.skipType(7&G)}}return j.txid=+j.txid.toString(),j},r),d.PCUpwardMessage=(t.encode=function(D,q){if(q=q||k.create(),Object.hasOwnProperty.call(D,"txid")&&q.uint32(8).uint64(D.txid),Object.hasOwnProperty.call(D,"appid")&&q.uint32(16).uint32(D.appid),Object.hasOwnProperty.call(D,"mode_no")&&q.uint32(32).int32(D.mode_no),Object.hasOwnProperty.call(D,"id_name")&&q.uint32(42).string(D.id_name),Object.hasOwnProperty.call(D,"service_no")&&q.uint32(48).int32(D.service_no),Object.hasOwnProperty.call(D,"payload")&&q.uint32(66).bytes(D.payload),Object.hasOwnProperty.call(D,"sdk_type")&&q.uint32(72).int32(D.sdk_type),Object.hasOwnProperty.call(D,"wss_message_type")&&q.uint32(80).uint32(D.wss_message_type),Object.hasOwnProperty.call(D,"wss_path")&&q.uint32(90).string(D.wss_path),Object.hasOwnProperty.call(D,"zegoconn_version")&&q.uint32(104).uint32(D.zegoconn_version),Object.hasOwnProperty.call(D,"zegoconn_run_env")&&q.uint32(112).int32(D.zegoconn_run_env),Object.hasOwnProperty.call(D,"geofencing_type")&&q.uint32(136).uint32(D.geofencing_type),D.geofencings&&D.geofencings.length)for(let L=0;L<D.geofencings.length;++L)q.uint32(144).uint32(D.geofencings[L]);return q},t),d.PCDownwardMessage=(n.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.PCDownwardMessage;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.payload=D.bytes();break;case 2:j.wss_message_type=D.uint32();break;default:D.skipType(7&G)}}return j},n),d.PCEstablished=(s.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.PCEstablished;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.elapse=D.uint32();break;case 2:j.from=D.uint32();break;default:D.skipType(7&G)}}return j},s),d.Redirect=(u.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.Redirect;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.rand=D.string();break;case 2:j.secret=D.string();break;case 3:j.groups.push(f.proto_accesshub.AccesshubDispatchGroup.decode(D,D.uint32()));break;case 4:if((7&G)==2)for(var J=D.uint32()+D.pos;D.pos<J;)j.opt_ports.push(D.uint32());else j.opt_ports.push(D.uint32());break;case 5:j.wss_groups.push(f.proto_accesshub.WssAccesshubDispatchGroup.decode(D,D.uint32()));break;default:D.skipType(7&G)}}return j},u),d.PushException=(a.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.PushException;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.reason=D.int32();break;case 2:j.msg=D.string();break;case 3:j.txid=D.uint64();break;default:D.skipType(7&G)}}return j.txid=+j.txid.toString(),j},a),d.CloseConnection=(i.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.CloseConnection;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.reason=D.int32();break;case 2:j.msg=D.string();break;case 3:j.action=D.int32();break;default:D.skipType(7&G)}}return j},i),d.AccesshubDispatchRequest=(l.encode=function(D,q){if(q=q||k.create(),Object.hasOwnProperty.call(D,"txid")&&q.uint32(8).uint64(D.txid),Object.hasOwnProperty.call(D,"appid")&&q.uint32(16).uint32(D.appid),Object.hasOwnProperty.call(D,"mode_no")&&q.uint32(32).int32(D.mode_no),Object.hasOwnProperty.call(D,"id_name")&&q.uint32(42).string(D.id_name),Object.hasOwnProperty.call(D,"sdk_type")&&q.uint32(48).int32(D.sdk_type),Object.hasOwnProperty.call(D,"zegoconn_version")&&q.uint32(56).uint32(D.zegoconn_version),Object.hasOwnProperty.call(D,"zegoconn_run_env")&&q.uint32(64).int32(D.zegoconn_run_env),Object.hasOwnProperty.call(D,"geofencing_type")&&q.uint32(88).uint32(D.geofencing_type),D.geofencings&&D.geofencings.length)for(let L=0;L<D.geofencings.length;++L)q.uint32(96).uint32(D.geofencings[L]);return q},l),d.AccesshubDispatchGroup=(h.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.AccesshubDispatchGroup;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.group=D.string();break;case 2:j.quic_nodes.push(D.string());break;case 3:j.mtcp_nodes.push(D.string());break;case 4:j.wss_nodes.push(D.string());break;default:D.skipType(7&G)}}return j},h),d.WssAccesshubDispatchGroup=(m.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.WssAccesshubDispatchGroup;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.group=D.string();break;case 2:j.host=D.string();break;case 3:j.main_domain=D.string();break;default:D.skipType(7&G)}}return j},m),d.AccesshubDispatchResponseData=(g.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.AccesshubDispatchResponseData;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.txid=D.uint64();break;case 2:j.rand=D.string();break;case 3:j.secret=D.string();break;case 4:j.groups.push(f.proto_accesshub.AccesshubDispatchGroup.decode(D,D.uint32()));break;case 5:if((7&G)==2)for(var J=D.uint32()+D.pos;D.pos<J;)j.opt_ports.push(D.uint32());else j.opt_ports.push(D.uint32());break;case 6:j.wss_groups.push(f.proto_accesshub.WssAccesshubDispatchGroup.decode(D,D.uint32()));break;default:D.skipType(7&G)}}return j.txid=+j.txid.toString(),j},g),d.AccesshubDispatchResponse=(y.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.AccesshubDispatchResponse;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.code=D.int32();break;case 2:j.message=D.string();break;case 3:Object.assign(j,f.proto_accesshub.AccesshubDispatchResponseData.decode(D,D.uint32()));break;default:D.skipType(7&G)}}return j},y),d.GetConfigRequest=(w.encode=function(D,q){if(q=q||k.create(),Object.hasOwnProperty.call(D,"txid")&&q.uint32(8).uint64(D.txid),Object.hasOwnProperty.call(D,"appid")&&q.uint32(16).uint32(D.appid),Object.hasOwnProperty.call(D,"mode")&&q.uint32(34).string(D.mode),Object.hasOwnProperty.call(D,"id_name")&&q.uint32(42).string(D.id_name),Object.hasOwnProperty.call(D,"zegoconn_version")&&q.uint32(56).uint32(D.zegoconn_version),Object.hasOwnProperty.call(D,"sdk_type")&&q.uint32(64).int32(D.sdk_type),Object.hasOwnProperty.call(D,"zegoconn_run_env")&&q.uint32(72).int32(D.zegoconn_run_env),Object.hasOwnProperty.call(D,"mode_no")&&q.uint32(88).int32(D.mode_no),Object.hasOwnProperty.call(D,"geofencing_type")&&q.uint32(96).uint32(D.geofencing_type),D.geofencings&&D.geofencings.length)for(let L=0;L<D.geofencings.length;++L)q.uint32(104).uint32(D.geofencings[L]);return q},w),d.GetConfigResponseData=(M.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.GetConfigResponseData;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.txid=D.uint64();break;case 2:j.quic_hb_interval=D.uint32();break;case 3:j.quic_hb_timeout=D.uint32();break;case 4:j.logic_hb_interval=D.uint32();break;case 5:j.logic_hb_timeout=D.uint32();break;case 6:j.pc_establish_timeout=D.uint32();break;case 7:j.sdk_link_detect_interval=D.uint32();break;case 8:j.sdk_link_detect_duration=D.uint32();break;case 9:j.client_outer_ip=D.string();break;case 10:j.ntp_time=D.uint64();break;case 11:j.root_rsa_certs_ver=D.uint32();break;case 12:j.geofencing_id=D.uint32();break;default:D.skipType(7&G)}}return j.txid=+j.txid.toString(),j},M),d.GetConfigResponse=(R.decode=function(D,q){D instanceof p||(D=p.create(D));let L=q===void 0?D.len:D.pos+q,j=new f.proto_accesshub.GetConfigResponse;for(;D.pos<L;){var G=D.uint32();switch(G>>>3){case 1:j.code=D.int32();break;case 2:j.message=D.string();break;case 3:Object.assign(j,f.proto_accesshub.GetConfigResponseData.decode(D,D.uint32()));break;default:D.skipType(7&G)}}return j},R),d})(),f.proto_zim=(()=>{const d={};function o(){}function c(e){I(this,e)}function r(){this.server_timestamp=0}function t(e){this.forward_ip=[],I(this,e)}function n(e){I(this,e)}function s(){this.server_ips=[],this.redirect_server=[],this.server_timestamp=0}function u(e){I(this,e)}function a(){this.push_requests=[],this.send_time=0}function i(){}function l(e){this.push_responses=[],I(this,e)}function h(e){this.conv_sid="",this.client_msg_seq=0,I(this,e)}function m(e){I(this,e)}function g(e){I(this,e)}function y(e){I(this,e)}function w(e){this.at=[],I(this,e)}function M(){this.msg_id="",this.conv_msg_seq=0,this.msg_time=0}function R(){}function D(e){I(this,e)}function q(){this.msg_id="",this.msg_time=0}function L(){}function j(){this.msglist_seq=0}function G(){}function J(e){this.user_ids=[],I(this,e)}function K(){this.err_list=[],this.new_err_list=[],this.call_seq=0,this.call_list_seq=0,this.create_time=0}function ee(e){this.user_ids=[],I(this,e)}function A(e){this.err_list=[],this.new_err_list=[],this.call_seq=0,this.call_list_seq=0,this.call_user_session_id=0}function v(){this.user_state=0,this.accept_time=0,this.quit_time=0,this.residue_timeout_time=0}function E(){this.user_list=[],this.call_seq=0,this.now_time=0}function N(e){I(this,e)}function P(){this.calls=[],this.cur_list_seq=0,this.max_list_seq=0}function H(){}function V(){this.call_user_list=[],this.create_time=0,this.call_list_seq=0,this.call_status=0,this.now_time=0,this.destroy_time=0,this.accept_time=0,this.quit_time=0,this.invite_time=0}function W(e){this.user_ids=[],I(this,e)}function B(){this.err_list=[],this.call_seq=0,this.call_user_session_id=0}function $(e){I(this,e)}function X(){this.call_list_seq=0,this.talk_time=0,this.quit_time=0,this.call_seq=0,this.call_user_session_id=0}function ne(e){I(this,e)}function oe(e){this.user_state_list=[],this.call_seq=0,this.call_user_session_id=0,this.create_time=0,this.timeout=0}function ie(){this.user_state_list=[],this.call_seq=0,this.call_list_seq=0,this.create_time=0,this.call_user_session_id=0}function ue(){this.call_seq=0,this.call_list_seq=0,this.accept_time=0,this.call_user_session_id=0}function pe(){this.call_seq=0,this.call_list_seq=0,this.accept_time=0,this.call_user_session_id=0}function de(){this.user_ids=[],this.call_seq=0,this.call_list_seq=0,this.call_user_session_id=0}function _e(){this.user_state_list=[],this.create_time=0,this.call_seq=0,this.call_list_seq=0,this.call_user_session_id=0}function le(){this.call_seq=0,this.accept_time=0,this.quit_time=0,this.call_user_session_id=0}function be(){this.call_list_seq=0,this.talk_time=0,this.destroy_time=0,this.call_user_session_id=0}function ge(e){this.call_seq=0,this.call_user_session_id=0}function ve(e){this.user_state_list=[],this.timeout=0,this.call_seq=0,this.call_user_session_id=0}function Ge(){this.conv_type=0,this.conv_list_seq=0,this.conv_msg_seq=0,this.read_seq=0,this.send_count_after_read=0,this.last_del_msg_seq=0,this.statemsg_seq=0,this.receipt_max_conv_msg_seq=0,this.at_max_conv_msg_seq=0,this.at_all_max_conv_msg_seq=0,this.update_time=0,this.sub_read_count=0,this.last_revoke_msg_seq=0,this.last_msg_time=0}function we(e){I(this,e)}function qe(){this.conv_list=[],this.conv_list_seq=0,this.max_list_seq=0,this.max_del_conv_list_seq=0}function Ue(e){I(this,e)}function rt(){this.msgs=[],this.max_conv_msg_seq=0,this.next_conv_msg_seq=0}function nt(e){I(this,e)}function ut(){this.msgs=[],this.c2c_msg_seq=0,this.svr_c2c_msg_seq=0}function Ye(e){I(this,e)}function xe(){this.conv_list_seq=0,this.group_list_seq=0,this.c2c_msg_seq=0,this.c2c_statemsg_seq=0,this.extra_msg_list_seq=0,this.conv_pinned_list_seq=0,this.call_list_seq=0}function Re(){this.conv_list_seq=0,this.conv_msg_seq=0,this.conv_pinned_list_seq=0}function ye(e){I(this,e)}function Be(e){this.msg_ids=[],I(this,e)}function Pe(e){this.conv_msg_seq=[],I(this,e)}function ct(){this.conv_msg_seq2_receipt_seq={}}function Te(e){I(this,e)}function Ee(){this.read_members=[],this.unread_members=[]}function Le(e){I(this,e)}function Ce(){this.list=[],this.next_list_seq=0}function Me(){this.conv_type=0,this.conv_msg_seq=0,this.receipt_seq=0}function Ke(){this.read_count=0,this.unread_count=0}function mt(){this.del_conv_msg_seqs=[]}function ot(){this.PushItems=[]}function ze(){this.conv_type=0,this.conv_msg_seq=0,this.receipt_seq=0,this.read_count=0,this.unread_count=0}function Ne(e){I(this,e)}function Ae(){this.statemsg_list=[],this.next_statemsg_seq=0}function He(){this.conv_type=0,this.conv_msg_seq=0,this.statemsg_seq=0,this.reaction_seq=0}function _t(){this.reaction_briefs=[]}function vt(e){I(this,e)}function bt(){this.statemsg_seq=0,this.revoke_time=0}function Et(){this.revoke_time=0,this.revoke_type=0}function yt(){this.conv_type=0,this.statemsg_seq=0}function Mt(){this.headers={},this.forms={}}function It(e){I(this,e)}function kt(){}function wt(){}function st(){this.member_data_seq=0}function lt(){this.member_seq=0,this.group_list_seq=0}function Ct(e){this.user_ids=[],this.attributes=[],I(this,e)}function dt(){this.members=[],this.error_users=[],this.member_all_seq=0,this.group_list_seq=0,this.group_data_seq=0,this.group_attribute_seq=0}function pt(e){this.value="",this.seq=0,I(this,e)}function ht(e){this.attributes=[],I(this,e)}function gt(e){this.seq=0,this.attributes=[],I(this,e)}function St(){this.group_data_seq=0}function Xe(e){I(this,e)}function Dt(){this.fail_keys=[]}function qt(e){I(this,e)}function Rt(){this.member_all_seq=0,this.group_list_seq=0,this.group_data_seq=0,this.group_attribute_seq=0,this.conv_msg_seq=0}function Ot(e){this.user_ids=[],I(this,e)}function Qe(){this.members=[],this.error_users=[],this.member_all_seq=0,this.group_data_seq=0,this.group_attribute_seq=0}function it(){this.error_users=[],this.member_all_seq=0}function At(e){I(this,e)}function x(){this.event_type=0}function Z(){this.change_list=[],this.member_all_seq=0,this.cur_member_seq=0}function Y(){this.members=[]}function te(e){this.attributes=[],I(this,e)}function F(){}function se(e){I(this,e)}function re(){}function ae(){this.group_list_seq=0,this.group_data_seq=0,this.all_member_seq=0,this.attribute_seq=0,this.member_count=0}function me(){this.group_infos=[],this.fail_keys=[]}function ce(){this.groups=[],this.cur_list_seq=0,this.max_list_seq=0}function fe(e){I(this,e)}function Se(){}function Ie(){this.members=[],this.member_all_seq=0}function Fe(){}function Ve(){this.members=[],this.change_type=0,this.member_all_seq=0}function xt(){this.modify_type=0,this.group_data_seq=0}function Pt(){this.member_all_seq=0}function Tt(){this.conv_msg_seq=0}function ft(e){I(this,e)}function Ze(){this.send_count_after_read=0}function Je(e){I(this,e)}function Oe(){}function We(e){I(this,e)}function ke(){this.msg_id=""}function $e(e){I(this,e)}function at(){this.msgs=[],this.next_conv_msg_seq=0,this.max_conv_msg_seq=0}function Lt(e){I(this,e)}function Ht(e){I(this,e)}function Qt(){this.cur_reaction_seq=0,this.user_total_count=0}function Vt(e){I(this,e)}function Zt(){this.succ_list=[],this.error_list=[]}function Jt(e){I(this,e)}function Wt(e){I(this,e)}function Yt(){this.reaction_list=[],this.conv_msg_seq=0,this.msg_next_reaction_seq=0,this.msg_max_reaction_seq=0}function Xt(e){I(this,e)}function $t(){this.user_reaction=[],this.max_reaction_seq=0,this.total_user_count=0}function er(){this.conv_type=0,this.msg_reactions=[]}function tr(){this.reaction_infos=[],this.conv_msg_seq=0,this.start_reaction_seq=0,this.end_reaction_seq=0}function rr(){this.send_count_after_read=0,this.receipt_seq=0}function nr(e){I(this,e)}function or(){this.msgs=[],this.max_conv_msg_seq=0,this.next_conv_msg_seq=0,this.fetch_end=0}function sr(){this.conv_type=0,this.conv_pinned_list_seq=0}function ir(){this.conv_msg_seq=0,this.group_list_seq=0}function ar(){this.del_conv_msg_seqs=[],this.conv_type=0,this.max_del_conv_msg_seq=0}function ur(e){I(this,e)}function cr(){this.state_list=[],this.next_state_seq=0}function lr(){this.conv_type=0,this.conv_msg_seq=0,this.state_seq=0}function dr(){}function pr(){}function hr(){}function gr(){}function fr(){this.send_count_after_read=0}function mr(e){this.attributes=[],I(this,e)}function _r(){this.conv_msg_seq=0}function vr(e){this.attributes=[],I(this,e)}function br(){this.conv_msg_seq=0}function yr(e){this.user_ids=[],I(this,e)}function Mr(e){I(this,e)}function Ir(){this.users=[]}function jt(e){I(this,e)}function Gt(e){I(this,e)}function kr(){this.max_conv_msg_seq=0}function Ut(e){this.value="",I(this,e)}function wr(e){I(this,e)}function Bt(e){this.attributes=[],I(this,e)}function Cr(e){this.attributes=[],I(this,e)}function zt(e){I(this,e)}function Sr(){this.err_list=[]}function Dr(e){I(this,e)}function qr(e){I(this,e)}function Rr(){this.user_attributes=[],this.user_err_list=[]}function Or(e){this.user_ids=[],this.modify_attribute=[],I(this,e)}function Nt(e){this.attributes=[],this.err_list=[],I(this,e)}function Ar(e){this.req_attributes=[],I(this,e)}function xr(e){I(this,e)}function Pr(){this.user_attributes=[]}function Tr(){}function Er(){}function Lr(){this.attributes=[]}function jr(){this.push_attributes=[]}function Ft(e){this.quey_user_id=[],I(this,e)}function Gr(){this.result=[],this.err_list=[]}function Kt(e){I(this,e)}function Ur(){}function Br(){this.reaction_list=[],this.msg_max_reaction_seq=0}function zr(){this.user_reaction=[],this.max_reaction_seq=0,this.total_user_count=0}function Nr(e){this.user_state=0,this.user_session_id=0,this.extended_data="",this.accept_time=0,this.quit_time=0,this.residue_timeout_time=0}function Fr(e){I(this,e)}function Kr(){this.msgs=[],this.fail_list=[]}return d.CommonCodeMessage=(o.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CommonCodeMessage;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;default:e.skipType(7&U)}}return _},o),d.Header=(c.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"cmd")&&C.uint32(10).string(e.cmd),Object.hasOwnProperty.call(e,"seq")&&C.uint32(16).uint32(e.seq),Object.hasOwnProperty.call(e,"timestamp")&&C.uint32(24).int64(e.timestamp),Object.hasOwnProperty.call(e,"app_id")&&C.uint32(32).uint32(e.app_id),Object.hasOwnProperty.call(e,"user_id")&&C.uint32(42).string(e.user_id),Object.hasOwnProperty.call(e,"session_id")&&C.uint32(48).int64(e.session_id),Object.hasOwnProperty.call(e,"user_nid")&&C.uint32(56).int64(e.user_nid),Object.hasOwnProperty.call(e,"controls")&&C.uint32(66).bytes(e.controls),Object.hasOwnProperty.call(e,"product")&&C.uint32(72).int32(e.product),Object.hasOwnProperty.call(e,"flags")&&C.uint32(82).bytes(e.flags),Object.hasOwnProperty.call(e,"caller_type")&&C.uint32(88).int32(e.caller_type),C},c.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.Header;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.cmd=e.string();break;case 2:_.seq=e.uint32();break;case 3:_.timestamp=e.int64();break;case 4:_.app_id=e.uint32();break;case 5:_.user_id=e.string();break;case 6:_.session_id=e.int64();break;case 7:_.user_nid=e.int64();break;case 8:_.controls=e.bytes();break;case 9:_.product=e.int32();break;case 10:_.flags=e.bytes();break;case 11:_.caller_type=e.int32();break;default:e.skipType(7&U)}}return _},c),d.HbRsp=(r.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.HbRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.heartbeat_interval=e.uint32();break;case 4:_.hb_timeout=e.uint32();break;case 5:_.server_timestamp=e.int64();break;default:e.skipType(7&U)}}return _.server_timestamp=+_.server_timestamp.toString(),_},r),d.HandshakeReq=(t.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"term_type")&&C.uint32(8).int32(e.term_type),Object.hasOwnProperty.call(e,"net_type")&&C.uint32(16).int32(e.net_type),Object.hasOwnProperty.call(e,"sdk_ver")&&C.uint32(24).uint32(e.sdk_ver),e.forward_ip&&e.forward_ip.length)for(let z=0;z<e.forward_ip.length;++z)C.uint32(34).string(e.forward_ip[z]);return Object.hasOwnProperty.call(e,"device_id")&&C.uint32(42).string(e.device_id),Object.hasOwnProperty.call(e,"server_addr")&&C.uint32(50).string(e.server_addr),Object.hasOwnProperty.call(e,"channel_index")&&C.uint32(56).uint32(e.channel_index),C},t),d.LoginReq=(n.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"sdk_ver")&&C.uint32(8).uint32(e.sdk_ver),Object.hasOwnProperty.call(e,"user_name")&&C.uint32(18).bytes(e.user_name),Object.hasOwnProperty.call(e,"term_type")&&C.uint32(24).int32(e.term_type),Object.hasOwnProperty.call(e,"net_type")&&C.uint32(32).int32(e.net_type),Object.hasOwnProperty.call(e,"device_id")&&C.uint32(42).string(e.device_id),Object.hasOwnProperty.call(e,"server_ip")&&C.uint32(50).string(e.server_ip),Object.hasOwnProperty.call(e,"channel_index")&&C.uint32(56).uint32(e.channel_index),Object.hasOwnProperty.call(e,"client_stamp")&&C.uint32(66).bytes(e.client_stamp),Object.hasOwnProperty.call(e,"k1_sign")&&C.uint32(74).bytes(e.k1_sign),Object.hasOwnProperty.call(e,"login_token")&&C.uint32(82).bytes(e.login_token),Object.hasOwnProperty.call(e,"relogin_token")&&C.uint32(90).bytes(e.relogin_token),Object.hasOwnProperty.call(e,"zpns_push_id")&&C.uint32(98).string(e.zpns_push_id),Object.hasOwnProperty.call(e,"login_sign")&&C.uint32(106).bytes(e.login_sign),Object.hasOwnProperty.call(e,"old_session_id")&&C.uint32(120).int64(e.old_session_id),C},n),d.LoginRsp=(s.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.LoginRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.k2_sign=e.bytes();break;case 4:_.hb_interval=e.uint32();break;case 5:_.hb_timeout=e.uint32();break;case 6:_.server_timestamp=e.int64();break;case 7:_.redirect_server_ip=e.string();break;case 8:_.server_ips.push(e.string());break;case 9:_.login_server_ip=e.string();break;case 10:_.relogin_token=e.bytes();break;case 11:_.redirect_server.push(e.string());break;case 12:_.usermail_hb_interval=e.uint32();break;case 13:_.fetch_c2c_msg_list=e.int32();break;case 14:_.fetch_conv_list=e.int32();break;case 15:_.fetch_conv_msg_list=e.int32();break;case 16:_.fetch_group_list=e.int32();break;case 17:_.im_conf_json=e.string();break;default:e.skipType(7&U)}}return _.server_timestamp=+_.server_timestamp.toString(),_},s),d.LogoutReq=(u.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"logout_reason")&&C.uint32(8).uint32(e.logout_reason),Object.hasOwnProperty.call(e,"logout_check")&&C.uint32(18).bytes(e.logout_check),C},u),d.PushListRequest=(a.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushListRequest;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.push_requests.push(f.proto_zim.PushRequest.decode(e,e.uint32()));break;case 2:_.qos_flag=e.uint32();break;case 3:_.send_time=e.int64();break;default:e.skipType(7&U)}}return _.send_time=+_.send_time.toString(),_},a),d.PushRequest=(i.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushRequest;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.sub_cmd=e.string();break;case 2:_.msg_body=e.bytes();break;case 3:_.sender_user_id=e.string();break;case 4:_.msg_id=e.string();break;case 5:_.sender_user_nid=e.uint64();break;default:e.skipType(7&U)}}return _},i),d.PushListRsp=(l.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"code")&&C.uint32(8).uint32(e.code),Object.hasOwnProperty.call(e,"message")&&C.uint32(18).string(e.message),e.push_responses&&e.push_responses.length)for(let z=0;z<e.push_responses.length;++z)f.proto_zim.StGroupAttribute.encode(e.push_responses[z],C.uint32(26).fork()).ldelim();return Object.hasOwnProperty.call(e,"server_send_time")&&C.uint32(32).int64(e.server_send_time),C},l),d.StMsgClientInfo=(h.encode=function(e,C){return typeof e=="object"&&(e=new f.proto_zim.StMsgClientInfo(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"conv_sid")&&C.uint32(8).int64(e.conv_sid),Object.hasOwnProperty.call(e,"client_msg_seq")&&C.uint32(16).int64(e.client_msg_seq),C},h.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StMsgClientInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.conv_sid=e.int64();break;case 2:_.client_msg_seq=e.int64();break;default:e.skipType(7&U)}}return _.conv_sid=_.conv_sid.toString(),_.client_msg_seq=+_.client_msg_seq.toString(),_},h),d.StOfflinePushInfo=(m.encode=function(e,C){if(typeof e=="object"&&(e=new f.proto_zim.StOfflinePushInfo(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"enable_push")&&C.uint32(8).int32(e.enable_push),Object.hasOwnProperty.call(e,"title")&&C.uint32(18).string(e.title),Object.hasOwnProperty.call(e,"content")&&C.uint32(26).string(e.content),Object.hasOwnProperty.call(e,"payload")&&C.uint32(34).string(e.payload),Object.hasOwnProperty.call(e,"pushStrategyId")&&C.uint32(42).string(e.pushStrategyId),e.custom_map)for(let _=Object.keys(e.custom_map),U=0;U<_.length;++U){var z=e.custom_map[_[U]];z&&C.uint32(50).fork().uint32(10).string(_[U]).uint32(18).string(z).ldelim()}return C},m.decode=function(e,C){e instanceof p||(e=p.create(e));let z,_,U=C===void 0?e.len:e.pos+C,he=new f.proto_zim.StOfflinePushInfo;for(;e.pos<U;){var De=e.uint32();switch(De>>>3){case 1:he.enable_push=e.int32();break;case 2:he.title=e.string();break;case 3:he.content=e.string();break;case 4:he.payload=e.string();break;case 5:he.pushStrategyId=e.string();break;case 6:he.custom_map||(he.custom_map={});var et=e.uint32()+e.pos;for(z="",_="";e.pos<et;){var je=e.uint32();switch(je>>>3){case 1:z=e.string();break;case 2:_=e.string();break;default:e.skipType(7&je)}}he.custom_map[z]=_;break;case 7:he.priority=e.int32();break;default:e.skipType(7&De)}}},m),d.PictureMsgBody=(g.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"version")&&C.uint32(10).string(e.version),Object.hasOwnProperty.call(e,"file_type")&&C.uint32(16).int32(e.file_type),Object.hasOwnProperty.call(e,"file_uid")&&C.uint32(26).string(e.file_uid),Object.hasOwnProperty.call(e,"file_name")&&C.uint32(34).string(e.file_name),Object.hasOwnProperty.call(e,"file_size")&&C.uint32(42).string(e.file_size),Object.hasOwnProperty.call(e,"file_download_url")&&C.uint32(50).string(e.file_download_url),Object.hasOwnProperty.call(e,"large_image_download_url")&&C.uint32(58).string(e.large_image_download_url),Object.hasOwnProperty.call(e,"thumbnail_download_url")&&C.uint32(66).string(e.thumbnail_download_url),Object.hasOwnProperty.call(e,"large")&&C.uint32(74).string(e.large),Object.hasOwnProperty.call(e,"thumbnail")&&C.uint32(82).string(e.thumbnail),Object.hasOwnProperty.call(e,"origin_width")&&C.uint32(88).uint32(e.origin_width),Object.hasOwnProperty.call(e,"origin_height")&&C.uint32(96).uint32(e.origin_height),Object.hasOwnProperty.call(e,"big_width")&&C.uint32(104).uint32(e.big_width),Object.hasOwnProperty.call(e,"big_height")&&C.uint32(112).uint32(e.big_height),Object.hasOwnProperty.call(e,"small_width")&&C.uint32(120).uint32(e.small_width),Object.hasOwnProperty.call(e,"small_height")&&C.uint32(128).uint32(e.small_height),C},g.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PictureMsgBody;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.version=e.string();break;case 2:_.file_type=e.int32();break;case 3:_.file_uid=e.string();break;case 4:_.file_name=e.string();break;case 5:_.file_size=e.string();break;case 6:_.file_download_url=e.string();break;case 7:_.large_image_download_url=e.string();break;case 8:_.thumbnail_download_url=e.string();break;case 9:_.large=e.string();break;case 10:_.thumbnail=e.string();break;case 11:_.origin_width=e.uint32();break;case 12:_.origin_height=e.uint32();break;case 13:_.big_width=e.uint32();break;case 14:_.big_height=e.uint32();break;case 15:_.small_width=e.uint32();break;case 16:_.small_height=e.uint32();break;default:e.skipType(7&U)}}return _},g),d.VideoMsgBody=(y.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"version")&&C.uint32(10).string(e.version),Object.hasOwnProperty.call(e,"file_type")&&C.uint32(16).int32(e.file_type),Object.hasOwnProperty.call(e,"file_uid")&&C.uint32(26).string(e.file_uid),Object.hasOwnProperty.call(e,"file_name")&&C.uint32(34).string(e.file_name),Object.hasOwnProperty.call(e,"file_size")&&C.uint32(42).string(e.file_size),Object.hasOwnProperty.call(e,"file_download_url")&&C.uint32(50).string(e.file_download_url),Object.hasOwnProperty.call(e,"media_duration")&&C.uint32(58).string(e.media_duration),Object.hasOwnProperty.call(e,"video_first_frame_download_url")&&C.uint32(66).string(e.video_first_frame_download_url),Object.hasOwnProperty.call(e,"thumbnail")&&C.uint32(74).string(e.thumbnail),Object.hasOwnProperty.call(e,"frame_width")&&C.uint32(80).uint32(e.frame_width),Object.hasOwnProperty.call(e,"frame_height")&&C.uint32(88).uint32(e.frame_height),C},y.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.VideoMsgBody;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.version=e.string();break;case 2:_.file_type=e.int32();break;case 3:_.file_uid=e.string();break;case 4:_.file_name=e.string();break;case 5:_.file_size=e.string();break;case 6:_.file_download_url=e.string();break;case 7:_.media_duration=e.string();break;case 8:_.video_first_frame_download_url=e.string();break;case 9:_.thumbnail=e.string();break;case 10:_.frame_width=e.uint32();break;case 11:_.frame_height=e.uint32();break;default:e.skipType(7&U)}}return _},y),d.StConvMsgInfo=(w.encode=function(e,C){return typeof e=="object"&&(e=new f.proto_zim.StConvMsgInfo(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"msg_type")&&C.uint32(8).int32(e.msg_type),Object.hasOwnProperty.call(e,"msg")&&C.uint32(18).bytes(e.msg),Object.hasOwnProperty.call(e,"priority_type")&&C.uint32(24).int32(e.priority_type),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(34).string(e.conv_id),Object.hasOwnProperty.call(e,"msg_client_info")&&f.proto_zim.StMsgClientInfo.encode(e.msg_client_info,C.uint32(42).fork()).ldelim(),Object.hasOwnProperty.call(e,"payload")&&C.uint32(50).bytes(e.payload),e.offline_push&&Object.hasOwnProperty.call(e,"offline_push")&&f.proto_zim.StOfflinePushInfo.encode(e.offline_push,C.uint32(58).fork()).ldelim(),Object.hasOwnProperty.call(e,"has_receipt")&&C.uint32(80).int32(e.has_receipt),Object.hasOwnProperty.call(e,"sub_msg_type")&&C.uint32(104).int32(e.sub_msg_type),Object.hasOwnProperty.call(e,"searched_content")&&C.uint32(122).string(e.searched_content),C},w.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StConvMsgInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.msg_type=e.int32();break;case 2:_.msg=e.bytes();break;case 3:_.priority_type=e.int32();break;case 4:_.conv_id=e.string();break;case 5:_.msg_client_info=f.proto_zim.StMsgClientInfo.decode(e,e.uint32());break;case 6:_.payload=e.bytes();break;case 7:_.offline_push=f.proto_zim.StOfflinePushInfo.decode(e,e.uint32());break;case 8:_.pack_count=e.int32();break;case 9:_.pack_index=e.int32();break;case 10:_.has_receipt=e.int32();break;case 11:_.at.push(e.string());break;case 12:_.at_all=e.bool();break;case 13:_.sub_msg_type=e.int32();break;case 14:_.save=e.int32();break;case 15:_.searched_content=e.string();break;case 17:_.sender_unaware=e.int32();break;default:e.skipType(7&U)}}return _.msg_type==31&&(_.msg=f.proto_zim.StRevokeContent.decode(_.msg)),_},w),d.StMsgSvrInfo=(M.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StMsgSvrInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.msg_id=e.int64();break;case 2:_.conv_msg_seq=e.int64();break;case 3:_.c2c_msg_seq=e.int64();break;case 4:_.sender_user_id=e.string();break;case 5:_.sender_user_name=e.bytes();break;case 6:_.msg_time=e.int64();break;case 7:_.has_content=e.int32();break;case 9:_.msg_rsp=e.bytes();break;case 10:_.version=e.uint32();break;case 11:_.is_server=e.uint32();break;case 12:_.reactions=f.proto_zim.StReactions.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _.msg_id=_.msg_id.toString(),_.conv_msg_seq=+_.conv_msg_seq.toString(),_.msg_time=+_.msg_time.toString(),_},M),d.StRecvMsgInfo=(R.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StRecvMsgInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.msg_info=f.proto_zim.StConvMsgInfo.decode(e,e.uint32());break;case 2:_.msg_svr_info=f.proto_zim.StMsgSvrInfo.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _},R),d.StCommandMsgInfo=(D.encode=function(e,C){return typeof e=="object"&&(e=new f.proto_zim.StCommandMsgInfo(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"msg_type")&&C.uint32(8).int32(e.msg_type),Object.hasOwnProperty.call(e,"msg")&&C.uint32(18).bytes(e.msg),Object.hasOwnProperty.call(e,"priority_type")&&C.uint32(24).int32(e.priority_type),Object.hasOwnProperty.call(e,"payload")&&C.uint32(34).bytes(e.payload),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(42).string(e.conv_id),C},D.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StCommandMsgInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.msg_type=e.int32();break;case 2:_.msg=e.bytes();break;case 3:_.priority_type=e.int32();break;case 4:_.payload=e.bytes();break;case 5:_.conv_id=e.string();break;default:e.skipType(7&U)}}return _},D),d.StCommandSvrInfo=(q.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StCommandSvrInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.msg_id=e.int64();break;case 2:_.sender_user_id=e.string();break;case 3:_.sender_user_name=e.bytes();break;case 4:_.msg_time=e.int64();break;default:e.skipType(7&U)}}return _.msg_id=_.msg_id.toString(),_.msg_time=+_.msg_time.toString(),_},q),d.StRecvCommandInfo=(L.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StRecvCommandInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.command_msg_info=f.proto_zim.StCommandMsgInfo.decode(e,e.uint32());break;case 2:_.command_svr_info=f.proto_zim.StCommandSvrInfo.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _},L),d.FetchMsgInfo=(j.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.FetchMsgInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.msg_body=e.bytes();break;case 2:_.msg_dyn_info=f.proto_zim.MsgDynInfo.decode(e,e.uint32());break;case 3:_.msglist_seq=e.int64();break;default:e.skipType(7&U)}}const he=f.proto_zim.StRecvMsgInfo.decode(_.msg_body);return Object.assign(he.msg_info,_.msg_dyn_info),he.msg_svr_info.conv_msg_seq?he.msg_svr_info.c2c_msg_seq=_.msglist_seq:he.msg_svr_info.conv_msg_seq=+_.msglist_seq.toString(),he},j),d.MsgDynInfo=(G.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.MsgDynInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.msg_status=e.int32();break;case 2:_.has_receipt=e.bool()?1:0;break;default:e.skipType(7&U)}}return _},G),d.CallReq=(J.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"call_id")&&C.uint32(10).string(e.call_id),e.user_ids.length)for(let z=0;z<e.user_ids.length;++z)C.uint32(18).string(e.user_ids[z]);return Object.hasOwnProperty.call(e,"timeout")&&C.uint32(24).int32(e.timeout),Object.hasOwnProperty.call(e,"payload")&&C.uint32(34).bytes(e.payload),e.offline_info&&Object.hasOwnProperty.call(e,"offline_info")&&f.proto_zim.StOfflinePushInfo.encode(e.offline_info,C.uint32(42).fork()).ldelim(),Object.hasOwnProperty.call(e,"call_mode")&&C.uint32(48).int32(e.call_mode),C},J),d.CallRsp=(K.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CallRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.timeout=e.int32();break;case 4:_.call_id=e.string();break;case 5:_.err_list.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;case 6:_.call_seq=e.int64();break;case 7:_.call_list_seq=e.int64();break;case 8:_.create_time=e.int64();break;case 9:_.new_err_list.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},K),d.CallCancelReq=(ee.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"call_id")&&C.uint32(10).string(e.call_id),e.user_ids.length)for(let z=0;z<e.user_ids.length;++z)C.uint32(18).string(e.user_ids[z]);return Object.hasOwnProperty.call(e,"state")&&C.uint32(24).int32(e.state),Object.hasOwnProperty.call(e,"extended_data")&&C.uint32(34).bytes(e.extended_data),e.offline_info&&Object.hasOwnProperty.call(e,"offline_info")&&f.proto_zim.StOfflinePushInfo.encode(e.offline_info,C.uint32(42).fork()).ldelim(),C},ee),d.CallCancelRsp=(A.prototype.code=0,A.prototype.message="",A.prototype.err_list=S.emptyArray,A.prototype.call_seq=S.Long?S.Long.fromBits(0,0,!1):0,A.prototype.call_list_seq=S.Long?S.Long.fromBits(0,0,!1):0,A.prototype.new_err_list=S.emptyArray,A.prototype.call_user_session_id=S.Long?S.Long.fromBits(0,0,!1):0,A.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CallCancelRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.err_list&&_.err_list.length||(_.err_list=[]),_.err_list.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;case 4:_.call_seq=e.int64();break;case 5:_.call_list_seq=e.int64();break;case 6:_.new_err_list&&_.new_err_list.length||(_.new_err_list=[]),_.new_err_list.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;case 7:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},A),d.CallUserInfo=(v.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CallUserInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.user_id=e.string();break;case 2:_.user_state=e.uint32();break;case 3:_.extended_data=e.bytes();break;case 4:_.is_timeout=e.int64();break;case 5:_.accept_time=e.int64();break;case 6:_.quit_time=e.int64();break;case 7:_.residue_timeout_time=e.int64();break;case 8:_.user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},v),d.CallInfoRsp=(E.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CallInfoRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.user_list.push(f.proto_zim.CallUserInfo.decode(e,e.uint32()));break;case 4:_.call_seq=e.int64();break;case 5:_.now_time=e.int64();break;default:e.skipType(7&U)}}return _},E),d.CallListReq=(N.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"cur_list_seq")&&C.uint32(8).int64(e.cur_list_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(16).uint32(e.count),Object.hasOwnProperty.call(e,"degree")&&C.uint32(24).uint32(e.degree),C},N),d.CallListRsp=(P.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CallListRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.cur_list_seq=e.int64();break;case 4:_.max_list_seq=e.int64();break;case 5:_.calls.push(f.proto_zim.CallInfo.decode(e,e.uint32()));break;case 6:_.fetch_end=e.int32();break;default:e.skipType(7&U)}}return _},P),d.CallUserState=(H.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CallUserState;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.user_id=e.string();break;case 2:_.user_state=e.uint32();break;case 3:_.session_id=e.int64();break;default:e.skipType(7&U)}}return _},H),d.CallInfo=(V.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CallInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.call_id=e.string();break;case 2:_.caller=e.string();break;case 3:_.create_time=e.int64();break;case 4:_.call_list_seq=e.int64();break;case 5:_.call_status=e.int64();break;case 6:_.call_user_list.push(f.proto_zim.UserMailCallUserInfo.decode(e,e.uint32()));break;case 7:_.now_time=e.int64();break;case 8:_.call_mode=e.int32();break;case 9:_.payload=e.bytes();break;case 10:_.destroy_time=e.int64();break;case 11:_.accept_time=e.int64();break;case 12:_.quit_time=e.int64();break;case 13:_.user_timeout=e.int32();break;case 14:_.invite_time=e.int64();break;case 15:_.inviter=e.string();break;default:e.skipType(7&U)}}return _},V),d.CallInviteReq=(W.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"call_id")&&C.uint32(10).string(e.call_id),e.user_ids.length)for(let z=0;z<e.user_ids.length;++z)C.uint32(18).string(e.user_ids[z]);return e.offline_info&&Object.hasOwnProperty.call(e,"offline_info")&&f.proto_zim.StOfflinePushInfo.encode(e.offline_info,C.uint32(26).fork()).ldelim(),C},W),d.CallInviteRsp=(B.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CallInviteRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.call_id=e.string();break;case 4:_.call_seq=e.int64();break;case 5:_.err_list.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;case 6:_.timeout=e.int32();break;case 7:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},B),d.CallQuitReq=($.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"call_id")&&C.uint32(10).string(e.call_id),e.offline_info&&Object.hasOwnProperty.call(e,"offline_info")&&f.proto_zim.StOfflinePushInfo.encode(e.offline_info,C.uint32(18).fork()).ldelim(),Object.hasOwnProperty.call(e,"payload")&&C.uint32(26).bytes(e.payload),C},$),d.CallQuitRsp=(X.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CallQuitRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.call_list_seq=e.int64();break;case 4:_.talk_time=e.int64();break;case 5:_.quit_time=e.int64();break;case 6:_.call_seq=e.int64();break;case 7:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},X),d.CallEnterReq=(ne.encode=function(e,C){return C=C||k.create(),e.call_id!=null&&Object.hasOwnProperty.call(e,"call_id")&&C.uint32(10).string(e.call_id),e.payload!=null&&Object.hasOwnProperty.call(e,"payload")&&C.uint32(18).bytes(e.payload),C},ne),d.CallEnterRsp=(oe.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.CallEnterRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.call_seq=e.int64();break;case 4:_.timeout=e.int32();break;case 5:_.create_time=e.int64();break;case 6:_.call_list_seq=e.int64();break;case 7:_.caller=e.string();break;case 8:_.accept_time=e.int64();break;case 9:_.extended_data=e.bytes();break;case 10:_.user_state_list&&_.user_state_list.length||(_.user_state_list=[]),_.user_state_list.push(f.proto_zim.CallUserInfo.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},oe),d.PushCallInvited=(ie.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushCallInvited;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.call_id=e.string();break;case 2:_.timeout=e.int32();break;case 3:_.caller=e.string();break;case 4:_.payload=e.bytes();break;case 5:_.call_seq=e.int64();break;case 6:_.call_list_seq=e.int64();break;case 7:_.user_state_list.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;case 8:_.call_mode=e.int32();break;case 9:_.create_time=e.int64();break;case 10:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},ie),d.PushCallAccept=(ue.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushCallAccept;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.call_id=e.string();break;case 2:_.invitee=e.string();break;case 3:_.caller=e.string();break;case 4:_.extended_data=e.bytes();break;case 5:_.call_seq=e.int64();break;case 6:_.call_list_seq=e.int64();break;case 7:_.accept_time=e.int64();break;case 9:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},ue),d.PushCallRefuse=(pe.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushCallRefuse;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.call_id=e.string();break;case 2:_.invitee=e.string();break;case 3:_.caller=e.string();break;case 4:_.call_state=e.uint32();break;case 5:_.extended_data=e.bytes();break;case 6:_.call_seq=e.int64();break;case 7:_.call_list_seq=e.int64();break;case 9:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},pe),d.PushCallCancel=(de.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushCallCancel;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.call_id=e.string();break;case 2:_.caller=e.string();break;case 4:_.state=e.int32();break;case 5:_.extended_data=e.bytes();break;case 6:_.call_seq=e.int64();break;case 7:_.call_list_seq=e.int64();break;case 9:_.user_ids.push(e.string());break;case 10:_.operator=e.string();break;case 11:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},de),d.PushOnCallInvited=(_e.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushOnCallInvited;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.call_id=e.string();break;case 2:_.create_time=e.int64();break;case 3:_.timeout=e.int32();break;case 4:_.caller=e.string();break;case 5:_.invitee=e.string();break;case 6:_.call_seq=e.int64();break;case 7:_.call_list_seq=e.int64();break;case 8:_.payload=e.bytes();break;case 9:_.user_state_list.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;case 11:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},_e),d.PushCallQuit=(le.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushCallQuit;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.call_id=e.string();break;case 2:_.invitee=e.string();break;case 3:_.caller=e.string();break;case 4:_.call_seq=e.int64();break;case 5:_.payload=e.bytes();break;case 6:_.accept_time=e.int64();break;case 7:_.quit_time=e.int64();break;case 8:_.call_user_session_id=e.int64();break;case 9:_.call_list_seq=e.int64();break;default:e.skipType(7&U)}}return _},le),d.PushCallDestroy=(be.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushCallDestroy;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.call_id=e.string();break;case 2:_.caller=e.string();break;case 3:_.call_list_seq=e.int64();break;case 4:_.payload=e.bytes();break;case 5:_.talk_time=e.int64();break;case 6:_.destroy_time=e.int64();break;case 7:_.operator=e.string();break;case 8:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},be),d.PushCallAck=(ge.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushCallAck;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.call_id=e.string();break;case 2:_.caller=e.string();break;case 3:_.invitee=e.string();break;case 4:_.call_seq=e.int64();break;case 6:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},ge),d.PushCallEnter=(ve.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushCallEnter;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.call_id=e.string();break;case 2:_.caller=e.string();break;case 3:_.create_time=e.int64();break;case 4:_.enter_time=e.int64();break;case 5:_.call_list_seq=e.int64();break;case 6:_.call_payload=e.bytes();break;case 7:_.call_seq=e.int64();break;case 8:_.payload=e.bytes();break;case 9:_.user_id=e.string();break;case 10:_.user_state_list&&_.user_state_list.length||(_.user_state_list=[]),_.user_state_list.push(f.proto_zim.UserMailCallUserInfo.decode(e,e.uint32()));break;case 11:_.timeout=e.int32();break;case 12:_.call_user_session_id=e.int64();break;default:e.skipType(7&U)}}return _},ve),d.ConvInfo=(Ge.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.ConvInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.conv_id=e.string();break;case 2:_.conv_type=e.int32();break;case 3:_.conv_list_seq=e.int64();break;case 4:_.conv_msg_seq=e.int64();break;case 5:_.read_seq=e.int64();break;case 6:_.is_del=e.bool();break;case 7:_.last_msg=f.proto_zim.StRecvMsgInfo.decode(e,e.uint32());break;case 8:_.send_count_after_read=e.int64();break;case 9:_.last_msg_del=e.bool();break;case 10:_.last_del_msg_seq=e.int64();break;case 11:_.statemsg_seq=e.int64();break;case 12:_.receipt_max_conv_msg_seq=e.int64();break;case 13:_.at_max_conv_msg_seq=e.int64();break;case 14:_.at_all_max_conv_msg_seq=e.int64();break;case 15:_.update_time=e.int64();break;case 16:_.sub_read_count=e.int64();break;case 17:_.last_revoke_msg_seq=e.int64();break;case 18:_.last_msg_time=e.int64();break;default:e.skipType(7&U)}}return _.conv_msg_seq=+_.conv_msg_seq.toString(),_.read_seq=+_.read_seq.toString(),_.send_count_after_read=+_.send_count_after_read.toString(),_.statemsg_seq=+_.statemsg_seq.toString(),_.update_time=+_.update_time.toString(),_.sub_read_count=+_.sub_read_count.toString(),_.last_revoke_msg_seq=+_.last_revoke_msg_seq.toString(),_.last_msg_time=+_.last_msg_time.toString(),_},Ge),d.GetConvListReq=(we.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_list_seq")&&C.uint32(8).int64(e.conv_list_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(16).uint32(e.count),Object.hasOwnProperty.call(e,"full_pull")&&C.uint32(24).int32(e.full_pull),Object.hasOwnProperty.call(e,"degree")&&C.uint32(32).uint32(e.degree),C},we),d.GetConvListRsp=(qe.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GetConvListRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.conv_list.push(f.proto_zim.ConvInfo.decode(e,e.uint32()));break;case 4:_.conv_list_seq=e.int64();break;case 5:_.max_list_seq=e.int64();break;case 6:_.full_list=e.int32();break;case 7:_.fetch_end=e.int32();break;case 8:_.max_del_conv_list_seq=e.int64();break;default:e.skipType(7&U)}}return _},qe),d.FetchConvMsgReq=(Ue.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"conv_type")&&C.uint32(16).int32(e.conv_type),Object.hasOwnProperty.call(e,"conv_msg_seq")&&C.uint32(24).int64(e.conv_msg_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(32).int32(e.count),Object.hasOwnProperty.call(e,"mode")&&C.uint32(40).int32(e.mode),Object.hasOwnProperty.call(e,"login_fetch")&&C.uint32(48).int32(e.login_fetch),Object.hasOwnProperty.call(e,"how")&&C.uint32(56).int32(e.how),Object.hasOwnProperty.call(e,"degree")&&C.uint32(64).uint32(e.degree),C},Ue),d.FetchConvMsgRsp=(rt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.FetchConvMsgRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.max_conv_msg_seq=e.int64();break;case 4:_.next_conv_msg_seq=e.int64();break;case 5:_.msgs.push(f.proto_zim.FetchMsgInfo.decode(e,e.uint32()));break;case 6:_.fetch_end=e.int32();break;default:e.skipType(7&U)}}return _.max_conv_msg_seq=+_.max_conv_msg_seq.toString(),_.next_conv_msg_seq=+_.next_conv_msg_seq.toString(),_},rt),d.FetchC2CMsgReq=(nt.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"c2c_msg_seq")&&C.uint32(8).int64(e.c2c_msg_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(16).int32(e.count),Object.hasOwnProperty.call(e,"login_fetch")&&C.uint32(24).int32(e.login_fetch),Object.hasOwnProperty.call(e,"how")&&C.uint32(32).int32(e.how),Object.hasOwnProperty.call(e,"degree")&&C.uint32(40).uint32(e.degree),C},nt),d.FetchC2CMsgRsp=(ut.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.FetchC2CMsgRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.msgs.push(f.proto_zim.FetchMsgInfo.decode(e,e.uint32()));break;case 4:_.c2c_msg_seq=e.int64();break;case 5:_.svr_c2c_msg_seq=e.int64();break;case 6:_.fetch_end=e.int32();break;default:e.skipType(7&U)}}return _},ut),d.UpdateReadSeqReq=(Ye.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"conv_type")&&C.uint32(16).int32(e.conv_type),Object.hasOwnProperty.call(e,"read_seq")&&C.uint32(24).int64(e.read_seq),C},Ye),d.UserMailHbRsp=(xe.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.UserMailHbRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.conv_list_seq=e.int64();break;case 4:_.group_list_seq=e.int64();break;case 5:_.c2c_msg_seq=e.int64();break;case 7:_.seq_fallback_timeout=e.uint32();break;case 8:_.msg_to=e.uint32();break;case 9:_.msg_itvl=e.uint32();break;case 10:_.list_to=e.uint32();break;case 11:_.list_itvl=e.uint32();break;case 12:_.conv_to=e.uint32();break;case 13:_.conv_itvl=e.uint32();break;case 14:_.group_to=e.uint32();break;case 15:_.group_itvl=e.uint32();break;case 16:_.c2c_statemsg_seq=e.int64();break;case 17:_.extra_msg_list_seq=e.int64();break;case 18:_.conv_pinned_list_seq=e.int64();break;case 19:_.call_list_seq=e.int64();break;default:e.skipType(7&U)}}return _.conv_pinned_list_seq=+_.conv_pinned_list_seq.toString(),_},xe),d.ConvDelRsp=(Re.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.ConvDelRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.conv_list_seq=e.int64();break;case 4:_.conv_msg_seq=e.int64();break;case 5:_.conv_pinned_list_seq=e.int64();break;default:e.skipType(7&U)}}return _},Re),d.ConvModifyPinnedLvReq=(ye.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"conv_type")&&C.uint32(16).int32(e.conv_type),Object.hasOwnProperty.call(e,"pinned_type")&&C.uint32(24).int32(e.pinned_type),C},ye),d.ConvDelMsgByMsgIdReq=(Be.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"conv_type")&&C.uint32(16).int32(e.conv_type),e.msg_ids&&e.msg_ids.length){C.uint32(26).fork();for(let z=0;z<e.msg_ids.length;++z)C.int64(e.msg_ids[z]);C.ldelim()}return C},Be),d.C2CReadReceiptReq=(Pe.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),e.conv_msg_seq&&e.conv_msg_seq.length){C.uint32(18).fork();for(let z=0;z<e.conv_msg_seq.length;++z)C.int64(e.conv_msg_seq[z]);C.ldelim()}return C},Pe),d.C2CReadReceiptRsp=(ct.decode=function(e,C){e instanceof p||(e=p.create(e));let z,_,U=C===void 0?e.len:e.pos+C,he=new f.proto_zim.C2CReadReceiptRsp;for(;e.pos<U;){var De=e.uint32();switch(De>>>3){case 1:he.code=e.uint32();break;case 2:he.message=e.string();break;case 3:var et=e.uint32()+e.pos;for(z=0,_=0;e.pos<et;){var je=e.uint32();switch(je>>>3){case 1:z=e.int64();break;case 2:_=e.int64().toString();break;default:e.skipType(7&je)}}he.conv_msg_seq2_receipt_seq[z.toString()]=_;break;default:e.skipType(7&De)}}return he},ct),d.GetGroupReadReceiptDetailReq=(Te.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"group_id")&&C.uint32(10).string(e.group_id),Object.hasOwnProperty.call(e,"conv_msg_seq")&&C.uint32(16).int64(e.conv_msg_seq),Object.hasOwnProperty.call(e,"list_seq")&&C.uint32(24).uint32(e.list_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(32).uint32(e.count),Object.hasOwnProperty.call(e,"degree")&&C.uint32(40).uint32(e.degree),C},Te),d.GetGroupReadReceiptDetailRsp=(Ee.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GetGroupReadReceiptDetailRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:if((7&U)==2)for(var he=e.uint32()+e.pos;e.pos<he;)_.read_members.push(+e.int64().toString());else _.read_members.push(+e.int64().toString());break;case 4:if((7&U)==2)for(var De=e.uint32()+e.pos;e.pos<De;)_.unread_members.push(+e.int64().toString());else _.unread_members.push(+e.int64().toString());break;case 5:_.next_list_seq=e.uint32();break;case 6:_.read_count=e.sint32();break;case 7:_.unread_count=e.sint32();break;case 8:_.fetch_end=e.uint32();break;default:e.skipType(7&U)}}return _},Ee),d.GetExtraMsgListReq=(Le.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"list_seq")&&C.uint32(8).int64(e.list_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(16).sint32(e.count),Object.hasOwnProperty.call(e,"degree")&&C.uint32(24).uint32(e.degree),C},Le),d.GetExtraMsgListRsp=(Ce.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GetExtraMsgListRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.list.push(f.proto_zim.ExtraMsgContent.decode(e,e.uint32()));break;case 4:_.next_list_seq=e.int64();break;case 5:_.fetch_end=e.int32();break;default:e.skipType(7&U)}}return _.next_list_seq=+_.next_list_seq.toString(),_},Ce),d.ExtraMsgContent=(Me.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.ExtraMsgContent;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.conv_id=e.string();break;case 2:_.conv_type=e.int32();break;case 3:_.conv_msg_seq=e.int64();break;case 4:_.receipt_seq=e.int64();break;case 5:_.type=e.int32();break;case 6:Object.assign(_,f.proto_zim.StReceiptContent.decode(e,e.uint32()));break;case 7:case 8:Object.assign(_,f.proto_zim.StDeleteContent.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _.conv_msg_seq=+_.conv_msg_seq.toString(),_},Me),d.StReceiptContent=(Ke.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StReceiptContent;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.read_count=e.sint32();break;case 2:_.unread_count=e.sint32();break;case 3:_.is_conv_read=e.uint32();break;default:e.skipType(7&U)}}return _},Ke),d.StDeleteContent=(mt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StDeleteContent;for(;e.pos<z;){var U=e.uint32();if(U>>>3==1)if((7&U)==2)for(var he=e.uint32()+e.pos;e.pos<he;)_.del_conv_msg_seqs.push(+e.int64().toString());else _.del_conv_msg_seqs.push(+e.int64().toString());else e.skipType(7&U)}return _},mt),d.PushReadReceipt=(ot.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushReadReceipt;for(;e.pos<z;){var U=e.uint32();U>>>3==1?_.PushItems.push(f.proto_zim.PushReadReceipt.PushItem.decode(e,e.uint32())):e.skipType(7&U)}return _},ot.PushItem=(ze.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushReadReceipt.PushItem;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.conv_msg_seq=e.int64();break;case 2:_.conv_id=e.string();break;case 3:_.conv_type=e.int32();break;case 4:_.read_count=e.sint32();break;case 5:_.unread_count=e.sint32();break;case 6:_.receipt_seq=e.int64();break;case 7:_.is_conv_read=e.uint32();break;default:e.skipType(7&U)}}return _.conv_msg_seq=+_.conv_msg_seq.toString(),_},ze),ot),d.GetStatemsgListReq=(Ne.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"statemsg_seq")&&C.uint32(16).int64(e.statemsg_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(24).sint32(e.count),Object.hasOwnProperty.call(e,"degree")&&C.uint32(32).uint32(e.degree),Object.hasOwnProperty.call(e,"max_msg_seq")&&C.uint32(40).int64(e.max_msg_seq),Object.hasOwnProperty.call(e,"min_msg_seq")&&C.uint32(48).int64(e.min_msg_seq),C},Ne),d.GetStatemsgListRsp=(Ae.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GetStatemsgListRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.statemsg_list.push(f.proto_zim.StStatemsgContent.decode(e,e.uint32()));break;case 4:_.next_statemsg_seq=e.int64();break;case 5:_.fetch_end=e.int32();break;default:e.skipType(7&U)}}return _},Ae),d.StStatemsgContent=(He.decode=function(e,C){e instanceof p||(e=p.create(e));let z,_,U=C===void 0?e.len:e.pos+C,he=new f.proto_zim.StStatemsgContent;for(;e.pos<U;){var De=e.uint32();switch(De>>>3){case 1:he.conv_msg_seq=e.int64();break;case 2:he.msg_status=e.int32();break;case 3:he.statemsg_seq=e.int64();break;case 4:he.conv_id=e.string();break;case 5:he.conv_type=e.int32();break;case 6:Object.assign(he,f.proto_zim.StRevokeContent.decode(e.bytes()));break;case 7:he.reaction_seq=e.int64();break;case 8:var et=e.uint32()+e.pos;for(z=0,_=[];e.pos<et;){var je=e.uint32();switch(je>>>3){case 1:z=e.int32();break;case 2:_=e.bytes();break;default:e.skipType(7&je)}}z==1&&Object.assign(he,f.proto_zim.StStateMsgReactionBrief.decode(_));break;default:e.skipType(7&De)}}return he.conv_msg_seq=+he.conv_msg_seq.toString(),he.reaction_seq=+he.reaction_seq.toString(),he},He),d.StStateMsgReactionBrief=(_t.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StStateMsgReactionBrief;for(;e.pos<z;){var U=e.uint32();U>>>3==1?_.reaction_briefs.push(f.proto_zim.StReactionBrief.decode(e,e.uint32())):e.skipType(7&U)}return _},_t),d.RevokeMsgReq=(vt.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"conv_msg_seq")&&C.uint32(16).int64(e.conv_msg_seq),e.offline_push&&Object.hasOwnProperty.call(e,"offline_push")&&f.proto_zim.StOfflinePushInfo.encode(e.offline_push,C.uint32(26).fork()).ldelim(),Object.hasOwnProperty.call(e,"payload")&&C.uint32(34).bytes(e.payload),C},vt),d.RevokeMsgRsp=(bt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.RevokeMsgRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.statemsg_seq=e.int64();break;case 4:_.msg_status=e.int32();break;case 5:_.revoke_time=e.int64();break;default:e.skipType(7&U)}}return _.revoke_time=+_.revoke_time.toString(),_},bt),d.StRevokeContent=(Et.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StRevokeContent;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.user_id=e.string();break;case 2:_.revoke_time=e.int64();break;case 3:_.msg_type=e.int32();break;case 4:_.revoke_type=e.uint32();break;case 5:_.payload=e.bytes();break;case 6:_.msg_status=e.int32();break;default:e.skipType(7&U)}}return _.revoke_time=+_.revoke_time.toString(),_},Et),d.PushMsgRevoke=(yt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushMsgRevoke;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.recv_msg_info=f.proto_zim.StRecvMsgInfo.decode(e,e.uint32());break;case 2:_.msg_status=e.int32();break;case 3:_.statemsg_seq=e.int64();break;case 4:_.conv_type=e.int32();break;default:e.skipType(7&U)}}return _},yt),d.HttpRequest=(Mt.decode=function(e,C){e instanceof p||(e=p.create(e));let z,_,U=C===void 0?e.len:e.pos+C,he=new f.proto_zim.HttpRequest;for(;e.pos<U;){var De=e.uint32();switch(De>>>3){case 1:he.url=e.string();break;case 2:he.method=e.string();break;case 3:var et=e.uint32()+e.pos;for(z="",_="";e.pos<et;){var je=e.uint32();switch(je>>>3){case 1:z=e.string();break;case 2:_=e.string();break;default:e.skipType(7&je)}}he.headers[z]=_;break;case 4:var Qr=e.uint32()+e.pos;for(z="",_="";e.pos<Qr;){var Hr=e.uint32();switch(Hr>>>3){case 1:z=e.string();break;case 2:_=e.string();break;default:e.skipType(7&Hr)}}he.forms[z]=_;break;default:e.skipType(7&De)}}return he},Mt),d.FileUploadReq=(It.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"md5")&&C.uint32(10).string(e.md5),Object.hasOwnProperty.call(e,"file_type")&&C.uint32(16).int32(e.file_type),Object.hasOwnProperty.call(e,"name")&&C.uint32(26).string(e.name),Object.hasOwnProperty.call(e,"size")&&C.uint32(32).int64(e.size),Object.hasOwnProperty.call(e,"duration")&&C.uint32(40).int64(e.duration),C},It),d.FileUploadRsp=(kt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.FileUploadRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.state=e.uint32();break;case 4:_.upload_req=f.proto_zim.HttpRequest.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _},kt),d.FileProcessRsp=(wt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.FileProcessRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.state=e.uint32();break;case 4:_.download_url=e.string();break;default:e.skipType(7&U)}}return _},wt),d.StGroupMemberData=(st.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StGroupMemberData;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.member_data_seq=e.int64();break;case 2:_.user_name=e.string();break;case 3:_.group_nick_name=e.string();break;case 4:_.role=e.int32();break;case 5:_.mute=e.int32();break;case 6:_.not_notify=e.int32();break;case 7:_.not_recv_msg=e.int32();break;case 8:_.user_avatar=e.bytes();break;default:e.skipType(7&U)}}return _.member_data_seq=+_.member_data_seq.toString(),_},st),d.StGroupMember=(lt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StGroupMember;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.user_id=e.string();break;case 2:_.user_nid=e.int64();break;case 3:_.member_seq=e.int64();break;case 4:_.member_data=f.proto_zim.StGroupMemberData.decode(e,e.uint32());break;case 5:_.attributes=f.proto_zim.StGroupAttributes.decode(e,e.uint32());break;case 6:_.group_list_seq=e.int64();break;default:e.skipType(7&U)}}return _.member_seq=+_.member_seq.toString(),_},lt),d.GroupCreateReq=(Ct.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"group_id")&&C.uint32(10).string(e.group_id),Object.hasOwnProperty.call(e,"group_name")&&C.uint32(18).string(e.group_name),Object.hasOwnProperty.call(e,"group_notice")&&C.uint32(26).string(e.group_notice),e.user_ids&&e.user_ids.length)for(let z=0;z<e.user_ids.length;++z)C.uint32(34).string(e.user_ids[z]);if(e.attributes&&e.attributes.length)for(let z=0;z<e.attributes.length;++z)f.proto_zim.StGroupAttribute.encode(e.attributes[z],C.uint32(42).fork()).ldelim();return Object.hasOwnProperty.call(e,"group_avatar")&&C.uint32(50).bytes(e.group_avatar),C},Ct),d.GroupCreateRsp=(dt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupCreateRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.group_id=e.string();break;case 4:_.members.push(f.proto_zim.StGroupMember.decode(e,e.uint32()));break;case 5:_.member_all_seq=e.int64();break;case 6:_.error_users.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;case 7:_.group_list_seq=e.int64();break;case 8:_.group_data_seq=e.int64();break;case 9:_.group_attribute_seq=e.int64();break;case 10:_.member_count=e.uint32();break;default:e.skipType(7&U)}}return _.member_all_seq=+_.member_all_seq.toString(),_.group_data_seq=+_.group_data_seq.toString(),_.group_attribute_seq=+_.group_attribute_seq.toString(),_},dt),d.StGroupAttribute=(pt.encode=function(e,C){return typeof e=="object"&&(e=new f.proto_zim.StGroupAttribute(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"key")&&C.uint32(10).string(e.key),Object.hasOwnProperty.call(e,"value")&&C.uint32(18).string(e.value),Object.hasOwnProperty.call(e,"seq")&&C.uint32(24).int64(e.seq),C},pt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StGroupAttribute;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.key=e.string();break;case 2:_.value=e.string();break;case 3:_.seq=e.int64();break;default:e.skipType(7&U)}}return _.seq=+_.seq.toString(),_},pt),d.StModifyGroupAttribute=(ht.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"action")&&C.uint32(8).int32(e.action),e.attributes&&e.attributes.length)for(let z=0;z<e.attributes.length;++z)f.proto_zim.StGroupAttribute.encode(e.attributes[z],C.uint32(18).fork()).ldelim();return C},ht.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StModifyGroupAttribute;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.action=e.int32();break;case 2:_.attributes.push(f.proto_zim.StGroupAttribute.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},ht),d.StGroupAttributes=(gt.encode=function(e,C){if(typeof e=="object"&&(e=new f.proto_zim.StGroupAttributes(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"seq")&&C.uint32(8).int64(e.seq),e.attributes&&e.attributes.length)for(let z=0;z<e.attributes.length;++z)f.proto_zim.StGroupAttribute.encode(e.attributes[z],C.uint32(18).fork()).ldelim();return C},gt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StGroupAttributes;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.seq=e.int64();break;case 2:_.attributes.push(f.proto_zim.StGroupAttribute.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _.seq=+_.seq.toString(),_},gt),d.GroupDataRsp=(St.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupDataRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.group_name=e.string();break;case 4:_.group_notice=e.string();break;case 5:_.group_data_seq=e.int64();break;case 6:_.group_avatar=e.bytes();break;default:e.skipType(7&U)}}return _.group_data_seq=+_.group_data_seq.toString(),_},St),d.GroupModifyAttributeReq=(Xe.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"group_id")&&C.uint32(10).string(e.group_id),Object.hasOwnProperty.call(e,"attributes")&&f.proto_zim.StModifyGroupAttribute.encode(e.attributes,C.uint32(18).fork()).ldelim(),C},Xe),d.GroupModifyAttributeRsp=(Dt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupModifyAttributeRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.attributes=f.proto_zim.StGroupAttributes.decode(e,e.uint32());break;case 4:_.fail_keys.push(f.proto_zim.StGroupAttribute.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Dt),d.GroupGetAttributesReq=(qt.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"group_id")&&C.uint32(10).string(e.group_id),Object.hasOwnProperty.call(e,"attributes")&&f.proto_zim.StGroupAttributes.encode(e.attributes,C.uint32(18).fork()).ldelim(),C},qt),d.GroupEnterRsp=(Rt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupEnterRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.group_name=e.string();break;case 4:_.properties=f.proto_zim.StGroupAttributes.decode(e,e.uint32());break;case 5:_.member=f.proto_zim.StGroupMember.decode(e,e.uint32());break;case 6:_.member_all_seq=e.int64();break;case 7:_.group_list_seq=e.int64();break;case 8:_.group_data_seq=e.int64();break;case 9:_.group_attribute_seq=e.int64();break;case 10:_.conv_msg_seq=e.int64();break;case 11:_.member_count=e.uint32();break;case 12:_.group_avatar=e.bytes();break;default:e.skipType(7&U)}}return _.member_all_seq=+_.member_all_seq.toString(),_.group_data_seq=+_.group_data_seq.toString(),_.group_attribute_seq=+_.group_attribute_seq.toString(),_.conv_msg_seq=+_.conv_msg_seq.toString(),_},Rt),d.GroupInviteReq=(Ot.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"group_id")&&C.uint32(10).string(e.group_id),e.user_ids&&e.user_ids.length)for(let z=0;z<e.user_ids.length;++z)C.uint32(18).string(e.user_ids[z]);return C},Ot),d.GroupInviteRsp=(Qe.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupInviteRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.member_all_seq=e.int64();break;case 4:_.members.push(f.proto_zim.StGroupMember.decode(e,e.uint32()));break;case 5:_.error_users.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;case 6:_.group_data_seq=e.int64();break;case 7:_.group_attribute_seq=e.int64();break;case 8:_.member_count=e.uint32();break;default:e.skipType(7&U)}}return _.member_all_seq=+_.member_all_seq.toString(),_.group_data_seq=+_.group_data_seq.toString(),_.group_attribute_seq=+_.group_attribute_seq.toString(),_},Qe),d.GroupKickOutRsp=(it.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupKickOutRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.member_all_seq=e.int64();break;case 4:_.error_users.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;case 5:_.member_count=e.uint32();break;default:e.skipType(7&U)}}return _.member_all_seq=+_.member_all_seq.toString(),_},it),d.GroupGetMembersReq=(At.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"group_id")&&C.uint32(10).string(e.group_id),Object.hasOwnProperty.call(e,"cur_member_seq")&&C.uint32(16).int64(e.cur_member_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(24).uint32(e.count),Object.hasOwnProperty.call(e,"full_pull")&&C.uint32(32).int32(e.full_pull),Object.hasOwnProperty.call(e,"degree")&&C.uint32(40).uint32(e.degree),C},At),d.StGroupMemberChangeEvent=(x.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StGroupMemberChangeEvent;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.group_id=e.string();break;case 2:_.member=f.proto_zim.StGroupMember.decode(e,e.uint32());break;case 3:_.event_type=e.int32();break;default:e.skipType(7&U)}}return _},x),d.GroupGetMembersRsp=(Z.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupGetMembersRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.member_all_seq=e.int64();break;case 4:_.change_list.push(f.proto_zim.StGroupMemberChangeEvent.decode(e,e.uint32()));break;case 5:_.full_list=e.int32();break;case 6:_.cur_member_seq=e.int64();break;case 7:_.fetch_end=e.int32();break;case 8:_.member_count=e.uint32();break;default:e.skipType(7&U)}}return _.member_all_seq=+_.member_all_seq.toString(),_.cur_member_seq=+_.cur_member_seq.toString(),_},Z),d.GetGroupMembersByMemberSeqRsp=(Y.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GetGroupMembersByMemberSeqRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.members.push(f.proto_zim.StGroupMember.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Y),d.GroupMemberDataReq=(te.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"group_id")&&C.uint32(10).string(e.group_id),Object.hasOwnProperty.call(e,"user_id")&&C.uint32(18).string(e.user_id),e.attributes&&e.attributes.length)for(let z=0;z<e.attributes.length;++z)f.proto_zim.StGroupAttribute.encode(e.attributes[z],C.uint32(26).fork()).ldelim();return C},te),d.GroupMemberDataRsp=(F.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupMemberDataRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.member=f.proto_zim.StGroupMember.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _},F),d.GroupSetMemberRoleReq=(se.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"group_id")&&C.uint32(10).string(e.group_id),Object.hasOwnProperty.call(e,"user_id")&&C.uint32(18).string(e.user_id),Object.hasOwnProperty.call(e,"role")&&C.uint32(24).int32(e.role),C},se),d.GroupUpdate=(re.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupUpdate;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.type=e.int32();break;case 2:_.info=f.proto_zim.GroupInfo.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _},re),d.GroupInfo=(ae.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.group_id=e.string();break;case 2:_.group_name=e.string();break;case 3:_.group_list_seq=e.int64();break;case 4:_.group_data_seq=e.int64();break;case 5:_.all_member_seq=e.int64();break;case 6:_.attribute_seq=e.int64();break;case 7:_.not_notify=e.bool();break;case 8:_.member_count=e.uint32();break;case 9:_.group_avatar=e.bytes();break;default:e.skipType(7&U)}}return _.group_data_seq=+_.group_data_seq.toString(),_.all_member_seq=+_.all_member_seq.toString(),_.attribute_seq=+_.attribute_seq.toString(),_},ae),d.GroupInfosRsp=(me.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupInfosRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.group_infos.push(f.proto_zim.GroupUpdate.decode(e,e.uint32()));break;case 4:_.fail_keys.push(f.proto_zim.FailKey.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},me),d.GroupListRsp=(ce.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupListRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.cur_list_seq=e.int64();break;case 4:_.max_list_seq=e.int64();break;case 5:_.groups.push(f.proto_zim.GroupUpdate.decode(e,e.uint32()));break;case 6:_.full_list=e.int32();break;case 7:_.fetch_end=e.int32();break;default:e.skipType(7&U)}}return _},ce),d.GroupMuteReq=(fe.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"group_id")&&C.uint32(10).string(e.group_id),Object.hasOwnProperty.call(e,"enable")&&C.uint32(16).bool(e.enable),C},fe),d.GroupOperator=(Se.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupOperator;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.user_id=e.string();break;case 2:_.user_name=e.bytes();break;case 3:_.group_nick_name=e.string();break;case 4:_.role=e.int32();break;default:e.skipType(7&U)}}return _},Se),d.PushCreateGroup=(Ie.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushCreateGroup;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.group_id=e.string();break;case 2:_.group_name=e.string();break;case 3:_.members.push(f.proto_zim.StGroupMember.decode(e,e.uint32()));break;case 4:_.member_all_seq=e.int64();break;case 5:_.attributes=f.proto_zim.StGroupAttributes.decode(e,e.uint32());break;case 6:_.op_user=f.proto_zim.GroupOperator.decode(e,e.uint32());break;case 7:_.member_count=e.uint32();break;case 8:_.group_avatar=e.bytes();break;default:e.skipType(7&U)}}return _.member_all_seq=+_.member_all_seq.toString(),_},Ie),d.PushModifyGroupAttribute=(Fe.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushModifyGroupAttribute;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.group_id=e.string();break;case 2:_.attributes=f.proto_zim.StGroupAttributes.decode(e,e.uint32());break;case 3:_.op_user=f.proto_zim.GroupOperator.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _},Fe),d.PushGroupMemberChange=(Ve.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushGroupMemberChange;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.group_id=e.string();break;case 2:_.member_all_seq=e.int64();break;case 3:_.members.push(f.proto_zim.StGroupMember.decode(e,e.uint32()));break;case 4:_.change_type=e.int32();break;case 5:_.op_user=f.proto_zim.GroupOperator.decode(e,e.uint32());break;case 6:_.new_owner_id=e.string();break;case 7:_.member_count=e.uint32();break;default:e.skipType(7&U)}}return _.member_all_seq=+_.member_all_seq.toString(),_},Ve),d.PushModifyGroupData=(xt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushModifyGroupData;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.group_id=e.string();break;case 2:_.op_user=f.proto_zim.GroupOperator.decode(e,e.uint32());break;case 3:_.group_data_seq=e.int64();break;case 4:_.group_notice=e.string();break;case 5:_.group_name=e.string();break;case 7:_.group_avatar=e.bytes();break;case 6:_.modify_type=e.int32();break;default:e.skipType(7&U)}}return _.group_data_seq=+_.group_data_seq.toString(),_},xt),d.PushGroupOwnerTransfer=(Pt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushGroupOwnerTransfer;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.group_id=e.string();break;case 2:_.user_id=e.string();break;case 3:_.op_user=f.proto_zim.GroupOperator.decode(e,e.uint32());break;case 4:_.member_all_seq=e.int64();break;default:e.skipType(7&U)}}return _.member_all_seq=+_.member_all_seq.toString(),_},Pt),d.PushGroupInvite=(Tt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushGroupInvite;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.group_id=e.string();break;case 2:_.group_name=e.string();break;case 3:_.group_notice=e.string();break;case 4:_.op_user=f.proto_zim.GroupOperator.decode(e,e.uint32());break;case 5:_.conv_msg_seq=e.int64();break;case 6:_.member_count=e.uint32();break;case 7:_.group_avatar=e.bytes();break;default:e.skipType(7&U)}}return _.conv_msg_seq=+_.conv_msg_seq.toString(),_},Tt),d.C2CMsgReq=(ft.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"msg_info")&&f.proto_zim.StConvMsgInfo.encode(e.msg_info,C.uint32(18).fork()).ldelim(),Object.hasOwnProperty.call(e,"fetch_peer_user_info")&&C.uint32(24).int32(e.fetch_peer_user_info),C},ft),d.C2CMsgRsp=(Ze.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.C2CMsgRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.msg_svr_info=f.proto_zim.StMsgSvrInfo.decode(e,e.uint32());break;case 4:_.peer_user_name=e.bytes();break;case 5:_.send_count_after_read=e.int64();break;case 6:_.conv_disable=e.bool();break;case 7:_.peer_user_avatar=e.bytes();break;case 8:_.msg_status=e.int32();break;case 9:_.audit_info=e.string();break;default:e.skipType(7&U)}}return _.send_count_after_read=+_.send_count_after_read.toString(),_},Ze),d.C2CCommandReq=(Je.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"command_msg_info")&&f.proto_zim.StCommandMsgInfo.encode(e.command_msg_info,C.uint32(18).fork()).ldelim(),C},Je),d.C2CCommandReqRsp=(Oe.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.C2CCommandReqRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.command_svr_info=f.proto_zim.StCommandSvrInfo.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _},Oe),d.RoomMsgReq=(We.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"room_user_session_id")&&C.uint32(24).int64(e.room_user_session_id),Object.hasOwnProperty.call(e,"msg_info")&&f.proto_zim.StConvMsgInfo.encode(e.msg_info,C.uint32(34).fork()).ldelim(),Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},We),d.RoomMsgRsp=(ke.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.RoomMsgRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.msg_id=e.int64();break;case 4:_.msg_svr_info=f.proto_zim.StMsgSvrInfo.decode(e,e.uint32());break;case 5:_.audit_info=e.string();break;default:e.skipType(7&U)}}return _.msg_id=_.msg_id.toString(),_},ke),d.RoomMsglistReq=($e.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"room_user_session_id")&&C.uint32(24).int64(e.room_user_session_id),Object.hasOwnProperty.call(e,"conv_msg_seq")&&C.uint32(32).int64(e.conv_msg_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(40).int32(e.count),Object.hasOwnProperty.call(e,"sort_type")&&C.uint32(48).int32(e.sort_type),Object.hasOwnProperty.call(e,"how")&&C.uint32(64).int32(e.how),Object.hasOwnProperty.call(e,"degree")&&C.uint32(72).uint32(e.degree),Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},$e),d.RoomMsglistRsp=(at.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.RoomMsglistRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.next_conv_msg_seq=e.int64();break;case 4:_.max_conv_msg_seq=e.int64();break;case 6:_.msgs.push(f.proto_zim.FetchMsgInfo.decode(e,e.uint32()));break;case 7:_.fetch_end=e.int32();break;default:e.skipType(7&U)}}return _.next_conv_msg_seq=+_.next_conv_msg_seq.toString(),_.max_conv_msg_seq=+_.max_conv_msg_seq.toString(),_},at),d.StMsgInfo=(Lt.encode=function(e,C){return typeof e=="object"&&(e=new f.proto_zim.StMsgInfo(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"msg_type")&&C.uint32(8).int32(e.msg_type),Object.hasOwnProperty.call(e,"msg")&&C.uint32(18).bytes(e.msg),Object.hasOwnProperty.call(e,"priority_type")&&C.uint32(24).int32(e.priority_type),Object.hasOwnProperty.call(e,"msg_id")&&C.uint32(32).int64(e.msg_id),Object.hasOwnProperty.call(e,"sender_user_id")&&C.uint32(42).string(e.sender_user_id),Object.hasOwnProperty.call(e,"msg_time")&&C.uint32(48).int64(e.msg_time),Object.hasOwnProperty.call(e,"payload")&&C.uint32(58).bytes(e.payload),C},Lt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StMsgInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.msg_type=e.int32();break;case 2:_.msg=e.bytes();break;case 3:_.priority_type=e.int32();break;case 4:_.msg_id=e.int64();break;case 5:_.sender_user_id=e.string();break;case 6:_.msg_time=e.int64();break;case 7:_.payload=e.bytes();break;default:e.skipType(7&U)}}return _.msg_id=_.msg_id?_.msg_id.toString():"",_.msg_time=_.msg_time?+_.msg_time.toString():0,_},Lt),d.RoomCommandMsgReq=(Ht.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"room_user_session_id")&&C.uint32(24).int64(e.room_user_session_id),Object.hasOwnProperty.call(e,"command_msg_info")&&f.proto_zim.StMsgInfo.encode(e.command_msg_info,C.uint32(34).fork()).ldelim(),Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},Ht),d.StReaction=(Qt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StReaction;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.reaction_key=e.string();break;case 2:_.cur_reaction_seq=e.int64();break;case 3:_.user_total_count=e.int32();break;default:e.skipType(7&U)}}return _.cur_reaction_seq=+_.cur_reaction_seq.toString(),_},Qt),d.SetReactionReq=(Vt.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"conv_msg_seq")&&C.uint32(16).int64(e.conv_msg_seq),Object.hasOwnProperty.call(e,"reaction_into_map"))for(let z=Object.keys(e.reaction_into_map),_=0;_<z.length;++_)C.uint32(26).fork().uint32(10).string(z[_]),f.proto_zim.C2CReadReceiptReq.encode(e.reaction_into_map[z[_]],C.uint32(18).fork()).ldelim().ldelim();return Object.hasOwnProperty.call(e,"operate_type")&&C.uint32(32).int32(e.operate_type),C},Vt),d.SetReactionRsp=(Zt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.SetReactionRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.succ_list.push(f.proto_zim.StReaction.decode(e,e.uint32()));break;case 4:_.error_list.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Zt),d.DelReactionReq=(Jt.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"conv_msg_seq")&&C.uint32(16).int64(e.conv_msg_seq),e.reaction_key.length)for(let z=0;z<e.reaction_key.length;++z)C.uint32(26).string(e.reaction_key[z]);return C},Jt),d.ReactionListReq=(Wt.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"degree")&&C.uint32(16).uint32(e.degree),Object.hasOwnProperty.call(e,"conv_msg_seq")&&C.uint32(24).int64(e.conv_msg_seq),Object.hasOwnProperty.call(e,"start_reaction_seq")&&C.uint32(32).int64(e.start_reaction_seq),C},Wt),d.ReactionListRsp=(Yt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.ReactionListRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.fetch_end=e.uint32();break;case 4:_.conv_msg_seq=e.int64();break;case 5:_.msg_next_reaction_seq=e.int64();break;case 6:_.msg_max_reaction_seq=e.int64();break;case 7:_.reaction_list.push(f.proto_zim.StReactionBrief.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _.conv_msg_seq=+_.conv_msg_seq.toString(),_.msg_next_reaction_seq=+_.msg_next_reaction_seq.toString(),_.msg_max_reaction_seq=+_.msg_max_reaction_seq.toString(),_},Yt),d.ReactionInfoReq=(Xt.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"conv_msg_seq")&&C.uint32(16).int64(e.conv_msg_seq),Object.hasOwnProperty.call(e,"reaction_key")&&C.uint32(26).string(e.reaction_key),Object.hasOwnProperty.call(e,"max_reaction_seq")&&C.uint32(32).int64(e.max_reaction_seq),Object.hasOwnProperty.call(e,"is_detail")&&C.uint32(40).bool(e.is_detail),C},Xt),d.ReactionInfoRsp=($t.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.ReactionInfoRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.max_reaction_seq=e.int64();break;case 4:_.total_user_count=e.uint32();break;case 5:_.user_reaction.push(f.proto_zim.StGroupAttribute.decode(e,e.uint32()));break;case 6:_.include_self=e.bool();break;default:e.skipType(7&U)}}return _.max_reaction_seq=+_.max_reaction_seq.toString(),_.user_reaction=_.user_reaction.map(he=>({userID:he.key,seq:+he.seq.toString()})),_.user_reaction.sort((he,De)=>he.seq-De.seq),_},$t),d.PushMsgReaction=(er.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushMsgReaction;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.conv_id=e.string();break;case 2:_.conv_type=e.int32();break;case 3:_.msg_reactions.push(f.proto_zim.StPushMsgReaction.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},er),d.StPushMsgReaction=(tr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StPushMsgReaction;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.conv_msg_seq=e.int64();break;case 2:_.start_reaction_seq=e.int64();break;case 3:_.end_reaction_seq=e.int64();break;case 4:_.reaction_infos.push(f.proto_zim.StReactionBrief.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _.conv_msg_seq=+_.conv_msg_seq.toString(),_.start_reaction_seq=+_.start_reaction_seq.toString(),_.end_reaction_seq=+_.end_reaction_seq.toString(),_},tr),d.GroupMsgRsp=(rr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GroupMsgRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.msg_svr_info=f.proto_zim.StMsgSvrInfo.decode(e,e.uint32());break;case 4:_.send_count_after_read=e.int64();break;case 5:_.msg_status=e.int32();break;case 6:_.receipt_seq=e.int64();break;case 7:_.unread_count=e.sint32();break;case 8:_.audit_info=e.string();break;default:e.skipType(7&U)}}return _.send_count_after_read=+_.send_count_after_read.toString(),_},rr),d.FetchGroupMsgList=(nr.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"group_id")&&C.uint32(10).string(e.group_id),Object.hasOwnProperty.call(e,"conv_msg_seq")&&C.uint32(16).int64(e.conv_msg_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(24).int32(e.count),Object.hasOwnProperty.call(e,"sort_type")&&C.uint32(32).int32(e.sort_type),Object.hasOwnProperty.call(e,"max_conv_msg_seq")&&C.uint32(40).int64(e.max_conv_msg_seq),Object.hasOwnProperty.call(e,"how")&&C.uint32(48).int32(e.how),Object.hasOwnProperty.call(e,"degree")&&C.uint32(56).uint32(e.degree),C},nr),d.FetchGroupMsgListRsp=(or.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.FetchGroupMsgListRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.max_conv_msg_seq=e.int64();break;case 4:_.next_conv_msg_seq=e.int64();break;case 5:_.msgs.push(f.proto_zim.FetchMsgInfo.decode(e,e.uint32()));break;case 6:_.fetch_end=e.int64();break;default:e.skipType(7&U)}}return _.max_conv_msg_seq=+_.max_conv_msg_seq.toString(),_.next_conv_msg_seq=+_.next_conv_msg_seq.toString(),_},or),d.PushPinnedConvChange=(sr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushPinnedConvChange;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.conv_id=e.string();break;case 2:_.conv_type=e.int32();break;case 3:_.conv_pinned_list_seq=e.int64();break;case 4:_.pinned_type=e.int32();break;default:e.skipType(7&U)}}return _.conv_pinned_list_seq=+_.conv_pinned_list_seq.toString(),_},sr),d.PushEnterGroup=(ir.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushEnterGroup;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.group_id=e.string();break;case 2:_.group_name=e.string();break;case 3:_.group_notice=e.string();break;case 4:_.conv_msg_seq=e.int64();break;case 5:_.member_count=e.uint32();break;case 6:_.group_avatar=e.bytes();break;case 7:_.group_list_seq=e.int64();break;case 8:_.user_id=e.string();break;case 9:_.member=f.proto_zim.StGroupMember.decode(e,e.uint32());break;case 10:_.properties=f.proto_zim.StGroupAttributes.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _.conv_msg_seq=+_.conv_msg_seq.toString(),_},ir),d.PushDelConvMsg=(ar.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushDelConvMsg;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.conv_id=e.string();break;case 2:_.conv_type=e.int32();break;case 3:_.is_del_all=e.uint32();break;case 4:if((7&U)==2)for(var he=e.uint32()+e.pos;e.pos<he;)_.del_conv_msg_seqs.push(+e.int64().toString());else _.del_conv_msg_seqs.push(+e.int64().toString());break;case 5:_.max_del_conv_msg_seq=e.int64();break;default:e.skipType(7&U)}}return _.max_del_conv_msg_seq=+_.max_del_conv_msg_seq.toString(),_},ar),d.GetMsgStateListReq=(ur.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"conv_id")&&C.uint32(10).string(e.conv_id),Object.hasOwnProperty.call(e,"state_seq")&&C.uint32(16).int64(e.state_seq),Object.hasOwnProperty.call(e,"count")&&C.uint32(24).sint32(e.count),Object.hasOwnProperty.call(e,"degree")&&C.uint32(32).uint32(e.degree),Object.hasOwnProperty.call(e,"max_msg_seq")&&C.uint32(40).int64(e.max_msg_seq),Object.hasOwnProperty.call(e,"min_msg_seq")&&C.uint32(48).int64(e.min_msg_seq),C},ur),d.GetMsgStateListRsp=(cr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GetMsgStateListRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.state_list.push(f.proto_zim.StMsgStateContent.decode(e,e.uint32()));break;case 4:_.next_state_seq=e.int64();break;case 5:_.fetch_end=e.int32();break;default:e.skipType(7&U)}}return _},cr),d.StMsgStateContent=(lr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StMsgStateContent;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.conv_msg_seq=e.int64();break;case 3:_.state=e.int32();break;case 4:_.state_seq=e.int64();break;case 5:_.conv_id=e.string();break;case 6:_.conv_type=e.int32();break;default:e.skipType(7&U)}}return _},lr),d.PushC2CCommand=(dr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushC2CCommand;for(;e.pos<z;){var U=e.uint32();U>>>3==1?_.recv_command_info=f.proto_zim.StRecvCommandInfo.decode(e,e.uint32()):e.skipType(7&U)}return _},dr),d.PushRoomMsg=(pr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushRoomMsg;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.room_id=e.string();break;case 2:_.room_session_id=e.int64();break;case 3:_.recv_msg_info=f.proto_zim.StRecvMsgInfo.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _},pr),d.PushRoomCommand=(hr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushRoomCommand;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.room_id=e.string();break;case 2:_.room_session_id=e.int64();break;case 3:_.msg_info=f.proto_zim.StMsgInfo.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _},hr),d.PushGroupCommand=(gr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushGroupCommand;for(;e.pos<z;){var U=e.uint32();U>>>3==2?_.recv_command_info=f.proto_zim.StRecvCommandInfo.decode(e,e.uint32()):e.skipType(7&U)}return _},gr),d.PushGroupMsg=(fr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushGroupMsg;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.recv_msg_info=f.proto_zim.StRecvMsgInfo.decode(e,e.uint32());break;case 2:_.msg_status=e.int32();break;case 3:_.send_count_after_read=e.int64();break;default:e.skipType(7&U)}}return _.send_count_after_read=+_.send_count_after_read.toString(),_},fr),d.RoomCreateReq=(mr.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_name")&&C.uint32(18).bytes(e.room_name),e.attributes&&e.attributes.length)for(let z=0;z<e.attributes.length;++z)f.proto_zim.StRoomAttribute.encode(e.attributes[z],C.uint32(26).fork()).ldelim();return Object.hasOwnProperty.call(e,"destroy_delay")&&C.uint32(32).uint32(e.destroy_delay),C},mr),d.RoomCreateRsp=(_r.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.RoomCreateRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.room_session_id=e.int64();break;case 4:_.room_user_session_id=e.int64();break;case 5:_.room_info_interval=e.uint32();break;case 6:_.userlist_enable=e.uint32();break;case 7:_.userlist_merge_timeout=e.uint32();break;case 8:_.userlist_interval=e.uint32();break;case 9:_.attributes=f.proto_zim.StRoomAttributes.decode(e,e.uint32());break;case 10:_.attributes_pull_interval=e.uint32();break;case 11:_.attributes_merge_timeout=e.uint32();break;case 13:_.conv_msg_seq=e.int64();break;case 14:_.enabled_offline_msg=e.uint32();break;case 15:_.msg_merge_timeout=e.uint32();break;case 16:_.msg_pull_interval=e.uint32();break;case 17:_.destroy_delay=e.uint32();break;case 18:_.sub_room_id=e.string();break;default:e.skipType(7&U)}}return _.conv_msg_seq=+_.conv_msg_seq.toString(),_},_r),d.RoomEnterReq=(vr.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_user_session_id")&&C.uint32(16).int64(e.room_user_session_id),Object.hasOwnProperty.call(e,"room_name")&&C.uint32(26).bytes(e.room_name),e.attributes&&e.attributes.length)for(let z=0;z<e.attributes.length;++z)f.proto_zim.StRoomAttribute.encode(e.attributes[z],C.uint32(34).fork()).ldelim();return Object.hasOwnProperty.call(e,"destroy_delay")&&C.uint32(40).uint32(e.destroy_delay),Object.hasOwnProperty.call(e,"create_if_not_exist")&&C.uint32(48).bool(e.create_if_not_exist),C},vr),d.RoomEnterRsp=(br.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.RoomEnterRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.room_name=e.bytes();break;case 4:_.room_session_id=e.int64();break;case 5:_.room_user_session_id=e.int64();break;case 6:_.userlist_seq=e.uint32();break;case 7:_.user_count=e.uint32();break;case 8:_.room_info_interval=e.uint32();break;case 9:_.userlist_enable=e.uint32();break;case 10:_.userlist_merge_timeout=e.uint32();break;case 11:_.userlist_interval=e.uint32();break;case 12:_.attribute_seq=e.uint32();break;case 13:_.attributes_pull_interval=e.uint32();break;case 14:_.attributes_merge_timeout=e.uint32();break;case 15:_.sub_room_id=e.string();break;case 17:_.conv_msg_seq=e.int64();break;case 18:_.enabled_offline_msg=e.uint32();break;case 19:_.msg_merge_timeout=e.uint32();break;case 20:_.msg_pull_interval=e.uint32();break;case 21:_.destroy_delay=e.uint32();break;case 22:_.attributes=f.proto_zim.StRoomAttributes.decode(e,e.uint32());break;default:e.skipType(7&U)}}return _.conv_msg_seq=+_.conv_msg_seq.toString(),_},br),d.QueryRoomUserInfosReq=(yr.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"room_user_session_id")&&C.uint32(24).int64(e.room_user_session_id),e.user_ids&&e.user_ids.length)for(let z=0;z<e.user_ids.length;++z)C.uint32(34).string(e.user_ids[z]);return Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},yr),d.RoomUserlistReq=(Mr.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"pos_flag")&&C.uint32(26).string(e.pos_flag),Object.hasOwnProperty.call(e,"count")&&C.uint32(32).int32(e.count),Object.hasOwnProperty.call(e,"mode")&&C.uint32(40).int32(e.mode),Object.hasOwnProperty.call(e,"expect_seq")&&C.uint32(48).uint32(e.expect_seq),Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},Mr),d.RoomUserlistRsp=(Ir.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.RoomUserlistRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.pos_flag=e.string();break;case 4:_.userlist_seq=e.uint32();break;case 5:_.user_count=e.uint32();break;case 6:_.users.push(f.proto_zim.StUserInfo.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Ir),d.StUserInfo=(jt.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"user_id")&&C.uint32(10).string(e.user_id),Object.hasOwnProperty.call(e,"user_name")&&C.uint32(18).bytes(e.user_name),Object.hasOwnProperty.call(e,"online_state")&&C.uint32(24).int32(e.online_state),Object.hasOwnProperty.call(e,"extra")&&C.uint32(34).bytes(e.extra),Object.hasOwnProperty.call(e,"avatar")&&C.uint32(42).bytes(e.avatar),C},jt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StUserInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.user_id=e.string();break;case 2:_.user_name=e.bytes();break;case 3:_.online_state=e.int32();break;case 4:_.extra=e.bytes();break;case 5:_.avatar=e.bytes();break;default:e.skipType(7&U)}}return _},jt),d.ErrorUser=(Gt.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"user_id")&&C.uint32(10).string(e.user_id),Object.hasOwnProperty.call(e,"sub_code")&&C.uint32(16).uint32(e.sub_code),C},Gt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.ErrorUser;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.user_id=e.string();break;case 2:_.sub_code=e.uint32();break;default:e.skipType(7&U)}}return _},Gt),d.RoomInfoRsp=(kr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.RoomInfoRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.userlist_seq=e.uint32();break;case 4:_.user_count=e.uint32();break;case 5:_.room_info_interval=e.uint32();break;case 6:_.attribute_seq=e.uint32();break;case 7:_.max_conv_msg_seq=e.int64();break;case 9:_.ulist_to=e.uint32();break;case 10:_.ulist_itvl=e.uint32();break;default:e.skipType(7&U)}}return _.max_conv_msg_seq=+_.max_conv_msg_seq.toString(),_},kr),d.StRoomAttribute=(Ut.encode=function(e,C){return typeof e=="object"&&(e=new f.proto_zim.StRoomAttribute(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"key")&&C.uint32(10).string(e.key),Object.hasOwnProperty.call(e,"value")&&C.uint32(18).string(e.value),Object.hasOwnProperty.call(e,"seq")&&C.uint32(24).uint32(e.seq),Object.hasOwnProperty.call(e,"auto_delete")&&C.uint32(32).int32(e.auto_delete),C},Ut.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StRoomAttribute;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.key=e.string();break;case 2:_.value=e.string();break;case 3:_.seq=e.uint32();break;case 4:_.auto_delete=e.int32();break;default:e.skipType(7&U)}}return _},Ut),d.StModifyRoomAttribute=(wr.encode=function(e,C){return typeof e=="object"&&(e=new f.proto_zim.StModifyRoomAttribute(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"action")&&C.uint32(8).int32(e.action),Object.hasOwnProperty.call(e,"attribute")&&f.proto_zim.StRoomAttribute.encode(e.attribute,C.uint32(18).fork()).ldelim(),C},wr),d.StRoomAttributes=(Bt.encode=function(e,C){if(typeof e=="object"&&(e=new f.proto_zim.StRoomAttributes(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"attribute_seq")&&C.uint32(8).uint32(e.attribute_seq),e.attributes&&e.attributes.length)for(let z=0;z<e.attributes.length;++z)f.proto_zim.StRoomAttribute.encode(e.attributes[z],C.uint32(18).fork()).ldelim();return C},Bt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StRoomAttributes;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.attribute_seq=e.uint32();break;case 2:_.attributes.push(f.proto_zim.StRoomAttribute.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Bt),d.ModifyRoomAttributesReq=(Cr.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"force_modify")&&C.uint32(24).int32(e.force_modify),Object.hasOwnProperty.call(e,"set_member")&&C.uint32(32).int32(e.set_member),Object.hasOwnProperty.call(e,"attribute_seq")&&C.uint32(40).uint32(e.attribute_seq),Object.hasOwnProperty.call(e,"op_fail_fast")&&C.uint32(48).uint32(e.op_fail_fast),e.attributes&&e.attributes.length)for(let z=0;z<e.attributes.length;++z)f.proto_zim.StModifyRoomAttribute.encode(e.attributes[z],C.uint32(58).fork()).ldelim();return Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},Cr),d.ErrList=(zt.encode=function(e,C){return typeof e=="object"&&(e=new f.proto_zim.ErrList(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"code")&&C.uint32(8).uint32(e.code),Object.hasOwnProperty.call(e,"key")&&C.uint32(18).string(e.key),Object.hasOwnProperty.call(e,"seq")&&C.uint32(24).uint32(e.seq),C},zt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.ErrList;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.key=e.string();break;case 3:_.seq=e.uint32();break;default:e.skipType(7&U)}}return _},zt),d.ModifyRoomAttributesRsp=(Sr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.ModifyRoomAttributesRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.attributes=f.proto_zim.StRoomAttributes.decode(e,e.uint32());break;case 4:_.err_list.push(f.proto_zim.ErrList.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Sr),d.GetRoomAttributesReq=(Dr.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"attributes")&&f.proto_zim.StRoomAttributes.encode(e.attributes,C.uint32(26).fork()).ldelim(),Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},Dr),d.ModifyRoomUserAttributesReq=(qr.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"room_user_session_id")&&C.uint32(24).int64(e.room_user_session_id),Object.hasOwnProperty.call(e,"force_modify")&&C.uint32(32).int32(e.force_modify),Object.hasOwnProperty.call(e,"op_fail_fast")&&C.uint32(40).uint32(e.op_fail_fast),Object.hasOwnProperty.call(e,"attributes")&&f.proto_zim.StModifyRoomUserAttributes.encode(e.attributes,C.uint32(50).fork()).ldelim(),Object.hasOwnProperty.call(e,"auto_save")&&C.uint32(56).int32(e.auto_save),Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},qr),d.ModifyRoomUserAttributesRsp=(Rr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.ModifyRoomUserAttributesRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.user_attributes.push(f.proto_zim.StModifyRoomUserAttributeRsp.decode(e,e.uint32()));break;case 4:_.user_err_list.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Rr),d.StModifyRoomUserAttributes=(Or.encode=function(e,C){if(typeof e=="object"&&(e=new f.proto_zim.StModifyRoomUserAttributes(e)),C=C||k.create(),e.user_ids&&e.user_ids.length)for(let z=0;z<e.user_ids.length;++z)C.uint32(10).string(e.user_ids[z]);if(e.modify_attribute&&e.modify_attribute.length)for(let z=0;z<e.modify_attribute.length;++z)f.proto_zim.StModifyRoomAttribute.encode(e.modify_attribute[z],C.uint32(18).fork()).ldelim();return C},Or),d.StModifyRoomUserAttributeRsp=(Nt.encode=function(e,C){if(typeof e=="object"&&(e=new f.proto_zim.StModifyRoomUserAttributeRsp(e)),C=C||k.create(),Object.hasOwnProperty.call(e,"user_id")&&C.uint32(10).string(e.user_id),Object.hasOwnProperty.call(e,"user_attributes_seq")&&C.uint32(16).uint32(e.user_attributes_seq),e.attributes&&e.attributes.length)for(let z=0;z<e.attributes.length;++z)f.proto_zim.StRoomAttribute.encode(e.attributes[z],C.uint32(26).fork()).ldelim();if(e.err_list&&e.err_list.length)for(let z=0;z<e.err_list.length;++z)f.proto_zim.ErrList.encode(e.err_list[z],C.uint32(34).fork()).ldelim();return C},Nt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StModifyRoomUserAttributeRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.user_id=e.string();break;case 2:_.user_attributes_seq=e.uint32();break;case 3:_.attributes.push(f.proto_zim.StRoomAttribute.decode(e,e.uint32()));break;case 4:_.err_list.push(f.proto_zim.ErrList.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Nt),d.GetRoomUserAttributesReq=(Ar.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"room_user_session_id")&&C.uint32(24).int64(e.room_user_session_id),e.req_attributes.length)for(let z=0;z<e.req_attributes.length;++z)f.proto_zim.StModifyRoomUserAttributeRsp.encode(e.req_attributes[z],C.uint32(34).fork()).ldelim();return Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},Ar),d.GetRoomUserAttributeListReq=(xr.encode=function(e,C){return C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"room_user_session_id")&&C.uint32(24).int64(e.room_user_session_id),Object.hasOwnProperty.call(e,"pos_flag")&&C.uint32(34).string(e.pos_flag),Object.hasOwnProperty.call(e,"count")&&C.uint32(40).int32(e.count),Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},xr),d.GetRoomUserAttributeListRsp=(Pr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.GetRoomUserAttributeListRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.pos_flag=e.string();break;case 4:_.user_attributes_list_seq=e.uint32();break;case 5:_.user_count=e.uint32();break;case 6:_.user_attributes.push(f.proto_zim.StModifyRoomUserAttributeRsp.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Pr),d.PushRoomEnter=(Tr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushRoomEnter;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.room_id=e.string();break;case 2:_.room_session_id=e.int64();break;case 3:_.user_id=e.string();break;case 4:_.user_name=e.bytes();break;case 5:_.enter_time=e.int64();break;case 6:_.userlist_seq=e.uint32();break;case 7:_.user_count=e.uint32();break;case 8:_.sub_room_id=e.string();break;default:e.skipType(7&U)}}return _},Tr),d.PushRoomKickout=(Er.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushRoomKickout;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.room_id=e.string();break;case 2:_.reason=e.uint32();break;case 3:_.message=e.string();break;case 4:_.sub_room_id=e.string();break;default:e.skipType(7&U)}}return _},Er),d.PushRoomAttributesModify=(Lr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushRoomAttributesModify;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.attributes.push(f.proto_zim.StRoomAttribute.decode(e,e.uint32()));break;case 2:_.room_id=e.string();break;case 3:_.room_session_id=e.int64();break;case 4:_.user_id=e.string();break;case 5:_.attributes_seq=e.uint32();break;case 6:_.sub_room_id=e.string();break;case 7:_.old_attributes_seq=e.uint32();break;default:e.skipType(7&U)}}return _},Lr),d.PushRoomUserAttributesModify=(jr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.PushRoomUserAttributesModify;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.push_attributes.push(f.proto_zim.StModifyRoomUserAttributeRsp.decode(e,e.uint32()));break;case 2:_.room_id=e.string();break;case 3:_.room_session_id=e.int64();break;case 4:_.user_id=e.string();break;case 6:_.sub_room_id=e.string();break;default:e.skipType(7&U)}}return _},jr),d.UserInfo=(Ft.encode=function(e,C){if(C=C||k.create(),e.quey_user_id&&e.quey_user_id.length)for(let z=0;z<e.quey_user_id.length;++z)C.uint32(10).string(e.quey_user_id[z]);return C},Ft.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.UserInfo;for(;e.pos<z;){var U=e.uint32();U>>>3==1?_.quey_user_id.push(e.string()):e.skipType(7&U)}return _},Ft),d.UserInfoRsp=(Gr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.UserInfoRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.result.push(f.proto_zim.StUserInfo.decode(e,e.uint32()));break;case 4:_.err_list.push(f.proto_zim.ErrorUser.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Gr),d.ModifyUserInfoReq=(Kt.encode=function(e,C){return C=C||k.create(),!e.user_name||e.set_flag&&e.set_flag!=1||C.uint32(10).bytes(e.user_name),e.set_flag==10&&C.uint32(18).bytes(e.user_name),Object.hasOwnProperty.call(e,"set_flag")&&C.uint32(24).uint32(e.set_flag),e.set_flag==16&&C.uint32(34).bytes(e.user_name),C},Kt.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.ModifyUserInfoReq;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.userName=e.bytes();break;case 2:_.extendedData=e.bytes();break;case 3:_.set_flag=e.uint32();break;case 4:_.userAvatarUrl=e.bytes();break;default:e.skipType(7&U)}}return _},Kt),d.MsgStatusFail=(Ur.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.MsgStatusFail;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.client_info=f.proto_zim.StMsgClientInfo.decode(e,e.uint32());break;case 2:_.reason=e.uint32();break;default:e.skipType(7&U)}}return _},Ur),d.StReactions=(Br.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StReactions;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.is_detail=e.bool();break;case 2:_.reaction_list.push(f.proto_zim.StReactionBrief.decode(e,e.uint32()));break;case 3:_.msg_max_reaction_seq=e.int64();break;default:e.skipType(7&U)}}return _.msg_max_reaction_seq=+_.msg_max_reaction_seq.toString(),_},Br),d.StReactionBrief=(zr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.StReactionBrief;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.max_reaction_seq=e.int64();break;case 2:_.reaction_key=e.string();break;case 3:_.total_user_count=e.int32();break;case 4:_.include_self=e.bool();break;case 5:_.user_reaction.push(f.proto_zim.StGroupAttribute.decode(e,e.uint32()));break;case 6:_.is_multi=e.bool();break;default:e.skipType(7&U)}}return _.max_reaction_seq=+_.max_reaction_seq.toString(),_.user_reaction=_.user_reaction.map(he=>({userID:he.key,seq:+he.seq.toString()})),_.user_reaction.sort((he,De)=>he.seq-De.seq),_},zr),d.UserMailCallUserInfo=(Nr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.UserMailCallUserInfo;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.user_id=e.string();break;case 2:_.user_state=e.uint32();break;case 3:_.user_session_id=e.int64();break;case 4:_.extended_data=e.bytes();break;case 5:_.is_timeout=e.int64();break;case 6:_.accept_time=e.int64();break;case 7:_.quit_time=e.int64();break;case 8:_.residue_timeout_time=e.int64();break;default:e.skipType(7&U)}}return _},Nr),d.QueryRoomMsgReq=(Fr.encode=function(e,C){if(C=C||k.create(),Object.hasOwnProperty.call(e,"room_id")&&C.uint32(10).string(e.room_id),Object.hasOwnProperty.call(e,"room_session_id")&&C.uint32(16).int64(e.room_session_id),Object.hasOwnProperty.call(e,"room_user_session_id")&&C.uint32(24).int64(e.room_user_session_id),e.client_infos.length)for(let z=0;z<e.client_infos.length;++z)f.proto_zim.StMsgClientInfo.encode(e.client_infos[z],C.uint32(34).fork()).ldelim();return Object.hasOwnProperty.call(e,"sub_room_id")&&C.uint32(402).string(e.sub_room_id),C},Fr),d.QueryRoomMsgRsp=(Kr.decode=function(e,C){e instanceof p||(e=p.create(e));let z=C===void 0?e.len:e.pos+C,_=new f.proto_zim.QueryRoomMsgRsp;for(;e.pos<z;){var U=e.uint32();switch(U>>>3){case 1:_.code=e.uint32();break;case 2:_.message=e.string();break;case 3:_.msgs.push(f.proto_zim.FetchMsgInfo.decode(e,e.uint32()));break;case 4:_.fail_list.push(f.proto_zim.MsgStatusFail.decode(e,e.uint32()));break;default:e.skipType(7&U)}}return _},Kr),d})()},function(Q,O,b){b.d(O,"a",function(){return h});var T=b(6),I=b(2),p=b(63),k=b(64),S=b(65),f=b(68),d=b(74),o=b(76),c=b(77),r=b(1),t=b(0),n=(O=function(g,y,w,M){var R,D=arguments.length,q=D<3?y:M===null?M=Object.getOwnPropertyDescriptor(y,w):M;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")q=Reflect.decorate(g,y,w,M);else for(var L=g.length-1;0<=L;L--)(R=g[L])&&(q=(D<3?R(q):3<D?R(y,w,q):R(y,w))||q);return 3<D&&q&&Object.defineProperty(y,w,q),q},t.J.User),s=t.J.Conversation,u=t.J.Room,a=t.J.Group,i=t.J.Call,l=t.J.Database,h=(m.prototype.handleBizPushEvent=function(g,y,w){var M="";switch(g){case t.c.p_c2c_msg.cmd:case t.c.p_room_msg.cmd:case t.c.p_group_msg.cmd:M=this.convMgr.onPushMessage(y,g),this.addMsgPushEvent(g,w,M,y);break;case t.c.p_c2c_command.cmd:case t.c.p_room_command.cmd:case t.c.p_group_command.cmd:M=this.convMgr.onPushCommand(y,g),this.addMsgPushEvent(g,w,M,y);break;case t.c.p_msg_to_all_users.cmd:this.convMgr.onPushBroadcastMessage(y),this.addMsgPushEvent(g,w,"",y);break;case t.c.p_read_receipt.cmd:this.convMgr.onPushReadReceipt(y);break;case t.c.p_msg_revoke.cmd:this.convMgr.onPushMsgRevoke(y);break;case t.c.p_reaction.cmd:this.convMgr.onPushReaction(y);case t.c.p_room_enter.cmd:this.groupMgr.onPushRoomEnter(y);break;case t.c.p_room_quit.cmd:this.groupMgr.onPushRoomQuit(y);break;case t.c.p_room_kickout.cmd:this.groupMgr.onPushRoomKickout(y);break;case t.c.p_room_attrs.cmd:this.groupMgr.onPushRoomAttributesModify(y);break;case t.c.p_room_user_attrs.cmd:this.groupMgr.onPushRoomUserAttributesModify(y);break;case t.c.p_group_create.cmd:this.groupMgr.onPushGroupCreate(y);break;case t.c.p_group_invite.cmd:this.groupMgr.onPushGroupJoin(y,!1);break;case t.c.p_group_member_kickout.cmd:this.groupMgr.onPushGroupDestroy(y,t.A.KickedOut);break;case t.c.p_group_destroy.cmd:this.groupMgr.onPushGroupDestroy(y,t.A.Dismissed);break;case t.c.p_group_modify_data.cmd:this.groupMgr.onPushGroupDataModify(y);break;case t.c.p_group_modify_attributes.cmd:this.groupMgr.onPushGroupAttributesModify(y);break;case t.c.p_group_owner_transfer.cmd:this.groupMgr.onPushGroupOwnerTransfer(y);break;case t.c.p_group_member_change.cmd:this.groupMgr.onPushGroupMemberChange(y);break;case t.c.p_call_invite.cmd:this.callMgr.onPushCallInvited(y);break;case t.c.p_call_cancel.cmd:this.callMgr.onPushCallCancel(y);break;case t.c.p_call_accept.cmd:this.callMgr.onPushCallAccept(y);break;case t.c.p_call_refuse.cmd:this.callMgr.onPushCallReject(y);break;case t.c.p_call_inviting.cmd:this.callMgr.onPushCallingInvite(y);break;case t.c.p_call_quit.cmd:this.callMgr.onPushCallQuit(y);break;case t.c.p_call_destroy.cmd:this.callMgr.onPushCallEnd(y);break;case t.c.p_call_ack.cmd:this.callMgr.onPushCallAck(y);break;case t.c.p_call_enter.cmd:this.callMgr.onPushCallEnter(y);break;case t.c.p_detaillog_report.cmd:this.logger.upload("push",!0);break;case t.c.p_user_modify.cmd:this.userMgr.onPushUpdateUserInfo(y);break;case t.c.p_msg_delete.cmd:this.convMgr.onPushMsgDelete(y);break;case t.c.p_conv_delete.cmd:this.convMgr.onPushConvDelete(y);break;case t.c.p_conv_readseq.cmd:this.convMgr.onPushConvRead(y);break;case t.c.p_conv_pinned.cmd:this.convMgr.onPushConvPinned(y);break;case t.c.p_conv_mute.cmd:this.convMgr.onPushConvMute(y);break;case t.c.p_group_enter.cmd:this.groupMgr.onPushGroupJoin(y,!0);break;case t.c.p_group_quit.cmd:this.groupMgr.onPushGroupDestroy(y,t.A.Left);break;case t.c.p_del_all_conv.cmd:this.convMgr.onPushConvAllDelete(y);break;case t.c.p_clean_unread.cmd:this.convMgr.onPushCleanAllUnread(y)}},m.prototype.addMsgPushEvent=function(g,y,w,M){(y<-200||200<y)&&this.dataReport.reportPushEvent(g,y,w,M),0<y&&this.msgPushMap[g].times.push(y)},m.prototype.addMessagePushDelay=function(g,y,w){var M,R,D,q=y.length;q<1||(R=y[M=0],D=0,y.forEach(function(L){M+=L,L<R&&(R=L),D<L&&(D=L)}),y.length=0,w.flag=!0,w[g+"_count"]=q,w[g+"_ave_time_consumed"]=Math.floor(M/q),w[g+"_max_time_consumed"]=D,w[g+"_min_time_consumed"]=R)},m.prototype.createNotLoggedError=function(g,y){var w;if(!this.engineConfig.user.userID||!this.engineConfig.token)return w=Object(r.s)(t.s.NetworkModuleUserIsNotLogged),this.logger.warn(g,y,w),w},m.prototype.setContext=function(g){this.eventBus.setContext(g)},m.prototype.setZPNsContext=function(g){var y=g.pushSDKVersion.length,w=g.pushID.length,M=new Uint8Array(9+y+w);M[0]=175,M[1]=0,M[2]=1,M[3]=1,M[4]=7,M[5]=0,M[6]=y,M[7]=w>>8,M[8]=w-(M[7]<<8),M.set(Object(r.i)(g.pushSDKVersion),9),M.set(Object(r.i)(g.pushID),9+y),w=T.a.fromUint8Array(M),this.engineConfig.ZPNsPushID=w,this.userMgr&&this.userMgr.reportZPNs(),g.base64=w,this.logger.info(t.J.Manager,"reportZPNs",g)},m.prototype.destroy=function(){this.eventBus&&this.eventBus.off(),this.eventBus=null,this.connMgr.destroy(),this.connMgr=null,this.groupMgr.destroy(),this.groupMgr=null,this.convMgr.destroy(),this.convMgr=null,this.userMgr.destroy(),this.userMgr=null,this.callMgr.destroy(),this.callMgr=null,this.logger=null,this.engineConfig=null},m.prototype.uploadLog=function(){return this.logger.upload("apicall",!0)},m.prototype.on=function(g,y){typeof y=="function"&&(this.eventBus.on(g,y),this.logger.info(t.J.Manager,"API.on",g))},m.prototype.off=function(g){this.eventBus.off(g),this.logger.info(t.J.Manager,"API.off",g)},m.prototype.login=function(g,y){var w=this.paramValid.login(g);return w?Promise.reject(w):this.userMgr.login(g,y)},m.prototype.logout=function(){this.userMgr.logout()},m.prototype.renewToken=function(g){return this.userMgr.renewToken(g)},m.prototype.queryUsersInfo=function(g,y){var w=this.paramValid.queryUsersInfo(g);return w?Promise.reject(w):this.convMgr.queryUsersInfo(g,y)},m.prototype.updateUserName=function(g){var y=this.paramValid.validName("userName",g,n,t.I.UpdateUserName);return y?Promise.reject(y):this.userMgr.updateUserName(g)},m.prototype.updateUserAvatarUrl=function(g){var y=this.paramValid.validName("userAvatarUrl",g,n,t.I.UpdateUserAvatarUrl);return y?Promise.reject(y):this.userMgr.updateUserAvatarUrl(g)},m.prototype.updateUserExtendedData=function(g){var y=this.paramValid.validName("extendedData",g,n,t.I.UpdateUserExtendedData);return y?Promise.reject(y):this.userMgr.updateUserExtendedData(g)},m.prototype.queryConversation=function(g,y){var w=this.paramValid.validConvIDAndType(g,y,t.I.QueryConv);return w?Promise.reject(w):this.convMgr.query(g,y)},m.prototype.queryConversationList=function(g){var y=this.paramValid.queryConversationList(g,t.I.QueryConvList);return y?Promise.reject(y):this.convMgr.queryList(g)},m.prototype.queryConversationPinnedList=function(g){var y=this.paramValid.queryConversationList(g,t.I.QueryPinnedList);return y?Promise.reject(y):this.convMgr.queryPinnedList(g)},m.prototype.deleteConversation=function(g,y,w){var M=this.paramValid.validConvIDAndType(g,y,t.I.DeleteConv);return M?Promise.reject(M):this.convMgr.delete(g,y,w)},m.prototype.deleteAllConversations=function(g){return this.convMgr.deleteAll(g)},m.prototype.setConversationNotificationStatus=function(g,y,w){var M=this.paramValid.setNotificationStatus(g,y,w);return M?Promise.reject(M):this.convMgr.setNotificationStatus(g,y,w)},m.prototype.updateConversationPinnedState=function(g,y,w){var M=this.paramValid.updatePinnedState(g,y,w);return M?Promise.reject(M):this.convMgr.updatePinnedState(g,y,w)},m.prototype.clearConversationUnreadMessageCount=function(g,y){var w=this.paramValid.validConvIDAndType(g,y,t.I.ClearUnreadCount);return w?Promise.reject(w):this.convMgr.clearUnreadCount(g,y)},m.prototype.clearConversationTotalUnreadMessageCount=function(){return this.convMgr.clearAllUnreadCount()},m.prototype.sendMessage=function(g,y,w,M,R){var D,q=this.paramValid.sendMessage(g,y,w,M);return q?(D={status:t.P.Failed,message:g},this.eventBus.emit(t.t.MsgSentStatus,{infos:[D]}),Promise.reject(q)):this.convMgr.sendMessage(g,y,w,M,R)},m.prototype.sendMediaMessage=function(g,y,w,M,R){var D,q=g;return(g=this.paramValid.sendMediaMessage(g,y,w,M))?(D={status:t.P.Failed,message:q},this.eventBus.emit(t.t.MsgSentStatus,{infos:[D]}),Promise.reject(g)):this.convMgr.sendMediaMessage(q,y,w,M,R)},m.prototype.deleteMessages=function(g,y,w,M){M=Object.assign({isAlsoDeleteServerMessage:!0},M);var R=this.paramValid.deleteMessages(g,y,w,M);return R?Promise.reject(R):g.length||M.isAlsoDeleteServerMessage?this.convMgr.deleteMessages(g,y,w,M):Promise.resolve({conversationID:y,conversationType:w})},m.prototype.deleteAllMessage=function(g,y,w){var M=this.paramValid.validConvIDAndType(g,y,t.I.DeleteAllMessage);return M?Promise.reject(M):this.convMgr.deleteAllMessage(g,y,w)},m.prototype.queryHistoryMessage=function(g,y,w){var M=this.paramValid.queryHistoryMessage(g,y,w);return M?Promise.reject(M):w.count<1?Promise.resolve({conversationID:g,conversationType:y,messageList:[]}):this.convMgr.queryHistoryMessage(g,y,w)},m.prototype.insertMessageToLocalDB=function(g,y,w,M){var R=this.paramValid.insertMessageToLocalDB(g,y,w,M);return R?Promise.reject(R):this.convMgr.insertMessageToLocalDB(g,y,w,M)},m.prototype.updateMessageLocalExtendedData=function(g,y){var w=this.paramValid.updateMessageLocalExtendedData(g,y);return w?Promise.reject(w):this.convMgr.updateMessageLocalExtendedData(g,y)},m.prototype.revokeMessage=function(g,y){var w=this.paramValid.revokeMessage(g);return w?Promise.reject(w):this.convMgr.revokeMessage(g,y)},m.prototype.sendReceiptRead=function(g,y){var w=this.paramValid.sendReceiptRead(g,y);return w?Promise.reject(w):this.convMgr.sendReceiptRead(g,y)},m.prototype.sendMessageReceiptsRead=function(g,y,w){var M=this.paramValid.sendMessageReceiptsRead(g,y,w);return M?Promise.reject(M):this.convMgr.sendMessageReceiptsRead(g,y,w)},m.prototype.queryMessageReceiptsInfo=function(g,y,w){var M=this.paramValid.queryReceiptsInfo(g,y,w);return M?Promise.reject(M):this.convMgr.queryReceiptsInfo(g,y,w)},m.prototype.queryReceiptMemberList=function(g,y,w,M){var R=this.engineConfig.user.userID;return(R=this.paramValid.queryReceiptMemberList(g,y,w,M,R))?Promise.reject(R):w.count<1||g.direction==t.K.Receive?Promise.resolve({groupID:y,nextFlag:0,userList:[]}):this.groupMgr.queryReceiptMemberList(g,y,w,M)},m.prototype.addMessageReaction=function(g,y){var w=this.paramValid.messageReaction(g,y,!0);return w?Promise.reject(w):this.convMgr.addMessageReaction(g,y)},m.prototype.deleteMessageReaction=function(g,y){var w=this.paramValid.messageReaction(g,y);return w?Promise.reject(w):this.convMgr.deleteMessageReaction(g,y)},m.prototype.queryMessageReactionUserList=function(g,y){var w=this.paramValid.queryMessageReactionUserList(g,y);return w?Promise.reject(w):y.count<1?(w={totalCount:0,nextFlag:0,reactionType:y.reactionType,userList:[],message:g},Promise.resolve(w)):this.convMgr.queryMessageReactionUserList(g,y)},m.prototype.createRoom=function(g,y){var w=this.paramValid.createRoom(g,y);return w?Promise.reject(w):this.groupMgr.createRoom(g,y)},m.prototype.enterRoom=function(g,y){var w=this.paramValid.createRoom(g,y,!0);return w?Promise.reject(w):this.groupMgr.createRoom(g,y,!0)},m.prototype.joinRoom=function(g){var y=this.paramValid.validID("roomID",g,u,t.I.JoinRoom);return y?Promise.reject(y):this.groupMgr.joinRoom(g)},m.prototype.leaveRoom=function(g){var y=this.paramValid.validID("roomID",g,u,t.I.LeaveRoom);return y?Promise.reject(y):this.groupMgr.leaveRoom(g)},m.prototype.queryRoomMemberList=function(g,y){var w=this.paramValid.queryRoomMemberList(g,y);return w?Promise.reject(w):y.count<1?Promise.resolve({roomID:g,memberList:[],nextFlag:y.nextFlag||""}):this.groupMgr.queryRoomMemberList(g,y)},m.prototype.queryRoomMembers=function(g,y){var w=this.paramValid.queryRoomMembers(g,y);return w?Promise.reject(w):this.groupMgr.queryRoomMembers(g,y)},m.prototype.queryRoomOnlineMemberCount=function(g){var y=this.paramValid.validID("roomID",g,u,t.I.QueryRoomOnlineMemberCount);return y?Promise.reject(y):this.groupMgr.queryRoomOnlineMemberCount(g)},m.prototype.queryRoomAllAttributes=function(g){var y=this.paramValid.validID("roomID",g,u,t.I.QueryRoomAllAttributes);return y?Promise.reject(y):this.groupMgr.queryRoomAllAttributes(g)},m.prototype.setRoomAttributes=function(g,y,w){var M=this.paramValid.setRoomAttributes(g,y);return M?Promise.reject(M):this.groupMgr.setRoomAttributes(g,y,w)},m.prototype.deleteRoomAttributes=function(g,y,w){var M=this.paramValid.deleteRoomAttributes(g,y);return M?Promise.reject(M):this.groupMgr.deleteRoomAttributes(g,y,w)},m.prototype.beginRoomAttributesBatchOperation=function(g,y){this.groupMgr.beginRoomAttributesBatchOperation(g,y)},m.prototype.endRoomAttributesBatchOperation=function(g){var y=this.paramValid.validID("roomID",g,u,t.I.EndRoomAttributesBatchOperation);return y?Promise.reject(y):this.groupMgr.endRoomAttributesBatchOperation(g)},m.prototype.setRoomMembersAttributes=function(g,y,w,M){var R=this.paramValid.setRoomMembersAttributes(g,y,w);return R?Promise.reject(R):this.groupMgr.setRoomMembersAttributes(g,y,w,M)},m.prototype.queryRoomMembersAttributes=function(g,y){var w=this.paramValid.queryRoomMembersAttributes(g,y);return w?Promise.reject(w):this.groupMgr.queryRoomMembersAttributes(g,y)},m.prototype.queryRoomMemberAttributesList=function(g,y){var w=this.paramValid.validID("roomID",g,u,t.I.QueryRoomMemberAttributesList);return w?Promise.reject(w):this.groupMgr.queryRoomMemberAttributesList(g,y)},m.prototype.createGroup=function(g,y,w){g=Object.assign({},g),w=Object.assign({groupAttributes:{},groupNotice:""},w);var M=this.paramValid.createGroup(g,y,w);return M?Promise.reject(M):this.groupMgr.createGroup(g,y,w)},m.prototype.joinGroup=function(g){var y=this.paramValid.validID("groupID",g,a,t.I.JoinGroup);return y?Promise.reject(y):this.groupMgr.joinGroup(g)},m.prototype.leaveGroup=function(g){var y=this.paramValid.validID("groupID",g,a,t.I.LeaveGroup);return y?Promise.reject(y):this.groupMgr.leaveGroup(g)},m.prototype.dismissGroup=function(g){var y=this.paramValid.validID("groupID",g,a,t.I.DismissGroup);return y?Promise.reject(y):this.groupMgr.dismissGroup(g)},m.prototype.queryGroupList=function(){return this.groupMgr.queryGroupList()},m.prototype.updateGroupName=function(g,y){var w=this.paramValid.validIDAndName("groupID",y,"groupName",g,a,t.I.UpdateGroupName);return w?Promise.reject(w):this.groupMgr.updateGroupName(g,y)},m.prototype.updateGroupNotice=function(g,y){var w=this.paramValid.validIDAndName("groupID",y,"groupNotice",g,a,t.I.UpdateGroupNotice);return w?Promise.reject(w):this.groupMgr.updateGroupNotice(g,y)},m.prototype.updateGroupAvatarUrl=function(g,y){var w=this.paramValid.validIDAndName("groupID",y,"groupAvatarUrl",g,a,t.I.UpdateGroupAvatarUrl);return w?Promise.reject(w):this.groupMgr.updateGroupAvatarUrl(g,y)},m.prototype.queryGroupInfo=function(g){var y=this.paramValid.validID("groupID",g,a,t.I.QueryGroupInfo);return y?Promise.reject(y):this.groupMgr.queryGroupInfo(g)},m.prototype.setGroupAttributes=function(g,y){var w=this.paramValid.setGroupAttributes(g,y);return w?Promise.reject(w):this.groupMgr.setGroupAttributes(g,y)},m.prototype.deleteGroupAttributes=function(g,y){var w=this.paramValid.deleteGroupAttributes(g,y);return w?Promise.reject(w):this.groupMgr.deleteGroupAttributes(g,y)},m.prototype.queryGroupAttributes=function(g,y){var w=this.paramValid.queryGroupAttributes(g,y);return w?Promise.reject(w):this.groupMgr.queryGroupAttributes(g,y)},m.prototype.setGroupMemberNickname=function(g,y,w){var M=this.paramValid.setGroupMemberNickname(g,y,w);return M?Promise.reject(M):this.groupMgr.setGroupMemberNickname(g,y,w)},m.prototype.setGroupMemberRole=function(g,y,w){var M=this.paramValid.setGroupMemberRole(g,y,w);return M?Promise.reject(M):this.groupMgr.setGroupMemberRole(g,y,w)},m.prototype.transferGroupOwner=function(g,y){var w=this.paramValid.validTwoID("toUserID",g,"groupID",y,a,t.I.TransferGroupOwner);return w?Promise.reject(w):this.groupMgr.transferGroupOwner(g,y)},m.prototype.queryGroupMemberInfo=function(g,y){var w=this.paramValid.validTwoID("userID",g,"groupID",y,a,t.I.QueryGroupMemberInfo);return w?Promise.reject(w):this.groupMgr.queryGroupMemberInfo(g,y)},m.prototype.inviteUsersIntoGroup=function(g,y){var w=this.paramValid.validGroupUserIDs(g,y,t.I.InviteUsersIntoGroup);return w?Promise.reject(w):this.groupMgr.inviteUsersIntoGroup(g,y)},m.prototype.kickGroupMembers=function(g,y){var w=this.paramValid.validGroupUserIDs(g,y,t.I.KickGroupMembers);return w?Promise.reject(w):this.groupMgr.kickGroupMembers(g,y)},m.prototype.queryGroupMemberList=function(g,y){y=Object.assign({count:100,nextFlag:0},y);var w=this.paramValid.validID("groupID",g,a,t.I.QueryGroupMemberList);return w?Promise.reject(w):y.count<1?Promise.resolve({groupID:g,userList:[],nextFlag:y.nextFlag}):this.groupMgr.queryGroupMemberList(g,y)},m.prototype.queryGroupMemberCount=function(g){var y=this.paramValid.validID("groupID",g,a,t.I.QueryGroupMemberCount);return y?Promise.reject(y):this.groupMgr.queryGroupMemberCount(g)},m.prototype.callInvite=function(g,y){var w=this.paramValid.callInvite(g,y);return w?Promise.reject(w):this.callMgr.callInvite(g,y)},m.prototype.callCancel=function(g,y,w){var M=this.paramValid.callIDAndInvitees(g,y,t.I.CallCancel);return M?Promise.reject(M):this.callMgr.callCancel(g,y,w)},m.prototype.callAccept=function(g,y){var w=this.paramValid.validID("callID",g,i,t.I.CallAccept);return w?Promise.reject(w):this.callMgr.callAccept(g,y)},m.prototype.callReject=function(g,y){var w=this.paramValid.validID("callID",g,i,t.I.CallReject);return w?Promise.reject(w):this.callMgr.callReject(g,y)},m.prototype.callQuit=function(g,y){var w=this.paramValid.validID("callID",g,i,t.I.CallQuit);return w?Promise.reject(w):this.callMgr.callQuit(g,y)},m.prototype.callJoin=function(g,y){var w=this.paramValid.validID("callID",g,i,t.I.callJoin);return w?Promise.reject(w):this.callMgr.callJoin(g,y)},m.prototype.callEnd=function(g,y){var w=this.paramValid.validID("callID",g,i,t.I.CallEnd);return w?Promise.reject(w):this.callMgr.callEnd(g,y)},m.prototype.callingInvite=function(g,y,w){var M=this.paramValid.callIDAndInvitees(g,y,t.I.CallingInvite);return M?Promise.reject(M):this.callMgr.callingInvite(g,y,w)},m.prototype.queryCallInvitationList=function(g){return this.callMgr.queryList(g)},m.prototype.searchConversations=function(g){if(r.n)return Promise.resolve({conversationSearchInfoList:[]});var y=this.paramValid.searchConversations(g);return y?Promise.reject(y):this.dbMgr.searchConversations(g)},m.prototype.searchGlobalMessages=function(g){if(r.n)return Promise.resolve({messageList:[]});var y=this.paramValid.searchMessages(g,t.I.SearchGlobalMessages);return y?Promise.reject(y):this.dbMgr.searchGlobalMessages(g)},m.prototype.searchMessages=function(g,y,w){if(r.n)return Promise.resolve({conversationID:g,conversationType:y,messageList:[]});var M=this.paramValid.validConvIDAndType(g,y,t.I.SearchMessages)||this.paramValid.searchMessages(w,t.I.SearchMessages);return M?Promise.reject(M):this.dbMgr.searchMessages(g,y,w)},m.prototype.searchGroups=function(g){if(r.n)return Promise.resolve({nextFlag:0,groupSearchInfoList:[]});var y=this.paramValid.searchGroups(g);return y?Promise.reject(y):this.groupMgr.searchGroups(g)},m.prototype.searchGroupMembers=function(g,y){if(r.n)return Promise.resolve({nextFlag:0,groupID:g,userList:[]});var w=this.paramValid.searchGroupMembers(g,y);return w?Promise.reject(w):this.dbMgr.searchGroupMembers(g,y)},O([Object(r.p)(n,t.I.RenewToken)],m.prototype,"renewToken",null),O([Object(r.p)(n,t.I.QueryUsersInfo)],m.prototype,"queryUsersInfo",null),O([Object(r.p)(n,t.I.UpdateUserName)],m.prototype,"updateUserName",null),O([Object(r.p)(n,t.I.UpdateUserAvatarUrl)],m.prototype,"updateUserAvatarUrl",null),O([Object(r.p)(n,t.I.UpdateUserExtendedData)],m.prototype,"updateUserExtendedData",null),O([Object(r.p)(s,t.I.QueryConv)],m.prototype,"queryConversation",null),O([Object(r.p)(s,t.I.QueryConvList)],m.prototype,"queryConversationList",null),O([Object(r.p)(s,t.I.QueryPinnedList)],m.prototype,"queryConversationPinnedList",null),O([Object(r.p)(s,t.I.DeleteConv)],m.prototype,"deleteConversation",null),O([Object(r.p)(s,t.I.DeleteAllConv)],m.prototype,"deleteAllConversations",null),O([Object(r.p)(s,t.I.SetNotificationStatus)],m.prototype,"setConversationNotificationStatus",null),O([Object(r.p)(s,t.I.UpdatePinnedState)],m.prototype,"updateConversationPinnedState",null),O([Object(r.p)(s,t.I.ClearUnreadCount)],m.prototype,"clearConversationUnreadMessageCount",null),O([Object(r.p)(s,t.I.ClearAllUnreadCount)],m.prototype,"clearConversationTotalUnreadMessageCount",null),O([Object(r.p)(s,t.I.SendMessage)],m.prototype,"sendMessage",null),O([Object(r.p)(s,t.I.SendMediaMessage)],m.prototype,"sendMediaMessage",null),O([Object(r.p)(s,t.I.DeleteMessages)],m.prototype,"deleteMessages",null),O([Object(r.p)(s,t.I.DeleteAllMessage)],m.prototype,"deleteAllMessage",null),O([Object(r.p)(s,t.I.QueryHistoryMessage)],m.prototype,"queryHistoryMessage",null),O([Object(r.p)(s,t.I.InsertMessageToLocalDB)],m.prototype,"insertMessageToLocalDB",null),O([Object(r.p)(s,t.I.InsertMessageToLocalDB)],m.prototype,"updateMessageLocalExtendedData",null),O([Object(r.p)(s,t.I.RevokeMessage)],m.prototype,"revokeMessage",null),O([Object(r.p)(s,t.I.SendReceiptRead)],m.prototype,"sendReceiptRead",null),O([Object(r.p)(s,t.I.SendMessageReceiptsRead)],m.prototype,"sendMessageReceiptsRead",null),O([Object(r.p)(s,t.I.QueryReceiptsInfo)],m.prototype,"queryMessageReceiptsInfo",null),O([Object(r.p)(s,"API.queryReceiptMemberList")],m.prototype,"queryReceiptMemberList",null),O([Object(r.p)(s,t.I.AddReaction)],m.prototype,"addMessageReaction",null),O([Object(r.p)(s,t.I.DeleteReaction)],m.prototype,"deleteMessageReaction",null),O([Object(r.p)(s,t.I.QueryReaction)],m.prototype,"queryMessageReactionUserList",null),O([Object(r.p)(u,t.I.CreateRoom)],m.prototype,"createRoom",null),O([Object(r.p)(u,t.I.EnterRoom)],m.prototype,"enterRoom",null),O([Object(r.p)(u,t.I.JoinRoom)],m.prototype,"joinRoom",null),O([Object(r.p)(u,t.I.LeaveRoom)],m.prototype,"leaveRoom",null),O([Object(r.p)(u,t.I.QueryRoomMemberList)],m.prototype,"queryRoomMemberList",null),O([Object(r.p)(u,t.I.QueryRoomMemberList)],m.prototype,"queryRoomMembers",null),O([Object(r.p)(u,t.I.QueryRoomOnlineMemberCount)],m.prototype,"queryRoomOnlineMemberCount",null),O([Object(r.p)(u,t.I.QueryRoomAllAttributes)],m.prototype,"queryRoomAllAttributes",null),O([Object(r.p)(u,t.I.SetRoomAttributes)],m.prototype,"setRoomAttributes",null),O([Object(r.p)(u,t.I.DeleteRoomAttributes)],m.prototype,"deleteRoomAttributes",null),O([Object(r.p)(u,t.I.EndRoomAttributesBatchOperation)],m.prototype,"endRoomAttributesBatchOperation",null),O([Object(r.p)(u,t.I.SetRoomMembersAttributes)],m.prototype,"setRoomMembersAttributes",null),O([Object(r.p)(u,t.I.QueryRoomMembersAttributes)],m.prototype,"queryRoomMembersAttributes",null),O([Object(r.p)(u,t.I.QueryRoomMemberAttributesList)],m.prototype,"queryRoomMemberAttributesList",null),O([Object(r.p)(a,t.I.CreateGroup)],m.prototype,"createGroup",null),O([Object(r.p)(a,t.I.JoinGroup)],m.prototype,"joinGroup",null),O([Object(r.p)(a,t.I.LeaveGroup)],m.prototype,"leaveGroup",null),O([Object(r.p)(a,t.I.DismissGroup)],m.prototype,"dismissGroup",null),O([Object(r.p)(a,t.I.QueryGroupList)],m.prototype,"queryGroupList",null),O([Object(r.p)(a,t.I.UpdateGroupName)],m.prototype,"updateGroupName",null),O([Object(r.p)(a,t.I.UpdateGroupNotice)],m.prototype,"updateGroupNotice",null),O([Object(r.p)(a,t.I.UpdateGroupAvatarUrl)],m.prototype,"updateGroupAvatarUrl",null),O([Object(r.p)(a,t.I.QueryGroupInfo)],m.prototype,"queryGroupInfo",null),O([Object(r.p)(a,t.I.SetGroupAttributes)],m.prototype,"setGroupAttributes",null),O([Object(r.p)(a,t.I.DeleteGroupAttributes)],m.prototype,"deleteGroupAttributes",null),O([Object(r.p)(a,t.I.QueryGroupAttributes)],m.prototype,"queryGroupAttributes",null),O([Object(r.p)(a,t.I.SetGroupMemberNickname)],m.prototype,"setGroupMemberNickname",null),O([Object(r.p)(a,t.I.SetGroupMemberRole)],m.prototype,"setGroupMemberRole",null),O([Object(r.p)(a,t.I.TransferGroupOwner)],m.prototype,"transferGroupOwner",null),O([Object(r.p)(a,t.I.QueryGroupMemberInfo)],m.prototype,"queryGroupMemberInfo",null),O([Object(r.p)(a,t.I.InviteUsersIntoGroup)],m.prototype,"inviteUsersIntoGroup",null),O([Object(r.p)(a,t.I.KickGroupMembers)],m.prototype,"kickGroupMembers",null),O([Object(r.p)(a,t.I.QueryGroupMemberList)],m.prototype,"queryGroupMemberList",null),O([Object(r.p)(a,t.I.QueryGroupMemberCount)],m.prototype,"queryGroupMemberCount",null),O([Object(r.p)(i,t.I.CallInvite)],m.prototype,"callInvite",null),O([Object(r.p)(i,t.I.CallCancel)],m.prototype,"callCancel",null),O([Object(r.p)(i,t.I.CallAccept)],m.prototype,"callAccept",null),O([Object(r.p)(i,t.I.CallReject)],m.prototype,"callReject",null),O([Object(r.p)(i,t.I.CallQuit)],m.prototype,"callQuit",null),O([Object(r.p)(i,t.I.callJoin)],m.prototype,"callJoin",null),O([Object(r.p)(i,t.I.CallEnd)],m.prototype,"callEnd",null),O([Object(r.p)(i,t.I.CallingInvite)],m.prototype,"callingInvite",null),O([Object(r.p)(i,t.I.QueryCallList)],m.prototype,"queryCallInvitationList",null),O([Object(r.p)(l,t.I.SearchConvs)],m.prototype,"searchConversations",null),O([Object(r.p)(l,t.I.SearchGlobalMessages)],m.prototype,"searchGlobalMessages",null),O([Object(r.p)(l,t.I.SearchMessages)],m.prototype,"searchMessages",null),O([Object(r.p)(l,t.I.SearchGroups)],m.prototype,"searchGroups",null),O([Object(r.p)(l,t.I.SearchGroupMembers)],m.prototype,"searchGroupMembers",null),m);function m(g,y){var w=this,M=(this.repeatedPushMap={},this.pushTimer=0,this.msgPushMap=((M={})[t.c.p_c2c_msg.cmd]={name:"peer_msg",times:[]},M[t.c.p_room_msg.cmd]={name:"room_msg",times:[]},M[t.c.p_group_msg.cmd]={name:"group_msg",times:[]},M[t.c.p_c2c_command.cmd]={name:"peer_cmd",times:[]},M[t.c.p_room_command.cmd]={name:"room_cmd",times:[]},M[t.c.p_group_command.cmd]={name:"group_cmd",times:[]},M[t.c.p_msg_to_all_users.cmd]={name:"broadcast",times:[]},M),this.onConnectedEvent=function(R){w.userMgr.onConnected(R)},this.onDisConnectedEvent=function(R){w.userMgr.onDisConnected(R)},this.onPushEvent=function(R,D,q){var L;R===t.c.sw_push_list.cmd?(D.qos_flag==1&&(L={code:0,message:"",server_send_time:D.send_time,push_responses:D.push_requests.map(function(j){return{key:j.sub_cmd,value:j.msg_id}})},w.connMgr.sendRequestWithNoRsp(t.c.sw_push_list_rsp.cmd,L)),D.push_requests.forEach(function(j){w.handleBizPushEvent(j.sub_cmd,j.msg_body,q);var G=w.repeatedPushMap[j.sub_cmd+j.msg_id]||0;w.repeatedPushMap[j.sub_cmd+j.msg_id]=G+1})):R===t.c.Accesshub.cmd?w.userMgr.onPushAccesshub(D):(w.dataReport.reportNetworkRequest(R,D),R===t.c.sw_push_kickout.cmd?w.userMgr.onPushKickout(D):R===t.c.sw_push_redirect.cmd&&w.userMgr.onPushRedirect(D.quey_user_id))},this.onLogined=function(){w.pushTimer||(w.pushTimer=setInterval(w.reportPushEvent,6e4))},this.onLogout=function(){w.pushTimer&&clearInterval(w.pushTimer),w.pushTimer=0},this.reportPushEvent=function(){var R;w.dataReport&&(R={flag:!1},Object.values(w.msgPushMap).forEach(function(D){var q=D.name;return D=D.times,w.addMessagePushDelay(q,D,R)}),R.flag&&(delete R.flag,w.dataReport.reportSDKEvent("/sdk/msg/push_delay",R)),R={flag:!1},Object.keys(w.repeatedPushMap).forEach(function(D){1<w.repeatedPushMap[D]&&(R.flag=!0,R[D]=w.repeatedPushMap[D])}),(w.repeatedPushMap=R).flag&&w.dataReport.reportPushEvent("repeated",0,"",R))},this.eventBus=new k.a,this.engineConfig=I.a.getInstance().settings.initEngine(g,y,this.eventBus),this.logger=I.a.getInstance().logger,this.dataReport=I.a.getInstance().dataReport,this.paramValid=new p.a(this.logger),this.eventBus.add(t.t.ILogined,this.onLogined),this.eventBus.add(t.t.ILogout,this.onLogout),b(111)("./"+(r.n?"ZIMFileStoreImpl":"ZIMIDBImpl")).ZIMStoreImpl);this.dbMgr=new M(y),this.connMgr=new S.a(this.engineConfig,this.eventBus),this.connMgr.initEvent(this.onConnectedEvent,this.onDisConnectedEvent,this.onPushEvent),this.groupMgr=new d.a(this.engineConfig,this.eventBus,this.connMgr,this.dbMgr),this.userMgr=new o.a(this.engineConfig,this.eventBus,this.connMgr,this.dbMgr),this.callMgr=new c.a(this.engineConfig,this.eventBus,this.connMgr,this.dbMgr),this.convMgr=new f.a(this.engineConfig,this.eventBus,this.connMgr,this.dbMgr,this.groupMgr)}},function(Q,O,b){b.d(O,"a",function(){return o});var T=b(1),I=b(0),p=6000001,k=I.J.Conversation,S=I.J.Room,f=I.J.Group,d=I.J.Database,o=(c.prototype.validID=function(r,t,n,s){var u;if(!Object(T.l)(r))return u=Object(T.s)(p,r+" is invalid."),this.logger.warn(n,s,((n={error:u})[r]=t,n)),u},c.prototype.validName=function(r,t,n,s){var u;if(!this._isValidName(t))return u=Object(T.s)(p,r+" is invalid."),this.logger.warn(n,s,((n={error:u})[r]=t,n)),u},c.prototype.validTwoID=function(r,t,n,s,u,a){var i="";if(!Object(T.l)(t)&&(i=r+" is invalid.")||!Object(T.l)(s)&&(i=n+" is invalid."))return i=Object(T.s)(p,i),this.logger.warn(u,a,((u={error:i})[r]=t,u[n]=s,u)),i},c.prototype.validTwoName=function(r,t,n,s,u,a){var i="";if(!this._isValidName(t)&&(i=r+" is invalid.")||!this._isValidName(s)&&(i=n+" is invalid."))return i=Object(T.s)(p,i),this.logger.warn(u,a,((u={error:i})[r]=t,u[n]=s,u)),i},c.prototype.validIDAndName=function(r,t,n,s,u,a){var i="";if(!Object(T.l)(t)&&(i=r+" is invalid.")||!this._isValidName(s)&&(i=n+" is invalid."))return i=Object(T.s)(p,i),this.logger.warn(u,a,((u={error:i})[r]=t,u[n]=s,u)),i},c.prototype.login=function(r){var t="";if((r?!Object(T.l)(r.userID)&&(t="The userInfo instance of userID is invalid."):t="userInfo is invalid.")||!this._isValidName(r.userName)&&(t="The userInfo instance of userName is invalid."))return t=Object(T.s)(p,t),this.logger.warn(I.J.User,I.I.Login,{error:t,userInfo:r}),t},c.prototype.queryUsersInfo=function(r){var t;if(!Array.isArray(r)||!r.length)return t=Object(T.s)(p,"userIDs is invalid."),this.logger.warn(I.J.User,I.I.QueryUsersInfo,{error:t,userIDs:r}),t},c.prototype.validConvIDAndType=function(r,t,n){var s="";if(Object(T.l)(r)?t!==I.q.Peer&&t!==I.q.Group&&(s="conversationType is invalid."):s="conversationID is invalid.")return s=Object(T.s)(p,s),this.logger.warn(k,n,{error:s,conversationID:r,conversationType:t}),s},c.prototype.queryConversationList=function(r,t){var n="";if((!r||typeof r.count!="number"||r.count<0)&&(n="The config or config instance of count is invalid."))return n=Object(T.s)(p,n),this.logger.warn(k,t,{error:n,config:r}),n},c.prototype.setNotificationStatus=function(r,t,n){var s="";if((Object(T.l)(t)?n!==I.q.Group&&(s="conversationType is not support."):s="conversationID is invalid.")||r!==I.o.Notify&&r!==I.o.DoNotDisturb&&(s="status is invalid."))return s=Object(T.s)(p,s),this.logger.warn(k,I.I.SetNotificationStatus,{error:s,conversationID:t,conversationType:n,status:r}),s},c.prototype.updatePinnedState=function(r,t,n){var s=this.validConvIDAndType(t,n,I.I.UpdatePinnedState);return s||(typeof r!="boolean"?(s=Object(T.s)(p,"isPinned is invalid"),this.logger.warn(k,I.I.UpdatePinnedState,{error:s,conversationID:t,conversationType:n,isPinned:r}),s):void 0)},c.prototype.sendMessage=function(r,t,n,s){var u="";if((Object(T.l)(t)?!this._checkConvType(n)&&(u="conversationType is invalid."):u="toConversationID is invalid.")||!r&&(u="message is invalid.")||!s&&(u="config is invalid.")||!this._checkMesageType(r.type,n)&&(u="message type is invalid.")||!this._checkMesagePriority(s.priority)&&(u="config priority is invalid.")||!this._checkMesageContent(n,r.type,r.message)&&(u="The message instance of message is invalid.")||!this._checkMessageReceipt(n,r.type,s.hasReceipt)&&(u="The message type is not support setting receipt.")||!this._checkSubType(r)&&(u="The message subType is invalid"))return u=Object(T.s)(p,u),this.logger.warn(k,I.I.SendMessage,{error:u,toConversationID:t,conversationType:n,message:r,config:s}),u},c.prototype.sendMediaMessage=function(r,t,n,s){var u="";if((Object(T.l)(t)?!this._checkConvType(n)&&(u="conversationType is invalid."):u="toConversationID is invalid.")||!r&&(u="message is invalid.")||!s&&(u="config is invalid.")||!this._checkMediaMesageType(r.type)&&(u="message type is invalid.")||!this._checkMesagePriority(s.priority)&&(u="config priority is invalid.")||!this._checkMessageReceipt(n,r.type,s.hasReceipt)&&(u="The message type is not support setting receipt.")||!r.fileLocalPath&&!r.fileDownloadUrl&&(u="The message instance of fileLocalPath and fileDownloadUrl is empty."))return u=Object(T.s)(p,u),this.logger.warn(k,I.I.SendMediaMessage,{error:u,toConversationID:t,conversationType:n,message:r,config:s}),u},c.prototype.deleteMessages=function(r,t,n,s){return(t=this.validConvIDAndType(t,n,I.I.DeleteMessages))||(!Array.isArray(r)||!r.length&&s&&s.isAlsoDeleteServerMessage?(n=Object(T.s)(p,"messageList is invalid."),this.logger.warn(k,I.I.DeleteMessages,{error:n,messageList:r,config:s}),n):void 0)},c.prototype.queryHistoryMessage=function(r,t,n){var s="";if((Object(T.l)(r)?!this._checkConvType(t)&&(s="conversationType is invalid."):s="conversationID is invalid.")||(!n||typeof n.count!="number"||n.count<0)&&(s="The config or config instance of count is invalid."))return n=Object(T.s)(p,s),this.logger.warn(k,I.I.QueryHistoryMessage,{error:n,conversationID:r,conversationType:t}),n},c.prototype.insertMessageToLocalDB=function(r,t,n,s){if(u=this.validConvIDAndType(t,n,I.I.InsertMessageToLocalDB))return u;var u="";return(Object(T.l)(s)?!r&&(u="message is invalid."):u="senderUserID is invalid.")||!this._checkInsertMesageType(r.type)&&(u="message type is invalid.")||!this._checkInsertMesageContent(r)&&(u="The message instance of message is invalid.")?(u=Object(T.s)(p,u),this.logger.warn(k,I.I.InsertMessageToLocalDB,{error:u,conversationID:t,conversationType:n,senderUserID:s,message:r}),u):void 0},c.prototype.updateMessageLocalExtendedData=function(r,t){var n="";if(this._isValidName(r)?(!t||!t.conversationID||!t.messageID)&&(n="message is invalid."):n="localExtendedData is invalid.")return n=Object(T.s)(p,n),this.logger.warn(k,I.I.UpdateMessageLocalExtendedData,{error:n,localExtendedData:r,message:t}),n},c.prototype.revokeMessage=function(r){var t="";if((!r||r.isUserInserted||r.isBroadcastMessage||r.sentStatus!=I.P.Success?t="The message instance is not a successful message.":(r.type==I.R.Command||r.type==I.R.Revoke||r.type==I.R.Barrage)&&(t="The message type is not support."))||r.conversationType!==I.q.Peer&&r.conversationType!==I.q.Group&&(t="Only peer and group message can be revoked."))return t=Object(T.s)(p,t),this.logger.warn(k,I.I.RevokeMessage,{error:t,message:r}),t},c.prototype.sendReceiptRead=function(r,t){var n="";if(Object(T.l)(r)?t!==I.q.Peer&&(n="conversationType is invalid."):n="conversationID is invalid.")return n=Object(T.s)(p,n),this.logger.warn(k,I.I.SendReceiptRead,{error:n,conversationID:r,conversationType:t}),n},c.prototype.sendMessageReceiptsRead=function(r,t,n){if(s=this.validConvIDAndType(t,n,I.I.SendMessageReceiptsRead))return s;var s="";return Array.isArray(r)&&r.length!=0?r.some(function(u){return u.conversationID==t&&u.conversationType==n&&u.direction==I.K.Receive&&u.receiptStatus==I.M.Processing})||(s="Every one of message list is not a received receipt message in the conversationID."):s="messageList is invalid.",s?(s=Object(T.s)(p,s),this.logger.warn(k,I.I.SendMessageReceiptsRead,{error:s,conversationID:t,conversationType:n,messageList:r}),s):void 0},c.prototype.queryReceiptsInfo=function(r,t,n){if(s=this.validConvIDAndType(t,n,I.I.QueryReceiptsInfo))return s;var s="";return Array.isArray(r)&&r.length!=0?r.every(function(u){return!u.receiptStatus||u.conversationID!==t||u.conversationType!==n})&&(s="Every one of message list is not a receipt message in the conversationID."):s="messageList is invalid.",s?(s=Object(T.s)(p,s),this.logger.warn(k,I.I.QueryReceiptsInfo,{error:s,conversationID:t,conversationType:n,messageList:r}),s):void 0},c.prototype.queryReceiptMemberList=function(r,t,n,s,u){var a="";if((Object(T.l)(t)?(!n||typeof n.count!="number"||n.count<0)&&(a="config or the config instance of count is invalid."):a="groupID is invalid.")||(!r||r.senderUserID!=u||r.sentStatus!=I.P.Success||!r.receiptStatus)&&(a="The message instance is not a successful receipt message sent by self.")||(r.type==I.R.Command||r.type==I.R.Revoke)&&(a="The message type is not support.")||(r.conversationID!==t||r.conversationType!==I.q.Group)&&(a="The message instance is not belong the groupID."))return u=Object(T.s)(p,a),a=s?I.I.QueryReceiptReadMemberList:I.I.QueryReceiptUnreadMemberList,this.logger.warn(k,a,{error:u,groupID:t,message:r,config:n}),u},c.prototype.messageReaction=function(r,t,n){n=n?I.I.AddReaction:I.I.DeleteReaction;var s="";if((typeof r!="string"?s="reactionType is invalid":(!t||t.isUserInserted||t.isBroadcastMessage||t.sentStatus!=I.P.Success)&&(s="The message instance is not a successful message."))||(t.type==I.R.Command||t.type==I.R.Revoke||t.type==I.R.Barrage)&&(s="The message type is not support.")||t.conversationType!==I.q.Peer&&t.conversationType!==I.q.Group&&(s="Only peer and group message can have reaction."))return r=Object(T.s)(p,s),this.logger.warn(k,n,{error:r,message:t}),r},c.prototype.queryMessageReactionUserList=function(r,t){var n="";if((!t||typeof t.count!="number"||t.count<0||100<t.count?n="config or the config instance of count is invalid.":(!r||r.isUserInserted||r.isBroadcastMessage||r.sentStatus!=I.P.Success)&&(n="The message instance is not a successful message."))||(r.type==I.R.Command||r.type==I.R.Revoke||r.type==I.R.Barrage)&&(n="The message type is not support.")||r.conversationType!==I.q.Peer&&r.conversationType!==I.q.Group&&(n="Only peer and group message can have reaction."))return n=Object(T.s)(p,n),this.logger.warn(k,I.I.QueryReaction,{error:n,message:r,config:t}),n},c.prototype.createRoom=function(r,t,n){var s="";if((r?!Object(T.l)(r.roomID)&&(s="The roomInfo instance of roomID is invalid."):s="roomInfo is invalid.")||!this._isValidName(r.roomName)&&(s="The roomInfo instance of roomName is invalid.")||t&&t.roomAttributes&&!this._isValidAttribute(t.roomAttributes,!0)&&(s="The Key and Value of the roomAttributes property of the config instance only support string types."))return s=Object(T.s)(p,s),n=n?I.I.EnterRoom:I.I.CreateRoom,this.logger.warn(S,n,{error:s,roomInfo:r,config:t}),s},c.prototype.queryRoomMemberList=function(r,t){var n="";if(Object(T.l)(r)?(!t||typeof t.count!="number"||t.count<0)&&(n="config or the config instance of count is invalid."):n="roomID is invalid.")return n=Object(T.s)(p,n),this.logger.warn(S,I.I.QueryRoomMemberList,{error:n,roomID:r,config:t}),n},c.prototype.queryRoomMembers=function(r,t){var n="";if(Object(T.l)(t)?(!Array.isArray(r)||!r.length)&&(n="userIDs is invalid."):n="roomID is invalid.")return n=Object(T.s)(p,n),this.logger.warn(S,I.I.QueryRoomMembers,{error:n,roomID:t,userIDs:r}),n},c.prototype.setRoomAttributes=function(r,t){var n="";if(Object(T.l)(t)?!this._isValidAttribute(r)&&(n="The Key and Value of the roomAttributes only support string types."):n="roomID is invalid.")return n=Object(T.s)(p,n),this.logger.warn(S,I.I.SetRoomAttributes,{error:n,roomID:t,roomAttributes:r}),n},c.prototype.deleteRoomAttributes=function(r,t){var n="";if(Object(T.l)(t)?(!Array.isArray(r)||!r.length||r.some(function(s){return!s||typeof s!="string"}))&&(n="Every one of keys must be a valid string type."):n="roomID is invalid.")return n=Object(T.s)(p,n),this.logger.warn(S,I.I.DeleteRoomAttributes,{error:n,roomID:t,keys:r}),n},c.prototype.setRoomMembersAttributes=function(r,t,n){var s="";if((Object(T.l)(n)?!this._isValidAttribute(r)&&(s="The Key and Value of the attributes only support string types."):s="roomID is invalid.")||(!Array.isArray(t)||!t.length||t.some(function(u){return!u||typeof u!="string"}))&&(s="Every one of userIDs must be a valid string type."))return t=Object(T.s)(p,s),this.logger.warn(S,I.I.SetRoomMembersAttributes,{error:t,roomID:n,attributes:r}),t},c.prototype.queryRoomMembersAttributes=function(r,t){var n="";if(Object(T.l)(t)?(!Array.isArray(r)||!r.length||r.some(function(s){return!s||typeof s!="string"}))&&(n="Every one of userIDs must be a valid string type."):n="roomID is invalid.")return n=Object(T.s)(p,n),this.logger.warn(S,I.I.QueryRoomMembersAttributes,{error:n,roomID:t,userIDs:r}),n},c.prototype.queryRoomMemberAttributesList=function(r,t){var n="";if(Object(T.l)(r)?(!t||typeof t.count!="number"||t.count<0)&&(n="config or the config instance of count is invalid."):n="roomID is invalid.")return n=Object(T.s)(p,n),this.logger.warn(S,I.I.QueryRoomMemberAttributesList,{error:n,roomID:r,config:t}),n},c.prototype.validGroupUserIDs=function(r,t,n){var s="";if(Array.isArray(r)&&r.length&&!r.some(function(u){return!u||typeof u!="string"})?!Object(T.l)(t)&&(s="groupID is invalid."):s="Every one of userIDs must be a valid string type.")return s=Object(T.s)(p,s),this.logger.warn(f,n,{error:s,groupID:t,userIDs:r}),s},c.prototype.createGroup=function(r,t,n){var s=String(r.groupID||"").trim(),u="";if((s&&!Object(T.l)(s,!0)?u="The groupInfo instance of groupID is invalid.":!this._isValidName(r.groupName)&&(u="The groupInfo instance of groupName is invalid."))||!this._isValidName(r.groupAvatarUrl)&&(u="The groupInfo instance of groupAvatarUrl is invalid.")||!this._isValidName(n.groupNotice)&&(u="The config instance of groupNotice is invalid.")||t&&!Array.isArray(t)&&(u="Every one of userIDs must be a valid string type.")||!this._isValidAttribute(n.groupAttributes,!0)&&(u="The Key and Value of the groupAttributes property of the config instance only support string types."))return s=Object(T.s)(p,u),this.logger.warn(f,I.I.CreateGroup,{error:s,groupInfo:r,config:n,userIDs:t}),s},c.prototype.setGroupAttributes=function(r,t){var n="";if(Object(T.l)(t)?!this._isValidAttribute(r)&&(n="The Key and Value of the groupAttributes only support string types."):n="groupID is invalid.")return n=Object(T.s)(p,n),this.logger.warn(f,I.I.SetGroupAttributes,{error:n,groupID:t,groupAttributes:r}),n},c.prototype.deleteGroupAttributes=function(r,t){var n="";if(Object(T.l)(t)?(!Array.isArray(r)||!r.length||r.some(function(s){return!s||typeof s!="string"}))&&(n="Every one of kyes must be a valid string type."):n="groupID is invalid.")return n=Object(T.s)(p,n),this.logger.warn(f,I.I.DeleteGroupAttributes,{error:n,groupID:t,keys:r}),n},c.prototype.queryGroupAttributes=function(r,t){var n="";if(Object(T.l)(r)?Array.isArray(t)&&(!t.length||t.some(function(s){return!s||typeof s!="string"}))&&(n="Every one of kyes must be a valid string type."):n="groupID is invalid.")return n=Object(T.s)(p,n),this.logger.warn(f,I.I.QueryGroupAttributes,{error:n,groupID:r,keys:t}),n},c.prototype.setGroupMemberNickname=function(r,t,n){var s="";if((this._isValidName(r)?!Object(T.l)(t)&&(s="forUserID is invalid."):s="nickname is invalid.")||!Object(T.l)(n)&&(s="groupID is invalid."))return s=Object(T.s)(p,s),this.logger.warn(f,I.I.SetGroupMemberNickname,{error:s,groupID:n,forUserID:t,nickname:r}),s},c.prototype.setGroupMemberRole=function(r,t,n){var s="";if((typeof r!="number"?s="role is invalid.":!Object(T.l)(t)&&(s="forUserID is invalid."))||!Object(T.l)(n)&&(s="groupID is invalid."))return s=Object(T.s)(p,s),this.logger.warn(f,I.I.SetGroupMemberRole,{error:s,groupID:n,forUserID:t,role:r}),s},c.prototype.callInvite=function(r,t){var n="";if(Array.isArray(r)&&r.length?t&&typeof t.timeout=="number"&&(t.timeout%1!=0||t.timeout<1||600<t.timeout)&&(n="The config instance of timeout is invalid."):n="invitees is invalid.")return n=Object(T.s)(p,n),this.logger.warn(I.J.Call,I.I.CallInvite,{error:n,invitees:r,config:t}),n},c.prototype.callIDAndInvitees=function(r,t,n){var s="";if(Object(T.l)(t)?(!Array.isArray(r)||!r.length)&&(s="invitees is invalid."):s="callID is invalid.")return s=Object(T.s)(p,s),this.logger.warn(I.J.Call,n,{error:s,callID:t,invitees:r}),s},c.prototype.searchConversations=function(r){var t="";if((r?(typeof r.totalConversationCount!="number"||r.totalConversationCount<1)&&(t="The config instance of totalConversationCount is invalid."):t="config is invalid.")||(typeof r.conversationMessageCount!="number"||r.conversationMessageCount<1)&&(t="The config instance of count is invalid.")||Array.isArray(r.keywords)&&(5<r.keywords.length||r.keywords.some(function(n){return!n}))&&(t="The config instance of keywords is invalid.")||Array.isArray(r.senderUserIDs)&&(5<r.senderUserIDs.length||r.senderUserIDs.some(function(n){return!n}))&&(t="The config instance of senderUserIDs is invalid."))return t=Object(T.s)(p,t),this.logger.warn(d,I.I.SearchConvs,{config:r,error:t}),t},c.prototype.searchMessages=function(r,t){var n="";if((r?(typeof r.count!="number"||r.count<1)&&(n="The config instance of count is invalid."):n="config is invalid.")||Array.isArray(r.keywords)&&(5<r.keywords.length||r.keywords.some(function(s){return!s}))&&(n="The config instance of keywords is invalid.")||Array.isArray(r.senderUserIDs)&&(5<r.senderUserIDs.length||r.senderUserIDs.some(function(s){return!s}))&&(n="The config instance of senderUserIDs is invalid."))return n=Object(T.s)(p,n),this.logger.warn(d,t,{config:r,error:n}),n},c.prototype.searchGroups=function(r){var t="";if((r?(typeof r.count!="number"||r.count<1)&&(t="The config instance of count is invalid."):t="config is invalid.")||(!Array.isArray(r.keywords)||!r.keywords.length||5<r.keywords.length||r.keywords.some(function(n){return!n}))&&(t="The config instance of keywords is invalid."))return t=Object(T.s)(p,t),this.logger.warn(d,I.I.SearchGroups,{error:t,config:r}),t},c.prototype.searchGroupMembers=function(r,t){var n="";if((Object(T.l)(r)?!t&&(n="config is invalid."):n="groupID is invalid.")||(typeof t.count!="number"||t.count<1)&&(n="The config instance of count is invalid.")||(!Array.isArray(t.keywords)||!t.keywords.length||5<t.keywords.length||t.keywords.some(function(s){return!s}))&&(n="The config instance of keywords is invalid."))return n=Object(T.s)(p,n),this.logger.warn(d,I.I.SearchGroupMembers,{error:n,groupID:r,config:t}),n},c.prototype._checkMesageContent=function(r,t,n){return!((t===I.R.Text||t===I.R.Custom||t===I.R.Barrage&&r===I.q.Room)&&(typeof n!="string"||!n||!n.trim()||Object(T.i)(n).length>I.l.MAX_MESSAGE_SIZE)||!(t!==I.R.Command||n instanceof Uint8Array&&n.length&&!(n.length>I.l.MAX_MESSAGE_SIZE)&&Object(T.f)(n).trim()))},c.prototype._checkMesagePriority=function(r){return r===I.L.Low||r===I.L.Medium||r===I.L.High},c.prototype._checkMesageType=function(r,t){return r===I.R.Text||r===I.R.Command||r===I.R.Custom||t===I.q.Room&&r===I.R.Barrage},c.prototype._checkMediaMesageType=function(r){return r===I.R.Image||r===I.R.File||r===I.R.Audio||r===I.R.Video},c.prototype._checkInsertMesageType=function(r){return r===I.R.Text||r===I.R.System||r===I.R.Custom||r===I.R.Image||r===I.R.File||r===I.R.Audio||r===I.R.Video},c.prototype._checkInsertMesageContent=function(r){var t=r.message;return!(!(r.type!==I.R.Text&&r.type!==I.R.System&&r.type!==I.R.Custom||typeof t=="string"&&t&&t.trim()&&!(Object(T.i)(t).length>I.l.MAX_MESSAGE_SIZE))||r.type>=I.R.Image&&r.type<=I.R.Video&&!r.fileLocalPath&&!r.fileDownloadUrl)},c.prototype._checkConvType=function(r){return r===I.q.Peer||r===I.q.Room||r===I.q.Group},c.prototype._checkMessageReceipt=function(r,t,n){return!n||r!=I.q.Room&&t!=I.R.Command&&t!=I.R.Barrage},c.prototype._checkSubType=function(r){return r.type!==I.R.Custom||r.type==I.R.Custom&&0<=r.subType&&r.subType<=200},c);function c(r){this.logger=r,this._isValidName=function(t){return typeof t=="string"&&t.length<=I.l.MAX_NAME_SIZE},this._isValidAttribute=function(t,n){return!(!t||Object.prototype.toString.call(t)!=="[object Object]")&&(t=Object.values(t),!(!n&&!t.length)&&t.every(function(s){return typeof s=="string"}))}}},function(Q,O,b){b.d(O,"a",function(){return S}),b(22);var T=b(2),I=b(0),p=function(d,o){var c=typeof Symbol=="function"&&d[Symbol.iterator];if(!c)return d;var r,t,n=c.call(d),s=[];try{for(;(o===void 0||0<o--)&&!(r=n.next()).done;)s.push(r.value)}catch(u){t={error:u}}finally{try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(t)throw t.error}}return s},k=function(d,o,c){if(c||arguments.length===2)for(var r,t=0,n=o.length;t<n;t++)!r&&t in o||((r=r||Array.prototype.slice.call(o,0,t))[t]=o[t]);return d.concat(r||Array.prototype.slice.call(o))},S=(f.prototype.setContext=function(d){this.context=d},f.prototype.on=function(d,o){this.listenerMap.set(d,o)},f.prototype.off=function(d){d?this.listenerMap.delete(d):(this.listenerMap.clear(),this.innerEvents[I.t.ILogined].length=0,this.innerEvents[I.t.ILogout].length=0,this.innerEvents[I.t.IUpdateSelf].length=0,this.innerEvents[I.t.IJoinedGroup].length=0,this.innerEvents[I.t.ILeftGroup].length=0,this.innerEvents[I.t.ISyncGroups].length=0,this.innerEvents[I.t.ISyncGroupInfo].length=0,this.innerEvents[I.t.IUnreadMsgCount].length=0,this.innerEvents[I.t.IConnectedRoom].length=0,this.innerEvents[I.t.IConnected].length=0,this.innerEvents[I.t.IDisConnected].length=0,this.innerEvents[I.t.INetworkChange].length=0,this.innerEvents[I.t.IIdleFetchConvMsg].length=0,this.innerEvents[I.t.ITriggerHB].length=0,this.innerEvents[I.t.IQPSSend].length=0,this.context=null)},f.prototype.emit=function(d,o,c){var r=this,t=this.listenerMap.get(d);typeof t=="function"&&(c=c?"EV."+d+":"+c:"EV."+d,T.a.getInstance().logger.info(I.J.Manager,c,o),setTimeout(function(){try{t(r.context,o)}catch(n){throw n}},0))},f.prototype.add=function(d,o){this.innerEvents[d].push(o)},f.prototype.remove=function(d,o){var c;o?(c=this.innerEvents[d].findIndex(function(r){return r===o}))!==-1&&this.innerEvents[d].splice(c,1):this.innerEvents[d].length=0},f.prototype.exec=function(d){for(var o,c=[],r=1;r<arguments.length;r++)c[r-1]=arguments[r];this.unlogEvents.indexOf(d)==-1&&(o=d==I.t.ILogined?void 0:c.length<=1?c[0]:c,T.a.getInstance().logger.info(I.J.Manager,"IE."+d,o)),this.innerEvents[d].forEach(function(t){return t.apply(void 0,k([],p(c),!1))})},f);function f(){var d;this.listenerMap=new Map,this.unlogEvents=[I.t.ITriggerHB,I.t.IConnectedRoom,I.t.IQPSSend],this.innerEvents=((d={})[I.t.ILogined]=[],d[I.t.ILogout]=[],d[I.t.IUpdateSelf]=[],d[I.t.IJoinedGroup]=[],d[I.t.ILeftGroup]=[],d[I.t.ISyncGroups]=[],d[I.t.ISyncGroupInfo]=[],d[I.t.IUnreadMsgCount]=[],d[I.t.IConnectedRoom]=[],d[I.t.IConnected]=[],d[I.t.IDisConnected]=[],d[I.t.INetworkChange]=[],d[I.t.IIdleFetchConvMsg]=[],d[I.t.ITriggerHB]=[],d[I.t.IQPSSend]=[],d)}},function(Q,O,b){b.d(O,"a",function(){return o});var T=b(2),I=b(66),p=b(67),k=b(1),S=b(0),f=function(){return(f=Object.assign||function(r){for(var t,n=1,s=arguments.length;n<s;n++)for(var u in t=arguments[n])Object.prototype.hasOwnProperty.call(t,u)&&(r[u]=t[u]);return r}).apply(this,arguments)},d=S.J.Connection,o=(c.prototype.initEvent=function(r,t,n){this.onConnectedEvent=r,this.onDisConnectedEvent=t,this.onPushEvent=n},c.prototype.create=function(){this.streamID++,this.close();var r=new I.a(this.eventBus,this.engineConfig);return r.onconnected=this.onConnectedEvent,r.ondisconnected=this.onDisConnectedEvent,r.onmessage=this.onmessage,this.connection=r,this.initUrls(),r.create(this.urls)},c.prototype.close=function(){this.connection&&(this.logger.warn(d,"closeconn"),this.connection.destroy()),this.connection=null},c.prototype.destroy=function(){this.requestMap.clear(),this.qpsStgy.destroy(),this.close(),this.logger=null,this.dataReport=null,this.protobuf=null,this.engineConfig=null},c.prototype.setUrls=function(r){this.urls=r},c.prototype.sendDispatchRequest=function(){var r=++this.seq,t=this.protobuf.encodeAccesshubDispatchRequest(this.streamID,r,this.engineConfig),n=(this.connection.send(t),{time:new Date,seq:r,size:t.length,cmd:"AccesshubDispatchRequest"});this.createRequest(r,this.engineConfig.cloudSetting.req_to.def,n),r=++this.seq,t=this.protobuf.encodeAccesshubGetConfigRequest(this.streamID,r,this.engineConfig),this.connection.send(t),n={time:new Date,seq:r,size:t.length,cmd:"AccesshubGetConfigRequest"},this.createRequest(r,this.engineConfig.cloudSetting.req_to.def,n)},c.prototype.sendHttpRequest=function(r,t,n){var s=++this.seq;return n=this.protobuf.encodeAccesshubHTTPRequest(this.streamID,s,this.engineConfig,r,t,n),this.connection.send(n),n={time:new Date,seq:s,size:n.length,cmd:"AccesshubHTTPRequest",http:r,body:t},this.createRequest(s,this.engineConfig.cloudSetting.req_to.def,n)},c.prototype.sendRequest=function(r,t,n,s,u){return n===void 0&&(n=S.i.API),s===void 0&&(s=this.engineConfig.cloudSetting.req_to.def),u===void 0&&(u=!0),this.qpsStgy.canPass(r.w,1)?this.sendRequestInner(r.cmd,t,n,s,u):this.createQPSRequest(r.cmd,t,n,s,u,r.w)},c.prototype.sendRequestWithHeartbeat=function(r,t){return this.sendRequestInner(r,t,S.i.SDK,this.engineConfig.cloudSetting.req_to.def,!1)},c.prototype.sendRequestWithNoRsp=function(r,t){r=this.generateHeader(r,S.i.SDK),r=this.protobuf.encodeRequest(r,t,this.streamID,this.engineConfig);try{this.connection.send(r)}catch{}},c.prototype.responseRequest=function(r,t,n){var s,u;return this.requestMap.has(r)?(s=(u=this.requestMap.get(r)).timer,u=u.resolve,clearTimeout(s),t&&(this.requestMap.delete(r),u({code:n})),r):0},c.prototype.initUrls=function(){if(!this.urls.length){var r=this.settings.advancedConfig.geoFence.host.accesshub;if(r)this.urls[0]=r;else{this.urls[0]="wss://accesshub-wss.zego.im/accesshub";try{var t=k.n?k.n.getStorageSync(k.n._zisAlipay?{key:this.urlKey}:this.urlKey):localStorage.getItem(this.urlKey);if(!t||!t.data)return;this.urls=T.a.getInstance().crypto.decryptString(typeof t=="object"?t.data:t,this.engineConfig).split(",")}catch{}}}},c.prototype.initQPSEvent=function(){this.eventBus.add(S.t.IQPSSend,this.sendQPSRequest.bind(this))},c.prototype.sendRequestInner=function(r,t,n,s,u){var a=this.generateHeader(r,n),i=a.seq;r==S.c.sw_login.cmd&&(t._seq=i),this.pageMergeReportCmdList.indexOf(r)==-1&&this.dataReport.beginNetworkRequest(r,i,n,t),n=this.protobuf.encodeRequest(a,t,this.streamID,this.engineConfig);try{this.connection.send(n)}catch{return Promise.resolve(Object(k.s)(S.s.NetworkModuleNetworkError))}return u=u?{time:new Date,seq:i,caller:a.caller_type,size:n.length,rsize:-1,cmd:r,body:t}:null,this.createRequest(i,s,u,r)},c.prototype.sendQPSRequest=function(r){var t=this.requestMap.get(r);if(t){var n=t.timeout,s=(u=t.header).cmd,u=(this.pageMergeReportCmdList.indexOf(s)==-1&&this.dataReport.beginNetworkRequest(s,r,u.caller_type,t.body),this.protobuf.encodeRequest(u,t.body,this.streamID,this.engineConfig));try{this.connection.send(u)}catch{return t.resolve(Object(k.s)(S.s.NetworkModuleNetworkError))}t.log&&(t.timeout=Date.now()),t.timer=this.createRequestTimer(r,n,t.log,t.resolve,s)}},c.prototype.createRequest=function(r,t,n,s){var u=this;return new Promise(function(a){var i=u.createRequestTimer(r,t,n,a,s);u.requestMap.set(r,{resolve:a,log:n,timer:i})})},c.prototype.createQPSRequest=function(r,t,n,s,u,a){var i=this,l=this.generateHeader(r,n),h=l.seq,m=(r==S.c.sw_login.cmd&&(t._seq=h),this.qpsStgy.collectRequest({seq:h,weight:a,overhead:1}),u?{time:new Date,weight:a,seq:h,caller:l.caller_type,size:0,rsize:-1,cmd:r,body:t}:null);return new Promise(function(g){i.requestMap.set(h,{resolve:g,log:m,timer:null,timeout:s,header:l,body:t})})},c.prototype.createRequestTimer=function(r,t,n,s,u){var a=this;return setTimeout(function(){a.requestMap.delete(r);var i={seq:r,code:6000104,message:"Network error."};if(!a.logger)return s(i);n&&(n.timeout=t,a.logger.warn(d,S.I.SCMD,n)),u&&a.pageMergeReportCmdList.indexOf(u)==-1&&a.dataReport.endNetworkRequest(u,r,i),s(i)},t)},c.prototype.handleAccesshubPCDownwardMessage=function(r){var t=(n=function(y,w){var M=typeof Symbol=="function"&&y[Symbol.iterator];if(!M)return y;var R,D,q=M.call(y),L=[];try{for(;(w===void 0||0<w--)&&!(R=q.next()).done;)L.push(R.value)}catch(j){D={error:j}}finally{try{R&&!R.done&&(M=q.return)&&M.call(q)}finally{if(D)throw D.error}}return L}(this.protobuf.decodeResponseHeader(r),2))[0],n=n[1],s=t.seq;if(this.swPushCmdList.indexOf(t.cmd)!=-1){s>this.seq&&(this.seq=s);var u=t.cmd,a=this.protobuf.decodeResponseBody(r,u,n,this.engineConfig),i={time:0,seq:s,size:r.byteLength,cmd:u,body:a};u==S.c.sw_push_list.cmd&&a.push_requests&&a.push_requests[0]&&(h=(l=a.push_requests[0]).sub_cmd,m=l.sender_user_id,g=l.msg_id,l=l.msg_body,i.time=Date.now()+this.settings.serverOffsetTime-a.send_time,i.cmd=h,i.body={qos:a.qos_flag||void 0,stime:a.send_time,suid:m,msg_id:g,msg_body:l},1<(h=a.push_requests.length)&&(i.body.length=h)),this.logger.info(d,S.I.PCMD,i),a.subCmds||this.onPushEvent(u,a,i.time)}else{if(!this.requestMap.has(s))return m=Array.from(this.requestMap.keys()).join(),g={seq:s,cmd:t.cmd,rsize:r.byteLength-7-n,seqs:m},void this.logger.warn(d,S.I.SCMD,g);u=t.cmd.replace("_rsp","");var l=this.protobuf.decodeResponseBody(r,u,n,this.engineConfig),h=(this.handleFileProxyHost(u,l),this.requestMap.get(s)),m=(a=h.resolve,i=h.log,h.timer),g=h.timeout;(i||l.code)&&(n=null,i?(i.rsize=r.byteLength,i.rbody=l,g&&i.hasOwnProperty("weight")&&(i.weight+=","+(Date.now()-g))):n={seq:s,rsize:r.byteLength,cmd:u,rbody:l},l.code?this.logger.warn(d,S.I.SCMD,i||n):this.logger.info(d,S.I.SCMD,i||n)),this.requestMap.delete(s),clearTimeout(m),u===S.c.sw_login.cmd&&(l.rspHeader=t),this.pageMergeReportCmdList.indexOf(u)==-1&&l.code!=S.W&&this.dataReport.endNetworkRequest(u,s,l),a(l)}},c.prototype.handleAccesshubHTTPResponse=function(r){var t=r.txid;if(t&&this.requestMap.has(t)){var n=(u=this.requestMap.get(t)).resolve,s=u.log,u=u.timer,a={};if(r.body&&r.body.length)try{a=JSON.parse(Object(k.f)(r.body))}catch{}this.requestMap.delete(t),clearTimeout(u),s.code=r.status_code,s.result=a,this.logger.info(d,S.I.SCMD,s),n(a)}},c.prototype.handleAccesshubRsp=function(r){var t=r.txid;if(!t||!this.requestMap.has(t))return!1;var n=(s=this.requestMap.get(t)).log,s=s.timer;return this.requestMap.delete(t),clearTimeout(s),n.result=r,this.logger.info(d,S.I.SCMD,n),!r.code},c.prototype.handleAccesshubLog=function(r,t,n){this.logger.info(d,S.I.PCMD,{type:r,cmd:"Accesshub"+(n=n===void 0?"":n),res:t}),r!=19&&r!=20&&r!=30||this.onPushEvent(S.c.Accesshub.cmd,f({_type:r},t),0)},c.prototype.generateHeader=function(r,t){return{cmd:r,seq:++this.seq,timestamp:Date.now(),product:2,flags:[1],caller_type:t,app_id:this.engineConfig.appID,user_id:this.engineConfig.user.userID,session_id:this.engineConfig.sessionID,user_nid:this.engineConfig.serverUserID,controls:this.engineConfig.controls}},c.prototype.saveUrls=function(r){if(r&&r.length)if(this.urls=r,r=T.a.getInstance().crypto.encryptString(r.join(","),this.engineConfig),k.n)k.n._zisAlipay?k.n.setStorageSync({key:this.urlKey,data:r}):k.n.setStorageSync(this.urlKey,r);else try{localStorage.setItem(this.urlKey,r)}catch{}},c.prototype.handleFileProxyHost=function(r,t){var n,s=this.settings.advancedConfig.geoFence.host.fileproxy;s&&(n=this.settings.advancedConfig.geoFence.reg,r==S.c.file_upload.cmd?t.upload_req.url=t.upload_req.url.replace(n,s+"$4"):r==S.c.file_process.cmd&&(t.download_url=t.download_url.replace(n,s+"$4")))},c);function c(r,t){var n=this;this.eventBus=t,this.seq=0,this.streamID=0,this.urlKey="",this.urls=[],this.requestMap=new Map,this.swPushCmdList=[S.c.sw_push_list.cmd,S.c.sw_push_kickout.cmd,S.c.sw_push_redirect.cmd],this.pageMergeReportCmdList=[S.c.c2c_msglist.cmd,S.c.group_msglist.cmd,S.c.room_msglist.cmd,S.c.call_list.cmd,S.c.usermail_convlist.cmd,S.c.usermail_convpinnedlist.cmd,S.c.group_list.cmd,S.c.group_member_list.cmd,S.c.room_userlist.cmd,S.c.msg_read_receipt_detail.cmd,S.c.extra_msglist.cmd,S.c.c2c_msg_state_list.cmd,S.c.group_msg_state_list.cmd,S.c.c2c_reaction_list.cmd,S.c.group_reaction_list.cmd],this.logger=T.a.getInstance().logger,this.dataReport=T.a.getInstance().dataReport,this.protobuf=T.a.getInstance().protobuf,this.settings=T.a.getInstance().settings,this.onmessage=function(s){var u=((s=k.n&&s.data.isBuffer?Object(k.b)(s.data.data):new Uint8Array(s.data))[2]<<8)+s[3],a=n.protobuf.decodeAccesshubResponse(u,s);switch(u){case 21:n.handleAccesshubPCDownwardMessage(a);break;case 5:n.handleAccesshubHTTPResponse(a);break;case 27:n.handleAccesshubRsp(a)&&n.saveUrls(a.wss_groups.map(function(l){return"wss://"+l.host+"/accesshub"}));break;case 15:!n.handleAccesshubRsp(a)||1<=(i=a.geofencing_id)&&i<=7&&i!=n.settings.advancedConfig.geoFence.id&&(n.settings.advancedConfig.geoFence.id=i,n.settings.advancedConfig.geoFence.host=S.v[i].host,n.saveUrls([n.settings.advancedConfig.geoFence.host.accesshub]));break;case 3:n.handleAccesshubLog(u,a,"CloseConnection"),n.onDisConnectedEvent(!0);break;case 22:n.handleAccesshubLog(u,a,"Redirect");var i=a.wss_groups.map(function(l){return"wss://"+l.host+"/accesshub"});i.length&&n.onPushEvent(S.c.sw_push_redirect.cmd,{quey_user_id:i},0);break;default:n.handleAccesshubLog(u,a)}},this.engineConfig=r,this.qpsStgy=new p.a(t),this.urlKey="z_AccesshubURL_"+this.engineConfig.appID,T.a.getInstance().crypto.generateAppIDKey(this.engineConfig),this.initQPSEvent()}},function(Q,O,b){b.d(O,"a",function(){return S});var T=b(2),I=b(1),p=b(0),k=p.J.Connection,S=(f.prototype.create=function(d){var o=this;return this.close(),this.urls=d,this.urlIndex=0,this.retryCount=0,this.retryTotalTime=0,this.initDelayTask(),new Promise(function(c,r){o.createSocket(),o.bindSocketEvent(c,r)})},f.prototype.close=function(){this.socket&&(I.n?(I.n._zim_isAlipay?(this.socket.offMessage(),this.socket.offOpen(),this.socket.offClose(),this.socket.offError()):(this.socket.onMessage(function(){}),this.socket.onOpen(function(){}),this.socket.onClose(function(){}),this.socket.onError(function(){})),this.socket.close()):(this.socket.onmessage=null,this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.close(1e3)),this.socket=null)},f.prototype.destroy=function(){this.close(),this.eventBus.remove(p.t.INetworkChange,this.onNetworkChange),this.logger=null},f.prototype.send=function(d){var o;this.socket&&(I.n?(o=I.n._zim_isAlipay?Object(I.c)(d):d.buffer,this.socket.send({data:o,isBuffer:!0})):this.socket.send(d))},f.prototype.createSocket=function(){if(I.n)try{this.socket=I.n.connectSocket({url:this.urls[this.urlIndex]+"?zim",multiple:!0})}catch{}else try{this.socket=new WebSocket(this.urls[this.urlIndex]+"?zim"),this.socket.binaryType="arraybuffer"}catch{}},f.prototype.bindSocketEvent=function(d,o){function c(){t.isConnecting=!1,t.retryCount=0,t.retryTotalTime=0,t.urlIndex=0;var n=!d,s={event:"onconnected",isReconnect:n,total:t.initDelayTask(),login_max_itvl:t.engineConfig.cloudSetting.retry.login_max_itvl,url:t.urls[t.urlIndex]};t.logger.warn(k,t.reconnAction,s),t.onconnected(n),d&&d(t.urls[t.urlIndex]),d=void 0}function r(n){!t.isConnecting&&t.socket&&(t.isConnecting=!0,t.reconnect(n,d,o))}var t=this;I.n?(this.socket.onMessage(this.onmessage),this.socket.onOpen(c),this.socket.onClose(r),this.socket.onError(r)):(this.socket.onmessage=this.onmessage,this.socket.onopen=c,this.socket.onclose=r,this.socket.onerror=r)},f.prototype.reconnect=function(d,o,c){var r,t=this,n=(this.close(),this.delayTaskList.shift()||this.unlimited_retry);if(!n)return r={event:"ondisconnected",url:this.urls[this.urlIndex]},this.logger.warn(k,this.reconnAction,r),this.isConnecting=!1,this.retryCount=0,this.retryTotalTime=0,this.urlIndex=0,this.ondisconnected(!0),c&&c(),void(c=void 0);this.ondisconnected(!1),d=d&&d.type?{type:d.type,code:d.code,reason:d.reason}:d,setTimeout(function(){var s;t.logger&&(t.isConnecting=!1,t.retryCount++,t.retryTotalTime+=n,t.urlIndex=(t.urlIndex+1)%t.urls.length,s={delay:n,count:t.retryCount,time:t.retryTotalTime,event:d},t.logger.warn(k,t.reconnAction,s),T.a.getInstance().dataReport.reportSDKEvent("/sdk/log",{error_message:JSON.stringify(s)}),t.createSocket(),t.bindSocketEvent(o,c))},n)},f.prototype.initDelayTask=function(){var d=this.engineConfig.cloudSetting.retry.login_max_itvl,o=d<0?3e5:1e3*d;if((this.unlimited_retry=0)==d)return this.delayTaskList.length=0;for(var c=500+Math.floor(1500*Math.random()),r=(this.delayTaskList=[c],0),t=c;t<o;){var n=Math.min(2e3*Math.pow(2,r),32e3);t+=n,this.delayTaskList.push(n),t<o&&(t+=n,this.delayTaskList.push(n)),r++}return d<0?(this.unlimited_retry=this.delayTaskList[this.delayTaskList.length-1],-1):t},f);function f(d,o){var c=this;this.eventBus=d,this.engineConfig=o,this.logger=T.a.getInstance().logger,this.urls=[],this.urlIndex=0,this.isConnecting=!1,this.unlimited_retry=0,this.retryCount=0,this.retryTotalTime=0,this.delayTaskList=[],this.reconnAction="reconn",this.onNetworkChange=function(r,t){var n;r=="fetchSetting"?(n={event:"resetRetry",total:c.initDelayTask(),login_max_itvl:c.engineConfig.cloudSetting.retry.login_max_itvl},c.logger.warn(k,r,n)):r&&(c.delayTaskList[0]||c.unlimited_retry)?(c.isConnecting=!0,c.delayTaskList.unshift(100),c.reconnect("NetworkChange:"+t)):(c.logger.warn(k,c.reconnAction,n={online:r,netType:t}),T.a.getInstance().dataReport.reportSDKEvent("/sdk/log",{error_message:JSON.stringify(n)}))},d.add(p.t.INetworkChange,this.onNetworkChange)}},function(Q,O,b){b.d(O,"a",function(){return p});var T=b(1),I=b(0),p=(k.prototype.destroy=function(){this.requestList.length=0,clearInterval(this.checkTokenTimer),clearInterval(this.checkRequestTimer),clearInterval(this.postQPSTimer),this.eventBus=null},k.prototype.canPass=function(S,f){var d=this.tokenCount-f>this.defaultToken;return S!==I.d.Highest&&(this.requestNum++,this.tokenCount-=f,this.tokenCount<0&&(this.tokenCount=0)),S==I.d.Highest||d},k.prototype.collectRequest=function(S){this.requestList.push(S)},k.prototype.postRequestData=function(){var S=this;this.postQPSTimer=setInterval(function(){var f;S.requestNum=0,S.isProd||T.n||(f={reqLen:S.requestList.length,token:S.tokenCount,action:"setData",max:S.maxToken,interval:1e3,reqNum:S.requestNum},postMessage(JSON.stringify(f),"*"))},1e3)},k.prototype.warmUpTokenBuck=function(){var S,f=this,d=this.maxToken-this.defaultToken,o=1,c=1,r=setInterval(function(){S=o+c,o=c,d<=(c=S)||f.tokenCount>=f.maxToken?(clearInterval(r),r=null,f.initCheckTokenInterval()):(f.tokenCount+=c,f.tokenCount>f.maxToken&&(f.tokenCount=f.maxToken))},50)},k.prototype.initCheckTokenInterval=function(){var S=this;this.checkTokenTimer=setInterval(function(){S.tokenCount+=S.requestList.length>S.maxToken/2?2*S.tokenStep:S.tokenStep,S.tokenCount>S.maxToken&&(S.tokenCount=S.maxToken)},100)},k.prototype.initCheckRequestInterval=function(){var S=this;this.checkRequestTimer=setInterval(function(){S.requestList.sort(function(o,c){return c.weight-o.weight});for(var f=0;S.requestList.length&&f++<10;){var d=S.requestList.shift();if(!d||!S.tokenCount||(S.eventBus.exec(I.t.IQPSSend,d.seq),S.tokenCount-=d.overhead,S.tokenCount<1))break}},100)},k);function k(S){this.requestList=[],this.tokenCount=30,this.maxToken=100,this.defaultToken=30,this.tokenStep=5,this.requestNum=0,this.isProd=!0,this.eventBus=S,this.warmUpTokenBuck(),this.initCheckRequestInterval(),this.postRequestData()}},function(Q,O,b){b.d(O,"a",function(){return s}),O=b(3);var T=b.n(O),I=b(69),p=b(70),k=b(71),S=b(2),f=b(72),d=b(1),o=b(0),c=function(){return(c=Object.assign||function(a){for(var i,l=1,h=arguments.length;l<h;l++)for(var m in i=arguments[l])Object.prototype.hasOwnProperty.call(i,m)&&(a[m]=i[m]);return a}).apply(this,arguments)},r=function(a,i,l,h){return new(l=l||Promise)(function(m,g){function y(R){try{M(h.next(R))}catch(D){g(D)}}function w(R){try{M(h.throw(R))}catch(D){g(D)}}function M(R){var D;R.done?m(R.value):((D=R.value)instanceof l?D:new l(function(q){q(D)})).then(y,w)}M((h=h.apply(a,i||[])).next())})},t=function(a,i){var l,h,m,g={label:0,sent:function(){if(1&m[0])throw m[1];return m[1]},trys:[],ops:[]},y={next:w(0),throw:w(1),return:w(2)};return typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function w(M){return function(R){var D=[M,R];if(l)throw new TypeError("Generator is already executing.");for(;g;)try{if(l=1,h&&(m=2&D[0]?h.return:D[0]?h.throw||((m=h.return)&&m.call(h),0):h.next)&&!(m=m.call(h,D[1])).done)return m;switch(h=0,(D=m?[2&D[0],m.value]:D)[0]){case 0:case 1:m=D;break;case 4:return g.label++,{value:D[1],done:!1};case 5:g.label++,h=D[1],D=[0];continue;case 7:D=g.ops.pop(),g.trys.pop();continue;default:if(!(m=0<(m=g.trys).length&&m[m.length-1])&&(D[0]===6||D[0]===2)){g=0;continue}if(D[0]===3&&(!m||D[1]>m[0]&&D[1]<m[3])){g.label=D[1];break}if(D[0]===6&&g.label<m[1]){g.label=m[1],m=D;break}if(m&&g.label<m[2]){g.label=m[2],g.ops.push(D);break}m[2]&&g.ops.pop(),g.trys.pop();continue}D=i.call(a,g)}catch(q){D=[6,q],h=0}finally{l=m=0}if(5&D[0])throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}}},n=o.J.Conversation,s=(u.prototype.destroy=function(){this.onLogout(),this.connMgr=null,this.groupMgr=null,this.eventBus=null,this.logger=null,this.engineConfig=null,this.stgyMgr=null},u.prototype.queryUsersInfo=function(a,i){var l=this,h=[],m=(a=a.filter(function(w){return!!Object(d.l)(w)||(h.push({userID:w,reason:6000001}),!1)}),(a=Array.from(new Set(a))).filter(function(w){return!l.dbUserMap.has(w)})),g=a.length-m.length,y={time:new Date,config:i,queryCount:a.length,dbCount:g};return m.length!=0||i&&i.isQueryFromServer?(g={quey_user_id:i&&i.isQueryFromServer?a:m},this.connMgr.sendRequest(o.c.fetch_user_info,g).then(function(w){var M,R=w.code||0,D=(R&&(D=Object(d.s)(o.s.CommonModuleIMServerError,w.message,w.code),y.error=D,R=D.code),w.result),q=(w=w.err_list,new Map),L=(w&&w.length&&w.forEach(function(G){G={userID:G.user_id,reason:G.sub_code},q.set(G.userID,G),h.push(G)}),new Map),j=(D&&D.length&&(M=[],D.forEach(function(G){var J=G.user_id,K=Object(d.f)(G.user_name),ee=Object(d.f)(G.avatar);G=Object(d.f)(G.extra),L.set(J,{baseInfo:{userID:J,userName:K},userAvatarUrl:ee,extendedData:G}),K={userID:J,userName:K,userAvatarUrl:ee,extendedData:G},(ee=l.dbUserMap.get(J))&&Object.assign(ee,K),M.push(ee||K),l.dbUserMap.set(J,ee||K),l.svrConvInfoMap.set(J,ee||K)}),l.dbMgr.addUserList(M)),a.forEach(function(G){var J=l.dbUserMap.get(G);L.has(G)||(J?(L.set(G,{baseInfo:{userID:J.userID,userName:J.userName},userAvatarUrl:J.userAvatarUrl,extendedData:J.extendedData}),l.svrConvInfoMap.set(G,J)):q.has(G)||(J={userID:G,reason:R},q.set(G,J),h.push(J)))}),[]);return l.convMap.forEach(function(G){var J=l.svrConvInfoMap.get(G.convID);J&&G.convType==o.q.Peer&&j.push({user:J,dbConv:G.dbConv})}),l.emitConvInfo(j),y.count=L.size,l.logger.info(o.J.User,o.I.QueryUsersInfo,y),L.size==0?Promise.reject(y.error):{userList:Array.from(L.values()),errorUserList:h}})):(g=a.map(function(w){return{baseInfo:{userID:(w=l.dbUserMap.get(w)).userID,userName:w.userName},userAvatarUrl:w.userAvatarUrl,extendedData:w.extendedData}}),this.logger.info(o.J.User,o.I.QueryUsersInfo,y),Promise.resolve({userList:g,errorUserList:h}))},u.prototype.query=function(a,i){var l=this;return new Promise(function(h,m){var g=Array.from(l.dbConvMap.values()).find(function(y){return y.conversationID==a&&y.type==i});g&&!l.isDBConvInvalid(g)?(l.logger.info(n,o.I.QueryConv,a),h({conversation:Object(d.q)(l.convKeys,g)})):(h=Object(d.s)(o.s.ConversationModuleConversationDoesNotExist),l.logger.warn(n,o.I.QueryConv,{error:h,conversationID:a}),m(h))})},u.prototype.queryList=function(a){var i=this;return a.count<1?Promise.resolve({conversationList:[]}):new Promise(function(l){var h={time:new Date,logined:i.isLogined,queryCount:a.count,count:0};i.isLogined?i.mergeServerConvList(o.u.Biz,"apicall",function(m){i.handleQueryConvsCallback(m,{isPinned:!1,config:a,log:h,resolve:l})}):i.queryConvsCallbackList.push({isPinned:!1,config:a,log:h,resolve:l})})},u.prototype.queryPinnedList=function(a){var i=this;return a.count<1?Promise.resolve({conversationList:[]}):new Promise(function(l){var h,m={time:new Date,logined:i.isLogined,queryCount:a.count,count:0};i.isLogined?((h=Array.from(i.dbConvMap.values()).filter(function(g){var y=i.filterValidConv(g,!0);return y&&i.createConversationInstance(g.conversationID,g.type),y})).sort(function(g,y){return y.orderKey-g.orderKey}),i.handleQueryConvsCallback(h,{isPinned:!0,config:a,log:m,resolve:l})):i.queryConvsCallbackList.push({isPinned:!0,config:a,log:m,resolve:l})})},u.prototype.delete=function(a,i,l){var h=this,m=(l=Object.assign({isAlsoDeleteServerConversation:!0},l),this.getConversationKey(a,i)),g=(m=this.convMap.get(m))==null?void 0:m.dbConv;if(this.isDBConvInvalid(g))return m=Object(d.s)(o.s.ConversationModuleConversationDoesNotExist),this.logger.warn(n,o.I.DeleteConv,{error:m,convID:a,type:i,config:l}),Promise.reject(m);var y={time:new Date,convID:a,type:i,config:l};return m={conv_id:a,conv_type:i,read_seq:g.msgSeq},l&&l.isAlsoDeleteServerConversation?this.connMgr.sendRequest(o.c.usermail_del_conv,m).then(function(w){var M;return w.code?(M=Object(d.s)(o.s.ConversationModuleServerError,w.message,w.code),y.error=M,h.logger.warn(n,o.I.DeleteConv,y),Promise.reject(M)):(g.seq=w.conv_list_seq?w.conv_list_seq.toString():"0",h.deleteLocalConv(g,y))}):(this.connMgr.sendRequest(o.c.usermail_update_read_seq,m,o.i.SDK),this.deleteLocalConv(g,y))},u.prototype.deleteAll=function(a){return r(this,void 0,void 0,function(){var i,l,h,m=this;return t(this,function(g){switch(g.label){case 0:return a=Object.assign({isAlsoDeleteServerConversation:!0},a),i={time:new Date,config:a},+this.engineConfig.mailHBConfig.conv_list_seq!=0?[3,2]:(l={conv_sid:this.engineConfig.user.convSeq||"1"},[4,this.connMgr.sendRequest(o.c.usermail_hb,l)]);case 1:l=g.sent(),this.engineConfig.mailHBConfig.conv_list_seq=l.conv_list_seq,g.label=2;case 2:return(h={conv_sid:this.engineConfig.mailHBConfig.conv_list_seq}).conv_sid&&a&&a.isAlsoDeleteServerConversation?[2,this.connMgr.sendRequest(o.c.usermail_del_all_conv,h).then(function(y){return y.code?(y=Object(d.s)(o.s.ConversationModuleServerError,y.message,y.code),i.error=y,m.logger.info(n,o.I.DeleteAllConv,i),Promise.reject(y)):m.deleteAllLocalConv(i)})]:(this.connMgr.sendRequest(o.c.usermail_clean_all_unread,h),[2,this.deleteAllLocalConv(i)])}})})},u.prototype.setNotificationStatus=function(a,i,l){var h=this,m=(y=this.convMap.get(this.getConversationKey(i,l)))==null?void 0:y.dbConv;if(this.isDBConvInvalid(m))return y=Object(d.s)(o.s.ConversationModuleConversationDoesNotExist),this.logger.warn(n,o.I.SetNotificationStatus,{error:y,convID:i,status:a}),Promise.reject(y);var g={time:new Date,convID:i,type:l},y={group_id:i,enable:a===o.o.DoNotDisturb};return this.connMgr.sendRequest(o.c.group_mute,y).then(function(w){return w.code?(w=Object(d.s)(o.s.ConversationModuleServerError,w.message,w.code),g.error=w,h.logger.warn(n,o.I.SetNotificationStatus,g),Promise.reject(w)):(m.notificationStatus=a,w="setNotifyStatus",h.emitConversationUpdated(m,w),h.onUnreadMessageCount(w),w=a==o.o.DoNotDisturb?o.m.DontDisturb:o.m.RecoverDisturb,h.stgyMgr.updateConversationActivity(i,l,w),h.logger.info(n,o.I.SetNotificationStatus,g),{conversationID:i,conversationType:l})})},u.prototype.updatePinnedState=function(a,i,l){var h,m=this,g=null,y=(h=this.convMap.get(this.getConversationKey(i,l)))==null?void 0:h.dbConv;if(this.isDBConvInvalid(y)?g=Object(d.s)(o.s.ConversationModuleConversationDoesNotExist):y.isPinned==a&&(h="Cannot set the same value of isPinned: "+a,g=Object(d.s)(o.s.CommonModuleParamInvalid,h)),g)return this.logger.warn(n,o.I.UpdatePinnedState,{error:g,convID:i,isPinned:a}),Promise.reject(g);var w={time:new Date,convID:i,type:l};return this.connMgr.sendRequest(o.c.usermail_modify_conv_pinned_lv,{conv_id:i,conv_type:l,pinned_type:a?1:0}).then(function(M){var R;return M.code?(R=Object(d.s)(o.s.ConversationModuleServerError,M.message,M.code),w.error=R,m.logger.warn(n,o.I.UpdatePinnedState,w),Promise.reject(R)):(y.isPinned=a,m.updateConvPinnedListSeq(+M.conv_list_seq.toString()),m.emitConversationUpdated(y,"setConvPinned"),m.logger.info(n,o.I.UpdatePinnedState,w),{conversationID:i,conversationType:l})})},u.prototype.clearUnreadCount=function(a,i){var l=(l=this.convMap.get(this.getConversationKey(a,i)))==null?void 0:l.dbConv;if(this.isDBConvInvalid(l))return h=Object(d.s)(o.s.ConversationModuleConversationDoesNotExist),this.logger.warn(n,o.I.ClearUnreadCount,{error:h,convID:a,type:i}),Promise.reject(h);var h="clearUnrc",m=l.msgSeq||0,g=l.unreadMessageCount||0;return this.syncConvReadSeqToMsgSeq(l,m),this.dbMgr.addConversationList([l],h),0<g&&(l={event:o.n.Updated,conversation:Object(d.q)(this.convKeys,l)},this.eventBus.emit(o.t.ConvChanged,{infoList:[l]},h),this.onUnreadMessageCount(h),this.connMgr.sendRequest(o.c.usermail_update_read_seq,{conv_id:a,conv_type:i,read_seq:m})),this.logger.info(n,o.I.ClearUnreadCount,{convID:a,seq:m,uncount:g}),Promise.resolve({conversationID:a,conversationType:i})},u.prototype.clearAllUnreadCount=function(){var a=this,i=[],l=!1,h=(this.convMap.forEach(function(m){a.filterValidConv(m.dbConv)&&m.dbConv.readMsgSeq<m.dbConv.msgSeq&&(l=!0,a.syncConvReadSeqToMsgSeq(m.dbConv,m.dbConv.msgSeq),i.push(m.dbConv))}),"clearAllUnrc");return l&&(this.onUnreadMessageCount(h),this.dbMgr.addConversationList(i,h),h={conv_sid:this.engineConfig.mailHBConfig.conv_list_seq},this.connMgr.sendRequest(o.c.usermail_clean_all_unread,h)),this.logger.info(n,o.I.ClearAllUnreadCount),Promise.resolve()},u.prototype.sendMessage=function(a,i,l,h,m){var g,y=this;if(l===o.q.Room&&!this.groupMgr.findRoom(i))return g=Object(d.s)(o.s.MessageModuleSendMessageFailed,"Room is not exist or the user is not in the room."),this.logger.warn(n,o.I.SendMessage,{error:g,convID:i,type:l}),w={status:o.P.Failed,message:a},this.eventBus.emit(o.t.MsgSentStatus,{infos:[w]}),Promise.reject(g);var w=this.createConversationInstance(i,l);return this.stgyMgr.updateConversationActivity(i,l,o.m.HandleMessage),a.type===o.R.Command||a.type===o.R.Barrage?w.sendCommand(a,h,m):w.sendMessage(a,h,m).then(function(M){return y.insertDBMessageExtra(M),M})},u.prototype.sendMediaMessage=function(a,i,l,h,m){var g=this;return l!==o.q.Room||this.groupMgr.findRoom(i)?(this.stgyMgr.updateConversationActivity(i,l,o.m.HandleMessage),this.createConversationInstance(i,l).sendMediaMessage(a,h,m).then(function(y){return g.insertDBMessageExtra(y),y})):(h=Object(d.s)(o.s.MessageModuleSendMessageFailed,"Room is not exist or the user is not in the room."),this.logger.warn(n,o.I.SendMediaMessage,{error:h,convID:i,type:l}),m={status:o.P.Failed,message:a},this.eventBus.emit(o.t.MsgSentStatus,{infos:[m]}),Promise.reject(h))},u.prototype.deleteMessages=function(a,i,l,h){var m=this;return this.createConversationInstance(i,l).deleteMessages(a,h).then(function(g){var y=m.engineConfig.user.userID+l+i;return g=g.map(function(w){return w=y+w,m.msgExtraMap.delete(w),w}),m.dbMgr.deleteMessageExtraList(g),{conversationID:i,conversationType:l}})},u.prototype.deleteAllMessage=function(a,i,l){var h=this;return this.createConversationInstance(a,i).deleteAllMessage(l).then(function(m){var g=[],y=h.engineConfig.user.userID+i+a;return h.msgExtraMap.forEach(function(w){w.conversationID==a&&w.conversationType==i&&(w=y+w.conversationSeq,g.push(w),h.msgExtraMap.delete(w))}),h.dbMgr.deleteMessageExtraList(g),m})},u.prototype.queryHistoryMessage=function(a,i,l){var h=this,m=this.createConversationInstance(a,i);return i==o.q.Room?m.queryHistoryMessage(l).then(function(g){var y=g.list;return g=g.log,h.logger.info(n,o.I.QueryHistoryMessage,g),{conversationID:a,conversationType:i,messageList:y}}):m.queryHistoryMessage(l).then(function(g){var y=g.list;return g=g.log,m.dbConv.type==o.q.Group&&h.mergeGroupMessageStatus(m.dbConv,y,o.u.Biz),h.mergeMessageExtra(m.dbConv,y,g.statusMap),h.logger.info(n,o.I.QueryHistoryMessage,g),{conversationID:a,conversationType:i,messageList:y}})},u.prototype.insertMessageToLocalDB=function(a,i,l,h){return a.senderUserID=h,this.createConversationInstance(i,l).insertMessageToLocalDB(a)},u.prototype.updateMessageLocalExtendedData=function(a,i){var l=this,h=((i=Object.isFrozen(i)?c({},i):i).localExtendedData=a,this.copyMessageProxyField(i),i.conversationID),m=i.conversationType;return this.dbMgr.addMessageList(h,m,[i]).then(function(){var g=(g=l.dbConvMap.get(l.getConversationKey(h,m)))==null?void 0:g.lastMessage;return m!=o.q.Room&&g&&g.messageID==i.messageID&&(g.localExtendedData=a),l.logger.info(n,o.I.UpdateMessageLocalExtendedData,i.messageID),{message:i}})},u.prototype.sendReceiptRead=function(a,i){var l=this,h=(g=this.convMap.get(this.getConversationKey(a,i)))==null?void 0:g.dbConv;if(this.isDBConvInvalid(h))return m=Object(d.s)(o.s.ConversationModuleConversationDoesNotExist),this.logger.warn(n,o.I.SendReceiptRead,{error:m,convID:a,type:i}),Promise.reject(m);var m,g=h.maxRecvReceiptMsgSeq||0,y=h.msgSeq||0,w={time:new Date,convID:a,oldSeq:g,seq:y};return y?y<=g?(this.logger.info(n,o.I.SendReceiptRead,w),Promise.resolve({conversationID:a,conversationType:i})):this.connMgr.sendRequest(o.c.c2c_conv_read_receipt,{group_id:a,conv_msg_seq:y}).then(function(M){if(M.code)return R=Object(d.s)(o.s.ConversationModuleServerError,M.message,M.code),w.error=R,l.logger.warn(n,o.I.SendReceiptRead,w),Promise.reject(R);l.selfReceiptSeqs.push(M.conv_list_seq.toString()),h.maxRecvReceiptMsgSeq=y;var R=h.lastMessage;return R&&R.receiptStatus&&R.conversationSeq==y&&R.direction==o.K.Receive&&(R.receiptStatus=o.M.Done),l.dbMgr.addConversationList([h],"ackReceipt"),l.logger.info(n,o.I.SendReceiptRead,w),{conversationID:a,conversationType:i}}):(m=Object(d.s)(o.s.CommonModuleParamInvalid,"No message from server."),w.error=m,this.logger.warn(n,o.I.SendReceiptRead,w),Promise.reject(m))},u.prototype.sendMessageReceiptsRead=function(a,i,l){function h(R){var D,q=R.conv_msg_seq2_receipt_seq,L=[],j=[],G=(D=m.dbConvMap.get(m.getConversationKey(i,l)))==null?void 0:D.lastMessage;return a.forEach(function(J){var K=String(J.conversationSeq),ee=g.get(K);q&&q.hasOwnProperty(K)&&ee&&ee.messageID==J.messageID?(m.selfReceiptSeqs.push(q[K]),K=c(c({},ee),{receiptStatus:o.M.Done}),m.copyMessageProxyField(K),L.push(K),G&&G.receiptStatus&&G.conversationSeq==J.conversationSeq&&(G.receiptStatus=o.M.Done)):j.push(J.messageID)}),m.createConversationInstance(i,l).updateMsgCacheList(L),m.dbMgr.addMessageList(i,l,L),R.code||j.length==a.length?(D=Object(d.s)(o.s.MessageModuleReceiptReadError,R.message,R.code),y.error=D,m.logger.warn(n,o.I.SendMessageReceiptsRead,y),Promise.reject(D)):(m.logger.info(n,o.I.SendMessageReceiptsRead,y),Promise.resolve({conversationID:i,conversationType:l,errorMessageIDs:j}))}var m=this,g=new Map,y=(a.forEach(function(R){R.conversationID==i&&R.conversationType==l&&R.direction==o.K.Receive&&R.receiptStatus==o.M.Processing&&g.set(String(R.conversationSeq),R)}),{time:new Date,convID:i,count:g.size});if(!g.size)return h({});var w=l==o.q.Peer?o.c.c2c_msg_read_receipt:o.c.group_msg_read_receipt,M={conv_id:i,conv_msg_seq:Array.from(g.keys())};return this.connMgr.sendRequest(w,M).then(h)},u.prototype.queryReceiptsInfo=function(a,i,l){var h=this;return new Promise(function(m){var g={time:new Date,convID:i,count:0,messageCount:a.length};h.mergeServerMsgExtraList(o.u.Biz,void 0,function(){var y=[],w=[],M=[];a.forEach(function(R){var D,q,L,j,G,J;R.type!=o.R.Revoke&&R.receiptStatus&&R.conversationID===i&&R.conversationType===l?(D=R.conversationSeq,!(q=h.msgExtraMap.get(h.getMsgExtraKey(i,l,D)))||!q.revokeInfo&&q.receiptStatus?(L={conversationID:i,conversationType:l,messageID:R.messageID,status:R.receiptStatus,readMemberCount:0,unreadMemberCount:0,isSelfOperated:!1},w.push(L),q&&!q.messageID&&(q.messageID=R.messageID,M.push(q)),R.sentStatus==o.P.Success&&(j=!1,l==o.q.Peer&&(G=((J=h.dbConvMap.get(h.getConversationKey(i,l)))==null?void 0:J.maxSendReceiptMsgSeq)||0,J=(J==null?void 0:J.maxRecvReceiptMsgSeq)||0,(R.direction==o.K.Send&&D<=G||R.direction==o.K.Receive&&D<=J)&&(j=!0,L.status=o.M.Done,L.readMemberCount=R.direction==o.K.Send?1:0,L.isSelfOperated=L.readMemberCount==0,g.sendSeq=G,g.recvSeq=J)),j||(q&&!q.convReceipt?(L.status=q.receiptStatus,L.readMemberCount=Math.max(q.readMemberCount,0),L.unreadMemberCount=q.unreadMemberCount):(R.receiptStatus==o.M.Processing&&q&&(L.status=q.receiptStatus),l==o.q.Peer&&R.direction==o.K.Send&&(L.status==o.M.Done?L.readMemberCount=1:L.unreadMemberCount=1))))):y.push(R.messageID)):y.push(R.messageID)}),h.dbMgr.addMessageExtraList(M,"updateQueriedMessageID"),g.count=w.length,h.logger.info(n,o.I.QueryReceiptsInfo,g),m({infos:w,errorMessageIDs:y})})})},u.prototype.revokeMessage=function(a,i){var l=this,h=a.conversationType==o.q.Peer?o.c.c2c_msg_revoke:o.c.group_msg_revoke,m={conv_id:a.conversationID,conv_msg_seq:a.conversationSeq,payload:Object(d.i)((i==null?void 0:i.revokeExtendedData)||""),offline_push:Object(d.e)(i==null?void 0:i.pushConfig)};return this.connMgr.sendRequest(h,m).then(function(g){if(g.code)return y=Object(d.s)(o.s.CommonModuleIMServerError,g.message,g.code),l.logger.warn(n,o.I.RevokeMessage,y),Promise.reject(y);var y=Object(d.r)(g.msg_status),w=l.createRevokeMessage(a,{revokeType:o.S.TwoWay,revokeStatus:y.revoke,revokeTimestamp:g.revoke_time,operatedUserID:l.engineConfig.user.userID,revokeExtendedData:(i==null?void 0:i.revokeExtendedData)||"",originalMessageType:a.type,originalTextMessageContent:a.type==o.R.Text?a.message:""});return l.copyMessageProxyField(w),l.saveMessageRevokeExtra(w,g.statemsg_seq,"revokeMessage"),l.logger.info(n,o.I.RevokeMessage,y),{message:w}})},u.prototype.addMessageReaction=function(a,i){var l=this,h=i.conversationType==o.q.Peer?o.c.c2c_add_reaction:o.c.group_add_reaction,m={conv_id:i.conversationID,conv_msg_seq:i.conversationSeq,reaction_key:a,reaction_into_map:((m={})[a]={conv_id:""},m)},g={time:new Date};return this.connMgr.sendRequest(h,m).then(function(y){return r(l,void 0,void 0,function(){var w,M,R,D,q,L=this;return t(this,function(j){switch(j.label){case 0:return y.code||!y.succ_list.length?(q=Object(d.s)(o.s.ConversationModuleServerError,y.message,y.code),g.reactionType=a,g.error=q,this.logger.warn(n,o.I.AddReaction,g),[2,Promise.reject(q)]):(w=this.createMessageReactionExtra(i.conversationID,i.conversationType,i.conversationSeq,i.messageID),M=(M=(q=w.reactions[a])==null?void 0:q.userList)&&M.length?M.filter(function(G){return G.userID!==L.engineConfig.user.userID}):M||[],R=y.succ_list.find(function(G){return G.reaction_key=a}),M.length<this.engineConfig.mailHBConfig.reaction_brief_len?(M.push({userID:this.engineConfig.user.userID,seq:R.cur_reaction_seq}),M.length===R.user_total_count?[3,2]:[4,this.fetchReactionKey(i,a,!1)]):[3,2]);case 1:(D=j.sent()).code||(M=D.user_reaction,R.cur_reaction_seq=D.max_reaction_seq,R.user_total_count=D.total_user_count),j.label=2;case 2:return D={reactionKey:R.reaction_key,reactionSeq:R.cur_reaction_seq,totalCount:R.user_total_count,isSelfIncluded:!0,userList:M},this.saveMessageReactionExtra(w,[D],void 0,!0),g.reactionInfo=D,this.logger.info(n,o.I.AddReaction,g),[2,{reaction:{conversationID:i.conversationID,conversationType:i.conversationType,messageID:i.messageID,totalCount:D.totalCount,isSelfIncluded:!0,reactionType:a,userList:M.map(function(G){return{userID:G.userID}})}}]}})})})},u.prototype.deleteMessageReaction=function(a,i){var l=this,h=i.conversationType==o.q.Peer?o.c.c2c_del_reaction:o.c.group_del_reaction,m={conv_id:i.conversationID,conv_msg_seq:i.conversationSeq,reaction_key:[a]},g={time:new Date};return this.connMgr.sendRequest(h,m).then(function(y){return r(l,void 0,void 0,function(){var w,M,R,D,q,L=this;return t(this,function(j){switch(j.label){case 0:return y.code||!y.succ_list.length?(q=Object(d.s)(o.s.ConversationModuleServerError,y.message,y.code),g.reactionType=a,g.error=q,this.logger.warn(n,o.I.DeleteReaction,g),[2,Promise.reject(q)]):(w=this.createMessageReactionExtra(i.conversationID,i.conversationType,i.conversationSeq,i.messageID),M=(M=(q=w.reactions[a])==null?void 0:q.userList)&&M.length?M.filter(function(G){return G.userID!==L.engineConfig.user.userID}):M||[],R=y.succ_list.find(function(G){return G.reaction_key=a}),M.length<this.engineConfig.mailHBConfig.reaction_brief_len&&M.length!==R.user_total_count?[4,this.fetchReactionKey(i,a,!1)]:[3,2]);case 1:(D=j.sent()).code||(M=D.user_reaction,R.cur_reaction_seq=D.max_reaction_seq,R.user_total_count=D.total_user_count),j.label=2;case 2:return R.user_total_count==0&&(M.length=0),D={reactionKey:R.reaction_key,reactionSeq:R.cur_reaction_seq,totalCount:R.user_total_count,isSelfIncluded:!1,userList:M},this.saveMessageReactionExtra(w,[D],void 0,!0),g.reactionInfo=D,this.logger.info(n,o.I.DeleteReaction,g),[2,{reaction:{conversationID:i.conversationID,conversationType:i.conversationType,messageID:i.messageID,totalCount:D.totalCount,isSelfIncluded:!1,reactionType:a,userList:M.map(function(G){return{userID:G.userID}})}}]}})})})},u.prototype.queryMessageReactionUserList=function(a,i){var l=this,h={time:new Date,total:0,count:0,config:i},m=i.reactionType,g=this.getMsgExtraKey(a.conversationID,a.conversationType,a.conversationSeq),y=this.msgExtraMap.get(g);if(!y||!y.reactions||!y.reactions[m])return g=Object(d.s)(o.s.CommonModuleParamInvalid,"reactionType is invalid"),this.logger.warn(n,o.I.QueryReaction,h),Promise.reject(g);function w(R,D){var q=R.length,L=i.nextFlag||0,j=L+i.count;return R=R.slice(L,j).map(function(G){return{userID:G.userID}}),L=j<q?j:0,h.total=q,h.count=R.length,l.logger.info(n,o.I.QueryReaction,h),{reactionType:m,totalCount:D,nextFlag:L,userList:R,message:a}}g=+y.reactions[m].detailSeq||0;var M=+y.reactions[m].seq||0;return 0<M&&g<M?this.fetchReactionKey(a,m,!0).then(function(R){if(R.code)return D=Object(d.s)(o.s.ConversationModuleServerError,R.message,R.code),l.logger.warn(n,o.I.QueryReaction,h),Promise.reject(D);var D=R.max_reaction_seq,q=R.total_user_count,L=(R={reactionSeq:D,reactionKey:m,totalCount:q,userList:R.user_reaction,isSelfIncluded:!1},l.engineConfig.user.userID);return R.isSelfIncluded=R.userList.some(function(j){return j.userID==L}),y.messageID=a.messageID,l.saveMessageReactionExtra(y,[R],D,!0,!0),w(R.userList,q)}):(g=y.reactions[m].detailUserList||[],Promise.resolve(w(g,g.length)))},u.prototype.onPushMsgDelete=function(a){var i="onPushMsgDelete",l=a.conv_id,h=a.conv_type,m=a.max_del_conv_msg_seq;a.is_del_all&&m?this.createConversationInstance(l,h).onPushAllMsgDelete(m,i):a.del_conv_msg_seqs.length&&this.createConversationInstance(l,h).onPushMsgDelete(a.del_conv_msg_seqs,i)},u.prototype.onPushConvDelete=function(a){var i;a=this.getConversationKey(a.conv_id,a.conv_type),(a=this.dbConvMap.get(a))&&(a.state!=o.p.Delete&&a.maxOrderKey?(this.deleteLocalConv(a),i={event:o.n.Deleted,conversation:Object(d.q)(this.convKeys,a)},this.eventBus.emit(o.t.ConvChanged,{infoList:[i]},"deleteConv")):a.state=o.p.Delete)},u.prototype.onPushConvRead=function(a){var i,l=this,h=a.conv_msg_seq,m=a.read_seq,g=(a=this.getConversationKey(a.conv_id,a.conv_type),this.dbConvMap.get(a));g&&h&&(g.readMsgSeq=Math.max(h,g.readMsgSeq||0),g.sendMsgCount=m,g.state!=o.p.Delete&&g.maxOrderKey&&(a=function(y){g.deletedMsgCount=y;var w="onPushConvRead",M=g.msgSeq||0;(M=Math.max(M-g.readMsgSeq-m-y,0))!=g.unreadMessageCount?(g.unreadMessageCount=M,l.onUnreadMessageCount(w),l.emitConversationUpdated(g,w)):l.dbMgr.addConversationList([g],w+M)},(i=g.deletedMsgSeqs&&g.deletedMsgSeqs.length?g.deletedMsgSeqs.filter(function(y){return h<y}):null)&&i.length?this.dbMgr.getDeleteMessageCount(g.conversationID,g.type,i,a):a(0)))},u.prototype.onPushConvMute=function(a){var i,l,h=this.getConversationKey(a.conv_id,o.q.Group);(h=this.dbConvMap.get(h))&&(i=a.conv_type?o.o.DoNotDisturb:o.o.Notify,h.state!=o.p.Delete&&h.maxOrderKey&&h.notificationStatus!=i?(h.notificationStatus=i,this.emitConversationUpdated(h,l="onPushConvMute"),this.onUnreadMessageCount(l)):h.notificationStatus=i,(l=this.dbGroupMap.get(h.conversationID))&&(l.notificationStatus=a.conv_type?o.G.Disturb:o.G.Notify,this.dbMgr.addGroupList([l])))},u.prototype.onPushConvPinned=function(a){var i=this.getConversationKey(a.conv_id,a.conv_type);(i=this.dbConvMap.get(i))&&(i.state!=o.p.Delete&&i.maxOrderKey&&!i.isPinned!=!a.pinned_type?(i.isPinned=!!a.pinned_type,this.emitConversationUpdated(i,"onPushConvPinned")):i.isPinned=!!a.pinned_type,this.updateConvPinnedListSeq(a.conv_pinned_list_seq))},u.prototype.onPushMessage=function(a,i){var l=a.msg_status||0,h=(a.recv_msg_info.msg_info.msg_status=l,a.recv_msg_info.msg_svr_info),m=a.recv_msg_info.msg_info.conv_id,g=o.q.Peer,y=void 0,w=h.sender_user_id,M=(i=(i==o.c.p_group_msg.cmd?g=o.q.Group:i==o.c.p_room_msg.cmd?(m=m||a.room_id,g=o.q.Room):i==o.c.p_c2c_msg.cmd&&(m=m||w,w&&w!=this.engineConfig.user.userID&&(y=Object(d.f)(h.sender_user_name))),a.send_count_after_read||0),a.recv_msg_info.msg_info.sender_unaware);if(g==o.q.Room||w!=this.engineConfig.user.userID&&!M||this.logger.info(n,o.I.PCMD,{convID:m,type:g,name:y,sendCount:i,senderID:w}),m){var R=this.createConversationInstance(m,g);if(M&&(!w||w==this.engineConfig.user.userID))return R.dbConv.sendMsgCount=i,this.dbMgr.addConversationList([R.dbConv],"sender_unaware:"+i),m;g==o.q.Peer&&w&&w!=this.engineConfig.user.userID&&this.updateConvNameAndAvatar("onPushMessage",R.dbConv,y),(M=this.msgExtraMap.get(this.getMsgExtraKey(m,g,h.conv_msg_seq)))||g!=o.q.Peer||(M=this.msgExtraMap.get(this.getMsgExtraKey(m,g,0))),l&&M&&(M.receiptStatus=Object(d.r)(l).receipt,M.messageID||(M.messageID=h.msg_id),this.dbMgr.addMessageExtraList([M],"onPushMessage")),this.syncConvInfoWhenPushMessage(R,a.recv_msg_info,i,y)}return m},u.prototype.onPushCommand=function(a,i){var l="",h=o.q.Peer;return i==o.c.p_group_command.cmd?(h=o.q.Group,l=a.recv_command_info.command_msg_info.conv_id):i==o.c.p_room_command.cmd?(h=o.q.Room,l=a.room_id):i==o.c.p_c2c_command.cmd&&(i=a.recv_command_info.command_svr_info.sender_user_id,l=a.recv_command_info.command_msg_info.conv_id||i),this.emitReceiveCommandMessage(l,h,a),l},u.prototype.onPushBroadcastMessage=function(a){a=this.transform2Message(a.recv_msg_info,"",o.q.Unknown),this.eventBus.emit(o.t.BroadcastMsg,{message:a})},u.prototype.onPushReadReceipt=function(a){var i=this,l=T.a.fromString("0"),h=a.PushItems.map(function(w){var M=i.createMessageReceiptItemExrta(i.mergeMsgReceiptDBConvMap,w);return i.mergeMsgReceiptMap.set(M.id,M),M=w.receipt_seq||T.a.fromString("0"),i.mergeMsgReceiptSeqs.add(M.toString()),M.greaterThan(l)&&(l=M),M}),m=(a=(h.sort(function(w,M){return w.lessThanOrEqual(M)?-1:1}),h[h.length-1].sub(h[0]).toNumber()==h.length-1),Array.from(this.mergeMsgReceiptMap.values())),g=(this.emitMessageReceiptOrRevoke(m,o.u.SDKPush),h[0]),y=this.engineConfig.user.msgExtraSeq||"0";y=="0"||g.lessThanOrEqual(y)||g.sub(1).toString()==y&&a&&!this.mergeMsgReceiptTimer?(g="pushReadReceipt",this.updateMsgExtraSeq(l),this.dbMgr.addMessageExtraList(m,g),this.dbMgr.addConversationList(Array.from(this.mergeMsgReceiptDBConvMap.values()),g),this.mergeMsgReceiptSeqs.clear(),this.mergeMsgReceiptMap.clear(),this.mergeMsgReceiptDBConvMap.clear(),this.logger.info(n,"mergeMsgReceipt",{dbSeq:y,seqs:h,action:"continuousMerge"})):this.mergeMsgReceiptTimer||(this.mergeMsgReceiptTimer=setTimeout(function(){var w,M;i.logger&&((w=Array.from(i.mergeMsgReceiptSeqs.values()).map(function(R){return T.a.fromString(R)})).sort(function(R,D){return R.lessThanOrEqual(D)?-1:1}),M=w[w.length-1].sub(w[0]).toNumber()==w.length-1,i.logger.info(n,"mergeMsgReceipt",{dbSeq:y,seqs:h,action:"waitingPush",continuous:M,mergeSeqs:w}),M?(M="pushReadReceipt",i.updateMsgExtraSeq(w[w.length-1]),i.dbMgr.addMessageExtraList(Array.from(i.mergeMsgReceiptMap.values()),M),i.dbMgr.addConversationList(Array.from(i.mergeMsgReceiptDBConvMap.values()),M)):i.mergeServerMsgExtraList(o.u.SDKPush),i.mergeMsgReceiptTimer=0,i.mergeMsgReceiptSeqs.clear(),i.mergeMsgReceiptMap.clear(),i.mergeMsgReceiptDBConvMap.clear())},this.engineConfig.mailHBConfig.list_to))},u.prototype.onPushMsgRevoke=function(a){var i=this.createConversationInstance(a.recv_msg_info.msg_info.conv_id,a.conv_type),l=i.dbConv.deletedMsgMaxSeq||0,h=i.dbConv.deletedMsgSeqs||[],m=a.recv_msg_info.msg_svr_info.conv_msg_seq;h.indexOf(m)!=-1||m<=l||(h=i.transform2Message(a.recv_msg_info,!1),this.eventBus.emit(o.t.MsgRevoke,{messageList:[h]}),this.saveMessageRevokeExtra(h,a.statemsg_seq,"pushRevoke"))},u.prototype.onPushReaction=function(a){var i=this,l=a.conv_id,h=a.conv_type,m=new Set,g=this.createConversationInstance(l,h),y=g.dbConv.deletedMsgMaxSeq||0,w=g.dbConv.deletedMsgSeqs||[],M=a.msg_reactions.filter(function(R){var D=R.conv_msg_seq;if(w.indexOf(D)!=-1||D<=y)return!1;var q=i.createMessageReactionExtra(l,h,D);return!(+q.reactionSeq>R.start_reaction_seq||(q.messageID||m.add(D),0))});this.logger.info(n,"pushReaction",{count:M.length}),this.createConversationInstance(l,h).fetchMsgListFromCache(Array.from(m)).then(function(R){M.forEach(function(D){var q=D.conv_msg_seq,L=D.start_reaction_seq,j=D.end_reaction_seq,G=(D=D.reaction_infos,i.createMessageReactionExtra(l,h,q,(q=R.get(q))==null?void 0:q.messageID));G.messageID&&(q=D.map(function(J){var K=J.reaction_key,ee=J.total_user_count,A=J.max_reaction_seq,v=J.is_multi,E=J.include_self,N=!(!G.reactions||!G.reactions[K])&&G.reactions[K].isSelfIncluded;return{reactionSeq:A,reactionKey:K,totalCount:ee||0,userList:J.user_reaction,isSelfIncluded:N=v?E:N,value:""}}),i.saveMessageReactionExtra(G,q,j),+G.reactionSeq+1<L&&i.mergeMessageReactionList(G))})})},u.prototype.onPushConvAllDelete=function(a){this.deleteAllLocalConv(null,+a.conv_sid,!0)},u.prototype.onPushCleanAllUnread=function(a){var i=this,l=+a.conv_sid,h=[];this.convMap.forEach(function(m){m.convType==o.q.Room||+m.dbConv.seq>l||(i.syncConvReadSeqToMsgSeq(m.dbConv,m.dbConv.msgSeq),h.push(m.dbConv))}),a="onPushClearAllUnrc",this.dbMgr.addConversationList(h,a),this.onUnreadMessageCount(a)},u.prototype.registerInnerEvent=function(){this.eventBus.add(o.t.ILogined,this.onLogined.bind(this)),this.eventBus.add(o.t.ILogout,this.onLogout.bind(this)),this.eventBus.add(o.t.ITriggerHB,this.onTriggerHB.bind(this)),this.eventBus.add(o.t.ISyncGroups,this.onSyncGroups.bind(this)),this.eventBus.add(o.t.IJoinedGroup,this.onJoinedGroup.bind(this)),this.eventBus.add(o.t.ILeftGroup,this.onLeftGroup.bind(this)),this.eventBus.add(o.t.ISyncGroupInfo,this.onSyncGroupInfo.bind(this)),this.eventBus.add(o.t.IUnreadMsgCount,this.onUnreadMessageCount.bind(this)),this.eventBus.add(o.t.IConnectedRoom,this.onConnectedRoom.bind(this))},u.prototype.onSyncGroups=function(a){var i=this,l=(this.isLogined=!1,a?o.u.SDKHb:o.u.SDKLogin),h=a?"onConnected":"onLogined";a&&(this.mergeServerMsgExtraList(l,h),this.mergeServerMsgStateList(l,h)),this.mergeServerPinnedList(l,h,function(m){i.mergeServerConvList(l,h,function(g,y){var w,M={_action_:!(i.isLogined=!0)},R=g.filter(function(q){var L,j,G,J,K=q.id,ee=!1;return m&&(G=m.indexOf(K)!=-1,!q.isPinned!=!G&&(q.isPinned=G,y.has(K)||y.set(K,o.n.Updated),ee=!0)),q.type==o.q.Group&&((G=i.dbGroupMap.get(q.conversationID))?(L=G.notificationStatus,J=G.groupName,j=G.groupAvatarUrl,G=G.tatalMemberCount,q.state=o.p.Normal,typeof J=="string"&&(q.conversationName=J),typeof j=="string"&&(q.conversationAvatarUrl=j),q.notificationStatus!=L&&(q.notificationStatus=L,y.has(K)||y.set(K,o.n.Updated)),q.conversationName||q.conversationAvatarUrl||(M._action_=!0,M[q.conversationID]=L+","+G),ee=!0):q.state!=o.p.Disable&&(q.state=o.p.Disable,(J=y.has(K)?y.get(K):o.n.Disabled)!=o.n.Deleted&&(J=o.n.Disabled),y.set(K,J),M._action_=!0,M[q.conversationID]="state:Disable",ee=!0)),ee}),D="onSyncGroups"+y.size;i.dbMgr.addConversationList(R,D),y.size&&(w=[],y.forEach(function(q,L){L=Object(d.q)(i.convKeys,i.dbConvMap.get(L)),w.push({event:q,conversation:L}),i.stgyMgr.modifyConversation(L.conversationID,L.type,q,o.a.FetchAll)}),i.eventBus.emit(o.t.ConvChanged,{infoList:w},D)),i.onUnreadMessageCount(D,g),M._action_&&(i.logger.info(n,D,M),M._action_=D,i.dataReport.reportSDKEvent("/sdk/log",{error_message:JSON.stringify(M)})),i.queryConvsCallbackList.forEach(function(q){return i.handleQueryConvsCallback(g,q)}),i.queryConvsCallbackList.length=0,g.slice(0,30).forEach(function(q){a&&q.type==o.q.Room||i.createConversationInstance(q.conversationID,q.type).mergeServerMessageList(l,h)}),a||(i.dbMgr.loadDB(),i.fetchDeletedPeerConvMsgs())})})},u.prototype.onLogined=function(a){var i=this,l=a.users,h=a.convs,m=a.groups;a=a.msgs,l.forEach(function(g){return i.dbUserMap.set(g.userID,g)}),m.forEach(function(g){return i.dbGroupMap.set(g.groupID,g)}),a.forEach(function(g){return i.msgExtraMap.set(g.id,g)}),l=this.engineConfig.user,this.dbUserMap.has(l.userID)&&this.dbUserMap.set(l.userID,l),m=h.map(function(g){return i.dbConvMap.set(g.id,g),{conversationID:g.conversationID,conversationType:g.type,conversationOrderKey:g.orderKey,todoFlag:0}}),this.stgyMgr.start(),this.stgyMgr.initConversations(m),setTimeout(function(){i.mergeServerMsgExtraList(o.u.SDKLogin),i.mergeServerMsgStateList(o.u.SDKLogin)},1e3)},u.prototype.onLogout=function(a){this.dbConvMap.clear(),this.dbGroupMap.clear(),this.msgExtraMap.clear(),this.groupMgr.clearRoomMessage(),a!==!0&&(this.convMap.forEach(function(i){return i.destroy()}),this.convMap.clear(),this.dbUserMap.clear(),this.svrConvInfoMap.clear(),this.msgReceiptChangedMap.clear(),this.isLogined=!1,this.stgyMgr.stop())},u.prototype.onTriggerHB=function(){this.mergeServerMsgExtraList(o.u.SDKHb,"hb"),this.mergeServerMsgStateList(o.u.SDKHb,"hb"),this.groupMgr.mergeServerGroupList(o.u.SDKHb,"hb")},u.prototype.onJoinedGroup=function(a,i,l,h){var m=((a=this.createConversationInstance(a,o.q.Group).dbConv).state==o.p.Disable&&(a.state=o.p.Normal),"onJoinedGroup");this.updateConvNameAndAvatar(m,a,i,l),h&&(a.msgSeq=h,this.syncConvReadSeqToMsgSeq(a,h),this.dbMgr.addConversationList([a],m+h))},u.prototype.onLeftGroup=function(a){var i,l=this.createConversationInstance(a,o.q.Group);l.dbConv.maxOrderKey&&(i=l.dbConv.msgSeq||0,l.dbConv.state!=o.p.Delete&&(l.dbConv.state=o.p.Disable,this.connMgr.sendRequest(o.c.usermail_update_read_seq,{conv_id:a,conv_type:2,read_seq:i},o.i.SDK)),this.syncConvReadSeqToMsgSeq(l.dbConv,i),this.dbMgr.addConversationList([l.dbConv],a="onLeftGroup"),i={event:o.n.Disabled,conversation:Object(d.q)(this.convKeys,l.dbConv)},this.eventBus.emit(o.t.ConvChanged,{infoList:[i]},a),this.onUnreadMessageCount(a))},u.prototype.onSyncGroupInfo=function(a,i,l){var h=this.createConversationInstance(a,o.q.Group);this.updateConvNameAndAvatar("onSyncGroupInfo",h.dbConv,i,l),a={userID:a,userName:i,userAvatarUrl:l},this.emitConvInfo([{user:a,dbConv:h.dbConv}])},u.prototype.onUnreadMessageCount=function(a,i){var l=this,h=o.o.DoNotDisturb,m=0;i?i.forEach(function(g){g.notificationStatus!=h&&(m+=g.unreadMessageCount)}):this.convMap.forEach(function(g){g.dbConv.notificationStatus!=h&&l.filterValidConv(g.dbConv)&&(m+=g.dbConv.unreadMessageCount)}),this.oldTotalUnreadCount!=m&&(this.oldTotalUnreadCount=m,this.eventBus.emit(o.t.ConvUnreadMsgCount,{totalUnreadMessageCount:m},a))},u.prototype.onConnectedRoom=function(a,i){(a=this.convMap.get(this.getConversationKey(a,o.q.Room)))&&(i||this.setAssociatedGroup(a,a.convID,a.convType),a.mergeServerMessageList(o.u.SDKHb,i?"rhb":"onConnected",i))},u.prototype.fetchDeletedPeerConvMsgs=function(){var a=this;this.dbConvMap.forEach(function(i){i.state==o.p.Delete&&i.type==o.q.Peer&&a.createConversationInstance(i.conversationID,i.type).mergeServerMessageList(o.u.SDKLogin,"onLoginedWithDeleted")})},u.prototype.syncConvInfoWhenPushMessage=function(a,i,l,h){var m,g=this,y=a.dbConv,w=y.conversationID;y.type==o.q.Peer?this.svrConvInfoMap.get(w)||this.dbUserMap.has(w)||y.maxOrderKey&&y.state!=o.p.Delete?(m=this.dbUserMap.get(w),typeof h=="string"&&m&&m.userName!=h&&(m.userName=h,this.dbMgr.setUser(m)),a.onPushMessage(i,l)):this.connMgr.sendRequest(o.c.fetch_user_info,{_ev_:"onPushMessage",quey_user_id:[w]},o.i.SDK).then(function(M){var R,D;(M=M.result&&M.result[0])&&(R=Object(d.f)(M.user_name),M=Object(d.f)(M.avatar),y.conversationName=R,y.conversationAvatarUrl=M,g.dbMgr.addConversationList([y],"onSyncConvInfo"),(D=g.dbUserMap.get(w)||{userID:w,userName:R,userAvatarUrl:M}).userName=R,D.userAvatarUrl=M,g.dbUserMap.set(w,D),g.dbMgr.setUser(D),g.emitConvInfo([{user:D,dbConv:y}])),a.onPushMessage(i,l)}):a.onPushMessage(i,l)},u.prototype.getConversationKey=function(a,i){return this.engineConfig.user.userID+(i||0)+a},u.prototype.getMsgExtraKey=function(a,i,l){return this.engineConfig.user.userID+(i||0)+a+(l||"")},u.prototype.getDBConversation=function(a,i,l){return i=this.dbConvMap.get(a)||{id:a,ownerID:this.engineConfig.user.userID,conversationID:i,type:l,conversationName:"",conversationAvatarUrl:"",notificationStatus:o.o.Notify,orderKey:0,isPinned:!1,unreadMessageCount:0,seq:"0",state:o.p.Normal,maxSeq:0,maxOrderKey:0,msgSeq:0,readMsgSeq:0,sendMsgCount:0,deletedMsgCount:0,deletedMsgMaxSeq:0,deletedMsgSeqs:[],maxSendReceiptMsgSeq:0,maxRecvReceiptMsgSeq:0,minStatemsgSeq:0,maxStatemsgSeq:0},this.dbConvMap.set(a,i),i},u.prototype.copyMessageProxyField=function(a){a.reactions&&(a.reactions=JSON.parse(JSON.stringify(a.reactions)))},u.prototype.initDBConversationFields=function(a,i){Object.assign(a,{conversationName:"",conversationAvatarUrl:"",isPinned:!1,notificationStatus:o.o.Notify,maxSeq:0,maxOrderKey:i*o.l.MESSAGE_SEQ_MULTIPLIER,deletedMsgMaxSeq:0,deletedMsgSeqs:[],maxSendReceiptMsgSeq:0,maxRecvReceiptMsgSeq:0,minStatemsgSeq:0,maxStatemsgSeq:a.maxStatemsgSeq||0})},u.prototype.createConversationInstance=function(a,i){var l=this.getConversationKey(a,i),h=this.convMap.get(l);return h||(h=new(i===o.q.Peer?I:i===o.q.Group?p:k).a(a,this.engineConfig,this.eventBus,this.dbMgr,this.connMgr,this),this.convMap.set(l,h),l=this.getDBConversation(l,a,i),i===o.q.Peer&&this.engineConfig.user.userID===a&&(l.state=o.p.Disable,l.conversationName=this.engineConfig.user.userName,l.conversationAvatarUrl=this.engineConfig.user.userAvatarUrl),h.setDBConv(l)),h.setDBUser(this.dbUserMap.get(a)),this.setAssociatedGroup(h,a,i),this.updateConvNameAndAvatar("createConversationInstance",h.dbConv),h},u.prototype.emitConvInfo=function(a){var i=this,l=[],h=[];a.forEach(function(m){var g,y,w=m.user;(m=m.dbConv)&&m.state==o.p.Normal&&(g=!1,y=w.userName,w=w.userAvatarUrl,typeof y=="string"&&m.conversationName!=y&&(g=!0,m.conversationName=y,l.push(m)),typeof w=="string"&&m.conversationAvatarUrl!=w&&(g=!0,m.conversationAvatarUrl=w),g&&(l.push(m),m.maxOrderKey&&h.push({event:o.n.Updated,conversation:Object(d.q)(i.convKeys,m)})))}),a="onSyncConvInfo",this.dbMgr.addConversationList(l,a),h.length&&this.eventBus.emit(o.t.ConvChanged,{infoList:h},a)},u.prototype.emitConversationUpdated=function(a,i){this.dbMgr.addConversationList([a],i),a.state!=o.p.Delete&&(a={event:o.n.Updated,conversation:Object(d.q)(this.convKeys,a)},this.eventBus.emit(o.t.ConvChanged,{infoList:[a]},i))},u.prototype.emitReceiveCommandMessage=function(a,i,l){var h,m,g;a&&(h=l.msg_info,i!=o.q.Room&&(h=l.recv_command_info.command_msg_info,g=(l=l.recv_command_info.command_svr_info).sender_user_id,m=l.msg_id,l=l.msg_time,h.sender_user_id=g,h.msg_id=m,h.msg_time=l),g=i===o.q.Peer?o.t.RecvPeerMsg:i===o.q.Group?o.t.RecvGroupMsg:o.t.RecvRoomMsg,this.eventBus.emit(g,{messageList:[this.transform2Command(a,i,h)],fromConversationID:a}))},u.prototype.emitMessageDelete=function(a){var i=this,l="emitMessageDelete";a.forEach(function(h,m){var g=+m[0],y=(m=m.substring(1),i.logger.info(n,l,{convID:m,type:g,seqs:h.join()}),h.shift());0<h.length&&0<(h=y?h.filter(function(w){return y<w}):h).length&&i.createConversationInstance(m,g).onPushMsgDelete(h,l),0<y&&i.createConversationInstance(m,g).onPushAllMsgDelete(y,l)})},u.prototype.emitMessageReceiptOrRevoke=function(a,i){var l=this,h=typeof i=="boolean",m=i===o.u.SDKPush,g=new Map,y=(a.forEach(function(L){var j=L.conversationType+L.conversationID,G=g.get(j)||new Set;G.add(L.conversationSeq),g.set(j,G)}),[]),w=[],M=[],R=[],D=new Map,q=[];g.forEach(function(L,j){var G=j.substring(1),J=+j[0],K=l.createConversationInstance(G,J);L=K.fetchMsgListFromCache(Array.from(L)).then(function(ee){a.forEach(function(A){if(A.conversationID==G&&A.conversationType===J){var v=ee.get(A.conversationSeq);if(v){A.messageID||(A.messageID=v.messageID,R.push(A));var E=[],N=l.dbConvMap.get(l.getConversationKey(G,J)),P=N==null?void 0:N.lastMessage,H=A.receiptStatus;if(A.revokeInfo||!H||h&&H==v.receiptStatus||(l.selfReceiptSeqs.indexOf(A.receiptSeq)==-1&&(A.convReceipt?y.push(A):A.readMemberCount!=0&&w.push(A)),!v.receiptStatus||A.convReceipt&&v.direction!=o.K.Receive||(v.receiptStatus=H,E.push(v),P&&P.messageID==v.messageID&&P.receiptStatus!=H&&(P.receiptStatus=H,D.set(j,N)))),h&&v.type!==o.R.Revoke&&A.revokeInfo){if(H=l.createRevokeMessage(v,JSON.parse(A.revokeInfo)),E.push(H),M.push(H),!N)return;v.direction==o.K.Receive&&0<N.unreadMessageCount&&v.conversationSeq>N.readMsgSeq&&(++N.deletedMsgCount,--N.unreadMessageCount,D.set(j,N)),P&&P.messageID==v.messageID&&P.type!=o.R.Revoke&&(N.lastMessage=H,D.set(j,N))}K.updateMsgCacheList(E),l.dbMgr.addMessageList(G,J,E)}}})}),q.push(L)}),Promise.all(q).then(function(){var L,j,G;l.dbMgr.addMessageExtraList(R,"fetchMessageID"),y.length&&(L=l.mapMessageExtra2ReceiptInfo(y,m)).length&&l.eventBus.emit(o.t.ConvMsgReceipt,{infos:L}),!w.length||h&&i!==!0||(L=l.mapMessageExtra2ReceiptInfo(w,m)).length&&l.eventBus.emit(o.t.MsgReceipt,{infos:L}),M.length&&l.eventBus.emit(o.t.MsgRevoke,{messageList:M}),D.size&&(L="emitReceiptOrRevoke:"+i,G=(j=Array.from(D.values())).map(function(J){return{event:o.n.Updated,conversation:Object(d.q)(l.convKeys,J)}}),l.eventBus.emit(o.t.ConvChanged,{infoList:G},L),l.onUnreadMessageCount(L),l.dbMgr.addConversationList(j,L))})},u.prototype.mapMessageExtra2ReceiptInfo=function(a,i){var l=this,h=[];return a.forEach(function(m){var g;m.messageID&&(g=m.messageID+m.receiptSeq,i&&l.msgReceiptChangedMap.set(g,!0),!i&&l.msgReceiptChangedMap.get(g)||(g=Math.max(m.readMemberCount,0),h.push({conversationID:m.conversationID,conversationType:m.conversationType,messageID:m.messageID,status:m.receiptStatus,readMemberCount:g,unreadMemberCount:m.unreadMemberCount,isSelfOperated:!(!m.convReceipt||g!=0)})))}),h},u.prototype.handleQueryConvsCallback=function(a,i){var l,h=this,m=i.isPinned,g=i.config,y=i.log,w=(i=i.resolve,(a=m?a.filter(function(D){return D.isPinned}):a).length),M=g.count,R=0;(g=g.nextConversation)&&g.conversationID&&(l=this.getConversationKey(g.conversationID,g.type),R=a.findIndex(function(D){return D.id==l})+1),g=R+M,a=a.slice(R,g),Object.assign(y,{start:R,end:g,total:w,count:a.length}),M=m?o.I.QueryPinnedList:o.I.QueryConvList,this.logger.info(n,M,y),i({conversationList:a.map(function(D){return Object(d.q)(h.convKeys,D)})})},u.prototype.mergeServerConvList=function(a,i,l){var h,m=this,g=T.a.fromString(this.engineConfig.user.convSeq||"0"),y=this.engineConfig.mailHBConfig.conv_list_seq,w=this.engineConfig.mailHBConfig.fetch_conv_list;if(!w||!y||y.lessThanOrEqual(g))return(h=Array.from(this.dbConvMap.values()).filter(function(j){var G=m.filterValidConv(j);return G&&m.createConversationInstance(j.conversationID,j.type),G})).sort(d.d),l(h,new Map);var M={time:new Date,dbSeq:g,hbSeq:y,how:a,action:i,fetch:w,logined:this.isLogined},R=1,D=++this.mergeListSeqs.conv,q=new Map,L=function(j){j.list.forEach(function(G){G.type!=o.q.Room&&q.set(G.id,G)}),j.nextFlag&&m.engineConfig.token?m.fetchServerPageConv(j.nextFlag,++R,a,j.full_list?1:0).then(L):(j.degree=R,j.svrCount=q.size,m.engineConfig.user.preVersion=m.sdk_ver,m.updateConvSeq(j.cur,!0),M.dataReport=m.dataReport.endNetworkRequest(o.c.usermail_convlist.cmd,D,j),m.saveConversationList(q,j.full_list,M,l))};this.fetchServerPageConv(g,R,a,0).then(L)},u.prototype.mergeServerPinnedList=function(a,i,l){var h=this,m=+this.engineConfig.user.convPinnedSeq||0,g=this.engineConfig.mailHBConfig.conv_pinned_list_seq;if(g<=m)return l();var y={time:new Date,dbSeq:m,hbSeq:g,how:a,action:i,logined:this.isLogined},w=1,M=++this.mergeListSeqs.pinned,R=[],D=function(q){var L;q.list.forEach(function(j){R.push(h.getConversationKey(j.conv_id,j.conv_type))}),q.nextFlag&&h.engineConfig.token?h.fetchServerPageConvPinned(q.nextFlag,++w,q.full_list?1:0).then(D):(q.degree=w,q.svrCount=R.length,h.updateConvPinnedListSeq(+((L=q.cur)==null?void 0:L.toString()),!0),L=o.c.usermail_convpinnedlist.cmd,y.dataReport=h.dataReport.endNetworkRequest(L,M,q),h.logger.info(n,"mergeSvrConvPinned",y),l(R))};this.fetchServerPageConvPinned(m,w,0).then(D)},u.prototype.mergeMessageReactionList=function(a){var i=this,l=++this.mergeListSeqs.msgReaction,h=[],m=1,g={time:new Date,dataReport:null},y=function(w){return r(i,void 0,void 0,function(){var M,R,D,q;return t(this,function(L){return w.code||(M=w.msg_next_reaction_seq,R=w.msg_max_reaction_seq,q=w.fetch_end,D=w.reaction_list,q?(D.forEach(function(j){h.push({reactionSeq:j.max_reaction_seq,reactionKey:j.reaction_key,totalCount:j.total_user_count,userList:j.user_reaction,isSelfIncluded:j.include_self})}),this.saveMessageReactionExtra(a,h,R),w.degree=m,w.svrCount=h.length,q=a.conversationType==o.q.Peer?o.c.c2c_reaction_list:o.c.group_reaction_list,g.dataReport=this.dataReport.endNetworkRequest(q.cmd,l,w),this.logger.info(n,"mergeSvrMsgReactions",g)):this.fetchServerPageMsgReaction(a,M,++m).then(y)),[2]})})};this.fetchServerPageMsgReaction(a,a.reactionSeq,m).then(y)},u.prototype.mergeServerMsgExtraList=function(a,i,l){var h=this,m=T.a.fromString(this.engineConfig.user.msgExtraSeq||"0"),g=this.engineConfig.mailHBConfig.extra_msg_list_seq;if(!g||g.lessThanOrEqual(m))return l&&l();var y={time:new Date,dbSeq:m,hbSeq:g,how:a,action:i},w=1,M=m,R=0,D=++this.mergeListSeqs.msgExtra,q=new Map,L=new Map,j=new Map,G=function(J){J.list||(J.list=[]),M=J.next_list_seq||M;var K,ee=J.fetch_end||J.code&&J.code!=6000104?0:M;R+=J.list.length,J.list.forEach(function(A){var v,E;A.type==1?(v=h.createMessageReceiptItemExrta(L,A),q.set(v.id,v)):A.type!=2&&A.type!=3||(v=A.conv_type+A.conv_id,E=j.get(v)||[0],j.set(v,E),A.type==2?E.push.apply(E,function(N,P,H){if(H||arguments.length===2)for(var V,W=0,B=P.length;W<B;W++)!V&&W in P||((V=V||Array.prototype.slice.call(P,0,W))[W]=P[W]);return N.concat(V||Array.prototype.slice.call(P))}([],function(N,P){var H=typeof Symbol=="function"&&N[Symbol.iterator];if(!H)return N;var V,W,B=H.call(N),$=[];try{for(;(P===void 0||0<P--)&&!(V=B.next()).done;)$.push(V.value)}catch(X){W={error:X}}finally{try{V&&!V.done&&(H=B.return)&&H.call(B)}finally{if(W)throw W.error}}return $}(A.del_conv_msg_seqs),!1)):E[0]=Math.max(E[0],A.del_conv_msg_seqs[0]))}),ee&&h.engineConfig.token?h.fetchServerPageMsgExtra(ee,++w,a).then(G):(J.degree=w,J.svrCount=R,ee=Array.from(q.values()),K="mergeMsgExtra"+a,h.updateMsgExtraSeq(M,!0),h.dbMgr.addMessageExtraList(ee,K),h.dbMgr.addConversationList(Array.from(L.values()),K),h.emitMessageReceiptOrRevoke(ee,a),h.emitMessageDelete(j),y.dataReport=h.dataReport.endNetworkRequest(o.c.extra_msglist.cmd,D,J),h.logger.info(n,"mergeSvrMsgExtras",y),l&&l())};this.fetchServerPageMsgExtra(m,w,a).then(G)},u.prototype.mergeServerMsgStateList=function(a,i,l,h,m,g){var y=this,w=(i===void 0&&(i=""),l===void 0&&(l=0),h===void 0&&(h=0),m===void 0&&(m=0),g?g.conversationID:"");if(l=w?T.a.fromNumber(l):T.a.fromString(this.engineConfig.user.c2cMsgStateSeq||"0"),!w){var M=this.engineConfig.mailHBConfig.c2c_statemsg_seq;if(!M||M.lessThanOrEqual(l))return;h=1,m=this.engineConfig.mailHBConfig.c2c_msg_seq}var R={time:new Date,dbSeq:l,how:a,action:i,minMsgSeq:h,maxMsgSeq:m},D=1,q=l,L=0,j=++this.mergeListSeqs.msgState,G=new Map,J=function(K){K.statemsg_list||(K.statemsg_list=[]),q=K.next_statemsg_seq||q;var ee=K.fetch_end||K.code&&K.code!=6000104?0:q;L+=K.statemsg_list.length;for(var A,v=0;v<K.statemsg_list.length;v++){var E,N,P,H,V=K.statemsg_list[v],W=V.conv_id,B=V.conv_type,$=V.conv_msg_seq,X=y.createConversationInstance(W,B),ne=X.dbConv.deletedMsgMaxSeq||0;(X.dbConv.deletedMsgSeqs||[]).indexOf($)!=-1||$<=ne||(ne=(X=Object(d.r)(V.msg_status)).revoke,X=(E=!!V.revoke_time)?o.M.None:X.receipt,N=V.reaction_seq,P=y.getMsgExtraKey(W,B,$),(H=y.msgExtraMap.get(P))||!N&&!E&&X!=o.M.Expired&&X!=o.M.Failed||((H=y.createMessageReceiptExrta(P,W,B,$)).receiptStatus=X,H.reactionSeq=0,H.reactions={}),H&&(+H.reactionSeq<N&&y.handleMsgStateReactionBriefs(H,V.reaction_briefs),E?(H.receiptStatus=o.M.None,W=V.msg_type,H.revokeInfo=JSON.stringify({revokeType:V.revoke_type,revokeStatus:ne,revokeTimestamp:V.revoke_time,operatedUserID:V.user_id,revokeExtendedData:Object(d.f)(V.payload),originalMessageType:200<=W&&W<=400?o.R.Custom:W,originalTextMessageContent:""})):X&&(H.receiptStatus=H.readMemberCount==-1?o.M.Done:X),G.set(P,H)))}ee&&y.engineConfig.token?y.fetchServerPageMsgState(ee,++D,a,w,h,m).then(J):(K.degree=D,K.svrCount=L,ee="mergeMsgState"+a,g?(g.minStatemsgSeq=+q.toString(),g.maxStatemsgSeq=g.minStatemsgSeq,y.dbMgr.addConversationList([g],ee)):y.updateC2CMsgStateSeq(q,!0),A=Array.from(G.values()),y.emitMessageReceiptOrRevoke(A,a!=o.u.Other),y.dbMgr.addMessageExtraList(A,ee),A=(w?o.c.group_msg_state_list:o.c.c2c_msg_state_list).cmd,R.count=G.size,R.dataReport=y.dataReport.endNetworkRequest(A,j,K),y.logger.info(n,"mergeSvrMsgStates",R))};this.fetchServerPageMsgState(l,D,a,w,h,m).then(J)},u.prototype.fetchServerPageConv=function(a,i,l,h){var m=this,g=o.c.usermail_convlist;return a={conv_list_seq:a,count:100,full_pull:h,degree:i,how:l},i==1&&this.dataReport.beginNetworkRequest(g.cmd,this.mergeListSeqs.conv,o.i.SDK,a),this.connMgr.sendRequest(g,a,o.i.SDK).then(function(y){if(y.code)return{list:[]};var w=y.conv_list_seq,M=y.max_list_seq,R=y.full_list,D=y.fetch_end,q=D||w&&M&&w.greaterThanOrEqual(M)?0:w,L={_action_:!1};return y=y.conv_list.map(function(j){var G=m.transform2DBConv(j),J=j.is_del,K=j.last_msg_del,ee=j.last_msg;return!J&&!K&&G.orderKey||(L[j.conv_id]={orderKey:G.orderKey,is_del:J,last_msg_del:K,last_msg:ee},L._action_=!0),G}),L._action_&&m.logger.info(n,"fetchSvrConv",L),{nextFlag:q,cur:w,max:M,list:y,full_list:M?R:0,fetch_end:D}})},u.prototype.fetchServerPageConvPinned=function(a,i,l){var h=o.c.usermail_convpinnedlist;return a={conv_list_seq:a,count:100,full_pull:l,degree:i},i==1&&this.dataReport.beginNetworkRequest(h.cmd,this.mergeListSeqs.pinned,o.i.SDK,a),this.connMgr.sendRequest(h,a,o.i.SDK).then(function(m){if(m.code)return{list:[]};var g=m.conv_list_seq,y=m.max_list_seq,w=m.full_list,M=m.fetch_end;return{nextFlag:M||g&&y&&g.greaterThanOrEqual(y)?0:g,cur:g,max:y,list:m.conv_list,full_list:w,fetch_end:M}})},u.prototype.fetchServerPageMsgExtra=function(a,i,l){var h=o.c.extra_msglist;return a={list_seq:a,count:100,degree:i,how:l},i==1&&this.dataReport.beginNetworkRequest(h.cmd,this.mergeListSeqs.msgExtra,o.i.SDK,a),this.connMgr.sendRequest(h,a,o.i.SDK)},u.prototype.fetchServerPageMsgState=function(a,i,l,h,m,g){return a={statemsg_seq:a,count:100,degree:i,how:l,min_msg_seq:m,max_msg_seq:g},h&&(a.conv_id=h),l=h?o.c.group_msg_state_list:o.c.c2c_msg_state_list,i==1&&this.dataReport.beginNetworkRequest(l.cmd,this.mergeListSeqs.msgState,o.i.SDK,a),this.connMgr.sendRequest(l,a,o.i.SDK)},u.prototype.fetchServerPageMsgReaction=function(a,i,l){var h=a.conversationType==o.q.Peer?o.c.c2c_reaction_list:o.c.group_reaction_list;return a={conv_id:a.conversationID,conv_msg_seq:a.conversationSeq,start_reaction_seq:i,degree:l},l==1&&this.dataReport.beginNetworkRequest(h.cmd,this.mergeListSeqs.msgReaction,o.i.SDK,a),this.connMgr.sendRequest(h,a)},u.prototype.fetchReactionKey=function(a,i,l){var h=a.conversationType==o.q.Peer?o.c.c2c_get_reaction:o.c.group_get_reaction;return a={conv_id:a.conversationID,conv_msg_seq:a.conversationSeq,reaction_key:i,max_reaction_seq:0,is_detail:l},this.connMgr.sendRequest(h,a,l?o.i.API:o.i.SDK)},u.prototype.createMessageReceiptExrta=function(a,i,l,h){return i=this.msgExtraMap.get(a)||{id:a,ownerID:this.engineConfig.user.userID,conversationID:i,conversationType:l,conversationSeq:h,messageID:"",convReceipt:0,receiptStatus:o.M.Processing,receiptSeq:"0",receiptMemberListSeq:0,readMemberCount:0,unreadMemberCount:0,memberSeqs:{}},this.msgExtraMap.set(a,i),i},u.prototype.createMessageReceiptItemExrta=function(a,i){var l=i.conv_id,h=i.conv_type,m=i.conv_msg_seq,g=i.receipt_seq.toString(),y=i.read_count,w=i.unread_count,M=y==-1,R=(i=i.is_conv_read,this.getMsgExtraKey(l,h,i?0:m));return(R=this.createMessageReceiptExrta(R,l,h,m)).receiptSeq&&T.a.fromString(R.receiptSeq).greaterThan(g)||(R.conversationSeq=m,R.receiptSeq=g,R.readMemberCount=y,R.unreadMemberCount=w,R.convReceipt=i?1:0,(i||M||0<y&&w==0)&&(R.receiptStatus=o.M.Done),i&&(R.messageID="",m=a.get(l)||this.createConversationInstance(l,h).dbConv,g=R.conversationSeq,y=m.maxSendReceiptMsgSeq||0,w=m.maxRecvReceiptMsgSeq||0,M&&w<g?m.maxRecvReceiptMsgSeq=g:!M&&y<g&&(m.maxSendReceiptMsgSeq=g),a.set(l,m))),R},u.prototype.createRevokeMessage=function(a,i){return c({message:"",type:o.R.Revoke,localMessageID:a.localMessageID,messageID:a.messageID,senderUserID:a.senderUserID,timestamp:a.timestamp,conversationID:a.conversationID,conversationType:a.conversationType,direction:a.direction,sentStatus:a.sentStatus,orderKey:a.orderKey,conversationSeq:a.conversationSeq,receiptStatus:o.M.None},i)},u.prototype.saveMessageRevokeExtra=function(a,i,l){var h=[a],m=this.createConversationInstance(a.conversationID,a.conversationType),g=(h=(m.updateMsgCacheList(h),this.dbMgr.addMessageList(a.conversationID,a.conversationType,h),m.dbConv.lastMessage),!1);a.direction==o.K.Receive&&0<m.dbConv.unreadMessageCount&&a.conversationSeq>m.dbConv.readMsgSeq&&(g=!0,++m.dbConv.deletedMsgCount,--m.dbConv.unreadMessageCount,this.onUnreadMessageCount(l)),(h==null?void 0:h.messageID)==a.messageID&&(g=!0,m.dbConv.lastMessage=a),g&&this.emitConversationUpdated(m.dbConv,l),h=!1,a.conversationType==o.q.Peer?(i.sub(1).toString(),this.engineConfig.user.c2cMsgStateSeq,this.updateC2CMsgStateSeq(i),h=!0):a.conversationType==o.q.Group&&(g=+m.dbConv.maxStatemsgSeq||0,i.greaterThan(g)&&(m.dbConv.maxStatemsgSeq=+i.toString()),g=+m.dbConv.minStatemsgSeq||0,i.toNumber()==g+1&&(m.dbConv.minStatemsgSeq=+i.toString(),h=!0)),h&&(g=this.getMsgExtraKey(a.conversationID,a.conversationType,a.conversationSeq),(m=this.msgExtraMap.get(g))||(m={id:g,ownerID:this.engineConfig.user.userID,conversationID:a.conversationID,conversationType:a.conversationType,conversationSeq:a.conversationSeq},this.msgExtraMap.set(g,m)),m.messageID=a.messageID,m.revokeInfo=JSON.stringify({revokeType:a.revokeType,revokeStatus:a.revokeStatus,revokeTimestamp:a.revokeTimestamp,operatedUserID:a.operatedUserID,revokeExtendedData:a.revokeExtendedData,originalMessageType:a.originalMessageType,originalTextMessageContent:a.originalTextMessageContent}),this.dbMgr.addMessageExtraList([m],l))},u.prototype.createMessageReactionExtra=function(a,i,l,h){h===void 0&&(h="");var m=this.getMsgExtraKey(a,i,l),g=this.msgExtraMap.get(m);return g||(g={id:m,ownerID:this.engineConfig.user.userID,conversationID:a,conversationType:i,conversationSeq:l,messageID:h,reactionSeq:0,reactions:{}},this.msgExtraMap.set(m,g)),g.reactions||(g.reactions={}),h&&!g.messageID&&(g.messageID=h),g},u.prototype.saveMessageReactionExtra=function(a,i,l,h,m){var g="saveReactionExtra",y=[],w=this.engineConfig.mailHBConfig.reaction_brief_len;if(this.logger.info(n,g,{reactionInfoList:i,maxReactionSeq:l,noEmit:h,isDetail:m}),l&&l<=a.reactionSeq&&!m)return[];if(l&&(a.reactionSeq=l),i.forEach(function(q){var L=m?q.reactionSeq:((L=a.reactions[q.reactionKey])==null?void 0:L.detailSeq)||0,j=((j=a.reactions[q.reactionKey])==null?void 0:j.userList)||[],G=((G=a.reactions[q.reactionKey])==null?void 0:G.detailUserList)||[],J=q.userList.length==0&&q.totalCount>w||m?j:q.userList;if(G=m?q.userList:G,m&&(J=G.slice(0,w)),!(a.reactions[q.reactionKey]&&q.reactionSeq<a.reactions[q.reactionKey].seq)){if(j=!Object(d.a)(J,j)||q.totalCount!==((j=a.reactions[q.reactionKey])==null?void 0:j.totalCount),+q.reactionSeq>+(a.reactionSeq||0)&&(a.reactionSeq=q.reactionSeq),q.totalCount==0)delete a.reactions[q.reactionKey];else{if(q.totalCount>w&&J.length<w)return;a.reactions[q.reactionKey]={seq:q.reactionSeq,detailSeq:L,value:"",totalCount:q.totalCount,userList:J,detailUserList:G,isSelfIncluded:q.isSelfIncluded}}j&&y.push({conversationID:a.conversationID,conversationType:a.conversationType,messageID:a.messageID,reactionType:q.reactionKey,totalCount:q.totalCount,isSelfIncluded:q.isSelfIncluded,userList:J.map(function(K){return{userID:K.userID}})})}}),this.dbMgr.addMessageExtraList([a],g),!h&&0<y.length&&this.eventBus.emit(o.t.MsgReactions,{reactions:y}),(i=(l=this.createConversationInstance(a.conversationID,a.conversationType)).dbConv.lastMessage)&&i.messageID==a.messageID){var M,R=[];for(M in a.reactions){var D=a.reactions[M];R.push({conversationID:a.conversationID,conversationType:a.conversationType,messageID:a.messageID,userList:D.userList,totalCount:D.totalCount,reactionType:M,isSelfIncluded:D.isSelfIncluded})}Object(d.a)(i.reactions,R)||(i.reactions=R,this.emitConversationUpdated(l.dbConv,g))}return y},u.prototype.updateConvSeq=function(a,i){var l=this.engineConfig.user;!a||!i&&+l.convSeq&&l.convSeq!=a.sub(1).toString()||(l.convSeq=a.toString(),this.dbMgr.setUser(l))},u.prototype.updateMsgExtraSeq=function(a,i){var l=this.engineConfig.user;!a||!i&&+l.msgExtraSeq&&l.msgExtraSeq!=a.sub(1).toString()||(l.msgExtraSeq=a.toString(),this.dbMgr.setUser(l))},u.prototype.updateC2CMsgStateSeq=function(a,i){var l=this.engineConfig.user;!a||!i&&+l.c2cMsgStateSeq&&l.c2cMsgStateSeq!=a.sub(1).toString()||(l.c2cMsgStateSeq=a.toString(),this.dbMgr.setUser(l))},u.prototype.updateConvPinnedListSeq=function(a,i){var l=this.engineConfig.user;!a||!i&&+l.convPinnedSeq&&l.convPinnedSeq!=a-1||(l.convPinnedSeq=a,this.dbMgr.setUser(l))},u.prototype.updateConvNameAndAvatar=function(a,i,l,h){var m=((m=i.type==o.q.Peer?this.svrConvInfoMap.get(i.conversationID)||this.dbUserMap.get(i.conversationID):void 0)&&l===void 0&&(l=m.userName),m&&h===void 0&&(h=m.userAvatarUrl),!1);typeof l=="string"&&l!=i.conversationName&&(m=!0,i.conversationName=l),typeof h=="string"&&h!=i.conversationAvatarUrl&&(m=!0,i.conversationAvatarUrl=h),m&&i&&this.dbMgr.addConversationList([i],a)},u.prototype.setAssociatedGroup=function(a,i,l){l===o.q.Group?this.groupMgr.initGroupByConversation(i):l===o.q.Room&&((l=this.groupMgr.findRoom(i))?a.setAssociatedGroup(l.sessionID,l.userSessionID,l.subRoomID,l.enabledOfflineMsg):a.setAssociatedGroup())},u.prototype.saveConversationList=function(a,i,l,h){var m=this,g=[],y=new Map,w=new Map,M=new Map,R=[],D=(i&&0<this.dbConvMap.size&&this.dbConvMap.forEach(function(G,J){return m.filterValidConv(G)&&M.set(J,G)}),a.forEach(function(G,J){M.delete(J);var K,ee,A,v=null,E=G.state==o.p.Delete,N=G.msgSeq,P=m.dbConvMap.get(J),H=!P||!P.maxOrderKey;P?(K=P.orderKey,ee=P.msgSeq||0,A=P.state==o.p.Delete,E&&G.seq&&T.a.fromString(P.seq||"0").lessThan(G.seq)&&(G.seq=G.seq.toString(),R.push(G.conversationID),Object.assign(P,G),w.set(J,P)),(ee<N||P.readMsgSeq<G.readMsgSeq)&&(R.push(G.conversationID+":"+P.readMsgSeq+","+G.readMsgSeq),Object.assign(P,G),w.set(J,P),v=A||H?o.n.Added:o.n.Updated),E&&!A&&(v=o.n.Deleted),P.maxOrderKey||(P.maxOrderKey=N*o.l.MESSAGE_SEQ_MULTIPLIER),K>G.orderKey&&(P.orderKey=K),P.maxStatemsgSeq=G.maxStatemsgSeq):(m.initDBConversationFields(P=G,N),m.dbConvMap.set(J,P),w.set(J,P),!E&&0<N&&(v=o.n.Added)),E||(G.type!=o.q.Peer||!H&&m.dbUserMap.has(G.conversationID)||g.push(G.conversationID),0<N&&H&&(v=o.n.Added)),v!=null&&y.set(J,v)}),l.updateConvs=R.join(),M.forEach(function(G,J){G.state=o.p.Delete,m.syncConvReadSeqToMsgSeq(G,G.msgSeq),m.convMap.delete(J),y.set(J,o.n.Deleted)}),"mergeSvrConvs"+y.size);if(M.size&&this.dbMgr.addConversationList(Array.from(M.values()),D),g.length){for(var q=[],L=0;L<g.length;L+=100){var j=this.connMgr.sendRequest(o.c.fetch_user_info,{_ev_:D,quey_user_id:g.slice(L,L+100)},o.i.SDK);q.push(j)}Promise.all(q).then(function(G){var J=[];(G=(G.forEach(function(K){(K=K.result)&&K.length&&K.forEach(function(ee){var A=m.getConversationKey(ee.user_id,o.q.Peer),v=Object(d.f)(ee.user_name),E=Object(d.f)(ee.avatar);(A=((A=m.dbConvMap.get(A))&&(A.conversationName=v,A.conversationAvatarUrl=E),m.dbUserMap.get(ee.user_id)||{userID:ee.user_id,userName:v,userAvatarUrl:E})).userName=v,A.userAvatarUrl=E,J.push(A),m.dbUserMap.set(A.userID,A)})}),m.dbMgr.addUserList(J),m.dbMgr.addConversationList(Array.from(w.values()),D),Array.from(m.dbConvMap.values()).filter(function(K){var ee=m.filterValidConv(K);return ee&&m.createConversationInstance(K.conversationID,K.type),ee}))).sort(d.d),l.count=G.length,m.logger.info(n,D,l),h(G,y)})}else this.dbMgr.addConversationList(Array.from(w.values()),D),(i=Array.from(this.dbConvMap.values()).filter(function(G){var J=m.filterValidConv(G);return J&&m.createConversationInstance(G.conversationID,G.type),J})).sort(d.d),l.count=i.length,this.logger.info(n,D,l),h(i,y)},u.prototype.mergeMessageExtra=function(a,i,l){var h=this,m=a.type==o.q.Peer,g=a.maxSendReceiptMsgSeq||0,y=a.maxRecvReceiptMsgSeq||0,w=[];m&&l&&(l.sendSeq=g,l.recvSeq=y),i.forEach(function(M){if(!M.isUserInserted&&M.sentStatus==o.P.Success){var R=null,D=M.conversationSeq,q=(j=h.msgExtraMap.get(h.getMsgExtraKey(a.conversationID,a.type,D)))&&j.receiptStatus,L=j&&j.reactions,j=j&&j.revokeInfo&&JSON.parse(j.revokeInfo);if(M.receiptStatus==o.M.Processing&&(m&&(M.direction==o.K.Send&&D<=g||M.direction==o.K.Receive&&D<=y)?(M.receiptStatus=o.M.Done,R=M):q&&q!=M.receiptStatus&&(M.receiptStatus=q,R=M,l&&(l[D]=q))),L){var G,J=[];for(G in L){var K=L[G];J.push({conversationID:M.conversationID,conversationType:M.conversationType,messageID:M.messageID,userList:K.userList,totalCount:K.totalCount,reactionType:G,isSelfIncluded:K.isSelfIncluded})}(M.reactions=J).length&&(R=M)}j&&j.originalTextMessageContent&&M.type==o.R.Revoke&&(M.originalTextMessageContent=j.originalTextMessageContent),R&&w.push(c({},R))}}),this.createConversationInstance(a.conversationID,a.type).updateMsgCacheList(w),this.dbMgr.addMessageList(a.conversationID,a.type,w)},u.prototype.mergeGroupMessageStatus=function(a,i,l){if(i.length){var h=+a.minStatemsgSeq||0,m=+a.maxStatemsgSeq||0;if(!m||h<m){for(var g=i[0].conversationSeq,y=g,w=1;w<i.length;w++){var M=i[w].conversationSeq;M<g&&(g=M),y<M&&(y=M)}this.mergeServerMsgStateList(l,"",h,g,y,a)}}},u.prototype.insertDBMessageExtra=function(a){var i,l;a.receiptInfo&&(i=a.message,l=this.getMsgExtraKey(i.conversationID,i.conversationType,i.conversationSeq),(l=this.createMessageReceiptExrta(l,i.conversationID,i.conversationType,i.conversationSeq)).messageID=i.messageID,l.receiptStatus=i.receiptStatus,l.receiptSeq=a.receiptInfo.seq.toString(),l.unreadMemberCount=a.receiptInfo.count,this.dbMgr.addMessageExtraList([l],"sendMsgReceiptRsp"),this.updateMsgExtraSeq(a.receiptInfo.seq)),delete a.receiptInfo},u.prototype.isDBConvInvalid=function(a){return!a||a.state==o.p.Delete||!a.maxOrderKey},u.prototype.filterValidConv=function(a,i){var l=a.state!=o.p.Delete&&!!a.maxOrderKey&&a.type!=o.q.Room&&typeof a.type=="number";return i?l&&!!a.isPinned:l},u.prototype.transform2DBConv=function(a){var i,l,h=a.conv_id,m=a.conv_type,g=a.conv_msg_seq,y=a.read_seq,w=a.send_count_after_read,M=a.sub_read_count,R=a.last_msg_time,D=this.getConversationKey(h,m),q=this.dbConvMap.get(D),L=q==null?void 0:q.lastMessage,j=a.last_msg_del?void 0:this.transform2Message(a.last_msg,h,m);return j&&L&&(this.createConversationInstance(h,m).calculateMessageOrderKey(j,!1),(L.sentStatus!==o.P.Success&&j.timestamp<L.timestamp||j.orderKey<L.orderKey)&&(j=L)),m==o.q.Peer&&j&&j.receiptStatus==o.M.Processing&&q&&(i=j.conversationSeq,L=q.maxSendReceiptMsgSeq||0,l=q.maxRecvReceiptMsgSeq||0,(j.direction==o.K.Send&&i<=L||j.direction==o.K.Receive&&i<=l)&&(j.receiptStatus=o.M.Done)),q&&q.readMsgSeq>y&&(y=q.readMsgSeq),L={id:D,ownerID:this.engineConfig.user.userID,conversationID:h,type:m,msgSeq:g,readMsgSeq:y,sendMsgCount:w,unreadMessageCount:Math.max(g-y-w-M,0),deletedMsgCount:((q==null?void 0:q.deletedMsgCount)||0)+M,orderKey:this.getConversationOrderKey(R,a.last_msg,a.update_time),lastMessage:j},m==o.q.Group&&a.statemsg_seq&&(i=a.statemsg_seq,this.engineConfig.user.preVersion?L.maxStatemsgSeq=i:(l=this.engineConfig.mailHBConfig.state_seq_reduce_num,L.maxStatemsgSeq=l==-1?0:i-l)),a.is_del?(L.state=o.p.Delete,L.seq=a.conv_list_seq):L.state=q?q.state:o.p.Normal,L},u.prototype.getConversationOrderKey=function(a,i,l){return i&&i.msg_svr_info&&i.msg_svr_info.msg_time?i.msg_svr_info.msg_time||a||l:a||l},u.prototype.transform2Message=function(a,i,l){var h,m,g;if(a&&a.msg_info&&a.msg_info.msg_type&&a.msg_svr_info)return h=a.msg_info,a=a.msg_svr_info,m=h.msg_type,g=a.sender_user_id,(m={type:200<=m&&m<=400?o.R.Custom:m,messageID:a.msg_id,localMessageID:"",timestamp:a.msg_time,extendedData:h.payload&&m!=o.R.Revoke?Object(d.f)(h.payload):void 0,conversationSeq:a.conv_msg_seq,conversationID:i,conversationType:l,senderUserID:g,sentStatus:o.P.Success,direction:g===this.engineConfig.user.userID?o.K.Send:o.K.Receive,isUserInserted:!1,receiptStatus:o.M.None,clientSeq:h.msg_client_info?h.msg_client_info.client_msg_seq:0,clientSid:h.msg_client_info?h.msg_client_info.conv_sid:""}).localMessageID=m.clientSid+m.clientSeq,this.protobuf.decodeMsgBody(m,h.msg,a.version,a.is_server),m.type==o.R.Custom&&(m.subType=h.sub_msg_type||0,m.searchedContent=h.searched_content),l==o.q.Unknown?m.isBroadcastMessage=!0:(h.has_receipt&&m.type!=o.R.Revoke&&(m.receiptStatus=o.M.Processing,(g=this.msgExtraMap.get(this.getMsgExtraKey(i,l,m.conversationSeq)))&&(m.receiptStatus=g.receiptStatus),this.dbMgr.checkMessageStatus(m)),m.reactions=this.handleReactionList(m,a.reactions)),m},u.prototype.transform2Command=function(a,i,l){var h=l.sender_user_id;return(l={type:l.msg_type,message:l.msg_type==o.R.Barrage?Object(d.f)(l.msg):l.msg,localMessageID:"",messageID:l.msg_id,timestamp:l.msg_time,extendedData:l.payload?Object(d.f)(l.payload):void 0,conversationID:a,conversationType:i,senderUserID:h,sentStatus:o.P.Success,direction:h===this.engineConfig.user.userID?o.K.Send:o.K.Receive}).localMessageID=l.messageID,l},u.prototype.syncConvReadSeqToMsgSeq=function(a,i){a.sendMsgCount=0,a.deletedMsgCount=0,a.unreadMessageCount=0,a.readMsgSeq=i||0},u.prototype.deleteLocalConv=function(a,i){a.state=o.p.Delete,this.syncConvReadSeqToMsgSeq(a,a.msgSeq),this.convMap.delete(a.id);var l="deleteConv";return this.dbMgr.addConversationList([a],l),this.onUnreadMessageCount(l),this.stgyMgr.modifyConversation(a.conversationID,a.type,o.n.Deleted),i&&this.logger.info(n,o.I.DeleteConv,i),Promise.resolve({conversationID:a.conversationID,conversationType:a.type})},u.prototype.deleteAllLocalConv=function(a,i,l){var h=this,m=[],g=(this.convMap.forEach(function(y){y.convType==o.q.Room||i&&+y.dbConv.seq>i||((y=y.dbConv).state=o.p.Delete,h.syncConvReadSeqToMsgSeq(y,y.msgSeq),m.push(y),h.convMap.delete(y.id))}),"deleteAllConv");return this.dbMgr.addConversationList(m,g),this.onUnreadMessageCount(g),this.stgyMgr.deleteAllConversation(m),a&&this.logger.info(n,o.I.DeleteAllConv,a),l&&this.eventBus.emit(o.t.ConvAllDeleted,{count:m.length}),Promise.resolve()},u.prototype.handleReactionList=function(a,i){var l=this;if(!i||a.type==o.R.Revoke)return[];var h=i.is_detail,m=(i=i.reaction_list,[]),g=this.engineConfig.mailHBConfig.reaction_brief_len;return i&&i.forEach(function(y){var w=y.user_reaction.slice(0,g).map(function(M){return{userID:M.userID}});(w={conversationID:a.conversationID,conversationType:a.conversationType,messageID:a.messageID,userList:w,totalCount:y.total_user_count,reactionType:y.reaction_key,isSelfIncluded:!1}).isSelfIncluded=h?w.userList.some(function(M){return M.userID==l.engineConfig.user.userID}):!!y.include_self,m.push(w)}),m},u.prototype.handleMsgStateReactionBriefs=function(a,i){return r(this,void 0,void 0,function(){var l,h,m,g;return t(this,function(y){switch(y.label){case 0:return i?a.messageID?[3,2]:[4,this.createConversationInstance(a.conversationID,a.conversationType).fetchMsgListFromCache([a.conversationSeq])]:[2];case 1:if(!(l=(l=y.sent()).get(a.conversationSeq)))return[2];a.messageID=l.messageID,y.label=2;case 2:if(h=[],a!=null&&a.reactions)for(g in m=function(w){i.find(function(M){return M.reaction_key==w})||h.push({reactionSeq:a.reactions[w].seq+1,reactionKey:w,totalCount:0,userList:[],isSelfIncluded:!1})},a.reactions)m(g);return i.forEach(function(w){h.push({reactionSeq:w.max_reaction_seq,reactionKey:w.reaction_key,totalCount:w.total_user_count,userList:w.user_reaction,isSelfIncluded:!!w.include_self})}),0<h.length&&this.saveMessageReactionExtra(a,h),[2]}})})},u);function u(a,i,l,h,m){this.logger=S.a.getInstance().logger,this.dataReport=S.a.getInstance().dataReport,this.protobuf=S.a.getInstance().protobuf,this.sdk_ver=S.a.getInstance().settings.deviceInfo.sdk_ver,this.msgReceiptChangedMap=new Map,this.mergeMsgReceiptSeqs=new Set,this.mergeMsgReceiptMap=new Map,this.mergeMsgReceiptDBConvMap=new Map,this.mergeMsgReceiptTimer=0,this.mergeListSeqs={conv:0,pinned:0,msgExtra:0,msgState:0,msgReaction:0},this.isLogined=!1,this.oldTotalUnreadCount=0,this.queryConvsCallbackList=[],this.selfReceiptSeqs=[],this.convKeys=["conversationID","conversationName","conversationAvatarUrl","type","unreadMessageCount","notificationStatus","orderKey","isPinned","lastMessage"],this.convMap=new Map,this.dbConvMap=new Map,this.dbGroupMap=new Map,this.dbUserMap=new Map,this.svrConvInfoMap=new Map,this.msgExtraMap=new Map,this.engineConfig=a,this.eventBus=i,this.connMgr=l,this.dbMgr=h,this.groupMgr=m,this.stgyMgr=new f.a(a,i),m.dbGroupMap=this.dbGroupMap,m.dbConvMap=this.dbConvMap,m.msgExtraMap=this.msgExtraMap,this.registerInnerEvent()}},function(Q,O,b){b.d(O,"a",function(){return k}),O=b(13);var T,I,p=b(0),k=((b=(T=function(f,d){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var r in c)Object.prototype.hasOwnProperty.call(c,r)&&(o[r]=c[r])})(f,d)},function(f,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function o(){this.constructor=f}T(f,d),f.prototype=d===null?Object.create(d):(o.prototype=d.prototype,new o)}))(S,I=O.a),S.prototype.setAssociatedGroup=function(){},S.prototype.getAssociatedReqBody=function(){return null},S.prototype.isFetchMessageWhenLogin=function(f){return!(f===p.u.SDKLogin&&!this.engineConfig.mailHBConfig.fetch_c2c_msg_count)},S.prototype.getFetchMessageReqBody=function(f,d,o,c){var r=this.engineConfig.mailHBConfig.fetch_c2c_msg_count||100;return d<=p.u.SDKLogin&&(c=Math.min(c,r<0?100:r)),{conv_id:this.convID,conv_type:this.convType,conv_msg_seq:f,count:c,mode:o,login_fetch:d===p.u.SDKLogin?1:0}},S);function S(f,d,o,c,r,t){return(f=I.call(this,f,d,o,c,r,t)||this).dbConv.type=p.q.Peer,f.convType=p.q.Peer,f.convTypeMap={receiveMessage:p.t.RecvPeerMsg,textMsgCmd:p.c.c2c_msg,commandMsgCmd:p.c.c2c_command,fetchMsgList:p.c.c2c_msglist,msgStatusQuery:p.c.c2c_query_msg},f}},function(Q,O,b){b.d(O,"a",function(){return k}),O=b(13);var T,I,p=b(0),k=((b=(T=function(f,d){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var r in c)Object.prototype.hasOwnProperty.call(c,r)&&(o[r]=c[r])})(f,d)},function(f,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function o(){this.constructor=f}T(f,d),f.prototype=d===null?Object.create(d):(o.prototype=d.prototype,new o)}))(S,I=O.a),S.prototype.setAssociatedGroup=function(){},S.prototype.getAssociatedReqBody=function(){return null},S.prototype.isFetchMessageWhenLogin=function(f){return!(f===p.u.SDKLogin&&!this.engineConfig.mailHBConfig.fetch_group_msg_count)},S.prototype.getFetchMessageReqBody=function(f,d,o,c){var r=this.engineConfig.mailHBConfig.fetch_group_msg_count||100;return d<=p.u.SDKLogin&&(c=Math.min(c,r<0?100:r)),{group_id:this.convID,conv_msg_seq:f,count:c,sort_type:o}},S);function S(f,d,o,c,r,t){return(f=I.call(this,f,d,o,c,r,t)||this).dbConv.type=p.q.Group,f.convType=p.q.Group,f.convTypeMap={receiveMessage:p.t.RecvGroupMsg,textMsgCmd:p.c.group_msg,commandMsgCmd:p.c.group_command,fetchMsgList:p.c.group_msglist,msgStatusQuery:p.c.group_query_msg},f}},function(Q,O,b){b.d(O,"a",function(){return f}),O=b(3);var T,I,p=b.n(O),k=(O=b(13),b(0)),S=(b=(T=function(o,c){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])})(o,c)},function(o,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function r(){this.constructor=o}T(o,c),o.prototype=c===null?Object.create(c):(r.prototype=c.prototype,new r)}),function(){return(S=Object.assign||function(o){for(var c,r=1,t=arguments.length;r<t;r++)for(var n in c=arguments[r])Object.prototype.hasOwnProperty.call(c,n)&&(o[n]=c[n]);return o}).apply(this,arguments)}),f=(b(d,I=O.a),d.prototype.setAssociatedGroup=function(o,c,r,t){this.roomReq.room_session_id=o,this.roomReq.room_user_session_id=c,this.roomReq.sub_room_id=r,this.enabledOfflineMsg=t},d.prototype.getAssociatedReqBody=function(){return this.roomReq},d.prototype.isFetchMessageWhenLogin=function(o){return!(o===k.u.SDKLogin&&!this.engineConfig.mailHBConfig.fetch_room_msg_count)&&this.enabledOfflineMsg},d.prototype.getFetchMessageReqBody=function(o,c,r,t){if(!this.roomReq.room_session_id||this.roomReq.room_session_id.toNumber()==0||!this.enabledOfflineMsg)return null;var n=this.engineConfig.mailHBConfig.fetch_room_msg_count||100;return c<=k.u.SDKLogin&&(t=Math.min(t,n<0?100:n)),S(S({},this.roomReq),{room_id:this.convID,conv_msg_seq:o,count:t,sort_type:r})},d);function d(o,c,r,t,n,s){return(o=I.call(this,o,c,r,t,n,s)||this).roomReq={room_session_id:p.a.fromNumber(0),room_user_session_id:p.a.fromNumber(0),sub_room_id:""},o.enabledOfflineMsg=!1,o.dbConv.type=k.q.Room,o.convType=k.q.Room,o.convTypeMap={receiveMessage:k.t.RecvRoomMsg,textMsgCmd:k.c.room_msg,commandMsgCmd:k.c.room_command,fetchMsgList:k.c.room_msglist,msgStatusQuery:k.c.room_query_msg},o}},function(Q,O,b){b.d(O,"a",function(){return f});var T=b(2),I=b(73),p=b(1),k=b(0),S=k.J.Strategy,f=(d.prototype.start=function(){var o,c=this;this.triggerTimer||(this.convStrategy.start(),!p.n&&window&&"requestIdleCallback"in window?(o=function(r){if(r)for(var t=c.convStrategy.popFrontConversations();(0<r.timeRemaining()||r.didTimeout)&&t.length;)c.handleIdleTimeStrategy(1,t.shift())},this.triggerTimer=setInterval(function(){return requestIdleCallback(o)},this.triggerInterval)):this.triggerTimer=setInterval(function(){for(var r=c.convStrategy.popFrontConversations();r.length;)c.handleIdleTimeStrategy(0,r.shift())},this.triggerInterval))},d.prototype.stop=function(){this.convStrategy.stop(),this.triggerTimer&&clearInterval(this.triggerTimer),this.triggerTimer=0},d.prototype.initConversations=function(o){this.convStrategy.initList(o)},d.prototype.modifyConversation=function(o,c,r,t){switch(r){case k.n.Added:case k.n.Updated:this.convStrategy.insertConversation(o,c,t);break;case k.n.Disabled:case k.n.Deleted:this.convStrategy.removeConversation(o,c)}this.logger.info(S,"MGR.modifyConv",{convID:o,convType:c,state:r,todoList:t})},d.prototype.deleteAllConversation=function(o){var c=this;o.forEach(function(r){return c.convStrategy.removeConversation(r.conversationID,r.type)})},d.prototype.updateConversationTodoList=function(o,c,r,t){this.convStrategy.modifyConversationTodoList(o,c,r,t),this.logger.info(S,"MGR.updateConvTodos",{convID:o,convType:c,state:r,todo:t})},d.prototype.updateConversationActivity=function(o,c,r){this.convStrategy.increaseConversationActivities(o,c),this.logger.info(S,"MGR.updateConvAct",{convID:o,convType:c,activity:r})},d.prototype.handleIdleTimeStrategy=function(o,c){c&&(this.eventBus.exec(k.t.IIdleFetchConvMsg,c.convID,c.convType,c.todoFlag),this.modifyConversation(c.convID,c.convType,k.n.Disabled,k.a.FetchAll),this.logger.info(S,"MGR.trigConvAct:"+o,c))},d);function d(o,c){this.engineConfig=o,this.logger=T.a.getInstance().logger,this.triggerInterval=3e4,this.triggerTimer=null,this.eventBus=c,this.convStrategy=new I.a}},function(Q,O,b){b.d(O,"a",function(){return f});var T=b(2),I=b(0),p=I.J.Strategy,k=(S.prototype.actionActivities=function(){this.activities++},S);function S(o,c,r){this.inactiveTurn=0,this.activities=0,this.todoFlag=3,this.convID=o,this.convType=c,r==I.a.FetchAll?this.todoFlag=3:r==I.a.FetchMessageList?this.todoFlag=1:r==I.a.FetchMessageStatusList&&(this.todoFlag=2)}d.prototype.start=function(){var o=this;this.sortTask||(this.sortTask=setInterval(function(){o.strategyList.sort(function(c,r){return r.activities-c.activities}),o.strategyList=o.strategyList.filter(function(c){return c.inactiveTurn<o.inactiveRemoveTurn}),o.strategyList.forEach(function(c){c.todoFlag&&c.inactiveTurn++}),o.strategyList.length&&o.logger.info(p,"start",{strategyList:o.strategyList})},this.sortInterval))},d.prototype.stop=function(){this.sortTask&&clearInterval(this.sortTask),this.sortTask=0,this.strategyList.length=0,this.groupConvInfoMap.clear(),this.c2cConvInfoMap.clear()},d.prototype.initList=function(o){var c=this;o.length&&(o.sort(function(r,t){return r.conversationOrderKey-t.conversationOrderKey}),o.forEach(function(r){var t;r.conversationType==I.q.Group&&(t=new k(r.conversationID,r.conversationType,I.a.FetchAll),c.strategyList.push(t),c.groupConvInfoMap.set(r.conversationID,t))}),this.strategyList.sort(function(r,t){return r.activities-t.activities}),this.logger.info(p,"initList",{strategyList:this.strategyList}))},d.prototype.insertConversation=function(o,c,r){r=new k(o,c,r),c==I.q.Group?this.groupConvInfoMap.set(o,r):c==I.q.Peer&&this.c2cConvInfoMap.set(o,r),this.strategyList.some(function(t){return o==t.convID&&c==t.convType})||this.strategyList.push(r)},d.prototype.removeConversation=function(o,c){c==I.q.Group?this.groupConvInfoMap.delete(o):c==I.q.Peer&&this.c2cConvInfoMap.delete(o);var r=this.strategyList.findIndex(function(t){return o==t.convID&&c==t.convType});r!=-1&&this.strategyList.splice(r,1)},d.prototype.modifyConversationTodoList=function(o,c,r,t){switch(t){case I.a.FetchAll:c==I.q.Group?(n=this.groupConvInfoMap.get(o),r==I.b.Insert?n.todoFlag|=3:r==I.b.Remove&&(n.todoFlag&=0)):c==I.q.Peer&&(n=this.c2cConvInfoMap.get(o),r==I.b.Insert?n.todoFlag|=3:r==I.b.Remove&&(n.todoFlag&=0));break;case I.a.FetchMessageList:c==I.q.Group?(n=this.groupConvInfoMap.get(o),r==I.b.Insert?n.todoFlag|=3:r==I.b.Remove&&(n.todoFlag&=0)):c==I.q.Peer&&((n=this.c2cConvInfoMap.get(o)).todoFlag|=1,r==I.b.Remove&&(n.todoFlag&=2));break;case I.a.FetchMessageStatusList:var n;c==I.q.Group?((n=this.groupConvInfoMap.get(o)).todoFlag|=2,r==I.b.Remove&&(n.todoFlag&=1)):c==I.q.Peer&&((n=this.c2cConvInfoMap.get(o)).todoFlag|=2,r==I.b.Remove&&(n.todoFlag&=1))}this.logger.info(p,"modifyConvTodos",{convID:o,convType:c,state:r,todo:t})},d.prototype.increaseConversationActivities=function(o,c){var r=this.strategyList.find(function(t){return t.convID==o});r?r.inactiveTurn=0:(r=new k(o,c,I.a.FetchAll),this.strategyList.push(r)),r.actionActivities(),c==I.q.Group&&this.groupConvInfoMap.set(o,r),c==I.q.Peer&&this.c2cConvInfoMap.set(o,r),this.logger.info(p,"incConvAct",{convID:o,convType:c,strategy:r})},d.prototype.popFrontConversations=function(){return this.strategyList.slice(0,2)};var f=d;function d(){this.strategyList=[],this.groupConvInfoMap=new Map,this.c2cConvInfoMap=new Map,this.logger=T.a.getInstance().logger,this.sortInterval=6e4,this.inactiveRemoveTurn=10,this.sortTask=null}},function(Q,O,b){b.d(O,"a",function(){return c}),O=b(3);var T=b.n(O),I=b(75),p=b(19),k=b(2),S=b(1),f=b(0),d=function(){return(d=Object.assign||function(t){for(var n,s=1,u=arguments.length;s<u;s++)for(var a in n=arguments[s])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)},o=f.J.Group,c=(r.prototype.destroy=function(){this.onLogout(),this.connMgr=null,this.eventBus=null,this.logger=null,this.engineConfig=null},r.prototype.findRoom=function(t){return this.roomMap.get(t)},r.prototype.initGroupByConversation=function(t){var n=this.groupMap.get(t);n||(n=new p.a(t,this.engineConfig,this.eventBus,this.dbMgr,this.connMgr),this.groupMap.set(t,n),(t=this.dbGroupMap.get(t))&&n.setDBGroup(t,!0))},r.prototype.clearRoomMessage=function(){var t=this,n=Array.from(this.roomIDs);n.forEach(function(s){(s=t.dbConvMap.get(t.engineConfig.user.userID+f.q.Room+s))&&(s.maxSeq=0,s.msgSeq=0,s.maxOrderKey=0)}),this.dbMgr.clearRoomMessage(n),this.roomIDs.clear()},r.prototype.createRoom=function(t,n,s){return this.createRoomInstance(t.roomID).create(t.roomName,n,s)},r.prototype.joinRoom=function(t){return this.createRoomInstance(t).enter()},r.prototype.leaveRoom=function(t){var n=this,s=this.findRoom(t);return s?s.quit().then(function(){return n.clearRoomMessageByID(s.groupID,s.destroyDelay,n.dbMgr),n.roomMap.delete(t),{roomID:t}}):Promise.resolve({roomID:t})},r.prototype.queryRoomMemberList=function(t,n){var s=this.createNoRoomError(t,f.I.QueryRoomMemberList);return s?Promise.reject(s):this.findRoom(t).queryPageMember(n)},r.prototype.queryRoomMembers=function(t,n){var s=this.createNoRoomError(n,f.I.QueryRoomMembers);return s?Promise.reject(s):this.findRoom(n).queryRoomMembers(t)},r.prototype.queryRoomAllAttributes=function(t){var n=this.createNoRoomError(t,f.I.QueryRoomAllAttributes);return n?Promise.reject(n):this.findRoom(t).queryRoomAllAttributes()},r.prototype.setRoomAttributes=function(t,n,s){var u=this.createNoRoomError(n,f.I.SetRoomAttributes);return u?Promise.reject(u):this.findRoom(n).setRoomAttributes(t,s)},r.prototype.deleteRoomAttributes=function(t,n,s){var u=this.createNoRoomError(n,f.I.DeleteRoomAttributes);return u?Promise.reject(u):this.findRoom(n).deleteRoomAttributes(t,s)},r.prototype.beginRoomAttributesBatchOperation=function(t,n){this.createRoomInstance(t).beginRoomAttributesBatchOperation(n)},r.prototype.endRoomAttributesBatchOperation=function(t){var n=this.createNoRoomError(t,f.I.EndRoomAttributesBatchOperation);return n?Promise.reject(n):this.findRoom(t).endRoomAttributesBatchOperation()},r.prototype.setRoomMembersAttributes=function(t,n,s,u){var a=this.createNoRoomError(s,f.I.SetRoomMembersAttributes);return a?Promise.reject(a):this.findRoom(s).setRoomMembersAttributes(t,n,u)},r.prototype.queryRoomMembersAttributes=function(t,n){var s=this.createNoRoomError(n,f.I.QueryRoomMembersAttributes);return s?Promise.reject(s):this.findRoom(n).queryRoomMembersAttributes(t)},r.prototype.queryRoomMemberAttributesList=function(t,n){var s=this.createNoRoomError(t,f.I.QueryRoomMemberAttributesList);return s?Promise.reject(s):this.findRoom(t).queryRoomMemberAttributesList(n)},r.prototype.queryRoomOnlineMemberCount=function(t){var n=this.createNoRoomError(t,f.I.QueryRoomOnlineMemberCount);return n?Promise.reject(n):this.findRoom(t).queryMemberCount()},r.prototype.onPushRoomKickout=function(t){var n=this.findRoom(t.room_id);n&&(n.onPushKickout(t),this.clearRoomMessageByID(n.groupID,n.destroyDelay,this.dbMgr),this.roomMap.delete(n.groupID))},r.prototype.onPushRoomEnter=function(t){var n=this.findRoom(t.room_id);n&&n.onPushEnter(t)},r.prototype.onPushRoomQuit=function(t){var n=this.findRoom(t.room_id);n&&n.onPushQuit(t)},r.prototype.onPushRoomAttributesModify=function(t){var n=this.findRoom(t.room_id);n&&n.onPushRoomAttributesModify(t)},r.prototype.onPushRoomUserAttributesModify=function(t){var n=this.findRoom(t.room_id);n&&n.onPushRoomUserAttributesModify(t)},r.prototype.createGroup=function(t,n,s){var u=this,a=String(t.groupID||"").trim()||Object(S.j)(),i=this.createGroupInstance(a,t.groupName);return i.createGroup(t,n,s).then(function(l){return u.groupMap.delete(a),u.groupDelIDMap.delete(a),u.groupDelIDMap.delete(i.groupID),u.groupMap.set(i.groupID,i),u.dbGroupMap.set(i.groupID,i.dbGroup),u.updateGroupSeq(i.dbGroup.groupSeq?T.a.fromString(i.dbGroup.groupSeq):void 0),u.eventBus.exec(f.t.IJoinedGroup,i.groupID,i.groupName,i.groupAvatarUrl,0),l}).catch(function(l){throw l&&l.code&&l.code!=f.s.GroupModuleGroupAlreadyExists&&(u.groupMap.delete(a),u.groupMap.delete(i.groupID),i.destroy()),l})},r.prototype.joinGroup=function(t){var n=this,s=this.createGroupInstance(t);return s.joinGroup().then(function(u){n.groupDelIDMap.delete(t),n.dbGroupMap.set(s.groupID,s.dbGroup),n.updateGroupSeq(s.dbGroup.groupSeq?T.a.fromString(s.dbGroup.groupSeq):void 0);var a=u.seq;return n.eventBus.exec(f.t.IJoinedGroup,s.groupID,s.groupName,s.groupAvatarUrl,a),u}).catch(function(u){throw u&&u.code&&u.code!=f.s.GroupModuleMemberIsAlreadyInTheGroup&&(n.groupMap.delete(t),s.destroy()),u})},r.prototype.leaveGroup=function(t){return this.quitGroup(t,f.c.group_quit,f.I.LeaveGroup,f.s.GroupModuleLeaveGroupError)},r.prototype.dismissGroup=function(t){return this.quitGroup(t,f.c.group_destroy,f.I.DismissGroup,f.s.GroupModuleDismissGroupError)},r.prototype.queryGroupList=function(){var t=this;return new Promise(function(n){var s={time:new Date,logined:t.isLogined,count:0};t.isLogined?t.mergeServerGroupList(f.u.Biz,"apicall",function(u){return n(t.handleQueryGroupsCallback(u,s))}):t.queryGroupsCallbackList.push({log:s,resolve:n})})},r.prototype.updateGroupName=function(t,n){return this.createGroupInstance(n).updateGroupInfo(t||"",f.z.Name)},r.prototype.updateGroupNotice=function(t,n){return this.createGroupInstance(n).updateGroupInfo(t||"",f.z.Notice)},r.prototype.updateGroupAvatarUrl=function(t,n){return this.createGroupInstance(n).updateGroupAvatarUrl(t||"")},r.prototype.queryGroupInfo=function(t){return this.createGroupInstance(t).queryGroupInfo()},r.prototype.setGroupAttributes=function(t,n){return this.createGroupInstance(n).updateGroupAttributes(t)},r.prototype.deleteGroupAttributes=function(t,n){return this.createGroupInstance(n).updateGroupAttributes(t)},r.prototype.queryGroupAttributes=function(t,n){return this.createGroupInstance(t).queryGroupAttributes(n)},r.prototype.setGroupMemberNickname=function(t,n,s){return this.createGroupInstance(s).setGroupMemberInfo(n,t,f.D.Nickname)},r.prototype.setGroupMemberRole=function(t,n,s){return this.createGroupInstance(s).setGroupMemberInfo(n,t,f.D.Role)},r.prototype.transferGroupOwner=function(t,n){return this.createGroupInstance(n).transferGroupOwner(t)},r.prototype.queryGroupMemberInfo=function(t,n){return this.createGroupInstance(n).queryGroupMemberInfo(t)},r.prototype.inviteUsersIntoGroup=function(t,n){return this.createGroupInstance(n).inviteUsersIntoGroup(t)},r.prototype.kickGroupMembers=function(t,n){return this.createGroupInstance(n).kickGroupMembers(t)},r.prototype.queryGroupMemberList=function(t,n){return this.createGroupInstance(t).queryGroupMemberList(n)},r.prototype.queryGroupMemberCount=function(t){return this.createGroupInstance(t).queryGroupMemberCount()},r.prototype.queryReceiptMemberList=function(t,n,s,u){var a=this.engineConfig.user.userID+f.q.Group+n+t.conversationSeq,i=this.msgExtraMap.get(a);return i?i.messageID||(i.messageID=t.messageID):(i={id:a,ownerID:this.engineConfig.user.userID,conversationID:n,conversationType:f.q.Group,conversationSeq:t.conversationSeq,messageID:t.messageID,receiptStatus:t.receiptStatus,memberSeqs:{}},this.msgExtraMap.set(a,i)),this.createGroupInstance(n).queryReceiptMemberList(t,i,s,u)},r.prototype.searchGroups=function(t){var n=this;return new Promise(function(s){var u=t.keywords.filter(function(h){return typeof h=="string"&&h&&h.trim().length});if(!u.length)return s({nextFlag:0,groupSearchInfoList:[]});var a=new Date,i=t.isAlsoMatchGroupMemberUserName,l=t.isAlsoMatchGroupMemberNickname;n.dbMgr.searchGroups(u,i,l,function(h,m){var g=[],y=(Array.from(n.dbGroupMap.values()).sort(function(j,G){return Number(j.groupSeq)-Number(G.groupSeq)}).forEach(function(j){var G,J=j.groupID,K=j.groupName,ee=j.groupAvatarUrl;j=j.groupSeq,K&&u.every(function(A){return K.indexOf(A)!=-1})&&(G=h.length?h.filter(function(A){return A.ownerID==J}).map(function(A){return Object(S.q)(n.memberKeys,A)}):h,g.push({groupInfo:{groupID:J,groupName:K,groupAvatarUrl:ee},userList:G,seq:+j||0}))}),g.length),w=n.dbGroupMap.size,M=h.length,R=0,D=(R=t.nextFlag?g.findIndex(function(j){return t.nextFlag===j.seq})+1:R)+t.count,q=g[D],L=(g=g.slice(R,D),q=q?g[g.length-1].seq:0,g.length);n.logger.info(f.J.Database,f.I.SearchGroups,{time:a,dbCount:m,start:R,end:D,total:y,totalGroup:w,totalUser:M,count:L,nextFlag:q,config:t}),s({nextFlag:q,groupSearchInfoList:g})})})},r.prototype.onPushGroupCreate=function(t){this.groupDelIDMap.delete(t.group_id);var n=this.createGroupInstance(t.group_id,t.group_name);n.onPushGroupCreate(t),this.dbGroupMap.set(n.groupID,n.dbGroup),this.eventBus.exec(f.t.IJoinedGroup,n.groupID,n.groupName,n.groupAvatarUrl,0)},r.prototype.onPushGroupJoin=function(t,n){var s=n?f.C.Joined:f.C.Invited,u=(n=n?f.A.Joined:f.A.Invited,this.groupDelIDMap.delete(t.group_id),this.createGroupInstance(t.group_id,t.group_name));u.onPushGroupJoin(t,s,n),this.dbGroupMap.set(u.groupID,u.dbGroup),s=t.conv_msg_seq,this.eventBus.exec(f.t.IJoinedGroup,u.groupID,u.groupName,u.groupAvatarUrl,s)},r.prototype.onPushGroupDestroy=function(t,n){this.deleteGroup(t,n)},r.prototype.onPushGroupDataModify=function(t){this.groupDelIDMap.delete(t.group_id);var n=this.createGroupInstance(t.group_id);n.onPushGroupDataModify(t),this.dbGroupMap.set(n.groupID,n.dbGroup)},r.prototype.onPushGroupAttributesModify=function(t){this.groupDelIDMap.delete(t.group_id);var n=this.createGroupInstance(t.group_id);n.onPushGroupAttributesModify(t),this.dbGroupMap.set(n.groupID,n.dbGroup)},r.prototype.onPushGroupOwnerTransfer=function(t){this.groupDelIDMap.delete(t.group_id);var n=this.createGroupInstance(t.group_id);n.onPushGroupOwnerTransfer(t),this.dbGroupMap.set(n.groupID,n.dbGroup)},r.prototype.onPushGroupMemberChange=function(t){this.groupDelIDMap.delete(t.group_id);var n=this.createGroupInstance(t.group_id);n.onPushGroupMemberChange(t),this.dbGroupMap.set(n.groupID,n.dbGroup)},r.prototype.onLogined=function(t){var n=this;t=t.groups.map(function(s){return n.dbGroupMap.set(s.groupID,s),n.initGroupInstance(s,!0),s.groupID}),this.isLogined=!1,this.syncGroupsMember(t,f.u.SDKLogin),this.mergeServerGroupList(f.u.SDKLogin,"onLogined",function(s){n.isLogined=!0,n.queryGroupsCallbackList.forEach(function(u){return u.resolve(n.handleQueryGroupsCallback(s,u.log))}),n.queryGroupsCallbackList.length=0,n.eventBus.exec(f.t.ISyncGroups,!1)})},r.prototype.onLogout=function(){this.roomMap.forEach(function(t){return t.destroy(!0)}),this.groupMap.forEach(function(t){return t.destroy()}),this.roomMap.clear(),this.groupMap.clear(),this.groupDelIDMap.clear(),this.isLogined=!1},r.prototype.onUpdateSelf=function(){this.groupMap.forEach(function(t){return t.onUpdateSelf()})},r.prototype.onConnected=function(){var t=this;this.roomMap.forEach(function(n){return n.onConnected()}),this.syncGroupsMember(Array.from(this.dbGroupMap.keys()),f.u.SDKHb),this.mergeServerGroupList(f.u.SDKHb,"onConnected",function(){t.eventBus.exec(f.t.ISyncGroups,!0)})},r.prototype.onDisConnected=function(t){this.roomMap.forEach(function(n){return n.onDisConnected(t)}),this.groupMap.forEach(function(n){return n.onDisConnected()})},r.prototype.syncGroupsMember=function(t,n){for(var s=this,u=[],a=0;a<t.length;a+=100){var i={quey_user_id:t.slice(a,a+100)};i=this.connMgr.sendRequest(f.c.group_infos,i,f.i.SDK),u.push(i)}Promise.all(u).then(function(l){l.forEach(function(h){h.group_infos&&h.group_infos.forEach(function(m){var g=(y=m.info).group_id,y=y.group_name,w=s.dbGroupMap.get(g);m.type==1?(s.groupDelIDMap.set(g,!0),w&&(s.dbGroupMap.delete(g),s.eventBus.exec(f.t.ILeftGroup,g))):w&&(w.groupName=y,w.groupAvatarUrl=Object(S.f)(m.info.group_avatar),w.tatalMemberCount=m.info.member_count,(!w.memberSeq||m.info.all_member_seq>w.memberSeq)&&s.initGroupInstance(w,!0).mergeServerMemberList(n,"initAll"))})})})},r.prototype.handleQueryGroupsCallback=function(t,n){var s=this,u=[];return t.forEach(function(a){s.groupDelIDMap.get(a.groupID)||(u.push({baseInfo:{groupID:a.groupID,groupName:a.groupName,groupAvatarUrl:a.groupAvatarUrl},notificationStatus:a.notificationStatus}),s.createGroupInstance(a.groupID))}),n.count=u.length,this.logger.info(o,f.I.QueryGroupList,n),{groupList:u}},r.prototype.registerInnerEvent=function(){this.eventBus.add(f.t.ILogined,this.onLogined.bind(this)),this.eventBus.add(f.t.ILogout,this.onLogout.bind(this)),this.eventBus.add(f.t.IUpdateSelf,this.onUpdateSelf.bind(this)),this.eventBus.add(f.t.IConnected,this.onConnected.bind(this)),this.eventBus.add(f.t.IDisConnected,this.onDisConnected.bind(this))},r.prototype.createRoomInstance=function(t){var n=this.findRoom(t);return n||(n=new I.a(t,this.engineConfig,this.eventBus,this.dbMgr,this.connMgr),this.roomMap.set(t,n),this.roomIDs.add(t)),n},r.prototype.createGroupInstance=function(t,n){var s=this.groupMap.get(t);return s||(s=new p.a(t,this.engineConfig,this.eventBus,this.dbMgr,this.connMgr),n&&(s.groupName=n),this.groupMap.set(t,s),n=this.dbGroupMap.get(t)||{groupID:t,groupName:n||"",groupAvatarUrl:"",id:this.engineConfig.user.userID+t,ownerID:this.engineConfig.user.userID,groupNotice:"",tatalMemberCount:0,notificationStatus:f.G.Notify,attributes:{},dataSeq:0,attributeSeq:0,memberSeq:0,groupSeq:"0"},s.setDBGroup(n,this.dbGroupMap.has(t))),s},r.prototype.initGroupInstance=function(t,n){var s=this.groupMap.get(t.groupID);return s||(s=new p.a(t.groupID,this.engineConfig,this.eventBus,this.dbMgr,this.connMgr),t.dataSeq||(t.dataSeq=0),t.attributeSeq||(t.attributeSeq=0),t.memberSeq||(t.memberSeq=0),t.groupSeq||(t.groupSeq="0"),t.groupName&&(s.groupName=t.groupName),t.groupAvatarUrl&&(s.groupAvatarUrl=t.groupAvatarUrl),s.setDBGroup(t,n),this.groupMap.set(t.groupID,s)),s},r.prototype.clearRoomMessageByID=function(t,n,s){var u=this;n=n?1e3*n:0,setTimeout(function(){var a=u.findRoom(t);a&&a.state!=f.V.Disconnected||((a=u.dbConvMap.get(u.engineConfig.user.userID+f.q.Room+t))&&(a.maxSeq=0,a.msgSeq=0,a.maxOrderKey=0),u.roomIDs.delete(t),s.clearRoomMessage([t]))},n)},r.prototype.deleteGroup=function(t,n){var s,u,a,i,l=t.group_id,h=this.groupMap.get(l);h&&(this.groupMap.delete(l),t.op_user||(t.op_user={user_id:this.engineConfig.user.userID,user_name:this.engineConfig.user.userName}),a=(u=t.op_user).user_id,i=u.user_name,s=u.group_nick_name,u=u.role,a={userID:a},i&&(a.userName=typeof i=="string"?i:Object(S.f)(i)),s&&(a.memberNickname=s),u&&(a.memberRole=u),i=d(d({},a),{operatedUserInfo:a}),this.eventBus.emit(f.t.GroupMemberState,{groupID:l,state:f.F.Quit,event:n===f.A.KickedOut?f.C.KickedOut:f.C.Left,operatedInfo:i,userList:[d({},h.groupMember)]}),this.eventBus.emit(f.t.GroupState,{state:f.H.Quit,event:n,operatedInfo:i,groupInfo:h.createGroupFullInfo()}),h.destroy()),this.dbMgr.deleteGroupList([l]),this.groupDelIDMap.set(l,!0),this.dbGroupMap.delete(l),this.updateGroupSeq(t.conv_list_seq),this.eventBus.exec(f.t.ILeftGroup,l)},r.prototype.quitGroup=function(t,n,s,u){var a=this,i={time:new Date,groupID:t};return this.connMgr.sendRequest(n,{group_id:t}).then(function(l){if(l.code)return h=Object(S.s)(u,l.message,l.code),i.error=h,a.logger.warn(o,s,i),Promise.reject(h);l.group_id=t,l.op_user={user_id:a.engineConfig.user.userID,user_name:a.engineConfig.user.userName};var h=a.groupMap.get(t);return h&&(l.op_user.group_nick_name=h.groupMember.memberNickname,l.op_user.role=h.groupMember.memberRole),a.deleteGroup(l,n===f.c.group_destroy?f.A.Dismissed:f.A.Left),a.logger.info(o,s,i),{groupID:t}})},r.prototype.fetchServerPageGroup=function(t,n,s,u){return t={conv_list_seq:t,count:100,full_pull:u,degree:n,how:s},n==1&&(u=this.mergeGroupListSeq,this.dataReport.beginNetworkRequest(f.c.group_list.cmd,u,f.i.SDK,t)),this.connMgr.sendRequest(f.c.group_list,t,f.i.SDK).then(function(a){if(a.code)return{list:[]};var i=a.cur_list_seq,l=a.max_list_seq,h=a.fetch_end,m=a.full_list;return{nextFlag:h||i&&l&&i.greaterThanOrEqual(l)?0:i,cur:i,max:l,list:a.groups,fetch_end:h,full_list:m}})},r.prototype.mergeServerGroupList=function(t,n,s){var u=this,a=T.a.fromString(String(this.engineConfig.user.groupSeq)||"0"),i=this.engineConfig.mailHBConfig.group_list_seq;if(!this.engineConfig.mailHBConfig.fetch_group_list||!i||i.lessThanOrEqual(a))return s&&s(Array.from(this.dbGroupMap.values()));var l={time:new Date,dbSeq:a,hbSeq:i,how:t,action:n},h=0,m=0,g=this.dbGroupMap.size,y=++this.mergeGroupListSeq,w=1,M=[],R=function(D){var q,L;h+=D.list.length,D.list.forEach(function(j){var G,J,K,ee,A,v=(E=j.info).group_id,E=E.group_name;j.type==1?(m++,u.groupDelIDMap.set(v,!0),u.dbGroupMap.has(v)&&(u.dbGroupMap.delete(v),u.eventBus.exec(f.t.ILeftGroup,v),t==f.u.SDKHb&&M.push({state:f.H.Quit,event:f.A.Left,operatedInfo:{},groupInfo:{baseInfo:{groupID:v,groupName:E}}}))):(G=Object(S.f)(j.info.group_avatar),A=j.info.member_count,J=j.info.not_notify?f.G.Disturb:f.G.Notify,K=u.dbGroupMap.has(v),ee=u.dbGroupMap.get(v)||{groupID:v,groupName:E,groupAvatarUrl:G,tatalMemberCount:A,notificationStatus:J,dataSeq:0,attributeSeq:0,memberSeq:0,groupSeq:"0"},K?(ee.groupName=E,ee.notificationStatus=J,G&&(ee.groupAvatarUrl=G),A&&(ee.tatalMemberCount=A)):(u.dbGroupMap.set(v,ee),t==f.u.SDKHb&&M.push({state:f.H.Enter,event:f.A.Joined,operatedInfo:{},groupInfo:{baseInfo:{groupID:v,groupName:E,groupAvatarUrl:G},notificationStatus:J}})),ee.attributes||(ee.attributes={}),A=u.initGroupInstance(ee,K),(!ee.memberSeq||j.info.all_member_seq>ee.memberSeq)&&A.mergeServerMemberList(t,"initAll"))}),D.nextFlag&&u.engineConfig.token?u.fetchServerPageGroup(D.nextFlag,++w,t,D.full_list?1:0).then(R):(D.degree=w,D.svrCount=h,u.groupDelIDMap.size&&((q=Array.from(u.groupDelIDMap.keys())).forEach(function(j){return u.dbGroupMap.delete(j)}),u.dbMgr.deleteGroupList(q)),u.updateGroupSeq(D.cur,!0),q=Array.from(u.dbGroupMap.values()),u.dbMgr.addGroupList(q),M.length&&M.forEach(function(j){return u.eventBus.emit(f.t.GroupState,j)}),l.dbCount=g,l.count=u.dbGroupMap.size,l.svrDelCount=m,L=JSON.stringify({dbCount:g,svrDelCount:m,rspCount:u.dbGroupMap.size}),l.dataReport=u.dataReport.endNetworkRequest(f.c.group_list.cmd,y,D,L),u.logger.info(o,"mergeSvrGroups",l),s&&s(q))};this.fetchServerPageGroup(a,w,t,0).then(R)},r.prototype.updateGroupSeq=function(t,n){var s=this.engineConfig.user;!t||!n&&+s.groupSeq&&s.groupSeq!=t.sub(1).toString()||(s.groupSeq=t.toString(),this.dbMgr.setUser(s))},r.prototype.createNoRoomError=function(t,n){var s;if(!this.findRoom(t))return s=Object(S.s)(f.s.RoomModuleUserIsNotInTheRoom),this.logger.warn(f.J.Room,n,{error:s,roomID:t}),s},r);function r(t,n,s,u){this.logger=k.a.getInstance().logger,this.dataReport=k.a.getInstance().dataReport,this.memberKeys=["userID","userName","memberRole","memberAvatarUrl","memberNickname"],this.mergeGroupListSeq=0,this.isLogined=!1,this.queryGroupsCallbackList=[],this.engineConfig=t,this.eventBus=n,this.connMgr=s,this.dbMgr=u,this.roomIDs=new Set,this.roomMap=new Map,this.groupMap=new Map,this.groupDelIDMap=new Map,this.registerInnerEvent()}},function(Q,O,b){b.d(O,"a",function(){return d});var T=b(2),I=b(1),p=b(0),k=function(){return(k=Object.assign||function(c){for(var r,t=1,n=arguments.length;t<n;t++)for(var s in r=arguments[t])Object.prototype.hasOwnProperty.call(r,s)&&(c[s]=r[s]);return c}).apply(this,arguments)},S=(O=function(c,r,t,n){var s,u=arguments.length,a=u<3?r:n===null?n=Object.getOwnPropertyDescriptor(r,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(c,r,t,n);else for(var i=c.length-1;0<=i;i--)(s=c[i])&&(a=(u<3?s(a):3<u?s(r,t,a):s(r,t))||a);return 3<u&&a&&Object.defineProperty(r,t,a),a},function(c,r){var t=typeof Symbol=="function"&&c[Symbol.iterator];if(!t)return c;var n,s,u=t.call(c),a=[];try{for(;(r===void 0||0<r--)&&!(n=u.next()).done;)a.push(n.value)}catch(i){s={error:i}}finally{try{n&&!n.done&&(t=u.return)&&t.call(u)}finally{if(s)throw s.error}}return a}),f=p.J.Room,d=(o.prototype.destroy=function(c){this.stopHB(),this.reset(),c&&this.state!==p.V.Disconnected&&this.emitRoomStateChanged(p.V.Disconnected,p.U.Success),this.dbMgr=null,this.connMgr=null,this.eventBus=null,this.engineConfig=null},o.prototype.create=function(c,r,t){var n=this,s={time:new Date,roomID:this.groupID,roomName:c,state:this.state,config:r},u=(this.state==p.V.Disconnected&&this.emitRoomStateChanged(p.V.Connecting,p.U.ActiveCreate),{room_id:this.groupID,room_name:Object(I.i)(c)});return t&&(u.create_if_not_exist=!0),this.addRoomAttributes(u,r),this.connMgr.sendRequest(t?p.c.room_enter:p.c.room_create,u).then(function(a){var i,l,h,m=a.code;return m?(i=Object(I.s)(p.s.RoomModuleCreateRoomError,a.message,m),h=n.state==p.V.Connected&&m==103032?p.V.Connected:p.V.Disconnected,l=m===6000104?p.U.NetworkDisconnected:p.U.CreateFailed,n.emitRoomStateChanged(h,h==p.V.Connected?p.U.ActiveCreate:l),s.state_=n.state,s.error=i,n.logger.warn(f,t?p.I.EnterRoom:p.I.CreateRoom,s),m==51011&&(n.stopHB(),n.reset()),Promise.reject(i)):(n.groupName=c,n.subRoomID=a.sub_room_id,n.sessionID=a.room_session_id,n.userSessionID=a.room_user_session_id,n.enabledOfflineMsg=!!a.enabled_offline_msg,n.emitRoomStateChanged(p.V.Connected,p.U.Success),t||(n.localSeq=1),n.tatalMemberCount=a.user_count||1,n.startHB(a.room_info_interval),n.mergeConfig.listPullInterval=a.userlist_interval,n.mergeConfig.listMergeTimeout=a.userlist_merge_timeout,n.mergeConfig.attrPullInterval=a.attributes_pull_interval,n.mergeConfig.attrMergeTimeout=a.attributes_merge_timeout,n.isMergeUser=a.userlist_enable==1,n.destroyDelay=a.destroy_delay||0,n.isMergeUser&&(t&&a.userlist_seq!=n.localSeq?n.fetchAllUser():(h={userID:n.engineConfig.user.userID,userName:n.engineConfig.user.userName},n.userMap.set(h.userID,h),n.eventBus.emit(p.t.RoomMemberJoined,{roomID:n.groupID,memberList:[k({},h)]}))),n.emitRoomAttributesUpdated(a.attributes,!0,r),s.state_=n.state,n.logger.info(f,t?p.I.EnterRoom:p.I.CreateRoom,s),{roomInfo:{baseInfo:{roomID:n.groupID,roomName:c}}})})},o.prototype.enter=function(){var c=this;if(this.state===p.V.Connected)return t={roomID:this.groupID,roomName:this.groupName,state:this.state},this.logger.info(f,p.I.JoinRoom,t),Promise.resolve({roomInfo:{baseInfo:{roomID:this.groupID,roomName:this.groupName}}});this.state!==p.V.Connecting&&this.emitRoomStateChanged(p.V.Connecting,p.U.ActiveEnter);var r={time:new Date,roomID:this.groupID,state:this.state},t={room_id:this.groupID,room_name:this.groupName?Object(I.i)(this.groupName):void 0,room_user_session_id:this.userSessionID||0};return this.connMgr.sendRequest(p.c.room_enter,t).then(function(n){var s;return n.code?(s=Object(I.s)(p.s.RoomModuleJoinRoomError,n.message,n.code),c.emitRoomStateChanged(p.V.Disconnected,n.code===6000104?p.U.NetworkDisconnected:p.U.EnterFailed),r.state_=c.state,r.error=s,c.logger.warn(f,p.I.JoinRoom,r),n.code==51011&&(c.stopHB(),c.reset()),Promise.reject(s)):(c.groupName=Object(I.f)(n.room_name),c.subRoomID=n.sub_room_id,c.sessionID=n.room_session_id,c.userSessionID=n.room_user_session_id,c.enabledOfflineMsg=!!n.enabled_offline_msg,c.emitRoomStateChanged(p.V.Connected,p.U.Success),c.tatalMemberCount=n.user_count,c.startHB(n.room_info_interval),c.mergeConfig.listPullInterval=n.userlist_interval,c.mergeConfig.listMergeTimeout=n.userlist_merge_timeout,c.mergeConfig.attrPullInterval=n.attributes_pull_interval,c.mergeConfig.attrMergeTimeout=n.attributes_merge_timeout,c.isMergeUser=n.userlist_enable==1,c.destroyDelay=n.destroy_delay||0,c.isMergeUser&&n.userlist_seq!=c.localSeq&&c.fetchAllUser(),c.emitRoomAttributesUpdated(n.attributes),r.state_=c.state,r.roomName=c.groupName,c.logger.info(f,p.I.JoinRoom,r),{roomInfo:{baseInfo:{roomID:c.groupID,roomName:c.groupName}}})})},o.prototype.quit=function(){var c=this,r={time:new Date,roomID:this.groupID,state:this.state};if(this.state===p.V.Disconnected)return this.logger.info(f,p.I.LeaveRoom,r),this.destroy(!1),Promise.resolve();var t={room_id:this.groupID,room_session_id:this.sessionID,room_user_session_id:this.userSessionID,sub_room_id:this.subRoomID};return this.connMgr.sendRequest(p.c.room_quit,t).then(function(n){if(n.code)return n=Object(I.s)(p.s.RoomModuleLeaveRoomError,n.message,n.code),r.state_=c.state,r.error=n,c.logger.warn(f,p.I.LeaveRoom,r),Promise.reject(n);c.emitRoomStateChanged(p.V.Disconnected,p.U.Success),r.state_=c.state,c.logger.info(f,p.I.LeaveRoom,r),c.destroy(!1)})},o.prototype.queryPageMember=function(c){var r=this,t=k({time:new Date,roomID:this.groupID},c),n=++this.mergeMemberListSeq+this.groupID;return this.fetchServerPageUser(0|c.count,c.nextFlag,p.i.API,n).then(function(s){r.logger.info(f,p.I.QueryRoomMemberList,t),s.svrCount=((u=s.users)==null?void 0:u.length)||0,r.dataReport.endNetworkRequest(p.c.room_userlist.cmd,n,s);var u=r.createUserList(s.users);return{roomID:r.groupID,memberList:u,nextFlag:s.pos_flag}})},o.prototype.queryRoomMembers=function(c){var r=this,t={time:new Date,roomID:this.groupID,userIDs:c},n=[];return c=c.filter(function(s){return!!Object(I.l)(s)||(n.push({userID:s,reason:6000001}),!1)}),c=Array.from(new Set(c)),c={room_id:this.groupID,room_session_id:this.sessionID,room_user_session_id:this.userSessionID,sub_room_id:this.subRoomID,user_ids:c},this.connMgr.sendRequest(p.c.room_userinfos,c).then(function(s){if(s.code)return u=Object(I.s)(p.s.RoomModuleTheRoomMemberQueryFailed,s.message,s.code),t.error=u,r.logger.warn(f,p.I.QueryRoomMembers,t),Promise.reject(u);var u=s.result.map(function(a){return{userID:a.user_id,userName:Object(I.f)(a.user_name)}});return s.err_list.forEach(function(a){return n.push({userID:a.user_id,reason:a.sub_code})}),r.logger.info(f,p.I.QueryRoomMembers,t),{roomID:r.groupID,memberList:u,errorUserList:n}})},o.prototype.queryMemberCount=function(){var c={roomID:this.groupID,count:this.tatalMemberCount};return this.logger.info(f,p.I.QueryRoomOnlineMemberCount,c),Promise.resolve(c)},o.prototype.queryRoomAllAttributes=function(c){var r=this,t=(c===void 0&&(c=!1),{time:new Date,roomID:this.groupID}),n=(this.queryAttrFlag=!0,new Date().getTime()),s=0,u=(this.queryAttrTask.length&&(u=this.queryAttrTask[this.queryAttrTask.length-1],n-u<this.mergeConfig.attrPullInterval&&(s=this.mergeConfig.attrPullInterval-(n-u)+10)),this.queryAttrTask.push(n),{room_id:this.groupID,room_session_id:this.sessionID,sub_room_id:this.subRoomID,attributes:{attribute_seq:this.stRoomAttributes.attribute_seq||0,attributes:[]}}),a=this.connMgr.sendRequest(p.c.room_attributes,u).then(function(i){var l;return i.code?(l=Object(I.s)(p.s.RoomModuleRoomAttributesQueryFailed,i.message,i.code),t.error=l,r.logger.warn(f,p.I.QueryRoomAllAttributes,t),Promise.reject(l)):(r.queryAttrTask=r.queryAttrTask.filter(function(h){return h!==n}),r.queryRoomAllAttributesRspHandle(i,c))});return s?new Promise(function(i){setTimeout(function(){r.connMgr&&a.then(i)},s)}):a},o.prototype.setRoomAttributes=function(c,r){var t=this;if(this.batchFlag)return new Promise(function(i,l){return t.batchRoomAttributesHandle(c,[],i,l)});var n,s,u=[];for(n in c)n&&(s={action:0,attribute:{key:n,value:c[n].toString(),seq:this.attrItemSeq++,auto_delete:r.isDeleteAfterOwnerLeft?1:0}},this.localAttrKeySeqMap[n]=s.attribute.seq,u.push(s));var a={room_id:this.groupID,room_session_id:this.sessionID,sub_room_id:this.subRoomID,force_modify:r.isForce?1:0,set_member:r.isUpdateOwner?1:0,attributes_seq:this.stRoomAttributes.attribute_seq||0,op_fail_fast:0,attributes:u};return this.modifyRoomAttributes(c,a)},o.prototype.deleteRoomAttributes=function(c,r){var t=this;if(this.batchFlag)return new Promise(function(s,u){return t.batchRoomAttributesHandle({},c,s,u)});var n=[];return c.forEach(function(s){var u=t.stRoomAttributes.attributes.find(function(a){return a.key==s});u={action:1,attribute:{key:s,value:(u==null?void 0:u.value)||"",seq:t.attrItemSeq++,auto_delete:1}},t.localAttrKeySeqMap[s]=u.attribute.seq,n.push(u)}),r={room_id:this.groupID,room_session_id:this.sessionID,sub_room_id:this.subRoomID,force_modify:r.isForce?1:0,set_member:1,attributes_seq:this.stRoomAttributes.attribute_seq||0,op_fail_fast:0,attributes:n},this.modifyRoomAttributes({},r)},o.prototype.beginRoomAttributesBatchOperation=function(c){this.batchFlag=!0,this.batchOperationConfig=c,this.batchRoomAttributes.length=0},o.prototype.endRoomAttributesBatchOperation=function(){var c,r=this,t={time:new Date,roomID:this.groupID,attributes:this.batchRoomAttributes},n=(this.batchFlag=!1,[]),s={};return this.batchRoomAttributes.length?(this.batchRoomAttributes.forEach(function(u){var a={action:u.action,attribute:{key:u.key,value:u.value.toString(),seq:r.attrItemSeq++,auto_delete:r.batchOperationConfig.isDeleteAfterOwnerLeft?1:0}};u.action||(s[u.key]=u.value),r.localAttrKeySeqMap[a.attribute.key]=a.attribute.seq,n.push(a)}),t={room_id:this.groupID,room_session_id:this.sessionID,sub_room_id:this.subRoomID,force_modify:this.batchOperationConfig.isForce?1:0,set_member:this.batchOperationConfig.isUpdateOwner?1:0,attributes_seq:this.stRoomAttributes.attribute_seq||0,op_fail_fast:1,attributes:n},this.modifyRoomAttributes(s,t,!0).then(function(){return r.batchOperationConfig=null,r.batchRoomAttributes.length=0,r.batchAttributesMap.clear(),r.batchIndex=0,{roomID:r.groupID}})):(c=Object(I.s)(p.s.RoomModuleRoomAttributesOperationFailedCompletely),t.error=c,this.logger.warn(f,p.I.EndRoomAttributesBatchOperation,t),Promise.reject(c))},o.prototype.setRoomMembersAttributes=function(c,r,t){var n,s=this,u={roomID:this.groupID,attributes:c,userIDs:r,config:t},a=[],i=(r=r.filter(function(h){return!!Object(I.l)(h)||(a.push(h),!1)}),r=Array.from(new Set(r)),{room_id:this.groupID,room_session_id:this.sessionID,room_user_session_id:this.userSessionID,sub_room_id:this.subRoomID,force_modify:1,auto_save:t.isDeleteAfterOwnerLeft==null||t.isDeleteAfterOwnerLeft?0:1,op_fail_fast:0,attributes:{user_ids:r,modify_attribute:[]}});for(n in c){this.userAttrSeq++;var l={action:0,attribute:{key:n,value:c[n],seq:this.userAttrSeq}};i.attributes.modify_attribute.push(l)}return this.connMgr.sendRequest(p.c.room_user_attributes_modify,i).then(function(h){if(h.code)return m=Object(I.s)(p.s.RoomModuleRoomMemberAttributesCommonError,h.message,h.code),u.error=m,s.logger.warn(f,p.I.SetRoomMembersAttributes,u),Promise.reject(m);var m,g=(y=S(s.mergeServeUserAttributesHandle(h,c),2))[0],y=y[1];return h.user_err_list.forEach(function(w){return a.push(w.user_id)}),h.user_err_list.length&&!y.length?(m=Object(I.s)(p.s.RoomModuleRoomMemberAttributesCommonError,h.message,h.code),Promise.reject(m)):(s.eventBus.emit(p.t.RoomMemberAttr,{roomID:s.groupID,infos:g,operatedInfo:{userID:s.engineConfig.user.userID}}),u.setInfos=y,s.logger.info(f,p.I.SetRoomMembersAttributes,u),{roomID:s.groupID,infos:y,errorUserList:a})})},o.prototype.queryRoomMembersAttributes=function(c){var r=this,t={roomID:this.groupID,userIDs:c},n={room_id:this.groupID,room_session_id:this.sessionID,room_user_session_id:this.userSessionID,sub_room_id:this.subRoomID,req_attributes:[]};return c.forEach(function(s){var u=r.userAttributeMap.get(s);s={user_id:s,user_attributes_seq:u?u.seq:0},n.req_attributes.push(s)}),this.connMgr.sendRequest(p.c.room_user_attributes_get,n).then(function(s){if(s.code)return u=Object(I.s)(p.s.RoomModuleCommonError,s.message,s.code),t.error=u,r.logger.warn(f,p.I.QueryRoomMembersAttributes,t),Promise.reject(u);var u=r.mergeServeUserAttributesHandle(s)[0].map(function(a){return a.attributesInfo});return t.infos=u,r.logger.info(f,p.I.QueryRoomMembersAttributes,t),{roomID:r.groupID,infos:u}})},o.prototype.queryRoomMemberAttributesList=function(c){var r=this,t={roomID:this.groupID,config:c};return c={room_id:this.groupID,room_session_id:this.sessionID,room_user_session_id:this.userSessionID,sub_room_id:this.subRoomID,pos_flag:c.nextFlag||"",count:c.count},this.connMgr.sendRequest(p.c.room_user_attributes_list_get,c).then(function(n){if(n.code)return s=Object(I.s)(p.s.RoomModuleCommonError,n.message,n.code),t.error=s,r.logger.warn(f,p.I.QueryRoomMemberAttributesList,t),Promise.reject(s);var s=r.mergeServeUserAttributesHandle(n)[0].map(function(u){return u.attributesInfo});return t.infos=s,r.logger.info(f,p.I.QueryRoomMemberAttributesList,t),{roomID:r.groupID,infos:s,nextFlag:n.pos_flag}})},o.prototype.onConnected=function(){var c=this;this.enter().then(function(){return c.eventBus.exec(p.t.IConnectedRoom,c.groupID)})},o.prototype.onDisConnected=function(c){c?(this.stopHB(),this.emitRoomStateChanged(p.V.Disconnected,p.U.NetworkDisconnected)):this.emitRoomStateChanged(p.V.Connecting,p.U.NetworkInterrupted)},o.prototype.onPushKickout=function(c){var r=[0,p.U.KickedOut,p.U.RoomNotExist,p.U.KickedOutByOtherDevice];this.emitRoomStateChanged(p.V.Disconnected,r[c.reason]||0,JSON.stringify(c)),this.destroy(!1)},o.prototype.onPushEnter=function(c){this.tatalMemberCount=c.user_count;var r={userID:c.user_id,userName:Object(I.f)(c.user_name)};this.isMergeUser?this.waitingMergeUser(c.userlist_seq,r,"enter"):this.eventBus.emit(p.t.RoomMemberJoined,{roomID:c.room_id,memberList:[r]})},o.prototype.onPushQuit=function(c){this.tatalMemberCount=c.user_count;var r={userID:c.user_id,userName:Object(I.f)(c.user_name)};this.isMergeUser?this.waitingMergeUser(c.userlist_seq,r,"quit"):this.eventBus.emit(p.t.RoomMemberLeft,{roomID:c.room_id,memberList:[r]})},o.prototype.onPushRoomAttributesModify=function(c){var r,t,n,s=this,u=(this.logger.info(f,"onPushAttr",this.stRoomAttributes),c.attributes),a=c.attributes_seq;this.queryAttrFlag?this.batchPushQueue.push(c):(r=((c=this.stRoomAttributes)==null?void 0:c.attribute_seq)||0,a&&(t={delete:{},set:{}},1<a-r?this.queryRoomAllAttributes(!0):(u.forEach(function(i){var l;r++,i.seq?((l=s.stRoomAttributes.attributes.find(function(h){return h.key==i.key}))?(l.value=i.value,l.seq=i.seq):s.stRoomAttributes.attributes.push(i),t.set[i.key]=i.value):s.stRoomAttributes.attributes.length&&(s.stRoomAttributes.attributes.find(function(h){return h.key==i.key})&&(t.delete[i.key]=""),s.stRoomAttributes.attributes=s.stRoomAttributes.attributes.filter(function(h){return h.key!==i.key}))}),this.stRoomAttributes.attribute_seq=a,c=[],Object.keys(t.set).length&&(n={action:p.T.Set,roomAttributes:t.set},c.push(n)),Object.keys(t.delete).length&&(n={action:p.T.Delete,roomAttributes:t.delete},c.push(n)),u.length&&(a=1<c.length?p.t.RoomAttrBatch:p.t.RoomAttr,this.eventBus.emit(a,{roomID:this.groupID,infos:c})))))},o.prototype.onPushRoomUserAttributesModify=function(c){c.user_attributes=c.push_attributes,this.eventBus.emit(p.t.RoomMemberAttr,{roomID:this.groupID,infos:this.mergeServeUserAttributesHandle(c)[0],operatedInfo:{userID:c.user_id}})},o.prototype.createFrequencyLimitError=function(c){var r=Object(I.s)(p.s.CommonModuleTriggerSDKFrequencyLimit),t={roomID:this.groupID,error:r};return this.logger.warn(f,c,t),r},o.prototype.modifyRoomAttributes=function(c,r,t){var n=this;return t===void 0&&(t=!1),this.connMgr.sendRequest(p.c.room_attributes_modify,r).then(function(s){function u(y){t&&(n.batchAttributesMap.forEach(function(M){M.reject&&M.reject(y)}),n.batchOperationConfig=null,n.batchRoomAttributes.length=0,n.batchAttributesMap.clear(),n.batchIndex=0);var w={error:y,local:n.stRoomAttributes};return n.logger.warn(f,"modifyAttr",w),Promise.reject(y)}if(s.code)return u(Object(I.s)(p.s.RoomModuleRoomAttributesOperationFailedCompletely,s.message,s.code));if(s.err_list.length&&s.err_list.length==r.attributes.length)return u(Object(I.s)(p.s.RoomModuleRoomAttributesOperationFailedCompletely));var a,i,l=s.attributes.attributes,h=(t&&(a=[],l.forEach(function(y){var w=a.findIndex(function(M){return M.key==y.key});y.seq?(w!=-1&&a.splice(w,1),a.push(y)):w!==-1&&a.splice(w,1)}),l=a),n.stRoomAttributes.attribute_seq=s.attributes.attribute_seq,{delete:{},set:{}}),m=(l.forEach(function(y){y=k({},y);var w=n.stRoomAttributes.attributes.find(function(R){return R.key==y.key}),M=n.stRoomAttributes.attributes.findIndex(function(R){return R.key==y.key});w?y.seq?(w.value=c[w.key].toString(),w.seq=y.seq,h.delete[w.key]!==void 0&&delete h.delete[w.key],h.set[w.key]=w.value):(n.stRoomAttributes.attributes.splice(M,1),h.delete[w.key]=""):y.seq&&(y.value=c[y.key].toString(),n.stRoomAttributes.attributes.push(y),h.delete[y.key]!==void 0&&delete h.delete[y.key],h.set[y.key]=y.value)}),n.logger.info(f,"operaAttr",{local:n.stRoomAttributes}),[]),g=(Object.keys(h.set).length&&(i={action:p.T.Set,roomAttributes:h.set},m.push(i)),Object.keys(h.delete).length&&(i={action:p.T.Delete,roomAttributes:h.delete},m.push(i)),s.err_list.map(function(y){return y.key}));return t&&n.batchAttributesMap.forEach(function(y){var w,M,R,D,q,L;g.length?(w=g[0],R=!1,M={},!Array.isArray(y.data)&&w in y.data&&!l.some(function(j){return j.value==y.data[w]})||Array.isArray(y.data)&&y.data.indexOf(w)!=-1?(R=!0,D=[],y.action==p.T.Delete&&(q=y.data.findIndex(function(j){return j==w}))!==-1&&(D=y.data.slice(q)),y.action==p.T.Set&&(D=Object.keys(y.data)),y.resolve&&y.resolve({roomID:n.groupID,errorKeys:D}),M={attributeList:l,data:y.data}):R?(y.action==p.T.Delete&&(L=y.data.slice()),y.action==p.T.Set&&(L=Object.keys(y.data)),y.resolve&&y.resolve({roomID:n.groupID,errorKeys:L})):(M.error=!1,y.resolve&&y.resolve({roomID:n.groupID,errorKeys:g})),n.logger.info(f,"operaAttr",M)):y.resolve&&y.resolve({roomID:n.groupID,errorKeys:[]})}),l.length&&(i=t?p.t.RoomAttrBatch:p.t.RoomAttr,n.eventBus.emit(i,{roomID:n.groupID,infos:m})),{roomID:n.groupID,errorKeys:g}})},o.prototype.mergeServeUserAttributesHandle=function(c,r){var t=this,n=[],s=[];return c.user_attributes.forEach(function(u){var a=u.user_id,i=u.attributes,l=u.err_list,h={},m=t.userAttributeMap.get(a)||{seq:0,attribute:[]};if(u.user_attributes_seq>m.seq)m.seq=u.user_attributes_seq,i.forEach(function(M){var R=m.attribute.find(function(D){return D.key==M.key});R?(R.value=M.value,h[M.key]=M.value):(m.attribute.push(k(k({},M),{value:M.value||""})),h[M.key]=M.value||"")});else if(r)for(g in r)(function(M){var R=r[M],D=m.attribute.find(function(q){return q.key==M});D?D.value=R:m.attribute.push({key:M,value:R}),h[M]=R})(g);else m.attribute.forEach(function(M){h[M.key]=M.value});if(t.userAttributeMap.set(a,m),(i.length||u.user_attributes_seq)&&n.push({attributesInfo:{userID:a,attributes:h}}),r){var g,y=l.map(function(M){return M.key}),w={};for(g in r)y.indexOf(g)==-1&&(w[g]=h[g]);s.push({errorKeys:y,attributesInfo:{userID:a,attributes:w}})}}),[n,s]},o.prototype.queryRoomAllAttributesRspHandle=function(c,r){var t={isSeqUpdate:r=r!==void 0&&r,local:this.stRoomAttributes,batchPushQueue:this.batchPushQueue};if(this.logger.info(f,p.I.QueryRoomAllAttributes,t),this.queryAttrFlag=!1,this.batchPushQueue.length)try{this.mergeStAttributeHandle(c.attributes)}catch(a){t={error:!0,stack:(a==null?void 0:a.message)||(a==null?void 0:a.stack),action:"catch mergeStAttributeHandle"},this.logger.info(f,p.I.QueryRoomAllAttributes,t)}else{var n,s,u={delete:{},set:{}};t=(this.stRoomAttributes.attribute_seq=c.attributes.attribute_seq,c.attributes.attributes.length?((n=this.stRoomAttributes.attributes).map(function(a){a.seq=0}),c.attributes.attributes.forEach(function(a){var i=n.findIndex(function(l){return l.key==a.key});i!==-1?a.seq&&(n[i].seq=a.seq,n[i].value!==a.value&&(u.set[a.key]=a.value,n[i].value=a.value)):a.key&&(u.set[a.key]=a.value,n.push(k(k({},a),{value:a.value})))}),this.stRoomAttributes.attributes=n.filter(function(a){return a.seq==0&&(u.delete[a.key]=""),a.seq!==0})):(this.stRoomAttributes.attributes.forEach(function(a){u.delete[a.key]=""}),this.stRoomAttributes.attributes=[]),[]),c=(Object.keys(u.set).length&&(s={action:p.T.Set,roomAttributes:u.set},t.push(s)),Object.keys(u.delete).length&&(s={action:p.T.Delete,roomAttributes:u.delete},t.push(s)),{isSeqUpdate:r,local:this.stRoomAttributes,infoList:t}),this.logger.info(f,p.I.QueryRoomAllAttributes,c),r&&t.length&&(this.logger.info(f,"attrUpdated",u),s=1<t.length?p.t.RoomAttrBatch:p.t.RoomAttr,this.eventBus.emit(s,{roomID:this.groupID,infos:t}))}return{roomID:this.groupID,roomAttributes:this.getRecordFromStRoomAttributes()}},o.prototype.addRoomAttributes=function(c,r){if(r&&Object.prototype.toString.call(r.roomAttributes)=="[object Object]"){var t,n,s=[];for(t in r.roomAttributes)t&&(n={key:t,value:r.roomAttributes[t].toString(),seq:this.attrItemSeq++,auto_delete:1},s.push(n),this.localAttrKeySeqMap[t]=n.seq);s.length&&(c.attributes=s)}r&&r.roomDestroyDelayTime&&(c.destroy_delay=+r.roomDestroyDelayTime)},o.prototype.batchRoomAttributesHandle=function(c,r,t,n){var s,u=this,a={batchRoomAttributes:this.batchRoomAttributes,roomAttributes:c,delKeys:r=r===void 0?[]:r};for(s in this.logger.info(f,"bmodifyAttr",a),this.batchRoomAttributes||(this.batchRoomAttributes=[]),r.length?this.batchAttributesMap.set(this.batchIndex,{action:p.T.Delete,data:r,resolve:t,reject:n}):this.batchAttributesMap.set(this.batchIndex,{action:p.T.Set,data:c,resolve:t,reject:n}),c){var i={action:p.T.Set,key:s,value:c[s]};this.batchRoomAttributes.push(i)}r.forEach(function(l){l={action:p.T.Delete,key:l,value:""},u.batchRoomAttributes.push(l)}),this.batchIndex++},o.prototype.mergeStAttributeHandle=function(c){this.batchPushQueue.sort(function(h,m){return h.attribute_seq-m.attribute_seq});var r=this.batchPushQueue.findIndex(function(h){return h.attribute_seq>=c.attribute_seq}),t=(this.batchPushQueue=this.batchPushQueue.slice(r),this.batchPushQueue.unshift(c),this.batchPushQueue[this.batchPushQueue.length-1].attribute_seq),n={delete:{},set:{}},s=this.stRoomAttributes.attributes;for(s.map(function(h){h.seq=0}),r={localAttributes:s,batchPushQueue:this.batchPushQueue},this.logger.info(f,"mergeAttr",r);this.batchPushQueue.length;){var u=(a=this.batchPushQueue.shift()).attributes,a=a.attribute_seq;t&&a&&a<t||u.forEach(function(h){var m;h&&(m=s.find(function(g){return g.key==h.key}),s.findIndex(function(g){return g.key==h.key})!==-1?h.seq&&(m.seq=h.seq,m.value!==h.value&&(n.set[m==null?void 0:m.key]=h.value,m.value=h.value)):h.key&&h.seq&&(n.set[h.key]=h.value,s.push(k(k({},h),{value:h.value}))))})}var i,l=[];this.stRoomAttributes.attributes=s.filter(function(h){return h.seq==0&&(n.delete[h.key]=""),h.seq!==0}),Object.keys(n.set).length&&(i={action:p.T.Set,roomAttributes:n.set},l.push(i)),Object.keys(n.delete).length&&(i={action:p.T.Delete,roomAttributes:n.delete},l.push(i)),r={local:this.stRoomAttributes,infoList:l},this.logger.info(f,"mergeAttr",r),l.length&&this.eventBus.emit(p.t.RoomAttr,{roomID:this.groupID,infos:l}),this.stRoomAttributes.attribute_seq=t},o.prototype.getRecordFromStRoomAttributes=function(){if(!this.stRoomAttributes.attributes.length)return{};var c={};return this.stRoomAttributes.attributes.forEach(function(r){c[r.key]=r.value}),c},o.prototype.checkRoomAttributesUpdateByHb=function(c){var r=this;this.stRoomAttributes&&c.attribute_seq>this.stRoomAttributes.attribute_seq+1&&(this.attrTimer=setTimeout(function(){r.logger&&r.queryRoomAllAttributes()},this.mergeConfig.attrMergeTimeout))},o.prototype.fetchServerPageUser=function(c,r,t,n){var s=this;return c={room_id:this.groupID,room_session_id:this.sessionID,sub_room_id:this.subRoomID,count:c,pos_flag:r,expect_seq:this.localSeq},n&&this.dataReport.beginNetworkRequest(p.c.room_userlist.cmd,n,t,c),this.connMgr.sendRequest(p.c.room_userlist,c,t).then(function(u){return u.code||(s.tatalMemberCount=u.user_count,s.localSeq=u.userlist_seq),u})},o.prototype.emitRoomStateChanged=function(c,r,t){this.state=c,this.eventBus.emit(p.t.RoomState,{roomID:this.groupID,state:c,event:r,extendedData:t||""})},o.prototype.emitRoomAttributesUpdated=function(c,r,t){var n;(r=r!==void 0&&r)&&c!=null&&c.attributes&&t!=null&&t.roomAttributes&&(n=t.roomAttributes,c.attributes.forEach(function(s){s.seq&&(s.value=n[s.key])})),this.stRoomAttributes=c||{attributes:[]},this.stRoomAttributes.attributes.length&&(r={action:p.T.Set,roomAttributes:this.getRecordFromStRoomAttributes()},this.eventBus.emit(p.t.RoomAttr,{roomID:this.groupID,infos:[r]}))},o.prototype.startHB=function(c){var r=this;!c||c<0||(this.stopHB(),this.hbTimer=setInterval(function(){var t;r.logger&&(t={room_id:r.groupID,room_session_id:r.sessionID,sub_room_id:r.subRoomID},r.connMgr.sendRequestWithHeartbeat(p.c.room_info.cmd,t).then(function(n){if(n.code==p.W)return r.stopHB();if(n.code){if(n.code==6000104&&r.hbTimeoutCount++,n.timeoutCount=r.hbTimeoutCount,r.hbTimeoutCount>=p.l.hbTimeoutMaxCount)r.stopHB(),r.emitRoomStateChanged(p.V.Connecting,p.U.NetworkInterrupted);else if(n.code==1||p.l.needReloginCodeList.indexOf(n.code)!=-1){r.stopHB();var s=p.U.NetworkDisconnected;switch(n.code){case 103015:s=p.U.ConnectTimeout;break;case 103021:s=p.U.RoomNotExist}r.emitRoomStateChanged(p.V.Disconnected,s)}n.state=r.state}else n.room_info_interval&&(r.hbTimeoutCount=0,r.tatalMemberCount=n.user_count,r.enabledOfflineMsg&&n.max_conv_msg_seq&&r.eventBus.exec(p.t.IConnectedRoom,r.groupID,n.max_conv_msg_seq),n.ulist_to&&(r.mergeConfig.listMergeTimeout=n.ulist_to),n.ulist_itvl&&(r.mergeConfig.listPullInterval=n.ulist_itvl),r.checkRoomAttributesUpdateByHb(n))}))},c))},o.prototype.stopHB=function(){this.hbTimer&&clearInterval(this.hbTimer),this.hbTimeoutCount=0,this.hbTimer=0},o.prototype.reset=function(){this.localSeq=0,this.attrItemSeq=0,this.isMergeUser=!1,this.tatalMemberCount=0,this.userMap.clear()},o.prototype.createUserList=function(c){return c?c.map(function(r){return{userID:r.user_id,userName:Object(I.f)(r.user_name)}}):[]},o.prototype.fetchAllUser=function(){var c=this,r={time:new Date,event:"fetchAllUser",roomID:this.groupID,localSeq:this.localSeq,tatalMemberCount:this.tatalMemberCount},t=1,n=++this.mergeMemberListSeq+this.groupID,s=[],u=function(l){s.push.apply(s,function(h,m,g){if(g||arguments.length===2)for(var y,w=0,M=m.length;w<M;w++)!y&&w in m||((y=y||Array.prototype.slice.call(m,0,w))[w]=m[w]);return h.concat(y||Array.prototype.slice.call(m))}([],S(c.createUserList(l.users)),!1)),l.pos_flag&&c.connMgr?(t++,c.fetchServerPageUser(100,l.pos_flag,p.i.SDK).then(u)):(l.degree=t,l.svrCount=s.length,c.updateUserList(s),r.localSeq_=c.localSeq,r.tatalMemberCount_=c.tatalMemberCount,r.dataReport=c.dataReport.endNetworkRequest(p.c.room_userlist.cmd,n,l),c.logger.info(f,"mergeUser",r))},a=Date.now(),i=this.lastFetchAllUserTime+this.mergeConfig.listPullInterval;setTimeout(function(){c.lastFetchAllUserTime=a,c.connMgr&&c.fetchServerPageUser(100,"",p.i.SDK,n).then(u)},a<i?i-a:0)},o.prototype.waitingMergeUser=function(c,r,t){var n,s,u,a=this;c<=this.localSeq?this.logger.info(f,"mergeUser",{roomID:this.groupID,event:"dropMerge",action:t,seq:c,localSeq:this.localSeq,tatalMemberCount:this.tatalMemberCount}):c!=this.localSeq+1||this.mergeTimer?(this.mergeSeqList.indexOf(c)==-1&&this.mergeSeqList.push(c),n=r.userID,u=this.mergeUserList.findIndex(function(i){return i.userID==n}),t=="enter"&&u==-1?this.mergeUserList.push(r):t=="quit"&&u!=-1&&this.mergeUserList.splice(u,1),this.mergeTimer||(s={roomID:this.groupID,event:"waitingPush",action:t,seq:c,localSeq:this.localSeq,tatalMemberCount:this.tatalMemberCount},this.mergeSeqList.indexOf(this.localSeq)==-1&&this.mergeSeqList.push(this.localSeq),this.mergeTimer=setTimeout(function(){var i;a.logger&&(a.mergeSeqList.sort(),i=a.mergeSeqList.length-1,(i=a.mergeSeqList[i]-a.mergeSeqList[0]==i)?a.updateUserList(a.mergeUserList):a.fetchAllUser(),Object.assign(s,{time:a.mergeConfig.listMergeTimeout,localSeq_:a.localSeq,tatalMemberCount_:a.tatalMemberCount,continuous:i,mergeSeqList:a.mergeSeqList}),a.logger.info(f,"mergeUser",s),a.mergeTimer=0,a.mergeSeqList.length=0,a.mergeUserList.length=0)},this.mergeConfig.listMergeTimeout))):(this.localSeq=c,u=this.userMap.has(r.userID),t!="enter"||u?t=="quit"&&u&&(this.userMap.delete(r.userID),this.eventBus.emit(p.t.RoomMemberLeft,{roomID:this.groupID,memberList:[k({},r)]})):(this.userMap.set(r.userID,r),this.eventBus.emit(p.t.RoomMemberJoined,{roomID:this.groupID,memberList:[k({},r)]})),r={roomID:this.groupID,event:"continuousMerge",action:t,has:u,seq:c,localSeq:this.localSeq,tatalMemberCount:this.tatalMemberCount},this.logger.info(f,"mergeUser",r))},o.prototype.updateUserList=function(c){var r=this,t=c.map(function(u){return u.userID}),n=Array.from(this.userMap.values()),s=(c=c.filter(function(u){var a=!r.userMap.has(u.userID);return a&&r.userMap.set(u.userID,k({},u)),a}),n.filter(function(u){var a=t.indexOf(u.userID)==-1;return a&&r.userMap.delete(u.userID),a}));c.length&&this.eventBus.emit(p.t.RoomMemberJoined,{roomID:this.groupID,memberList:c}),s.length&&this.eventBus.emit(p.t.RoomMemberLeft,{roomID:this.groupID,memberList:s}),n={roomID:this.groupID,event:"updateRoomMember",localSeq:this.localSeq,tatalMemberCount:this.tatalMemberCount,mergeIds:t,beginLocalIds:n.map(function(u){return u.userID}),endLocalIDs:Array.from(this.userMap.keys()),joinedUserIDs:c.map(function(u){return u.userID}),leftUserIDs:s.map(function(u){return u.userID})},this.logger.info(f,"mergeUser",n)},O([Object(I.m)(p.l.get_user_attribute_qps,p.l.get_user_attribute_interval,p.I.QueryRoomMembersAttributes)],o.prototype,"queryRoomMembersAttributes",null),O([Object(I.m)(p.l.get_user_attribute_qps,p.l.get_user_attribute_interval,p.I.QueryRoomMemberAttributesList)],o.prototype,"queryRoomMemberAttributesList",null),o);function o(c,r,t,n,s){this.type=p.q.Room,this.state=p.V.Disconnected,this.subRoomID="",this.enabledOfflineMsg=!1,this.destroyDelay=0,this.userMap=new Map,this.userAttributeMap=new Map,this.tatalMemberCount=0,this.isMergeUser=!1,this.mergeMemberListSeq=0,this.mergeTimer=0,this.mergeSeqList=[],this.mergeUserList=[],this.mergeConfig={listMergeTimeout:0,listPullInterval:0,attrMergeTimeout:0,attrPullInterval:0},this.lastFetchAllUserTime=0,this.hbTimer=0,this.hbTimeoutCount=0,this.localSeq=0,this.userAttrSeq=0,this.attrItemSeq=0,this.stRoomAttributes={attributes:[],attribute_seq:0},this.localAttrKeySeqMap={},this.batchOperationConfig=null,this.batchRoomAttributes=[],this.batchAttributesMap=new Map,this.batchIndex=0,this.batchFlag=!1,this.batchPushQueue=[],this.queryAttrFlag=!1,this.attrTimer=null,this.queryAttrTask=[],this.groupID=c,this.engineConfig=r,this.logger=T.a.getInstance().logger,this.dataReport=T.a.getInstance().dataReport,this.eventBus=t,this.dbMgr=n,this.connMgr=s}},function(Q,O,b){b.d(O,"a",function(){return d});var T=b(2),I=b(1),p=b(0),k=function(){return(k=Object.assign||function(c){for(var r,t=1,n=arguments.length;t<n;t++)for(var s in r=arguments[t])Object.prototype.hasOwnProperty.call(r,s)&&(c[s]=r[s]);return c}).apply(this,arguments)},S=function(c,r){var t=typeof Symbol=="function"&&c[Symbol.iterator];if(!t)return c;var n,s,u=t.call(c),a=[];try{for(;(r===void 0||0<r--)&&!(n=u.next()).done;)a.push(n.value)}catch(i){s={error:i}}finally{try{n&&!n.done&&(t=u.return)&&t.call(u)}finally{if(s)throw s.error}}return a},f=p.J.User,d=(Object.defineProperty(o.prototype,"renewTokenTimeout",{get:function(){return 30},enumerable:!1,configurable:!0}),o.prototype.destroy=function(){this.stopUserHB(!0),this.stopMailHB(),this.updateLocalToken("",0),this.settings.unInitEngine(this.engineConfig.handle,!0),this.connMgr=null,this.eventBus=null,this.logger=null,this.settings=null,this.dataReport=null,this.crypto=null,this.engineConfig=null},o.prototype.login=function(c,r){var t,n=this,s=S(Object(I.k)(r,0),2),u=s[0],a=s[1];if(u)return t=Object(I.s)(u),this.logger.warn(f,p.I.Login,{error:t,expireTime:a,token:r}),Promise.reject(t);if(this.loginState==p.k.Reconnecting||this.loginState==p.k.Connecting)return new Promise(function(l,h){n.engineConfig.user.userID==c.userID&&(n.lastLoginExecutor.token=r,n.lastLoginExecutor.expireTime=a,n.lastLoginExecutor.resolve=l,n.lastLoginExecutor.reject=h)});if(this.loginState==p.k.Connected)return this.engineConfig.user.userID!==c.userID?(s={error:t=Object(I.s)(p.s.NetworkModuleUserHasAlreadyLogged),userID:c.userID,oldUserID:this.engineConfig.user.userID},this.logger.warn(f,p.I.Login,s),Promise.reject(t)):(this.updateSvrToken(r,a),this.emitConnectionStateChanged(p.k.Connected,p.j.ActiveLogin),Promise.resolve());this.engineConfig.user.userID=c.userID,c.userName&&(this.engineConfig.user.userName=c.userName),this.lastLoginExecutor.token=r,this.lastLoginExecutor.expireTime=a,this.dbMgr.setUserID(c.userID),this.logger.init(this.engineConfig.appID+"",c),this.initDataReport(r);var i={time:new Date,action:"apicall",userInfo:c,expireTime:a};return this.loginState=p.k.Connecting,this.loginConsumeds.length=0,this.connMgr.create().then(function(l){return n.lastLoginExecutor.url=l,n.sendLoginRequest(p.i.API,i,!0,!0).then(function(){return n.reportZPNs()},function(h){var m;throw h&&h.code||(i.error=h,n.logger.warn(f,p.I.Login,i),m=(h=h||Object(I.s)(p.s.NetworkModuleNetworkError,"Login error.")).stack||h.message,n.dataReport.reportSDKEvent("/sdk/log",{error_message:"API.login:"+m}),n.logger.upload("login error",!0)),n.lastLoginExecutor.reject&&n.lastLoginExecutor.reject(h),n.lastLoginExecutor.reject=null,h})})},o.prototype.logout=function(c){var r,t=this;this.logger&&(c||this.logger.info(f,p.I.Logout,{state:this.loginState}),r={logout_check:this.k1SignLogoutBuffer,reason:c},this.connMgr.sendRequest(p.c.sw_logout,r,c?p.i.SDK:p.i.API),setTimeout(function(){return(!t.engineConfig||!t.engineConfig.token)&&t.connMgr.close()},50),this.stopUserHB(!0),this.stopMailHB(),this.updateLocalToken("",0),this.settings.unInitEngine(this.engineConfig.handle),this.dbMgr.unloadDB(),this.eventBus.exec(p.t.ILogout),this.loginState!==p.k.Disconnected&&this.emitConnectionStateChanged(p.k.Disconnected,p.j.Success))},o.prototype.renewToken=function(c){var r,t,n=this,s=(t=S(Object(I.k)(c,this.engineConfig.tokenExpireTime),2))[0],u=t[1];if(s)return r=Object(I.s)(s),this.logger.warn(f,p.I.RenewToken,{error:r,expireTime:u,token:c}),Promise.reject(r);if((t=Date.now())-this.lastRenewTokenTime<500)return r=Object(I.s)(p.s.CommonModuleTriggerSDKFrequencyLimit),this.logger.warn(f,p.I.RenewToken,r),Promise.reject(r);var a={time:this.lastRenewTokenTime=t};return s={user_name:Object(I.i)(c),sdk_duration:u-Math.floor(Date.now()/1e3)},this.connMgr.sendRequest(p.c.sw_renew_token,s,p.i.API).then(function(i){return i.code?(i=Object(I.s)(p.s.NetworkModuleTokenInvalid,i.message,i.code),a.error=i,n.logger.warn(f,p.I.RenewToken,a),Promise.reject(i)):(n.updateLocalToken(c,u),n.startCheckTokenExpireTime(u),n.logger.info(f,p.I.RenewToken,a),{token:c})})},o.prototype.updateUserName=function(c){var r=this,t={time:new Date,userName:c},n={user_name:Object(I.i)(c),set_flag:1};return this.connMgr.sendRequest(p.c.modify_user_info,n).then(function(s){return s.code?(s=Object(I.s)(p.s.CommonModuleIMServerError,s.message,s.code),t.error=s,r.logger.warn(f,p.I.UpdateUserName,t),Promise.reject(s)):(r.engineConfig.user.userName=c,r.dbMgr.setUser(r.engineConfig.user),r.eventBus.exec(p.t.IUpdateSelf),r.logger.info(f,p.I.UpdateUserName,t),{userName:c})})},o.prototype.updateUserExtendedData=function(c){var r=this,t={time:new Date,extendedData:c},n={user_name:Object(I.i)(c),set_flag:10};return this.connMgr.sendRequest(p.c.modify_user_info,n).then(function(s){return s.code?(s=Object(I.s)(p.s.CommonModuleIMServerError,s.message,s.code),t.error=s,r.logger.warn(f,p.I.UpdateUserExtendedData,t),Promise.reject(s)):(r.engineConfig.user.extendedData=c,r.dbMgr.setUser(r.engineConfig.user),r.logger.info(f,p.I.UpdateUserExtendedData,t),{extendedData:c})})},o.prototype.updateUserAvatarUrl=function(c){var r=this,t={time:new Date,userAvatarUrl:c},n={user_name:Object(I.i)(c),set_flag:16};return this.connMgr.sendRequest(p.c.modify_user_info,n).then(function(s){return s.code?(s=Object(I.s)(p.s.CommonModuleIMServerError,s.message,s.code),t.error=s,r.logger.warn(f,p.I.UpdateUserAvatarUrl,t),Promise.reject(s)):(r.engineConfig.user.userAvatarUrl=c,r.dbMgr.setUser(r.engineConfig.user),r.eventBus.exec(p.t.IUpdateSelf),r.logger.info(f,p.I.UpdateUserAvatarUrl,t),{userAvatarUrl:c})})},o.prototype.reportZPNs=function(){var c=this.engineConfig.ZPNsPushID;c&&this.loginState==p.k.Connected&&this.connMgr.sendRequest(p.c.userstate_zpns_report,{key:c},p.i.SDK)},o.prototype.onConnected=function(c){var r,t,n,s=this;(c||this.needRelogin)&&(r={time:new Date,isReconnect:c,action:"onConnected"},this.needRelogin&&(this.needRelogin=!1,r.action+=p.c.sw_push_kickout.cmd),t=(n=this.engineConfig).token,n=n.tokenExpireTime,t&&n?(this.loginState=p.k.Reconnecting,this.connMgr.create().then(function(u){return s.lastLoginExecutor.url=u,s.sendLoginRequest(p.i.SDK,r)}).then(function(){c&&s.initMailHB().then(function(){return s.eventBus.exec(p.t.IConnected)})}).catch(function(u){s.lastLoginExecutor.reject&&s.lastLoginExecutor.reject(u),s.lastLoginExecutor.reject=null})):(r.error="token is null",this.logger.warn(f,p.I.Login,r)))},o.prototype.onDisConnected=function(c){c?(this.stopUserHB(c),this.stopMailHB(),this.emitConnectionStateChanged(p.k.Disconnected,p.j.LoginTimeout),this.eventBus.emit(p.t.Error,Object(I.s)(p.s.NetworkModuleNetworkError))):this.emitConnectionStateChanged(p.k.Reconnecting,p.j.LoginInterrupted),this.eventBus.exec(p.t.IDisConnected,c)},o.prototype.onPushRedirect=function(c){c&&c.length&&(this.lastLoginExecutor.push=!0,this.createConnection(c,p.c.sw_push_redirect.cmd))},o.prototype.onPushKickout=function(c){c.seq==1?this.needRelogin=!0:(c={reason:c.code,message:c.key},this.closeConnection(p.j.KickedOut,JSON.stringify(c)))},o.prototype.onPushAccesshub=function(c){var r,t,n,s=this;c._type==19||c._type==20?(r=(t=this.engineConfig).token,t=t.tokenExpireTime,this.PCEstablished._type==20&&r&&t&&(n={time:new Date,action:"MSG_TYPE_PC_BROKEN"},this.loginState=p.k.Reconnecting,this.connMgr.create().then(function(u){return s.lastLoginExecutor.url=u,s.sendLoginRequest(p.i.SDK,n)}).catch(function(u){s.lastLoginExecutor.reject&&s.lastLoginExecutor.reject(u),s.lastLoginExecutor.reject=null})),Object.assign(this.PCEstablished,c)):c._type==30&&c.reason==20010&&(this.handleLoginRedirectRequest(!0,p.s.CommonModuleUnactivatedIMServer),this.eventBus.emit(p.t.Error,Object(I.s)(p.s.CommonModuleUnactivatedIMServer)))},o.prototype.onPushUpdateUserInfo=function(c){var r=this.engineConfig.user;r.userName=Object(I.f)(c.userName),r.extendedData=Object(I.f)(c.extendedData),r.userAvatarUrl=Object(I.f)(c.userAvatarUrl),this.dbMgr.setUser(r),c.set_flag!=10&&this.eventBus.exec(p.t.IUpdateSelf),c={baseInfo:{userID:r.userID,userName:r.userName},userAvatarUrl:r.userAvatarUrl,extendedData:r.extendedData},this.eventBus.emit(p.t.UserInfoUpdated,{info:c})},o.prototype.initDataReport=function(c,r){var t=(n=S(this.settings.fetchZGLogConfig(this.engineConfig.handle),2))[0],n=n[1];if(this.logger.setUploadURL(t),this.dataReport.init(this.engineConfig.appID,n),this.dataReport.start(this.engineConfig.user.userID,c,r?n:void 0),r){for(var s=[this.loginConsumeds[0]-r],u=this.loginConsumeds.length-1;0<u;u--)s[u]=this.loginConsumeds[u]-this.loginConsumeds[u-1];c=k(k({times:s.join()},this.PCEstablished),{logger:t,report:n}),this.logger.info(p.J.Connection,"fetchSetting",c),this.dataReport.reportSDKEvent("/sdk/init",{time_consumed:Date.now()-r,error_message:c.times,sdk_config:JSON.stringify(Object.assign(c,this.engineConfig.cloudSetting))})}},o.prototype.createConnection=function(c,r,t){var n=this,s={time:new Date,action:r,serveres:c};return c[0].indexOf("wss://")==0&&this.connMgr.setUrls(c),this.dataReport.reportSDKEvent("/sdk/reconnect",{domain:c}),this.handleLoginRedirectRequest(!1),this.loginState=p.k.Connecting,this.connMgr.create().then(function(u){return n.lastLoginExecutor.url=u,n.sendLoginRequest(p.i.SDK,s,t)}).catch(function(u){throw n.handleLoginRedirectRequest(!0),n.lastLoginExecutor.reject&&n.lastLoginExecutor.reject(u),n.lastLoginExecutor.reject=null,u})},o.prototype.sendHandshakeRequest=function(){this.connMgr.sendRequestWithNoRsp(p.c.sw_handshake_req.cmd,k({},this.settings.deviceInfo))},o.prototype.sendLoginRequest=function(c,r,t,n){var s=this,u=(this.sendHandshakeRequest(),this.emitConnectionStateChanged(this.loginState,p.j.ActiveLogin),this.engineConfig.token||this.lastLoginExecutor.token),a=this.engineConfig.tokenExpireTime||this.lastLoginExecutor.expireTime,i=(t&&(this.loginConsumeds.push(Date.now()),this.connMgr.sendDispatchRequest(),this.settings.startSyncRemoteConfig(this.connMgr,this.engineConfig.handle,u).then(function(l){l&&s.eventBus.exec(p.t.INetworkChange,"fetchSetting")})),k(k({},this.settings.deviceInfo),{user_name:Object(I.i)(this.engineConfig.user.userName),client_stamp:Object(I.i)(this.crypto.generateNonce()),k1_sign:this.crypto.generateK1Sign(this.engineConfig),login_token:Object(I.i)(u),sdk_action:r.action,sdk_duration:a-Math.floor(Date.now()/1e3),sdk_server_ip:this.lastLoginExecutor.url,sdk_session_timeout:!t&&this.engineConfig.sessionID?this.hbMap.timeout:void 0}));return!t&&this.engineConfig.sessionID&&this.hbMap.timeout>Date.now()&&(i.old_session_id=this.engineConfig.sessionID),this.reloginTokenBuffer&&(i.relogin_token=this.reloginTokenBuffer),this.engineConfig.ZPNsPushID&&(i.zpns_push_id=this.engineConfig.ZPNsPushID),c=this.connMgr.sendRequest(p.c.sw_login,i,c),n&&(this.lastLoginExecutor.seq=i._seq),c.then(function(l){var h=l.code;if(h){if((m=l.redirect_server)&&m.length)return s.createConnection(m,"redirect login error code: "+h,t);if(h==50106||h==50107)return h==50106&&(s.engineConfig.sessionID=void 0),s.sendLoginRequest(p.i.SDK,r,t,n);if(h==6000104&&s.lastLoginExecutor.push)return;var m=1e3*a,g=(h==50111&&m&&m<Date.now()?s.closeConnection(p.j.LoginInterrupted,"Token expire"):h==102005?s.closeConnection(p.j.KickedOut,""):s.emitConnectionStateChanged(p.k.Disconnected,p.j.LoginInterrupted),s.lastLoginExecutor.push=!1,h==p.s.CommonModuleUnactivatedIMServer?Object(I.s)(p.s.CommonModuleUnactivatedIMServer):Object(I.s)(p.s.NetworkModuleServerError,l.message,h));return r.error=g,s.logger.warn(f,p.I.Login,r),Promise.reject(g)}if(h!=p.s.Success){s.reloginTokenBuffer=l.relogin_token,s.k1SignLogoutBuffer=s.crypto.md5Bytes(i.k1_sign),s.engineConfig.sessionID=l.rspHeader.session_id,s.engineConfig.serverUserID=l.rspHeader.user_nid,s.engineConfig.controls=l.rspHeader.controls,s.settings.serverOffsetTime=l.server_timestamp-Date.now(),s.crypto.decryptK2Sign(l.k2_sign,s.engineConfig),s.lastLoginExecutor.push=!1,s.startUserHB(l.hb_interval,l.hb_timeout),s.startMailHB(),s.updateLocalToken(u,a),s.startCheckTokenExpireTime(a);try{var y=JSON.parse(l.im_conf_json);r.im_conf_json=y,s.setMailHBFetchConfig(y)}catch{}if(s.emitConnectionStateChanged(p.k.Connected,p.j.Success),r.seq=s.handleLoginRedirectRequest(!0),t)return s.loadDB(r);s.loginEnd(r,!1)}})},o.prototype.updateLocalToken=function(c,r){this.engineConfig.token=c,this.engineConfig.tokenExpireTime=r,this.dataReport.start(this.engineConfig.user.userID,c),this.logger.renewToken(c)},o.prototype.updateSvrToken=function(c,r){var t,n=this;c&&this.engineConfig.tokenExpireTime<r&&(t={user_name:Object(I.i)(c),sdk_duration:r-Math.floor(Date.now()/1e3)},this.connMgr.sendRequest(p.c.sw_renew_token,t,p.i.SDK).then(function(s){s.code||(n.updateLocalToken(c,r),n.startCheckTokenExpireTime(r))}))},o.prototype.startUserHB=function(c,r){var t=this;!c||c<0||(this.hbMap.timeout=1.5*r+Date.now(),this.stopUserHB(!1),this.hbMap.userTimer=setInterval(function(){t.logger&&t.connMgr.sendRequestWithHeartbeat(p.c.sw_hb.cmd,void 0).then(function(n){return n.code==p.W?t.stopUserHB(!0):n.code?(n.code==6000104&&t.hbMap.userTimeoutCount++,n.timeoutCount=t.hbMap.userTimeoutCount,(n.code==1||n.code==50012||t.hbMap.userTimeoutCount>=p.l.hbTimeoutMaxCount)&&(t.stopUserHB(!1),t.onConnected(!0)),p.l.needReloginCodeList.indexOf(n.code)!=-1&&t.closeConnection(p.j.LoginInterrupted,"Session id invalid"),void(n.state=t.loginState)):void(n.server_timestamp&&(t.hbMap.userTimeoutCount=0,t.settings.serverOffsetTime=n.server_timestamp-Date.now(),n.hb_timeout==r&&(t.hbMap.timeout=1.5*n.hb_timeout+Date.now())))})},c))},o.prototype.stopUserHB=function(c){this.hbMap.userTimer&&clearInterval(this.hbMap.userTimer),this.hbMap.userTimeoutCount=0,this.hbMap.userTimer=0,c&&(this.renewTokenTimer&&clearTimeout(this.renewTokenTimer),this.expireTokenTimer&&clearTimeout(this.expireTokenTimer),this.renewTokenTimer=0,this.expireTokenTimer=0)},o.prototype.startMailHB=function(){var c=this,r=this.engineConfig.mailHBConfig.usermail_hb_interval;!r||r<0||(this.stopMailHB(),this.hbMap.mailTimer=setInterval(function(){var t;c.logger&&(t={conv:(t=c.engineConfig.user).convSeq,group:t.groupSeq,call:t.callSeq,pin:t.convPinnedSeq,c2c_state:t.c2cMsgStateSeq,extra_msg:t.msgExtraSeq},t={conv_sid:c.engineConfig.user.convSeq||"1",db_seq_json:t},c.connMgr.sendRequestWithHeartbeat(p.c.usermail_hb.cmd,t).then(function(n){return n.code==p.W?c.stopMailHB():n.code?(n.code==6000104&&c.hbMap.mailTimeoutCount++,n.timeoutCount=c.hbMap.mailTimeoutCount,void((n.code==1||c.hbMap.mailTimeoutCount>=p.l.hbTimeoutMaxCount||p.l.needReloginCodeList.indexOf(n.code)!=-1)&&c.stopMailHB())):(c.setMailHBFetchConfig(n,!0),void c.eventBus.exec(p.t.ITriggerHB))}))},r))},o.prototype.stopMailHB=function(){this.hbMap.mailTimer&&clearInterval(this.hbMap.mailTimer),this.hbMap.mailTimeoutCount=0,this.hbMap.mailTimer=0},o.prototype.startCheckTokenExpireTime=function(c){var r=this,t=(this.renewTokenTimer&&clearTimeout(this.renewTokenTimer),this.expireTokenTimer&&clearTimeout(this.expireTokenTimer),Math.min(2073600,c-Math.floor(Date.now()/1e3)));t<this.renewTokenTimeout?(this.logger.info(f,"tokenWillExpire","token will expire: "+t),this.eventBus.emit(p.t.TokenExpire,{second:t})):this.renewTokenTimer=setTimeout(function(){r.logger&&(r.logger.info(f,"tokenWillExpire","token will expire: "+t),r.eventBus.emit(p.t.TokenExpire,{second:r.renewTokenTimeout}))},1e3*(t-this.renewTokenTimeout)),this.expireTokenTimer=setTimeout(function(){return r.logout("token expire")},1e3*(t-2))},o.prototype.emitConnectionStateChanged=function(c,r,t){this.loginState=c,this.eventBus.emit(p.t.ConnState,{state:c,event:r,extendedData:t||""})},o.prototype.handleLoginRedirectRequest=function(c,r){r===void 0&&(r=p.s.Success);var t=0;return this.lastLoginExecutor.seq&&(t=this.connMgr.responseRequest(this.lastLoginExecutor.seq,c,r)),c&&(this.lastLoginExecutor.seq=0),t},o.prototype.closeConnection=function(c,r){this.logger.upload(r),this.stopUserHB(!0),this.stopMailHB(),this.updateLocalToken("",0),this.settings.unInitEngine(this.engineConfig.handle),this.dbMgr.unloadDB(),this.eventBus.exec(p.t.ILogout,r),this.connMgr.close(),this.emitConnectionStateChanged(p.k.Disconnected,c,r)},o.prototype.setMailHBFetchConfig=function(c,r){var t=c.c2c_msg_seq,n=c.conv_list_seq,s=c.group_list_seq,u=c.call_list_seq,a=c.conv_pinned_list_seq,i=c.c2c_statemsg_seq,l=c.extra_msg_list_seq;c=function(h,m){var g={};for(w in h)Object.prototype.hasOwnProperty.call(h,w)&&m.indexOf(w)<0&&(g[w]=h[w]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,w=Object.getOwnPropertySymbols(h);y<w.length;y++)m.indexOf(w[y])<0&&Object.prototype.propertyIsEnumerable.call(h,w[y])&&(g[w[y]]=h[w[y]]);return g}(c,["c2c_msg_seq","conv_list_seq","group_list_seq","call_list_seq","conv_pinned_list_seq","c2c_statemsg_seq","extra_msg_list_seq"]),Object.assign(this.engineConfig.mailHBConfig,c),t&&(this.engineConfig.mailHBConfig.c2c_msg_seq=t),n&&(this.engineConfig.mailHBConfig.conv_list_seq=n),s&&(this.engineConfig.mailHBConfig.group_list_seq=s),u&&(this.engineConfig.mailHBConfig.call_list_seq=u),a&&(this.engineConfig.mailHBConfig.conv_pinned_list_seq=a),i&&(this.engineConfig.mailHBConfig.c2c_statemsg_seq=i),l&&(this.engineConfig.mailHBConfig.extra_msg_list_seq=l),r&&(c=null,(t=this.engineConfig.user).convSeq&&t.convSeq!=n.toString()&&((c=c||{}).conv=t.convSeq+","+n.toString()),t.groupSeq&&t.groupSeq!=s.toString()&&((c=c||{}).group=t.groupSeq+","+s.toString()),t.callSeq&&t.callSeq!=u.toString()&&((c=c||{}).call=t.callSeq+","+u.toString()),t.convPinnedSeq&&t.convPinnedSeq!=a&&((c=c||{}).pin=t.convPinnedSeq+","+a),t.c2cMsgStateSeq&&t.c2cMsgStateSeq!=i.toString()&&((c=c||{}).c2c_state=t.c2cMsgStateSeq+","+i.toString()),t.msgExtraSeq&&t.msgExtraSeq!=l.toString()&&((c=c||{}).extra_msg=t.msgExtraSeq+","+l.toString()),c&&this.logger.info(p.J.Conversation,"hb",c))},o.prototype.loginEnd=function(c,r){r&&this.logger.info(f,p.I.Login,c),this.lastLoginExecutor.resolve&&this.lastLoginExecutor.resolve(),this.lastLoginExecutor.resolve=null,this.updateSvrToken(this.lastLoginExecutor.token,this.lastLoginExecutor.expireTime),this.lastLoginExecutor.token=""},o.prototype.syncUser=function(c,r){var t=this,n=r.find(function(s){return s.userID==c});return n?n.userName=this.engineConfig.user.userName||n.userName:n={userID:c,userName:this.engineConfig.user.userName,convSeq:"0",groupSeq:"0",msgExtraSeq:"0",c2cMsgStateSeq:"0",convPinnedSeq:0,callSeq:"0"},this.logger.info(f,"getDBUser",n),Object.assign(this.engineConfig.user,n),this.engineConfig.user.userName?this.dbMgr.setUser(this.engineConfig.user):this.connMgr.sendRequest(p.c.fetch_user_info,{_ev_:"login",quey_user_id:[c]},p.i.SDK).then(function(s){(s=s.result&&s.result[0])&&(t.engineConfig.user.userName=Object(I.f)(s.user_name),t.engineConfig.user.userAvatarUrl=Object(I.f)(s.avatar),t.dbMgr.setUser(t.engineConfig.user))}),r},o.prototype.initMailHB=function(){var c=this,r={conv:(r=this.engineConfig.user).convSeq,group:r.groupSeq,call:r.callSeq,pin:r.convPinnedSeq,c2c_state:r.c2cMsgStateSeq,extra_msg:r.msgExtraSeq};return r={conv_sid:this.engineConfig.user.convSeq||"1",db_seq_json:r},this.connMgr.sendRequest(p.c.usermail_hb,r,p.i.SDK).then(function(t){t.code||c.setMailHBFetchConfig(t)})},o.prototype.loadDB=function(c){var r=this;return this.loginConsumeds.push(Date.now()),this.initMailHB().then(function(){return r.loginConsumeds.push(Date.now()),Promise.all([r.dbMgr.getUserList().then(function(t){return r.syncUser(r.engineConfig.user.userID,t)}),r.dbMgr.getConversationList(),r.dbMgr.getGroupList(),r.dbMgr.getMessageExtraList(),r.dbMgr.getCallList()]).then(function(t){r.loginConsumeds.push(Date.now()),r.initDataReport(r.engineConfig.token,c.time.getTime()),r.loginEnd(c,!0),r.fetchLogReportWhiteList(r.settings.fetchZGLogWhitelistUrl(r.engineConfig.handle)),t={users:t[0],convs:t[1],groups:t[2],msgs:t[3],calls:t[4]},r.eventBus.exec(p.t.ILogined,t)})})},o.prototype.clearDB=function(c){var r=this.engineConfig.user;r.convSeq="0",r.groupSeq="0",r.msgExtraSeq="0",r.c2cMsgStateSeq="0",r.convPinnedSeq=0,r.callSeq="0",this.dbMgr.clearDB(k({},r)),c&&this.eventBus.exec(p.t.ILogout,!0)},o.prototype.fetchLogReportWhiteList=function(c){var r,t=this,n={product:"zim",biz_type:1,appid:this.engineConfig.appID+"",uin:encodeURIComponent(this.engineConfig.user.userID),token:encodeURIComponent(this.engineConfig.token),timestamp:Date.now()+"",deviceid:this.settings.deviceInfo.device_id},s=Object.keys(n).map(function(u){return u+"="+n[u]}).join("&");c+="?"+s,I.n?I.n.request({url:c,data:s,success:function(u){try{var a=typeof u.data=="string"?JSON.parse(u.data):u.data;a&&a.code==0?t.logger.upload("login with whitelist",!0):t.logger.upload("login with not present in whitelist")}catch{}},fail:function(){return t.logger.upload("login with error whitelist")}}):((r=new XMLHttpRequest).onreadystatechange=function(){if(r.readyState==4&&(200<=r.status&&r.status<300||r.status==304))try{var u=JSON.parse(r.responseText);u&&u.code==0?t.logger.upload("login with whitelist",!0):t.logger.upload("login with not present in whitelist")}catch{t.logger.upload("login with error whitelist")}},r.open("GET",c,!0),r.send())},o);function o(c,r,t,n){this.hbMap={timeout:0,userTimer:0,userTimeoutCount:0,mailTimer:0,mailTimeoutCount:0},this.loginState=p.k.Disconnected,this.loginConsumeds=[],this.needRelogin=!1,this.lastLoginExecutor={seq:0,push:!1,url:"",token:"",expireTime:0,resolve:null,reject:null},this.lastRenewTokenTime=0,this.PCEstablished={_type:0},this.logger=T.a.getInstance().logger,this.dataReport=T.a.getInstance().dataReport,this.settings=T.a.getInstance().settings,this.crypto=T.a.getInstance().crypto,this.engineConfig=c,this.eventBus=r,this.connMgr=t,this.dbMgr=n}},function(Q,O,b){b.d(O,"a",function(){return c}),O=b(3);var T=b.n(O),I=b(2),p=b(1),k=b(0),S=function(){return(S=Object.assign||function(t){for(var n,s=1,u=arguments.length;s<u;s++)for(var a in n=arguments[s])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)},f=function(t,n){var s=typeof Symbol=="function"&&t[Symbol.iterator];if(!s)return t;var u,a,i=s.call(t),l=[];try{for(;(n===void 0||0<n--)&&!(u=i.next()).done;)l.push(u.value)}catch(h){a={error:h}}finally{try{u&&!u.done&&(s=i.return)&&s.call(i)}finally{if(a)throw a.error}}return l},d=function(t,n,s){if(s||arguments.length===2)for(var u,a=0,i=n.length;a<i;a++)!u&&a in n||((u=u||Array.prototype.slice.call(n,0,a))[a]=n[a]);return t.concat(u||Array.prototype.slice.call(n))},o=k.J.Call,c=(r.prototype.destroy=function(){this.onLogout(),this.connMgr=null,this.eventBus=null,this.logger=null},r.prototype.callInvite=function(t,n){var s=this,u={time:new Date,invitees:t,config:n},a=(n.mode=n.mode||k.f.General,n.timeout=+n.timeout||90,t=Array.from(new Set(t.filter(function(l){return Object(p.l)(l)}))),Object(p.j)()),i={call_id:a,call_mode:n.mode,timeout:n.timeout,user_ids:t,payload:this.encodeExtendedData(n),offline_info:Object(p.e)(n.pushConfig)};return this.connMgr.sendRequest(k.c.call_create,i).then(function(l){if(l.code)return h=Object(p.s)(k.s.CallModuleServerError,l.message,l.code),u.error=h,s.logger.warn(o,k.I.CallInvite,u),Promise.reject(h);s.updateCallListSeq(l.call_list_seq),l.timeout||(l.timeout=i.timeout),s.createInviteTimeout(a,t,l.timeout);var h=+l.create_time.toString(),m=((y={})[s.engineConfig.user.userID]={userID:s.engineConfig.user.userID,state:k.h.Accepted,extendedData:"",acceptTime:0,quitTime:0,timeout:0},y),g=l.new_err_list.map(function(M){return{userID:M.user_id,reason:M.sub_code}}),y=l.err_list.map(function(M){return{userID:M.user_id,state:s.translateUserState(M),extendedData:""}}),w=((w=t.filter(function(M){return!g.find(function(R){return R.userID==M})}).map(function(M){return M={userID:M,state:k.h.Inviting,extendedData:""},m[M.userID]=S(S({},M),{acceptTime:0,quitTime:0,timeout:l.timeout}),M})).unshift({userID:s.engineConfig.user.userID,state:k.h.Accepted,extendedData:""}),s.eventBus.emit(k.t.CallUserState,{callID:a,callUserList:w}),{callID:a,caller:s.engineConfig.user.userID,mode:n.mode,state:k.g.Started,extendedData:n.extendedData,createTime:h,endTime:0,timeout:l.timeout,inviter:s.engineConfig.user.userID,callDuration:0,userDuration:0,callUserMap:m});return s.dbCallMap.set(a,w),s.dbMgr.addCallList([w]),s.logger.info(o,k.I.CallInvite,u),{callID:a,timeout:l.timeout,errorUserList:g,errorInvitees:y}})},r.prototype.callCancel=function(t,n,s,u){var a=this,i=(u===void 0&&(u=k.e.Cancel),{time:new Date,callID:n,state:u,config:s,invitees:t}),l=(t=Array.from(new Set(t.filter(function(g){return Object(p.l)(g)}))),s.extendedData||""),h={call_id:n,user_ids:t,timeout:u,payload:this.encodeExtendedData(s),offline_info:Object(p.e)(s.pushConfig)},m=u==k.e.Cancel?k.i.API:k.i.SDK;return this.connMgr.sendRequest(k.c.call_cancel,h,m).then(function(g){var y=a.dbCallMap.get(n);if(g.code)return M=Object(p.s)(k.s.CallModuleServerError,g.message,g.code),i.error=M,a.logger.warn(o,k.I.CallCancel,i),Promise.reject(M);a.updateCallListSeq(g.now_time);var w,M,R=g.err_list.map(function(D){return D.user_id});return y&&(u==k.e.Cancel?(y.state=k.g.Ended,(M=y.callUserMap[a.engineConfig.user.userID])&&(M.state=k.h.Cancelled,M.extendedData=s.extendedData)):y.mode==k.f.General&&(y.state=k.g.Ended),w=[],M=t.filter(function(D){return R.indexOf(D)==-1}).map(function(D){w.push(D),D={userID:D,state:k.h.Timeout,extendedData:l};var q=y.callUserMap[D.userID];return u==k.e.Cancel&&q?q.userID==a.engineConfig.user.userID&&(q.state=k.h.Cancelled,l&&(q.extendedData=l)):u==k.e.Timeout&&q&&(q.state=k.h.Timeout),D}),u==k.e.Timeout&&M.length?(a.eventBus.emit(k.t.CallUserState,{callID:n,callUserList:M}),a.eventBus.emit(k.t.CallAnswerTimeout,{callID:n,invitees:w})):u==k.e.Cancel&&(M=g.call_user_session_id.toString(),a.isMainDevice(k.h.Accepted,M)&&a.eventBus.emit(k.t.CallUserState,{callID:n,callUserList:[{userID:a.engineConfig.user.userID,state:k.h.Cancelled,extendedData:l}]})),a.dbMgr.addCallList([y])),a.logger.info(o,k.I.CallCancel,i),{callID:n,errorInvitees:R}})},r.prototype.callAccept=function(t,n){var s=this,u={time:new Date,callID:t,config:n},a={user_id:t,user_name:this.encodeExtendedData(n)};return this.connMgr.sendRequest(k.c.call_accept,a).then(function(i){if(i.code)return m=Object(p.s)(k.s.CallModuleServerError,i.message,i.code),u.error=m,s.logger.warn(o,k.I.CallAccept,u),Promise.reject(m);s.updateCallListSeq(i.talk_time);var l,h=+i.quit_time.toString()||0,m=s.dbCallMap.get(t);return i=m&&m.callUserMap[s.engineConfig.user.userID],m&&i&&(m.mode==k.f.General&&(m.state=k.g.Ended),i.state=k.h.Accepted,i.acceptTime=h,i.extendedData=n.extendedData||"",(l=Object.values(m.callUserMap)).length==2&&l.forEach(function(g){return g.acceptTime=h}),s.dbMgr.addCallList([m]),s.eventBus.emit(k.t.CallUserState,{callID:t,callUserList:[s.pickCallUser(i)]})),s.logger.info(o,k.I.CallAccept,u),{callID:t}})},r.prototype.callReject=function(t,n){var s=this,u={time:new Date,callID:t,config:n},a={call_id:t,payload:this.encodeExtendedData(n)};return this.connMgr.sendRequest(k.c.call_refuse,a).then(function(i){if(i.code)return l=Object(p.s)(k.s.CallModuleServerError,i.message,i.code),u.error=l,s.logger.warn(o,k.I.CallReject,u),Promise.reject(l);s.updateCallListSeq(i.talk_time);var l=s.dbCallMap.get(t);return i=l&&l.callUserMap[s.engineConfig.user.userID],l&&i&&(i.state=k.h.Rejected,l.state=k.g.Ended,i.extendedData=n.extendedData||"",s.dbMgr.addCallList([l]),s.eventBus.emit(k.t.CallUserState,{callID:t,callUserList:[s.pickCallUser(i)]})),s.logger.info(o,k.I.CallReject,u),{callID:t}})},r.prototype.callingInvite=function(t,n,s){var u=this,a={time:new Date,callID:n,invitees:t,config:s};return t=Array.from(new Set(t.filter(function(i){return Object(p.l)(i)}))),s={call_id:n,user_ids:t,offline_info:Object(p.e)(s.pushConfig)},this.connMgr.sendRequest(k.c.call_invite,s).then(function(i){if(i.code)return l=Object(p.s)(k.s.CallModuleServerError,i.message,i.code),a.error=l,u.logger.warn(o,k.I.CallInvite,a),Promise.reject(l);var l,h,m=i.err_list.map(function(y){return{userID:y.user_id,reason:y.sub_code}}),g=u.dbCallMap.get(n);return g&&(l=t.filter(function(y){return!m.find(function(w){return w.userID==y})}).map(function(y){return y={userID:y,state:k.h.Inviting,extendedData:""},g.callUserMap[y.userID]=S(S({},y),{acceptTime:0,quitTime:0,timeout:g.timeout}),y}),u.dbMgr.addCallList([g]),h=(h=g.callUserMap[u.engineConfig.user.userID])==null?void 0:h.state,u.isMainDevice(h,(h=i.call_user_session_id)==null?void 0:h.toString())?(u.eventBus.emit(k.t.CallUserState,{callID:n,callUserList:l}),u.createInviteTimeout(n,t,i.timeout)):setTimeout(function(){t.forEach(function(y){y=g.callUserMap[y],g.state!=k.g.Started||(y==null?void 0:y.state)!=k.h.Inviting&&(y==null?void 0:y.state)!=k.h.Received||(y.state=k.h.Timeout)})},1e3*i.timeout)),u.logger.info(o,k.I.CallingInvite,a),{callID:n,errorUserList:m}})},r.prototype.callQuit=function(t,n){var s=this,u={time:new Date,callID:t,config:n},a={call_id:t,payload:this.encodeExtendedData(n),offline_info:Object(p.e)(n.pushConfig)};return this.connMgr.sendRequest(k.c.call_quit,a).then(function(i){if(i.code)return m=Object(p.s)(k.s.CallModuleServerError,i.message,i.code),u.error=m,s.logger.warn(o,k.I.CallQuit,u),Promise.reject(m);s.updateCallListSeq(i.call_list_seq);var l,h,m=s.dbCallMap.get(t),g=m&&m.callUserMap[s.engineConfig.user.userID];return m&&g&&(l=g.state,g.state=k.h.Quit,m.state=k.g.Ended,g.extendedData=n.extendedData||"",g.quitTime=+i.quit_time.toString()||0,m.userDuration=(g.quitTime-g.acceptTime)/1e3|0,m.endTime=!Object.values(m.callUserMap).some(function(y){return y.state==k.h.Accepted})&&+i.quit_time.toString()||0,Object.values(m.callUserMap).every(function(y){return y.state==k.h.Quit})&&(m.endTime=0),h=0,Object.values(m.callUserMap).forEach(function(y){var w=y.state;y=y.acceptTime,w!=k.h.Rejected&&w!=k.h.Timeout&&w!=k.h.Quit||(h?y<h&&(h=y):h=y||0)}),h&&(m.callDuration=(g.quitTime-h)/1e3|0),s.dbMgr.addCallList([m]),i=(i=i.call_user_session_id)==null?void 0:i.toString(),s.isMainDevice(l,i)&&s.eventBus.emit(k.t.CallUserState,{callID:t,callUserList:[s.pickCallUser(g)]})),s.logger.info(o,k.I.CallQuit,u),{callID:t,createTime:(m==null?void 0:m.createTime)||0,acceptTime:(g==null?void 0:g.acceptTime)||(m==null?void 0:m.createTime)||0,quitTime:(g==null?void 0:g.quitTime)||0}})},r.prototype.callJoin=function(t,n){var s=this,u={time:new Date,callID:t,config:n};return n={call_id:t,payload:this.encodeExtendedData(n)},this.connMgr.sendRequest(k.c.call_enter,n).then(function(a){var i;if(a.code)return i=Object(p.s)(k.s.CallModuleServerError,a.message,a.code),u.error=i,s.logger.warn(o,k.I.callJoin,u),Promise.reject(i);s.updateCallListSeq(a.call_list_seq);var l=[],h=s.dbCallMap.get(t)||{callID:t,caller:a.caller,mode:k.f.Advanced,state:k.g.Started,createTime:+a.create_time.toString(),endTime:0,extendedData:Object(p.f)(a.payload),callDuration:0,userDuration:0,callUserMap:{}};return h.state=k.g.Started,h.timeout=+a.timeout.toString(),a.user_state_list.map(function(m){m={userID:m.user_id,state:s.translateUserState(m),extendedData:Object(p.f)(m.extended_data),acceptTime:m.acceptTime||0,quitTime:m.quit_time||0},h.callUserMap[m.userID]=S(S({},m),{timeout:h.timeout}),l.push(s.pickCallUser(m))}),s.dbCallMap.set(t,h),s.dbMgr.addCallList([h]),{callID:t,createTime:+a.create_time.toString(),joinTime:+a.accept_time.toString(),extendedData:Object(p.f)(a.extended_data),callUserList:l}})},r.prototype.callEnd=function(t,n){var s=this,u={callID:t,config:n},a={call_id:t,payload:this.encodeExtendedData(n),offline_info:Object(p.e)(n.pushConfig)};return this.connMgr.sendRequest(k.c.call_destroy,a).then(function(i){if(i.code)return m=Object(p.s)(k.s.CallModuleServerError,i.message,i.code),u.error=m,s.logger.warn(o,k.I.CallEnd,u),Promise.reject(m);s.updateCallListSeq(i.call_list_seq);var l,h,m=+i.talk_time.toString()||0,g=s.dbCallMap.get(t),y=g&&g.callUserMap[s.engineConfig.user.userID];return g&&y&&(l=y.state,g.state=k.g.Ended,g.endTime=m,s.calculateCallDuration(g),s.dbMgr.addCallList([g]),h={callID:t,mode:g.mode,caller:g.caller,operatedUserID:s.engineConfig.user.userID,endTime:m,extendedData:n.extendedData},i=i.quit_time.toString(),y.extendedData=n.extendedData,y.state=k.h.Ended,s.dbMgr.addCallList([g]),s.isMainDevice(l,i)&&(s.eventBus.emit(k.t.CallEnd,h),s.eventBus.emit(k.t.CallUserState,{callID:t,callUserList:[{userID:y.userID,state:y.state,extendedData:y.extendedData}]}))),s.logger.info(o,k.I.CallEnd,u),{callID:t,createTime:(g==null?void 0:g.createTime)||0,acceptTime:(y==null?void 0:y.acceptTime)||0,endTime:m}})},r.prototype.queryList=function(t){var n,s=this,u=Array.from(this.dbCallMap.values()).sort(function(h,m){return m.createTime-h.createTime}),a={config:t,total:u.length,count:0},i=100<t.count?100:t.count,l=(t=(t=t.nextFlag||0)||0,u.length>i?(t=(n=(t+1)*i)>=(u=(l=t*i)>u.length?[]:u).length?0:t+1,u=u.slice(l,n),a.start=l,a.end=n):t=0,i==0&&(t=0),a.count=u.length,u.map(function(h){return{callID:h.callID,caller:h.caller,mode:h.mode,state:h.state,inviter:h.inviter,extendedData:h.extendedData,createTime:h.createTime,endTime:h.endTime,callUserList:h.callUserMap?Object.values(h.callUserMap).map(function(m){return s.pickCallUser(m)}):[]}}));return this.logger.info(o,k.I.QueryCallList,a),Promise.resolve({callList:l,nextFlag:t})},r.prototype.onPushCallInvited=function(t){var n,s,u,a,i=this,l=t.call_id,h=(this.updateCallListSeq(t.call_list_seq),this.dbCallMap.get(l)),m=h&&h.callUserMap[this.engineConfig.user.userID];h&&m&&m.state!=k.h.Inviting||(n=t.timeout||0,s={},u=[],t.user_state_list.forEach(function(g){g.sub_code!=4&&(g={userID:g.user_id,state:i.translateUserState(g),extendedData:""},u.push(g),s[g.userID]=S(S({},g),{acceptTime:0,quitTime:0,timeout:n}))}),h||(h={callID:l,caller:t.caller,mode:t.call_mode==k.f.Advanced?k.f.Advanced:k.f.General,state:k.g.Started,createTime:+t.create_time.toString(),endTime:0,extendedData:Object(p.f)(t.payload),timeout:n,inviter:t.caller,userDuration:0,callDuration:0,callUserMap:s},this.dbCallMap.set(l,h)),this.dbMgr.addCallList([h]),(a={callID:l,mode:h.mode,caller:h.caller,inviter:h.caller,extendedData:h.extendedData,createTime:h.createTime,timeout:h.timeout,callUserList:u}).caller!==this.engineConfig.user.userID?(this.eventBus.emit(k.t.CallRecv,a),this.createReceiveTimeout(l,u.filter(function(g){return g.userID!==a.caller}).map(function(g){return g.userID}),n),this.callAck(l)):((m=t.call_user_session_id)==null?void 0:m.toString())!==this.engineConfig.sessionID.toString()&&setTimeout(function(){(h==null?void 0:h.state)==k.g.Started&&u.filter(function(g){return g.userID!==a.caller}).forEach(function(g){(h==null?void 0:h.callUserMap[g.userID].state)!=k.h.Inviting&&(h==null?void 0:h.callUserMap[g.userID].state)!=k.h.Received||(h.callUserMap[g.userID].state=k.h.Timeout)})},1e3*n))},r.prototype.onPushCallCancel=function(t){var n,s,u,a,i,l=this,h=t.call_id,m=(this.updateCallListSeq(t.call_list_seq),this.dbCallMap.get(h));m&&(i=(n=m.callUserMap[this.engineConfig.user.userID])==null?void 0:n.state,n&&n.state!=k.h.Timeout?(a=t.state==k.e.Timeout?k.e.Timeout:k.e.Cancel,s=(s=t.call_user_session_id)==null?void 0:s.toString(),a==k.e.Timeout?this.isSelfNotInCall(m,"PushTimeout")||(u=[],t.user_ids.forEach(function(g){(g=m.callUserMap[g])&&g.state!==k.h.Timeout&&(g.state=k.h.Timeout,u.push(l.pickCallUser(g)))}),t.user_ids.indexOf(this.engineConfig.user.userID)!=-1&&(m.state=k.g.Ended,n&&(n.state=k.h.Timeout),s||this.eventBus.emit(k.t.CallTimeout,{callID:h,mode:m.mode})),this.checkEndCallState(m),this.isMainDevice(i,s)&&u.length&&this.eventBus.emit(k.t.CallUserState,{callID:h,callUserList:u})):(m.state=k.g.Ended,a={callID:h,mode:m.mode,inviter:t.caller,extendedData:Object(p.f)(t.extended_data)},this.isMainDevice(n.state,s)&&(this.eventBus.emit(k.t.CallCancel,a),this.eventBus.emit(k.t.CallUserState,{callID:h,callUserList:[{userID:a.inviter,state:k.h.Cancelled,extendedData:a.extendedData}]})),(i=m.callUserMap[t.operator])&&(i.state=k.h.Cancelled,i.extendedData=a.extendedData)),this.dbMgr.addCallList([m])):m.state=k.g.Ended)},r.prototype.onPushCallAccept=function(t){var n,s,u=t.call_id,a=(this.updateCallListSeq(t.call_list_seq),this.dbCallMap.get(u)),i=a&&a.callUserMap[t.invitee];a&&i&&(n=(n=a.callUserMap[this.engineConfig.user.userID])==null?void 0:n.state,i.state=k.h.Accepted,i.extendedData=Object(p.f)(t.extended_data),i.acceptTime=+t.accept_time.toString(),(s=a.callUserMap[t.caller])&&!s.acceptTime&&(s.acceptTime=i.acceptTime),this.dbMgr.addCallList([a]),s={callID:u,invitee:i.userID,extendedData:i.extendedData},t=(t=t.call_user_session_id)==null?void 0:t.toString(),this.checkEndCallState(a),this.isMainDevice(n,t)&&(this.eventBus.emit(k.t.CallUserState,{callID:u,callUserList:[this.pickCallUser(i)]}),this.eventBus.emit(k.t.CallAccept,s)))},r.prototype.onPushCallReject=function(t){var n,s,u=t.call_id,a=(this.updateCallListSeq(t.call_list_seq),this.dbCallMap.get(u)),i=a&&a.callUserMap[t.invitee];a&&i&&(n=(n=a.callUserMap[this.engineConfig.user.userID])==null?void 0:n.state,i.state=k.h.Rejected,i.extendedData=Object(p.f)(t.extended_data),this.dbMgr.addCallList([a]),s={callID:u,invitee:i.userID,extendedData:i.extendedData},this.checkEndCallState(a),t=(t=t.call_user_session_id)==null?void 0:t.toString(),this.isMainDevice(n,t)&&(this.eventBus.emit(k.t.CallUserState,{callID:u,callUserList:[this.pickCallUser(i)]}),this.eventBus.emit(k.t.CallReject,s)),this.engineConfig.user.userID==i.userID&&(a.state=k.g.Ended))},r.prototype.onPushCallingInvite=function(t){var n,s,u,a,i,l=this,h=t.call_id,m=(this.updateCallListSeq(t.call_list_seq),(m=t.call_user_session_id)==null?void 0:m.toString()),g=t.timeout,y=this.dbCallMap.get(h)||{callID:h,caller:t.caller,mode:k.f.Advanced,state:k.g.Started,createTime:+t.create_time.toString(),endTime:0,extendedData:Object(p.f)(t.payload),callDuration:0,userDuration:0,callUserMap:{}};y.inviter=t.invitee,y.timeout=t.timeout,!t.user_state_list.find(function(w){return w.user_id==l.engineConfig.user.userID})&&this.isSelfNotInCall(y)||(s=(s=y.callUserMap[this.engineConfig.user.userID])==null?void 0:s.state,u=t.user_state_list.reduce(function(w,M){return M.sub_code!=4&&(w[M.user_id]={userID:M.user_id,state:l.translateUserState(M),extendedData:"",acceptTime:0,quitTime:0,timeout:g}),w},{}),Object.assign(y.callUserMap,u),this.dbCallMap.set(h,y),a=[],t.user_state_list.forEach(function(w){var M=y&&y.callUserMap[w.user_id];w.sub_code||w.user_id!=l.engineConfig.user.userID||(n=!0,y.state=k.g.Started),M&&a.push(l.pickCallUser(M))}),a.length&&!n&&(t.inviter!==this.engineConfig.user.userID&&this.inviterTimer[h]&&clearTimeout(this.inviterTimer[h+t.inviter]),this.isMainDevice(s,m)&&this.eventBus.emit(k.t.CallUserState,{callID:h,callUserList:a})),(i={}).isMain=m==this.engineConfig.sessionID.toString(),i.callUserList=a,t.invitee==this.engineConfig.user.userID?m&&m==this.engineConfig.sessionID.toString()?this.createInviteTimeout(t.call_id,a.map(function(w){return w.userID}),g):setTimeout(function(){y.state==k.g.Started&&a.forEach(function(w){y.callUserMap[w.userID].state!=k.h.Inviting&&y.callUserMap[w.userID].state!=k.h.Received||(y.callUserMap[w.userID].state=k.h.Timeout)}),l.logger.info(o,"onPushCallingInvite timeout",i)},1e3*g):this.queryCallInfo(y,!0,"push",a),this.logger.info(o,"onPushCallingInvite",i))},r.prototype.onPushCallQuit=function(t){var n,s=t.call_id,u=(this.updateCallListSeq(t.call_list_seq),this.dbCallMap.get(s)),a=u&&u.callUserMap[t.invitee];u&&a&&!this.isSelfNotInCall(u)&&(n=(n=u.callUserMap[this.engineConfig.user.userID])==null?void 0:n.state,a.state=k.h.Quit,a.extendedData=Object(p.f)(t.payload),a.quitTime=+t.quit_time.toString(),a.acceptTime||(a.acceptTime=+t.accept_time.toString()),this.dbMgr.addCallList([u]),t=(t=t.call_user_session_id)==null?void 0:t.toString(),this.checkEndCallState(u),this.isMainDevice(n,t)&&this.eventBus.emit(k.t.CallUserState,{callID:s,callUserList:[this.pickCallUser(a)]}),this.engineConfig.user.userID==a.userID&&(u.state=k.g.Ended))},r.prototype.onPushCallEnter=function(t){var n,s,u,a=this,i=t.call_id,l=(this.updateCallListSeq(t.call_list_seq),this.dbCallMap.get(i));(l&&!this.isSelfNotInCall(l)||t.user_id===this.engineConfig.user.userID)&&(l?t.user_id==this.engineConfig.user.userID&&(l.state=k.g.Started):(l={callID:i,caller:this.engineConfig.user.userID,mode:k.f.Advanced,state:k.g.Started,extendedData:Object(p.f)(t.call_payload),createTime:+t.create_time.toString(),endTime:0,timeout:t.timeout,inviter:t.caller,callDuration:0,userDuration:0,callUserMap:{}},this.dbCallMap.set(i,l)),n=(n=l.callUserMap[this.engineConfig.user.userID])==null?void 0:n.state,(u=t.user_state_list.find(function(h){return h.user_id==t.user_id}))&&(s=(s=t.call_user_session_id)==null?void 0:s.toString(),u={userID:u.user_id,state:this.translateUserState(u),extendedData:Object(p.f)(t.payload)},t.user_state_list.forEach(function(h){l&&(l.callUserMap[h.user_id]={userID:h.user_id,state:a.translateUserState(h),extendedData:Object(p.f)(h.extended_data),acceptTime:+h.accept_time.toString(),quitTime:0,timeout:+h.residue_timeout_time.toString()},h.user_id==t.user_id&&(l.callUserMap[h.user_id].extendedData=Object(p.f)(t.payload),l.callUserMap[h.user_id].acceptTime=+t.enter_time.toString()))}),this.dbMgr.addCallList([l]),this.isMainDevice(n,s)&&this.eventBus.emit(k.t.CallUserState,{callID:i,callUserList:[u]})))},r.prototype.onPushCallEnd=function(t){var n,s,u,a,i=t.call_id,l=this.dbCallMap.get(i);l&&(n=(n=l.callUserMap[this.engineConfig.user.userID])==null?void 0:n.state,l.state=k.g.Ended,l.endTime=+t.destroy_time.toString(),this.calculateCallDuration(l),this.dbMgr.addCallList([l]),s={callID:i,mode:l.mode,caller:l.caller,operatedUserID:t.operator||l.caller,extendedData:Object(p.f)(t.payload),endTime:l.endTime},u=l.callUserMap[t.operator||l.caller],a=(a=t.call_user_session_id)==null?void 0:a.toString(),u&&(u.state=k.h.Ended,u.extendedData=Object(p.f)(t.payload),this.dbMgr.addCallList([l])),this.isMainDevice(n,a)&&!this.isSelfNotInCall(l)&&(this.eventBus.emit(k.t.CallEnd,s),this.eventBus.emit(k.t.CallUserState,{callID:i,callUserList:[{userID:u.userID,state:u.state,extendedData:u.extendedData}]})))},r.prototype.onPushCallAck=function(t){var n,s=t.call_id,u=this.dbCallMap.get(s),a=u&&u.callUserMap[t.invitee];u&&a&&!this.isSelfNotInCall(u)&&a.state!=k.h.Received&&(n=(n=u.callUserMap[this.engineConfig.user.userID])==null?void 0:n.state,a.state=k.h.Received,this.dbMgr.addCallList([u]),t=(u=t.call_user_session_id)==null?void 0:u.toString(),this.isMainDevice(n,t)&&this.eventBus.emit(k.t.CallUserState,{callID:s,callUserList:[this.pickCallUser(a)]}))},r.prototype.registerInnerEvent=function(){this.eventBus.add(k.t.ILogined,this.onLogined.bind(this)),this.eventBus.add(k.t.ILogout,this.onLogout.bind(this)),this.eventBus.add(k.t.IConnected,this.onConnected.bind(this)),this.eventBus.add(k.t.INetworkChange,this.onNetworkChange.bind(this)),this.eventBus.add(k.t.ITriggerHB,this.onTriggerHB.bind(this))},r.prototype.onLogined=function(t){var n=this;t.calls.forEach(function(s){n.dbCallMap.set(s.callID,s),s.state!=k.g.Started||n.isSelfNotInCall(s)||n.queryCallInfo(s,!1,"onLogined")}),this.mergeServerCallList(k.u.SDKLogin)},r.prototype.onLogout=function(){this.dbCallMap.clear()},r.prototype.onConnected=function(){this.mergeServerCallList(k.u.SDKHb,"onConnected")},r.prototype.onNetworkChange=function(t){this.online=t},r.prototype.onTriggerHB=function(){this.mergeServerCallList(k.u.SDKHb,"hb")},r.prototype.checkEndCallState=function(t){var n,s=[];for(n in t.callUserMap)s.push(t.callUserMap[n]);t.mode==k.f.General&&s.every(function(u){return u.state==k.h.Accepted||u.state==k.h.Rejected||u.state==k.h.Timeout})&&(t.state=k.g.Ended),t.mode==k.f.Advanced&&s.every(function(u){return u.state==k.h.Quit})&&(t.state=k.g.Ended)},r.prototype.mergeServerCallList=function(t,n){var s,u,a,i,l,h=this,m=T.a.fromString(this.engineConfig.user.callSeq||"0"),g=this.engineConfig.mailHBConfig.call_list_seq;(g&&!g.lessThanOrEqual(m)||n==="onConnected")&&(s={time:new Date,dbSeq:m,hbSeq:g,how:t,action:n},u=0,a=1,i=++this.mergeListSeq,l=function(y){var w;u+=y.list.length,y.list.forEach(function(M){var R,D,q,L,j,G,J=+M.call_status.toString(),K=h.dbCallMap.get(M.call_id),ee=!(K!=null&&K.callUserMap[h.engineConfig.user.userID]);K?(K.endTime=+M.destroy_time.toString(),R=[],G=!h.isSelfNotInCall(K),M.call_user_list.forEach(function(A){var v,E=K==null?void 0:K.callUserMap[A.user_id];A.user_id==h.engineConfig.user.userID&&(v=E==null?void 0:E.state,ee=(ee=v==k.h.Accepted&&A.user_session_id.toString()==h.engineConfig.sessionID.toString())||v==k.h.Received||v==k.h.Inviting),E?A.user_state&&(v=h.translateUserState(A),E.state!==v&&v!==k.h.Unknown&&E.state!==k.h.Ended&&(E.state=v,E.extendedData=Object(p.f)(A.extended_data),E.timeout=+A.residue_timeout_time.toString(),E.acceptTime=+A.accept_time.toString()||0,E.quitTime=+A.quit_time.toString()||0,R.push(h.pickCallUser(E)))):(E={userID:A.user_id,state:h.translateUserState(A),extendedData:Object(p.f)(A.extended_data),acceptTime:+A.accept_time.toString()||0,quitTime:+A.quit_time.toString()||0,timeout:+A.residue_timeout_time.toString()},R.push(h.pickCallUser(E)),K&&(K.callUserMap[E.userID]=E))}),D=!1,q=M.call_user_list.some(function(A){return h.translateUserState(A)==k.h.Ended}),j=R.find(function(A){return A.state==k.h.Cancelled}),R.length&&ee&&(h.eventBus.emit(k.t.CallUserState,{callID:K.callID,callUserList:R}),((L=R.find(function(A){return A.userID==h.engineConfig.user.userID}))==null?void 0:L.state)==k.h.Timeout&&(D=!0,h.eventBus.emit(k.t.CallTimeout,{callID:K.callID,mode:K.mode})),j&&(D=!0,h.eventBus.emit(k.t.CallCancel,{callID:K.callID,mode:K.mode,inviter:K.inviter,extendedData:j.extendedData}))),K.state==k.g.Started&&J==k.g.Ended&&(L={callID:K.callID,mode:K.mode,caller:K.caller,operatedUserID:K.caller,extendedData:Object(p.f)(y.payload),endTime:K.endTime},ee&&K.mode==k.f.Advanced&&G&&!D&&q&&(K.state=k.g.Ended,h.eventBus.emit(k.t.CallEnd,L))),h.queryCallInfo(K,!1,"merge0")):(j=M.user_timeout,K={callID:M.call_id,caller:M.caller,createTime:+M.create_time.toString(),endTime:+M.destroy_time.toString(),mode:M.call_mode==k.f.Advanced?k.f.Advanced:k.f.General,state:J,extendedData:Object(p.f)(M.payload),timeout:j,inviter:M.inviter,callDuration:0,userDuration:0,callUserMap:M.call_user_list.reduce(function(A,v){var E=h.translateUserState(v);return v.sub_code!=4&&E!==k.h.Unknown&&(A[v.user_id]={userID:v.user_id,state:E,extendedData:Object(p.f)(v.extended_data),acceptTime:+v.accept_time.toString()||0,quitTime:+v.quit_time.toString()||0,timeout:+v.residue_timeout_time.toString()}),A},{})},h.dbCallMap.set(K.callID,K),n=="onConnected"&&((G=K.callUserMap[h.engineConfig.user.userID])==null?void 0:G.state)==k.h.Timeout&&h.eventBus.emit(k.t.CallTimeout,{callID:K.callID,mode:K.mode}),h.queryCallInfo(K,!0,"merge1"))}),y.nextFlag&&h.engineConfig.token?h.fetchServerPageCall(y.nextFlag,++a,t).then(l):(y.degree=a,y.svrCount=u,h.updateCallListSeq(y.cur||y.max,!0),w=Array.from(h.dbCallMap.values()),h.dbMgr.addCallList(w),n=="onConnected"&&u==0&&h.dbCallMap.forEach(function(M){M.state==k.g.Started&&h.queryCallInfo(M,!1,"onConnected")}),s.svrCount=u,s.dataReport=h.dataReport.endNetworkRequest(k.c.call_list.cmd,i,y),h.logger.info(o,"mergeSvrCalls",s))},this.fetchServerPageCall(m,a,t).then(l))},r.prototype.fetchServerPageCall=function(t,n,s){return t={cur_list_seq:t,count:100,degree:n,how:s},n==1&&this.dataReport.beginNetworkRequest(k.c.call_list.cmd,this.mergeListSeq,k.i.SDK,t),this.connMgr.sendRequest(k.c.call_list,t,k.i.SDK).then(function(u){if(u.code)return{cur:0,list:[]};var a=u.cur_list_seq,i=u.max_list_seq,l=u.fetch_end;return{nextFlag:l||a&&i&&a.greaterThanOrEqual(i)?0:a,cur:a,max:i,list:u.calls,fetch_end:l}})},r.prototype.queryCallInfo=function(t,n,s,u){var a,i=this;t.state!=k.g.Ended&&(a={call_id:t.callID,action:s},this.connMgr.sendRequest(k.c.call_info,a,k.i.SDK).then(function(l){if(l.code)l.code!==6000104&&(t.state=k.g.Ended);else{var h=[],m={},g=0,y=(n||i.diffCallUserState(t,l,s),l.user_list.forEach(function(D){var q,L;D.user_state!=4&&(q={userID:D.user_id,state:i.translateUserState(D),extendedData:Object(p.f)(D.extended_data)},h.push(q),L=+D.accept_time.toString(),m[q.userID]=S(S({},q),{acceptTime:L,quitTime:+D.quit_time.toString(),timeout:+D.residue_timeout_time.toString()}),L&&(g=g?Math.min(L,g):L),i.callSessionIDMap[t.callID]||(i.callSessionIDMap[t.callID]={}),i.callSessionIDMap[t.callID][q.userID]=D.user_session_id)}),m[i.engineConfig.user.userID]),w=(m[t.caller]&&(m[t.caller].acceptTime=g),l.now_time.toString()),M=y&&y.acceptTime,R=(w&&M&&t.state==k.g.Started&&(t.userDuration=(w-M)/1e3|0),t.callUserMap=m,i.dbMgr.addCallList([t]),i.isSelfNotInCall(t)&&(t.state=k.g.Ended),{callID:t.callID,mode:t.mode,caller:t.caller,inviter:t.inviter,extendedData:t.extendedData,createTime:t.createTime,timeout:y.timeout,callUserList:h});if(n&&y)switch(y.state!=k.h.Inviting&&y.state!=k.h.Accepted&&y.state!=k.h.Received||l.user_list.forEach(function(D){(D=m[D.user_id]).state==k.h.Inviting&&D.timeout&&i.createReceiveTimeout(t.callID,[D.userID],D.timeout)}),y.state){case k.h.Inviting:i.callAck(t.callID),t.state=k.g.Started,i.eventBus.emit(k.t.CallRecv,R);break;case k.h.Received:t.state=k.g.Started,(s!="push"||u&&u.some(function(D){return D.userID==y.userID}))&&i.eventBus.emit(k.t.CallRecv,R);break;case k.h.Timeout:t.state=k.g.Ended,i.eventBus.emit(k.t.CallTimeout,{callID:t.callID,mode:t.mode})}!n&&s=="merge0"&&(y==null?void 0:y.state)==k.h.Inviting&&y.timeout&&(i.eventBus.emit(k.t.CallRecv,R),i.createReceiveTimeout(t.callID,h.map(function(D){return D.userID}),y.timeout)),n||s!="onConnected"||l.user_list.forEach(function(D){(D=m[D.user_id]).state!=k.h.Inviting&&D.state!=k.h.Received||i.createReceiveTimeout(t.callID,[D.userID],D.timeout)})}}))},r.prototype.diffCallUserState=function(t,n,s){var u=this,a={action:s,call:t.callID},i=t.callUserMap,l=(l=i[this.engineConfig.user.userID])==null?void 0:l.state,h=[],m="",g=(n.user_list.forEach(function(y){var w=i[y.user_id],M=u.translateUserState(y);w&&w.state===M||(h.push({userID:y.user_id,state:M,extendedData:Object(p.f)(y.extended_data)||""}),a[y.user_id]=(w==null?void 0:w.state)+","+M),y.user_id==u.engineConfig.user.userID&&(m=y.user_session_id==null?"0":y.user_session_id)}),h.find(function(y){return y.userID==u.engineConfig.user.userID})||{});g&&g.state==k.h.Inviting&&this.eventBus.emit(k.t.CallRecv,{callUserList:t.callUserMap?Object.values(t.callUserMap).map(function(y){return u.pickCallUser(y)}):[],caller:t.caller,createTime:t.createTime,extendedData:t.extendedData,inviter:n.inviter,timeout:n.user_timeout,callID:t.callID,mode:n.mode}),g&&g.state==k.h.Timeout&&this.eventBus.emit(k.t.CallTimeout,{callID:t.callID,mode:t.mode}),n=h.find(function(y){return y.state==k.h.Cancelled&&y.userID!==(g===null?void 0:g.userID)}),s=="onLogined"&&g&&n&&this.eventBus.emit(k.t.CallCancel,{callID:t.callID,inviter:t.inviter,mode:t.mode,extendedData:n.extendedData}),s=this.isMainDevice(l,m),a.isMain=s,a.selfOldState=l,this.logger.info(o,"diffCallUserState",a),h.length&&s&&this.eventBus.emit(k.t.CallUserState,{callID:t.callID,callUserList:d([],f(h),!1)})},r.prototype.callAck=function(t){var n=this,s={call_id:t},u=this.dbCallMap.get(t),a=u&&u.callUserMap[this.engineConfig.user.userID];(a==null?void 0:a.state)===k.h.Inviting&&this.connMgr.sendRequest(k.c.call_ack,s,k.i.SDK).then(function(i){!i.code&&u&&a&&(a.state=k.h.Received,n.dbMgr.addCallList([u]),n.eventBus.emit(k.t.CallUserState,{callID:t,callUserList:[n.pickCallUser(a)]}))})},r.prototype.createInviteTimeout=function(t,n,s){var u=this,a=t+n.join("");this.inviterTimer[a]&&clearTimeout(this.inviterTimer[a]),this.inviterTimer[a]=setTimeout(function(){var i,l=u.dbCallMap.get(t);!l||l.state==k.g.Ended&&l.mode==k.f.Advanced||(i=n.filter(function(h){return!!(h=l.callUserMap[h])&&(h.state==k.h.Inviting||h.state==k.h.Received||h.state==k.h.Unknown)})).length&&u.callCancel(i,t,{extendedData:""},k.e.Timeout)},1e3*s)},r.prototype.createReceiveTimeout=function(t,n,s){var u=this,a=t+n.join("");this.receiveTimer[a]&&clearTimeout(this.receiveTimer[a]),this.receiveTimer[a]=setTimeout(function(){var i,l,h,m,g;!u.online||(i=u.dbCallMap.get(t))&&i.state!==k.g.Ended&&(h=!(l=[]),n.forEach(function(y){var w=i.callUserMap[y];w.state!=k.h.Received&&w.state!=k.h.Inviting||(l.push({userID:w.userID,state:k.h.Timeout,extendedData:w.extendedData}),y==u.engineConfig.user.userID?h=!0:w.state=k.h.Timeout)}),m=!(g=(g=u.callSessionIDMap[t])==null?void 0:g[u.engineConfig.user.userID])||g==u.engineConfig.sessionID.toString(),g={sid:g,callUserList:l.length},u.logger.info(o,"createReceiveTimeout",g),m&&l.length&&u.eventBus.emit(k.t.CallUserState,{callID:t,callUserList:l}),h&&(i.callUserMap[u.engineConfig.user.userID].state=k.h.Timeout,i.state=k.g.Ended,u.eventBus.emit(k.t.CallTimeout,{callID:i.callID,mode:i.mode})))},1e3*s)},r.prototype.translateUserState=function(t){var n=t.user_state||t.sub_code;return t.is_timeout||n==9?k.h.Timeout:n?n==1?k.h.Accepted:n==2?k.h.Rejected:n==3?k.h.Cancelled:n==5?k.h.Received:n==7?k.h.Quit:n==8?k.h.Ended:k.h.Unknown:k.h.Inviting},r.prototype.calculateCallDuration=function(t){var n=0;Object.values(t.callUserMap).forEach(function(s){0<(s=s.acceptTime)&&(!n||s<n)&&(n=s)}),t.callDuration=n?(t.endTime-n)/1e3|0:0},r.prototype.pickCallUser=function(t){return{userID:t.userID,state:t.state,extendedData:t.extendedData}},r.prototype.encodeExtendedData=function(t){return(t=(t==null?void 0:t.extendedData)||"")?Object(p.i)(t):void 0},r.prototype.updateCallListSeq=function(t,n){var s=this.engineConfig.user;!t||!n&&+s.callSeq&&s.callSeq!=t.sub(1).toString()||(s.callSeq=t.toString(),this.dbMgr.setUser(s))},r.prototype.isSelfNotInCall=function(t,n){var s,u;return!!t.callUserMap&&(!(s=!(s=t.callUserMap[this.engineConfig.user.userID])||s.state==k.h.Timeout||s.state==k.h.Cancelled||s.state==k.h.Rejected||s.state==k.h.Quit)&&n&&(u={action:n,call:t.callID},Object.values(t.callUserMap).forEach(function(a){return u[a.userID]=a.state}),this.logger.info(o,"isSelfNotInCall",u)),s)},r.prototype.isMainDevice=function(t,n){return t==k.h.Accepted&&n==this.engineConfig.sessionID.toString()||t==k.h.Received||t==k.h.Inviting||(n==null?void 0:n.toString())=="0"},r);function r(t,n,s,u){this.logger=I.a.getInstance().logger,this.dataReport=I.a.getInstance().dataReport,this.dbCallMap=new Map,this.mergeListSeq=0,this.receiveTimer={},this.inviterTimer={},this.callSessionIDMap={},this.online=!0,this.engineConfig=t,this.eventBus=n,this.connMgr=s,this.dbMgr=u,this.registerInnerEvent()}},function(Q,O,b){Q.exports=function(T){var I=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function p(n,s){var u=n[0],a=n[1],i=n[2],l=n[3];a=((a+=((i=((i+=((l=((l+=((u=((u+=(a&i|~a&l)+s[0]-680876936|0)<<7|u>>>25)+a|0)&a|~u&i)+s[1]-389564586|0)<<12|l>>>20)+u|0)&u|~l&a)+s[2]+606105819|0)<<17|i>>>15)+l|0)&l|~i&u)+s[3]-1044525330|0)<<22|a>>>10)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a&i|~a&l)+s[4]-176418897|0)<<7|u>>>25)+a|0)&a|~u&i)+s[5]+1200080426|0)<<12|l>>>20)+u|0)&u|~l&a)+s[6]-1473231341|0)<<17|i>>>15)+l|0)&l|~i&u)+s[7]-45705983|0)<<22|a>>>10)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a&i|~a&l)+s[8]+1770035416|0)<<7|u>>>25)+a|0)&a|~u&i)+s[9]-1958414417|0)<<12|l>>>20)+u|0)&u|~l&a)+s[10]-42063|0)<<17|i>>>15)+l|0)&l|~i&u)+s[11]-1990404162|0)<<22|a>>>10)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a&i|~a&l)+s[12]+1804603682|0)<<7|u>>>25)+a|0)&a|~u&i)+s[13]-40341101|0)<<12|l>>>20)+u|0)&u|~l&a)+s[14]-1502002290|0)<<17|i>>>15)+l|0)&l|~i&u)+s[15]+1236535329|0)<<22|a>>>10)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a&l|i&~l)+s[1]-165796510|0)<<5|u>>>27)+a|0)&i|a&~i)+s[6]-1069501632|0)<<9|l>>>23)+u|0)&a|u&~a)+s[11]+643717713|0)<<14|i>>>18)+l|0)&u|l&~u)+s[0]-373897302|0)<<20|a>>>12)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a&l|i&~l)+s[5]-701558691|0)<<5|u>>>27)+a|0)&i|a&~i)+s[10]+38016083|0)<<9|l>>>23)+u|0)&a|u&~a)+s[15]-660478335|0)<<14|i>>>18)+l|0)&u|l&~u)+s[4]-405537848|0)<<20|a>>>12)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a&l|i&~l)+s[9]+568446438|0)<<5|u>>>27)+a|0)&i|a&~i)+s[14]-1019803690|0)<<9|l>>>23)+u|0)&a|u&~a)+s[3]-187363961|0)<<14|i>>>18)+l|0)&u|l&~u)+s[8]+1163531501|0)<<20|a>>>12)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a&l|i&~l)+s[13]-1444681467|0)<<5|u>>>27)+a|0)&i|a&~i)+s[2]-51403784|0)<<9|l>>>23)+u|0)&a|u&~a)+s[7]+1735328473|0)<<14|i>>>18)+l|0)&u|l&~u)+s[12]-1926607734|0)<<20|a>>>12)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a^i^l)+s[5]-378558|0)<<4|u>>>28)+a|0)^a^i)+s[8]-2022574463|0)<<11|l>>>21)+u|0)^u^a)+s[11]+1839030562|0)<<16|i>>>16)+l|0)^l^u)+s[14]-35309556|0)<<23|a>>>9)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a^i^l)+s[1]-1530992060|0)<<4|u>>>28)+a|0)^a^i)+s[4]+1272893353|0)<<11|l>>>21)+u|0)^u^a)+s[7]-155497632|0)<<16|i>>>16)+l|0)^l^u)+s[10]-1094730640|0)<<23|a>>>9)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a^i^l)+s[13]+681279174|0)<<4|u>>>28)+a|0)^a^i)+s[0]-358537222|0)<<11|l>>>21)+u|0)^u^a)+s[3]-722521979|0)<<16|i>>>16)+l|0)^l^u)+s[6]+76029189|0)<<23|a>>>9)+i|0,a=((a+=((i=((i+=((l=((l+=((u=((u+=(a^i^l)+s[9]-640364487|0)<<4|u>>>28)+a|0)^a^i)+s[12]-421815835|0)<<11|l>>>21)+u|0)^u^a)+s[15]+530742520|0)<<16|i>>>16)+l|0)^l^u)+s[2]-995338651|0)<<23|a>>>9)+i|0,a=((a+=((l=((l+=(a^((u=((u+=(i^(a|~l))+s[0]-198630844|0)<<6|u>>>26)+a|0)|~i))+s[7]+1126891415|0)<<10|l>>>22)+u|0)^((i=((i+=(u^(l|~a))+s[14]-1416354905|0)<<15|i>>>17)+l|0)|~u))+s[5]-57434055|0)<<21|a>>>11)+i|0,a=((a+=((l=((l+=(a^((u=((u+=(i^(a|~l))+s[12]+1700485571|0)<<6|u>>>26)+a|0)|~i))+s[3]-1894986606|0)<<10|l>>>22)+u|0)^((i=((i+=(u^(l|~a))+s[10]-1051523|0)<<15|i>>>17)+l|0)|~u))+s[1]-2054922799|0)<<21|a>>>11)+i|0,a=((a+=((l=((l+=(a^((u=((u+=(i^(a|~l))+s[8]+1873313359|0)<<6|u>>>26)+a|0)|~i))+s[15]-30611744|0)<<10|l>>>22)+u|0)^((i=((i+=(u^(l|~a))+s[6]-1560198380|0)<<15|i>>>17)+l|0)|~u))+s[13]+1309151649|0)<<21|a>>>11)+i|0,a=((a+=((l=((l+=(a^((u=((u+=(i^(a|~l))+s[4]-145523070|0)<<6|u>>>26)+a|0)|~i))+s[11]-1120210379|0)<<10|l>>>22)+u|0)^((i=((i+=(u^(l|~a))+s[2]+718787259|0)<<15|i>>>17)+l|0)|~u))+s[9]-343485551|0)<<21|a>>>11)+i|0,n[0]=u+n[0]|0,n[1]=a+n[1]|0,n[2]=i+n[2]|0,n[3]=l+n[3]|0}function k(n){var s,u=[];for(s=0;s<64;s+=4)u[s>>2]=n.charCodeAt(s)+(n.charCodeAt(s+1)<<8)+(n.charCodeAt(s+2)<<16)+(n.charCodeAt(s+3)<<24);return u}function S(n){var s,u=[];for(s=0;s<64;s+=4)u[s>>2]=n[s]+(n[s+1]<<8)+(n[s+2]<<16)+(n[s+3]<<24);return u}function f(n){var s,u,a,i,l,h,m=n.length,g=[1732584193,-271733879,-1732584194,271733878];for(s=64;s<=m;s+=64)p(g,k(n.substring(s-64,s)));for(u=(n=n.substring(s-64)).length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<u;s+=1)a[s>>2]|=n.charCodeAt(s)<<(s%4<<3);if(a[s>>2]|=128<<(s%4<<3),s>55)for(p(g,a),s=0;s<16;s+=1)a[s]=0;return i=(i=8*m).toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(i[2],16),h=parseInt(i[1],16)||0,a[14]=l,a[15]=h,p(g,a),g}function d(n){var s,u="";for(s=0;s<4;s+=1)u+=I[n>>8*s+4&15]+I[n>>8*s&15];return u}function o(n){var s;for(s=0;s<n.length;s+=1)n[s]=d(n[s]);return n.join("")}function c(n){return/[\u0080-\uFFFF]/.test(n)&&(n=unescape(encodeURIComponent(n))),n}function r(n){var s,u=[],a=n.length;for(s=0;s<a-1;s+=2)u.push(parseInt(n.substr(s,2),16));return String.fromCharCode.apply(String,u)}function t(){this.reset()}return o(f("hello")),typeof ArrayBuffer>"u"||ArrayBuffer.prototype.slice||function(){function n(s,u){return(s=0|s||0)<0?Math.max(s+u,0):Math.min(s,u)}ArrayBuffer.prototype.slice=function(s,u){var a,i,l,h,m=this.byteLength,g=n(s,m),y=m;return u!==void 0&&(y=n(u,m)),g>y?new ArrayBuffer(0):(a=y-g,i=new ArrayBuffer(a),l=new Uint8Array(i),h=new Uint8Array(this,g,a),l.set(h),i)}}(),t.prototype.append=function(n){return this.appendBinary(c(n)),this},t.prototype.appendBinary=function(n){this._buff+=n,this._length+=n.length;var s,u=this._buff.length;for(s=64;s<=u;s+=64)p(this._hash,k(this._buff.substring(s-64,s)));return this._buff=this._buff.substring(s-64),this},t.prototype.end=function(n){var s,u,a=this._buff,i=a.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(s=0;s<i;s+=1)l[s>>2]|=a.charCodeAt(s)<<(s%4<<3);return this._finish(l,i),u=o(this._hash),n&&(u=r(u)),this.reset(),u},t.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},t.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},t.prototype.setState=function(n){return this._buff=n.buff,this._length=n.length,this._hash=n.hash,this},t.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},t.prototype._finish=function(n,s){var u,a,i,l=s;if(n[l>>2]|=128<<(l%4<<3),l>55)for(p(this._hash,n),l=0;l<16;l+=1)n[l]=0;u=(u=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(u[2],16),i=parseInt(u[1],16)||0,n[14]=a,n[15]=i,p(this._hash,n)},t.hash=function(n,s){return t.hashBinary(c(n),s)},t.hashBinary=function(n,s){var u=o(f(n));return s?r(u):u},(t.ArrayBuffer=function(){this.reset()}).prototype.append=function(n){var s,u=function(i,l,h){var m=new Uint8Array(i.byteLength+l.byteLength);return m.set(new Uint8Array(i)),m.set(new Uint8Array(l),i.byteLength),h?m:m.buffer}(this._buff.buffer,n,!0),a=u.length;for(this._length+=n.byteLength,s=64;s<=a;s+=64)p(this._hash,S(u.subarray(s-64,s)));return this._buff=s-64<a?new Uint8Array(u.buffer.slice(s-64)):new Uint8Array(0),this},t.ArrayBuffer.prototype.end=function(n){var s,u,a=this._buff,i=a.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(s=0;s<i;s+=1)l[s>>2]|=a[s]<<(s%4<<3);return this._finish(l,i),u=o(this._hash),n&&(u=r(u)),this.reset(),u},t.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},t.ArrayBuffer.prototype.getState=function(){var n=t.prototype.getState.call(this);return n.buff=function(s){return String.fromCharCode.apply(null,new Uint8Array(s))}(n.buff),n},t.ArrayBuffer.prototype.setState=function(n){return n.buff=function(s,u){var a,i=s.length,l=new ArrayBuffer(i),h=new Uint8Array(l);for(a=0;a<i;a+=1)h[a]=s.charCodeAt(a);return u?h:l}(n.buff,!0),t.prototype.setState.call(this,n)},t.ArrayBuffer.prototype.destroy=t.prototype.destroy,t.ArrayBuffer.prototype._finish=t.prototype._finish,t.ArrayBuffer.hash=function(n,s){var u=function(i){var l,h,m,g,y,w,M=i.length,R=[1732584193,-271733879,-1732584194,271733878];for(l=64;l<=M;l+=64)p(R,S(i.subarray(l-64,l)));for(h=(i=l-64<M?i.subarray(l-64):new Uint8Array(0)).length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<h;l+=1)m[l>>2]|=i[l]<<(l%4<<3);if(m[l>>2]|=128<<(l%4<<3),l>55)for(p(R,m),l=0;l<16;l+=1)m[l]=0;return g=(g=8*M).toString(16).match(/(.*?)(.{0,8})$/),y=parseInt(g[2],16),w=parseInt(g[1],16)||0,m[14]=y,m[15]=w,p(R,m),R}(new Uint8Array(n)),a=o(u);return s?r(a):a},t}()},function(Q,O,b){b.d(O,"a",function(){return f}),O=b(3);var T=b.n(O),I=b(80),p=b(1),k=b(0),S=function(){return(S=Object.assign||function(o){for(var c,r=1,t=arguments.length;r<t;r++)for(var n in c=arguments[r])Object.prototype.hasOwnProperty.call(c,n)&&(o[n]=c[n]);return o}).apply(this,arguments)},f=(d.prototype.setLogConfig=function(o){this.logger.setLogLevel(o.logLevel)},d.prototype.setDB=function(o){this.logger.setDB(o)},d.prototype.init=function(o,c){this.config.appID=o,this.config.userID=c.userID,this.config.deviceID=p.g,o={version:this.config.version,appID:o,deviceID:this.config.deviceID,userID:this.config.userID,userName:c.userName,origin:p.n?"":location.origin,device:p.h},this.logger.setCommonField(new Map([["userID",this.config.userID]])),this.logger.setHeaderInfo(JSON.stringify(o))},d.prototype.renewToken=function(o){this.config.token=o},d.prototype.setUploadURL=function(o){this.config.uploadURL=o},d.prototype.upload=function(o,c){return this.config.uploadURL&&this.config.token&&this.config.userID?this.isProd?this.logger.upload(S({},this.config),o,c):Promise.resolve():Promise.reject(Object(p.s)(k.s.NetworkModuleUserIsNotLogged))},d.prototype.info=function(o,c,r){this.emitLog(o,c,r,"info")},d.prototype.warn=function(o,c,r){this.emitLog(o,c,r,"warn")},d.prototype.emitLog=function(o,c,r,t){return r=r&&typeof r=="object"?this.stringify(r):r||"",t&&this.logger.write(o,t,c,r),r},d.prototype.stringify=function(o){o.time instanceof Date&&(c=o.time,o.time=Date.now()-c.getTime()+","+c.toLocaleTimeString("zh-CN")+"."+c.getMilliseconds());var c,r=null;return JSON.stringify(o,function(t,n){if(n instanceof Uint8Array)return"b="+n.length;var s;if(n instanceof Array&&2<n.length)return[s=n.length,n[0],n[s-1]];if(n&&typeof n=="object"&&n.type&&n.message&&(r=n),typeof n=="string"){if(100<n.length)return"s="+n.length;if(t=="message"&&r&&r.type)return r=null,"s="+n.length}return n instanceof T.a?n.toString():n}).replace(/\"(\w+)\":/g,"$1:").replace(/(https?:\/\/)|(wss?:\/\/)/g,"")},d);function d(o){this.isProd=!0,this.config={product:"zim",appID:"",userID:"",token:"",uploadURL:"",deviceID:p.g,version:""},this.logger=new I.a("zim",p.n),this.config.version=o}},function(Q,O,b){var T=b(43);b.d(O,"a",function(){return T.a})},function(Q,O,b){b.d(O,"a",function(){return T}),I.getInstance=function(){return I.instance||(I.instance=new I).init(),I.instance},I.prototype.init=function(){},Object.defineProperty(I.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(p){this._testEnvironment=p},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"ENV",{get:function(){return this._ENV},set:function(p){this._ENV=p},enumerable:!1,configurable:!0}),I.instance=new I;var T=I;function I(){this._testEnvironment=!0,this._ENV=0}},function(Q,O,b){(function(T,I,p,k){Q.exports=function S(f,d,o){function c(n,s){if(!d[n]){if(!f[n]){if(r)return r(n,!0);var u=new Error("Cannot find module '"+n+"'");throw u.code="MODULE_NOT_FOUND",u}u=d[n]={exports:{}},f[n][0].call(u.exports,function(a){return c(f[n][1][a]||a)},u,u.exports,S,f,d,o)}return d[n].exports}for(var r=!1,t=0;t<o.length;t++)c(o[t]);return c}({1:[function(S,f,d){var o=S("./utils"),c=S("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";d.encode=function(t){for(var n,s,u,a,i,l,h=[],m=0,g=t.length,y=o.getTypeOf(t)!=="string";m<t.length;)l=g-m,u=y?(n=t[m++],s=m<g?t[m++]:0,m<g?t[m++]:0):(n=t.charCodeAt(m++),s=m<g?t.charCodeAt(m++):0,m<g?t.charCodeAt(m++):0),a=(3&n)<<4|s>>4,i=1<l?(15&s)<<2|u>>6:64,l=2<l?63&u:64,h.push(r.charAt(n>>2)+r.charAt(a)+r.charAt(i)+r.charAt(l));return h.join("")},d.decode=function(t){var n,s,u,a,i,l=0,h=0;if(t.substr(0,5)==="data:")throw new Error("Invalid base64 input, it looks like a data url.");var m,g=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===r.charAt(64)&&g--,t.charAt(t.length-2)===r.charAt(64)&&g--,g%1!=0)throw new Error("Invalid base64 input, bad content length.");for(m=new(c.uint8array?Uint8Array:Array)(0|g);l<t.length;)n=r.indexOf(t.charAt(l++))<<2|(a=r.indexOf(t.charAt(l++)))>>4,s=(15&a)<<4|(a=r.indexOf(t.charAt(l++)))>>2,u=(3&a)<<6|(i=r.indexOf(t.charAt(l++))),m[h++]=n,a!==64&&(m[h++]=s),i!==64&&(m[h++]=u);return m}},{"./support":30,"./utils":32}],2:[function(S,f,d){var o=S("./external"),c=S("./stream/DataWorker"),r=S("./stream/Crc32Probe"),t=S("./stream/DataLengthProbe");function n(s,u,a,i,l){this.compressedSize=s,this.uncompressedSize=u,this.crc32=a,this.compression=i,this.compressedContent=l}n.prototype={getContentWorker:function(){var s=new c(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new t("data_length")),u=this;return s.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),s},getCompressedWorker:function(){return new c(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},n.createWorkerFrom=function(s,u,a){return s.pipe(new r).pipe(new t("uncompressedSize")).pipe(u.compressWorker(a)).pipe(new t("compressedSize")).withStreamInfo("compression",u)},f.exports=n},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(S,f,d){var o=S("./stream/GenericWorker");d.STORE={magic:"\0\0",compressWorker:function(c){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},d.DEFLATE=S("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(S,f,d){var o=S("./utils"),c=function(){for(var r=[],t=0;t<256;t++){for(var n=t,s=0;s<8;s++)n=1&n?3988292384^n>>>1:n>>>1;r[t]=n}return r}();f.exports=function(r,t){return r!==void 0&&r.length?(o.getTypeOf(r)!=="string"?function(n,s,u){var a=c,i=0+u;n^=-1;for(var l=0;l<i;l++)n=n>>>8^a[255&(n^s[l])];return-1^n}:function(n,s,u){var a=c,i=0+u;n^=-1;for(var l=0;l<i;l++)n=n>>>8^a[255&(n^s.charCodeAt(l))];return-1^n})(0|t,r,r.length):0}},{"./utils":32}],5:[function(S,f,d){d.base64=!1,d.binary=!1,d.dir=!1,d.createFolders=!0,d.date=null,d.compression=null,d.compressionOptions=null,d.comment=null,d.unixPermissions=null,d.dosPermissions=null},{}],6:[function(S,f,d){S=typeof Promise<"u"?Promise:S("lie"),f.exports={Promise:S}},{lie:37}],7:[function(S,f,d){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",c=S("pako"),r=S("./utils"),t=S("./stream/GenericWorker"),n=o?"uint8array":"array";function s(u,a){t.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=a,this.meta={}}d.magic="\b\0",r.inherits(s,t),s.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(n,u.data),!1)},s.prototype.flush=function(){t.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},s.prototype.cleanUp=function(){t.prototype.cleanUp.call(this),this._pako=null},s.prototype._createPako=function(){this._pako=new c[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(a){u.push({data:a,meta:u.meta})}},d.compressWorker=function(u){return new s("Deflate",u)},d.uncompressWorker=function(){return new s("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(S,f,d){function o(i,l){for(var h="",m=0;m<l;m++)h+=String.fromCharCode(255&i),i>>>=8;return h}function c(i,l,h,m,g,y){var w=i.file,M=i.compression,R=y!==n.utf8encode,D=r.transformTo("string",y(w.name)),q=r.transformTo("string",n.utf8encode(w.name)),L=w.comment,j=(y=r.transformTo("string",y(L)),r.transformTo("string",n.utf8encode(L))),G=q.length!==w.name.length,J=(L=j.length!==L.length,""),K=w.dir,ee=w.date,A={crc32:0,compressedSize:0,uncompressedSize:0};return l&&!h||(A.crc32=i.crc32,A.compressedSize=i.compressedSize,A.uncompressedSize=i.uncompressedSize),h=0,l&&(h|=8),R||!G&&!L||(h|=2048),i=0,l=0,K&&(i|=16),g==="UNIX"?(l=798,i|=(65535&((R=w.unixPermissions)?R:K?16893:33204))<<16):(l=20,i|=63&(w.dosPermissions||0)),g=ee.getUTCHours(),g=(g=((g<<=6)|ee.getUTCMinutes())<<5)|ee.getUTCSeconds()/2,R=ee.getUTCFullYear()-1980,R=(R=((R<<=4)|ee.getUTCMonth()+1)<<5)|ee.getUTCDate(),G&&(K=o(1,1)+o(s(D),4)+q,J+="up"+o(K.length,2)+K),L&&(w=o(1,1)+o(s(y),4)+j,J+="uc"+o(w.length,2)+w),ee="",ee=(ee=(ee=(ee=(ee=(ee=(ee=(ee=(ee=(ee+=`
\0`)+o(h,2))+M.magic)+o(g,2))+o(R,2))+o(A.crc32,4))+o(A.compressedSize,4))+o(A.uncompressedSize,4))+o(D.length,2))+o(J.length,2),{fileRecord:u.LOCAL_FILE_HEADER+ee+D+J,dirRecord:u.CENTRAL_FILE_HEADER+o(l,2)+ee+o(y.length,2)+"\0\0\0\0"+o(i,4)+o(m,4)+D+J+y}}var r=S("../utils"),t=S("../stream/GenericWorker"),n=S("../utf8"),s=S("../crc32"),u=S("../signature");function a(i,l,h,m){t.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=l,this.zipPlatform=h,this.encodeFileName=m,this.streamFiles=i,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(a,t),a.prototype.push=function(i){var l=i.meta.percent||0,h=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(i):(this.bytesWritten+=i.data.length,t.prototype.push.call(this,{data:i.data,meta:{currentFile:this.currentFile,percent:h?(l+100*(h-m-1))/h:100}}))},a.prototype.openedSource=function(i){this.currentSourceOffset=this.bytesWritten,this.currentFile=i.file.name;var l=this.streamFiles&&!i.file.dir;l?(i=c(i,l,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:i.fileRecord,meta:{percent:0}})):this.accumulate=!0},a.prototype.closedSource=function(i){this.accumulate=!1;var l=this.streamFiles&&!i.file.dir,h=c(i,l,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(h.dirRecord),l)this.push({data:(l=i,u.DATA_DESCRIPTOR+o(l.crc32,4)+o(l.compressedSize,4)+o(l.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:h.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},a.prototype.flush=function(){for(var i=this.bytesWritten,l=0;l<this.dirRecords.length;l++)this.push({data:this.dirRecords[l],meta:{percent:100}});var h=this.bytesWritten-i;h=function(m,g,y,w,M){return M=r.transformTo("string",M(w)),u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(m,2)+o(m,2)+o(g,4)+o(y,4)+o(M.length,2)+M}(this.dirRecords.length,h,i,this.zipComment,this.encodeFileName),this.push({data:h,meta:{percent:100}})},a.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},a.prototype.registerPrevious=function(i){this._sources.push(i);var l=this;return i.on("data",function(h){l.processChunk(h)}),i.on("end",function(){l.closedSource(l.previous.streamInfo),l._sources.length?l.prepareNextSource():l.end()}),i.on("error",function(h){l.error(h)}),this},a.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},a.prototype.error=function(i){var l=this._sources;if(!t.prototype.error.call(this,i))return!1;for(var h=0;h<l.length;h++)try{l[h].error(i)}catch{}return!0},a.prototype.lock=function(){t.prototype.lock.call(this);for(var i=this._sources,l=0;l<i.length;l++)i[l].lock()},f.exports=a},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(S,f,d){var o=S("../compressions"),c=S("./ZipFileWorker");d.generateWorker=function(r,t,n){var s=new c(t.streamFiles,n,t.platform,t.encodeFileName),u=0;try{r.forEach(function(a,i){u++;var l=function(y,w){if(w=o[y=y||w])return w;throw new Error(y+" is not a valid compression method !")}(i.options.compression,t.compression),h=i.options.compressionOptions||t.compressionOptions||{},m=i.dir,g=i.date;i._compressWorker(l,h).withStreamInfo("file",{name:a,dir:m,date:g,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(s)}),s.entriesCount=u}catch(a){s.error(a)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(S,f,d){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var c,r=new o;for(c in this)typeof this[c]!="function"&&(r[c]=this[c]);return r}}(o.prototype=S("./object")).loadAsync=S("./load"),o.support=S("./support"),o.defaults=S("./defaults"),o.version="3.10.0",o.loadAsync=function(c,r){return new o().loadAsync(c,r)},o.external=S("./external"),f.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(S,f,d){var o=S("./utils"),c=S("./external"),r=S("./utf8"),t=S("./zipEntries"),n=S("./stream/Crc32Probe"),s=S("./nodejsUtils");f.exports=function(u,a){var i=this;return a=o.extend(a||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),s.isNode&&s.isStream(u)?c.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",u,!0,a.optimizedBinaryString,a.base64).then(function(l){var h=new t(a);return h.load(l),h}).then(function(l){var h=[c.Promise.resolve(l)],m=l.files;if(a.checkCRC32)for(var g=0;g<m.length;g++)h.push(function(y){return new c.Promise(function(w,M){var R=y.decompressed.getContentWorker().pipe(new n);R.on("error",function(D){M(D)}).on("end",function(){R.streamInfo.crc32!==y.decompressed.crc32?M(new Error("Corrupted zip : CRC32 mismatch")):w()}).resume()})}(m[g]));return c.Promise.all(h)}).then(function(l){for(var h=(l=l.shift()).files,m=0;m<h.length;m++){var g=h[m],y=g.fileNameStr,w=o.resolve(g.fileNameStr);i.file(w,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:a.createFolders}),g.dir||(i.file(w).unsafeOriginalName=y)}return l.zipComment.length&&(i.comment=l.zipComment),i})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(S,f,d){var o=S("../utils"),c=S("../stream/GenericWorker");function r(t,n){c.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(n)}o.inherits(r,c),r.prototype._bindStream=function(t){var n=this;(this._stream=t).pause(),t.on("data",function(s){n.push({data:s,meta:{percent:0}})}).on("error",function(s){n.isPaused?this.generatedError=s:n.error(s)}).on("end",function(){n.isPaused?n._upstreamEnded=!0:n.end()})},r.prototype.pause=function(){return!!c.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},f.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(S,f,d){var o=S("readable-stream").Readable;function c(r,t,n){o.call(this,t),this._helper=r;var s=this;r.on("data",function(u,a){s.push(u)||s._helper.pause(),n&&n(a)}).on("error",function(u){s.emit("error",u)}).on("end",function(){s.push(null)})}S("../utils").inherits(c,o),c.prototype._read=function(){this._helper.resume()},f.exports=c},{"../utils":32,"readable-stream":16}],14:[function(S,f,d){f.exports={isNode:T!==void 0,newBufferFrom:function(o,c){if(T.from&&T.from!==Uint8Array.from)return T.from(o,c);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new T(o,c)},allocBuffer:function(o){return T.alloc?T.alloc(o):((o=new T(o)).fill(0),o)},isBuffer:function(o){return T.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(S,f,d){function o(w,M,R){var D=t.getTypeOf(M),q=t.extend(R||{},u),L=(q.date=q.date||new Date,q.compression!==null&&(q.compression=q.compression.toUpperCase()),typeof q.unixPermissions=="string"&&(q.unixPermissions=parseInt(q.unixPermissions,8)),q.unixPermissions&&16384&q.unixPermissions&&(q.dir=!0),q.dosPermissions&&16&q.dosPermissions&&(q.dir=!0),q.dir&&(w=g(w)),q.createFolders&&(L=function(j){var G=(j=j.slice(-1)==="/"?j.substring(0,j.length-1):j).lastIndexOf("/");return 0<G?j.substring(0,G):""}(w))&&c.call(this,L,!0),D==="string"&&q.binary===!1&&q.base64===!1);R&&R.binary!==void 0||(q.binary=!L),(M instanceof a&&M.uncompressedSize===0||q.dir||!M||M.length===0)&&(q.base64=!1,q.binary=!0,M="",q.compression="STORE"),D=M instanceof a||M instanceof n?M:h.isNode&&h.isStream(M)?new m(w,M):t.prepareContent(w,M,q.binary,q.optimizedBinaryString,q.base64),R=new i(w,D,q),this.files[w]=R}function c(w,M){return M=M!==void 0?M:u.createFolders,w=g(w),this.files[w]||o.call(this,w,null,{dir:!0,createFolders:M}),this.files[w]}var r=S("./utf8"),t=S("./utils"),n=S("./stream/GenericWorker"),s=S("./stream/StreamHelper"),u=S("./defaults"),a=S("./compressedObject"),i=S("./zipObject"),l=S("./generate"),h=S("./nodejsUtils"),m=S("./nodejs/NodejsStreamInputAdapter"),g=function(w){return w.slice(-1)!=="/"&&(w+="/"),w};function y(w){return Object.prototype.toString.call(w)==="[object RegExp]"}f.exports={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(w){var M,R,D;for(M in this.files)D=this.files[M],(R=M.slice(this.root.length,M.length))&&M.slice(0,this.root.length)===this.root&&w(R,D)},filter:function(w){var M=[];return this.forEach(function(R,D){w(R,D)&&M.push(D)}),M},file:function(w,M,R){return arguments.length!==1?(w=this.root+w,o.call(this,w,M,R),this):y(w)?(D=w,this.filter(function(q,L){return!L.dir&&D.test(q)})):(M=this.files[this.root+w])&&!M.dir?M:null;var D},folder:function(w){if(!w)return this;if(y(w))return this.filter(function(D,q){return q.dir&&w.test(D)});var M=this.root+w,R=(M=c.call(this,M),this.clone());return R.root=M.name,R},remove:function(w){w=this.root+w;var M=this.files[w];if(M||(w.slice(-1)!=="/"&&(w+="/"),M=this.files[w]),M&&!M.dir)delete this.files[w];else for(var R=this.filter(function(q,L){return L.name.slice(0,w.length)===w}),D=0;D<R.length;D++)delete this.files[R[D].name];return this},generate:function(w){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(w){var M={};try{if((M=t.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=M.type.toLowerCase(),M.compression=M.compression.toUpperCase(),M.type==="binarystring"&&(M.type="string"),!M.type)throw new Error("No output type specified.");t.checkSupport(M.type),M.platform!=="darwin"&&M.platform!=="freebsd"&&M.platform!=="linux"&&M.platform!=="sunos"||(M.platform="UNIX"),M.platform==="win32"&&(M.platform="DOS");var R=M.comment||this.comment||"",D=l.generateWorker(this,M,R)}catch(q){(D=new n("error")).error(q)}return new s(D,M.type||"string",M.mimeType)},generateAsync:function(w,M){return this.generateInternalStream(w).accumulate(M)},generateNodeStream:function(w,M){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(M)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(S,f,d){f.exports=S("stream")},{stream:void 0}],17:[function(S,f,d){var o=S("./DataReader");function c(r){o.call(this,r);for(var t=0;t<this.data.length;t++)r[t]=255&r[t]}S("../utils").inherits(c,o),c.prototype.byteAt=function(r){return this.data[this.zero+r]},c.prototype.lastIndexOfSignature=function(r){for(var t=r.charCodeAt(0),n=r.charCodeAt(1),s=r.charCodeAt(2),u=r.charCodeAt(3),a=this.length-4;0<=a;--a)if(this.data[a]===t&&this.data[a+1]===n&&this.data[a+2]===s&&this.data[a+3]===u)return a-this.zero;return-1},c.prototype.readAndCheckSignature=function(r){var t=r.charCodeAt(0),n=r.charCodeAt(1),s=r.charCodeAt(2),u=(r=r.charCodeAt(3),this.readData(4));return t===u[0]&&n===u[1]&&s===u[2]&&r===u[3]},c.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,t},f.exports=c},{"../utils":32,"./DataReader":18}],18:[function(S,f,d){var o=S("../utils");function c(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}c.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(r){},readInt:function(r){var t,n=0;for(this.checkOffset(r),t=this.index+r-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=r,n},readString:function(r){return o.transformTo("string",this.readData(r))},readData:function(r){},lastIndexOfSignature:function(r){},readAndCheckSignature:function(r){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},f.exports=c},{"../utils":32}],19:[function(S,f,d){var o=S("./Uint8ArrayReader");function c(r){o.call(this,r)}S("../utils").inherits(c,o),c.prototype.readData=function(r){this.checkOffset(r);var t=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,t},f.exports=c},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(S,f,d){var o=S("./DataReader");function c(r){o.call(this,r)}S("../utils").inherits(c,o),c.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},c.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},c.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},c.prototype.readData=function(r){this.checkOffset(r);var t=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,t},f.exports=c},{"../utils":32,"./DataReader":18}],21:[function(S,f,d){var o=S("./ArrayReader");function c(r){o.call(this,r)}S("../utils").inherits(c,o),c.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,t},f.exports=c},{"../utils":32,"./ArrayReader":17}],22:[function(S,f,d){var o=S("../utils"),c=S("../support"),r=S("./ArrayReader"),t=S("./StringReader"),n=S("./NodeBufferReader"),s=S("./Uint8ArrayReader");f.exports=function(u){var a=o.getTypeOf(u);return o.checkSupport(a),a!=="string"||c.uint8array?a==="nodebuffer"?new n(u):c.uint8array?new s(o.transformTo("uint8array",u)):new r(o.transformTo("array",u)):new t(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(S,f,d){d.LOCAL_FILE_HEADER="PK",d.CENTRAL_FILE_HEADER="PK",d.CENTRAL_DIRECTORY_END="PK",d.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",d.ZIP64_CENTRAL_DIRECTORY_END="PK",d.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(S,f,d){var o=S("./GenericWorker"),c=S("../utils");function r(t){o.call(this,"ConvertWorker to "+t),this.destType=t}c.inherits(r,o),r.prototype.processChunk=function(t){this.push({data:c.transformTo(this.destType,t.data),meta:t.meta})},f.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(S,f,d){var o=S("./GenericWorker"),c=S("../crc32");function r(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}S("../utils").inherits(r,o),r.prototype.processChunk=function(t){this.streamInfo.crc32=c(t.data,this.streamInfo.crc32||0),this.push(t)},f.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(S,f,d){var o=S("../utils"),c=S("./GenericWorker");function r(t){c.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}o.inherits(r,c),r.prototype.processChunk=function(t){var n;t&&(n=this.streamInfo[this.propName]||0,this.streamInfo[this.propName]=n+t.data.length),c.prototype.processChunk.call(this,t)},f.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(S,f,d){var o=S("../utils"),c=S("./GenericWorker");function r(t){c.call(this,"DataWorker");var n=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(s){n.dataIsReady=!0,n.data=s,n.max=s&&s.length||0,n.type=o.getTypeOf(s),n.isPaused||n._tickAndRepeat()},function(s){n.error(s)})}o.inherits(r,c),r.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,n=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,n);break;case"uint8array":t=this.data.subarray(this.index,n);break;case"array":case"nodebuffer":t=this.data.slice(this.index,n)}return this.index=n,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},f.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(S,f,d){function o(c){this.name=c||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(c){this.emit("data",c)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(c){this.emit("error",c)}return!0},error:function(c){return!this.isFinished&&(this.isPaused?this.generatedError=c:(this.isFinished=!0,this.emit("error",c),this.previous&&this.previous.error(c),this.cleanUp()),!0)},on:function(c,r){return this._listeners[c].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(c,r){if(this._listeners[c])for(var t=0;t<this._listeners[c].length;t++)this._listeners[c][t].call(this,r)},pipe:function(c){return c.registerPrevious(this)},registerPrevious:function(c){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=c.streamInfo,this.mergeStreamInfo(),this.previous=c;var r=this;return c.on("data",function(t){r.processChunk(t)}),c.on("end",function(){r.end()}),c.on("error",function(t){r.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var c=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),c=!0),this.previous&&this.previous.resume(),!c},flush:function(){},processChunk:function(c){this.push(c)},withStreamInfo:function(c,r){return this.extraStreamInfo[c]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var c in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(c)&&(this.streamInfo[c]=this.extraStreamInfo[c])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var c="Worker "+this.name;return this.previous?this.previous+" -> "+c:c}},f.exports=o},{}],29:[function(S,f,d){var o=S("../utils"),c=S("./ConvertWorker"),r=S("./GenericWorker"),t=S("../base64"),n=S("../support"),s=S("../external"),u=null;if(n.nodestream)try{u=S("../nodejs/NodejsStreamOutputAdapter")}catch{}function a(i,l,h){var m=l;switch(l){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=l,this._mimeType=h,o.checkSupport(m),this._worker=i.pipe(new c(m)),i.lock()}catch(g){this._worker=new r("error"),this._worker.error(g)}}a.prototype={accumulate:function(i){return l=this,h=i,new s.Promise(function(m,g){var y=[],w=l._internalType,M=l._outputType,R=l._mimeType;l.on("data",function(D,q){y.push(D),h&&h(q)}).on("error",function(D){y=[],g(D)}).on("end",function(){try{var D=function(q,L,j){switch(q){case"blob":return o.newBlob(o.transformTo("arraybuffer",L),j);case"base64":return t.encode(L);default:return o.transformTo(q,L)}}(M,function(q,L){for(var j=0,G=null,J=0,K=0;K<L.length;K++)J+=L[K].length;switch(q){case"string":return L.join("");case"array":return Array.prototype.concat.apply([],L);case"uint8array":for(G=new Uint8Array(J),K=0;K<L.length;K++)G.set(L[K],j),j+=L[K].length;return G;case"nodebuffer":return T.concat(L);default:throw new Error("concat : unsupported type '"+q+"'")}}(w,y),R);m(D)}catch(q){g(q)}y=[]}).resume()});var l,h},on:function(i,l){var h=this;return i==="data"?this._worker.on(i,function(m){l.call(h,m.data,m.meta)}):this._worker.on(i,function(){o.delay(l,arguments,h)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(i){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},i)}},f.exports=a},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(S,f,d){if(d.base64=!0,d.array=!0,d.string=!0,d.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",d.nodebuffer=T!==void 0,d.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")d.blob=!1;else{var o=new ArrayBuffer(0);try{d.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var c=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);c.append(o),d.blob=c.getBlob("application/zip").size===0}catch{d.blob=!1}}}try{d.nodestream=!!S("readable-stream").Readable}catch{d.nodestream=!1}},{"readable-stream":16}],31:[function(S,f,d){for(var o=S("./utils"),c=S("./support"),r=S("./nodejsUtils"),t=S("./stream/GenericWorker"),n=new Array(256),s=0;s<256;s++)n[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function u(){t.call(this,"utf-8 decode"),this.leftOver=null}function a(){t.call(this,"utf-8 encode")}n[254]=n[254]=1,d.utf8encode=function(i){if(c.nodebuffer)return r.newBufferFrom(i,"utf-8");for(var l,h,m,g,y=i,w=y.length,M=0,R=0;R<w;R++)(64512&(h=y.charCodeAt(R)))==55296&&R+1<w&&(64512&(m=y.charCodeAt(R+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),R++),M+=h<128?1:h<2048?2:h<65536?3:4;for(l=new(c.uint8array?Uint8Array:Array)(M),R=g=0;g<M;R++)(64512&(h=y.charCodeAt(R)))==55296&&R+1<w&&(64512&(m=y.charCodeAt(R+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),R++),h<128?l[g++]=h:(h<2048?l[g++]=192|h>>>6:(h<65536?l[g++]=224|h>>>12:(l[g++]=240|h>>>18,l[g++]=128|h>>>12&63),l[g++]=128|h>>>6&63),l[g++]=128|63&h);return l},d.utf8decode=function(i){if(c.nodebuffer)return o.transformTo("nodebuffer",i).toString("utf-8");for(var l,h,m,g=i=o.transformTo(c.uint8array?"uint8array":"array",i),y=g.length,w=new Array(2*y),M=l=0;M<y;)if((h=g[M++])<128)w[l++]=h;else if(4<(m=n[h]))w[l++]=65533,M+=m-1;else{for(h&=m===2?31:m===3?15:7;1<m&&M<y;)h=h<<6|63&g[M++],m--;1<m?w[l++]=65533:h<65536?w[l++]=h:(h-=65536,w[l++]=55296|h>>10&1023,w[l++]=56320|1023&h)}return w.length!==l&&(w.subarray?w=w.subarray(0,l):w.length=l),o.applyFromCharCode(w)},o.inherits(u,t),u.prototype.processChunk=function(i){var l=o.transformTo(c.uint8array?"uint8array":"array",i.data),h=(this.leftOver&&this.leftOver.length&&(c.uint8array?(h=l,(l=new Uint8Array(h.length+this.leftOver.length)).set(this.leftOver,0),l.set(h,this.leftOver.length)):l=this.leftOver.concat(l),this.leftOver=null),function(g,y){for(var w=(y=(y=y||g.length)>g.length?g.length:y)-1;0<=w&&(192&g[w])==128;)w--;return!(w<0)&&w!==0&&w+n[g[w]]>y?w:y}(l)),m=l;h!==l.length&&(c.uint8array?(m=l.subarray(0,h),this.leftOver=l.subarray(h,l.length)):(m=l.slice(0,h),this.leftOver=l.slice(h,l.length))),this.push({data:d.utf8decode(m),meta:i.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:d.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},d.Utf8DecodeWorker=u,o.inherits(a,t),a.prototype.processChunk=function(i){this.push({data:d.utf8encode(i.data),meta:i.meta})},d.Utf8EncodeWorker=a},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(S,f,d){var o=S("./support"),c=S("./base64"),r=S("./nodejsUtils"),t=S("./external");function n(h){return h}function s(h,m){for(var g=0;g<h.length;++g)m[g]=255&h.charCodeAt(g);return m}S("setimmediate"),d.newBlob=function(h,m){d.checkSupport("blob");try{return new Blob([h],{type:m})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(h),g.getBlob(m)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(h,m,g){var y=[],w=0,M=h.length;if(M<=g)return String.fromCharCode.apply(null,h);for(;w<M;)m==="array"||m==="nodebuffer"?y.push(String.fromCharCode.apply(null,h.slice(w,Math.min(w+g,M)))):y.push(String.fromCharCode.apply(null,h.subarray(w,Math.min(w+g,M)))),w+=g;return y.join("")},stringifyByChar:function(h){for(var m="",g=0;g<h.length;g++)m+=String.fromCharCode(h[g]);return m},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch{return!1}}()}};function a(h){var m=65536,g=d.getTypeOf(h),y=!0;if(g==="uint8array"?y=u.applyCanBeUsed.uint8array:g==="nodebuffer"&&(y=u.applyCanBeUsed.nodebuffer),y)for(;1<m;)try{return u.stringifyByChunk(h,g,m)}catch{m=Math.floor(m/2)}return u.stringifyByChar(h)}function i(h,m){for(var g=0;g<h.length;g++)m[g]=h[g];return m}d.applyFromCharCode=a;var l={};l.string={string:n,array:function(h){return s(h,new Array(h.length))},arraybuffer:function(h){return l.string.uint8array(h).buffer},uint8array:function(h){return s(h,new Uint8Array(h.length))},nodebuffer:function(h){return s(h,r.allocBuffer(h.length))}},l.array={string:a,array:n,arraybuffer:function(h){return new Uint8Array(h).buffer},uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return r.newBufferFrom(h)}},l.arraybuffer={string:function(h){return a(new Uint8Array(h))},array:function(h){return i(new Uint8Array(h),new Array(h.byteLength))},arraybuffer:n,uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return r.newBufferFrom(new Uint8Array(h))}},l.uint8array={string:a,array:function(h){return i(h,new Array(h.length))},arraybuffer:function(h){return h.buffer},uint8array:n,nodebuffer:function(h){return r.newBufferFrom(h)}},l.nodebuffer={string:a,array:function(h){return i(h,new Array(h.length))},arraybuffer:function(h){return l.nodebuffer.uint8array(h).buffer},uint8array:function(h){return i(h,new Uint8Array(h.length))},nodebuffer:n},d.transformTo=function(h,m){if(m=m||"",!h)return m;d.checkSupport(h);var g=d.getTypeOf(m);return l[g][h](m)},d.resolve=function(h){for(var m=h.split("/"),g=[],y=0;y<m.length;y++){var w=m[y];w==="."||w===""&&y!==0&&y!==m.length-1||(w===".."?g.pop():g.push(w))}return g.join("/")},d.getTypeOf=function(h){return typeof h=="string"?"string":Object.prototype.toString.call(h)==="[object Array]"?"array":o.nodebuffer&&r.isBuffer(h)?"nodebuffer":o.uint8array&&h instanceof Uint8Array?"uint8array":o.arraybuffer&&h instanceof ArrayBuffer?"arraybuffer":void 0},d.checkSupport=function(h){if(!o[h.toLowerCase()])throw new Error(h+" is not supported by this platform")},d.MAX_VALUE_16BITS=65535,d.MAX_VALUE_32BITS=-1,d.pretty=function(h){for(var m,g="",y=0;y<(h||"").length;y++)g+="\\x"+((m=h.charCodeAt(y))<16?"0":"")+m.toString(16).toUpperCase();return g},d.delay=function(h,m,g){I(function(){h.apply(g||null,m||[])})},d.inherits=function(h,m){function g(){}g.prototype=m.prototype,h.prototype=new g},d.extend=function(){for(var h,m={},g=0;g<arguments.length;g++)for(h in arguments[g])arguments[g].hasOwnProperty(h)&&m[h]===void 0&&(m[h]=arguments[g][h]);return m},d.prepareContent=function(h,m,g,y,w){return t.Promise.resolve(m).then(function(M){return o.blob&&(M instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(M))!==-1)&&typeof FileReader<"u"?new t.Promise(function(R,D){var q=new FileReader;q.onload=function(L){R(L.target.result)},q.onerror=function(L){D(L.target.error)},q.readAsArrayBuffer(M)}):M}).then(function(M){var R=d.getTypeOf(M);return R?(R==="arraybuffer"?M=d.transformTo("uint8array",M):R==="string"&&(w?M=c.decode(M):g&&y!==!0&&(M=s(R=M,new(o.uint8array?Uint8Array:Array)(R.length)))),M):t.Promise.reject(new Error("Can't read the data of '"+h+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(S,f,d){var o=S("./reader/readerFor"),c=S("./utils"),r=S("./signature"),t=S("./zipEntry"),n=(S("./utf8"),S("./support"));function s(u){this.files=[],this.loadOptions=u}s.prototype={checkSignature:function(u){var a;if(!this.reader.readAndCheckSignature(u))throw this.reader.index-=4,a=this.reader.readString(4),new Error("Corrupted zip or bug: unexpected signature ("+c.pretty(a)+", expected "+c.pretty(u)+")")},isSignature:function(u,a){var i=this.reader.index;return this.reader.setIndex(u),u=this.reader.readString(4)===a,this.reader.setIndex(i),u},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),a=n.uint8array?"uint8array":"array";a=c.transformTo(a,u),this.zipComment=this.loadOptions.decodeFileName(a)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,a,i,l=this.zip64EndOfCentralSize-44;0<l;)u=this.reader.readInt(2),a=this.reader.readInt(4),i=this.reader.readData(a),this.zip64ExtensibleData[u]={id:u,length:a,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var u,a=0;a<this.files.length;a++)u=this.files[a],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(u=new t({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var a=u;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===c.MAX_VALUE_16BITS||this.diskWithCentralDirStart===c.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===c.MAX_VALUE_16BITS||this.centralDirRecords===c.MAX_VALUE_16BITS||this.centralDirSize===c.MAX_VALUE_32BITS||this.centralDirOffset===c.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}if(u=this.centralDirOffset+this.centralDirSize,0<(u=a-(u=this.zip64?u+20+(12+this.zip64EndOfCentralSize):u)))this.isSignature(a,r.CENTRAL_FILE_HEADER)||(this.reader.zero=u);else if(u<0)throw new Error("Corrupted zip: missing "+Math.abs(u)+" bytes.")},prepareReader:function(u){this.reader=o(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},f.exports=s},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(S,f,d){var o=S("./reader/readerFor"),c=S("./utils"),r=S("./compressedObject"),t=S("./crc32"),n=S("./utf8"),s=S("./compressions"),u=S("./support");function a(i,l){this.options=i,this.loadOptions=l}a.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(i){var l;if(i.skip(22),this.fileNameLength=i.readInt(2),l=i.readInt(2),this.fileName=i.readData(this.fileNameLength),i.skip(l),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((l=function(h){for(var m in s)if(s.hasOwnProperty(m)&&s[m].magic===h)return s[m];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+c.pretty(this.compressionMethod)+" unknown (inner file : "+c.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,l,i.readData(this.compressedSize))},readCentralPart:function(i){this.versionMadeBy=i.readInt(2),i.skip(2),this.bitFlag=i.readInt(2),this.compressionMethod=i.readString(2),this.date=i.readDate(),this.crc32=i.readInt(4),this.compressedSize=i.readInt(4),this.uncompressedSize=i.readInt(4);var l=i.readInt(2);if(this.extraFieldsLength=i.readInt(2),this.fileCommentLength=i.readInt(2),this.diskNumberStart=i.readInt(2),this.internalFileAttributes=i.readInt(2),this.externalFileAttributes=i.readInt(4),this.localHeaderOffset=i.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");i.skip(l),this.readExtraFields(i),this.parseZIP64ExtraField(i),this.fileComment=i.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var i=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),i==0&&(this.dosPermissions=63&this.externalFileAttributes),i==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(i){var l;this.extraFields[1]&&(l=o(this.extraFields[1].value),this.uncompressedSize===c.MAX_VALUE_32BITS&&(this.uncompressedSize=l.readInt(8)),this.compressedSize===c.MAX_VALUE_32BITS&&(this.compressedSize=l.readInt(8)),this.localHeaderOffset===c.MAX_VALUE_32BITS&&(this.localHeaderOffset=l.readInt(8)),this.diskNumberStart===c.MAX_VALUE_32BITS&&(this.diskNumberStart=l.readInt(4)))},readExtraFields:function(i){var l,h,m,g=i.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});i.index+4<g;)l=i.readInt(2),h=i.readInt(2),m=i.readData(h),this.extraFields[l]={id:l,length:h,value:m};i.setIndex(g)},handleUTF8:function(){var i,l=u.uint8array?"uint8array":"array";this.useUTF8()?(this.fileNameStr=n.utf8decode(this.fileName),this.fileCommentStr=n.utf8decode(this.fileComment)):((i=this.findExtraFieldUnicodePath())!==null?this.fileNameStr=i:(i=c.transformTo(l,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(i)),(i=this.findExtraFieldUnicodeComment())!==null?this.fileCommentStr=i:(i=c.transformTo(l,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(i)))},findExtraFieldUnicodePath:function(){var i,l=this.extraFields[28789];return l&&(i=o(l.value)).readInt(1)===1&&t(this.fileName)===i.readInt(4)?n.utf8decode(i.readData(l.length-5)):null},findExtraFieldUnicodeComment:function(){var i,l=this.extraFields[25461];return l&&(i=o(l.value)).readInt(1)===1&&t(this.fileComment)===i.readInt(4)?n.utf8decode(i.readData(l.length-5)):null}},f.exports=a},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(S,f,d){function o(l,h,m){this.name=l,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=h,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var c=S("./stream/StreamHelper"),r=S("./stream/DataWorker"),t=S("./utf8"),n=S("./compressedObject"),s=S("./stream/GenericWorker");o.prototype={internalStream:function(l){var h=null,m="string";try{if(!l)throw new Error("No output type specified.");var g=(m=l.toLowerCase())==="string"||m==="text",y=(m!=="binarystring"&&m!=="text"||(m="string"),h=this._decompressWorker(),!this._dataBinary);y&&!g&&(h=h.pipe(new t.Utf8EncodeWorker)),!y&&g&&(h=h.pipe(new t.Utf8DecodeWorker))}catch(w){(h=new s("error")).error(w)}return new c(h,m,"")},async:function(l,h){return this.internalStream(l).accumulate(h)},nodeStream:function(l,h){return this.internalStream(l||"nodebuffer").toNodejsStream(h)},_compressWorker:function(l,h){if(this._data instanceof n&&this._data.compression.magic===l.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new t.Utf8EncodeWorker)),n.createWorkerFrom(m,l,h)},_decompressWorker:function(){return this._data instanceof n?this._data.getContentWorker():this._data instanceof s?this._data:new r(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],a=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},i=0;i<u.length;i++)o.prototype[u[i]]=a;f.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(S,f,d){(function(o){var c,r,t,n,s=o.MutationObserver||o.WebKitMutationObserver,u=s?(r=0,s=new s(i),t=o.document.createTextNode(""),s.observe(t,{characterData:!0}),function(){t.data=r=++r%2}):o.setImmediate||o.MessageChannel===void 0?"document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var l=o.document.createElement("script");l.onreadystatechange=function(){i(),l.onreadystatechange=null,l.parentNode.removeChild(l),l=null},o.document.documentElement.appendChild(l)}:function(){setTimeout(i,0)}:((n=new o.MessageChannel).port1.onmessage=i,function(){n.port2.postMessage(0)}),a=[];function i(){var l,h;c=!0;for(var m=a.length;m;){for(h=a,a=[],l=-1;++l<m;)h[l]();m=a.length}c=!1}f.exports=function(l){a.push(l)!==1||c||u()}}).call(this,p!==void 0?p:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(S,f,d){var o=S("immediate");function c(){}var r={},t=["REJECTED"],n=["FULFILLED"],s=["PENDING"];function u(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,g!==c&&h(this,g)}function a(g,y,w){this.promise=g,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function i(g,y,w){o(function(){var M;try{M=y(w)}catch(R){return r.reject(g,R)}M===g?r.reject(g,new TypeError("Cannot resolve promise with itself")):r.resolve(g,M)})}function l(g){var y=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof y=="function")return function(){y.apply(g,arguments)}}function h(g,y){var w=!1;function M(q){w||(w=!0,r.reject(g,q))}function R(q){w||(w=!0,r.resolve(g,q))}var D=m(function(){y(R,M)});D.status==="error"&&M(D.value)}function m(g,y){var w={};try{w.value=g(y),w.status="success"}catch(M){w.status="error",w.value=M}return w}(f.exports=u).prototype.finally=function(g){if(typeof g!="function")return this;var y=this.constructor;return this.then(function(w){return y.resolve(g()).then(function(){return w})},function(w){return y.resolve(g()).then(function(){throw w})})},u.prototype.catch=function(g){return this.then(null,g)},u.prototype.then=function(g,y){if(typeof g!="function"&&this.state===n||typeof y!="function"&&this.state===t)return this;var w=new this.constructor(c);return this.state!==s?i(w,this.state===n?g:y,this.outcome):this.queue.push(new a(w,g,y)),w},a.prototype.callFulfilled=function(g){r.resolve(this.promise,g)},a.prototype.otherCallFulfilled=function(g){i(this.promise,this.onFulfilled,g)},a.prototype.callRejected=function(g){r.reject(this.promise,g)},a.prototype.otherCallRejected=function(g){i(this.promise,this.onRejected,g)},r.resolve=function(g,y){var w=m(l,y);if(w.status==="error")return r.reject(g,w.value);if(w=w.value)h(g,w);else{g.state=n,g.outcome=y;for(var M=-1,R=g.queue.length;++M<R;)g.queue[M].callFulfilled(y)}return g},r.reject=function(g,y){g.state=t,g.outcome=y;for(var w=-1,M=g.queue.length;++w<M;)g.queue[w].callRejected(y);return g},u.resolve=function(g){return g instanceof this?g:r.resolve(new this(c),g)},u.reject=function(g){var y=new this(c);return r.reject(y,g)},u.all=function(g){var y=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=g.length,M=!1;if(!w)return this.resolve([]);for(var R=new Array(w),D=0,q=-1,L=new this(c);++q<w;)(function(j,G){y.resolve(j).then(function(J){R[G]=J,++D!==w||M||(M=!0,r.resolve(L,R))},function(J){M||(M=!0,r.reject(L,J))})})(g[q],q);return L},u.race=function(g){if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=g.length,w=!1;if(!y)return this.resolve([]);for(var M,R=-1,D=new this(c);++R<y;)M=g[R],this.resolve(M).then(function(q){w||(w=!0,r.resolve(D,q))},function(q){w||(w=!0,r.reject(D,q))});return D}},{immediate:36}],38:[function(S,f,d){var o={};(0,S("./lib/utils/common").assign)(o,S("./lib/deflate"),S("./lib/inflate"),S("./lib/zlib/constants")),f.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(S,f,d){var o=S("./zlib/deflate"),c=S("./utils/common"),r=S("./utils/strings"),t=S("./zlib/messages"),n=S("./zlib/zstream"),s=Object.prototype.toString;function u(i){if(!(this instanceof u))return new u(i);this.options=c.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},i||{});var l=((i=this.options).raw&&0<i.windowBits?i.windowBits=-i.windowBits:i.gzip&&0<i.windowBits&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0,o.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy));if(l!==0)throw new Error(t[l]);if(i.header&&o.deflateSetHeader(this.strm,i.header),i.dictionary){if(i=typeof i.dictionary=="string"?r.string2buf(i.dictionary):s.call(i.dictionary)==="[object ArrayBuffer]"?new Uint8Array(i.dictionary):i.dictionary,(l=o.deflateSetDictionary(this.strm,i))!==0)throw new Error(t[l]);this._dict_set=!0}}function a(i,l){if((l=new u(l)).push(i,!0),l.err)throw l.msg||t[l.err];return l.result}u.prototype.push=function(i,l){var h,m,g=this.strm,y=this.options.chunkSize;if(this.ended)return!1;m=l===~~l?l:l===!0?4:0,typeof i=="string"?g.input=r.string2buf(i):s.call(i)==="[object ArrayBuffer]"?g.input=new Uint8Array(i):g.input=i,g.next_in=0,g.avail_in=g.input.length;do if(g.avail_out===0&&(g.output=new c.Buf8(y),g.next_out=0,g.avail_out=y),(h=o.deflate(g,m))!==1&&h!==0)return this.onEnd(h),!(this.ended=!0);while(g.avail_out!==0&&(g.avail_in!==0||m!==4&&m!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(c.shrinkBuf(g.output,g.next_out))):this.onData(c.shrinkBuf(g.output,g.next_out))),(0<g.avail_in||g.avail_out===0)&&h!==1);return m===4?(h=o.deflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===0):m!==2||(this.onEnd(0),!(g.avail_out=0))},u.prototype.onData=function(i){this.chunks.push(i)},u.prototype.onEnd=function(i){i===0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg},d.Deflate=u,d.deflate=a,d.deflateRaw=function(i,l){return(l=l||{}).raw=!0,a(i,l)},d.gzip=function(i,l){return(l=l||{}).gzip=!0,a(i,l)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(S,f,d){var o=S("./zlib/inflate"),c=S("./utils/common"),r=S("./utils/strings"),t=S("./zlib/constants"),n=S("./zlib/messages"),s=S("./zlib/zstream"),u=S("./zlib/gzheader"),a=Object.prototype.toString;function i(h){if(!(this instanceof i))return new i(h);this.options=c.assign({chunkSize:16384,windowBits:0,to:""},h||{});var m=this.options;if((h=(m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||h&&h.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&!(15&m.windowBits)&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0,o.inflateInit2(this.strm,m.windowBits)))!==t.Z_OK)throw new Error(n[h]);this.header=new u,o.inflateGetHeader(this.strm,this.header)}function l(h,m){if((m=new i(m)).push(h,!0),m.err)throw m.msg||n[m.err];return m.result}i.prototype.push=function(h,m){var g,y,w,M,R,D=this.strm,q=this.options.chunkSize,L=this.options.dictionary,j=!1;if(this.ended)return!1;y=m===~~m?m:m===!0?t.Z_FINISH:t.Z_NO_FLUSH,typeof h=="string"?D.input=r.binstring2buf(h):a.call(h)==="[object ArrayBuffer]"?D.input=new Uint8Array(h):D.input=h,D.next_in=0,D.avail_in=D.input.length;do if(D.avail_out===0&&(D.output=new c.Buf8(q),D.next_out=0,D.avail_out=q),(g=o.inflate(D,t.Z_NO_FLUSH))===t.Z_NEED_DICT&&L&&(R=typeof L=="string"?r.string2buf(L):a.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,g=o.inflateSetDictionary(this.strm,R)),g===t.Z_BUF_ERROR&&j===!0&&(g=t.Z_OK,j=!1),g!==t.Z_STREAM_END&&g!==t.Z_OK)return this.onEnd(g),!(this.ended=!0);while(!D.next_out||D.avail_out!==0&&g!==t.Z_STREAM_END&&(D.avail_in!==0||y!==t.Z_FINISH&&y!==t.Z_SYNC_FLUSH)||(this.options.to==="string"?(R=r.utf8border(D.output,D.next_out),w=D.next_out-R,M=r.buf2string(D.output,R),D.next_out=w,D.avail_out=q-w,w&&c.arraySet(D.output,D.output,R,w,0),this.onData(M)):this.onData(c.shrinkBuf(D.output,D.next_out))),D.avail_in===0&&D.avail_out===0&&(j=!0),(0<D.avail_in||D.avail_out===0)&&g!==t.Z_STREAM_END);return(y=g===t.Z_STREAM_END?t.Z_FINISH:y)===t.Z_FINISH?(g=o.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===t.Z_OK):y!==t.Z_SYNC_FLUSH||(this.onEnd(t.Z_OK),!(D.avail_out=0))},i.prototype.onData=function(h){this.chunks.push(h)},i.prototype.onEnd=function(h){h===t.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},d.Inflate=i,d.inflate=l,d.inflateRaw=function(h,m){return(m=m||{}).raw=!0,l(h,m)},d.ungzip=l},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(S,f,d){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u",c=(d.assign=function(t){for(var n=Array.prototype.slice.call(arguments,1);n.length;){var s=n.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(var u in s)s.hasOwnProperty(u)&&(t[u]=s[u])}}return t},d.shrinkBuf=function(t,n){return t.length===n?t:t.subarray?t.subarray(0,n):(t.length=n,t)},{arraySet:function(t,n,s,u,a){if(n.subarray&&t.subarray)t.set(n.subarray(s,s+u),a);else for(var i=0;i<u;i++)t[a+i]=n[s+i]},flattenChunks:function(t){for(var n,s,u,a,i=n=0,l=t.length;i<l;i++)n+=t[i].length;for(a=new Uint8Array(n),i=s=0,l=t.length;i<l;i++)u=t[i],a.set(u,s),s+=u.length;return a}}),r={arraySet:function(t,n,s,u,a){for(var i=0;i<u;i++)t[a+i]=n[s+i]},flattenChunks:function(t){return[].concat.apply([],t)}};d.setTyped=function(t){t?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,d.assign(d,c)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,r))},d.setTyped(o)},{}],42:[function(S,f,d){var o=S("./common"),c=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{c=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var t=new o.Buf8(256),n=0;n<256;n++)t[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;function s(u,a){if(a<65537&&(u.subarray&&r||!u.subarray&&c))return String.fromCharCode.apply(null,o.shrinkBuf(u,a));for(var i="",l=0;l<a;l++)i+=String.fromCharCode(u[l]);return i}t[254]=t[254]=1,d.string2buf=function(u){for(var a,i,l,h,m=u.length,g=0,y=0;y<m;y++)(64512&(i=u.charCodeAt(y)))==55296&&y+1<m&&(64512&(l=u.charCodeAt(y+1)))==56320&&(i=65536+(i-55296<<10)+(l-56320),y++),g+=i<128?1:i<2048?2:i<65536?3:4;for(a=new o.Buf8(g),y=h=0;h<g;y++)(64512&(i=u.charCodeAt(y)))==55296&&y+1<m&&(64512&(l=u.charCodeAt(y+1)))==56320&&(i=65536+(i-55296<<10)+(l-56320),y++),i<128?a[h++]=i:(i<2048?a[h++]=192|i>>>6:(i<65536?a[h++]=224|i>>>12:(a[h++]=240|i>>>18,a[h++]=128|i>>>12&63),a[h++]=128|i>>>6&63),a[h++]=128|63&i);return a},d.buf2binstring=function(u){return s(u,u.length)},d.binstring2buf=function(u){for(var a=new o.Buf8(u.length),i=0,l=a.length;i<l;i++)a[i]=u.charCodeAt(i);return a},d.buf2string=function(u,a){for(var i,l,h,m=a||u.length,g=new Array(2*m),y=i=0;y<m;)if((l=u[y++])<128)g[i++]=l;else if(4<(h=t[l]))g[i++]=65533,y+=h-1;else{for(l&=h===2?31:h===3?15:7;1<h&&y<m;)l=l<<6|63&u[y++],h--;1<h?g[i++]=65533:l<65536?g[i++]=l:(l-=65536,g[i++]=55296|l>>10&1023,g[i++]=56320|1023&l)}return s(g,i)},d.utf8border=function(u,a){for(var i=(a=(a=a||u.length)>u.length?u.length:a)-1;0<=i&&(192&u[i])==128;)i--;return!(i<0)&&i!==0&&i+t[u[i]]>a?i:a}},{"./common":41}],43:[function(S,f,d){f.exports=function(o,c,r,t){for(var n=65535&o|0,s=o>>>16&65535|0,u=0;r!==0;){for(r-=u=2e3<r?2e3:r;s=s+(n=n+c[t++]|0)|0,--u;);n%=65521,s%=65521}return n|s<<16|0}},{}],44:[function(S,f,d){f.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(S,f,d){var o=function(){for(var c=[],r=0;r<256;r++){for(var t=r,n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;c[r]=t}return c}();f.exports=function(c,r,t,n){var s=o,u=n+t;c^=-1;for(var a=n;a<u;a++)c=c>>>8^s[255&(c^r[a])];return-1^c}},{}],46:[function(S,f,d){var o,c=S("../utils/common"),r=S("./trees"),t=S("./adler32"),n=S("./crc32"),s=S("./messages"),u=-2,a=258,i=262,l=113;function h(v,E){return v.msg=s[E],E}function m(v){return(v<<1)-(4<v?9:0)}function g(v){for(var E=v.length;0<=--E;)v[E]=0}function y(v){var E=v.state,N=E.pending;(N=N>v.avail_out?v.avail_out:N)!==0&&(c.arraySet(v.output,E.pending_buf,E.pending_out,N,v.next_out),v.next_out+=N,E.pending_out+=N,v.total_out+=N,v.avail_out-=N,E.pending-=N,E.pending===0&&(E.pending_out=0))}function w(v,E){r._tr_flush_block(v,0<=v.block_start?v.block_start:-1,v.strstart-v.block_start,E),v.block_start=v.strstart,y(v.strm)}function M(v,E){v.pending_buf[v.pending++]=E}function R(v,E){v.pending_buf[v.pending++]=E>>>8&255,v.pending_buf[v.pending++]=255&E}function D(v,E){var N,P,H=v.max_chain_length,V=v.strstart,W=v.prev_length,B=v.nice_match,$=v.strstart>v.w_size-i?v.strstart-(v.w_size-i):0,X=v.window,ne=v.w_mask,oe=v.prev,ie=v.strstart+a,ue=X[V+W-1],pe=X[V+W];v.prev_length>=v.good_match&&(H>>=2),B>v.lookahead&&(B=v.lookahead);do if(X[(N=E)+W]===pe&&X[N+W-1]===ue&&X[N]===X[V]&&X[++N]===X[V+1]){for(V+=2,N++;X[++V]===X[++N]&&X[++V]===X[++N]&&X[++V]===X[++N]&&X[++V]===X[++N]&&X[++V]===X[++N]&&X[++V]===X[++N]&&X[++V]===X[++N]&&X[++V]===X[++N]&&V<ie;);if(P=a-(ie-V),V=ie-a,W<P){if(v.match_start=E,B<=(W=P))break;ue=X[V+W-1],pe=X[V+W]}}while((E=oe[E&ne])>$&&--H!=0);return W<=v.lookahead?W:v.lookahead}function q(v){var E,N,P,H,V,W,B,$,X,ne=v.w_size;do{if($=v.window_size-v.lookahead-v.strstart,v.strstart>=ne+(ne-i)){for(c.arraySet(v.window,v.window,ne,ne,0),v.match_start-=ne,v.strstart-=ne,v.block_start-=ne,E=N=v.hash_size;P=v.head[--E],v.head[E]=ne<=P?P-ne:0,--N;);for(E=N=ne;P=v.prev[--E],v.prev[E]=ne<=P?P-ne:0,--N;);$+=ne}if(v.strm.avail_in===0)break;if(V=v.strm,W=v.window,B=v.strstart+v.lookahead,X=void 0,N=(X=($=$)<(X=V.avail_in)?$:X)===0?0:(V.avail_in-=X,c.arraySet(W,V.input,V.next_in,X,B),V.state.wrap===1?V.adler=t(V.adler,W,X,B):V.state.wrap===2&&(V.adler=n(V.adler,W,X,B)),V.next_in+=X,V.total_in+=X,X),v.lookahead+=N,v.lookahead+v.insert>=3)for(H=v.strstart-v.insert,v.ins_h=v.window[H],v.ins_h=(v.ins_h<<v.hash_shift^v.window[H+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[H+3-1])&v.hash_mask,v.prev[H&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=H,H++,v.insert--,!(v.lookahead+v.insert<3)););}while(v.lookahead<i&&v.strm.avail_in!==0)}function L(v,E){for(var N,P;;){if(v.lookahead<i){if(q(v),v.lookahead<i&&E===0)return 1;if(v.lookahead===0)break}if(N=0,v.lookahead>=3&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+3-1])&v.hash_mask,N=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),N!==0&&v.strstart-N<=v.w_size-i&&(v.match_length=D(v,N)),v.match_length>=3)if(P=r._tr_tally(v,v.strstart-v.match_start,v.match_length-3),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=3){for(v.match_length--;v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+3-1])&v.hash_mask,N=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart,--v.match_length!=0;);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else P=r._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(P&&(w(v,!1),v.strm.avail_out===0))return 1}return v.insert=v.strstart<2?v.strstart:2,E===4?(w(v,!0),v.strm.avail_out===0?3:4):v.last_lit&&(w(v,!1),v.strm.avail_out===0)?1:2}function j(v,E){for(var N,P,H;;){if(v.lookahead<i){if(q(v),v.lookahead<i&&E===0)return 1;if(v.lookahead===0)break}if(N=0,v.lookahead>=3&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+3-1])&v.hash_mask,N=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=2,N!==0&&v.prev_length<v.max_lazy_match&&v.strstart-N<=v.w_size-i&&(v.match_length=D(v,N),v.match_length<=5&&(v.strategy===1||v.match_length===3&&4096<v.strstart-v.match_start)&&(v.match_length=2)),v.prev_length>=3&&v.match_length<=v.prev_length){for(H=v.strstart+v.lookahead-3,P=r._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-3),v.lookahead-=v.prev_length-1,v.prev_length-=2;++v.strstart<=H&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+3-1])&v.hash_mask,N=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),--v.prev_length!=0;);if(v.match_available=0,v.match_length=2,v.strstart++,P&&(w(v,!1),v.strm.avail_out===0))return 1}else if(v.match_available){if((P=r._tr_tally(v,0,v.window[v.strstart-1]))&&w(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return 1}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(P=r._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<2?v.strstart:2,E===4?(w(v,!0),v.strm.avail_out===0?3:4):v.last_lit&&(w(v,!1),v.strm.avail_out===0)?1:2}function G(v,E,N,P,H){this.good_length=v,this.max_lazy=E,this.nice_length=N,this.max_chain=P,this.func=H}function J(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new c.Buf16(1146),this.dyn_dtree=new c.Buf16(122),this.bl_tree=new c.Buf16(78),g(this.dyn_ltree),g(this.dyn_dtree),g(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new c.Buf16(16),this.heap=new c.Buf16(573),g(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new c.Buf16(573),g(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function K(v){var E;return v&&v.state?(v.total_in=v.total_out=0,v.data_type=2,(E=v.state).pending=0,E.pending_out=0,E.wrap<0&&(E.wrap=-E.wrap),E.status=E.wrap?42:l,v.adler=E.wrap===2?0:1,E.last_flush=0,r._tr_init(E),0):h(v,u)}function ee(v){var E=K(v);return E===0&&((v=v.state).window_size=2*v.w_size,g(v.head),v.max_lazy_match=o[v.level].max_lazy,v.good_match=o[v.level].good_length,v.nice_match=o[v.level].nice_length,v.max_chain_length=o[v.level].max_chain,v.strstart=0,v.block_start=0,v.lookahead=0,v.insert=0,v.match_length=v.prev_length=2,v.match_available=0,v.ins_h=0),E}function A(v,E,N,P,H,V){if(!v)return u;var W=1;if(E===-1&&(E=6),P<0?(W=0,P=-P):15<P&&(W=2,P-=16),H<1||9<H||N!==8||P<8||15<P||E<0||9<E||V<0||4<V)return h(v,u);P===8&&(P=9);var B=new J;return(v.state=B).strm=v,B.wrap=W,B.gzhead=null,B.w_bits=P,B.w_size=1<<B.w_bits,B.w_mask=B.w_size-1,B.hash_bits=H+7,B.hash_size=1<<B.hash_bits,B.hash_mask=B.hash_size-1,B.hash_shift=~~((B.hash_bits+3-1)/3),B.window=new c.Buf8(2*B.w_size),B.head=new c.Buf16(B.hash_size),B.prev=new c.Buf16(B.w_size),B.lit_bufsize=1<<H+6,B.pending_buf_size=4*B.lit_bufsize,B.pending_buf=new c.Buf8(B.pending_buf_size),B.d_buf=+B.lit_bufsize,B.l_buf=3*B.lit_bufsize,B.level=E,B.strategy=V,B.method=N,ee(v)}o=[new G(0,0,0,0,function(v,E){var N=65535;for(N>v.pending_buf_size-5&&(N=v.pending_buf_size-5);;){if(v.lookahead<=1){if(q(v),v.lookahead===0&&E===0)return 1;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var P=v.block_start+N;if((v.strstart===0||v.strstart>=P)&&(v.lookahead=v.strstart-P,v.strstart=P,w(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-i&&(w(v,!1),v.strm.avail_out===0))return 1}return v.insert=0,E===4?(w(v,!0),v.strm.avail_out===0?3:4):(v.strstart>v.block_start&&(w(v,!1),v.strm.avail_out),1)}),new G(4,4,8,4,L),new G(4,5,16,8,L),new G(4,6,32,32,L),new G(4,4,16,16,j),new G(8,16,32,32,j),new G(8,16,128,128,j),new G(8,32,128,256,j),new G(32,128,258,1024,j),new G(32,258,258,4096,j)],d.deflateInit=function(v,E){return A(v,E,8,15,8,0)},d.deflateInit2=A,d.deflateReset=ee,d.deflateResetKeep=K,d.deflateSetHeader=function(v,E){return v&&v.state&&v.state.wrap===2?(v.state.gzhead=E,0):u},d.deflate=function(v,E){var N,P,H,V;if(!v||!v.state||5<E||E<0)return v?h(v,u):u;if(P=v.state,!v.output||!v.input&&v.avail_in!==0||P.status===666&&E!==4)return h(v,v.avail_out===0?-5:u);if(P.strm=v,N=P.last_flush,P.last_flush=E,P.status===42&&(P.wrap===2?(v.adler=0,M(P,31),M(P,139),M(P,8),P.gzhead?(M(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),M(P,255&P.gzhead.time),M(P,P.gzhead.time>>8&255),M(P,P.gzhead.time>>16&255),M(P,P.gzhead.time>>24&255),M(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),M(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(M(P,255&P.gzhead.extra.length),M(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(v.adler=n(v.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(M(P,0),M(P,0),M(P,0),M(P,0),M(P,0),M(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),M(P,3),P.status=l)):(W=8+(P.w_bits-8<<4)<<8,W|=(2<=P.strategy||P.level<2?0:P.level<6?1:P.level===6?2:3)<<6,P.strstart!==0&&(W|=32),W+=31-W%31,P.status=l,R(P,W),P.strstart!==0&&(R(P,v.adler>>>16),R(P,65535&v.adler)),v.adler=1)),P.status===69)if(P.gzhead.extra){for(H=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>H&&(v.adler=n(v.adler,P.pending_buf,P.pending-H,H)),y(v),H=P.pending,P.pending!==P.pending_buf_size));)M(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>H&&(v.adler=n(v.adler,P.pending_buf,P.pending-H,H)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(P.status===73)if(P.gzhead.name){H=P.pending;do if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>H&&(v.adler=n(v.adler,P.pending_buf,P.pending-H,H)),y(v),H=P.pending,P.pending===P.pending_buf_size)){V=1;break}while(V=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,M(P,V),V!==0);P.gzhead.hcrc&&P.pending>H&&(v.adler=n(v.adler,P.pending_buf,P.pending-H,H)),V===0&&(P.gzindex=0,P.status=91)}else P.status=91;if(P.status===91)if(P.gzhead.comment){H=P.pending;do if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>H&&(v.adler=n(v.adler,P.pending_buf,P.pending-H,H)),y(v),H=P.pending,P.pending===P.pending_buf_size)){V=1;break}while(V=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,M(P,V),V!==0);P.gzhead.hcrc&&P.pending>H&&(v.adler=n(v.adler,P.pending_buf,P.pending-H,H)),V===0&&(P.status=103)}else P.status=103;if(P.status===103&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&y(v),P.pending+2<=P.pending_buf_size&&(M(P,255&v.adler),M(P,v.adler>>8&255),v.adler=0,P.status=l)):P.status=l),P.pending!==0){if(y(v),v.avail_out===0)return P.last_flush=-1,0}else if(v.avail_in===0&&m(E)<=m(N)&&E!==4)return h(v,-5);if(P.status===666&&v.avail_in!==0)return h(v,-5);if(v.avail_in!==0||P.lookahead!==0||E!==0&&P.status!==666){var W=P.strategy===2?function(B,$){for(var X;;){if(B.lookahead===0&&(q(B),B.lookahead===0)){if($===0)return 1;break}if(B.match_length=0,X=r._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,X&&(w(B,!1),B.strm.avail_out===0))return 1}return B.insert=0,$===4?(w(B,!0),B.strm.avail_out===0?3:4):B.last_lit&&(w(B,!1),B.strm.avail_out===0)?1:2}(P,E):P.strategy===3?function(B,$){for(var X,ne,oe,ie,ue=B.window;;){if(B.lookahead<=a){if(q(B),B.lookahead<=a&&$===0)return 1;if(B.lookahead===0)break}if(B.match_length=0,B.lookahead>=3&&0<B.strstart&&(ne=ue[oe=B.strstart-1])===ue[++oe]&&ne===ue[++oe]&&ne===ue[++oe]){for(ie=B.strstart+a;ne===ue[++oe]&&ne===ue[++oe]&&ne===ue[++oe]&&ne===ue[++oe]&&ne===ue[++oe]&&ne===ue[++oe]&&ne===ue[++oe]&&ne===ue[++oe]&&oe<ie;);B.match_length=a-(ie-oe),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=3?(X=r._tr_tally(B,1,B.match_length-3),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(X=r._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),X&&(w(B,!1),B.strm.avail_out===0))return 1}return B.insert=0,$===4?(w(B,!0),B.strm.avail_out===0?3:4):B.last_lit&&(w(B,!1),B.strm.avail_out===0)?1:2}(P,E):o[P.level].func(P,E);if(W!==3&&W!==4||(P.status=666),W===1||W===3)return v.avail_out===0&&(P.last_flush=-1),0;if(W===2&&(E===1?r._tr_align(P):E!==5&&(r._tr_stored_block(P,0,0,!1),E===3&&(g(P.head),P.lookahead===0&&(P.strstart=0,P.block_start=0,P.insert=0))),y(v),v.avail_out===0))return P.last_flush=-1,0}return E!==4?0:P.wrap<=0?1:(P.wrap===2?(M(P,255&v.adler),M(P,v.adler>>8&255),M(P,v.adler>>16&255),M(P,v.adler>>24&255),M(P,255&v.total_in),M(P,v.total_in>>8&255),M(P,v.total_in>>16&255),M(P,v.total_in>>24&255)):(R(P,v.adler>>>16),R(P,65535&v.adler)),y(v),0<P.wrap&&(P.wrap=-P.wrap),P.pending!==0?0:1)},d.deflateEnd=function(v){var E;return v&&v.state?(E=v.state.status)!==42&&E!==69&&E!==73&&E!==91&&E!==103&&E!==l&&E!==666?h(v,u):(v.state=null,E===l?h(v,-3):0):u},d.deflateSetDictionary=function(v,E){var N,P,H,V,W,B,$,X=E.length;if(!v||!v.state||(V=(N=v.state).wrap)===2||V===1&&N.status!==42||N.lookahead)return u;for(V===1&&(v.adler=t(v.adler,E,X,0)),N.wrap=0,X>=N.w_size&&(V===0&&(g(N.head),N.strstart=0,N.block_start=0,N.insert=0),$=new c.Buf8(N.w_size),c.arraySet($,E,X-N.w_size,N.w_size,0),E=$,X=N.w_size),$=v.avail_in,W=v.next_in,B=v.input,v.avail_in=X,v.next_in=0,v.input=E,q(N);N.lookahead>=3;){for(P=N.strstart,H=N.lookahead-2;N.ins_h=(N.ins_h<<N.hash_shift^N.window[P+3-1])&N.hash_mask,N.prev[P&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=P,P++,--H;);N.strstart=P,N.lookahead=2,q(N)}return N.strstart+=N.lookahead,N.block_start=N.strstart,N.insert=N.lookahead,N.lookahead=0,N.match_length=N.prev_length=2,N.match_available=0,v.next_in=W,v.input=B,v.avail_in=$,N.wrap=V,0},d.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(S,f,d){f.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(S,f,d){f.exports=function(o,c){var r,t,n,s,u,a,i=o.state,l=o.next_in,h=o.input,m=l+(o.avail_in-5),g=o.next_out,y=o.output,w=g-(c-o.avail_out),M=g+(o.avail_out-257),R=i.dmax,D=i.wsize,q=i.whave,L=i.wnext,j=i.window,G=i.hold,J=i.bits,K=i.lencode,ee=i.distcode,A=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;e:do for(J<15&&(G+=h[l++]<<J,J+=8,G+=h[l++]<<J,J+=8),r=K[G&A];;){if(G>>>=t=r>>>24,J-=t,(t=r>>>16&255)==0)y[g++]=65535&r;else{if(!(16&t)){if(!(64&t)){r=K[(65535&r)+(G&(1<<t)-1)];continue}if(32&t){i.mode=12;break e}o.msg="invalid literal/length code",i.mode=30;break e}for(n=65535&r,(t&=15)&&(J<t&&(G+=h[l++]<<J,J+=8),n+=G&(1<<t)-1,G>>>=t,J-=t),J<15&&(G+=h[l++]<<J,J+=8,G+=h[l++]<<J,J+=8),r=ee[G&v];;){if(G>>>=t=r>>>24,J-=t,!(16&(t=r>>>16&255))){if(!(64&t)){r=ee[(65535&r)+(G&(1<<t)-1)];continue}o.msg="invalid distance code",i.mode=30;break e}if(s=65535&r,J<(t&=15)&&(G+=h[l++]<<J,(J+=8)<t&&(G+=h[l++]<<J,J+=8)),R<(s+=G&(1<<t)-1)){o.msg="invalid distance too far back",i.mode=30;break e}if(G>>>=t,J-=t,(t=g-w)<s){if(q<(t=s-t)&&i.sane){o.msg="invalid distance too far back",i.mode=30;break e}if(a=j,(u=0)===L){if(u+=D-t,t<n){for(n-=t;y[g++]=j[u++],--t;);u=g-s,a=y}}else if(L<t){if(u+=D+L-t,(t-=L)<n){for(n-=t;y[g++]=j[u++],--t;);if(u=0,L<n){for(n-=t=L;y[g++]=j[u++],--t;);u=g-s,a=y}}}else if(u+=L-t,t<n){for(n-=t;y[g++]=j[u++],--t;);u=g-s,a=y}for(;2<n;)y[g++]=a[u++],y[g++]=a[u++],y[g++]=a[u++],n-=3;n&&(y[g++]=a[u++],1<n&&(y[g++]=a[u++]))}else{for(u=g-s;y[g++]=y[u++],y[g++]=y[u++],y[g++]=y[u++],2<(n-=3););n&&(y[g++]=y[u++],1<n&&(y[g++]=y[u++]))}break}}break}while(l<m&&g<M);l-=n=J>>3,G&=(1<<(J-=n<<3))-1,o.next_in=l,o.next_out=g,o.avail_in=l<m?m-l+5:5-(l-m),o.avail_out=g<M?M-g+257:257-(g-M),i.hold=G,i.bits=J}},{}],49:[function(S,f,d){var o=S("../utils/common"),c=S("./adler32"),r=S("./crc32"),t=S("./inffast"),n=S("./inftrees"),s=-2;function u(R){return(R>>>24&255)+(R>>>8&65280)+((65280&R)<<8)+((255&R)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function i(R){var D;return R&&R.state?(D=R.state,R.total_in=R.total_out=D.total=0,R.msg="",D.wrap&&(R.adler=1&D.wrap),D.mode=1,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new o.Buf32(852),D.distcode=D.distdyn=new o.Buf32(592),D.sane=1,D.back=-1,0):s}function l(R){var D;return R&&R.state?((D=R.state).wsize=0,D.whave=0,D.wnext=0,i(R)):s}function h(R,D){var q,L;return R&&R.state?(L=R.state,D<0?(q=0,D=-D):(q=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?s:(L.window!==null&&L.wbits!==D&&(L.window=null),L.wrap=q,L.wbits=D,l(R))):s}function m(R,D){var q;return R?(q=new a,(R.state=q).window=null,(q=h(R,D))!==0&&(R.state=null),q):s}var g,y,w=!0;function M(R,D,q,L){var j;return(R=R.state).window===null&&(R.wsize=1<<R.wbits,R.wnext=0,R.whave=0,R.window=new o.Buf8(R.wsize)),L>=R.wsize?(o.arraySet(R.window,D,q-R.wsize,R.wsize,0),R.wnext=0,R.whave=R.wsize):(L<(j=R.wsize-R.wnext)&&(j=L),o.arraySet(R.window,D,q-L,j,R.wnext),(L-=j)?(o.arraySet(R.window,D,q-L,L,0),R.wnext=L,R.whave=R.wsize):(R.wnext+=j,R.wnext===R.wsize&&(R.wnext=0),R.whave<R.wsize&&(R.whave+=j))),0}d.inflateReset=l,d.inflateReset2=h,d.inflateResetKeep=i,d.inflateInit=function(R){return m(R,15)},d.inflateInit2=m,d.inflate=function(R,D){var q,L,j,G,J,K,ee,A,v,E,N,P,H,V,W,B,$,X,ne,oe,ie,ue,pe,de,_e=0,le=new o.Buf8(4),be=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!R||!R.state||!R.output||!R.input&&R.avail_in!==0)return s;(q=R.state).mode===12&&(q.mode=13),J=R.next_out,j=R.output,ee=R.avail_out,G=R.next_in,L=R.input,K=R.avail_in,A=q.hold,v=q.bits,E=K,N=ee,ue=0;e:for(;;)switch(q.mode){case 1:if(q.wrap===0){q.mode=13;break}for(;v<16;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}if(2&q.wrap&&A===35615){le[q.check=0]=255&A,le[1]=A>>>8&255,q.check=r(q.check,le,2,0),v=A=0,q.mode=2;break}if(q.flags=0,q.head&&(q.head.done=!1),!(1&q.wrap)||(((255&A)<<8)+(A>>8))%31){R.msg="incorrect header check",q.mode=30;break}if((15&A)!=8){R.msg="unknown compression method",q.mode=30;break}if(v-=4,ie=8+(15&(A>>>=4)),q.wbits===0)q.wbits=ie;else if(ie>q.wbits){R.msg="invalid window size",q.mode=30;break}q.dmax=1<<ie,R.adler=q.check=1,q.mode=512&A?10:12,v=A=0;break;case 2:for(;v<16;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}if(q.flags=A,(255&q.flags)!=8){R.msg="unknown compression method",q.mode=30;break}if(57344&q.flags){R.msg="unknown header flags set",q.mode=30;break}q.head&&(q.head.text=A>>8&1),512&q.flags&&(le[0]=255&A,le[1]=A>>>8&255,q.check=r(q.check,le,2,0)),v=A=0,q.mode=3;case 3:for(;v<32;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}q.head&&(q.head.time=A),512&q.flags&&(le[0]=255&A,le[1]=A>>>8&255,le[2]=A>>>16&255,le[3]=A>>>24&255,q.check=r(q.check,le,4,0)),v=A=0,q.mode=4;case 4:for(;v<16;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}q.head&&(q.head.xflags=255&A,q.head.os=A>>8),512&q.flags&&(le[0]=255&A,le[1]=A>>>8&255,q.check=r(q.check,le,2,0)),v=A=0,q.mode=5;case 5:if(1024&q.flags){for(;v<16;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}q.length=A,q.head&&(q.head.extra_len=A),512&q.flags&&(le[0]=255&A,le[1]=A>>>8&255,q.check=r(q.check,le,2,0)),v=A=0}else q.head&&(q.head.extra=null);q.mode=6;case 6:if(1024&q.flags&&((P=K<(P=q.length)?K:P)&&(q.head&&(ie=q.head.extra_len-q.length,q.head.extra||(q.head.extra=new Array(q.head.extra_len)),o.arraySet(q.head.extra,L,G,P,ie)),512&q.flags&&(q.check=r(q.check,L,P,G)),K-=P,G+=P,q.length-=P),q.length))break e;q.length=0,q.mode=7;case 7:if(2048&q.flags){if(K===0)break e;for(P=0;ie=L[G+P++],q.head&&ie&&q.length<65536&&(q.head.name+=String.fromCharCode(ie)),ie&&P<K;);if(512&q.flags&&(q.check=r(q.check,L,P,G)),K-=P,G+=P,ie)break e}else q.head&&(q.head.name=null);q.length=0,q.mode=8;case 8:if(4096&q.flags){if(K===0)break e;for(P=0;ie=L[G+P++],q.head&&ie&&q.length<65536&&(q.head.comment+=String.fromCharCode(ie)),ie&&P<K;);if(512&q.flags&&(q.check=r(q.check,L,P,G)),K-=P,G+=P,ie)break e}else q.head&&(q.head.comment=null);q.mode=9;case 9:if(512&q.flags){for(;v<16;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}if(A!==(65535&q.check)){R.msg="header crc mismatch",q.mode=30;break}v=A=0}q.head&&(q.head.hcrc=q.flags>>9&1,q.head.done=!0),R.adler=q.check=0,q.mode=12;break;case 10:for(;v<32;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}R.adler=q.check=u(A),v=A=0,q.mode=11;case 11:if(q.havedict===0)return R.next_out=J,R.avail_out=ee,R.next_in=G,R.avail_in=K,q.hold=A,q.bits=v,2;R.adler=q.check=1,q.mode=12;case 12:if(D===5||D===6)break e;case 13:if(q.last){A>>>=7&v,v-=7&v,q.mode=27;break}for(;v<3;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}switch(q.last=1&A,--v,3&(A>>>=1)){case 0:q.mode=14;break;case 1:ge=ve=void 0;var ge,ve=q;if(w){for(g=new o.Buf32(512),y=new o.Buf32(32),ge=0;ge<144;)ve.lens[ge++]=8;for(;ge<256;)ve.lens[ge++]=9;for(;ge<280;)ve.lens[ge++]=7;for(;ge<288;)ve.lens[ge++]=8;for(n(1,ve.lens,0,288,g,0,ve.work,{bits:9}),ge=0;ge<32;)ve.lens[ge++]=5;n(2,ve.lens,0,32,y,0,ve.work,{bits:5}),w=!1}if(ve.lencode=g,ve.lenbits=9,ve.distcode=y,ve.distbits=5,q.mode=20,D!==6)break;A>>>=2,v-=2;break e;case 2:q.mode=17;break;case 3:R.msg="invalid block type",q.mode=30}A>>>=2,v-=2;break;case 14:for(A>>>=7&v,v-=7&v;v<32;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}if((65535&A)!=(A>>>16^65535)){R.msg="invalid stored block lengths",q.mode=30;break}if(q.length=65535&A,v=A=0,q.mode=15,D===6)break e;case 15:q.mode=16;case 16:if(P=q.length){if((P=ee<(P=K<P?K:P)?ee:P)===0)break e;o.arraySet(j,L,G,P,J),K-=P,G+=P,ee-=P,J+=P,q.length-=P;break}q.mode=12;break;case 17:for(;v<14;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}if(q.nlen=257+(31&A),A>>>=5,v-=5,q.ndist=1+(31&A),A>>>=5,v-=5,q.ncode=4+(15&A),A>>>=4,v-=4,286<q.nlen||30<q.ndist){R.msg="too many length or distance symbols",q.mode=30;break}q.have=0,q.mode=18;case 18:for(;q.have<q.ncode;){for(;v<3;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}q.lens[be[q.have++]]=7&A,A>>>=3,v-=3}for(;q.have<19;)q.lens[be[q.have++]]=0;if(q.lencode=q.lendyn,q.lenbits=7,pe={bits:q.lenbits},ue=n(0,q.lens,0,19,q.lencode,0,q.work,pe),q.lenbits=pe.bits,ue){R.msg="invalid code lengths set",q.mode=30;break}q.have=0,q.mode=19;case 19:for(;q.have<q.nlen+q.ndist;){for(;B=(_e=q.lencode[A&(1<<q.lenbits)-1])>>>16&255,$=65535&_e,!((W=_e>>>24)<=v);){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}if($<16)A>>>=W,v-=W,q.lens[q.have++]=$;else{if($===16){for(de=W+2;v<de;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}if(A>>>=W,v-=W,q.have===0){R.msg="invalid bit length repeat",q.mode=30;break}ie=q.lens[q.have-1],P=3+(3&A),A>>>=2,v-=2}else if($===17){for(de=W+3;v<de;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}ie=0,P=3+(7&(A>>>=W)),A>>>=3,v=v-W-3}else{for(de=W+7;v<de;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}ie=0,P=11+(127&(A>>>=W)),A>>>=7,v=v-W-7}if(q.have+P>q.nlen+q.ndist){R.msg="invalid bit length repeat",q.mode=30;break}for(;P--;)q.lens[q.have++]=ie}}if(q.mode===30)break;if(q.lens[256]===0){R.msg="invalid code -- missing end-of-block",q.mode=30;break}if(q.lenbits=9,pe={bits:q.lenbits},ue=n(1,q.lens,0,q.nlen,q.lencode,0,q.work,pe),q.lenbits=pe.bits,ue){R.msg="invalid literal/lengths set",q.mode=30;break}if(q.distbits=6,q.distcode=q.distdyn,pe={bits:q.distbits},ue=n(2,q.lens,q.nlen,q.ndist,q.distcode,0,q.work,pe),q.distbits=pe.bits,ue){R.msg="invalid distances set",q.mode=30;break}if(q.mode=20,D===6)break e;case 20:q.mode=21;case 21:if(6<=K&&258<=ee){R.next_out=J,R.avail_out=ee,R.next_in=G,R.avail_in=K,q.hold=A,q.bits=v,t(R,N),J=R.next_out,j=R.output,ee=R.avail_out,G=R.next_in,L=R.input,K=R.avail_in,A=q.hold,v=q.bits,q.mode===12&&(q.back=-1);break}for(q.back=0;B=(_e=q.lencode[A&(1<<q.lenbits)-1])>>>16&255,$=65535&_e,!((W=_e>>>24)<=v);){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}if(B&&!(240&B)){for(X=W,ne=B,oe=$;B=(_e=q.lencode[oe+((A&(1<<X+ne)-1)>>X)])>>>16&255,$=65535&_e,!(X+(W=_e>>>24)<=v);){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}A>>>=X,v-=X,q.back+=X}if(A>>>=W,v-=W,q.back+=W,q.length=$,B===0){q.mode=26;break}if(32&B){q.back=-1,q.mode=12;break}if(64&B){R.msg="invalid literal/length code",q.mode=30;break}q.extra=15&B,q.mode=22;case 22:if(q.extra){for(de=q.extra;v<de;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}q.length+=A&(1<<q.extra)-1,A>>>=q.extra,v-=q.extra,q.back+=q.extra}q.was=q.length,q.mode=23;case 23:for(;B=(_e=q.distcode[A&(1<<q.distbits)-1])>>>16&255,$=65535&_e,!((W=_e>>>24)<=v);){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}if(!(240&B)){for(X=W,ne=B,oe=$;B=(_e=q.distcode[oe+((A&(1<<X+ne)-1)>>X)])>>>16&255,$=65535&_e,!(X+(W=_e>>>24)<=v);){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}A>>>=X,v-=X,q.back+=X}if(A>>>=W,v-=W,q.back+=W,64&B){R.msg="invalid distance code",q.mode=30;break}q.offset=$,q.extra=15&B,q.mode=24;case 24:if(q.extra){for(de=q.extra;v<de;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}q.offset+=A&(1<<q.extra)-1,A>>>=q.extra,v-=q.extra,q.back+=q.extra}if(q.offset>q.dmax){R.msg="invalid distance too far back",q.mode=30;break}q.mode=25;case 25:if(ee===0)break e;if(q.offset>(P=N-ee)){if((P=q.offset-P)>q.whave&&q.sane){R.msg="invalid distance too far back",q.mode=30;break}H=P>q.wnext?(P-=q.wnext,q.wsize-P):q.wnext-P,P>q.length&&(P=q.length),V=q.window}else V=j,H=J-q.offset,P=q.length;for(ee-=P=ee<P?ee:P,q.length-=P;j[J++]=V[H++],--P;);q.length===0&&(q.mode=21);break;case 26:if(ee===0)break e;j[J++]=q.length,ee--,q.mode=21;break;case 27:if(q.wrap){for(;v<32;){if(K===0)break e;K--,A|=L[G++]<<v,v+=8}if(N-=ee,R.total_out+=N,q.total+=N,N&&(R.adler=q.check=(q.flags?r:c)(q.check,j,N,J-N)),N=ee,(q.flags?A:u(A))!==q.check){R.msg="incorrect data check",q.mode=30;break}v=A=0}q.mode=28;case 28:if(q.wrap&&q.flags){for(;v<32;){if(K===0)break e;K--,A+=L[G++]<<v,v+=8}if(A!==(4294967295&q.total)){R.msg="incorrect length check",q.mode=30;break}v=A=0}q.mode=29;case 29:ue=1;break e;case 30:ue=-3;break e;case 31:return-4;default:return s}return R.next_out=J,R.avail_out=ee,R.next_in=G,R.avail_in=K,q.hold=A,q.bits=v,(q.wsize||N!==R.avail_out&&q.mode<30&&(q.mode<27||D!==4))&&M(R,R.output,R.next_out,N-R.avail_out)?(q.mode=31,-4):(E-=R.avail_in,N-=R.avail_out,R.total_in+=E,R.total_out+=N,q.total+=N,q.wrap&&N&&(R.adler=q.check=(q.flags?r:c)(q.check,j,N,R.next_out-N)),R.data_type=q.bits+(q.last?64:0)+(q.mode===12?128:0)+(q.mode===20||q.mode===15?256:0),ue=(E==0&&N===0||D===4)&&ue===0?-5:ue)},d.inflateEnd=function(R){if(!R||!R.state)return s;var D=R.state;return D.window&&(D.window=null),R.state=null,0},d.inflateGetHeader=function(R,D){return R&&R.state&&2&(R=R.state).wrap?((R.head=D).done=!1,0):s},d.inflateSetDictionary=function(R,D){var q,L=D.length;return!R||!R.state||(q=R.state).wrap!==0&&q.mode!==11?s:q.mode===11&&c(1,D,L,0)!==q.check?-3:M(R,D,L,L)?(q.mode=31,-4):(q.havedict=1,0)},d.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(S,f,d){var o=S("../utils/common"),c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],t=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];f.exports=function(s,u,a,i,l,h,m,g){var y,w,M,R,D,q,L,j,G,J=g.bits,K=0,ee=0,A=0,v=0,E=0,N=0,P=0,H=0,V=0,W=0,B=null,$=0,X=new o.Buf16(16),ne=new o.Buf16(16),oe=null,ie=0;for(K=0;K<=15;K++)X[K]=0;for(ee=0;ee<i;ee++)X[u[a+ee]]++;for(E=J,v=15;1<=v&&X[v]===0;v--);if(v<E&&(E=v),v===0)return l[h++]=20971520,l[h++]=20971520,g.bits=1,0;for(A=1;A<v&&X[A]===0;A++);for(E<A&&(E=A),K=H=1;K<=15;K++)if((H=(H<<1)-X[K])<0)return-1;if(0<H&&(s===0||v!==1))return-1;for(ne[1]=0,K=1;K<15;K++)ne[K+1]=ne[K]+X[K];for(ee=0;ee<i;ee++)u[a+ee]!==0&&(m[ne[u[a+ee]]++]=ee);if(q=s===0?(B=oe=m,19):s===1?(B=c,$-=257,oe=r,ie-=257,256):(B=t,oe=n,-1),K=A,D=h,P=ee=W=0,M=-1,R=(V=1<<(N=E))-1,s===1&&852<V||s===2&&592<V)return 1;for(;;){for(G=m[ee]<q?(j=0,m[ee]):m[ee]>q?(j=oe[ie+m[ee]],B[$+m[ee]]):(j=96,0),y=1<<(L=K-P),A=w=1<<N;l[D+(W>>P)+(w-=y)]=L<<24|j<<16|G|0,w!==0;);for(y=1<<K-1;W&y;)y>>=1;if(W=y!==0?(W&y-1)+y:0,ee++,--X[K]==0){if(K===v)break;K=u[a+m[ee]]}if(E<K&&(W&R)!==M){for(D+=A,H=1<<(N=K-(P=P===0?E:P));N+P<v&&!((H-=X[N+P])<=0);)N++,H<<=1;if(V+=1<<N,s===1&&852<V||s===2&&592<V)return 1;l[M=W&R]=E<<24|N<<16|D-h|0}}return W!==0&&(l[D+W]=K-P<<24|64<<16|0),g.bits=E,0}},{"../utils/common":41}],51:[function(S,f,d){f.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(S,f,d){var o=S("../utils/common");function c(B){for(var $=B.length;0<=--$;)B[$]=0}var r=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],t=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],s=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576),a=(c(u),new Array(60)),i=(c(a),new Array(512)),l=(c(i),new Array(256)),h=(c(l),new Array(29));c(h);var m,g,y,w=new Array(30);function M(B,$,X,ne,oe){this.static_tree=B,this.extra_bits=$,this.extra_base=X,this.elems=ne,this.max_length=oe,this.has_stree=B&&B.length}function R(B,$){this.dyn_tree=B,this.max_code=0,this.stat_desc=$}function D(B){return B<256?i[B]:i[256+(B>>>7)]}function q(B,$){B.pending_buf[B.pending++]=255&$,B.pending_buf[B.pending++]=$>>>8&255}function L(B,$,X){B.bi_valid>16-X?(B.bi_buf|=$<<B.bi_valid&65535,q(B,B.bi_buf),B.bi_buf=$>>16-B.bi_valid,B.bi_valid+=X-16):(B.bi_buf|=$<<B.bi_valid&65535,B.bi_valid+=X)}function j(B,$,X){L(B,X[2*$],X[2*$+1])}function G(B,$){for(var X=0;X|=1&B,B>>>=1,X<<=1,0<--$;);return X>>>1}function J(B,$,X){for(var ne,oe=new Array(16),ie=0,ue=1;ue<=15;ue++)oe[ue]=ie=ie+X[ue-1]<<1;for(ne=0;ne<=$;ne++){var pe=B[2*ne+1];pe!==0&&(B[2*ne]=G(oe[pe]++,pe))}}function K(B){for(var $=0;$<286;$++)B.dyn_ltree[2*$]=0;for($=0;$<30;$++)B.dyn_dtree[2*$]=0;for($=0;$<19;$++)B.bl_tree[2*$]=0;B.dyn_ltree[512]=1,B.opt_len=B.static_len=0,B.last_lit=B.matches=0}function ee(B){8<B.bi_valid?q(B,B.bi_buf):0<B.bi_valid&&(B.pending_buf[B.pending++]=B.bi_buf),B.bi_buf=0,B.bi_valid=0}function A(B,$,X,ne){var oe=2*$,ie=2*X;return B[oe]<B[ie]||B[oe]===B[ie]&&ne[$]<=ne[X]}function v(B,$,X){for(var ne=B.heap[X],oe=X<<1;oe<=B.heap_len&&(oe<B.heap_len&&A($,B.heap[oe+1],B.heap[oe],B.depth)&&oe++,!A($,ne,B.heap[oe],B.depth));)B.heap[X]=B.heap[oe],X=oe,oe<<=1;B.heap[X]=ne}function E(B,$,X){var ne,oe,ie,ue,pe=0;if(B.last_lit!==0)for(;ne=B.pending_buf[B.d_buf+2*pe]<<8|B.pending_buf[B.d_buf+2*pe+1],oe=B.pending_buf[B.l_buf+pe],pe++,ne==0?j(B,oe,$):(j(B,(ie=l[oe])+256+1,$),(ue=r[ie])!==0&&L(B,oe-=h[ie],ue),j(B,ie=D(--ne),X),(ue=t[ie])!==0&&L(B,ne-=w[ie],ue)),pe<B.last_lit;);j(B,256,$)}function N(B,$){var X,ne,oe,ie=$.dyn_tree,ue=$.stat_desc.static_tree,pe=$.stat_desc.has_stree,de=$.stat_desc.elems,_e=-1;for(B.heap_len=0,B.heap_max=573,X=0;X<de;X++)ie[2*X]!==0?(B.heap[++B.heap_len]=_e=X,B.depth[X]=0):ie[2*X+1]=0;for(;B.heap_len<2;)ie[2*(oe=B.heap[++B.heap_len]=_e<2?++_e:0)]=1,B.depth[oe]=0,B.opt_len--,pe&&(B.static_len-=ue[2*oe+1]);for($.max_code=_e,X=B.heap_len>>1;1<=X;X--)v(B,ie,X);for(oe=de;X=B.heap[1],B.heap[1]=B.heap[B.heap_len--],v(B,ie,1),ne=B.heap[1],B.heap[--B.heap_max]=X,B.heap[--B.heap_max]=ne,ie[2*oe]=ie[2*X]+ie[2*ne],B.depth[oe]=(B.depth[X]>=B.depth[ne]?B.depth[X]:B.depth[ne])+1,ie[2*X+1]=ie[2*ne+1]=oe,B.heap[1]=oe++,v(B,ie,1),2<=B.heap_len;);B.heap[--B.heap_max]=B.heap[1];for(var le,be,ge,ve,Ge,we=B,qe=$.dyn_tree,Ue=$.max_code,rt=$.stat_desc.static_tree,nt=$.stat_desc.has_stree,ut=$.stat_desc.extra_bits,Ye=$.stat_desc.extra_base,xe=$.stat_desc.max_length,Re=0,ye=0;ye<=15;ye++)we.bl_count[ye]=0;for(qe[2*we.heap[we.heap_max]+1]=0,le=we.heap_max+1;le<573;le++)xe<(ye=qe[2*qe[2*(be=we.heap[le])+1]+1]+1)&&(ye=xe,Re++),qe[2*be+1]=ye,Ue<be||(we.bl_count[ye]++,ve=0,Ye<=be&&(ve=ut[be-Ye]),Ge=qe[2*be],we.opt_len+=Ge*(ye+ve),nt&&(we.static_len+=Ge*(rt[2*be+1]+ve)));if(Re!==0){do for(ye=xe-1;we.bl_count[ye]===0;)ye--;while(we.bl_count[ye]--,we.bl_count[ye+1]+=2,we.bl_count[xe]--,0<(Re-=2));for(ye=xe;ye!==0;ye--)for(be=we.bl_count[ye];be!==0;)Ue<(ge=we.heap[--le])||(qe[2*ge+1]!==ye&&(we.opt_len+=(ye-qe[2*ge+1])*qe[2*ge],qe[2*ge+1]=ye),be--)}J(ie,_e,B.bl_count)}function P(B,$,X){var ne,oe,ie=-1,ue=$[1],pe=0,de=7,_e=4;for(ue===0&&(de=138,_e=3),$[2*(X+1)+1]=65535,ne=0;ne<=X;ne++)oe=ue,ue=$[2*(ne+1)+1],++pe<de&&oe===ue||(pe<_e?B.bl_tree[2*oe]+=pe:oe!==0?(oe!==ie&&B.bl_tree[2*oe]++,B.bl_tree[32]++):pe<=10?B.bl_tree[34]++:B.bl_tree[36]++,ie=oe,_e=(pe=0)===ue?(de=138,3):oe===ue?(de=6,3):(de=7,4))}function H(B,$,X){var ne,oe,ie=-1,ue=$[1],pe=0,de=7,_e=4;for(ue===0&&(de=138,_e=3),ne=0;ne<=X;ne++)if(oe=ue,ue=$[2*(ne+1)+1],!(++pe<de&&oe===ue)){if(pe<_e)for(;j(B,oe,B.bl_tree),--pe!=0;);else oe!==0?(oe!==ie&&(j(B,oe,B.bl_tree),pe--),j(B,16,B.bl_tree),L(B,pe-3,2)):pe<=10?(j(B,17,B.bl_tree),L(B,pe-3,3)):(j(B,18,B.bl_tree),L(B,pe-11,7));ie=oe,_e=(pe=0)===ue?(de=138,3):oe===ue?(de=6,3):(de=7,4)}}c(w);var V=!1;function W(B,$,X,ne){L(B,0+(ne?1:0),3),ne=$,$=X,ee(X=B),q(X,$),q(X,~$),o.arraySet(X.pending_buf,X.window,ne,$,X.pending),X.pending+=$}d._tr_init=function(B){if(!V){for(var $,X,ne,oe,ie=new Array(16),ue=ne=0;ue<28;ue++)for(h[ue]=ne,$=0;$<1<<r[ue];$++)l[ne++]=ue;for(l[ne-1]=ue,ue=oe=0;ue<16;ue++)for(w[ue]=oe,$=0;$<1<<t[ue];$++)i[oe++]=ue;for(oe>>=7;ue<30;ue++)for(w[ue]=oe<<7,$=0;$<1<<t[ue]-7;$++)i[256+oe++]=ue;for(X=0;X<=15;X++)ie[X]=0;for($=0;$<=143;)u[2*$+1]=8,$++,ie[8]++;for(;$<=255;)u[2*$+1]=9,$++,ie[9]++;for(;$<=279;)u[2*$+1]=7,$++,ie[7]++;for(;$<=287;)u[2*$+1]=8,$++,ie[8]++;for(J(u,287,ie),$=0;$<30;$++)a[2*$+1]=5,a[2*$]=G($,5);m=new M(u,r,257,286,15),g=new M(a,t,0,30,15),y=new M(new Array(0),n,0,19,7),V=!0}B.l_desc=new R(B.dyn_ltree,m),B.d_desc=new R(B.dyn_dtree,g),B.bl_desc=new R(B.bl_tree,y),B.bi_buf=0,B.bi_valid=0,K(B)},d._tr_stored_block=W,d._tr_flush_block=function(B,$,X,ne){var oe,ie,ue,pe=0;if(0<B.level?(B.strm.data_type===2&&(B.strm.data_type=function(le){for(var be=4093624447,ge=0;ge<=31;ge++,be>>>=1)if(1&be&&le.dyn_ltree[2*ge]!==0)return 0;if(le.dyn_ltree[18]!==0||le.dyn_ltree[20]!==0||le.dyn_ltree[26]!==0)return 1;for(ge=32;ge<256;ge++)if(le.dyn_ltree[2*ge]!==0)return 1;return 0}(B)),N(B,B.l_desc),N(B,B.d_desc),pe=function(le){var be;for(P(le,le.dyn_ltree,le.l_desc.max_code),P(le,le.dyn_dtree,le.d_desc.max_code),N(le,le.bl_desc),be=18;3<=be&&le.bl_tree[2*s[be]+1]===0;be--);return le.opt_len+=3*(be+1)+5+5+4,be}(B),oe=B.opt_len+3+7>>>3,(ie=B.static_len+3+7>>>3)<=oe&&(oe=ie)):oe=ie=X+5,X+4<=oe&&$!==-1)W(B,$,X,ne);else if(B.strategy===4||ie===oe)L(B,2+(ne?1:0),3),E(B,u,a);else{L(B,4+(ne?1:0),3);var de=B,_e=($=B.l_desc.max_code+1,X=B.d_desc.max_code+1,pe+1);for(L(de,$-257,5),L(de,X-1,5),L(de,_e-4,4),ue=0;ue<_e;ue++)L(de,de.bl_tree[2*s[ue]+1],3);H(de,de.dyn_ltree,$-1),H(de,de.dyn_dtree,X-1),E(B,B.dyn_ltree,B.dyn_dtree)}K(B),ne&&ee(B)},d._tr_tally=function(B,$,X){return B.pending_buf[B.d_buf+2*B.last_lit]=$>>>8&255,B.pending_buf[B.d_buf+2*B.last_lit+1]=255&$,B.pending_buf[B.l_buf+B.last_lit]=255&X,B.last_lit++,$===0?B.dyn_ltree[2*X]++:(B.matches++,$--,B.dyn_ltree[2*(l[X]+256+1)]++,B.dyn_dtree[2*D($)]++),B.last_lit===B.lit_bufsize-1},d._tr_align=function(B){L(B,2,3),j(B,256,u),(B=B).bi_valid===16?(q(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):8<=B.bi_valid&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)}},{"../utils/common":41}],53:[function(S,f,d){f.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(S,f,d){(function(o){(function(c,r){var t,n,s,u,a,i,l,h,m;function g(M){delete a[M]}function y(M){if(i)setTimeout(y,0,M);else{var R=a[M];if(R){i=!0;try{var D=R.callback,q=R.args;switch(q.length){case 0:D();break;case 1:D(q[0]);break;case 2:D(q[0],q[1]);break;case 3:D(q[0],q[1],q[2]);break;default:D.apply(void 0,q)}}finally{g(M),i=!1}}}}function w(M){M.source===c&&typeof M.data=="string"&&M.data.indexOf(s)===0&&y(+M.data.slice(s.length))}c.setImmediate||(u=1,i=!(a={}),l=c.document,h=(h=Object.getPrototypeOf&&Object.getPrototypeOf(c))&&h.setTimeout?h:c,m={}.toString.call(c.process)==="[object process]"?function(M){k.nextTick(function(){y(M)})}:function(){var M,R;if(c.postMessage&&!c.importScripts)return M=!0,R=c.onmessage,c.onmessage=function(){M=!1},c.postMessage("","*"),c.onmessage=R,M}()?(s="setImmediate$"+Math.random()+"$",c.addEventListener?c.addEventListener("message",w,!1):c.attachEvent("onmessage",w),function(M){c.postMessage(s+M,"*")}):c.MessageChannel?((n=new MessageChannel).port1.onmessage=function(M){y(M.data)},function(M){n.port2.postMessage(M)}):l&&"onreadystatechange"in l.createElement("script")?(t=l.documentElement,function(M){var R=l.createElement("script");R.onreadystatechange=function(){y(M),R.onreadystatechange=null,t.removeChild(R),R=null},t.appendChild(R)}):function(M){setTimeout(y,0,M)},h.setImmediate=function(M){typeof M!="function"&&(M=new Function(""+M));for(var R=new Array(arguments.length-1),D=0;D<R.length;D++)R[D]=arguments[D+1];return a[u]={callback:M,args:R},m(u),u++},h.clearImmediate=g)})(typeof self>"u"?o===void 0?this:o:self)}).call(this,p!==void 0?p:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)}).call(this,b(113).Buffer,b(117).setImmediate,b(12),b(47))},function(Q,O,b){b.d(O,"a",function(){return S}),O=b(3);var T=b.n(O),I=b(1),p=b(0),k=function(d,o){var c=typeof Symbol=="function"&&d[Symbol.iterator];if(!c)return d;var r,t,n=c.call(d),s=[];try{for(;(o===void 0||0<o--)&&!(r=n.next()).done;)s.push(r.value)}catch(u){t={error:u}}finally{try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(t)throw t.error}}return s},S=(f.prototype.initEngine=function(d,o,c){return this.eventBusMap.set(d,c),c={handle:d,appID:o,token:"",tokenExpireTime:0,user:{},cloudSetting:{app_config:{main_domain_url:"zego.im",data_reporter_url:"webzim-report.zego.im",log_uploader_url:"webzim-detaillog.zego.im"},qps:{get_room_user_attrs:"5/30",send_msg:100,send_barrage_msg:100,default_token:30,max_token:100,interval_add_token:5,max_handle_req:10},req_to:{def:3e3,send_msg:1e4},retry:{login_max_itvl:300}},cryptoConfig:{},mailHBConfig:{conv_list_seq:T.a.fromString("0"),group_list_seq:T.a.fromString("0"),call_list_seq:T.a.fromString("0"),conv_pinned_list_seq:0,c2c_statemsg_seq:T.a.fromString("0"),extra_msg_list_seq:T.a.fromString("0"),fetch_c2c_msg_count:0,fetch_group_msg_count:0,fetch_room_msg_count:0,fetch_conv_list:0,fetch_group_list:0,usermail_hb_interval:1e4,msg_to:1e4,msg_itvl:3e4,list_to:1e4,list_itvl:3e4,reaction_brief_len:5,state_seq_reduce_num:-1}},this.engineConfigMap.set(d,c),c},f.prototype.unInitEngine=function(d,o){var c=this.engineConfigMap.get(d);c&&(c.cloudTimer&&clearInterval(c.cloudTimer),c.cloudTimer=0,c.user={},c.sessionID=void 0,c.serverUserID=void 0,c.controls=void 0,o&&(this.engineConfigMap.delete(d),this.eventBusMap.delete(d)))},f.prototype.fetchZGLogConfig=function(d){var o=this.advancedConfig.geoFence.host.detaillog,c=this.advancedConfig.geoFence.host.logreport;return o&&c?[o+"/zglog/zip",c]:(c=(o=this.engineConfigMap.get(d).cloudSetting.app_config).main_domain_url,d=o.data_reporter_url,o=o.log_uploader_url,["https://"+this.appendBackupDomain(o,c)+"/zglog/zip","wss://"+this.appendBackupDomain(d,c)+"/zglog/web"])},f.prototype.fetchZGLogWhitelistUrl=function(d){var o=this.advancedConfig.geoFence.host.detaillog;return o?o+"/zglog/whitelist":(d=(o=this.engineConfigMap.get(d).cloudSetting.app_config).main_domain_url,o=o.log_uploader_url,"https://"+this.appendBackupDomain(o,d)+"/zglog/whitelist")},f.prototype.startSyncRemoteConfig=function(d,o,c){var r=this,t=this.engineConfigMap.get(o);return t.cloudTimer||(t.cloudTimer=setInterval(function(){t.token&&r.syncRemoteConfig(d,t)},36e5)),this.syncRemoteConfig(d,t,c)},f.prototype.syncRemoteConfig=function(d,o,c){return c={appid:o.appID,id_name:o.user.userID,product:"ZIM",files:["config","biz_conf"],param:{platform:"1",sdk_version:""+this.deviceInfo.sdk_ver},timestamp:Date.now(),biztype:0,deviceid:I.g,compress:!1,mode:"online",token:c||o.token},d.sendHttpRequest({url:"/cloud-setting/get",method:"POST"},c,10).then(function(r){if(!(r&&r.data&&r.data.biz_conf&&r.data.biz_conf.data))return!1;var t=(t=(t=(t=r.data.config)==null?void 0:t.data)==null?void 0:t.app_config)?{main_domain_url:t.main_domain_url,data_reporter_url:t.data_reporter_url,log_uploader_url:t.log_uploader_url}:o.cloudSetting.app_config,n=(t=(r.data.biz_conf.data.app_config=t,r.data.biz_conf.data)).qps,s=(t=t.req_to,(u=k(String(n.send_msg).split("~"),2))[0]),u=u[1];return s=(u=(n.send_msg=1e3*Number(u)/Number(s),k(String(n.send_barrage_msg).split("~"),2)))[0],u=u[1],s=(u=(n.send_barrage_msg=1e3*Number(u)/Number(s),k(n.get_room_user_attrs.split("/"),2)))[0],n=u[1],p.l.get_user_attribute_qps=+s,p.l.get_user_attribute_interval=1e3*+n,t.def=1e3*t.def,t.send_msg=1e3*t.send_msg,Object.assign(o.cloudSetting,r.data.biz_conf.data),!0})},f.prototype.appendBackupDomain=function(d,o){return d.indexOf(".")==-1?d+"."+o:d},f.prototype.onNetworkStatusChange=function(){var d,o,c=this,r={wifi:2,"2g":3,"3g":4,"4g":5,unknown:32};function t(n){return n.toLowerCase().replace("-","")}I.n?(I.n.getNetworkType({success:function(n){c.netType=t(n.networkType||"unknown"),c.deviceInfo.net_type=r[c.netType]||r.unknown}}),I.n.onNetworkStatusChange(function(n){c.netType=t(n.networkType||"unknown"),c.deviceInfo.net_type=r[c.netType]||r.unknown,c.emitNetworkChange(n.isConnected)})):((d=navigator.connection||navigator.mozConnection||navigator.webkitConnection)&&(this.netType=t(d.type||d.effectiveType||"unknown"),this.deviceInfo.net_type=r[this.netType]||r.unknown,d.addEventListener("change",function(){c.netType=t(d.type||d.effectiveType||"unknown"),c.deviceInfo.net_type=r[c.netType]||r.unknown})),o=function(){return c.emitNetworkChange(navigator.onLine)},window.addEventListener("online",o),window.addEventListener("offline",o))},f.prototype.emitNetworkChange=function(d){var o=this;this.eventBusMap.forEach(function(c){return c.exec(p.t.INetworkChange,d,o.netType)})},f);function f(d){this.engineConfigMap=new Map,this.eventBusMap=new Map,this.advancedConfig={zim_cross_platform:"",zim_product_source:"",geoFence:{reg:/(https?:\/\/)?([a-z0-9.-]+)\.([a-z]{2,})((\/[a-zA-Z0-9#]+\/?)*)/,type:p.w.None,areas:[],id:0,host:{accesshub:"",logreport:"",detaillog:"",fileproxy:""}}},this.serverOffsetTime=0,this.netType="",this.deviceInfo={sdk_ver:d.split(".").reverse().reduce(function(o,c,r){return o+ +c*Math.pow(100,r)},0),term_type:I.n?7:6,device_id:I.g,net_type:32},this.onNetworkStatusChange()}},function(Q,O,b){b.d(O,"a",function(){return f}),O=b(3);var T=b.n(O),I=b(85),p=b(1),k=b(0),S=function(){return(S=Object.assign||function(o){for(var c,r=1,t=arguments.length;r<t;r++)for(var n in c=arguments[r])Object.prototype.hasOwnProperty.call(c,n)&&(o[n]=c[n]);return o}).apply(this,arguments)},f=(d.prototype.setDB=function(o){this.dataReport.setDB(o)},d.prototype.clearDB=function(){this.dataReport.clearDB()},d.prototype.init=function(o,c){this.isInited||(this.isInited=!0,this.dataReport.init({isProd:this.isProd,appID:o,deviceID:this.settings.deviceInfo.device_id,serverUrl:c,importantLevel:0,levels:[0,10]}))},d.prototype.start=function(o,c,r){var t;c?((t=new Map).set("userID",o),t.set("token",c),r&&t.set("serverUrl",r),this.dataReport.startReport(t),this.dataReport.resume()):this.dataReport.pause()},d.prototype.beginNetworkRequest=function(o,c,r,t){var n=this.createDateEvent(o);n.caller_type=r,n._req_=t,this.evenDatatMap.set(o+c,n)},d.prototype.endNetworkRequest=function(o,c,r,t){var n=this.evenDatatMap.get(o+c);if(n&&(!r||r.code!=k.W))return r&&r.code?(n.error=r.code,n.error_message=(r.message||"")+(t||"")):(n.error_message=t||"",n._rsp_=r),n.time_consumed=Date.now()-n.event_time,this.upload(n,!0),this.evenDatatMap.delete(o+c),delete n.error,delete n.error_message,delete n.sdk_version,delete n.term_type,delete n.net_type,delete n.event,delete n.event_time,delete n.time_consumed,delete n.time_offset,n},d.prototype.reportNetworkRequest=function(o,c){(o=this.createDateEvent(o))._rsp_=c,this.upload(o,!0)},d.prototype.reportSDKEvent=function(o,c){o=this.createDateEvent(o,c),this.upload(o,!1)},d.prototype.reportPushEvent=function(o,c,r,t){var n=this.createDateEvent("/sdk/push");n.push_cmd=o,n.push_id=r,n.push_type=this.stringify(t),n.time_consumed=c,this.upload(n,!1),this.isProd},d.prototype.stringify=function(o){return JSON.stringify(o,function(c,r){return r instanceof Uint8Array?"b="+r.length:r instanceof Array&&2<r.length?[t=r.length,r[0],r[t-1]]:typeof r=="string"&&32<r.length?"s="+r.length:r instanceof T.a?r.toString():r;var t}).replace(/\"(\w+)\":/g,"$1:")},d.prototype.createDateEvent=function(o,c){return S(S({event:o,event_time:Date.now(),time_consumed:0,time_offset:this.settings.serverOffsetTime},this.commonFields),c)},d.prototype.upload=function(o,c){if(c)try{this.hookCMDEvent(o)}catch{}o.net_type=this.settings.netType,c=JSON.stringify(o,function(r,t){return t instanceof T.a?+t.toString():t}),this.dataReport.report(c,this.unSaveEvents.indexOf(o.event)!=-1)},d.prototype.set_offline_push=function(o,c){o.offline_push_w=c?c.pushStrategyId||"1":"0",c&&c.custom_map&&(o.offline_push_map=JSON.stringify(c.custom_map))},d.prototype.hookCMDEvent=function(o){var c,r,t,n=o._req_,s=o._rsp_;switch(delete o._req_,delete o._rsp_,o.event){case k.c.sw_login.cmd:o.os_type=p.h,this.settings.advancedConfig.zim_cross_platform&&(o.cross_platform=this.settings.advancedConfig.zim_cross_platform),this.settings.advancedConfig.zim_product_source&&(o.product_source=this.settings.advancedConfig.zim_product_source),this.settings.advancedConfig.geoFence.id&&(t=(r=this.settings.advancedConfig.geoFence).id,c=r.type,r=r.areas,o.geo_fence=JSON.stringify({id:t,type:c,areas:r})),o.zpns_push_id=n.zpns_push_id,o.sdk_action=n.sdk_action,o.sdk_duration=n.sdk_duration,o.server_ip=n.sdk_server_ip,s&&(o.usernid=s.rspHeader.user_nid.toString(),o.hb_interval=s.hb_interval,o.hb_timeout=s.hb_timeout,o.server_timestamp=s.server_timestamp,o.im_conf_json=s.im_conf_json);break;case k.c.sw_logout.cmd:o.logout_reason=n.logout_reason;break;case k.c.sw_renew_token.cmd:o.sdk_duration=n.sdk_duration;break;case k.c.sw_hb.cmd:s&&(o.heartbeat_interval=s.heartbeat_interval,o.hb_timeout=s.hb_timeout,o.server_timestamp=s.server_timestamp);break;case k.c.sw_push_kickout.cmd:o.error=s.code,o.error_message=s.key,o.need_relogin=s.seq;break;case k.c.sw_push_redirect.cmd:o.error_message=s.quey_user_id.join();break;case k.c.modify_user_info.cmd:o.set_flag=n.set_flag;break;case k.c.fetch_user_info.cmd:s&&(o.result_len=s.result.length,o.err_list_len=s.err_list.length,0<o.err_list_len&&o.err_list_len<6&&(o.err_list=JSON.stringify(s.err_list)));break;case k.c.userstate_zpns_report.cmd:o.zpns_push_id=n.key;break;case k.c.usermail_hb.cmd:s&&(o.conv_list_seq=s.conv_list_seq,o.group_list_seq=s.group_list_seq,o.c2c_msg_seq=s.c2c_msg_seq,o.c2c_statemsg_seq=s.c2c_statemsg_seq,o.extra_msg_list_seq=s.extra_msg_list_seq,o.conv_pinned_list_seq=s.conv_pinned_list_seq,o.call_list_seq=s.call_list_seq,o.db_seq_json=JSON.stringify(n.db_seq_json),o.im_conf_json=JSON.stringify(Object(p.q)(this.pickCmds.usermail_hb,s)));break;case k.c.usermail_convlist.cmd:o.how=n.how,o.count=n.count,o.full_pull=n.full_pull,o.conv_list_seq=n.conv_list_seq,s&&(o.rsp_conv_list_seq=s.cur,o.max_list_seq=s.max,o.full_list=s.full_list,o.fetch_end=s.fetch_end,o.conv_list_len=s.svrCount,o.degree=s.degree);break;case k.c.usermail_convpinnedlist.cmd:o.how=n.how,o.count=n.count,o.full_pull=n.full_pull,o.conv_pinned_list_seq=n.conv_list_seq,s&&(o.rsp_conv_pinned_list_seq=s.cur,o.max_pinned_list_seq=s.max,o.full_list=s.full_list,o.fetch_end=s.fetch_end,o.conv_list_len=s.svrCount,o.degree=s.degree);break;case k.c.usermail_del_conv.cmd:o.conv_id=n.conv_id,o.conv_type=n.conv_type,s&&(o.conv_list_seq=s.conv_list_seq,o.conv_msg_seq=s.conv_msg_seq);break;case k.c.usermail_modify_conv_pinned_lv.cmd:o.conv_id=n.conv_id,o.conv_type=n.conv_type,o.pinned_type=n.pinned_type;break;case k.c.usermail_update_read_seq.cmd:o.conv_id=n.conv_id,o.conv_type=n.conv_type,o.read_seq=n.read_seq;break;case k.c.c2c_msglist.cmd:o.conv_id=n.conv_id,o.conv_type=n.conv_type,o.how=n.how,o.count=n.count,o.mode=n.mode,o.login_fetch=n.login_fetch,o.conv_msg_seq=n.conv_msg_seq,s&&(o.degree=s.degree,o.fetch_end=s.fetch_end,o.msgs_len=s.svrCount,o.dbSeq=s.dbSeq,o.next_conv_msg_seq=s.next_seq,o.max_conv_msg_seq=s.maxSeq);break;case k.c.group_msglist.cmd:o.group_id=n.group_id,o.how=n.how,o.count=n.count,o.sort_type=n.sort_type,o.conv_msg_seq=n.conv_msg_seq,s&&(o.degree=s.degree,o.fetch_end=s.fetch_end,o.msgs_len=s.svrCount,o.dbSeq=s.dbSeq,o.next_conv_msg_seq=s.next_seq,o.max_conv_msg_seq=s.maxSeq);break;case k.c.room_msglist.cmd:o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.room_user_session_id=n.room_user_session_id.toString(),o.how=n.how,o.count=n.count,o.sort_type=n.sort_type,o.conv_msg_seq=n.conv_msg_seq,s&&(o.degree=s.degree,o.fetch_end=s.fetch_end,o.msgs_len=s.svrCount,o.dbSeq=s.dbSeq,o.next_conv_msg_seq=s.next_seq,o.max_conv_msg_seq=s.maxSeq);break;case k.c.c2c_msg.cmd:o.peer_user_id=n.conv_id,o.fetch_peer_user_info=n.fetch_peer_user_info,o.msg_type=n.msg_info.msg_type,o.msg_len=n.msg_info.msg.length,o.priority=n.msg_info.priority_type,this.set_offline_push(o,n.msg_info.offline_push),s&&(o.conv_disable=s.conv_disable,o.send_count_after_read=s.send_count_after_read,o.msg_id=s.msg_svr_info.msg_id,o.conv_msg_seq=s.msg_svr_info.conv_msg_seq,o.c2c_msg_seq=s.msg_svr_info.c2c_msg_seq,o.has_content=s.msg_svr_info.has_content,o.msg_version=s.msg_svr_info.version);break;case k.c.c2c_command.cmd:o.peer_user_id=n.conv_id,o.msg_type=n.command_msg_info.msg_type,o.msg_len=n.command_msg_info.msg.length,o.priority=n.command_msg_info.priority_type,s&&(o.msg_id=s.command_svr_info.msg_id.toString(),o.msg_time=s.command_svr_info.conv_msg_seq);break;case k.c.c2c_del_msg.cmd:o.conv_id=n.conv_id,o.conv_type=n.conv_type,o.msg_ids_len=n.msg_ids.length,0<o.msg_ids_len&&o.msg_ids_len<6&&(o.msg_ids=n.msg_ids.join());break;case k.c.c2c_del_all_msg.cmd:o.conv_id=n.conv_id,o.conv_type=n.conv_type;break;case k.c.group_msg.cmd:o.group_id=n.conv_id,o.msg_type=n.msg_info.msg_type,o.msg_len=n.msg_info.msg.length,o.priority=n.msg_info.priority_type,this.set_offline_push(o,n.msg_info.offline_push),s&&(o.send_count_after_read=s.send_count_after_read,o.msg_id=s.msg_svr_info.msg_id,o.conv_msg_seq=s.msg_svr_info.conv_msg_seq,o.has_content=s.msg_svr_info.has_content,o.msg_version=s.msg_svr_info.version);break;case k.c.group_command.cmd:o.group_id=n.conv_id,o.msg_type=n.command_msg_info.msg_type,o.msg_len=n.command_msg_info.msg.length,o.priority=n.command_msg_info.priority_type,s&&(o.msg_id=s.command_svr_info.msg_id.toString(),o.msg_time=s.command_svr_info.conv_msg_seq);break;case k.c.group_del_msg.cmd:o.group_id=n.conv_id,o.conv_msg_seq_len=n.conv_msg_seq.length,0<o.conv_msg_seq_len&&o.conv_msg_seq_len<6&&(o.conv_msg_seqs=n.conv_msg_seq.join());break;case k.c.group_del_all_msg.cmd:o.group_id=n.conv_id;break;case k.c.room_msg.cmd:o.room_id=n.conv_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.room_user_session_id=n.room_user_session_id.toString(),o.msg_type=n.msg_info.msg_type,o.msg_len=n.msg_info.msg.length,o.priority=n.msg_info.priority_type,s&&(o.msg_id=s.msg_svr_info.msg_id.toString(),o.conv_msg_seq=s.msg_svr_info.conv_msg_seq,o.has_content=s.msg_svr_info.has_content,o.msg_version=s.msg_svr_info.version);break;case k.c.room_command.cmd:o.room_id=n.conv_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.room_user_session_id=n.room_user_session_id.toString(),o.msg_type=n.command_msg_info.msg_type,o.msg_len=n.command_msg_info.msg.length,o.priority=n.command_msg_info.priority_type,s&&(o.msg_id=s.msg_id.toString());break;case k.c.file_upload.cmd:o.md5=n.md5,o.file_type=n.file_type,o.name=n.name,o.size=n.size,o.duration=n.duration,s&&(o.state=s.state,o.upload_url=s.upload_req.url,o.upload_url.indexOf("?")&&(o.upload_url=o.upload_url.substring(0,o.upload_url.indexOf("?"))));break;case k.c.file_process.cmd:o.md5=n.md5,o.file_type=n.file_type,s&&(o.state=s.state,o.download_url=s.download_url,o.download_url.indexOf("?")&&(o.download_url=o.download_url.substring(0,o.download_url.indexOf("?"))));break;case k.c.c2c_conv_read_receipt.cmd:o.conv_id=n.group_id,o.conv_msg_seq=n.conv_msg_seq,s&&(o.receipt_seq=s.conv_list_seq);break;case k.c.c2c_msg_read_receipt.cmd:o.conv_id=n.conv_id,o.conv_msg_seq_len=n.conv_msg_seq.length,s&&(o.receipt_seqs=JSON.stringify(s.conv_msg_seq2_receipt_seq));break;case k.c.group_msg_read_receipt.cmd:o.group_id=n.conv_id,o.conv_msg_seq_len=n.conv_msg_seq.length,s&&(o.receipt_seqs=JSON.stringify(s.conv_msg_seq2_receipt_seq));break;case k.c.msg_read_receipt_detail.cmd:o.group_id=n.group_id,o.conv_msg_seq=n.conv_msg_seq,o.count=n.count,s&&(o.list_seq=s.list_seq,o.fetch_end=s.fetch_end,o.next_list_seq=s.next_list_seq,o.read_count=s.read_count,o.unread_count=s.unread_count,o.read_members_len=s.read_members_len,o.unread_members_len=s.unread_members_len,o.degree=s.degree);break;case k.c.c2c_msg_revoke.cmd:case k.c.group_msg_revoke.cmd:n.conv_id&&(o.conv_id=n.conv_id),o.conv_msg_seq=n.conv_msg_seq,o.extended_data_len=((t=n.payload)==null?void 0:t.length)||0,this.set_offline_push(o,n.offline_push),s&&(o.statemsg_seq=s.statemsg_seq);break;case k.c.c2c_add_reaction.cmd:case k.c.c2c_del_reaction.cmd:case k.c.group_add_reaction.cmd:case k.c.group_del_reaction.cmd:o.conv_id=n.conv_id,o.conv_msg_seq=n.conv_msg_seq,o.reaction_key=Array.isArray(n.reaction_key)?n.reaction_key[0]:n.reaction_key,s&&(o.succ_list_len=s.succ_list.length,o.error_list_len=s.error_list.length);break;case k.c.c2c_get_reaction.cmd:case k.c.group_get_reaction.cmd:o.conv_id=n.conv_id,o.conv_msg_seq=n.conv_msg_seq,o.reaction_key=n.reaction_key,o.max_reaction_seq=n.max_reaction_seq,o.is_detail=n.is_detail,s&&(o.rsp_max_reaction_seq=s.max_reaction_seq,o.total_user_count=s.total_user_count,o.user_reaction_len=s.user_reaction.length,o.include_self=s.include_self);break;case k.c.c2c_reaction_list.cmd:case k.c.group_reaction_list.cmd:o.conv_id=n.conv_id,o.conv_msg_seq=n.conv_msg_seq,o.start_reaction_seq=n.start_reaction_seq,s&&(o.fetch_end=s.fetch_end,o.msg_next_reaction_seq=s.msg_next_reaction_seq,o.msg_max_reaction_seq=s.msg_max_reaction_seq,o.reaction_list_len=s.svrCount,o.degree=s.degree);break;case k.c.extra_msglist.cmd:o.how=n.how,o.count=n.count,o.list_seq=n.list_seq,s&&(o.fetch_end=s.fetch_end,o.next_list_seq=s.next_list_seq,o.list_len=s.svrCount,o.degree=s.degree);break;case k.c.c2c_msg_state_list.cmd:case k.c.group_msg_state_list.cmd:o.conv_id=n.conv_id,o.min_msg_seq=n.min_msg_seq,o.max_msg_seq=n.max_msg_seq,o.how=n.how,o.statemsg_seq=n.statemsg_seq,o.count=n.count,s&&(o.fetch_end=s.fetch_end,o.next_statemsg_seq=s.next_statemsg_seq,o.statemsg_list_len=s.svrCount,o.degree=s.degree);break;case k.c.c2c_query_msg.cmd:case k.c.group_query_msg.cmd:case k.c.room_query_msg.cmd:o.event==k.c.c2c_query_msg.cmd?o.conv_id=n.room_id:o.event==k.c.group_query_msg.cmd?o.group_id=n.room_id:(o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.room_user_session_id=n.room_user_session_id.toString()),o.client_infos_len=n.client_infos.length,s&&(o.msgs_len=s.msgs.length,o.fail_list_len=s.fail_list.length);break;case k.c.room_create.cmd:o.room_id=n.room_id,s&&(o.sub_room_id=s.sub_room_id,o.room_session_id=s.room_session_id.toString(),o.room_user_session_id=s.room_user_session_id.toString(),o.destroy_delay=n.destroy_delay||s.destroy_delay,o.room_info_interval=s.room_info_interval,o.userlist_enable=s.userlist_enable,o.userlist_merge_timeout=s.userlist_merge_timeout,o.userlist_interval=s.userlist_interval,s.attributes&&(o.attribute_seq=s.attributes.attribute_seq,o.attributes_len=s.attributes.attributes.length),o.attributes_pull_interval=s.attributes_pull_interval,o.attributes_merge_timeout=s.attributes_merge_timeout,o.msg_merge_timeout=s.msg_merge_timeout,o.msg_pull_interval=s.msg_pull_interval,o.enabled_offline_msg=s.enabled_offline_msg,o.conv_msg_seq=s.conv_msg_seq);break;case k.c.room_enter.cmd:o.room_id=n.room_id,o.create_if_not_exist=n.create_if_not_exist,s&&(o.sub_room_id=s.sub_room_id,o.room_session_id=s.room_session_id.toString(),o.room_user_session_id=s.room_user_session_id.toString(),o.destroy_delay=n.destroy_delay||s.destroy_delay,o.userlist_seq=s.userlist_seq,o.user_count=s.user_count,o.room_info_interval=s.room_info_interval,o.userlist_enable=s.userlist_enable,o.userlist_merge_timeout=s.userlist_merge_timeout,o.userlist_interval=s.userlist_interval,s.attributes&&(o.attribute_seq=s.attributes.attribute_seq,o.attributes_len=s.attributes.attributes.length),o.attributes_pull_interval=s.attributes_pull_interval,o.attributes_merge_timeout=s.attributes_merge_timeout,o.msg_merge_timeout=s.msg_merge_timeout,o.msg_pull_interval=s.msg_pull_interval,o.attribute_seq=s.attribute_seq,o.enabled_offline_msg=s.enabled_offline_msg,o.conv_msg_seq=s.conv_msg_seq);break;case k.c.room_quit.cmd:o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.room_user_session_id=n.room_user_session_id.toString();break;case k.c.room_info.cmd:o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),s&&(o.userlist_seq=s.userlist_seq,o.user_count=s.user_count,o.room_info_interval=s.room_info_interval,o.ulist_to=s.ulist_to,o.ulist_itvl=s.ulist_itvl,o.attribute_seq=s.attribute_seq,o.max_conv_msg_seq=s.max_conv_msg_seq);break;case k.c.room_userlist.cmd:o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.count=n.count,o.mode=n.mode,o.expect_seq=n.expect_seq,o.pos_flag=n.pos_flag,s&&(o.rsp_pos_flag=s.pos_flag,o.userlist_seq=s.userlist_seq,o.user_count=s.user_count,o.users_len=s.svrCount,o.degree=s.degree);break;case k.c.room_userinfos.cmd:o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.room_user_session_id=n.room_user_session_id.toString(),o.user_ids_len=n.user_ids.length,s&&(o.user_infos_len=s.result.length,o.errlist_len=s.err_list.length,0<o.errlist_len&&o.errlist_len<6&&(o.errlist=JSON.stringify(s.err_list)));break;case k.c.room_attributes.cmd:o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.attribute_seq=n.attributes.attribute_seq,s&&s.attributes&&(o.rsp_attribute_seq=s.attributes.attribute_seq,o.attributes_len=s.attributes.attributes.length);break;case k.c.room_attributes_modify.cmd:o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.force_modify=n.force_modify,o.set_member=n.set_member,o.op_fail_fast=n.op_fail_fast,o.attribute_seq=n.attribute_seq,o.attribute_action=(c=n.attributes[0])==null?void 0:c.action,o.attributes_len=n.attributes.length,s&&(s.attributes&&(o.rsp_attribute_seq=s.attributes.attribute_seq,o.rsp_attributes_len=s.attributes.attributes.length),o.err_list_len=s.err_list.length,0<o.err_list_len&&o.err_list_len<6&&(o.err_list=JSON.stringify(s.err_list)));break;case k.c.room_user_attributes_modify.cmd:o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.room_user_session_id=n.room_user_session_id.toString(),o.force_modify=n.force_modify,o.auto_save=n.auto_save,o.op_fail_fast=n.op_fail_fast,o.user_ids_len=n.attributes.user_ids.length,o.attributes_len=n.attributes.modify_attribute.length,s&&(o.user_attributes_len=s.user_attributes.length,o.user_err_list_len=s.user_err_list.length,0<o.user_err_list_len&&o.user_err_list_len<6&&(o.user_err_list=JSON.stringify(s.user_err_list)));break;case k.c.room_user_attributes_get.cmd:o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.room_user_session_id=n.room_user_session_id.toString(),o.req_attributes_len=n.req_attributes.length,s&&(o.user_attributes_len=s.user_attributes.length);break;case k.c.room_user_attributes_list_get.cmd:o.room_id=n.room_id,o.sub_room_id=n.sub_room_id,o.room_session_id=n.room_session_id.toString(),o.room_user_session_id=n.room_user_session_id.toString(),o.pos_flag=n.pos_flag,o.count=n.count,s&&(o.user_attributes_len=s.user_attributes.length,o.rsp_pos_flag=s.pos_flag,o.user_count=s.user_count,o.user_attributes_list_seq=s.user_attributes_list_seq);break;case k.c.group_create.cmd:o.group_id=n.group_id,o.group_name=n.group_name,o.group_notice=n.group_notice,o.user_ids_len=n.user_ids.length,o.attributes_len=((r=n.attributes)==null?void 0:r.length)||0,o.group_avatar_len=((t=n.group_avatar)==null?void 0:t.length)||0,s&&(o.members_len=s.members.length,o.member_count=s.member_count,o.group_list_seq=s.group_list_seq,o.group_data_seq=s.group_data_seq,o.group_attribute_seq=s.group_attribute_seq,o.member_all_seq=s.member_all_seq,o.error_users_len=s.error_users.length,0<o.error_users_len&&o.error_users_len<6&&(o.error_users=JSON.stringify(s.error_users)));break;case k.c.group_enter.cmd:o.group_id=n.group_id,s&&(o.group_name=s.group_name,o.group_avatar_len=((c=s.group_avatar)==null?void 0:c.length)||0,s.properties&&(o.attributes_len=s.properties.attributes.length),o.member_count=s.member_count,o.group_list_seq=s.group_list_seq,o.group_data_seq=s.group_data_seq,o.group_attribute_seq=s.group_attribute_seq,o.member_all_seq=s.member_all_seq,o.conv_msg_seq=s.conv_msg_seq);break;case k.c.group_invite.cmd:o.group_id=n.group_id,o.user_ids_len=n.user_ids.length,s&&(o.member_count=s.member_count,o.members_len=s.members.length,o.group_data_seq=s.group_data_seq,o.group_attribute_seq=s.group_attribute_seq,o.member_all_seq=s.member_all_seq,o.error_users_len=s.error_users.length,0<o.error_users_len&&o.error_users_len<6&&(o.error_users=JSON.stringify(s.error_users)));break;case k.c.group_quit.cmd:o.group_id=n.group_id,o.user_ids_len=n.user_ids.length,o.kickout_reason=n.kickout_reason,s&&(o.member_count=s.member_count,o.member_all_seq=s.member_all_seq,o.error_users_len=s.error_users.length,0<o.error_users_len&&o.error_users_len<6&&(o.error_users=JSON.stringify(s.error_users)));break;case k.c.group_kickout.cmd:o.group_id=n.group_id,s&&(o.group_list_seq=s.group_list_seq);break;case k.c.group_destroy.cmd:o.group_id=n.group_id,s&&(o.group_list_seq=s.conv_list_seq);break;case k.c.group_list.cmd:o.how=n.how,o.full_pull=n.full_pull,o.count=n.count,o.cur_list_seq=n.conv_list_seq,s&&(o.fetch_end=s.fetch_end,o.full_list=s.full_list,o.rsp_cur_list_seq=s.cur,o.max_list_seq=s.max,o.groups_len=s.svrCount,o.degree=s.degree);break;case k.c.group_infos.cmd:o.group_ids_len=n.quey_user_id.length,s&&(o.group_infos_len=s.group_infos.length,o.fail_keys_len=s.fail_keys.length);break;case k.c.group_owner_transfer.cmd:o.group_id=n.group_id,o.req_user_id=n.group_name,s&&(o.old_owner_data_seq=s.conv_list_seq,o.new_owner_data_seq=s.conv_msg_seq);break;case k.c.group_data.cmd:o.group_id=n.group_id,s&&(o.group_name=s.group_name,o.group_notice=s.group_notice,o.group_avatar_len=((r=s.group_avatar)==null?void 0:r.length)||0,o.group_data_seq=s.group_data_seq);break;case k.c.group_attributes.cmd:o.group_id=n.group_id,o.attributes_len=n.attributes.attributes.length,o.attribute_seq=n.attributes.seq,s&&(o.rsp_attributes_len=s.attributes.attributes.length,o.rsp_attribute_seq=s.attributes.seq);break;case k.c.group_mute.cmd:o.group_id=n.group_id,o.enable=n.enable;break;case k.c.group_modify_name.cmd:o.group_id=n.group_id,o.group_name=n.group_name,s&&(o.group_data_seq=s.conv_list_seq);break;case k.c.group_modify_avatar.cmd:o.group_id=n.user_id,o.group_avatar_len=n.user_name.length,s&&(o.group_data_seq=s.conv_list_seq);break;case k.c.group_modify_notice.cmd:o.group_id=n.group_id,o.group_notice=n.group_name,s&&(o.group_data_seq=s.conv_list_seq);break;case k.c.group_modify_attributes.cmd:o.group_id=n.group_id,o.attribute_action=n.attributes.action,o.attributes_len=n.attributes.attributes.length,s&&(o.attribute_seq=s.attributes.seq,o.fail_keys_len=s.fail_keys.length,0<o.fail_keys_len&&o.fail_keys_len<6&&(o.fail_keys=JSON.stringify(s.fail_keys)));break;case k.c.group_member_list.cmd:o.how=n.how,o.group_id=n.group_id,o.count=n.count,o.full_pull=n.full_pull,o.cur_member_seq=n.cur_member_seq,s&&(o.degree=s.degree,o.rsp_cur_member_seq=s.cur_member_seq,o.member_all_seq=s.member_all_seq,o.full_list=s.full_list,o.fetch_end=s.fetch_end,o.member_count=s.member_count,o.change_list_len=s.svrCount);break;case k.c.group_members_by_seq.cmd:o.group_id=n.conv_id,o.member_seqs_len=n.conv_msg_seq.length,s&&(o.members_len=s.members.length);break;case k.c.group_member_data.cmd:o.group_id=n.group_id,o.req_user_id=n.user_id,s&&s.member&&s.member.member_data&&(t=s.member.member_data,o.user_name=t.user_name,o.group_nick_name=t.group_nick_name,o.role=t.role,o.user_avatar_len=((c=t.user_avatar)==null?void 0:c.length)||0);break;case k.c.group_member_nickname_set.cmd:o.group_id=n.group_id,o.req_user_id=n.group_name,o.member_nickname=n.group_notice,s&&(o.member_data_seq=s.conv_list_seq);break;case k.c.group_member_role_set.cmd:o.group_id=n.group_id,o.req_user_id=n.user_id,o.role=n.role,s&&(o.member_data_seq=s.conv_list_seq);break;case k.c.call_create.cmd:o.call_id=n.call_id,o.user_ids_len=n.user_ids.length,o.extended_data_len=((r=n.payload)==null?void 0:r.length)||0,o.call_mode=n.call_mode,this.set_offline_push(o,n.offline_info),s&&(o.timeout=n.timeout||s.timeout,o.call_seq=s.call_seq,o.call_list_seq=s.call_list_seq,o.create_time=s.create_time,o.err_list_len=s.new_err_list.length,0<o.err_list_len&&o.err_list_len<6&&(o.err_list=JSON.stringify(s.new_err_list)));break;case k.c.call_cancel.cmd:o.call_id=n.call_id,o.state=n.timeout,o.user_ids_len=n.user_ids.length,o.extended_data_len=((t=n.payload)==null?void 0:t.length)||0,this.set_offline_push(o,n.offline_info),s&&(o.call_seq=s.call_seq,o.call_list_seq=s.now_time,o.err_list_len=s.err_list.length,0<o.err_list_len&&o.err_list_len<6&&(o.err_list=JSON.stringify(s.err_list)));break;case k.c.call_accept.cmd:o.call_id=n.user_id,o.extended_data_len=((c=n.user_name)==null?void 0:c.length)||0,s&&(o.call_seq=s.call_list_seq,o.call_list_seq=s.talk_time,o.accept_time=s.quit_time);break;case k.c.call_refuse.cmd:o.call_id=n.call_id,o.extended_data_len=((r=n.extended_data)==null?void 0:r.length)||0,s&&(o.call_seq=s.call_list_seq,o.call_list_seq=s.talk_time);break;case k.c.call_ack.cmd:o.call_id=n.call_id;break;case k.c.call_info.cmd:o.call_id=n.call_id,s&&(o.user_list_len=s.user_list.length,o.call_seq=s.call_seq);break;case k.c.call_invite.cmd:o.call_id=n.call_id,o.user_ids_len=n.user_ids.length,this.set_offline_push(o,n.offline_info),s&&(o.call_seq=s.call_seq,o.timeout=s.timeout,o.err_list_len=s.err_list.length,0<o.err_list_len&&o.err_list_len<6&&(o.err_list=JSON.stringify(s.err_list)));break;case k.c.call_quit.cmd:o.call_id=n.call_id,o.extended_data_len=((t=n.payload)==null?void 0:t.length)||0,this.set_offline_push(o,n.offline_info),s&&(o.call_list_seq=s.call_list_seq,o.talk_time=s.talk_time,o.quit_time=s.quit_time,o.call_seq=s.call_seq);break;case k.c.call_destroy.cmd:o.call_id=n.call_id,o.extended_data_len=((c=n.payload)==null?void 0:c.length)||0,this.set_offline_push(o,n.offline_info),s&&(o.call_list_seq=s.call_list_seq,o.destroy_time=s.talk_time);break;case k.c.call_list.cmd:o.how=n.how,o.count=n.count,o.cur_list_seq=n.cur_list_seq,s&&(o.rsp_cur_list_seq=s.cur,o.max_list_seq=s.max,o.fetch_end=s.fetch_end,o.calls_len=s.svrCount,o.degree=s.degree)}},d);function d(o){this.settings=o,this.dataReport=new I.a("zim",p.n),this.evenDatatMap=new Map,this.isProd=!0,this.isInited=!1,this.commonFields={error:0,error_message:"",sdk_version:"2.12.0.0",term_type:p.n?"miniprogram":"web",net_type:""},this.unSaveEvents=[k.c.sw_hb.cmd,k.c.usermail_hb.cmd,k.c.room_info.cmd],this.pickCmds={usermail_hb:["msg_to","msg_itvl","list_to","list_itvl","conv_to","conv_itvl","group_to","group_itvl"]}}},function(Q,O,b){var T=b(48);b.d(O,"a",function(){return T.a})},function(Q,O,b){b.d(O,"a",function(){return f});var T=b(87),I=b(90),p=b(4),k=function(o,c){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var t,n,s=r.call(o),u=[];try{for(;(c===void 0||0<c--)&&!(t=s.next()).done;)u.push(t.value)}catch(a){n={error:a}}finally{try{t&&!t.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return u},S=function(o,c,r){if(r||arguments.length===2)for(var t,n=0,s=c.length;n<s;n++)!t&&n in c||((t=t||Array.prototype.slice.call(c,0,n))[n]=c[n]);return o.concat(t||Array.prototype.slice.call(c))},f=(d.prototype.setLogServer=function(o){this.openWebSocketLogServer(o)},d.prototype.setLogUrlParams=function(o){this.logParams=o},d.prototype.openWebSocketLogServer=function(o){var c,r=this;o&&this.logParams.id_name&&o!=this.url&&(this.url=o,this.stopWebSocketServer(),c={product:this.logParams.product,appid:this.logParams.appid,id_name:this.logParams.id_name,deviceid:this.logParams.deviceid,token:encodeURIComponent(this.logParams.signature)},this.service.createSocket(o,c),this.service.openHandler(function(){r.service.onPush(),r.service.startCheck(),r.openHandler()}),this.service.closeHandler(function(){r.service.closeSocket()}))},d.prototype.stopWebSocketServer=function(){this.service.closeSocket()},d.prototype.openHandler=function(){this.startReport()},d.prototype.setPostSucCallback=function(o){this.postSucCallback=o},d.prototype.setPostFailCallback=function(o){this.postFailCallback=o},d.prototype.reportAllowed=function(){return this.packageLen<this.PACKAGE_MAX_LEN},d.prototype.report=function(o){this.packageLen++,this.reportQueue.enqueue(o),this.netWorkFail=!1,this.failCount=0,this.failStartTime=0,this.startReport()},d.prototype.startReport=function(){var o,c,r=this;this.reportQueue.size()<1||(o=this.reportQueue.dequeue(),c=0,o.forEach(function(t){return c+=t.value.length}),this.tokenBucket.removeTokens(c,function(){r.reportData(o,function(){r.failCount=0,r.failStartTime=0,r.packageLen--,r.postSucCallback&&r.postSucCallback(o)},function(t){r.reportQueue.enqueue(o),r.failCount++,r.failCount==0&&(r.failStartTime=Date.now());var n=(Date.now()-r.failStartTime)/1e3;if(10<=r.failCount&&60<n)return r.netWorkFail=!0,n=r.decodeReportQueue(),void r.postFailCallback(n);t!==p.e&&r.startReport()})}))},d.prototype.reportData=function(o,c,r){var t=this;o=o.map(function(n){return n.value}),this.service.sendMessage(o,c,function(n){n===p.e&&t.setLogServer(t.url),r&&r(n)})},d.prototype.decodeReportQueue=function(){for(var o=[];this.reportQueue.size();){var c=this.reportQueue.dequeue();o.push.apply(o,S([],k(c),!1))}return o},d);function d(o){this.packageLen=0,this.PACKAGE_MAX_LEN=5,this.msgID=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCacheSend=[],this.logCacheMax=100,this.failCount=0,this.failStartTime=0,this.netWorkFail=!1,this.service=new T.a(o),this.reportQueue=new p.d,this.tokenBucket=new I.a(1e4,2e3,"sec")}},function(Q,O,b){b.d(O,"a",function(){return p});var T=b(88),I=b(4),p=(k.prototype.handleSendCommandMsgRsp=function(S){var f,d=this,o=this.service.sendCommandMap[S.messageId];o!=null&&(f=o._data,delete this.service.sendCommandMap[S.messageId],this.service.sendCommandList.remove(o),S.code===0?setTimeout(function(){f&&f.success!=null&&f.success(S,d.cmdSeq)},0):setTimeout(function(){f&&f.error!=null&&f.error(S,d.cmdSeq)},0))},k.prototype.onPush=function(){var S=this;this.service.onMessage=function(f){S.handleSendCommandMsgRsp(f)}},k.prototype.closeHandler=function(S){this.service.closeHandler(S)},k.prototype.openHandler=function(S){this.service.openHandler(S)},k.prototype.errorHandler=function(S){this.service.errorHandler(S)},k.prototype.startCheck=function(){this.service.startCheck()},k.prototype.stopCheck=function(){this.service.stopCheck()},k.prototype.createSocket=function(S,f){this.service.createSocket(S,f)},k.prototype.closeSocket=function(){this.service.closeSocket()},k.prototype.sendMessage=function(S,f,d){var o=this;this.service.isDisConnect()?setTimeout(function(){o.service.isDisConnect()?d&&d(I.e):o.service.sendMessage(++o.cmdSeq,S,f,d)},100):this.service.sendMessage(++this.cmdSeq,S,f,d)},k);function k(S){this.cmdSeq=0,this.service=new T.a(S)}},function(Q,O,b){b.d(O,"a",function(){return p});var T=b(89),I=b(4),p=(k.prototype.createSocket=function(S,f){var d=this,o=this.miniProgram?"zego.impl.wx":"zego.impl.web";o=b(49)("./"+o).createZegoWebSocket;try{this.socket=o(S,f,this.miniProgram),this.socket.onerror=function(){d.closeSocket(),d.createSocket(S,f)}}catch{}},k.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},k.prototype.isDisConnect=function(){return!this.socket},k.prototype.sendMessage=function(S,f,d,o){if(d===void 0&&(d=null),o===void 0&&(o=null),this.socket){d={data:f={message_id:S,s:'{"speed_detail":['.concat(f.join(),"]}")},seq:S,deleted:!1,sendTime:Date.now(),timeOut:6e3,success:d,error:o},d=this.sendCommandList.push(d),this.sendCommandMap[S]=d;try{this.socket.send(Object(T.a)(JSON.stringify(f)))}catch{}}},k.prototype.checkSendMessageList=function(S){for(var f=S.getFirst();f!=null;)S.remove(f),f._data&&f._data.error&&setTimeout(function(){f&&f._data&&f._data.error&&f._data.error(I.f.TIMEOUT,f._data.data.message_id,f._data.data.s)},0),f=S.getFirst()},k.prototype.checkMessageListTimeout=function(S,f){for(var d=S.getFirst(),o=Date.now(),c=0;!(d==null||d._data&&d._data.sendTime+d._data.timeOut>o||(d._data&&delete f[d._data.data.message_id],S.remove(d),d._data&&d._data.error==null||d._data&&d._data.sendTime+this.sendDataDropTimeout<o||d&&d._data&&d._data.error&&d._data.error(I.f.TIMEOUT,d._data.data.message_id,d._data.data.s),++c>=this.sendDataCheckOnceCount));)d=S.getFirst()},k.prototype.startCheck=function(){var S=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout(function(){S.startCheck()},this.sendDataCheckInterval)},k.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},k.prototype.openHandler=function(S){var f=this;this.socket&&(this.socket.onopen=function(d){f.responseHandler(),S(d)})},k.prototype.responseHandler=function(){var S=this;this.socket&&(this.socket.onmessage=function(f){f=typeof f.data=="string"?JSON.parse(f.data):JSON.parse(String.fromCharCode.apply(null,new Uint8Array(f.data))),S.onMessage(f)})},k.prototype.closeHandler=function(S){this.socket&&(this.socket.onclose=function(f){S(f)})},k.prototype.errorHandler=function(S){this.socket&&(this.socket.onerror=S)},k.prototype.onMessage=function(S){},k);function k(S){this.miniProgram=S,this.socket=null,this.sendCommandList=new I.c,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3}},function(Q,O,b){b.d(O,"a",function(){return At});function T(x){let Z=x.length;for(;0<=--Z;)x[Z]=0}const I=256,p=286,k=30,S=15,f=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),d=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),o=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),c=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=new Array(576),t=(T(r),new Array(60)),n=(T(t),new Array(512)),s=(T(n),new Array(256)),u=(T(s),new Array(29)),a=(T(u),new Array(k));function i(x,Z,Y,te,F){this.static_tree=x,this.extra_bits=Z,this.extra_base=Y,this.elems=te,this.max_length=F,this.has_stree=x&&x.length}let l,h,m;function g(x,Z){this.dyn_tree=x,this.max_code=0,this.stat_desc=Z}T(a);const y=x=>x<256?n[x]:n[256+(x>>>7)],w=(x,Z)=>{x.pending_buf[x.pending++]=255&Z,x.pending_buf[x.pending++]=Z>>>8&255},M=(x,Z,Y)=>{x.bi_valid>16-Y?(x.bi_buf|=Z<<x.bi_valid&65535,w(x,x.bi_buf),x.bi_buf=Z>>16-x.bi_valid,x.bi_valid+=Y-16):(x.bi_buf|=Z<<x.bi_valid&65535,x.bi_valid+=Y)},R=(x,Z,Y)=>{M(x,Y[2*Z],Y[2*Z+1])},D=(x,Z)=>{let Y=0;for(;Y|=1&x,x>>>=1,Y<<=1,0<--Z;);return Y>>>1},q=(x,Z,Y)=>{const te=new Array(16);let F,se,re=0;for(F=1;F<=S;F++)te[F]=re=re+Y[F-1]<<1;for(se=0;se<=Z;se++){var ae=x[2*se+1];ae!==0&&(x[2*se]=D(te[ae]++,ae))}},L=x=>{let Z;for(Z=0;Z<p;Z++)x.dyn_ltree[2*Z]=0;for(Z=0;Z<k;Z++)x.dyn_dtree[2*Z]=0;for(Z=0;Z<19;Z++)x.bl_tree[2*Z]=0;x.dyn_ltree[512]=1,x.opt_len=x.static_len=0,x.last_lit=x.matches=0},j=x=>{8<x.bi_valid?w(x,x.bi_buf):0<x.bi_valid&&(x.pending_buf[x.pending++]=x.bi_buf),x.bi_buf=0,x.bi_valid=0},G=(x,Z,Y,te)=>{var F=2*Z,se=2*Y;return x[F]<x[se]||x[F]===x[se]&&te[Z]<=te[Y]},J=(x,Z,Y)=>{var te=x.heap[Y];let F=Y<<1;for(;F<=x.heap_len&&(F<x.heap_len&&G(Z,x.heap[F+1],x.heap[F],x.depth)&&F++,!G(Z,te,x.heap[F],x.depth));)x.heap[Y]=x.heap[F],Y=F,F<<=1;x.heap[Y]=te},K=(x,Z,Y)=>{var te;let F,se,re,ae=0;if(x.last_lit!==0)for(;te=x.pending_buf[x.d_buf+2*ae]<<8|x.pending_buf[x.d_buf+2*ae+1],F=x.pending_buf[x.l_buf+ae],ae++,te==0?R(x,F,Z):(se=s[F],R(x,se+I+1,Z),(re=f[se])!==0&&(F-=u[se],M(x,F,re)),te--,se=y(te),R(x,se,Y),(re=d[se])!==0&&(te-=a[se],M(x,te,re))),ae<x.last_lit;);R(x,256,Z)},ee=(x,Z)=>{const Y=Z.dyn_tree;var te=Z.stat_desc.static_tree,F=Z.stat_desc.has_stree,se=Z.stat_desc.elems;let re,ae,me,ce=-1;for(x.heap_len=0,x.heap_max=573,re=0;re<se;re++)Y[2*re]!==0?(x.heap[++x.heap_len]=ce=re,x.depth[re]=0):Y[2*re+1]=0;for(;x.heap_len<2;)me=x.heap[++x.heap_len]=ce<2?++ce:0,Y[2*me]=1,x.depth[me]=0,x.opt_len--,F&&(x.static_len-=te[2*me+1]);for(Z.max_code=ce,re=x.heap_len>>1;1<=re;re--)J(x,Y,re);for(me=se;re=x.heap[1],x.heap[1]=x.heap[x.heap_len--],J(x,Y,1),ae=x.heap[1],x.heap[--x.heap_max]=re,x.heap[--x.heap_max]=ae,Y[2*me]=Y[2*re]+Y[2*ae],x.depth[me]=(x.depth[re]>=x.depth[ae]?x.depth[re]:x.depth[ae])+1,Y[2*re+1]=Y[2*ae+1]=me,x.heap[1]=me++,J(x,Y,1),2<=x.heap_len;);x.heap[--x.heap_max]=x.heap[1],((fe,Se)=>{const Ie=Se.dyn_tree;var Fe,Ve=Se.max_code,xt=Se.stat_desc.static_tree,Pt=Se.stat_desc.has_stree,Tt=Se.stat_desc.extra_bits,ft=Se.stat_desc.extra_base,Ze=Se.stat_desc.max_length;let Je,Oe,We,ke,$e,at=0;for(ke=0;ke<=S;ke++)fe.bl_count[ke]=0;for(Ie[2*fe.heap[fe.heap_max]+1]=0,Je=fe.heap_max+1;Je<573;Je++)Oe=fe.heap[Je],(ke=Ie[2*Ie[2*Oe+1]+1]+1)>Ze&&(ke=Ze,at++),Ie[2*Oe+1]=ke,Oe>Ve||(fe.bl_count[ke]++,$e=0,Oe>=ft&&($e=Tt[Oe-ft]),Fe=Ie[2*Oe],fe.opt_len+=Fe*(ke+$e),Pt&&(fe.static_len+=Fe*(xt[2*Oe+1]+$e)));if(at!==0){do for(ke=Ze-1;fe.bl_count[ke]===0;)ke--;while(fe.bl_count[ke]--,fe.bl_count[ke+1]+=2,fe.bl_count[Ze]--,0<(at-=2));for(ke=Ze;ke!==0;ke--)for(Oe=fe.bl_count[ke];Oe!==0;)Ve<(We=fe.heap[--Je])||(Ie[2*We+1]!==ke&&(fe.opt_len+=(ke-Ie[2*We+1])*Ie[2*We],Ie[2*We+1]=ke),Oe--)}})(x,Z),q(Y,ce,x.bl_count)},A=(x,Z,Y)=>{let te,F=-1;var se;let re=Z[1],ae=0,me=7,ce=4;for(re===0&&(me=138,ce=3),Z[2*(Y+1)+1]=65535,te=0;te<=Y;te++)se=re,re=Z[2*(te+1)+1],++ae<me&&se===re||(ae<ce?x.bl_tree[2*se]+=ae:se!==0?(se!==F&&x.bl_tree[2*se]++,x.bl_tree[32]++):ae<=10?x.bl_tree[34]++:x.bl_tree[36]++,ae=0,F=se,ce=re===0?(me=138,3):se===re?(me=6,3):(me=7,4))},v=(x,Z,Y)=>{let te,F=-1;var se;let re=Z[1],ae=0,me=7,ce=4;for(re===0&&(me=138,ce=3),te=0;te<=Y;te++)if(se=re,re=Z[2*(te+1)+1],!(++ae<me&&se===re)){if(ae<ce)for(;R(x,se,x.bl_tree),--ae!=0;);else se!==0?(se!==F&&(R(x,se,x.bl_tree),ae--),R(x,16,x.bl_tree),M(x,ae-3,2)):ae<=10?(R(x,17,x.bl_tree),M(x,ae-3,3)):(R(x,18,x.bl_tree),M(x,ae-11,7));ae=0,F=se,ce=re===0?(me=138,3):se===re?(me=6,3):(me=7,4)}};let E=!1;const N=(x,Z,Y,te)=>{M(x,0+(te?1:0),3),te=x,x=Z,Z=Y,Y=!0,j(te),Y&&(w(te,Z),w(te,~Z)),te.pending_buf.set(te.window.subarray(x,x+Z),te.pending),te.pending+=Z};b={_tr_init:x=>{if(!E){{let Z,Y,te,F,se;const re=new Array(16);for(te=0,F=0;F<28;F++)for(u[F]=te,Z=0;Z<1<<f[F];Z++)s[te++]=F;for(s[te-1]=F,se=0,F=0;F<16;F++)for(a[F]=se,Z=0;Z<1<<d[F];Z++)n[se++]=F;for(se>>=7;F<k;F++)for(a[F]=se<<7,Z=0;Z<1<<d[F]-7;Z++)n[256+se++]=F;for(Y=0;Y<=S;Y++)re[Y]=0;for(Z=0;Z<=143;)r[2*Z+1]=8,Z++,re[8]++;for(;Z<=255;)r[2*Z+1]=9,Z++,re[9]++;for(;Z<=279;)r[2*Z+1]=7,Z++,re[7]++;for(;Z<=287;)r[2*Z+1]=8,Z++,re[8]++;for(q(r,287,re),Z=0;Z<k;Z++)t[2*Z+1]=5,t[2*Z]=D(Z,5);l=new i(r,f,257,p,S),h=new i(t,d,0,k,S),m=new i(new Array(0),o,0,19,7)}E=!0}x.l_desc=new g(x.dyn_ltree,l),x.d_desc=new g(x.dyn_dtree,h),x.bl_desc=new g(x.bl_tree,m),x.bi_buf=0,x.bi_valid=0,L(x)},_tr_stored_block:N,_tr_flush_block:(x,Z,Y,te)=>{let F,se,re=0;if(0<x.level?(x.strm.data_type===2&&(x.strm.data_type=(ce=>{let fe,Se=4093624447;for(fe=0;fe<=31;fe++,Se>>>=1)if(1&Se&&ce.dyn_ltree[2*fe]!==0)return 0;if(ce.dyn_ltree[18]!==0||ce.dyn_ltree[20]!==0||ce.dyn_ltree[26]!==0)return 1;for(fe=32;fe<I;fe++)if(ce.dyn_ltree[2*fe]!==0)return 1;return 0})(x)),ee(x,x.l_desc),ee(x,x.d_desc),re=(ce=>{let fe;for(A(ce,ce.dyn_ltree,ce.l_desc.max_code),A(ce,ce.dyn_dtree,ce.d_desc.max_code),ee(ce,ce.bl_desc),fe=18;3<=fe&&ce.bl_tree[2*c[fe]+1]===0;fe--);return ce.opt_len+=3*(fe+1)+5+5+4,fe})(x),F=x.opt_len+3+7>>>3,(se=x.static_len+3+7>>>3)<=F&&(F=se)):F=se=Y+5,Y+4<=F&&Z!==-1)N(x,Z,Y,te);else if(x.strategy===4||se===F)M(x,2+(te?1:0),3),K(x,r,t);else{M(x,4+(te?1:0),3);{var ae=x;Z=x.l_desc.max_code+1,Y=x.d_desc.max_code+1;var me=re+1;let ce;for(M(ae,Z-257,5),M(ae,Y-1,5),M(ae,me-4,4),ce=0;ce<me;ce++)M(ae,ae.bl_tree[2*c[ce]+1],3);v(ae,ae.dyn_ltree,Z-1),v(ae,ae.dyn_dtree,Y-1)}K(x,x.dyn_ltree,x.dyn_dtree)}L(x),te&&j(x)},_tr_tally:(x,Z,Y)=>(x.pending_buf[x.d_buf+2*x.last_lit]=Z>>>8&255,x.pending_buf[x.d_buf+2*x.last_lit+1]=255&Z,x.pending_buf[x.l_buf+x.last_lit]=255&Y,x.last_lit++,Z===0?x.dyn_ltree[2*Y]++:(x.matches++,Z--,x.dyn_ltree[2*(s[Y]+I+1)]++,x.dyn_dtree[2*y(Z)]++),x.last_lit===x.lit_bufsize-1),_tr_align:x=>{M(x,2,3),R(x,256,r),(x=x).bi_valid===16?(w(x,x.bi_buf),x.bi_buf=0,x.bi_valid=0):8<=x.bi_valid&&(x.pending_buf[x.pending++]=255&x.bi_buf,x.bi_buf>>=8,x.bi_valid-=8)}};var P=(x,Z,Y,te)=>{let F=65535&x|0,se=x>>>16&65535|0,re=0;for(;Y!==0;){for(Y-=re=2e3<Y?2e3:Y;F=F+Z[te++]|0,se=se+F|0,--re;);F%=65521,se%=65521}return F|se<<16|0};const H=new Uint32Array((()=>{let x,Z=[];for(var Y=0;Y<256;Y++){x=Y;for(var te=0;te<8;te++)x=1&x?3988292384^x>>>1:x>>>1;Z[Y]=x}return Z})());var V=(x,Z,Y,te)=>{var F=H,se=te+Y;x^=-1;for(let re=te;re<se;re++)x=x>>>8^F[255&(x^Z[re])];return-1^x},W={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};O={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:B,_tr_stored_block:$,_tr_flush_block:X,_tr_tally:ne,_tr_align:oe}=b,{Z_NO_FLUSH:ie,Z_PARTIAL_FLUSH:ue,Z_FULL_FLUSH:pe,Z_FINISH:de,Z_BLOCK:_e,Z_OK:le,Z_STREAM_END:be,Z_STREAM_ERROR:ge,Z_DATA_ERROR:ve,Z_BUF_ERROR:Ge,Z_DEFAULT_COMPRESSION:we,Z_FILTERED:qe,Z_HUFFMAN_ONLY:Ue,Z_RLE:rt,Z_FIXED:nt,Z_DEFAULT_STRATEGY:ut,Z_UNKNOWN:Ye,Z_DEFLATED:xe}=O,Re=258,ye=262,Be=113,Pe=(x,Z)=>(x.msg=W[Z],Z),ct=x=>(x<<1)-(4<x?9:0),Te=x=>{let Z=x.length;for(;0<=--Z;)x[Z]=0};let Ee=(x,Z,Y)=>(Z<<x.hash_shift^Y)&x.hash_mask;const Le=x=>{const Z=x.state;let Y=Z.pending;(Y=Y>x.avail_out?x.avail_out:Y)!==0&&(x.output.set(Z.pending_buf.subarray(Z.pending_out,Z.pending_out+Y),x.next_out),x.next_out+=Y,Z.pending_out+=Y,x.total_out+=Y,x.avail_out-=Y,Z.pending-=Y,Z.pending===0&&(Z.pending_out=0))},Ce=(x,Z)=>{X(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,Z),x.block_start=x.strstart,Le(x.strm)},Me=(x,Z)=>{x.pending_buf[x.pending++]=Z},Ke=(x,Z)=>{x.pending_buf[x.pending++]=Z>>>8&255,x.pending_buf[x.pending++]=255&Z},mt=(x,Z,Y,te)=>{let F=x.avail_in;return(F=F>te?te:F)===0?0:(x.avail_in-=F,Z.set(x.input.subarray(x.next_in,x.next_in+F),Y),x.state.wrap===1?x.adler=P(x.adler,Z,F,Y):x.state.wrap===2&&(x.adler=V(x.adler,Z,F,Y)),x.next_in+=F,x.total_in+=F,F)},ot=(x,Z)=>{let Y,te=x.max_chain_length,F=x.strstart;var se;let re=x.prev_length,ae=x.nice_match;var me=x.strstart>x.w_size-ye?x.strstart-(x.w_size-ye):0,ce=x.window,fe=x.w_mask,Se=x.prev,Ie=x.strstart+Re;let Fe=ce[F+re-1],Ve=ce[F+re];x.prev_length>=x.good_match&&(te>>=2),ae>x.lookahead&&(ae=x.lookahead);do if(ce[(Y=Z)+re]===Ve&&ce[Y+re-1]===Fe&&ce[Y]===ce[F]&&ce[++Y]===ce[F+1]){for(F+=2,Y++;ce[++F]===ce[++Y]&&ce[++F]===ce[++Y]&&ce[++F]===ce[++Y]&&ce[++F]===ce[++Y]&&ce[++F]===ce[++Y]&&ce[++F]===ce[++Y]&&ce[++F]===ce[++Y]&&ce[++F]===ce[++Y]&&F<Ie;);if(se=Re-(Ie-F),F=Ie-Re,se>re){if(x.match_start=Z,(re=se)>=ae)break;Fe=ce[F+re-1],Ve=ce[F+re]}}while((Z=Se[Z&fe])>me&&--te!=0);return re<=x.lookahead?re:x.lookahead},ze=x=>{var Z=x.w_size;let Y,te,F,se,re;do{if(se=x.window_size-x.lookahead-x.strstart,x.strstart>=Z+(Z-ye)){for(x.window.set(x.window.subarray(Z,Z+Z),0),x.match_start-=Z,x.strstart-=Z,x.block_start-=Z,te=x.hash_size,Y=te;F=x.head[--Y],x.head[Y]=F>=Z?F-Z:0,--te;);for(te=Z,Y=te;F=x.prev[--Y],x.prev[Y]=F>=Z?F-Z:0,--te;);se+=Z}if(x.strm.avail_in===0)break;if(te=mt(x.strm,x.window,x.strstart+x.lookahead,se),x.lookahead+=te,x.lookahead+x.insert>=3)for(re=x.strstart-x.insert,x.ins_h=x.window[re],x.ins_h=Ee(x,x.ins_h,x.window[re+1]);x.insert&&(x.ins_h=Ee(x,x.ins_h,x.window[re+3-1]),x.prev[re&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=re,re++,x.insert--,!(x.lookahead+x.insert<3)););}while(x.lookahead<ye&&x.strm.avail_in!==0)};b=(x,Z)=>{let Y,te;for(;;){if(x.lookahead<ye){if(ze(x),x.lookahead<ye&&Z===ie)return 1;if(x.lookahead===0)break}if(Y=0,x.lookahead>=3&&(x.ins_h=Ee(x,x.ins_h,x.window[x.strstart+3-1]),Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),Y!==0&&x.strstart-Y<=x.w_size-ye&&(x.match_length=ot(x,Y)),x.match_length>=3)if(te=ne(x,x.strstart-x.match_start,x.match_length-3),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=3){for(x.match_length--;x.strstart++,x.ins_h=Ee(x,x.ins_h,x.window[x.strstart+3-1]),Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=Ee(x,x.ins_h,x.window[x.strstart+1]);else te=ne(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(te&&(Ce(x,!1),x.strm.avail_out===0))return 1}return x.insert=x.strstart<2?x.strstart:2,Z===de?(Ce(x,!0),x.strm.avail_out===0?3:4):x.last_lit&&(Ce(x,!1),x.strm.avail_out===0)?1:2};var Ne=(x,Z)=>{let Y,te;for(var F;;){if(x.lookahead<ye){if(ze(x),x.lookahead<ye&&Z===ie)return 1;if(x.lookahead===0)break}if(Y=0,x.lookahead>=3&&(x.ins_h=Ee(x,x.ins_h,x.window[x.strstart+3-1]),Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=2,Y!==0&&x.prev_length<x.max_lazy_match&&x.strstart-Y<=x.w_size-ye&&(x.match_length=ot(x,Y),x.match_length<=5&&(x.strategy===qe||x.match_length===3&&4096<x.strstart-x.match_start)&&(x.match_length=2)),x.prev_length>=3&&x.match_length<=x.prev_length){for(F=x.strstart+x.lookahead-3,te=ne(x,x.strstart-1-x.prev_match,x.prev_length-3),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=F&&(x.ins_h=Ee(x,x.ins_h,x.window[x.strstart+3-1]),Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=2,x.strstart++,te&&(Ce(x,!1),x.strm.avail_out===0))return 1}else if(x.match_available){if((te=ne(x,0,x.window[x.strstart-1]))&&Ce(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return 1}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(te=ne(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<2?x.strstart:2,Z===de?(Ce(x,!0),x.strm.avail_out===0?3:4):x.last_lit&&(Ce(x,!1),x.strm.avail_out===0)?1:2};function Ae(x,Z,Y,te,F){this.good_length=x,this.max_lazy=Z,this.nice_length=Y,this.max_chain=te,this.func=F}const He=[new Ae(0,0,0,0,(x,Z)=>{let Y=65535;for(Y>x.pending_buf_size-5&&(Y=x.pending_buf_size-5);;){if(x.lookahead<=1){if(ze(x),x.lookahead===0&&Z===ie)return 1;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var te=x.block_start+Y;if((x.strstart===0||x.strstart>=te)&&(x.lookahead=x.strstart-te,x.strstart=te,Ce(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-ye&&(Ce(x,!1),x.strm.avail_out===0))return 1}return x.insert=0,Z===de?(Ce(x,!0),x.strm.avail_out===0?3:4):(x.strstart>x.block_start&&(Ce(x,!1),x.strm.avail_out),1)}),new Ae(4,4,8,4,b),new Ae(4,5,16,8,b),new Ae(4,6,32,32,b),new Ae(4,4,16,16,Ne),new Ae(8,16,32,32,Ne),new Ae(8,16,128,128,Ne),new Ae(8,32,128,256,Ne),new Ae(32,128,258,1024,Ne),new Ae(32,258,258,4096,Ne)];function _t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=xe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Te(this.dyn_ltree),Te(this.dyn_dtree),Te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Te(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const vt=x=>{if(!x||!x.state)return Pe(x,ge);x.total_in=x.total_out=0,x.data_type=Ye;const Z=x.state;return Z.pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?42:Be,x.adler=Z.wrap===2?0:1,Z.last_flush=ie,B(Z),le},bt=x=>{var Z=vt(x);return Z===le&&((x=x.state).window_size=2*x.w_size,Te(x.head),x.max_lazy_match=He[x.level].max_lazy,x.good_match=He[x.level].good_length,x.nice_match=He[x.level].nice_length,x.max_chain_length=He[x.level].max_chain,x.strstart=0,x.block_start=0,x.lookahead=0,x.insert=0,x.match_length=x.prev_length=2,x.match_available=0,x.ins_h=0),Z};var yt=(x,Z,Y,te,F,se)=>{if(!x)return ge;let re=1;if(Z===we&&(Z=6),te<0?(re=0,te=-te):15<te&&(re=2,te-=16),F<1||F>9||Y!==xe||te<8||15<te||Z<0||9<Z||se<0||se>nt)return Pe(x,ge);te===8&&(te=9);const ae=new _t;return(x.state=ae).strm=x,ae.wrap=re,ae.gzhead=null,ae.w_bits=te,ae.w_size=1<<ae.w_bits,ae.w_mask=ae.w_size-1,ae.hash_bits=F+7,ae.hash_size=1<<ae.hash_bits,ae.hash_mask=ae.hash_size-1,ae.hash_shift=~~((ae.hash_bits+3-1)/3),ae.window=new Uint8Array(2*ae.w_size),ae.head=new Uint16Array(ae.hash_size),ae.prev=new Uint16Array(ae.w_size),ae.lit_bufsize=1<<F+6,ae.pending_buf_size=4*ae.lit_bufsize,ae.pending_buf=new Uint8Array(ae.pending_buf_size),ae.d_buf=+ae.lit_bufsize,ae.l_buf=3*ae.lit_bufsize,ae.level=Z,ae.strategy=se,ae.method=Y,bt(x)},Mt=(x,Z)=>x&&x.state&&x.state.wrap===2?(x.state.gzhead=Z,le):ge,It=(x,Z)=>{let Y,te;if(!x||!x.state||Z>_e||Z<0)return x?Pe(x,ge):ge;const F=x.state;if(!x.output||!x.input&&x.avail_in!==0||F.status===666&&Z!==de)return Pe(x,x.avail_out===0?Ge:ge);F.strm=x;var se=F.last_flush;if(F.last_flush=Z,F.status===42)if(F.wrap===2)x.adler=0,Me(F,31),Me(F,139),Me(F,8),F.gzhead?(Me(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),Me(F,255&F.gzhead.time),Me(F,F.gzhead.time>>8&255),Me(F,F.gzhead.time>>16&255),Me(F,F.gzhead.time>>24&255),Me(F,F.level===9?2:F.strategy>=Ue||F.level<2?4:0),Me(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(Me(F,255&F.gzhead.extra.length),Me(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(x.adler=V(x.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(Me(F,0),Me(F,0),Me(F,0),Me(F,0),Me(F,0),Me(F,F.level===9?2:F.strategy>=Ue||F.level<2?4:0),Me(F,3),F.status=Be);else{let re=xe+(F.w_bits-8<<4)<<8,ae=-1;ae=F.strategy>=Ue||F.level<2?0:F.level<6?1:F.level===6?2:3,re|=ae<<6,F.strstart!==0&&(re|=32),re+=31-re%31,F.status=Be,Ke(F,re),F.strstart!==0&&(Ke(F,x.adler>>>16),Ke(F,65535&x.adler)),x.adler=1}if(F.status===69)if(F.gzhead.extra){for(Y=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>Y&&(x.adler=V(x.adler,F.pending_buf,F.pending-Y,Y)),Le(x),Y=F.pending,F.pending!==F.pending_buf_size));)Me(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>Y&&(x.adler=V(x.adler,F.pending_buf,F.pending-Y,Y)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){Y=F.pending;do if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>Y&&(x.adler=V(x.adler,F.pending_buf,F.pending-Y,Y)),Le(x),Y=F.pending,F.pending===F.pending_buf_size)){te=1;break}while(te=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,Me(F,te),te!==0);F.gzhead.hcrc&&F.pending>Y&&(x.adler=V(x.adler,F.pending_buf,F.pending-Y,Y)),te===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){Y=F.pending;do if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>Y&&(x.adler=V(x.adler,F.pending_buf,F.pending-Y,Y)),Le(x),Y=F.pending,F.pending===F.pending_buf_size)){te=1;break}while(te=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,Me(F,te),te!==0);F.gzhead.hcrc&&F.pending>Y&&(x.adler=V(x.adler,F.pending_buf,F.pending-Y,Y)),te===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&Le(x),F.pending+2<=F.pending_buf_size&&(Me(F,255&x.adler),Me(F,x.adler>>8&255),x.adler=0,F.status=Be)):F.status=Be),F.pending!==0){if(Le(x),x.avail_out===0)return F.last_flush=-1,le}else if(x.avail_in===0&&ct(Z)<=ct(se)&&Z!==de)return Pe(x,Ge);if(F.status===666&&x.avail_in!==0)return Pe(x,Ge);if(x.avail_in!==0||F.lookahead!==0||Z!==ie&&F.status!==666){if((se=F.strategy===Ue?((re,ae)=>{for(var me;;){if(re.lookahead===0&&(ze(re),re.lookahead===0)){if(ae===ie)return 1;break}if(re.match_length=0,me=ne(re,0,re.window[re.strstart]),re.lookahead--,re.strstart++,me&&(Ce(re,!1),re.strm.avail_out===0))return 1}return re.insert=0,ae===de?(Ce(re,!0),re.strm.avail_out===0?3:4):re.last_lit&&(Ce(re,!1),re.strm.avail_out===0)?1:2})(F,Z):F.strategy===rt?((re,ae)=>{let me;var ce;let fe,Se;for(var Ie=re.window;;){if(re.lookahead<=Re){if(ze(re),re.lookahead<=Re&&ae===ie)return 1;if(re.lookahead===0)break}if(re.match_length=0,re.lookahead>=3&&0<re.strstart&&(ce=Ie[fe=re.strstart-1])===Ie[++fe]&&ce===Ie[++fe]&&ce===Ie[++fe]){for(Se=re.strstart+Re;ce===Ie[++fe]&&ce===Ie[++fe]&&ce===Ie[++fe]&&ce===Ie[++fe]&&ce===Ie[++fe]&&ce===Ie[++fe]&&ce===Ie[++fe]&&ce===Ie[++fe]&&fe<Se;);re.match_length=Re-(Se-fe),re.match_length>re.lookahead&&(re.match_length=re.lookahead)}if(re.match_length>=3?(me=ne(re,1,re.match_length-3),re.lookahead-=re.match_length,re.strstart+=re.match_length,re.match_length=0):(me=ne(re,0,re.window[re.strstart]),re.lookahead--,re.strstart++),me&&(Ce(re,!1),re.strm.avail_out===0))return 1}return re.insert=0,ae===de?(Ce(re,!0),re.strm.avail_out===0?3:4):re.last_lit&&(Ce(re,!1),re.strm.avail_out===0)?1:2})(F,Z):He[F.level].func(F,Z))!==3&&se!==4||(F.status=666),se===1||se===3)return x.avail_out===0&&(F.last_flush=-1),le;if(se===2&&(Z===ue?oe(F):Z!==_e&&($(F,0,0,!1),Z===pe&&(Te(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),Le(x),x.avail_out===0))return F.last_flush=-1,le}return Z!==de?le:F.wrap<=0?be:(F.wrap===2?(Me(F,255&x.adler),Me(F,x.adler>>8&255),Me(F,x.adler>>16&255),Me(F,x.adler>>24&255),Me(F,255&x.total_in),Me(F,x.total_in>>8&255),Me(F,x.total_in>>16&255),Me(F,x.total_in>>24&255)):(Ke(F,x.adler>>>16),Ke(F,65535&x.adler)),Le(x),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?le:be)},kt=x=>{if(!x||!x.state)return ge;var Z=x.state.status;return Z!==42&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==Be&&Z!==666?Pe(x,ge):(x.state=null,Z===Be?Pe(x,ve):le)},wt=(x,Z)=>{let Y=Z.length;if(!x||!x.state)return ge;const te=x.state;var F=te.wrap;if(F===2||F===1&&te.status!==42||te.lookahead)return ge;if(F===1&&(x.adler=P(x.adler,Z,Y,0)),te.wrap=0,Y>=te.w_size){F===0&&(Te(te.head),te.strstart=0,te.block_start=0,te.insert=0);let me=new Uint8Array(te.w_size);me.set(Z.subarray(Y-te.w_size,Y),0),Z=me,Y=te.w_size}var se=x.avail_in,re=x.next_in,ae=x.input;for(x.avail_in=Y,x.next_in=0,x.input=Z,ze(te);te.lookahead>=3;){let me=te.strstart,ce=te.lookahead-2;for(;te.ins_h=Ee(te,te.ins_h,te.window[me+3-1]),te.prev[me&te.w_mask]=te.head[te.ins_h],te.head[te.ins_h]=me,me++,--ce;);te.strstart=me,te.lookahead=2,ze(te)}return te.strstart+=te.lookahead,te.block_start=te.strstart,te.insert=te.lookahead,te.lookahead=0,te.match_length=te.prev_length=2,te.match_available=0,x.next_in=re,x.input=ae,x.avail_in=se,te.wrap=F,le};try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{}const st=new Uint8Array(256);for(let x=0;x<256;x++)st[x]=252<=x?6:248<=x?5:240<=x?4:224<=x?3:192<=x?2:1;st[254]=st[254]=1;var lt=x=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(x);let Z,Y,te,F,se,re=x.length,ae=0;for(F=0;F<re;F++)(64512&(Y=x.charCodeAt(F)))==55296&&F+1<re&&(64512&(te=x.charCodeAt(F+1)))==56320&&(Y=65536+(Y-55296<<10)+(te-56320),F++),ae+=Y<128?1:Y<2048?2:Y<65536?3:4;for(Z=new Uint8Array(ae),se=0,F=0;se<ae;F++)(64512&(Y=x.charCodeAt(F)))==55296&&F+1<re&&(64512&(te=x.charCodeAt(F+1)))==56320&&(Y=65536+(Y-55296<<10)+(te-56320),F++),Y<128?Z[se++]=Y:(Y<2048?Z[se++]=192|Y>>>6:(Y<65536?Z[se++]=224|Y>>>12:(Z[se++]=240|Y>>>18,Z[se++]=128|Y>>>12&63),Z[se++]=128|Y>>>6&63),Z[se++]=128|63&Y);return Z},Ct=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const dt=Object.prototype.toString,{Z_NO_FLUSH:pt,Z_SYNC_FLUSH:ht,Z_FULL_FLUSH:gt,Z_FINISH:St,Z_OK:Xe,Z_STREAM_END:Dt,Z_DEFAULT_COMPRESSION:qt,Z_DEFAULT_STRATEGY:Rt,Z_DEFLATED:Ot}=O;function Qe(x){this.options=function(te){const F=Array.prototype.slice.call(arguments,1);for(;F.length;){var se=F.shift();if(se){if(typeof se!="object")throw new TypeError(se+"must be non-object");for(const me in se)re=se,ae=me,Object.prototype.hasOwnProperty.call(re,ae)&&(te[me]=se[me])}}var re,ae;return te}({level:qt,method:Ot,chunkSize:16384,windowBits:15,memLevel:8,strategy:Rt},x||{});let Z=this.options,Y=(Z.raw&&0<Z.windowBits?Z.windowBits=-Z.windowBits:Z.gzip&&0<Z.windowBits&&Z.windowBits<16&&(Z.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ct,this.strm.avail_out=0,yt(this.strm,Z.level,Z.method,Z.windowBits,Z.memLevel,Z.strategy));if(Y!==Xe)throw new Error(W[Y]);if(Z.header&&Mt(this.strm,Z.header),Z.dictionary){let te;if(te=typeof Z.dictionary=="string"?lt(Z.dictionary):dt.call(Z.dictionary)==="[object ArrayBuffer]"?new Uint8Array(Z.dictionary):Z.dictionary,(Y=wt(this.strm,te))!==Xe)throw new Error(W[Y]);this._dict_set=!0}}function it(x,Z){const Y=new Qe(Z);if(Y.push(x,!0),Y.err)throw Y.msg||W[Y.err];return Y.result}Qe.prototype.push=function(x,Z){const Y=this.strm;var te=this.options.chunkSize;let F,se;if(this.ended)return!1;for(se=Z===~~Z?Z:Z===!0?St:pt,typeof x=="string"?Y.input=lt(x):dt.call(x)==="[object ArrayBuffer]"?Y.input=new Uint8Array(x):Y.input=x,Y.next_in=0,Y.avail_in=Y.input.length;;)if(Y.avail_out===0&&(Y.output=new Uint8Array(te),Y.next_out=0,Y.avail_out=te),(se===ht||se===gt)&&Y.avail_out<=6)this.onData(Y.output.subarray(0,Y.next_out)),Y.avail_out=0;else{if(It(Y,se)===Dt)return 0<Y.next_out&&this.onData(Y.output.subarray(0,Y.next_out)),F=kt(this.strm),this.onEnd(F),this.ended=!0,F===Xe;if(Y.avail_out===0)this.onData(Y.output);else if(0<se&&0<Y.next_out)this.onData(Y.output.subarray(0,Y.next_out)),Y.avail_out=0;else if(Y.avail_in===0)break}return!0},Qe.prototype.onData=function(x){this.chunks.push(x)},Qe.prototype.onEnd=function(x){x===Xe&&(this.result=(Z=>{let Y=0;for(let se=0,re=Z.length;se<re;se++)Y+=Z[se].length;const te=new Uint8Array(Y);for(let se=0,re=0,ae=Z.length;se<ae;se++){var F=Z[se];te.set(F,re),re+=F.length}return te})(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},b={Deflate:Qe,deflate:it,deflateRaw:function(x,Z){return(Z=Z||{}).raw=!0,it(x,Z)},gzip:function(x,Z){return(Z=Z||{}).gzip=!0,it(x,Z)},constants:O};var At=Ne=b.deflate},function(Q,O,b){b.d(O,"a",function(){return T}),I.prototype.removeTokens=function(p,k){var S=this;return this.bucketSize?p>this.bucketSize?(setTimeout(k.bind(null,"Requested tokens "+p+" exceeds bucket size "+this.bucketSize,null),0),!1):(this.drip(),p>this.content?f():this.parentBucket?this.parentBucket.removeTokens(p,function(d,o){return d?k(d,null):p>S.content?f():(S.content-=p,void k(null,Math.min(o,S.content)))}):(this.content-=p,setTimeout(k.bind(null,null,this.content),0),!0)):(setTimeout(k.bind(null,null,p,Number.POSITIVE_INFINITY),0),!0);function f(){var d=Math.ceil((p-S.content)*(S.interval/S.tokensPerInterval));return setTimeout(function(){S.removeTokens(p,k)},d),!1}},I.prototype.tryRemoveTokens=function(p){return!(this.bucketSize&&(p>this.bucketSize||(this.drip(),p>this.content||this.parentBucket&&!this.parentBucket.tryRemoveTokens(p)||(this.content-=p,0))))},I.prototype.drip=function(){var p,k;this.tokensPerInterval?(k=+new Date,p=Math.max(k-this.lastDrip,0),this.lastDrip=k,k=p*(this.tokensPerInterval/this.interval),this.content=Math.min(this.content+k,this.bucketSize)):this.content=this.bucketSize};var T=I;function I(p,k,S,f){if(this.bucketSize=1,this.tokensPerInterval=1,this.interval=1e3,this.parentBucket=null,this.content=0,this.lastDrip=0,this.bucketSize=p,this.tokensPerInterval=k,typeof S=="string")switch(S){case"sec":case"second":this.interval=1e3;break;case"min":case"minute":this.interval=6e4;break;case"hr":case"hour":this.interval=36e5;break;case"day":this.interval=864e5;break;default:throw new Error("Invaid interval "+S)}else this.interval=S;this.parentBucket=f,this.content=0,this.lastDrip=+new Date}},function(Q,O,b){b.d(O,"a",function(){return I});var T=b(4),I=(p.prototype.enqueue=function(k){this.queue.enqueue(k),k=k.value.length,this.pendingDataSize+=k,this.size++,T.a.totalAvailCache-=k,this.enCallback&&this.enCallback(this.byteLength,this.size,this.pendingDataSize)},p.prototype.dequeue=function(){var k=this.queue.dequeue();return this.size--,this.deCallback&&this.deCallback(),k},p.prototype.readReportData=function(k){return k=this.readData(k),this.reset(),{totalLen:k.totalLen,reportDataArr:k.resArr}},p.prototype.readStoreData=function(k){return k=Math.ceil(this.pendingDataSize*k),k=this.readData(k),this.refresh(k.totalLen),k.resArr},p.prototype.readData=function(k){for(var S=[],f=0;this.queue.size();){var d=this.dequeue();if(d&&(S.push(d),f+=d.value.length),k<f)break}return{totalLen:f,resArr:S}},p.prototype.decodeReportData=function(k){var S=this;k.forEach(function(f){S.enqueue(f)})},p.prototype.setListener=function(k){this.enCallback=k.enCallback,this.deCallback=k.deCallback},p.prototype.getPendingDataInfo=function(){return{pendingDataSize:this.pendingDataSize,size:this.size}},p.prototype.refresh=function(k){this.pendingDataSize-=k,T.a.totalAvailCache+=k},p.prototype.reset=function(){this.byteLength=0},p.prototype.clear=function(){this.queue.clear()},p);function p(){this.queue=new T.d,this.byteLength=0,this.size=0,this.pendingDataSize=0}},function(Q,O){},function(Q,O,b){var T;Q.exports=(Q=b(5),T=Q.lib.WordArray,Q.enc.Base64={stringify:function(I){for(var p=I.words,k=I.sigBytes,S=this._map,f=(I.clamp(),[]),d=0;d<k;d+=3)for(var o=(p[d>>>2]>>>24-d%4*8&255)<<16|(p[d+1>>>2]>>>24-(d+1)%4*8&255)<<8|p[d+2>>>2]>>>24-(d+2)%4*8&255,c=0;c<4&&d+.75*c<k;c++)f.push(S.charAt(o>>>6*(3-c)&63));var r=S.charAt(64);if(r)for(;f.length%4;)f.push(r);return f.join("")},parse:function(I){var p=I.length,k=this._map;if(!(S=this._reverseMap))for(var S=this._reverseMap=[],f=0;f<k.length;f++)S[k.charCodeAt(f)]=f;var d=k.charAt(64);return d&&(d=I.indexOf(d))!==-1&&(p=d),function(o,c,r){for(var t,n,s=[],u=0,a=0;a<c;a++)a%4&&(t=r[o.charCodeAt(a-1)]<<a%4*2,n=r[o.charCodeAt(a)]>>>6-a%4*2,s[u>>>2]|=(t|n)<<24-u%4*8,u++);return T.create(s,u)}(I,p,S)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},Q.enc.Base64)},function(Q,O,b){var T,I,p,k;Q.exports=(Q=b(5),k=(b=Q).lib,T=k.WordArray,I=k.Hasher,k=b.algo,p=[],k=k.SHA1=I.extend({_doReset:function(){this._hash=new T.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(S,f){for(var d=this._hash.words,o=d[0],c=d[1],r=d[2],t=d[3],n=d[4],s=0;s<80;s++){s<16?p[s]=0|S[f+s]:(u=p[s-3]^p[s-8]^p[s-14]^p[s-16],p[s]=u<<1|u>>>31);var u=(o<<5|o>>>27)+n+p[s];u+=s<20?1518500249+(c&r|~c&t):s<40?1859775393+(c^r^t):s<60?(c&r|c&t|r&t)-1894007588:(c^r^t)-899497514,n=t,t=r,r=c<<30|c>>>2,c=o,o=u}d[0]=d[0]+o|0,d[1]=d[1]+c|0,d[2]=d[2]+r|0,d[3]=d[3]+t|0,d[4]=d[4]+n|0},_doFinalize:function(){var S=this._data,f=S.words,d=8*this._nDataBytes,o=8*S.sigBytes;return f[o>>>5]|=128<<24-o%32,f[14+(64+o>>>9<<4)]=Math.floor(d/4294967296),f[15+(64+o>>>9<<4)]=d,S.sigBytes=4*f.length,this._process(),this._hash},clone:function(){var S=I.clone.call(this);return S._hash=this._hash.clone(),S}}),b.SHA1=I._createHelper(k),b.HmacSHA1=I._createHmacHelper(k),Q.SHA1)},function(Q,O,b){var T;Q.exports=(Q=b(5),b=Q.lib.Base,T=Q.enc.Utf8,void(Q.algo.HMAC=b.extend({init:function(I,p){I=this._hasher=new I.init,typeof p=="string"&&(p=T.parse(p));for(var k=I.blockSize,S=4*k,f=(I=((p=p.sigBytes>S?I.finalize(p):p).clamp(),this._oKey=p.clone()),p=this._iKey=p.clone(),I.words),d=p.words,o=0;o<k;o++)f[o]^=1549556828,d[o]^=909522486;I.sigBytes=p.sigBytes=S,this.reset()},reset:function(){var I=this._hasher;I.reset(),I.update(this._iKey)},update:function(I){return this._hasher.update(I),this},finalize:function(I){var p=this._hasher;return I=p.finalize(I),p.reset(),p.finalize(this._oKey.clone().concat(I))}})))},function(Q,O,b){var T,I,p,k,S,f,d,o,c,r,t,n;Q.exports=(Q=b(5),b(23),void(Q.lib.Cipher||(b=(Q=Q).lib,T=b.Base,I=b.WordArray,p=b.BufferedBlockAlgorithm,(c=Q.enc).Utf8,k=c.Base64,S=Q.algo.EvpKDF,f=b.Cipher=p.extend({cfg:T.extend(),createEncryptor:function(s,u){return this.create(this._ENC_XFORM_MODE,s,u)},createDecryptor:function(s,u){return this.create(this._DEC_XFORM_MODE,s,u)},init:function(s,u,a){this.cfg=this.cfg.extend(a),this._xformMode=s,this._key=u,this.reset()},reset:function(){p.reset.call(this),this._doReset()},process:function(s){return this._append(s),this._process()},finalize:function(s){return s&&this._append(s),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function s(u){return typeof u=="string"?n:r}return function(u){return{encrypt:function(a,i,l){return s(i).encrypt(u,a,i,l)},decrypt:function(a,i,l){return s(i).decrypt(u,a,i,l)}}}}()}),b.StreamCipher=f.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),c=Q.mode={},d=b.BlockCipherMode=T.extend({createEncryptor:function(s,u){return this.Encryptor.create(s,u)},createDecryptor:function(s,u){return this.Decryptor.create(s,u)},init:function(s,u){this._cipher=s,this._iv=u}}),c=c.CBC=function(){var s=d.extend();function u(a,i,l){var h,m=this._iv;m?(h=m,this._iv=void 0):h=this._prevBlock;for(var g=0;g<l;g++)a[i+g]^=h[g]}return s.Encryptor=s.extend({processBlock:function(a,i){var l=this._cipher,h=l.blockSize;u.call(this,a,i,h),l.encryptBlock(a,i),this._prevBlock=a.slice(i,i+h)}}),s.Decryptor=s.extend({processBlock:function(a,i){var l=this._cipher,h=l.blockSize,m=a.slice(i,i+h);l.decryptBlock(a,i),u.call(this,a,i,h),this._prevBlock=m}}),s}(),t=(Q.pad={}).Pkcs7={pad:function(s,u){for(var a=(u=4*u)-s.sigBytes%u,i=a<<24|a<<16|a<<8|a,l=[],h=0;h<a;h+=4)l.push(i);u=I.create(l,a),s.concat(u)},unpad:function(s){var u=255&s.words[s.sigBytes-1>>>2];s.sigBytes-=u}},b.BlockCipher=f.extend({cfg:f.cfg.extend({mode:c,padding:t}),reset:function(){f.reset.call(this);var s,u=(a=this.cfg).iv,a=a.mode;this._xformMode==this._ENC_XFORM_MODE?s=a.createEncryptor:(s=a.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==s?this._mode.init(this,u&&u.words):(this._mode=s.call(a,this,u&&u.words),this._mode.__creator=s)},_doProcessBlock:function(s,u){this._mode.processBlock(s,u)},_doFinalize:function(){var s,u=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(u.pad(this._data,this.blockSize),s=this._process(!0)):(s=this._process(!0),u.unpad(s)),s},blockSize:4}),o=b.CipherParams=T.extend({init:function(s){this.mixIn(s)},toString:function(s){return(s||this.formatter).stringify(this)}}),c=(Q.format={}).OpenSSL={stringify:function(s){var u=s.ciphertext;return(s=(s=s.salt)?I.create([1398893684,1701076831]).concat(s).concat(u):u).toString(k)},parse:function(s){var u,a=(s=k.parse(s)).words;return a[0]==1398893684&&a[1]==1701076831&&(u=I.create(a.slice(2,4)),a.splice(0,4),s.sigBytes-=16),o.create({ciphertext:s,salt:u})}},r=b.SerializableCipher=T.extend({cfg:T.extend({format:c}),encrypt:function(s,u,a,i){i=this.cfg.extend(i),u=(l=s.createEncryptor(a,i)).finalize(u);var l=l.cfg;return o.create({ciphertext:u,key:a,iv:l.iv,algorithm:s,mode:l.mode,padding:l.padding,blockSize:s.blockSize,formatter:i.format})},decrypt:function(s,u,a,i){return i=this.cfg.extend(i),u=this._parse(u,i.format),s.createDecryptor(a,i).finalize(u.ciphertext)},_parse:function(s,u){return typeof s=="string"?u.parse(s,this):s}}),t=(Q.kdf={}).OpenSSL={execute:function(s,u,a,i){return i=i||I.random(8),s=S.create({keySize:u+a}).compute(s,i),a=I.create(s.words.slice(u),4*a),s.sigBytes=4*u,o.create({key:s,iv:a,salt:i})}},n=b.PasswordBasedCipher=r.extend({cfg:r.cfg.extend({kdf:t}),encrypt:function(s,u,a,i){return a=(i=this.cfg.extend(i)).kdf.execute(a,s.keySize,s.ivSize),i.iv=a.iv,(s=r.encrypt.call(this,s,u,a.key,i)).mixIn(a),s},decrypt:function(s,u,a,i){return i=this.cfg.extend(i),u=this._parse(u,i.format),a=i.kdf.execute(a,s.keySize,s.ivSize,u.salt),i.iv=a.iv,r.decrypt.call(this,s,u,a.key,i)}}))))},function(Q,O,b){var T=O;function I(){T.util._configure(),T.Writer._configure(T.BufferWriter),T.Reader._configure(T.BufferReader)}T.build="minimal",T.Writer=b(24),T.BufferWriter=b(106),T.Reader=b(25),T.BufferReader=b(107),T.util=b(10),T.rpc=b(108),T.roots=b(110),T.configure=I,I()},function(Q,O,b){Q.exports=function(T,I){for(var p=new Array(arguments.length-1),k=0,S=2,f=!0;S<arguments.length;)p[k++]=arguments[S++];return new Promise(function(d,o){p[k]=function(c){if(f)if(f=!1,c)o(c);else{for(var r=new Array(arguments.length-1),t=0;t<r.length;)r[t++]=arguments[t];d.apply(null,r)}};try{T.apply(I||null,p)}catch(c){f&&(f=!1,o(c))}})}},function(Q,O,b){O.length=function(S){var f=S.length;if(!f)return 0;for(var d=0;1<--f%4&&S.charAt(f)==="=";)++d;return Math.ceil(3*S.length)/4-d};for(var T=new Array(64),I=new Array(123),p=0;p<64;)I[T[p]=p<26?p+65:p<52?p+71:p<62?p-4:p-59|43]=p++;O.encode=function(S,f,d){for(var o,c=null,r=[],t=0,n=0;f<d;){var s=S[f++];switch(n){case 0:r[t++]=T[s>>2],o=(3&s)<<4,n=1;break;case 1:r[t++]=T[o|s>>4],o=(15&s)<<2,n=2;break;case 2:r[t++]=T[o|s>>6],r[t++]=T[63&s],n=0}8191<t&&((c=c||[]).push(String.fromCharCode.apply(String,r)),t=0)}return n&&(r[t++]=T[o],r[t++]=61,n===1&&(r[t++]=61)),c?(t&&c.push(String.fromCharCode.apply(String,r.slice(0,t))),c.join("")):String.fromCharCode.apply(String,r.slice(0,t))};var k="invalid encoding";O.decode=function(S,f,d){for(var o,c=d,r=0,t=0;t<S.length;){var n=S.charCodeAt(t++);if(n===61&&1<r)break;if((n=I[n])===void 0)throw Error(k);switch(r){case 0:o=n,r=1;break;case 1:f[d++]=o<<2|(48&n)>>4,o=n,r=2;break;case 2:f[d++]=(15&o)<<4|(60&n)>>2,o=n,r=3;break;case 3:f[d++]=(3&o)<<6|n,r=0}}if(r===1)throw Error(k);return d-c},O.test=function(S){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(S)}},function(Q,O,b){function T(){this._listeners={}}(Q.exports=T).prototype.on=function(I,p,k){return(this._listeners[I]||(this._listeners[I]=[])).push({fn:p,ctx:k||this}),this},T.prototype.off=function(I,p){if(I===void 0)this._listeners={};else if(p===void 0)this._listeners[I]=[];else for(var k=this._listeners[I],S=0;S<k.length;)k[S].fn===p?k.splice(S,1):++S;return this},T.prototype.emit=function(I){var p=this._listeners[I];if(p){for(var k=[],S=1;S<arguments.length;)k.push(arguments[S++]);for(S=0;S<p.length;)p[S].fn.apply(p[S++].ctx,k)}return this}},function(Q,O,b){function T(f){function d(R,D,q,L){var j=D<0?1:0;(D=j?-D:D)===0?R(0<1/D?0:2147483648,q,L):isNaN(D)?R(2143289344,q,L):R(34028234663852886e22<D?(j<<31|2139095040)>>>0:D<11754943508222875e-54?(j<<31|Math.round(D/1401298464324817e-60))>>>0:(j<<31|(R=Math.floor(Math.log(D)/Math.LN2))+127<<23|8388607&Math.round(D*Math.pow(2,-R)*8388608))>>>0,q,L)}function o(R,D,q){return D=2*((R=R(D,q))>>31)+1,q=R>>>23&255,R&=8388607,q==255?R?NaN:1/0*D:q==0?1401298464324817e-60*D*R:D*Math.pow(2,q-150)*(8388608+R)}function c(R,D,q){s[0]=R,D[q]=u[0],D[q+1]=u[1],D[q+2]=u[2],D[q+3]=u[3]}function r(R,D,q){s[0]=R,D[q]=u[3],D[q+1]=u[2],D[q+2]=u[1],D[q+3]=u[0]}function t(R,D){return u[0]=R[D],u[1]=R[D+1],u[2]=R[D+2],u[3]=R[D+3],s[0]}function n(R,D){return u[3]=R[D],u[2]=R[D+1],u[1]=R[D+2],u[0]=R[D+3],s[0]}var s,u,a,i,l;function h(R,D,q,L,j,G){var J,K,ee=L<0?1:0;(L=ee?-L:L)===0?(R(0,j,G+D),R(0<1/L?0:2147483648,j,G+q)):isNaN(L)?(R(0,j,G+D),R(2146959360,j,G+q)):17976931348623157e292<L?(R(0,j,G+D),R((ee<<31|2146435072)>>>0,j,G+q)):L<22250738585072014e-324?(R((J=L/5e-324)>>>0,j,G+D),R((ee<<31|J/4294967296)>>>0,j,G+q)):((K=Math.floor(Math.log(L)/Math.LN2))===1024&&(K=1023),R(4503599627370496*(J=L*Math.pow(2,-K))>>>0,j,G+D),R((ee<<31|K+1023<<20|1048576*J&1048575)>>>0,j,G+q))}function m(R,D,q,L,j){return D=R(L,j+D),L=2*((R=R(L,j+q))>>31)+1,q=4294967296*(1048575&R)+D,(j=R>>>20&2047)==2047?q?NaN:1/0*L:j==0?5e-324*L*q:L*Math.pow(2,j-1075)*(q+4503599627370496)}function g(R,D,q){a[0]=R,D[q]=i[0],D[q+1]=i[1],D[q+2]=i[2],D[q+3]=i[3],D[q+4]=i[4],D[q+5]=i[5],D[q+6]=i[6],D[q+7]=i[7]}function y(R,D,q){a[0]=R,D[q]=i[7],D[q+1]=i[6],D[q+2]=i[5],D[q+3]=i[4],D[q+4]=i[3],D[q+5]=i[2],D[q+6]=i[1],D[q+7]=i[0]}function w(R,D){return i[0]=R[D],i[1]=R[D+1],i[2]=R[D+2],i[3]=R[D+3],i[4]=R[D+4],i[5]=R[D+5],i[6]=R[D+6],i[7]=R[D+7],a[0]}function M(R,D){return i[7]=R[D],i[6]=R[D+1],i[5]=R[D+2],i[4]=R[D+3],i[3]=R[D+4],i[2]=R[D+5],i[1]=R[D+6],i[0]=R[D+7],a[0]}return typeof Float32Array<"u"?(s=new Float32Array([-0]),l=(u=new Uint8Array(s.buffer))[3]===128,f.writeFloatLE=l?c:r,f.writeFloatBE=l?r:c,f.readFloatLE=l?t:n,f.readFloatBE=l?n:t):(f.writeFloatLE=d.bind(null,I),f.writeFloatBE=d.bind(null,p),f.readFloatLE=o.bind(null,k),f.readFloatBE=o.bind(null,S)),typeof Float64Array<"u"?(a=new Float64Array([-0]),l=(i=new Uint8Array(a.buffer))[7]===128,f.writeDoubleLE=l?g:y,f.writeDoubleBE=l?y:g,f.readDoubleLE=l?w:M,f.readDoubleBE=l?M:w):(f.writeDoubleLE=h.bind(null,I,0,4),f.writeDoubleBE=h.bind(null,p,4,0),f.readDoubleLE=m.bind(null,k,0,4),f.readDoubleBE=m.bind(null,S,4,0)),f}function I(f,d,o){d[o]=255&f,d[o+1]=f>>>8&255,d[o+2]=f>>>16&255,d[o+3]=f>>>24}function p(f,d,o){d[o]=f>>>24,d[o+1]=f>>>16&255,d[o+2]=f>>>8&255,d[o+3]=255&f}function k(f,d){return(f[d]|f[d+1]<<8|f[d+2]<<16|f[d+3]<<24)>>>0}function S(f,d){return(f[d]<<24|f[d+1]<<16|f[d+2]<<8|f[d+3])>>>0}Q.exports=T(T)},function(module,exports,__webpack_require__){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(Q){}return null}module.exports=inquire},function(Q,O,b){O.length=function(T){for(var I,p=0,k=0;k<T.length;++k)(I=T.charCodeAt(k))<128?p+=1:I<2048?p+=2:(64512&I)==55296&&(64512&T.charCodeAt(k+1))==56320?(++k,p+=4):p+=3;return p},O.read=function(T,I,p){if(p-I<1)return"";for(var k,S=null,f=[],d=0;I<p;)(k=T[I++])<128?f[d++]=k:191<k&&k<224?f[d++]=(31&k)<<6|63&T[I++]:239<k&&k<365?(k=((7&k)<<18|(63&T[I++])<<12|(63&T[I++])<<6|63&T[I++])-65536,f[d++]=55296+(k>>10),f[d++]=56320+(1023&k)):f[d++]=(15&k)<<12|(63&T[I++])<<6|63&T[I++],8191<d&&((S=S||[]).push(String.fromCharCode.apply(String,f)),d=0);return S?(d&&S.push(String.fromCharCode.apply(String,f.slice(0,d))),S.join("")):String.fromCharCode.apply(String,f.slice(0,d))},O.write=function(T,I,p){for(var k,S,f=p,d=0;d<T.length;++d)(k=T.charCodeAt(d))<128?I[p++]=k:(k<2048?I[p++]=k>>6|192:((64512&k)==55296&&(64512&(S=T.charCodeAt(d+1)))==56320?(++d,I[p++]=(k=65536+((1023&k)<<10)+(1023&S))>>18|240,I[p++]=k>>12&63|128):I[p++]=k>>12|224,I[p++]=k>>6&63|128),I[p++]=63&k|128);return p-f}},function(Q,O,b){Q.exports=function(T,I,p){var k=p||8192,S=k>>>1,f=null,d=k;return function(o){return o<1||S<o?T(o):(k<d+o&&(f=T(k),d=0),o=I.call(f,d,d+=o),7&d&&(d=1+(7|d)),o)}}},function(Q,O,b){Q.exports=I;var T=b(10);function I(S,f){this.lo=S>>>0,this.hi=f>>>0}var p=I.zero=new I(0,0),k=(p.toNumber=function(){return 0},p.zzEncode=p.zzDecode=function(){return this},p.length=function(){return 1},I.zeroHash="\0\0\0\0\0\0\0\0",I.fromNumber=function(S){if(S===0)return p;var f=S<0,d=(S=f?-S:S)>>>0;return S=(S-d)/4294967296>>>0,f&&(S=~S>>>0,d=~d>>>0,4294967295<++d&&(d=0,4294967295<++S&&(S=0))),new I(d,S)},I.from=function(S){if(typeof S=="number")return I.fromNumber(S);if(T.isString(S)){if(!T.Long)return I.fromNumber(parseInt(S,10));S=T.Long.fromString(S)}return S.low||S.high?new I(S.low>>>0,S.high>>>0):p},I.prototype.toNumber=function(S){var f;return!S&&this.hi>>>31?(S=1+~this.lo>>>0,f=~this.hi>>>0,-(S+4294967296*(f=S?f:f+1>>>0))):this.lo+4294967296*this.hi},I.prototype.toLong=function(S){return T.Long?new T.Long(0|this.lo,0|this.hi,!!S):{low:0|this.lo,high:0|this.hi,unsigned:!!S}},String.prototype.charCodeAt);I.fromHash=function(S){return S==="\0\0\0\0\0\0\0\0"?p:new I((k.call(S,0)|k.call(S,1)<<8|k.call(S,2)<<16|k.call(S,3)<<24)>>>0,(k.call(S,4)|k.call(S,5)<<8|k.call(S,6)<<16|k.call(S,7)<<24)>>>0)},I.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},I.prototype.zzEncode=function(){var S=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^S)>>>0,this.lo=(this.lo<<1^S)>>>0,this},I.prototype.zzDecode=function(){var S=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^S)>>>0,this.hi=(this.hi>>>1^S)>>>0,this},I.prototype.length=function(){var S=this.lo,f=(this.lo>>>28|this.hi<<4)>>>0,d=this.hi>>>24;return d==0?f==0?S<16384?S<128?1:2:S<2097152?3:4:f<16384?f<128?5:6:f<2097152?7:8:d<128?9:10}},function(Q,O,b){Q.exports=p;var T=b(24),I=((p.prototype=Object.create(T.prototype)).constructor=p,b(10));function p(){T.call(this)}function k(S,f,d){S.length<40?I.utf8.write(S,f,d):f.utf8Write?f.utf8Write(S,d):f.write(S,d)}p._configure=function(){p.alloc=I._Buffer_allocUnsafe,p.writeBytesBuffer=I.Buffer&&I.Buffer.prototype instanceof Uint8Array&&I.Buffer.prototype.set.name==="set"?function(S,f,d){f.set(S,d)}:function(S,f,d){if(S.copy)S.copy(f,d,0,S.length);else for(var o=0;o<S.length;)f[d++]=S[o++]}},p.prototype.bytes=function(S){var f=(S=I.isString(S)?I._Buffer_from(S,"base64"):S).length>>>0;return this.uint32(f),f&&this._push(p.writeBytesBuffer,f,S),this},p.prototype.string=function(S){var f=I.Buffer.byteLength(S);return this.uint32(f),f&&this._push(k,f,S),this},p._configure()},function(Q,O,b){Q.exports=p;var T=b(25),I=((p.prototype=Object.create(T.prototype)).constructor=p,b(10));function p(k){T.call(this,k)}p._configure=function(){I.Buffer&&(p.prototype._slice=I.Buffer.prototype.slice)},p.prototype.string=function(){var k=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+k,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+k,this.len))},p._configure()},function(Q,O,b){O.Service=b(109)},function(Q,O,b){Q.exports=I;var T=b(10);function I(p,k,S){if(typeof p!="function")throw TypeError("rpcImpl must be a function");T.EventEmitter.call(this),this.rpcImpl=p,this.requestDelimited=!!k,this.responseDelimited=!!S}((I.prototype=Object.create(T.EventEmitter.prototype)).constructor=I).prototype.rpcCall=function p(k,S,f,d,o){if(!d)throw TypeError("request must be specified");var c=this;if(!o)return T.asPromise(p,c,k,S,f,d);if(c.rpcImpl)try{return c.rpcImpl(k,S[c.requestDelimited?"encodeDelimited":"encode"](d).finish(),function(r,t){if(r)return c.emit("error",r,k),o(r);if(t!==null){if(!(t instanceof f))try{t=f[c.responseDelimited?"decodeDelimited":"decode"](t)}catch(n){return c.emit("error",n,k),o(n)}return c.emit("data",t,k),o(null,t)}c.end(!0)})}catch(r){return c.emit("error",r,k),void setTimeout(function(){o(r)},0)}else setTimeout(function(){o(Error("already ended"))},0)},I.prototype.end=function(p){return this.rpcImpl&&(p||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(Q,O,b){Q.exports={}},function(Q,O,b){var T={"./ZIMFileStoreBase":40,"./ZIMFileStoreBase.ts":40,"./ZIMFileStoreImpl":41,"./ZIMFileStoreImpl.ts":41,"./ZIMIDBImpl":42,"./ZIMIDBImpl.ts":42};function I(k){return k=p(k),b(k)}function p(k){if(b.o(T,k))return T[k];throw(k=new Error("Cannot find module '"+k+"'")).code="MODULE_NOT_FOUND",k}I.keys=function(){return Object.keys(T)},I.resolve=p,(Q.exports=I).id=111},function(Q,O,b){var T={"./formdata":44,"./formdata.ts":44,"./zego.fileHandler":45,"./zego.fileHandler.ts":45,"./zego.storeHandler":46,"./zego.storeHandler.ts":46};function I(k){return k=p(k),b(k)}function p(k){if(b.o(T,k))return T[k];throw(k=new Error("Cannot find module '"+k+"'")).code="MODULE_NOT_FOUND",k}I.keys=function(){return Object.keys(T)},I.resolve=p,(Q.exports=I).id=112},function(Q,O,b){(function(T){var I=b(114),p=b(115),k=b(116);function S(){return d.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(A,v){if(S()<v)throw new RangeError("Invalid typed array length");return d.TYPED_ARRAY_SUPPORT?(A=new Uint8Array(v)).__proto__=d.prototype:(A=A===null?new d(v):A).length=v,A}function d(A,v,E){if(!(d.TYPED_ARRAY_SUPPORT||this instanceof d))return new d(A,v,E);if(typeof A!="number")return o(this,A,v,E);if(typeof v=="string")throw new Error("If encoding is specified then the first argument must be a string");return r(this,A)}function o(A,v,E,N){if(typeof v=="number")throw new TypeError('"value" argument must not be a number');if(typeof ArrayBuffer<"u"&&v instanceof ArrayBuffer){var P=A,H=v,V=E;if(H.byteLength,V<0||H.byteLength<V)throw new RangeError("'offset' is out of bounds");if(H.byteLength<V+(N||0))throw new RangeError("'length' is out of bounds");return H=V===void 0&&N===void 0?new Uint8Array(H):N===void 0?new Uint8Array(H,V):new Uint8Array(H,V,N),d.TYPED_ARRAY_SUPPORT?(P=H).__proto__=d.prototype:P=t(P,H),P}if(typeof v!="string"){if(V=A,N=v,d.isBuffer(N))return(V=f(V,H=0|n(N.length))).length===0||N.copy(V,0,0,H),V;if(N){if(typeof ArrayBuffer<"u"&&N.buffer instanceof ArrayBuffer||"length"in N)return typeof N.length!="number"||function(W){return W!=W}(N.length)?f(V,0):t(V,N);if(N.type==="Buffer"&&k(N.data))return t(V,N.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}if(P=A,N=v,A=E,!d.isEncoding(A=typeof A=="string"&&A!==""?A:"utf8"))throw new TypeError('"encoding" must be a valid string encoding');return(N=(P=f(P,v=0|s(N,A))).write(N,A))!==v?P.slice(0,N):P}function c(A){if(typeof A!="number")throw new TypeError('"size" argument must be a number');if(A<0)throw new RangeError('"size" argument must not be negative')}function r(A,v){if(c(v),A=f(A,v<0?0:0|n(v)),!d.TYPED_ARRAY_SUPPORT)for(var E=0;E<v;++E)A[E]=0;return A}function t(A,v){var E=v.length<0?0:0|n(v.length);A=f(A,E);for(var N=0;N<E;N+=1)A[N]=255&v[N];return A}function n(A){if(A>=S())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+S().toString(16)+" bytes");return 0|A}function s(A,v){if(d.isBuffer(A))return A.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(A)||A instanceof ArrayBuffer))return A.byteLength;var E=(A=typeof A!="string"?""+A:A).length;if(E===0)return 0;for(var N=!1;;)switch(v){case"ascii":case"latin1":case"binary":return E;case"utf8":case"utf-8":case void 0:return J(A).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*E;case"hex":return E>>>1;case"base64":return K(A).length;default:if(N)return J(A).length;v=(""+v).toLowerCase(),N=!0}}function u(A,v,E){var N,P=!1;if((v=v===void 0||v<0?0:v)>this.length||(E=E===void 0||E>this.length?this.length:E)<=0||(E>>>=0)<=(v>>>=0))return"";for(A=A||"utf8";;)switch(A){case"hex":var H=v,V=E,W=this.length;(!V||V<0||W<V)&&(V=W);for(var B="",$=H=!H||H<0?0:H;$<V;++$)B+=function(ve){return ve<16?"0"+ve.toString(16):ve.toString(16)}(this[$]);return B;case"utf8":case"utf-8":return g(this,v,E);case"ascii":W=v;var X=E,ne="";X=Math.min(this.length,X);for(var oe=W;oe<X;++oe)ne+=String.fromCharCode(127&this[oe]);return ne;case"latin1":case"binary":H=v;var ie=E,ue="";ie=Math.min(this.length,ie);for(var pe=H;pe<ie;++pe)ue+=String.fromCharCode(this[pe]);return ue;case"base64":return de=this,N=E,(_e=v)===0&&N===de.length?I.fromByteArray(de):I.fromByteArray(de.slice(_e,N));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var de=v,_e=E,le=this.slice(de,_e),be="",ge=0;ge<le.length;ge+=2)be+=String.fromCharCode(le[ge]+256*le[ge+1]);return be;default:if(P)throw new TypeError("Unknown encoding: "+A);A=(A+"").toLowerCase(),P=!0}}function a(A,v,E){var N=A[v];A[v]=A[E],A[E]=N}function i(A,v,E,N,P){if(A.length===0)return-1;if(typeof E=="string"?(N=E,E=0):2147483647<E?E=2147483647:E<-2147483648&&(E=-2147483648),E=+E,(E=(E=isNaN(E)?P?0:A.length-1:E)<0?A.length+E:E)>=A.length){if(P)return-1;E=A.length-1}else if(E<0){if(!P)return-1;E=0}if(typeof v=="string"&&(v=d.from(v,N)),d.isBuffer(v))return v.length===0?-1:l(A,v,E,N,P);if(typeof v=="number")return v&=255,d.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?(P?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(A,v,E):l(A,[v],E,N,P);throw new TypeError("val must be string, number or Buffer")}function l(A,v,E,N,P){var H=1,V=A.length,W=v.length;if(N!==void 0&&((N=String(N).toLowerCase())==="ucs2"||N==="ucs-2"||N==="utf16le"||N==="utf-16le")){if(A.length<2||v.length<2)return-1;V/=H=2,W/=2,E/=2}function B(ie,ue){return H===1?ie[ue]:ie.readUInt16BE(ue*H)}if(P)for(var $=-1,X=E;X<V;X++)if(B(A,X)===B(v,$===-1?0:X-$)){if(X-($=$===-1?X:$)+1===W)return $*H}else $!==-1&&(X-=X-$),$=-1;else for(X=E=V<E+W?V-W:E;0<=X;X--){for(var ne=!0,oe=0;oe<W;oe++)if(B(A,X+oe)!==B(v,oe)){ne=!1;break}if(ne)return X}return-1}function h(A,v,E,N){return ee(function(P){for(var H=[],V=0;V<P.length;++V)H.push(255&P.charCodeAt(V));return H}(v),A,E,N)}function m(A,v,E,N){return ee(function(P,H){for(var V,W,B=[],$=0;$<P.length&&!((H-=2)<0);++$)V=(W=P.charCodeAt($))>>8,W%=256,B.push(W),B.push(V);return B}(v,A.length-E),A,E,N)}function g(A,v,E){E=Math.min(A.length,E);for(var N=[],P=v;P<E;){var H,V,W,B,$=A[P],X=null,ne=239<$?4:223<$?3:191<$?2:1;if(P+ne<=E)switch(ne){case 1:$<128&&(X=$);break;case 2:(192&(H=A[P+1]))==128&&127<(B=(31&$)<<6|63&H)&&(X=B);break;case 3:H=A[P+1],V=A[P+2],(192&H)==128&&(192&V)==128&&2047<(B=(15&$)<<12|(63&H)<<6|63&V)&&(B<55296||57343<B)&&(X=B);break;case 4:H=A[P+1],V=A[P+2],W=A[P+3],(192&H)==128&&(192&V)==128&&(192&W)==128&&65535<(B=(15&$)<<18|(63&H)<<12|(63&V)<<6|63&W)&&B<1114112&&(X=B)}X===null?(X=65533,ne=1):65535<X&&(X-=65536,N.push(X>>>10&1023|55296),X=56320|1023&X),N.push(X),P+=ne}var oe=N,ie=oe.length;if(ie<=y)return String.fromCharCode.apply(String,oe);for(var ue="",pe=0;pe<ie;)ue+=String.fromCharCode.apply(String,oe.slice(pe,pe+=y));return ue}O.Buffer=d,O.SlowBuffer=function(A){return+A!=A&&(A=0),d.alloc(+A)},O.INSPECT_MAX_BYTES=50,d.TYPED_ARRAY_SUPPORT=T.TYPED_ARRAY_SUPPORT!==void 0?T.TYPED_ARRAY_SUPPORT:function(){try{var A=new Uint8Array(1);return A.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},A.foo()===42&&typeof A.subarray=="function"&&A.subarray(1,1).byteLength===0}catch{return!1}}(),O.kMaxLength=S(),d.poolSize=8192,d._augment=function(A){return A.__proto__=d.prototype,A},d.from=function(A,v,E){return o(null,A,v,E)},d.TYPED_ARRAY_SUPPORT&&(d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0})),d.alloc=function(A,v,E){return N=null,v=v,E=E,c(A=A),A<=0||v===void 0?f(N,A):typeof E=="string"?f(N,A).fill(v,E):f(N,A).fill(v);var N},d.allocUnsafe=function(A){return r(null,A)},d.allocUnsafeSlow=function(A){return r(null,A)},d.isBuffer=function(A){return!(A==null||!A._isBuffer)},d.compare=function(A,v){if(!d.isBuffer(A)||!d.isBuffer(v))throw new TypeError("Arguments must be Buffers");if(A===v)return 0;for(var E=A.length,N=v.length,P=0,H=Math.min(E,N);P<H;++P)if(A[P]!==v[P]){E=A[P],N=v[P];break}return E<N?-1:N<E?1:0},d.isEncoding=function(A){switch(String(A).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(A,v){if(!k(A))throw new TypeError('"list" argument must be an Array of Buffers');if(A.length===0)return d.alloc(0);if(v===void 0)for(P=v=0;P<A.length;++P)v+=A[P].length;for(var E=d.allocUnsafe(v),N=0,P=0;P<A.length;++P){var H=A[P];if(!d.isBuffer(H))throw new TypeError('"list" argument must be an Array of Buffers');H.copy(E,N),N+=H.length}return E},d.byteLength=s,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var A=this.length;if(A%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var v=0;v<A;v+=2)a(this,v,v+1);return this},d.prototype.swap32=function(){var A=this.length;if(A%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var v=0;v<A;v+=4)a(this,v,v+3),a(this,v+1,v+2);return this},d.prototype.swap64=function(){var A=this.length;if(A%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var v=0;v<A;v+=8)a(this,v,v+7),a(this,v+1,v+6),a(this,v+2,v+5),a(this,v+3,v+4);return this},d.prototype.toString=function(){var A=0|this.length;return A==0?"":arguments.length===0?g(this,0,A):u.apply(this,arguments)},d.prototype.equals=function(A){if(d.isBuffer(A))return this===A||d.compare(this,A)===0;throw new TypeError("Argument must be a Buffer")},d.prototype.inspect=function(){var A="",v=O.INSPECT_MAX_BYTES;return 0<this.length&&(A=this.toString("hex",0,v).match(/.{2}/g).join(" "),this.length>v&&(A+=" ... ")),"<Buffer "+A+">"},d.prototype.compare=function(A,v,E,N,P){if(!d.isBuffer(A))throw new TypeError("Argument must be a Buffer");if(E===void 0&&(E=A?A.length:0),N===void 0&&(N=0),P===void 0&&(P=this.length),(v=v===void 0?0:v)<0||E>A.length||N<0||P>this.length)throw new RangeError("out of range index");if(P<=N&&E<=v)return 0;if(P<=N)return-1;if(E<=v)return 1;if(this===A)return 0;for(var H=(P>>>=0)-(N>>>=0),V=(E>>>=0)-(v>>>=0),W=Math.min(H,V),B=this.slice(N,P),$=A.slice(v,E),X=0;X<W;++X)if(B[X]!==$[X]){H=B[X],V=$[X];break}return H<V?-1:V<H?1:0},d.prototype.includes=function(A,v,E){return this.indexOf(A,v,E)!==-1},d.prototype.indexOf=function(A,v,E){return i(this,A,v,E,!0)},d.prototype.lastIndexOf=function(A,v,E){return i(this,A,v,E,!1)},d.prototype.write=function(A,v,E,N){if(v===void 0)N="utf8",E=this.length,v=0;else if(E===void 0&&typeof v=="string")N=v,E=this.length,v=0;else{if(!isFinite(v))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");v|=0,isFinite(E)?(E|=0,N===void 0&&(N="utf8")):(N=E,E=void 0)}var P=this.length-v;if((E===void 0||P<E)&&(E=P),0<A.length&&(E<0||v<0)||v>this.length)throw new RangeError("Attempt to write outside buffer bounds");N=N||"utf8";for(var H,V,W,B=!1;;)switch(N){case"hex":var $=A,X=v,ne=E,oe=(X=Number(X)||0,this.length-X);if((!ne||oe<(ne=Number(ne)))&&(ne=oe),(oe=$.length)%2!=0)throw new TypeError("Invalid hex string");oe/2<ne&&(ne=oe/2);for(var ie=0;ie<ne;++ie){var ue=parseInt($.substr(2*ie,2),16);if(isNaN(ue))return ie;this[X+ie]=ue}return ie;case"utf8":case"utf-8":return oe=v,W=E,ee(J(A,(V=this).length-oe),V,oe,W);case"ascii":return h(this,A,v,E);case"latin1":case"binary":return h(this,A,v,E);case"base64":return V=this,W=v,H=E,ee(K(A),V,W,H);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m(this,A,v,E);default:if(B)throw new TypeError("Unknown encoding: "+N);N=(""+N).toLowerCase(),B=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var y=4096;function w(A,v,E){if(A%1!=0||A<0)throw new RangeError("offset is not uint");if(E<A+v)throw new RangeError("Trying to access beyond buffer length")}function M(A,v,E,N,P,H){if(!d.isBuffer(A))throw new TypeError('"buffer" argument must be a Buffer instance');if(P<v||v<H)throw new RangeError('"value" argument is out of bounds');if(E+N>A.length)throw new RangeError("Index out of range")}function R(A,v,E,N){v<0&&(v=65535+v+1);for(var P=0,H=Math.min(A.length-E,2);P<H;++P)A[E+P]=(v&255<<8*(N?P:1-P))>>>8*(N?P:1-P)}function D(A,v,E,N){v<0&&(v=4294967295+v+1);for(var P=0,H=Math.min(A.length-E,4);P<H;++P)A[E+P]=v>>>8*(N?P:3-P)&255}function q(A,v,E,N){if(E+N>A.length)throw new RangeError("Index out of range");if(E<0)throw new RangeError("Index out of range")}function L(A,v,E,N,P){return P||q(A,0,E,4),p.write(A,v,E,N,23,4),E+4}function j(A,v,E,N,P){return P||q(A,0,E,8),p.write(A,v,E,N,52,8),E+8}d.prototype.slice=function(A,v){var E=this.length;if((A=~~A)<0?(A+=E)<0&&(A=0):E<A&&(A=E),(v=v===void 0?E:~~v)<0?(v+=E)<0&&(v=0):E<v&&(v=E),v<A&&(v=A),d.TYPED_ARRAY_SUPPORT)(P=this.subarray(A,v)).__proto__=d.prototype;else for(var N=v-A,P=new d(N,void 0),H=0;H<N;++H)P[H]=this[H+A];return P},d.prototype.readUIntLE=function(A,v,E){A|=0,v|=0,E||w(A,v,this.length);for(var N=this[A],P=1,H=0;++H<v&&(P*=256);)N+=this[A+H]*P;return N},d.prototype.readUIntBE=function(A,v,E){A|=0,v|=0,E||w(A,v,this.length);for(var N=this[A+--v],P=1;0<v&&(P*=256);)N+=this[A+--v]*P;return N},d.prototype.readUInt8=function(A,v){return v||w(A,1,this.length),this[A]},d.prototype.readUInt16LE=function(A,v){return v||w(A,2,this.length),this[A]|this[A+1]<<8},d.prototype.readUInt16BE=function(A,v){return v||w(A,2,this.length),this[A]<<8|this[A+1]},d.prototype.readUInt32LE=function(A,v){return v||w(A,4,this.length),(this[A]|this[A+1]<<8|this[A+2]<<16)+16777216*this[A+3]},d.prototype.readUInt32BE=function(A,v){return v||w(A,4,this.length),16777216*this[A]+(this[A+1]<<16|this[A+2]<<8|this[A+3])},d.prototype.readIntLE=function(A,v,E){A|=0,v|=0,E||w(A,v,this.length);for(var N=this[A],P=1,H=0;++H<v&&(P*=256);)N+=this[A+H]*P;return(P*=128)<=N&&(N-=Math.pow(2,8*v)),N},d.prototype.readIntBE=function(A,v,E){A|=0,v|=0,E||w(A,v,this.length);for(var N=v,P=1,H=this[A+--N];0<N&&(P*=256);)H+=this[A+--N]*P;return(P*=128)<=H&&(H-=Math.pow(2,8*v)),H},d.prototype.readInt8=function(A,v){return v||w(A,1,this.length),128&this[A]?-1*(255-this[A]+1):this[A]},d.prototype.readInt16LE=function(A,v){return v||w(A,2,this.length),32768&(v=this[A]|this[A+1]<<8)?4294901760|v:v},d.prototype.readInt16BE=function(A,v){return v||w(A,2,this.length),32768&(v=this[A+1]|this[A]<<8)?4294901760|v:v},d.prototype.readInt32LE=function(A,v){return v||w(A,4,this.length),this[A]|this[A+1]<<8|this[A+2]<<16|this[A+3]<<24},d.prototype.readInt32BE=function(A,v){return v||w(A,4,this.length),this[A]<<24|this[A+1]<<16|this[A+2]<<8|this[A+3]},d.prototype.readFloatLE=function(A,v){return v||w(A,4,this.length),p.read(this,A,!0,23,4)},d.prototype.readFloatBE=function(A,v){return v||w(A,4,this.length),p.read(this,A,!1,23,4)},d.prototype.readDoubleLE=function(A,v){return v||w(A,8,this.length),p.read(this,A,!0,52,8)},d.prototype.readDoubleBE=function(A,v){return v||w(A,8,this.length),p.read(this,A,!1,52,8)},d.prototype.writeUIntLE=function(A,v,E,N){A=+A,v|=0,E|=0,N||M(this,A,v,E,Math.pow(2,8*E)-1,0);var P=1,H=0;for(this[v]=255&A;++H<E&&(P*=256);)this[v+H]=A/P&255;return v+E},d.prototype.writeUIntBE=function(A,v,E,N){A=+A,v|=0,E|=0,N||M(this,A,v,E,Math.pow(2,8*E)-1,0);var P=E-1,H=1;for(this[v+P]=255&A;0<=--P&&(H*=256);)this[v+P]=A/H&255;return v+E},d.prototype.writeUInt8=function(A,v,E){return A=+A,v|=0,E||M(this,A,v,1,255,0),d.TYPED_ARRAY_SUPPORT||(A=Math.floor(A)),this[v]=255&A,v+1},d.prototype.writeUInt16LE=function(A,v,E){return A=+A,v|=0,E||M(this,A,v,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[v]=255&A,this[v+1]=A>>>8):R(this,A,v,!0),v+2},d.prototype.writeUInt16BE=function(A,v,E){return A=+A,v|=0,E||M(this,A,v,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[v]=A>>>8,this[v+1]=255&A):R(this,A,v,!1),v+2},d.prototype.writeUInt32LE=function(A,v,E){return A=+A,v|=0,E||M(this,A,v,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[v+3]=A>>>24,this[v+2]=A>>>16,this[v+1]=A>>>8,this[v]=255&A):D(this,A,v,!0),v+4},d.prototype.writeUInt32BE=function(A,v,E){return A=+A,v|=0,E||M(this,A,v,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[v]=A>>>24,this[v+1]=A>>>16,this[v+2]=A>>>8,this[v+3]=255&A):D(this,A,v,!1),v+4},d.prototype.writeIntLE=function(A,v,E,N){A=+A,v|=0,N||M(this,A,v,E,(N=Math.pow(2,8*E-1))-1,-N);var P=0,H=1,V=0;for(this[v]=255&A;++P<E&&(H*=256);)A<0&&V===0&&this[v+P-1]!==0&&(V=1),this[v+P]=(A/H>>0)-V&255;return v+E},d.prototype.writeIntBE=function(A,v,E,N){A=+A,v|=0,N||M(this,A,v,E,(N=Math.pow(2,8*E-1))-1,-N);var P=E-1,H=1,V=0;for(this[v+P]=255&A;0<=--P&&(H*=256);)A<0&&V===0&&this[v+P+1]!==0&&(V=1),this[v+P]=(A/H>>0)-V&255;return v+E},d.prototype.writeInt8=function(A,v,E){return A=+A,v|=0,E||M(this,A,v,1,127,-128),d.TYPED_ARRAY_SUPPORT||(A=Math.floor(A)),this[v]=255&(A=A<0?255+A+1:A),v+1},d.prototype.writeInt16LE=function(A,v,E){return A=+A,v|=0,E||M(this,A,v,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[v]=255&A,this[v+1]=A>>>8):R(this,A,v,!0),v+2},d.prototype.writeInt16BE=function(A,v,E){return A=+A,v|=0,E||M(this,A,v,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[v]=A>>>8,this[v+1]=255&A):R(this,A,v,!1),v+2},d.prototype.writeInt32LE=function(A,v,E){return A=+A,v|=0,E||M(this,A,v,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[v]=255&A,this[v+1]=A>>>8,this[v+2]=A>>>16,this[v+3]=A>>>24):D(this,A,v,!0),v+4},d.prototype.writeInt32BE=function(A,v,E){return A=+A,v|=0,E||M(this,A,v,4,2147483647,-2147483648),A<0&&(A=4294967295+A+1),d.TYPED_ARRAY_SUPPORT?(this[v]=A>>>24,this[v+1]=A>>>16,this[v+2]=A>>>8,this[v+3]=255&A):D(this,A,v,!1),v+4},d.prototype.writeFloatLE=function(A,v,E){return L(this,A,v,!0,E)},d.prototype.writeFloatBE=function(A,v,E){return L(this,A,v,!1,E)},d.prototype.writeDoubleLE=function(A,v,E){return j(this,A,v,!0,E)},d.prototype.writeDoubleBE=function(A,v,E){return j(this,A,v,!1,E)},d.prototype.copy=function(A,v,E,N){if(E=E||0,N||N===0||(N=this.length),v>=A.length&&(v=A.length),(N=0<N&&N<E?E:N)===E||A.length===0||this.length===0)return 0;if((v=v||0)<0)throw new RangeError("targetStart out of bounds");if(E<0||E>=this.length)throw new RangeError("sourceStart out of bounds");if(N<0)throw new RangeError("sourceEnd out of bounds");N>this.length&&(N=this.length);var P,H=(N=A.length-v<N-E?A.length-v+E:N)-E;if(this===A&&E<v&&v<N)for(P=H-1;0<=P;--P)A[P+v]=this[P+E];else if(H<1e3||!d.TYPED_ARRAY_SUPPORT)for(P=0;P<H;++P)A[P+v]=this[P+E];else Uint8Array.prototype.set.call(A,this.subarray(E,E+H),v);return H},d.prototype.fill=function(A,v,E,N){if(typeof A=="string"){var P;if(typeof v=="string"?(N=v,v=0,E=this.length):typeof E=="string"&&(N=E,E=this.length),A.length!==1||(P=A.charCodeAt(0))<256&&(A=P),N!==void 0&&typeof N!="string")throw new TypeError("encoding must be a string");if(typeof N=="string"&&!d.isEncoding(N))throw new TypeError("Unknown encoding: "+N)}else typeof A=="number"&&(A&=255);if(v<0||this.length<v||this.length<E)throw new RangeError("Out of range index");if(E<=v)return this;if(v>>>=0,E=E===void 0?this.length:E>>>0,typeof(A=A||0)=="number")for(W=v;W<E;++W)this[W]=A;else for(var H=d.isBuffer(A)?A:J(new d(A,N).toString()),V=H.length,W=0;W<E-v;++W)this[W+v]=H[W%V];return this};var G=/[^+\/0-9A-Za-z-_]/g;function J(A,v){v=v||1/0;for(var E,N=A.length,P=null,H=[],V=0;V<N;++V){if(55295<(E=A.charCodeAt(V))&&E<57344){if(!P){if(56319<E){-1<(v-=3)&&H.push(239,191,189);continue}if(V+1===N){-1<(v-=3)&&H.push(239,191,189);continue}P=E;continue}if(E<56320){-1<(v-=3)&&H.push(239,191,189),P=E;continue}E=65536+(P-55296<<10|E-56320)}else P&&-1<(v-=3)&&H.push(239,191,189);if(P=null,E<128){if(--v<0)break;H.push(E)}else if(E<2048){if((v-=2)<0)break;H.push(E>>6|192,63&E|128)}else if(E<65536){if((v-=3)<0)break;H.push(E>>12|224,E>>6&63|128,63&E|128)}else{if(!(E<1114112))throw new Error("Invalid code point");if((v-=4)<0)break;H.push(E>>18|240,E>>12&63|128,E>>6&63|128,63&E|128)}}return H}function K(A){return I.toByteArray(function(v){var E;if((v=((E=v).trim?E.trim():E.replace(/^\s+|\s+$/g,"")).replace(G,"")).length<2)return"";for(;v.length%4!=0;)v+="=";return v}(A))}function ee(A,v,E,N){for(var P=0;P<N&&!(P+E>=v.length||P>=A.length);++P)v[P+E]=A[P];return P}}).call(this,b(12))},function(Q,O,b){O.byteLength=function(o){return 3*((o=d(o))[0]+(o=o[1]))/4-o},O.toByteArray=function(o){var c,r,t=(n=d(o))[0],n=n[1],s=new p(function(i,l){return 3*(i+l)/4-l}(t,n)),u=0,a=0<n?t-4:t;for(r=0;r<a;r+=4)c=I[o.charCodeAt(r)]<<18|I[o.charCodeAt(r+1)]<<12|I[o.charCodeAt(r+2)]<<6|I[o.charCodeAt(r+3)],s[u++]=c>>16&255,s[u++]=c>>8&255,s[u++]=255&c;return n===2&&(c=I[o.charCodeAt(r)]<<2|I[o.charCodeAt(r+1)]>>4,s[u++]=255&c),n===1&&(c=I[o.charCodeAt(r)]<<10|I[o.charCodeAt(r+1)]<<4|I[o.charCodeAt(r+2)]>>2,s[u++]=c>>8&255,s[u++]=255&c),s},O.fromByteArray=function(o){for(var c,r=o.length,t=r%3,n=[],s=0,u=r-t;s<u;s+=16383)n.push(function(a,i,l){for(var h,m=[],g=i;g<l;g+=3)h=(a[g]<<16&16711680)+(a[g+1]<<8&65280)+(255&a[g+2]),m.push(function(y){return T[y>>18&63]+T[y>>12&63]+T[y>>6&63]+T[63&y]}(h));return m.join("")}(o,s,u<s+16383?u:s+16383));return t==1?(c=o[r-1],n.push(T[c>>2]+T[c<<4&63]+"==")):t==2&&(c=(o[r-2]<<8)+o[r-1],n.push(T[c>>10]+T[c>>4&63]+T[c<<2&63]+"=")),n.join("")};for(var T=[],I=[],p=typeof Uint8Array<"u"?Uint8Array:Array,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S=0,f=k.length;S<f;++S)T[S]=k[S],I[k.charCodeAt(S)]=S;function d(o){var c=o.length;if(0<c%4)throw new Error("Invalid string. Length must be a multiple of 4");return c=(o=(o=o.indexOf("="))===-1?c:o)===c?0:4-o%4,[o,c]}I["-".charCodeAt(0)]=62,I["_".charCodeAt(0)]=63},function(Q,O){O.read=function(b,T,I,p,k){var S,f,d=8*k-p-1,o=(1<<d)-1,c=o>>1,r=-7,t=I?k-1:0,n=I?-1:1;for(k=b[T+t],t+=n,S=k&(1<<-r)-1,k>>=-r,r+=d;0<r;S=256*S+b[T+t],t+=n,r-=8);for(f=S&(1<<-r)-1,S>>=-r,r+=p;0<r;f=256*f+b[T+t],t+=n,r-=8);if(S===0)S=1-c;else{if(S===o)return f?NaN:1/0*(k?-1:1);f+=Math.pow(2,p),S-=c}return(k?-1:1)*f*Math.pow(2,S-p)},O.write=function(b,T,I,p,k,S){var f,d,o=8*S-k-1,c=(1<<o)-1,r=c>>1,t=k===23?Math.pow(2,-24)-Math.pow(2,-77):0,n=p?0:S-1,s=p?1:-1;for(S=T<0||T===0&&1/T<0?1:0,T=Math.abs(T),isNaN(T)||T===1/0?(d=isNaN(T)?1:0,f=c):(f=Math.floor(Math.log(T)/Math.LN2),T*(p=Math.pow(2,-f))<1&&(f--,p*=2),2<=(T+=1<=f+r?t/p:t*Math.pow(2,1-r))*p&&(f++,p/=2),c<=f+r?(d=0,f=c):1<=f+r?(d=(T*p-1)*Math.pow(2,k),f+=r):(d=T*Math.pow(2,r-1)*Math.pow(2,k),f=0));8<=k;b[I+n]=255&d,n+=s,d/=256,k-=8);for(f=f<<k|d,o+=k;0<o;b[I+n]=255&f,n+=s,f/=256,o-=8);b[I+n-s]|=128*S}},function(Q,O){var b={}.toString;Q.exports=Array.isArray||function(T){return b.call(T)=="[object Array]"}},function(Q,O,b){(function(T){var I=T!==void 0&&T||typeof self<"u"&&self||window,p=Function.prototype.apply;function k(S,f){this._id=S,this._clearFn=f}O.setTimeout=function(){return new k(p.call(setTimeout,I,arguments),clearTimeout)},O.setInterval=function(){return new k(p.call(setInterval,I,arguments),clearInterval)},O.clearTimeout=O.clearInterval=function(S){S&&S.close()},k.prototype.unref=k.prototype.ref=function(){},k.prototype.close=function(){this._clearFn.call(I,this._id)},O.enroll=function(S,f){clearTimeout(S._idleTimeoutId),S._idleTimeout=f},O.unenroll=function(S){clearTimeout(S._idleTimeoutId),S._idleTimeout=-1},O._unrefActive=O.active=function(S){clearTimeout(S._idleTimeoutId);var f=S._idleTimeout;0<=f&&(S._idleTimeoutId=setTimeout(function(){S._onTimeout&&S._onTimeout()},f))},b(118),O.setImmediate=typeof self<"u"&&self.setImmediate||T!==void 0&&T.setImmediate||this&&this.setImmediate,O.clearImmediate=typeof self<"u"&&self.clearImmediate||T!==void 0&&T.clearImmediate||this&&this.clearImmediate}).call(this,b(12))},function(Q,O,b){(function(T,I){(function(p,k){var S,f,d,o,c,r,t,n;function s(a){delete f[a]}function u(a){if(d)setTimeout(u,0,a);else{var i=f[a];if(i){d=!0;try{var l=i,h=l.callback,m=l.args;switch(m.length){case 0:h();break;case 1:h(m[0]);break;case 2:h(m[0],m[1]);break;case 3:h(m[0],m[1],m[2]);break;default:h.apply(void 0,m)}}finally{s(a),d=!1}}}}p.setImmediate||(S=1,d=!(f={}),o=p.document,n=(n=Object.getPrototypeOf&&Object.getPrototypeOf(p))&&n.setTimeout?n:p,{}.toString.call(p.process)==="[object process]"?c=function(a){I.nextTick(function(){u(a)})}:function(){var a,i;if(p.postMessage&&!p.importScripts)return a=!0,i=p.onmessage,p.onmessage=function(){a=!1},p.postMessage("","*"),p.onmessage=i,a}()?function(){function a(l){l.source===p&&typeof l.data=="string"&&l.data.indexOf(i)===0&&u(+l.data.slice(i.length))}var i="setImmediate$"+Math.random()+"$";p.addEventListener?p.addEventListener("message",a,!1):p.attachEvent("onmessage",a),c=function(l){p.postMessage(i+l,"*")}}():c=p.MessageChannel?((t=new MessageChannel).port1.onmessage=function(a){u(a.data)},function(a){t.port2.postMessage(a)}):o&&"onreadystatechange"in o.createElement("script")?(r=o.documentElement,function(a){var i=o.createElement("script");i.onreadystatechange=function(){u(a),i.onreadystatechange=null,r.removeChild(i),i=null},r.appendChild(i)}):function(a){setTimeout(u,0,a)},n.setImmediate=function(a){typeof a!="function"&&(a=new Function(""+a));for(var i=new Array(arguments.length-1),l=0;l<i.length;l++)i[l]=arguments[l+1];return f[S]={callback:a,args:i},c(S),S++},n.clearImmediate=s)})(typeof self>"u"?T===void 0?this:T:self)}).call(this,b(12),b(47))}])})})(zegoZimWeb);var zegoZimWebExports=zegoZimWeb.exports;const index=getDefaultExportFromCjs(zegoZimWebExports),index$1=_mergeNamespaces({__proto__:null,default:index},[zegoZimWebExports]);export{index$1 as i};
