import{j as t,a as _,F as N}from"./chunk-c1d16543.js";import{i as c}from"./chunk-d8234155.js";import{e as z,Z,R as v,i as y,M as p,j as g}from"./chunk-d368c681.js";import{u as J}from"./chunk-cfcc25a6.js";import{m as Y,n as Q,k,o as X,a as ee}from"./chunk-ff689da6.js";import{R as q,u as C,b as R}from"./chunk-fde55823.js";import{o as f,c as h}from"./chunk-99b8f121.js";import{r as x}from"./chunk-e9cd8943.js";import{I as P}from"./chunk-d80cdd1c.js";/* empty css              */import"./chunk-23179642.js";import{M as E}from"./chunk-61229905.js";import{W as se,a as te,w as $,b as ne,c as re}from"./chunk-e9c2c122.js";import{u as ce}from"./chunk-79739c92.js";import{S as ae}from"./chunk-86e4740a.js";import{C as A}from"./chunk-faa47c2c.js";import{f as M}from"./chunk-ec284ae6.js";function ds(e){if(!e.keyword)return t("span",{className:e.className,children:e.text});const s=e.text.toUpperCase().split((e.keyword||"").toUpperCase()).reduce((r,a,o)=>o?r.concat(e.keyword,a):[a],[]),n=s.map((r,a)=>{let o=0;for(let d=0;d<a;d+=1)o+=s[d].length;const i=e.text.slice(o,o+r.length);return r===e.keyword?t("span",{className:e.highlightClassName,children:i},`${e.keyword}${a}`):i});return t("span",{className:e.className,children:n})}const ls=e=>q({path:"/v1/im/redPackage/send",method:"POST",data:e}),oe=e=>q({path:"/v1/im/redPackage/receive",method:"POST",data:e}),T=e=>q({path:"/v1/im/redPackage/getPackageInfo",method:"GET",params:e});function ms({message:e,inConversation:s}){const n=e.direction===z.Send,r=Y(e),a=JSON.parse(e.revokeExtendedData||"{}"),o=n?c._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):`"${a.operatorName||r.fromNickname}"`,i=c._({id:"features_messenger_chat_message_revoke_kz3olsbqcf",values:{0:o}}),d=!s&&n&&e.originalMessageType===Z.Text&&e.originalTextMessageContent,{setMessageByReEdit:l}=J();return _("div",{className:"text-text_color_02",children:[t("span",{children:i}),d&&t("span",{onClick:()=>{l(e.originalTextMessageContent)},className:"ml-1 text-text_color_special_04 cursor-pointer",children:c._("features_messenger_chat_message_revoke_bdfs2yos58")})]})}const ie="red-envelope-modal-module__modal--Rd7",_e={modal:ie};function U(e){return t(E,{className:_e.modal,simple:!0,visible:e.visible,footer:null,children:_("div",{className:"content",children:[e.children,t("div",{role:"button",tabIndex:0,onClick:e.onClose,className:"close-btn",children:t(P,{fontSize:32,className:"icon text-icon_color",name:"icon_set_logout"})})]})})}const de="red-envelope-sealed-envelope-module__sealed--uYn",F={sealed:de};function j(e){const s=ce(()=>T({packageId:String(e)}),{cacheKey:`getV1ImRedPackageGetPackageInfoApiRequest-${e}`}),n=x.useRef({req:s,id:e});return n.current={req:s,id:e},x.useEffect(()=>{const r={biz:se.im,type:te.redPackageStatus},a=o=>{const{req:i,id:d}=n.current;o.packageId===String(d)&&i.refresh()};return $.subscribe({subs:r,callback:a,throttleType:ne.increment,throttleTime:re.Market}),()=>{$.unsubscribe({subs:r,callback:a})}},[]),s}function B(e){var d,l,m,u;const{onReceived:s,...n}=e,r=j(e.packageId),a=((l=(d=r.data)==null?void 0:d.data)==null?void 0:l.remark)||c._("features_messenger_chat_message_custom_red_pocket_message_hflxvdk0jj"),o=async()=>{var I;(await oe({packageId:e.packageId})).isOk&&((I=e.onReceived)==null||I.call(e))},i=(u=(m=r.data)==null?void 0:m.data)==null?void 0:u.nickName;return t(U,{...n,children:_("div",{role:"button",tabIndex:0,onClick:o,style:{backgroundImage:`url(${f}redpacket.svg)`},className:F.sealed,children:[i&&_("div",{className:"sender",children:[i,c._("features_messenger_chat_red_envelope_detail_ztxmrjfhp7")]}),t("div",{className:"bless",children:a})]})})}function le(e){var a,o;const n=(o=(a=j(e.packageId).data)==null?void 0:a.data)==null?void 0:o.nickName,{...r}=e;return t(U,{visible:!0,...r,onClose:e.onClose,children:_("div",{style:{backgroundImage:`url(${f}redpacket.svg)`},className:F.sealed,children:[_("div",{className:"sender",children:[n,c._("features_messenger_chat_red_envelope_detail_ztxmrjfhp7")]}),_("div",{className:"bless",children:[c._("features_messenger_chat_red_envelope_expired_envelope_4tqt0cmyid")," 24"," ",c._("features_messenger_chat_red_envelope_expired_envelope_8txbckapdy"),t("br",{}),c._("features_messenger_chat_message_custom_red_pocket_message_uqobfipajg")]})]})})}const me="red-envelope-opened-envelop-modal-module__opened--Feu",ue={opened:me};function ge(e){return t(E,{simple:!0,visible:!0,className:ue.opened,footer:null,children:_("div",{className:"content",style:{backgroundImage:`url(${f}opened-red-packet.svg)`},children:[t(P,{className:"icon",name:"icon_chat_close",fontSize:20,onClick:e.onClose}),e.children]})})}const fe="red-envelope-receiver-module__sender--jN3",he="red-envelope-receiver-module__receiver--sYh",ke={"sent-peer-info-modal":"red-envelope-receiver-module__sent-peer-info-modal--T0s",sender:fe,receiver:he};function pe(e){return _("div",{className:ke.receiver,children:[t("div",{className:"avatar-icon",children:t(A,{size:40,src:e.url})}),_("div",{className:h("msg",e.underline&&"border-bottom-underline","receiver-grid"),children:[t("div",{className:"name",children:e.name}),_("div",{className:"score",children:[e.score.toFixed(2)," ",c._("features_messenger_chat_red_envelope_receiver_pm1ruksqfc")]}),t("div",{className:"time",children:Q(+e.time)})]})]})}const ve="red-envelope-detail-module__sender--Hk5",xe="red-envelope-detail-module__tips--6wW",D={sender:ve,tips:xe},Ne="red-envelope-score-module__score--ZRp",be={score:Ne};function Ie(e){return _("div",{className:h(be.score,e.className),children:[_("div",{className:"score",children:[e.score.toFixed(2),t("span",{className:"points",children:c._("features_messenger_chat_red_envelope_receiver_pm1ruksqfc")})]}),_("div",{className:"link",children:[c._("features_messenger_chat_red_envelope_score_akn17fouoc")," >"]})]})}const L=x.createContext(null),Se=L.Provider;function O(e){var r;const n=(r=j(e.packageId).data)==null?void 0:r.data;return t(ge,{onClose:e.onClose,children:n?t(Se,{value:n,children:e.children}):t("div",{className:"flex justify-center",children:t(ae,{})})})}function S(){return x.useContext(L)}function W(e){var n,r,a;const s=S();return t(Ie,{className:e.className,score:(a=(r=(n=s.receiveList)==null?void 0:n.find(o=>String(o.uid)===e.uid))==null?void 0:r.receiveAmount)!=null?a:0})}function w(){var n,r;const e=S(),s=(n=e.receiveList)==null?void 0:n.length;return s?t("div",{className:"pl-6 pr-6 pt-4 pb-1",children:(r=e.receiveList)==null?void 0:r.map(a=>{var o,i;return t(pe,{underline:s>1,name:(o=a.nickName)!=null?o:"",url:a.avatarPath,time:`${a.createdByTime}`,score:(i=a.receiveAmount)!=null?i:0},a.uid)})}):null}function G(){const e=S(),s=e.remark||c._("features_messenger_chat_message_custom_red_pocket_message_hflxvdk0jj");return t("div",{className:D.sender,children:_("div",{className:"grid-box",children:[t(A,{size:30,src:e.avatarPath}),_("div",{className:"sender",children:[e.nickName,c._("features_messenger_chat_red_envelope_detail_ztxmrjfhp7")]}),t("div",{className:"bless",children:s})]})})}function ye(e){return t(N,{children:e.children(S())})}function V(){var n;const e=S();let s="";if((e==null?void 0:e.refTypeCd)==="single")switch(e.statusInd){case v.expired:s=c._("features_messenger_chat_red_envelope_detail_ceuh4nhbx6");break;default:s=c._({id:"features_messenger_chat_red_envelope_detail_8rtzqv9bjn",values:{0:e.packageAmount}});break}else switch(e.statusInd){case v.normal:s=c._({id:"features_messenger_chat_red_envelope_detail_3r_veb9eps",values:{0:e.yetCount,1:e.packageCount,2:e.residueAmount,3:e.packageAmount}});break;case v.received:s=c._({id:"features_messenger_chat_red_envelope_detail_na3lthatfp",values:{0:e.packageCount,1:Number(((n=e.complateTime)!=null?n:0)/6e3).toFixed(0)}});break;case v.expired:s=c._({id:"features_messenger_chat_red_envelope_detail_qgn_ltza3n",values:{0:e.yetCount,1:e.packageCount,2:e.residueAmount,3:e.packageAmount}});break}return t("div",{className:D.tips,children:s})}const Ce=t("div",{style:{borderBottomWidth:1},className:"border-text_color_04 border-solid mb-3 mt-3"}),H=t("div",{style:{borderBottomWidth:1},className:"border-text_color_04 border-solid"}),Re={"red-packet-message":"custom-red-pocket-message-module__red-packet-message--iNp"};function K(e){var m,u,b,I;const{data:s}=j(e.id),n=((m=s==null?void 0:s.data)==null?void 0:m.remark)||c._("features_messenger_chat_message_custom_red_pocket_message_hflxvdk0jj"),r=((u=s==null?void 0:s.data)==null?void 0:u.statusInd)===v.expired,a=((I=(b=s==null?void 0:s.data)==null?void 0:b.residueAmount)!=null?I:0)>0,o=a?`${f}red-packet-icon.svg`:`${f}opened-red-packet-icon.svg`,i=r||!a,d=e.isSelf?`${f}got-red-packet-message.svg`:`${f}message-red-packet.svg`,l=e.isSelf?`${f}send-red-packet-message-front-img.svg`:`${f}got-red-packet-message-front-img.svg`;return _("div",{className:h("relative"),role:"button",tabIndex:0,onClick:e.onClick,children:[_("div",{style:{backgroundImage:`url(${d})`},className:h("relative",Re["red-packet-message"],e.isSelf?"mr-[-6px]":"ml-[-6px]",{opened:!a||r}),children:[_("div",{className:"content",children:[t("img",{alt:"red packet",src:o,className:h("icon shrink-0")}),_("div",{className:"text-box text-ellipsis overflow-hidden whitespace-nowrap",children:[t("div",{className:"title",children:n}),t("div",{className:h("status",{"with-shadow":i}),children:a?"":c._("features_messenger_chat_message_custom_red_pocket_message_c5sdqtfpqv")})]})]}),t("div",{className:h("payment",{"with-shadow":i}),children:r?c._("features_messenger_chat_message_custom_red_pocket_message_uqobfipajg"):c._("features_messenger_chat_message_custom_red_pocket_message_panqdkltlw")})]}),(!a||r)&&t("div",{className:h(e.isSelf?"mr-[-6px]":"ml-[-6px]"),style:{backgroundImage:`url(${l})`,position:"absolute",top:0,bottom:0,left:0,right:0}})]})}function je({data:e,message:s,inConversation:n}){const r=s.direction===z.Send;return e&&!n?r?t(we,{uid:s.senderUserID,data:e}):t(Me,{data:e}):t("div",{children:c._("features_messenger_chat_message_custom_red_pocket_axvzvhydct")})}function Me(e){const{data:s}=e,[n,r]=x.useState("none"),a=C(),o=String(a.userInfo.uid);return _(N,{children:[n==="expired"&&t(le,{packageId:s.id,onClose:()=>r("none")}),n==="sealed"&&t(B,{packageId:s.id,visible:!0,onClose:()=>r("none"),onReceived:()=>r("detail")}),n==="detail"&&_(O,{packageId:s.id,onClose:()=>r("none"),children:[t(G,{}),t(W,{uid:o}),s.refTypeCd!==y.single?_(N,{children:[t("div",{className:"h-2 bg-card_bg_color_01 mt-5"}),t(V,{}),H,t(w,{})]}):_(N,{children:[Ce,t(w,{})]})]}),t(K,{id:s.id,isSelf:!1,onClick:async()=>{var d,l;const i=await T({packageId:`${s.id}`});if(i.data){if(i.data.statusInd===v.expired){s.refTypeCd===y.single?r("expired"):r("detail");return}!((l=(d=i.data)==null?void 0:d.receiveList)==null?void 0:l.some(u=>String(u.uid)===o))&&i.data.statusInd===v.normal?r("sealed"):r("detail")}}})]})}function we(e){const{data:s}=e,[n,r]=x.useState("none");return _(N,{children:[n==="detail"&&_(O,{packageId:e.data.id,onClose:()=>r("none"),children:[t(G,{}),e.data.refTypeCd!==y.single&&_(N,{children:[t(W,{uid:e.uid}),t("div",{className:"h-2 bg-card_bg_color_01 mt-5"})]}),t(V,{}),t(ye,{children:a=>{var o;return(o=a.receiveList)!=null&&o.length?H:null}}),t(w,{})]}),n==="sealed"&&t(B,{visible:!0,packageId:e.data.id,onClose:()=>r("none"),onReceived:()=>r("detail")}),t(K,{isSelf:!0,id:s.id,onClick:async()=>{const a=await T({packageId:`${e.data.id}`});if(a.data){const{selfIfReceive:o,statusInd:i}=a.data;e.data.refTypeCd===y.single?r("detail"):!o&&i===v.normal?r("sealed"):r("detail")}}})]})}function qe({data:e}){const s=R.getState().userInfo.uid,r=k(e==null?void 0:e.sendUid,s)?c._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):e==null?void 0:e.sendNickName,o=k(e==null?void 0:e.uid,s)?c._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):e==null?void 0:e.nickName,i=c._({id:"features_messenger_chat_message_custom_red_pocket_x4d_jpbmxe",values:{0:o,1:r}});return _("div",{className:"flex items-center text-text_color_02",children:[t("img",{className:"w-4 mr-1",src:`${f}image_little_red_envelope.png`,alt:""}),t("span",{className:"message-text",dangerouslySetInnerHTML:{__html:i}})]})}function Te({data:e,inConversation:s,message:n}){const r="add_friend",a=x.useRef(null),o=()=>{s||X(n==null?void 0:n.senderUserID)};return x.useEffect(()=>{const i=a.current.querySelector(`#${r}`);return i==null||i.addEventListener("click",o),()=>{i==null||i.removeEventListener("click",o)}}),c._({id:"features_messenger_chat_message_custom_send_failed_cahcplicfg",values:{0:r}}),_("span",{ref:a,children:[c._("features_messenger_chat_message_custom_send_failed_3fmj8r_hi9"),t("span",{onClick:o,id:"{0}",className:h(s?"":"text-brand_color cursor-pointer mx-px"),children:c._("features_messenger_addition_index_pngdv3umj8")}),c._("features_messenger_chat_message_custom_send_failed_pyme0grqlz")]})}const $e={[p.notFriend]:Te};function ze(e){return{[p.notFriend]:c._("features_messenger_chat_message_custom_send_failed_edc4b49rhk"),[p.youBlocked]:c._("features_messenger_chat_message_custom_send_failed_plse0q9s_f"),[p.youAreBlocked]:c._("features_messenger_chat_message_custom_send_failed_ap_lh8wrm_"),[p.otherBlocked]:c._("features_messenger_chat_message_custom_send_failed_szqwkabtkd"),[p.yourAccountBlocked]:c._("features_messenger_chat_message_custom_send_failed_ci415ki0bh"),[p.otherAccountCancelled]:c._("features_messenger_chat_message_custom_send_failed_7muom7relx"),[p.sensitiveContent]:c._("features_messenger_chat_message_custom_send_failed_djr2rsm7pd")}[e]}function Pe({data:e,...s}){const n=c._("features_messenger_chat_message_custom_send_failed_mkobftp6qr"),r=$e[e.type];return t("span",{className:"text-text_color_02 message-text",children:r?t(r,{data:e,...s}):_(N,{children:[n,c._("features_messenger_chat_message_custom_send_failed_afhp0bx_xs"),ze(e.type)]})})}function Ee({data:e}){var d,l,m;const{userInfo:s}=C(),n=(e==null?void 0:e.users)||[],a=k((d=n[0])==null?void 0:d.inviterUid,s.uid)?c._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):(l=n[0])==null?void 0:l.inviterNickName,o=n.map(u=>k(s.uid,u.uid)?c._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):u.nickName).join(c._("features_messenger_chat_message_custom_group_join_cwrwuajmcz")),i=(m=n[0])!=null&&m.isInitiative?c._({id:"features_messenger_chat_message_custom_group_join_jdhf1f4kzt",values:{0:o}}):c._({id:"features_messenger_chat_message_custom_group_join_mrcqvfb4y8",values:{0:a,1:o}});return t("span",{className:"text-text_color_02 message-text",children:i})}function Ae({data:e}){var l,m,u;const{userInfo:s}=C(),n=(e==null?void 0:e.users)||[],r=((l=n[0])==null?void 0:l.kickedUid)===s.uid,o=((m=n[0])==null?void 0:m.kickUid)===s.uid?c._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):(u=n[0])==null?void 0:u.kickUsername,i=n.map(b=>b.kickedUsername).join(c._("features_messenger_chat_message_custom_group_join_cwrwuajmcz")),d=r?c._("features_messenger_chat_message_custom_group_kick_out_gakdukoucr"):c._({id:"features_messenger_chat_message_custom_group_kick_out_0mx_re4uen",values:{0:o,1:i}});return t("span",{className:"text-text_color_02 message-text",children:d})}function Ue(e){const s=Math.floor(e/1e3),n=Math.floor(s/60),r=Math.floor(n/60),a=new Date;a.setHours(0,0,0,e);const o=M(a.getTime(),"hh"),i=M(a.getTime(),"mm"),d=M(a.getTime(),"ss"),l={0:o,1:i,2:d};return r>0?c._({id:"features_messenger_chat_message_custom_call_end_0qjzqjxq6y",values:l}):n>0?c._({id:"features_messenger_chat_message_custom_call_end_w4wzlfwzcg",values:l}):c._({id:"features_messenger_chat_message_custom_call_end_ytq9kkjcfd",values:l})}function Fe({data:e}){const n=`${c._("features_messenger_chat_message_custom_call_end_onibxwenii")}${Ue((e==null?void 0:e.time)||0)}`;return t("span",{className:"text-text_color_02 message-text",children:n})}function Be({data:e}){const{userInfo:s}=C(),r=k(e==null?void 0:e.uid,s.uid)?c._("features_messenger_chat_message_custom_group_join_tkus6zotkt"):e==null?void 0:e.nickName,a=c._({id:"features_messenger_chat_message_custom_group_exit_cahcplicfg",values:{0:r}});return t("span",{className:"text-text_color_02 message-text",children:a})}function De({data:e,message:s}){const n=k(e==null?void 0:e.applyUid,R.getState().userInfo.uid),{addressBookList:r}=ee(),a=r.find(d=>k(d.uid,s.conversationID)),o=n?e==null?void 0:e.targetNickName:e==null?void 0:e.applyNickName,i=c._({id:"features_messenger_chat_message_custom_index_36vp8jlbxc",values:{0:o||(a==null?void 0:a.friendRemark)||(a==null?void 0:a.nickName)||s.conversationID}});return t("div",{className:"message-text text-text_color_02",children:i})}function Le({message:e}){const s=c._("features_messenger_chat_message_custom_index_3yikiam465");return t("div",{className:"message-text text-text_color_02",children:s})}function Oe({message:e}){const s=c._("features_messenger_chat_message_custom_index_zyccegch3h");return t("div",{className:"message-text text-text_color_02",children:s})}function We({data:e}){const n=k(e==null?void 0:e.callCancelUserId,R.getState().userInfo.uid)?c._("features_messenger_chat_message_custom_index_nlytzmkgps"):c._("features_messenger_chat_message_custom_index_8b7fsr9ilc");return t("div",{className:"message-text text-text_color_02",children:n})}function Ge({data:e}){const n=k(e==null?void 0:e.callRejectUserId,R.getState().userInfo.uid)?c._("features_messenger_chat_message_custom_index__smd9t2fmg"):c._("features_messenger_chat_message_custom_index_walrv5icoj");return t("div",{className:"message-text text-text_color_02",children:n})}const Ve={[g.mediaZoomClosed]:Fe,[g.friendAdded]:De,[g.checkInReminder]:Le,[g.redPocket]:je,[g.redPocketReceive]:qe,[g.messageSendFail]:Pe,[g.groupBlocked]:Oe,[g.groupJoin]:Ee,[g.groupKickOut]:Ae,[g.groupExit]:Be,[g.callCancel]:We,[g.callReject]:Ge};function us({message:e,inConversation:s}){const n=Ve[e.subType],r=JSON.parse(e.message||"{}");return n?t(n,{inConversation:s,data:r,message:e}):t("div",{className:"message-text",children:c._("features_messenger_chat_message_custom_index_vhq21v00jo")})}export{us as C,ds as H,ms as R,ls as p};
