import{c as M,g as b}from"./chunk-e9cd8943.js";function x(v,w){for(var m=0;m<w.length;m++){const l=w[m];if(typeof l!="string"&&!Array.isArray(l)){for(const c in l)if(c!=="default"&&!(c in v)){const i=Object.getOwnPropertyDescriptor(l,c);i&&Object.defineProperty(v,c,i.get?i:{enumerable:!0,get:()=>l[c]})}}}return Object.freeze(Object.defineProperty(v,Symbol.toStringTag,{value:"Module"}))}var P={exports:{}};/*!
 * 
 * js-audio-recorder - js audio recorder plugin
 * 
 * @version v1.0.7
 * @homepage https://github.com/2fps/recorder
 * @author 2fps <echoweb@126.com> (https://www.zhuyuntao.cn)
 * @license MIT
 *         
 */(function(v,w){(function(m,l){v.exports=l()})(M,function(){return function(m){var l={};function c(i){if(l[i])return l[i].exports;var r=l[i]={i,l:!1,exports:{}};return m[i].call(r.exports,r,r.exports,c),r.l=!0,r.exports}return c.m=m,c.c=l,c.d=function(i,r,o){c.o(i,r)||Object.defineProperty(i,r,{enumerable:!0,get:o})},c.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},c.t=function(i,r){if(1&r&&(i=c(i)),8&r||4&r&&typeof i=="object"&&i&&i.__esModule)return i;var o=Object.create(null);if(c.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:i}),2&r&&typeof i!="string")for(var t in i)c.d(o,t,(function(n){return i[n]}).bind(null,t));return o},c.n=function(i){var r=i&&i.__esModule?function(){return i.default}:function(){return i};return c.d(r,"a",r),r},c.o=function(i,r){return Object.prototype.hasOwnProperty.call(i,r)},c.p="",c(c.s=1)}([function(m,l,c){function i(r,o,t){for(var n=0;n<t.length;n++)r.setUint8(o+n,t.charCodeAt(n))}Object.defineProperty(l,"__esModule",{value:!0}),l.compress=function(r,o,t){for(var n=o/t,d=Math.max(n,1),s=r.left,a=r.right,e=Math.floor((s.length+a.length)/n),f=new Float32Array(e),u=0,g=0;u<e;){var p=Math.floor(g);f[u]=s[p],u++,a.length&&(f[u]=a[p],u++),g+=d}return f},l.encodePCM=function(r,o,t){t===void 0&&(t=!0);var n=0,d=r.length*(o/8),s=new ArrayBuffer(d),a=new DataView(s);if(o===8)for(var e=0;e<r.length;e++,n++){var f=(u=Math.max(-1,Math.min(1,r[e])))<0?128*u:127*u;f=+f+128,a.setInt8(n,f)}else for(e=0;e<r.length;e++,n+=2){var u=Math.max(-1,Math.min(1,r[e]));a.setInt16(n,u<0?32768*u:32767*u,t)}return a},l.encodeWAV=function(r,o,t,n,d,s){s===void 0&&(s=!0);var a=t>o?o:t,e=d,f=new ArrayBuffer(44+r.byteLength),u=new DataView(f),g=n,p=0;i(u,p,"RIFF"),p+=4,u.setUint32(p,36+r.byteLength,s),i(u,p+=4,"WAVE"),i(u,p+=4,"fmt "),p+=4,u.setUint32(p,16,s),p+=4,u.setUint16(p,1,s),p+=2,u.setUint16(p,g,s),p+=2,u.setUint32(p,a,s),p+=4,u.setUint32(p,g*a*(e/8),s),p+=4,u.setUint16(p,g*(e/8),s),p+=2,u.setUint16(p,e,s),i(u,p+=2,"data"),p+=4,u.setUint32(p,r.byteLength,s),p+=4;for(var y=0;y<r.byteLength;)u.setUint8(p,r.getUint8(y)),p++,y++;return u}},function(m,l,c){var i,r=this&&this.__extends||(i=function(s,a){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,f){e.__proto__=f}||function(e,f){for(var u in f)f.hasOwnProperty(u)&&(e[u]=f[u])})(s,a)},function(s,a){function e(){this.constructor=s}i(s,a),s.prototype=a===null?Object.create(a):(e.prototype=a.prototype,new e)});Object.defineProperty(l,"__esModule",{value:!0});var o=c(2),t=c(0),n=c(3),d=function(s){function a(e){e===void 0&&(e={});var f=s.call(this,e)||this;return f.isrecording=!1,f.ispause=!1,f.isplaying=!1,f}return r(a,s),a.prototype.setOption=function(e){e===void 0&&(e={}),this.setNewOption(e)},a.prototype.start=function(){return this.isrecording?Promise.reject():(this.isrecording=!0,this.startRecord())},a.prototype.pause=function(){this.isrecording&&!this.ispause&&(this.ispause=!0,this.pauseRecord())},a.prototype.resume=function(){this.isrecording&&this.ispause&&(this.ispause=!1,this.resumeRecord())},a.prototype.stop=function(){this.isrecording&&(this.isrecording=!1,this.ispause=!1,this.stopRecord())},a.prototype.play=function(){this.stop(),this.isplaying=!0,this.onplay&&this.onplay(),n.default.addPlayEnd(this.onplayend);var e=this.getWAV();e.byteLength>44&&n.default.play(e.buffer)},a.prototype.getPlayTime=function(){return n.default.getPlayTime()},a.prototype.pausePlay=function(){!this.isrecording&&this.isplaying&&(this.isplaying=!1,this.onpauseplay&&this.onpauseplay(),n.default.pausePlay())},a.prototype.resumePlay=function(){this.isrecording||this.isplaying||(this.isplaying=!0,this.onresumeplay&&this.onresumeplay(),n.default.resumePlay())},a.prototype.stopPlay=function(){this.isrecording||(this.isplaying=!1,this.onstopplay&&this.onstopplay(),n.default.stopPlay())},a.prototype.destroy=function(){return n.default.destroyPlay(),this.destroyRecord()},a.prototype.getRecordAnalyseData=function(){return this.getAnalyseData()},a.prototype.getPlayAnalyseData=function(){return n.default.getAnalyseData()},a.prototype.getPCM=function(){this.stop();var e=this.getData();return e=t.compress(e,this.inputSampleRate,this.outputSampleRate),t.encodePCM(e,this.oututSampleBits,this.littleEdian)},a.prototype.getPCMBlob=function(){return new Blob([this.getPCM()])},a.prototype.downloadPCM=function(e){e===void 0&&(e="recorder");var f=this.getPCMBlob();o.downloadPCM(f,e)},a.prototype.getWAV=function(){var e=this.getPCM();return t.encodeWAV(e,this.inputSampleRate,this.outputSampleRate,this.config.numChannels,this.oututSampleBits,this.littleEdian)},a.prototype.getWAVBlob=function(){return new Blob([this.getWAV()],{type:"audio/wav"})},a.prototype.downloadWAV=function(e){e===void 0&&(e="recorder");var f=this.getWAVBlob();o.downloadWAV(f,e)},a.prototype.download=function(e,f,u){o.download(e,f,u)},a.prototype.getChannelData=function(){var e=this.getPCM(),f=e.byteLength,u=this.littleEdian,g={left:null,right:null};if(this.config.numChannels===2){var p=new DataView(new ArrayBuffer(f/2)),y=new DataView(new ArrayBuffer(f/2));if(this.config.sampleBits===16)for(var h=0;h<f/2;h+=2)p.setInt16(h,e.getInt16(2*h,u),u),y.setInt16(h,e.getInt16(2*h+2,u),u);else for(h=0;h<f/2;h+=2)p.setInt8(h,e.getInt8(2*h)),y.setInt8(h,e.getInt8(2*h+1));g.left=p,g.right=y}else g.left=e;return g},a}(c(5).default);l.default=d},function(m,l,c){function i(r,o,t){var n=document.createElement("a");n.href=window.URL.createObjectURL(r),n.download=o+"."+t,n.click()}Object.defineProperty(l,"__esModule",{value:!0}),l.downloadWAV=function(r,o){o===void 0&&(o="recorder"),i(r,o,"wav")},l.downloadPCM=function(r,o){o===void 0&&(o="recorder"),i(r,o,"pcm")},l.download=function(r,o,t){return i(r,o,t)}},function(m,l,c){Object.defineProperty(l,"__esModule",{value:!0});var i=c(4),r=null,o=0,t=0,n=null,d=null,s=null,a=!1,e=0,f=function(){};function u(){return a=!1,n.decodeAudioData(s.slice(0),function(y){(r=n.createBufferSource()).onended=function(){a||(e=n.currentTime-t+o,f())},r.buffer=y,r.connect(d),d.connect(n.destination),r.start(0,o),t=n.currentTime},function(y){i.throwError(y)})}function g(){r&&(r.stop(),r=null)}var p=function(){function y(){}return y.play=function(h){return n||(n=new(window.AudioContext||window.webkitAudioContext),(d=n.createAnalyser()).fftSize=2048),this.stopPlay(),s=h,e=0,u()},y.pausePlay=function(){g(),o+=n.currentTime-t,a=!0},y.resumePlay=function(){return u()},y.stopPlay=function(){o=0,s=null,g()},y.destroyPlay=function(){this.stopPlay()},y.getAnalyseData=function(){var h=new Uint8Array(d.frequencyBinCount);return d.getByteTimeDomainData(h),h},y.addPlayEnd=function(h){h===void 0&&(h=function(){}),f=h},y.getPlayTime=function(){var h=a?o:n.currentTime-t+o;return e||h},y}();l.default=p},function(m,l,c){Object.defineProperty(l,"__esModule",{value:!0}),l.throwError=function(i){throw new Error(i)}},function(m,l,c){Object.defineProperty(l,"__esModule",{value:!0});var i=c(0),r=function(){function o(t){t===void 0&&(t={}),this.size=0,this.lBuffer=[],this.rBuffer=[],this.tempPCM=[],this.inputSampleBits=16,this.fileSize=0,this.duration=0,this.needRecord=!0;var n,d=new(window.AudioContext||window.webkitAudioContext);this.inputSampleRate=d.sampleRate,this.setNewOption(t),this.littleEdian=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256),o.initUserMedia()}return o.prototype.setNewOption=function(t){t===void 0&&(t={}),this.config={sampleBits:~[8,16].indexOf(t.sampleBits)?t.sampleBits:16,sampleRate:~[8e3,11025,16e3,22050,24e3,44100,48e3].indexOf(t.sampleRate)?t.sampleRate:this.inputSampleRate,numChannels:~[1,2].indexOf(t.numChannels)?t.numChannels:1},this.outputSampleRate=this.config.sampleRate,this.oututSampleBits=this.config.sampleBits},o.prototype.startRecord=function(){var t=this;return this.context&&this.destroyRecord(),this.initRecorder(),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(n){t.audioInput=t.context.createMediaStreamSource(n),t.stream=n}).then(function(){t.audioInput.connect(t.analyser),t.analyser.connect(t.recorder),t.recorder.connect(t.context.destination)})},o.prototype.pauseRecord=function(){this.needRecord=!1},o.prototype.resumeRecord=function(){this.needRecord=!0},o.prototype.stopRecord=function(){this.audioInput&&this.audioInput.disconnect(),this.source&&this.source.stop(),this.recorder.disconnect(),this.analyser.disconnect(),this.needRecord=!0},o.prototype.destroyRecord=function(){return this.clearRecordStatus(),this.stopStream(),this.closeAudioContext()},o.prototype.getAnalyseData=function(){var t=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteTimeDomainData(t),t},o.prototype.getData=function(){return this.flat()},o.prototype.clearRecordStatus=function(){this.lBuffer.length=0,this.rBuffer.length=0,this.size=0,this.fileSize=0,this.PCM=null,this.audioInput=null,this.duration=0},o.prototype.flat=function(){var t=null,n=new Float32Array(0);this.config.numChannels===1?t=new Float32Array(this.size):(t=new Float32Array(this.size/2),n=new Float32Array(this.size/2));for(var d=0,s=0;s<this.lBuffer.length;s++)t.set(this.lBuffer[s],d),d+=this.lBuffer[s].length;for(d=0,s=0;s<this.rBuffer.length;s++)n.set(this.rBuffer[s],d),d+=this.rBuffer[s].length;return{left:t,right:n}},o.prototype.initRecorder=function(){var t=this;this.clearRecordStatus(),this.context=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=2048;var n=this.context.createScriptProcessor||this.context.createJavaScriptNode;this.recorder=n.apply(this.context,[4096,this.config.numChannels,this.config.numChannels]),this.recorder.onaudioprocess=function(d){if(t.needRecord){var s,a=d.inputBuffer.getChannelData(0),e=null;t.lBuffer.push(new Float32Array(a)),t.size+=a.length,t.config.numChannels===2&&(e=d.inputBuffer.getChannelData(1),t.rBuffer.push(new Float32Array(e)),t.size+=e.length),t.fileSize=Math.floor(t.size/Math.max(t.inputSampleRate/t.outputSampleRate,1))*(t.oututSampleBits/8),s=100*Math.max.apply(Math,a),t.duration+=4096/t.inputSampleRate,t.onprocess&&t.onprocess(t.duration),t.onprogress&&t.onprogress({duration:t.duration,fileSize:t.fileSize,vol:s})}}},o.prototype.stopStream=function(){this.stream&&this.stream.getTracks&&(this.stream.getTracks().forEach(function(t){return t.stop()}),this.stream=null)},o.prototype.closeAudioContext=function(){return this.context&&this.context.close&&this.context.state!=="closed"?this.context.close():new Promise(function(t){t()})},o.initUserMedia=function(){navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(t){var n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return n?new Promise(function(d,s){n.call(navigator,t,d,s)}):Promise.reject(new Error("浏览器不支持 getUserMedia !"))})},o.prototype.transformIntoPCM=function(t,n){var d=new Float32Array(t),s=new Float32Array(n),a=i.compress({left:d,right:s},this.inputSampleRate,this.outputSampleRate);return i.encodePCM(a,this.oututSampleBits,this.littleEdian)},o.getPermission=function(){return this.initUserMedia(),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){t&&t.getTracks().forEach(function(n){return n.stop()})})},o}();l.default=r}]).default})})(P);var R=P.exports,A=R;const S=b(A),C=x({__proto__:null,default:S},[A]);export{C as i};
