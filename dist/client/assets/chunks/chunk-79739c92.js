import{_ as p,a as b,b as y,c as V,d as X,e as U}from"./chunk-b745fb4d.js";import{g as q,r as m}from"./chunk-e9cd8943.js";import{u as j}from"./chunk-8f68cdf3.js";import{d as J,a as L,i as $,u as K,b as T}from"./chunk-b3e26e36.js";import{a as Q,d as Y}from"./chunk-5dde6c82.js";import{i as Z}from"./chunk-38ad52ab.js";import{a as k,i as I,u as ee}from"./chunk-1d6b0b39.js";var ne=Q,re=Z,te="Expected a function";function ie(n,r,e){var t=!0,a=!0;if(typeof n!="function")throw new TypeError(te);return re(e)&&(t="leading"in e?!!e.leading:t,a="trailing"in e?!!e.trailing:a),ne(n,r,{leading:t,maxWait:r,trailing:a})}var ae=ie;const ue=q(ae);var z=function(n,r){var e=r.manual,t=r.ready,a=t===void 0?!0:t,u=r.defaultParams,o=u===void 0?[]:u,c=r.refreshDeps,s=c===void 0?[]:c,i=r.refreshDepsAction,v=m.useRef(!1);return v.current=!1,j(function(){!e&&a&&(v.current=!0,n.run.apply(n,p([],b(o),!1)))},[a]),j(function(){v.current||e||(v.current=!0,i?i():n.refresh())},p([],b(s),!1)),{onBefore:function(){if(!a)return{stopNow:!0}}}};z.onInit=function(n){var r=n.ready,e=r===void 0?!0:r,t=n.manual;return{loading:!t&&e}};const oe=z;function G(n,r){var e=m.useRef({deps:r,obj:void 0,initialized:!1}).current;return(e.initialized===!1||!J(e.deps,r))&&(e.deps=r,e.obj=n(),e.initialized=!0),e.obj}var D=new Map,se=function(n,r,e){var t=D.get(n);t!=null&&t.timer&&clearTimeout(t.timer);var a=void 0;r>-1&&(a=setTimeout(function(){D.delete(n)},r)),D.set(n,y(y({},e),{timer:a}))},ce=function(n){return D.get(n)},F=new Map,le=function(n){return F.get(n)},fe=function(n,r){F.set(n,r),r.then(function(e){return F.delete(n),e}).catch(function(){F.delete(n)})},w={},de=function(n,r){w[n]&&w[n].forEach(function(e){return e(r)})},W=function(n,r){return w[n]||(w[n]=[]),w[n].push(r),function(){var t=w[n].indexOf(r);w[n].splice(t,1)}},ve=function(n,r){var e=r.cacheKey,t=r.cacheTime,a=t===void 0?5*60*1e3:t,u=r.staleTime,o=u===void 0?0:u,c=r.setCache,s=r.getCache,i=m.useRef(),v=m.useRef(),d=function(l,f){c?c(f):se(l,a,f),de(l,f.data)},h=function(l,f){return f===void 0&&(f=[]),s?s(f):ce(l)};return G(function(){if(e){var l=h(e);l&&Object.hasOwnProperty.call(l,"data")&&(n.state.data=l.data,n.state.params=l.params,(o===-1||new Date().getTime()-l.time<=o)&&(n.state.loading=!1)),i.current=W(e,function(f){n.setState({data:f})})}},[]),L(function(){var l;(l=i.current)===null||l===void 0||l.call(i)}),e?{onBefore:function(l){var f=h(e,l);return!f||!Object.hasOwnProperty.call(f,"data")?{}:o===-1||new Date().getTime()-f.time<=o?{loading:!1,data:f==null?void 0:f.data,error:void 0,returnNow:!0}:{data:f==null?void 0:f.data,error:void 0}},onRequest:function(l,f){var g=le(e);return g&&g!==v.current?{servicePromise:g}:(g=l.apply(void 0,p([],b(f),!1)),v.current=g,fe(e,g),{servicePromise:g})},onSuccess:function(l,f){var g;e&&((g=i.current)===null||g===void 0||g.call(i),d(e,{data:l,params:f,time:new Date().getTime()}),i.current=W(e,function(S){n.setState({data:S})}))},onMutate:function(l){var f;e&&((f=i.current)===null||f===void 0||f.call(i),d(e,{data:l,params:n.state.params,time:new Date().getTime()}),i.current=W(e,function(g){n.setState({data:g})}))}}:{}};const me=ve;var he=function(n,r){var e=r.debounceWait,t=r.debounceLeading,a=r.debounceTrailing,u=r.debounceMaxWait,o=m.useRef(),c=m.useMemo(function(){var s={};return t!==void 0&&(s.leading=t),a!==void 0&&(s.trailing=a),u!==void 0&&(s.maxWait=u),s},[t,a,u]);return m.useEffect(function(){if(e){var s=n.runAsync.bind(n);return o.current=Y(function(i){i()},e,c),n.runAsync=function(){for(var i=[],v=0;v<arguments.length;v++)i[v]=arguments[v];return new Promise(function(d,h){var l;(l=o.current)===null||l===void 0||l.call(o,function(){s.apply(void 0,p([],b(i),!1)).then(d).catch(h)})})},function(){var i;(i=o.current)===null||i===void 0||i.cancel(),n.runAsync=s}}},[e,c]),e?{onCancel:function(){var s;(s=o.current)===null||s===void 0||s.cancel()}}:{}};const ge=he;var pe=function(n,r){var e=r.loadingDelay,t=r.ready,a=m.useRef();if(!e)return{};var u=function(){a.current&&clearTimeout(a.current)};return{onBefore:function(){return u(),t!==!1&&(a.current=setTimeout(function(){n.setState({loading:!0})},e)),{loading:!1}},onFinally:function(){u()},onCancel:function(){u()}}};const be=pe;function B(){return $?document.visibilityState!=="hidden":!0}var A=[];function ye(n){return A.push(n),function(){var e=A.indexOf(n);A.splice(e,1)}}if($){var Pe=function(){if(B())for(var n=0;n<A.length;n++){var r=A[n];r()}};window.addEventListener("visibilitychange",Pe,!1)}var Re=function(n,r){var e=r.pollingInterval,t=r.pollingWhenHidden,a=t===void 0?!0:t,u=r.pollingErrorRetryCount,o=u===void 0?-1:u,c=m.useRef(),s=m.useRef(),i=m.useRef(0),v=function(){var d;c.current&&clearTimeout(c.current),(d=s.current)===null||d===void 0||d.call(s)};return j(function(){e||v()},[e]),e?{onBefore:function(){v()},onError:function(){i.current+=1},onSuccess:function(){i.current=0},onFinally:function(){o===-1||o!==-1&&i.current<=o?c.current=setTimeout(function(){!a&&!B()?s.current=ye(function(){n.refresh()}):n.refresh()},e):i.current=0},onCancel:function(){v()}}:{}};const we=Re;function Te(n,r){var e=!1;return function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];e||(e=!0,n.apply(void 0,p([],b(t),!1)),setTimeout(function(){e=!1},r))}}function Ce(){return $&&typeof navigator.onLine<"u"?navigator.onLine:!0}var E=[];function Ae(n){return E.push(n),function(){var e=E.indexOf(n);e>-1&&E.splice(e,1)}}if($){var N=function(){if(!(!B()||!Ce()))for(var n=0;n<E.length;n++){var r=E[n];r()}};window.addEventListener("visibilitychange",N,!1),window.addEventListener("focus",N,!1)}var Ee=function(n,r){var e=r.refreshOnWindowFocus,t=r.focusTimespan,a=t===void 0?5e3:t,u=m.useRef(),o=function(){var c;(c=u.current)===null||c===void 0||c.call(u)};return m.useEffect(function(){if(e){var c=Te(n.refresh.bind(n),a);u.current=Ae(function(){c()})}return function(){o()}},[e,a]),L(function(){o()}),{}};const Se=Ee;var Oe=function(n,r){var e=r.retryInterval,t=r.retryCount,a=m.useRef(),u=m.useRef(0),o=m.useRef(!1);return t?{onBefore:function(){o.current||(u.current=0),o.current=!1,a.current&&clearTimeout(a.current)},onSuccess:function(){u.current=0},onError:function(){if(u.current+=1,t===-1||u.current<=t){var c=e!=null?e:Math.min(1e3*Math.pow(2,u.current),3e4);a.current=setTimeout(function(){o.current=!0,n.refresh()},c)}else u.current=0},onCancel:function(){u.current=0,a.current&&clearTimeout(a.current)}}:{}};const De=Oe;var Fe=function(n,r){var e=r.throttleWait,t=r.throttleLeading,a=r.throttleTrailing,u=m.useRef(),o={};return t!==void 0&&(o.leading=t),a!==void 0&&(o.trailing=a),m.useEffect(function(){if(e){var c=n.runAsync.bind(n);return u.current=ue(function(s){s()},e,o),n.runAsync=function(){for(var s=[],i=0;i<arguments.length;i++)s[i]=arguments[i];return new Promise(function(v,d){var h;(h=u.current)===null||h===void 0||h.call(u,function(){c.apply(void 0,p([],b(s),!1)).then(v).catch(d)})})},function(){var s;n.runAsync=c,(s=u.current)===null||s===void 0||s.cancel()}}},[e,t,a]),e?{onCancel:function(){var c;(c=u.current)===null||c===void 0||c.cancel()}}:{}};const $e=Fe;var xe=function(){var n=b(m.useState({}),2),r=n[1];return m.useCallback(function(){return r({})},[])};const _e=xe;var We=function(){function n(r,e,t,a){a===void 0&&(a={}),this.serviceRef=r,this.options=e,this.subscribe=t,this.initState=a,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=y(y(y({},this.state),{loading:!e.manual}),a)}return n.prototype.setState=function(r){r===void 0&&(r={}),this.state=y(y({},this.state),r),this.subscribe()},n.prototype.runPluginHandler=function(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var a=this.pluginImpls.map(function(u){var o;return(o=u[r])===null||o===void 0?void 0:o.call.apply(o,p([u],b(e),!1))}).filter(Boolean);return Object.assign.apply(Object,p([{}],b(a),!1))},n.prototype.runAsync=function(){for(var r,e,t,a,u,o,c,s,i,v,d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];return V(this,void 0,void 0,function(){var l,f,g,S,x,H,_,O,P,R,M;return X(this,function(C){switch(C.label){case 0:if(this.count+=1,l=this.count,f=this.runPluginHandler("onBefore",d),g=f.stopNow,S=g===void 0?!1:g,x=f.returnNow,H=x===void 0?!1:x,_=U(f,["stopNow","returnNow"]),S)return[2,new Promise(function(){})];if(this.setState(y({loading:!0,params:d},_)),H)return[2,Promise.resolve(_.data)];(e=(r=this.options).onBefore)===null||e===void 0||e.call(r,d),C.label=1;case 1:return C.trys.push([1,3,,4]),O=this.runPluginHandler("onRequest",this.serviceRef.current,d).servicePromise,O||(O=(M=this.serviceRef).current.apply(M,p([],b(d),!1))),[4,O];case 2:return P=C.sent(),l!==this.count?[2,new Promise(function(){})]:(this.setState({data:P,error:void 0,loading:!1}),(a=(t=this.options).onSuccess)===null||a===void 0||a.call(t,P,d),this.runPluginHandler("onSuccess",P,d),(o=(u=this.options).onFinally)===null||o===void 0||o.call(u,d,P,void 0),l===this.count&&this.runPluginHandler("onFinally",d,P,void 0),[2,P]);case 3:if(R=C.sent(),l!==this.count)return[2,new Promise(function(){})];throw this.setState({error:R,loading:!1}),(s=(c=this.options).onError)===null||s===void 0||s.call(c,R,d),this.runPluginHandler("onError",R,d),(v=(i=this.options).onFinally)===null||v===void 0||v.call(i,d,void 0,R),l===this.count&&this.runPluginHandler("onFinally",d,void 0,R),R;case 4:return[2]}})})},n.prototype.run=function(){for(var r=this,e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.runAsync.apply(this,p([],b(e),!1)).catch(function(a){r.options.onError||console.error(a)})},n.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},n.prototype.refresh=function(){this.run.apply(this,p([],b(this.state.params||[]),!1))},n.prototype.refreshAsync=function(){return this.runAsync.apply(this,p([],b(this.state.params||[]),!1))},n.prototype.mutate=function(r){var e=k(r)?r(this.state.data):r;this.runPluginHandler("onMutate",e),this.setState({data:e})},n}();const je=We;function Le(n,r,e){r===void 0&&(r={}),e===void 0&&(e=[]);var t=r.manual,a=t===void 0?!1:t,u=U(r,["manual"]);I&&r.defaultParams&&!Array.isArray(r.defaultParams)&&console.warn("expected defaultParams is array, got ".concat(typeof r.defaultParams));var o=y({manual:a},u),c=K(n),s=_e(),i=G(function(){var v=e.map(function(d){var h;return(h=d==null?void 0:d.onInit)===null||h===void 0?void 0:h.call(d,o)}).filter(Boolean);return new je(c,o,s,Object.assign.apply(Object,p([{}],b(v),!1)))},[]);return i.options=o,i.pluginImpls=e.map(function(v){return v(i,o)}),ee(function(){if(!a){var v=i.state.params||r.defaultParams||[];i.run.apply(i,p([],b(v),!1))}}),L(function(){i.cancel()}),{loading:i.state.loading,data:i.state.data,error:i.state.error,params:i.state.params||[],cancel:T(i.cancel.bind(i)),refresh:T(i.refresh.bind(i)),refreshAsync:T(i.refreshAsync.bind(i)),run:T(i.run.bind(i)),runAsync:T(i.runAsync.bind(i)),mutate:T(i.mutate.bind(i))}}function Ve(n,r,e){return Le(n,r,p(p([],b(e||[]),!1),[ge,be,we,Se,$e,oe,me,De],!1))}export{ue as t,Ve as u};
